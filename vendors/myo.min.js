!function(){var e;"undefined"==typeof window?e=require("ws"):("WebSocket"in window||console.error("Myo.js : Sockets not supported :("),e=WebSocket),Myo={defaults:{api_version:3,socket_url:"ws://127.0.0.1:10138/myo/",app_id:"com.myojs.default"},lockingPolicy:"standard",events:[],myos:[],onError:function(){throw"Myo.js had an error with the socket. Myo Connect might not be running. If it is, double check the API version."},setLockingPolicy:function(e){return Myo.socket.send(JSON.stringify(["command",{command:"set_locking_policy",type:e}])),Myo.lockingPolicy=e,Myo},trigger:function(e){var t=Array.prototype.slice.apply(arguments).slice(1);return n.trigger.call(Myo,Myo.events,e,t),Myo},on:function(e,t){return n.on(Myo.events,e,t)},off:function(e){return Myo.events=n.off(Myo.events,e),Myo},connect:function(t){t&&(Myo.defaults.app_id=t),Myo.socket=new e(Myo.defaults.socket_url+Myo.defaults.api_version+"?appid="+Myo.defaults.app_id),Myo.socket.onmessage=Myo.handleMessage,Myo.socket.onopen=Myo.trigger.bind(Myo,"ready"),Myo.socket.onclose=Myo.trigger.bind(Myo,"socket_closed"),Myo.socket.onerror=Myo.onError},disconnect:function(){Myo.socket.close()},handleMessage:function(e){var n=JSON.parse(e.data)[1];n.type&&"undefined"!=typeof n.myo&&("paired"==n.type&&Myo.myos.push(Myo.create({macAddress:n.mac_address,name:n.name,connectIndex:n.myo})),Myo.myos.map(function(e){if(e.connectIndex===n.myo){var o=!0;t[n.type]&&(o=t[n.type](e,n)),(!t[n.type]||o)&&(e.trigger(n.type,n,n.timestamp),e.trigger("status",n,n.timestamp))}}))},create:function(e){var t=o.merge({macAddress:void 0,name:void 0,connectIndex:void 0,locked:!0,connected:!1,synced:!1,batteryLevel:0,lastIMU:void 0,arm:void 0,direction:void 0,warmupState:void 0,orientationOffset:{x:0,y:0,z:0,w:1},events:[]},e||{});return o.merge(Object.create(Myo.methods),t)},methods:{trigger:function(e){var t=Array.prototype.slice.apply(arguments).slice(1);return n.trigger.call(this,Myo.events,e,t),n.trigger.call(this,this.events,e,t),this},_trigger:function(e){var t=Array.prototype.slice.apply(arguments).slice(1);return n.trigger.call(this,this.events,e,t),this},on:function(e,t){return n.on(this.events,e,t)},off:function(e){return this.events=n.off(this.events,e),this},lock:function(){return Myo.socket.send(JSON.stringify(["command",{command:"lock",myo:this.connectIndex}])),this},unlock:function(e){return Myo.socket.send(JSON.stringify(["command",{command:"unlock",myo:this.connectIndex,type:e?"hold":"timed"}])),this},zeroOrientation:function(){return this.orientationOffset=o.quatInverse(this.lastQuant),this.trigger("zero_orientation"),this},vibrate:function(e){return e=e||"medium",Myo.socket.send(JSON.stringify(["command",{command:"vibrate",myo:this.connectIndex,type:e}])),this},requestBluetoothStrength:function(){return Myo.socket.send(JSON.stringify(["command",{command:"request_rssi",myo:this.connectIndex}])),this},requestBatteryLevel:function(){return Myo.socket.send(JSON.stringify(["command",{command:"request_battery_level",myo:this.connectIndex}])),this},streamEMG:function(e){return Myo.socket.send(JSON.stringify(["command",{command:"set_stream_emg",myo:this.connectIndex,type:e?"enabled":"disabled"}])),this}}};var t={pose:function(e,t){e.lastPose&&(e.trigger(e.lastPose+"_off"),e.trigger("pose_off",e.lastPose)),"rest"==t.pose?(e.trigger("rest"),e.lastPose=null,"standard"===Myo.lockingPolicy&&e.unlock()):(e.trigger(t.pose),e.trigger("pose",t.pose),e.lastPose=t.pose,"standard"===Myo.lockingPolicy&&e.unlock(!0))},orientation:function(e,t){e.lastQuant=t.orientation;var n=o.quatRotate(e.orientationOffset,t.orientation),r={orientation:n,accelerometer:{x:t.accelerometer[0],y:t.accelerometer[1],z:t.accelerometer[2]},gyroscope:{x:t.gyroscope[0],y:t.gyroscope[1],z:t.gyroscope[2]}};e.lastIMU||(e.lastIMU=r),e.trigger("orientation",r.orientation,t.timestamp),e.trigger("accelerometer",r.accelerometer,t.timestamp),e.trigger("gyroscope",r.gyroscope,t.timestamp),e.trigger("imu",r,t.timestamp),e.lastIMU=r},emg:function(e,t){e.trigger(t.type,t.emg,t.timestamp)},arm_synced:function(e,t){return e.arm=t.arm,e.direction=t.x_direction,e.warmupState=t.warmup_state,e.synced=!0,!0},arm_unsynced:function(e){return e.arm=void 0,e.direction=void 0,e.warmupState=void 0,e.synced=!1,!0},connected:function(e,t){return e.connectVersion=t.version.join("."),e.connected=!0,!0},disconnected:function(e){return e.connected=!1,!0},locked:function(e){return e.locked=!0,!0},unlocked:function(e){return e.locked=!1,!0},warmup_completed:function(e){return e.warmupState="warm",!0},rssi:function(e,t){t.bluetooth_strength=o.getStrengthFromRssi(t.rssi),e.trigger("bluetooth_strength",t.bluetooth_strength,t.timestamp),e.trigger("rssi",t.rssi,t.timestamp),e.trigger("status",t,t.timestamp)},battery_level:function(e,t){e.batteryLevel=t.battery_level,e.trigger("battery_level",t.battery_level,t.timestamp),e.trigger("status",t,t.timestamp)}},n={eventCounter:0,trigger:function(e,t,n){var o=this;return e.map(function(e){if(e.name==t&&e.fn.apply(o,n),"*"==e.name){var r=n.slice(0);r.unshift(t),e.fn.apply(o,r)}}),this},on:function(e,t,o){var r=(new Date).getTime()+""+n.eventCounter++;return e.push({id:r,name:t,fn:o}),r},off:function(e,t){return e=e.reduce(function(e,n){return n.name!=t&&n.id!=t&&t?(e.push(n),e):e},[])}},o={merge:function(e,t){for(var n in t)e[n]=t[n];return e},quatInverse:function(e){var t=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w);return{w:e.w/t,x:-e.x/t,y:-e.y/t,z:-e.z/t}},quatRotate:function(e,t){return{w:e.w*t.w-e.x*t.x-e.y*t.y-e.z*t.z,x:e.w*t.x+e.x*t.w+e.y*t.z-e.z*t.y,y:e.w*t.y-e.x*t.z+e.y*t.w+e.z*t.x,z:e.w*t.z+e.x*t.y-e.y*t.x+e.z*t.w}},getStrengthFromRssi:function(e){var t=-95,n=-40;return e=t>e?t:e,e=e>n?n:e,Math.round(100*(e-t)/(n-t)*100)/100}};"undefined"!=typeof module&&(module.exports=Myo)}();