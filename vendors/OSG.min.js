/*!
 * OSGJS
 * Cedric Pinson <trigrou@trigrou.com> (http://cedricpinson.com)
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("bluebird"),require("zlib"),require("hammerjs"),function(){try{return require("jquery")}catch(t){}}()):"function"==typeof define&&define.amd?define(["bluebird","zlib","hammer","jquery"],e):"object"==typeof exports?exports.OSG=e(require("bluebird"),require("zlib"),require("hammerjs"),function(){try{return require("jquery")}catch(t){}}()):t.OSG=e(t.P,t.Zlib,t.Hammer,t.$)}("undefined"!=typeof self?self:this,function(t,e,r,i){return function(t){function e(i){if(r[i])return r[i].exports;var a=r[i]={i:i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,e),a.l=!0,a.exports}var r={};return e.m=t,e.c=r,e.d=function(t,r,i){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=174)}([function(t,e,r){"use strict";var i=r(14),a=r.n(i),n=r(22),s=r(2),o={};o.extend=function(){var t,e,r,i,a=window.Object.prototype.toString,n=window.Object.prototype.hasOwnProperty,s=o.isArray,h=function(t){if(!t||"[object Object]"!==a.call(t)||t.nodeType||t.setInterval)return!1;if(t.constructor&&!n.call(t,"constructor")&&!n.call(t.constructor.prototype,"isPrototypeOf"))return!1;var e;for(e in t);return void 0===e||n.call(t,e)},u=arguments[0]||{},c=1,l=arguments.length,d=!1;for("boolean"==typeof u&&(d=u,u=arguments[1]||{},c=2),"object"==typeof u||function(t){return"[object Function]"===a.call(t)}(u)||(u={}),l===c&&(u=this,--c);c<l;c++)if(null!==(t=arguments[c]))for(e in t)if(r=u[e],i=t[e],u!==i)if(d&&i&&(h(i)||s(i))){var _=r&&(h(r)||s(r))?r:s(i)?[]:{};u[e]=o.extend(d,_,i)}else void 0!==i&&(u[e]=i);return u},o.objectInherit=function(t){function e(){}e.prototype=t;for(var r=new e,i=1;i<arguments.length;i++)o.objectMix(r,arguments[i],!1);return r},o.objectMix=function(t,e,r){for(var i in e)r&&t[i]||(t[i]=e[i]);return t},o.objectType={},o.objectType.type=0,o.arrayDense=function(t,e,r){var i=e.length;if(t>=i)for(var a=i;a<=t;a++)e.push(r?r():null)},o.objectLibraryClass=function(t,e,r){t.className=function(){return r},t.libraryName=function(){return e};var i=e+"::"+r;return t.libraryClassName=function(){return i},t},o.setTypeID=function(t){var e=t.prototype.libraryClassName(),r=o.generateId(o.objectType,e),i=function(){return r};t.typeID=t.prototype.typeID=r,t.getTypeID=t.prototype.getTypeID=i},o.createPrototypeObject=function(t,e,r,i){e.hasOwnProperty("getTypeID")&&(e=o.objectInherit(e,{})),t.prototype=e,e.constructor=t,r&&i&&(o.objectLibraryClass(e,r,i),o.setTypeID(t))},o.generateId=function(t,e){if(void 0!==t[e])return s.a.error(e+" is already defined, change class name or library name"),-1;var r=t.type;return t[r]=e,t[e]=r,t.type+=1,r},o.objectNodeType={},o.objectNodeType.type=0,o.setNodeTypeID=function(t){var e=t.prototype.libraryClassName(),r=o.generateId(o.objectNodeType,e),i=function(){return r};t.nodeTypeID=t.prototype.nodeTypeID=r,t.getNodeTypeID=t.prototype.getNodeTypeID=i},o.createPrototypeNode=function(t,e,i,a){var n=r(103).default,s=e.nodeTypeID;if(o.createPrototypeObject(t,e,i,a),i&&a){o.setNodeTypeID(t);var h=t.nodeTypeID;o.arrayDense(h,n.applyFunctionArray),n.registerApplyFunction(h,n.getApplyFunction(s))}};var h=0,u=0,c={},l={},d=0,_={};o.getStateAttributeTypeNameToTypeId=function(){return _},o.createPrototypeStateAttribute=function(t,e,r,i){o.createPrototypeObject(t,e,r,i);var a=o.getOrCreateStateAttributeTypeId(t);t.prototype.attributeTypeId=a},o.getMaxStateAttributeTypeID=function(){return d},o.getOrCreateStateAttributeTypeId=function(t){var e=t.prototype.getType();if(_[e])return _[e];var r=d++;return _[e]=r,r},o.getOrCreateStateAttributeTypeMemberIndex=function(t){if(void 0!==t._attributeTypeIndex)return t._attributeTypeIndex;var e=t.getTypeMember();return t._attributeTypeIndex=o.getOrCreateStateAttributeTypeMemberIndexFromName(e),t._attributeTypeIndex},o.getOrCreateStateAttributeTypeMemberIndexFromName=function(t){var e=c[t];return void 0!==e?e:(e=h++,c[t]=e,e)},o.getOrCreateTextureStateAttributeTypeMemberIndex=function(t){if(void 0!==t._attributeTypeIndex)return t._attributeTypeIndex;var e=t.getTypeMember();return t._attributeTypeIndex=o.getOrCreateTextureStateAttributeTypeMemberIndexFromName(e),t._attributeTypeIndex},o.getOrCreateTextureStateAttributeTypeMemberIndexFromName=function(t){var e=l[t];return void 0!==e?e:(e=u++,l[t]=e,e)},o.getIdFromTypeMember=function(t){return c[t]},o.getTextureIdFromTypeMember=function(t){return l[t]},o.Int8Array=window.Int8Array,o.Uint8Array=window.Uint8Array,o.Uint8ClampedArray=window.Uint8ClampedArray,o.Int16Array=window.Int16Array,o.Uint16Array=window.Uint16Array,o.Int32Array=window.Int32Array,o.Uint32Array=window.Uint32Array,o.Float32Array=window.Float32Array,o.Float64Array=window.Float64Array;var f={},g={};o.logTime=(s.a.console.time||function(t){f[t]=n.a.instance().tick()}).bind(s.a.console),o.logTimeEnd=(s.a.console.timeEnd||function(t){if(void 0!==f[t]){var e=n.a.instance().deltaM(f[t],n.a.instance().tick());s.a.log(t+": "+e+"ms"),f[t]=void 0}}).bind(s.a.console),o.time=function(t,e){var r=e;void 0===r&&(r=s.a.NOTICE),r>s.a.getNotifyLevel()||(g[t]=1,o.logTime(t))},o.timeEnd=function(t){void 0!==g[t]&&o.logTimeEnd(t)},o.profile=(s.a.console.profile||function(){}).bind(s.a.console),o.profileEnd=(s.a.console.profileEnd||function(){}).bind(s.a.console),o.arrayUniq=function(t){for(var e=t.length,r={},i=[],a=0,n=0;n<e;n++){var s=t[n];1!==r[s]&&(r[s]=1,i[a++]=s)}return i},o.rejectObject=function(t,e){return e&&(t="Invalid json "+t+" "+Object.keys(e)),s.a.warn(t),a.a.reject(t)},e.a=o},function(t,e,r){"use strict";r.d(e,"b",function(){return l}),r.d(e,"c",function(){return c}),r.d(e,"d",function(){return d}),r.d(e,"e",function(){return o}),r.d(e,"f",function(){return h}),r.d(e,"g",function(){return u});var i=r(39),a=r(179),n=r.n(a),s=r(185);r.d(e,"a",function(){return n.a}),n.a.glMatrix.setMatrixArrayType(s.a.ArrayType),n.a.glMatrix.EPSILON=1e-9;var o=n.a.vec2,h=n.a.vec3,u=n.a.vec4,c=n.a.mat4,l=n.a.mat3,d=n.a.quat;h.create32=function(){return new Float32Array(3)},h.create64=function(){return new Float64Array(3)},h.fromValues32=function(t,e,r){var i=new Float32Array(3);return i[0]=t,i[1]=e,i[2]=r,i},h.fromValues64=function(t,e,r){var i=new Float64Array(3);return i[0]=t,i[1]=e,i[2]=r,i},h.init=function(t){return h.set(t,0,0,0)},h.transformMat4Rotate=function(t,e,r){var i=e[0],a=e[1],n=e[2];return t[0]=r[0]*i+r[1]*a+r[2]*n,t[1]=r[4]*i+r[5]*a+r[6]*n,t[2]=r[8]*i+r[9]*a+r[10]*n,t},h.valid=function(t){return!i.a.isNaN(t[0])&&(!i.a.isNaN(t[1])&&!i.a.isNaN(t[2]))},h.neg=h.negate,h.ZERO=h.create(),h.ONE=h.fromValues(1,1,1),h.INFINITY=h.fromValues(1/0,1/0,1/0),h.NEGATIVE_INFINITY=h.fromValues(-1/0,-1/0,-1/0),o.create32=function(){return new Float32Array(2)},o.create64=function(){return new Float64Array(2)},o.fromValues32=function(t,e){var r=new Float32Array(2);return r[0]=t,r[1]=e,r},o.fromValues64=function(t,e){var r=new Float64Array(2);return r[0]=t,r[1]=e,r},o.init=function(t){return o.set(t,0,0)},o.valid=function(t){return!i.a.isNaN(t[0])&&!i.a.isNaN(t[1])},o.ZERO=o.create(),o.ONE=o.fromValues(1,1),o.INFINITY=o.fromValues(1/0,1/0),o.NEGATIVE_INFINITY=o.fromValues(-1/0,-1/0),u.create32=function(){return new Float32Array(4)},u.create64=function(){return new Float64Array(4)},u.fromValues32=function(t,e,r,i){var a=new Float32Array(4);return a[0]=t,a[1]=e,a[2]=r,a[3]=i,a},u.fromValues64=function(t,e,r,i){var a=new Float64Array(4);return a[0]=t,a[1]=e,a[2]=r,a[3]=i,a},u.init=function(t){return u.set(t,0,0,0,0)},u.valid=function(t){return!i.a.isNaN(t[0])&&(!i.a.isNaN(t[1])&&(!i.a.isNaN(t[2])&&!i.a.isNaN(t[3])))},u.neg=u.negate,u.ZERO=u.create(),u.ONE=u.fromValues(1,1,1,1),u.INFINITY=u.fromValues(1/0,1/0,1/0,1/0),u.NEGATIVE_INFINITY=u.fromValues(-1/0,-1/0,-1/0,-1/0),d.IDENTITY=d.create(),d.zeroRotation=function(t){return 0===t[0]&&0===t[1]&&0===t[2]&&1===t[3]},d.create32=function(){var t=new Float32Array(4);return t[3]=1,t},d.create64=function(){var t=new Float64Array(4);return t[3]=1,t},d.fromValues32=u.fromValues32,d.fromValues64=u.fromValues64,d.init=d.identity,d.nlerp=function(t,e,r,i){var a,n,s,o,h=e[0],u=e[1],c=e[2],l=e[3],d=r[0],_=r[1],f=r[2],g=r[3],p=h*d+u*_+c*f+l*g,m=1-i;p<0?(a=h*m-d*i,n=u*m-_*i,s=c*m-f*i,o=l*m-g*i):(a=h*m+d*i,n=u*m+_*i,s=c*m+f*i,o=l*m+g*i);var v=1/Math.sqrt(a*a+n*n+s*s+o*o);return t[0]=a*v,t[1]=n*v,t[2]=s*v,t[3]=o*v,t},l.IDENTITY=l.create(),l.create32=function(){var t=new Float32Array(9);return t[0]=t[4]=t[8]=1,t},l.create64=function(){var t=new Float64Array(9);return t[0]=t[4]=t[8]=1,t},c.IDENTITY=c.create(),c.create32=function(){var t=new Float32Array(16);return t[0]=t[5]=t[10]=t[15]=1,t},c.create64=function(){var t=new Float64Array(16);return t[0]=t[5]=t[10]=t[15]=1,t},c.setTranslation=function(t,e){return t[12]=e[0],t[13]=e[1],t[14]=e[2],t},c.getFrustum=function(t,e){var r,i,a=0,n=0,s=0,o=0;if(0!==e[3]||0!==e[7]||-1!==e[11]||0!==e[15])return!1;var h=e[14]/(e[10]-1),u=e[14]/(1+e[10]);return n=h*(e[8]-1)/e[0],a=h*(1+e[8])/e[0],s=h*(1+e[9])/e[5],o=h*(e[9]-1)/e[5],r=h,i=u,t.left=n,t.right=a,t.top=s,t.bottom=o,t.zNear=r,t.zFar=i,!0},c.getPerspective=function(){var t={right:0,left:0,top:0,bottom:0,zNear:0,zFar:0};return function(e,r){return c.getFrustum(t,r)&&(e.fovy=180/Math.PI*(Math.atan(t.top/t.zNear)-Math.atan(t.bottom/t.zNear)),e.aspectRatio=(t.right-t.left)/(t.top-t.bottom)),e.zNear=t.zNear,e.zFar=t.zFar,e}}(),c.getLookAt=function(){var t=c.create(),e=h.create(),r=h.fromValues(0,1,0),i=h.fromValues(0,0,-1);return function(a,n,s,o,u){var l=void 0!==u?u:1;c.invert(t,o),c.getTranslation(a,t),h.transformMat4Rotate(s,r,o),h.transformMat4Rotate(n,i,o),h.normalize(n,n),h.add(n,h.scale(e,n,l),a)}}(),c.getFrustumPlanes=function(){var t=c.create();return function(e,r,i,a){c.mul(t,r,i);var n=!!a,s=e[0];s[0]=t[3]-t[0],s[1]=t[7]-t[4],s[2]=t[11]-t[8],s[3]=t[15]-t[12];var o=e[1];o[0]=t[3]+t[0],o[1]=t[7]+t[4],o[2]=t[11]+t[8],o[3]=t[15]+t[12];var h=e[2];h[0]=t[3]+t[1],h[1]=t[7]+t[5],h[2]=t[11]+t[9],h[3]=t[15]+t[13];var u=e[3];u[0]=t[3]-t[1],u[1]=t[7]-t[5],u[2]=t[11]-t[9],u[3]=t[15]-t[13];var l=4;if(n){l=6;var d=e[4];d[0]=t[3]-t[2],d[1]=t[7]-t[6],d[2]=t[11]-t[10],d[3]=t[15]-t[14];var _=e[5];_[0]=t[3]+t[2],_[1]=t[7]+t[6],_[2]=t[11]+t[10],_[3]=t[15]+t[14]}for(var f=0;f<l;f++){var g=e[f],p=1/Math.sqrt(g[0]*g[0]+g[1]*g[1]+g[2]*g[2]);g[0]*=p,g[1]*=p,g[2]*=p,g[3]*=p}}}(),c.infiniteFrustum=function(t,e,r,i,a,n){var s=2*n/(r-e),o=2*n/(a-i),h=(r+e)/(r-e),u=(a+i)/(a-i);return t[0]=s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=h,t[9]=u,t[10]=-1,t[11]=-1,t[12]=0,t[13]=0,t[14]=-2*n,t[15]=0,t},c.lookAtDirection=function(){var t=h.create(),e=h.create(),r=h.create();return function(i,a,n,s){var o=n;return h.cross(t,o,s),h.normalize(t,t),h.cross(e,t,o),h.normalize(e,e),i[0]=t[0],i[1]=e[0],i[2]=-o[0],i[3]=0,i[4]=t[1],i[5]=e[1],i[6]=-o[1],i[7]=0,i[8]=t[2],i[9]=e[2],i[10]=-o[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,c.translate(i,i,h.neg(r,a))}}(),c.getScale=function(){var t=h.create(),e=h.create(),r=h.create();return function(i,a){return t[0]=a[0],t[1]=a[4],t[2]=a[8],e[0]=a[1],e[1]=a[5],e[2]=a[9],r[0]=a[2],r[1]=a[6],r[2]=a[10],i[0]=h.length(t),i[1]=h.length(e),i[2]=h.length(r),i}}(),c.getSqrScale=function(){var t=h.create(),e=h.create(),r=h.create();return function(i,a){return t[0]=a[0],t[1]=a[4],t[2]=a[8],e[0]=a[1],e[1]=a[5],e[2]=a[9],r[0]=a[2],r[1]=a[6],r[2]=a[10],i[0]=h.sqrLen(t),i[1]=h.sqrLen(e),i[2]=h.sqrLen(r),i}}();var _=c.rotate;c.rotate=function(t,e,r,i){return _(t,e,r,i)||c.identity(t)};var f=c.fromRotation;c.fromRotation=function(t,e,r){return f(t,e,r)||c.identity(t)}},function(t,e,r){"use strict";function i(){var t=arguments[0];if(h.console&&!(t>h.currentNotifyLevel)){var e=arguments[1],r=Array.prototype.slice.call(arguments);r=r.splice(2,arguments.length),h.console[e].apply(h.console,r),h.traceLogCall&&t!==h.ERROR&&console.trace()}}function a(t,e,r,i){!h.console||t>h.currentNotifyLevel||(h.console.groupCollapsed&&h.console.groupCollapsed(r),h.console[e](i),h.traceLogCall&&t!==h.ERROR&&console.trace(),h.console.groupEnd&&h.console.groupEnd())}function n(t,e){return e?[t.slice(0,4),t.slice(4,8),t.slice(8,12),t.slice(12,16)]:[[t[0],t[4],t[8],t[12]],[t[1],t[5],t[9],t[13]],[t[2],t[6],t[10],t[14]],[t[3],t[7],t[11],t[15]]]}function s(t,e,r){t>h.currentNotifyLevel||h.console.table&&i("table",n(e,r))}function o(t,e,r,i){t>h.currentNotifyLevel||h.console.table&&a("table",e,n(r,i))}var h={};h.ALWAYS=0,h.FATAL=h.ERROR=1,h.WARN=2,h.NOTICE=h.LOG=3,h.INFO=4,h.DEBUG=5,h.currentNotifyLevel=h.LOG,h.console=window.console;for(var u=["error","warn","log","info","debug"],c=0;c<u.length;++c){var l=u[c],d=h[l.toUpperCase()];h[l]=i.bind(h,d,l),h[l+"Fold"]=a.bind(h,d,l),h[l+"Matrix"]=s.bind(h,d),h[l+"MatrixFold"]=o.bind(h,d)}h.group=i.bind(h,h.LOG,"group"),h.groupCollapsed=i.bind(h,h.LOG,"groupCollapsed"),h.groupEnd=h.console.groupEnd,h.notice=h.log,h.noticeFold=h.logFold,h.noticeMatrix=h.logMatrix,h.noticeMatrixFold=h.logMatrixFold,h.timeStamp=function(){},h.assert=function(t,e){void 0===this.console||t||this.console.assert(t,e)},h.setNotifyLevel=function(t,e){h.currentNotifyLevel=t,void 0!==e&&(h.traceLogCall=e)},h.getNotifyLevel=function(){return h.currentNotifyLevel},h.reportWebGLError=!1,h.setConsole=function(t){h.console=t},e.a=h},function(t,e,r){"use strict";var i=function(t){this.traversalMask=-1,this.nodeMaskOverride=0,this.traversalMode=t,void 0===t&&(this.traversalMode=i.TRAVERSE_ALL_CHILDREN),this.nodePath=[],this.visitorType=i.NODE_VISITOR,this._databaseRequestHandler=void 0,this._frameStamp=void 0,this.traverse=i._traversalFunctions[this.traversalMode],this.pushOntoNodePath=i._pushOntoNodePath[this.traversalMode],this.popFromNodePath=i._popFromNodePath[this.traversalMode]};i.TRAVERSE_PARENTS=1,i.TRAVERSE_ALL_CHILDREN=2,i.TRAVERSE_ACTIVE_CHILDREN=3,i.NODE_VISITOR=0,i.UPDATE_VISITOR=1,i.CULL_VISITOR=2;var a=function(t){t.ascend(this)},n=function(t){t.traverse(this)};i._traversalFunctions=[void 0,a,n,n];var s=function(t){this.nodePath.unshift(t)},o=function(t){this.nodePath.push(t)};i._pushOntoNodePath=[void 0,s,o,o];var h=function(){return this.nodePath.shift()},u=function(){this.nodePath.pop()};i._popFromNodePath=[void 0,h,u,u],i.prototype={reset:function(){this.nodePath.length=0},setFrameStamp:function(t){this._frameStamp=t},getFrameStamp:function(){return this._frameStamp},setNodeMaskOverride:function(t){this.nodeMaskOverride=t},getNodeMaskOverride:function(){return this.nodeMaskOverride},setTraversalMask:function(t){this.traversalMask=t},getTraversalMask:function(){return this.traversalMask},getNodePath:function(){return this.nodePath},validNodeMask:function(t){var e=t.getNodeMask();return 0!=(this.traversalMask&(this.nodeMaskOverride|e))},apply:function(t){this.traverse(t)},getVisitorType:function(){return this.visitorType},setDatabaseRequestHandler:function(t){this._databaseRequestHandler=t},getDatabaseRequestHandler:function(){return this._databaseRequestHandler}},e.a=i},function(t,e,r){"use strict";var i=r(0),a=r(5),n=function(){a.a.call(this)};i.a.createPrototypeStateAttribute(n,i.a.objectInherit(a.a.prototype,{_attributeTypeIndex:void 0,getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},apply:function(){},getHash:function(){return this.getType()}}),"osg","StateAttribute"),n.OFF=0,n.ON=1,n.OVERRIDE=2,n.PROTECTED=4,n.INHERIT=8,e.a=n},function(t,e,r){"use strict";var i=r(0),a=function(){this._name=void 0,this._userdata=void 0,this._instanceID=a.getInstanceID()};i.a.createPrototypeObject(a,{cloneType:function(){return new(0,this.constructor)},getInstanceID:function(){return this._instanceID},setName:function(t){this._name=t},getName:function(){return this._name},setUserData:function(t){this._userdata=t},getUserData:function(){return this._userdata}},"osg","Object");var n=0;a.getInstanceID=function(){return n+=1},e.a=a},function(t,e,r){"use strict";var i=r(2),a=function(t){this._data=void 0,this._transpose=!1,this._glCall="",this._cache=void 0,this._name=t,this._type=void 0,this._isMatrix=!1};a.isUniform=function(t){return"object"==typeof t&&window.Object.getPrototypeOf(t)===a.prototype},a.prototype={getName:function(){return this._name},getType:function(){return this._type},apply:function(t,e){this._cache||(this._cache=t[this._glCall]),this._isMatrix?this._cache.call(t,e,this._transpose,this._data):this._cache.call(t,e,this._data)},setInternalArray:function(t){i.a.warn("setInternalArray deprecated, please use getInternalArray instead: "+t.length),this._data=t},getInternalArray:function(){return this._data},setFloat:function(t){this._data[0]=t},setFloat1:function(t){this._data[0]=t[0]},setFloat2:function(t){this._data[0]=t[0],this._data[1]=t[1]},setFloat3:function(t){this._data[0]=t[0],this._data[1]=t[1],this._data[2]=t[2]},setFloat4:function(t){this._data[0]=t[0],this._data[1]=t[1],this._data[2]=t[2],this._data[3]=t[3]},setFloat9:function(t){this._data[0]=t[0],this._data[1]=t[1],this._data[2]=t[2],this._data[3]=t[3],this._data[4]=t[4],this._data[5]=t[5],this._data[6]=t[6],this._data[7]=t[7],this._data[8]=t[8]},setFloat16:function(t){this._data[0]=t[0],this._data[1]=t[1],this._data[2]=t[2],this._data[3]=t[3],this._data[4]=t[4],this._data[5]=t[5],this._data[6]=t[6],this._data[7]=t[7],this._data[8]=t[8],this._data[9]=t[9],this._data[10]=t[10],this._data[11]=t[11],this._data[12]=t[12],this._data[13]=t[13],this._data[14]=t[14],this._data[15]=t[15]}},a.prototype.setVec2=a.prototype.setFloat2,a.prototype.setVec3=a.prototype.setFloat3,a.prototype.setVec4=a.prototype.setFloat4,a.prototype.setMatrix4=a.prototype.setFloat16,a.prototype.setMatrix3=a.prototype.setFloat9,a.prototype.setInt=a.prototype.setFloat,a.prototype.setInt1=a.prototype.setFloat1,a.prototype.setInt2=a.prototype.setFloat2,a.prototype.setInt3=a.prototype.setFloat3,a.prototype.setInt4=a.prototype.setFloat4;var n=function(t,e,r,i,n,s){var o=e&&e.length?t:void 0,h=new a(void 0!==o?e:t);if(h._data=r,void 0!==o)if(o.length)for(var u=0,c=o.length;u<c;++u)h._data[u]=o[u];else h._data[0]=o;return h._glCall=i,h._type=n,h._isMatrix=!!s,h},s=function(t){for(var e=new Float32Array(4*t),r=0;r<e.length;r+=4)e[r]=e[r+3]=1;return e},o=function(t){for(var e=new Float32Array(9*t),r=0;r<e.length;r+=9)e[r]=e[r+4]=e[r+8]=1;return e},h=function(t){for(var e=new Float32Array(16*t),r=0;r<e.length;r+=16)e[r]=e[r+5]=e[r+10]=e[r+15]=1;return e},u=function(t,e,r){return r&&!r.length?r:"string"!=typeof e?(e.length||1)/t:1};a.createFloat1=function(t,e){return n(t,e,new Float32Array(1*u(1,t,e)),"uniform1fv","float")},a.createFloat2=function(t,e){return n(t,e,new Float32Array(2*u(2,t,e)),"uniform2fv","vec2")},a.createFloat3=function(t,e){return n(t,e,new Float32Array(3*u(3,t,e)),"uniform3fv","vec3")},a.createFloat4=function(t,e){return n(t,e,new Float32Array(4*u(4,t,e)),"uniform4fv","vec4")},a.createInt1=function(t,e){return n(t,e,new Int32Array(1*u(1,t,e)),"uniform1iv","int")},a.createInt2=function(t,e){return n(t,e,new Int32Array(2*u(2,t,e)),"uniform2iv","vec2i")},a.createInt3=function(t,e){return n(t,e,new Int32Array(3*u(3,t,e)),"uniform3iv","vec3i")},a.createInt4=function(t,e){return n(t,e,new Int32Array(4*u(4,t,e)),"uniform4iv","vec4i")},a.createMatrix2=function(t,e){return n(t,e,s(u(4,t,e)),"uniformMatrix2fv","mat2",!0)},a.createMatrix3=function(t,e){return n(t,e,o(u(9,t,e)),"uniformMatrix3fv","mat3",!0)},a.createMatrix4=function(t,e){return n(t,e,h(u(16,t,e)),"uniformMatrix4fv","mat4",!0)},a.float=a.createFloatArray=a.createFloat=a.createFloat1,a.vec2=a.createFloat2Array=a.createFloat2,a.vec3=a.createFloat3Array=a.createFloat3,a.vec4=a.createFloat4Array=a.createFloat4,a.int=a.createIntArray=a.createInt=a.createInt1,a.vec2i=a.createInt2Array=a.createInt2,a.vec3i=a.createInt3Array=a.createInt3,a.vec4i=a.createInt4Array=a.createInt4,a.mat2=a.createMat2Array=a.createMat2=a.createMatrix2,a.mat3=a.createMat3Array=a.createMat3=a.createMatrix3,a.mat4=a.createMat4Array=a.createMat4=a.createMatrix4,e.a=a},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(2),a=r(0),n=r(4),s=r(6),o=r(41),h=r(33),u=r(186),c=r(28),l=window.ImageBitmap||function(){},d=function(t){return 0!==t&&(t&1+~t)===t},_=function(){n.a.call(this),h.a.call(this),this.setDefaultParameters(),this._dirty=!0,this._dirtyMipmap=!0,this._applyTexImage2DCallbacks=[],this._textureObject=void 0,this._textureNull=!0},f=function(t,e){var r=_[t];return void 0===r?(i.a.warn("bad Texture enum argument "+t+"\nfallback to "+e),e):r};_.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,_.UNPACK_FLIP_Y_WEBGL=37440,_.BROWSER_DEFAULT_WEBGL=37444,_.NONE=0,_.DEPTH_COMPONENT=6402,_.DEPTH_COMPONENT16=33189,_.DEPTH_STENCIL=34041,_.DEPTH24_STENCIL8=35056,_.DEPTH_COMPONENT24=33190,_.DEPTH_COMPONENT32F=36012,_.COMPRESSED_RGB_S3TC_DXT1_EXT=33776,_.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777,_.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778,_.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779,_.COMPRESSED_RGB_ATC_WEBGL=35986,_.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35987,_.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798,_.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840,_.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841,_.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842,_.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843,_.COMPRESSED_RGB_ETC1_WEBGL=36196,_.LINEAR=9729,_.NEAREST=9728,_.NEAREST_MIPMAP_NEAREST=9984,_.LINEAR_MIPMAP_NEAREST=9985,_.NEAREST_MIPMAP_LINEAR=9986,_.LINEAR_MIPMAP_LINEAR=9987,_.TEXTURE_MAX_ANISOTROPY_EXT=34046,_.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047,_.CLAMP_TO_EDGE=33071,_.REPEAT=10497,_.MIRRORED_REPEAT=33648,_.TEXTURE_2D=3553,_.TEXTURE_CUBE_MAP=34067,_.TEXTURE_BINDING_CUBE_MAP=34068,_.TEXTURE_CUBE_MAP_POSITIVE_X=34069,_.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,_.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,_.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,_.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,_.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,_.MAX_CUBE_MAP_TEXTURE_SIZE=34076,_.UNSIGNED_BYTE=5121,_.UNSIGNED_SHORT=5123,_.UNSIGNED_SHORT_4_4_4_4=32819,_.UNSIGNED_SHORT_5_5_5_1=32820,_.UNSIGNED_SHORT_5_6_5=33635,_.FLOAT=5126,_.HALF_FLOAT_OES=36193,_.HALF_FLOAT=5131,_.UNSIGNED_INT_10F_11F_11F_REV=35899,_.UNSIGNED_INT_24_8=34042,_.ALPHA=6406,_.RGB=6407,_.RGBA=6408,_.LUMINANCE=6409,_.LUMINANCE_ALPHA=6410,_.RED_INTEGER=36244,_.RGB_INTEGER=36248,_.RGBA_INTEGER=36249,_.RG_INTEGER=33320,_.RED=6403,_.R8=33321,_.R8UI=33330,_.RG8=33323,_.RG8UI=33336,_.RGB8=36758,_.RGB565=36194,_.RGB9_E5=35901,_.RGB8UI=36221,_.RGBA8=32856,_.RGB5_A1=32855,_.RGBA4=32854,_.RGBA8UI=36220,_.SRGB8_ALPHA8=35907,_.SRGB8=35905,_.R16F=33325,_.RG16F=33327,_.RGB16F=34843,_.RGBA16F=34842,_.R11F_G11F_B10F=35898,_.R32F=33326,_.RG32F=33328,_.RGB32F=34837,_.RGBA32F=34836;var g=function(){var t={};return t[_.R8]=_.LUMINANCE,t[_.R8UI]=_.LUMINANCE,t[_.R16F]=_.LUMINANCE,t[_.R32F]=_.LUMINANCE,t[_.SRGB8]=_.LUMINANCE,t[_.RG8]=_.RGB,t[_.RG8UI]=_.RGB,t[_.RG16F]=_.RGB,t[_.RG32F]=_.RGB,t[_.RGB8]=_.RGB,t[_.RGB565]=_.RGB,t[_.RGB9_E5]=_.RGB,t[_.RGB8UI]=_.RGB,t[_.RGB5_A1]=_.RGB,t[_.RGB16F]=_.RGB,t[_.RGB32F]=_.RGB,t[_.RGBA8]=_.RGBA,t[_.R11F_G11F_B10F]=_.RGBA,t[_.RGBA16F]=_.RGBA,t[_.RGBA32F]=_.RGBA,t[_.SRGB8_ALPHA8]=_.RGBA,t}(),p=function(){var t={},e={},r={},i={},a={},n={};return t[_.FLOAT]=e,t[_.HALF_FLOAT]=t[_.HALF_FLOAT_OES]=r,t[_.UNSIGNED_SHORT]=i,t[_.UNSIGNED_INT]=a,t[_.UNSIGNED_INT_24_8]=n,r[_.LUMINANCE]=_.R16F,r[_.RGB]=_.RGB16F,r[_.RGBA]=_.RGBA16F,e[_.LUMINANCE]=_.R32F,e[_.RGB]=_.RGB32F,e[_.RGBA]=_.RGBA32F,i[_.DEPTH_COMPONENT]=_.DEPTH_COMPONENT16,a[_.DEPTH_COMPONENT]=_.DEPTH_COMPONENT32F,n[_.DEPTH_STENCIL]=_.DEPTH24_STENCIL8,t}();_._sTextureManager=new window.Map,_.getTextureManager=function(t){return _._sTextureManager.has(t)||_._sTextureManager.set(t,new u.a),_._sTextureManager.get(t)},_.getEnumFromString=function(t){var e=t;return"string"==typeof e&&(e=f(e,t)),e},a.a.createPrototypeStateAttribute(_,a.a.objectInherit(h.a.prototype,a.a.objectInherit(n.a.prototype,{attributeType:"Texture",cloneType:function(){return new _},invalidate:function(){this._textureObject=void 0,this.dirty()},dirty:function(){this._dirty=!0},isDirty:function(){return this._dirty},isTextureNull:function(){return this._textureNull},getOrCreateUniforms:function(t){if(void 0===_.uniforms&&(_.uniforms=[]),void 0===_.uniforms[t]){var e=this.getType()+t;_.uniforms[t]={texture:s.a.createInt1(t,e)}}return _.uniforms[t]},setDefaultParameters:function(){this._image=void 0,this._magFilter=_.LINEAR,this._minFilter=_.LINEAR,this._maxAnisotropy=1,this._wrapS=_.CLAMP_TO_EDGE,this._wrapT=_.CLAMP_TO_EDGE,this._textureWidth=0,this._textureHeight=0,this._unrefImageDataAfterApply=!1,this._internalFormat=void 0,this._dirtyMipmap=!0,this._textureTarget=_.TEXTURE_2D,this.setInternalFormatType(_.UNSIGNED_BYTE),this._isCompressed=!1,this._flipY=!0,this._colorSpaceConversion=_.NONE},setColorSpaceConversion:function(t){this._colorSpaceConversion=t},setFlipY:function(t){this._flipY=t},getTextureTarget:function(){return this._textureTarget},getTextureObject:function(){return this._textureObject},setTextureSize:function(t,e){var r=c.a.instance().getWebGLParameter("MAX_TEXTURE_SIZE");t===this._textureWidth&&e===this._textureHeight||this.dirty(),void 0!==t&&(t>r?(i.a.error("width ("+t+') too big for GPU. Max Texture Size is "'+r+'"'),this._textureWidth=r):this._textureWidth=t),void 0!==e&&(e>r?(i.a.error("height ("+e+') too big for GPU. Max Texture Size is "'+r+'"'),this._textureHeight=r):this._textureHeight=e),this._textureNull=!1},init:function(t){this._gl||this.setGraphicContext(t.getGraphicContext()),this._textureObject||(this._textureObject=_.getTextureManager(this._gl).generateTextureObject(this._gl,this,this._textureTarget,this._internalFormat,this._textureWidth,this._textureHeight),this.dirty(),this._dirtyTextureObject=!1,this._textureNull=!1)},addApplyTexImage2DCallback:function(t){this._applyTexImage2DCallbacks.indexOf(t)<0&&this._applyTexImage2DCallbacks.push(t)},removeApplyTexImage2DCallback:function(t){var e=this._applyTexImage2DCallbacks.indexOf(t);e>=0&&this._applyTexImage2DCallbacks.splice(e,1)},getWidth:function(){return this._textureWidth},getHeight:function(){return this._textureHeight},releaseGLObjects:function(){void 0!==this._textureObject&&null!==this._textureObject&&void 0!==this._gl&&(_.getTextureManager(this._gl).releaseTextureObject(this._textureObject),h.a.removeObject(this._gl,this)),this.invalidate()},getWrapT:function(){return this._wrapT},getWrapS:function(){return this._wrapS},setWrapS:function(t){this._wrapS="string"==typeof t?f(t,_.CLAMP_TO_EDGE):t,this.dirtyTextureParameters()},setWrapT:function(t){this._wrapT="string"==typeof t?f(t,_.CLAMP_TO_EDGE):t,this.dirtyTextureParameters()},dirtyTextureParameters:function(){this.dirty(),this.dirtyMipmap(),this.dirtyTextureObject()},dirtyTextureObject:function(){this._dirtyTextureObject=!0,this.dirtyMipmap(),this.dirty()},getMinFilter:function(){return this._minFilter},getMagFilter:function(){return this._magFilter},setMaxAnisotropy:function(t){this._maxAnisotropy=t,this.dirtyTextureParameters()},getMaxAnisotropy:function(){return this._maxAnisotropy},setMinFilter:function(t){this._minFilter="string"==typeof t?f(t,_.LINEAR):t,this.dirtyTextureParameters()},setMagFilter:function(t){this._magFilter="string"==typeof t?f(t,_.LINEAR):t,this.dirtyTextureParameters()},setImage:function(t,e){var r=t;(t instanceof window.Image||t instanceof HTMLCanvasElement||t instanceof l||t instanceof Uint8Array||t instanceof Uint16Array||t instanceof Float32Array)&&(r=new o.a(t)),this._image=r,this.setImageFormat(e),r&&(r.getWidth&&r.getHeight?this.setTextureSize(r.getWidth(),r.getHeight()):r.width&&r.height&&this.setTextureSize(r.width,r.height)),this._textureNull=!1,this.dirty()},getImage:function(){return this._image},setImageFormat:function(t){var e=t;e?("string"==typeof e&&(e=_[e]),this._imageFormat=e):this._imageFormat=_.RGBA},setInternalFormatType:function(t){this._type="string"==typeof t?_[t]:t},getInternalFormatType:function(){return this._type},setUnrefImageDataAfterApply:function(t){this._unrefImageDataAfterApply=t},checkIsCompressed:function(t){switch(t||this._internalFormat){case _.COMPRESSED_RGB_S3TC_DXT1_EXT:case _.COMPRESSED_RGBA_S3TC_DXT1_EXT:case _.COMPRESSED_RGBA_S3TC_DXT3_EXT:case _.COMPRESSED_RGBA_S3TC_DXT5_EXT:case _.COMPRESSED_RGB_ATC_WEBGL:case _.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:case _.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:case _.COMPRESSED_RGB_PVRTC_4BPPV1_IMG:case _.COMPRESSED_RGB_PVRTC_2BPPV1_IMG:case _.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:case _.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:case _.COMPRESSED_RGB_ETC1_WEBGL:return!0;default:return!1}},setInternalFormat:function(t){var e=t;e?("string"==typeof e&&(e=_[e]),this._isCompressed=this.checkIsCompressed(e)):(this._isCompressed=!1,e=_.RGBA),this._internalFormat=e},getInternalFormat:function(){return this._internalFormat},isDirtyMipmap:function(){return this._dirtyMipmap},dirtyMipmap:function(){this._dirtyMipmap=!0},applyFilterParameter:function(t,e){if(d(this._textureWidth)&&d(this._textureHeight)||(this._wrapT=_.CLAMP_TO_EDGE,this._wrapS=_.CLAMP_TO_EDGE,this._minFilter!==_.LINEAR_MIPMAP_LINEAR&&this._minFilter!==_.LINEAR_MIPMAP_NEAREST||(this._minFilter=_.LINEAR)),t.texParameteri(e,t.TEXTURE_MAG_FILTER,this._magFilter),t.texParameteri(e,t.TEXTURE_MIN_FILTER,this._minFilter),this._maxAnisotropy>1&&_.ANISOTROPIC_SUPPORT_EXT){var r=this._maxAnisotropy<_.ANISOTROPIC_SUPPORT_MAX?this._maxAnisotropy:_.ANISOTROPIC_SUPPORT_MAX;t.texParameterf(e,_.TEXTURE_MAX_ANISOTROPY_EXT,r)}t.texParameteri(e,t.TEXTURE_WRAP_S,this._wrapS),t.texParameteri(e,t.TEXTURE_WRAP_T,this._wrapT)},generateMipmap:function(t,e){if(this._dirtyMipmap=!1,this.hasMipmapFilter()){var r=this._image;if(r&&r.hasMipmap())for(var i=this._getInternalFormatGL(),a=r.getMipmap(),n=1,s=a.length;n<s;n++){var o=a[n];this._isCompressed?this.applyTexImage2D(t,this._textureTarget,n,i,o.getWidth(),o.getHeight(),0,o.getImage()):this.applyTexImage2D(t,this._textureTarget,n,i,o.getWidth(),o.getHeight(),0,this._internalFormat,this._type,o.getImage())}else t.generateMipmap(e)}},hasMipmapFilter:function(){return this._minFilter===_.NEAREST_MIPMAP_NEAREST||this._minFilter===_.LINEAR_MIPMAP_NEAREST||this._minFilter===_.NEAREST_MIPMAP_LINEAR||this._minFilter===_.LINEAR_MIPMAP_LINEAR},applyTexImage2D:function(t){var e=Array.prototype.slice.call(arguments,1);t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,this._flipY),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._colorSpaceConversion),this._isCompressed?t.compressedTexImage2D.apply(t,e):t.texImage2D.apply(t,e);var r=this._applyTexImage2DCallbacks.length;if(r>0)for(var i=0,a=r;i<a;i++)this._applyTexImage2DCallbacks[i].call(this)},computeTextureFormat:function(){this._internalFormat?this._imageFormat=this._internalFormat:(this._internalFormat=this._imageFormat||_.RGBA,this._imageFormat=this._internalFormat)},applyImage:function(t){var e=this._getInternalFormatGL(),r=this._image||null,i=r&&this._image.getImage(),a=this._getTypeGL();this._isCompressed?this.applyTexImage2D(t,this._textureTarget,0,e,this._textureWidth,this._textureHeight,0,i):!i||r.isTypedArray()?this.applyTexImage2D(t,this._textureTarget,0,e,this._textureWidth,this._textureHeight,0,this._internalFormat,a,i):this.applyTexImage2D(t,this._textureTarget,0,e,this._internalFormat,a,i),r&&r.setDirty(!1)},apply:function(t){var e=t.getGraphicContext();if(this._dirtyTextureObject&&(this.releaseGLObjects(),this._dirtyTextureObject=!1,this.setGraphicContext(e)),void 0===this._textureObject||this.isDirty())if(this._textureNull)e.bindTexture(this._textureTarget,null);else{var r=this._image;if(void 0!==r)if(r.isReady()){this.computeTextureFormat();var i=r.getWidth()||this._textureWidth,a=r.getHeight()||this._textureHeight;this.setTextureSize(i,a),this._textureObject||this.init(t),this._textureObject.bind(e),this.applyImage(e),this.applyFilterParameter(e,this._textureTarget),this.generateMipmap(e,this._textureTarget),this._unrefImageDataAfterApply&&(this._image=void 0),this._dirty=!1}else e.bindTexture(this._textureTarget,null);else 0!==this._textureHeight&&0!==this._textureWidth&&(this.computeTextureFormat(),this._textureObject||this.init(t),this._textureObject.bind(e),this.applyImage(e),this.applyFilterParameter(e,this._textureTarget),this.generateMipmap(e,this._textureTarget),this._dirty=!1)}else this._textureObject.bind(e),void 0!==this._image&&this._image.isDirty()&&(this.applyImage(e),this.dirtyMipmap()),this.isDirtyMipmap()&&this.generateMipmap(e,this._textureTarget)},_getInternalFormatGL:function(){var t=this._internalFormat;if(!c.a.instance().isWebGL2())return g[t]||t;var e=p[this._type];return e&&e[t]||t},_getTypeGL:function(){return this._type!==_.HALF_FLOAT||c.a.instance().isWebGL2()?this._type:_.HALF_FLOAT_OES}})),"osg","Texture"),_.textureNull=new _,_.createFromImage=function(t,e){var r=new _;return r.setImage(t,e),r},_.createFromCanvas=function(t,e){return _.createFromImage(t,e)},e.default=_},function(t,e,r){"use strict";var i=r(0),a=r(5),n=r(24),s=r(40),o=r(17),h=r(3),u=r(1),c=r(25),l=r(48),d=r(12),_=function(){a.a.call(this),this.children=[],this._parents=[],this.nodeMask=-1,this._boundingSphere=new s.a,this._boundingSphereComputed=!1,this._boundingBox=new n.a,this._boundingBoxComputed=!1,this._updateCallbacks=[],this._cullCallback=void 0,this._cullingActive=!0,this._numChildrenWithCullingDisabled=0,this._numChildrenRequiringUpdateTraversal=0,this._tmpBox=new n.a},f=new c.a(u.c.create),g=function(){var t=f.getOrCreateObject();return u.c.identity(t)};i.a.createPrototypeNode(_,i.a.objectInherit(a.a.prototype,{getOrCreateStateSet:function(){return this.stateset||this.setStateSet(new o.a),this.stateset},getStateSet:function(){return this.stateset},accept:function(t){t.validNodeMask(this)&&(t.pushOntoNodePath(this),t.apply(this),t.popFromNodePath())},dirtyBound:function(){if(!0===this._boundingSphereComputed||!0===this._boundingBoxComputed){this._boundingSphereComputed=!1,this._boundingBoxComputed=!1;for(var t=this._parents,e=0,r=t.length;e<r;e++)t[e].dirtyBound()}},setNodeMask:function(t){this.nodeMask=t},getNodeMask:function(){return this.nodeMask},setStateSet:function(t){if(this.stateset!==t){var e=0;this.stateset&&(this.stateset.requiresUpdateTraversal()&&e--,this.stateset.removeParent(this)),t&&(t.addParent(this),t.requiresUpdateTraversal()&&++e),0!==e&&this.setNumChildrenRequiringUpdateTraversal(this.getNumChildrenRequiringUpdateTraversal()+e),this.stateset=t}},_updateNumChildrenRequeringUpdateTraversal:function(t){if(0===this._numChildrenRequiringUpdateTraversal&&this._parents.length)for(var e=0,r=this._parents.length;e<r;e++){var i=this._parents[e],a=i.getNumChildrenRequiringUpdateTraversal();i.setNumChildrenRequiringUpdateTraversal(a+t)}},setNumChildrenRequiringUpdateTraversal:function(t){if(this._numChildrenRequiringUpdateTraversal!==t){if(!this._updateCallbacks.length&&this._parents.length){var e=0;if(this._numChildrenRequiringUpdateTraversal>0&&--e,t>0&&++e,0!==e)for(var r=this._parents,i=0,a=r.length;i<a;i++){var n=r[i],s=n.getNumChildrenRequiringUpdateTraversal();n.setNumChildrenRequiringUpdateTraversal(s+e)}}this._numChildrenRequiringUpdateTraversal=t}},getNumChildrenRequiringUpdateTraversal:function(){return this._numChildrenRequiringUpdateTraversal},getUpdateCallback:function(){return this._updateCallbacks[0]},addUpdateCallback:function(t){var e=Boolean(this._updateCallbacks.length);this._updateCallbacks.push(t),e||this._updateNumChildrenRequeringUpdateTraversal(1)},removeUpdateCallback:function(t){var e=this._updateCallbacks.indexOf(t);-1!==e&&(this._updateCallbacks.splice(e,1),this._updateCallbacks.length||this._updateNumChildrenRequeringUpdateTraversal(-1))},getUpdateCallbackList:function(){return this._updateCallbacks},setCullCallback:function(t){this._cullCallback=t},getCullCallback:function(){return this._cullCallback},hasChild:function(t){for(var e=0,r=this.children.length;e<r;e++)if(this.children[e]===t)return!0;return!1},addChild:function(t){if(-1===this.children.indexOf(t))return this.children.push(t),t.addParent(this),this.dirtyBound(),(t.getNumChildrenRequiringUpdateTraversal()>0||t.getUpdateCallbackList().length)&&this.setNumChildrenRequiringUpdateTraversal(this.getNumChildrenRequiringUpdateTraversal()+1),(t.getNumChildrenWithCullingDisabled()>0||!1===t.getCullingActive())&&this.setNumChildrenWithCullingDisabled(this.getNumChildrenWithCullingDisabled()+1),t},getChildren:function(){return this.children},getNumChildren:function(){return this.children.length},getChild:function(t){return this.children[t]},getParents:function(){return this._parents},addParent:function(t){this._parents.push(t)},removeParent:function(t){var e=this._parents.indexOf(t);-1!==e&&this._parents.splice(e,1)},removeChildren:function(){var t=this.children,e=t.length;if(e){for(var r=0,i=0;i<e;i++){var a=t[i];a.removeParent(this),(a.getNumChildrenRequiringUpdateTraversal()>0||a.getUpdateCallbackList().length)&&++r}t.length=0,r&&this.setNumChildrenRequiringUpdateTraversal(this.getNumChildrenRequiringUpdateTraversal()-r),this.dirtyBound()}},removeChild:function(t){var e=this.children,r=e.indexOf(t);-1!==r&&(t.removeParent(this),e.splice(r,1),this.dirtyBound(),(t.getNumChildrenRequiringUpdateTraversal()>0||t.getUpdateCallbackList().length)&&this.setNumChildrenRequiringUpdateTraversal(this.getNumChildrenRequiringUpdateTraversal()-1))},traverse:function(t){for(var e=this.children,r=0,i=e.length;r<i;r++){e[r].accept(t)}},ascend:function(t){for(var e=this._parents,r=0,i=e.length;r<i;r++){e[r].accept(t)}},getBoundingBox:function(){return this._boundingBoxComputed||(this.computeBoundingBox(this._boundingBox),this._boundingBoxComputed=!0),this._boundingBox},computeBoundingBox:function(t){var e=r(60).default,i=e.instance=e.instance||new e;return i.setNodeMaskOverride(-1),i.reset(),i.apply(this),t.copy(i.getBoundingBox()),t},getBoundingSphere:function(){return this.getBound()},getBound:function(){return this._boundingSphereComputed||(this.computeBoundingSphere(this._boundingSphere),this._boundingSphereComputed=!0),this._boundingSphere},computeBoundingSphere:function(t){var e=this.children,r=e.length;if(t.init(),0===r)return t;var i,a,n=this._tmpBox;for(n.init(),a=0;a<r;a++)i=e[a],i.referenceFrame!==d.a.ABSOLUTE_RF&&n.expandByBoundingSphere(i.getBound());if(!n.valid())return t;for(t.set(n.center(t.center()),0),a=0;a<r;a++)i=e[a],i.referenceFrame!==d.a.ABSOLUTE_RF&&t.expandRadiusBySphere(i.getBound());return t},getWorldMatrices:function(){var t=function(){this.nodePaths=[],this.halt=void 0,h.a.call(this,h.a.TRAVERSE_PARENTS)};t.prototype=i.a.objectInherit(h.a.prototype,{reset:function(){this.nodePath.length=0,this.nodePaths.length=0},apply:function(t){0===t._parents.length||t===this.halt||t.referenceFrame===d.a.ABSOLUTE_RF?this.nodePaths.push(this.nodePath.slice(0)):this.traverse(t)}});var e=new t;return e.setNodeMaskOverride(-1),function(t,r){e.reset(),e.halt=t,this.accept(e);for(var i=[],a=r||u.c.create,n=0,s=e.nodePaths.length;n<s;n++){var o=e.nodePaths[n],h=a();0!==o.length&&l.a.computeLocalToWorld(o,!0,h),i.push(h)}return i}}(),getWorldMatrix:function(t,e){var r=this.getWorldMatrices(t,g);return 0===r.length?u.c.identity(e):u.c.copy(e,r[0]),f.reset(),e},setCullingActive:function(t){if(this._cullingActive!==t){if(0===this._numChildrenWithCullingDisabled&&this._parents.length>0){var e=0;if(this._cullingActive||--e,t||++e,0!==e)for(var r=0,i=this._parents.length;r<i;r++)this._parents[r].setNumChildrenWithCullingDisabled(this._parents[r].getNumChildrenWithCullingDisabled()+e)}this._cullingActive=t}},getCullingActive:function(){return this._cullingActive},isCullingActive:function(){return 0===this._numChildrenWithCullingDisabled&&this._cullingActive&&this.getBound().valid()},setNumChildrenWithCullingDisabled:function(t){if(this._numChildrenWithCullingDisabled!==t){if(this._cullingActive&&this._parents.length>0){var e=0;if(this._numChildrenWithCullingDisabled>0&&--e,t>0&&++e,0!==e)for(var r=0,i=this._parents.length;r<i;r++)this._parents[r].setNumChildrenWithCullingDisabled(this._parents[r].getNumChildrenWithCullingDisabled()+e)}this._numChildrenWithCullingDisabled=t}},getNumChildrenWithCullingDisabled:function(){return this._numChildrenWithCullingDisabled},releaseGLObjects:function(){void 0!==this.stateset&&this.stateset.releaseGLObjects()}}),"osg","Node"),e.a=_},function(t,e,r){"use strict";var i={};i.POINTS=0,i.LINES=1,i.LINE_LOOP=2,i.LINE_STRIP=3,i.TRIANGLES=4,i.TRIANGLE_STRIP=5,i.TRIANGLE_FAN=6,e.a=i},function(t,e,r){"use strict";var i={};i.SCENE="scene",i.MANIPULATORS="scene.manipulators",i.ORBIT_MANIPULATOR="scene.manipulators.orbit",i.ORBIT_MANIPULATOR_MOUSEKEYBOARD="scene.manipulators.orbit.mousekeyboard",i.ORBIT_MANIPULATOR_RESETTOHOME="scene.manipulators.orbit.mousekeyboard.home",i.ORBIT_MANIPULATOR_TOUCH="scene.manipulators.orbit.touch",i.ORBIT_MANIPULATOR_WEBVR="scene.manipulators.orbit.webvr",i.ORBIT_MANIPULATOR_DEVICEORIENTATION="scene.manipulators.orbit.deviceorientation",i.ORBIT_MANIPULATOR_GAMEPAD="scene.manipulators.orbit.gamepad",i.FPS_MANIPULATOR="scene.manipulators.fps",i.FPS_MANIPULATOR_MOUSEKEYBOARD="scene.manipulators.fps.mousekeyboard",i.FPS_MANIPULATOR_RESETTOHOME="scene.manipulators.fps.mousekeyboard.home",i.FPS_MANIPULATOR_TOUCH="scene.manipulators.fps.touch",i.FPS_MANIPULATOR_WEBVR="scene.manipulators.fps.webvr",i.FPS_MANIPULATOR_DEVICEORIENTATION="scene.manipulators.fps.deviceorientation",i.FPS_MANIPULATOR_GAMEPAD="scene.manipulators.fps.gamepad",i.CAD_MANIPULATOR="scene.manipulators.cad",i.CAD_MANIPULATOR_MOUSEKEYBOARD="scene.manipulators.cad.mousekeyboard",i.CAD_MANIPULATOR_RESETTOHOME="scene.manipulators.cad.mousekeyboard.home",i.CAD_MANIPULATOR_TOUCH="scene.manipulators.cad.touch",i.NODE_GIZMO="scene.nodegizmo",i.UI="ui",i.STATS="ui.stats",e.a=i},function(t,e,r){"use strict";var i=r(0),a=r(2),n=r(8),s=r(28),o=r(18),h=r(81),u=r(62),c=function(){n.a.call(this),this._attributes={},this._primitives=[],this._cacheDrawCall={},this._useVAO=void 0,this._vao={},this._cacheVertexAttributeBufferList={},this._shape=void 0};c.enableVAO=!0,i.a.createPrototypeNode(c,i.a.objectInherit(n.a.prototype,{releaseGLObjects:function(){void 0!==this.stateset&&this.stateset.releaseGLObjects();for(var t in this._attributes){this._attributes[t].releaseGLObjects()}for(var e=0,r=this._primitives.length;e<r;e++){var i=this._primitives[e];void 0!==i.getIndices&&void 0!==i.getIndices()&&null!==i.getIndices()&&i.indices.releaseGLObjects()}this.releaseVAO()},releaseVAO:function(){if(this._useVAO&&this._glContext)for(var t in this._vao)this._vao[t]&&(this._vao[t].releaseGLObjects(),this._vao[t]=void 0)},dirty:function(){this._cacheDrawCall={},this.releaseVAO()},getPrimitives:function(){return this.getPrimitiveSetList()},getAttributes:function(){return this.getVertexAttributeList()},getShape:function(){return this._shape},setShape:function(t){this._shape=t},getVertexAttributeList:function(){return this._attributes},getPrimitiveSetList:function(){return this._primitives},setVertexAttribArray:function(t,e){this._attributes[t]!==e&&(this._attributes[t]=e,this.dirty())},_generateVertexSetup:function(t,e,r){for(var i=["//generated by Geometry::implementation","state.lazyDisablingOfVertexAttributes();","var attr;"],a=0,n=t.length;a<n;a++)i.push("attr = this._attributes['"+t[a]+"'];"),i.push("if ( attr.BufferArrayProxy ) attr = attr.getBufferArray();"),i.push("if ( !attr.isValid() ) return;"),i.push("state.setVertexAttribArray("+e[a]+", attr, attr.getNormalize() );");return i.push("state.applyDisablingOfVertexAttributes();"),r&&i.push("state.setIndexArray( this._primitives[ 0 ].getIndices() );"),i},_generatePrimitives:function(t,e,r){var i=[e?"state.enableVertexColor();":"state.disableVertexColor();"];if(r)return i.concat(["var primitive = this._primitives[ "+t[0]+" ];","var indexes = primitive.getIndices();","if ( indexes.isDirty() ) {;","  indexes.bind( gl );","  indexes.compile( gl );","};","primitive.drawElements( state );"]);i.push("var primitives = this._primitives;");for(var a=0,n=t.length;a<n;a++)i.push("primitives["+t[a]+"].draw(state);");return i},generateDrawCommand:function(){var t=[],e=[];return function(r,i,a,n){var s=i._attributesCache,c=this.getVertexAttributeList();e.length=0,t.length=0;var l,d,_,f=this._useVAO,g=f?[]:void 0,p=!1;for(var m in s)if(l=s[m],void 0!==c[m]){var v=this._attributes[m];if(v instanceof h.a&&(v=v.getBufferArray(),f=!1),!v.isValid())return;f&&g.push(v),p||"Color"!==m||(p=!0),e.push(m),t.push(l)}var S,b;if(f){this._cacheVertexAttributeBufferList[a]=g;var x=1===n.length&&this._primitives[n[0]]instanceof o.a,y=this._generateVertexSetup(e,t,x);r.clearVertexAttribCache();var M=r.getGraphicContext(),T=new u.a(M);T.create(M),r.setVertexArrayObject(T),this._vao[a]=T;new Function("state",y.join("\n")).call(this,r);var A=["var gl = state.getGraphicContext();","var vao = this._vao[ "+a+" ] ","var hasChanged = state.setVertexArrayObject( vao );","if ( hasChanged ) {","  var vaList = this._cacheVertexAttributeBufferList[ "+a+" ];","  var va;"];for(d=0,_=g.length;d<_;d++)A.push("  va = vaList[ "+d+"];"),A.push("  if ( va.isDirty() ) {;"),A.push("    va.bind( gl );"),A.push("    va.compile( gl );"),A.push("  };");A.push("}"),S=A.concat(this._generatePrimitives(n,p,x)).join("\n"),b="GeometryDrawImplementationCacheVAO"}else S=this._generateVertexSetup(e,t,!1).concat(this._generatePrimitives(n,p,!1)).join("\n"),b="GeometryDrawImplementationCache";var C=new Function("state","return function "+b+"( state ) { "+S+"}")();return this._cacheDrawCall[a]=C,C}}(),_getValidPrimitives:function(){for(var t=[],e=0;e<this._primitives.length;e++){this._primitives[e].getCount()?t.push(e):this._warnInvalidPrimitives||(a.a.warn("geometry with instanceID "+this._instanceID+" has invalid primitives"),this._warnInvalidPrimitives=!0)}return t},drawImplementation:function(t){var e=t.getLastProgramApplied(),r=e.getInstanceID();t.drawGeometry(this);var i=this._cacheDrawCall[r];if(this._vao[r]?this._vao[r].isDirty()&&(i=void 0):t.setVertexArrayObject(null),i)return void i.call(this,t);if(!this._primitives.length)return void(this._warnNoPrimitives||(a.a.warn("geometry with instanceID "+this._instanceID+" has no primitives"),this._warnNoPrimitives=!0));var n=this._getValidPrimitives();n.length&&(void 0===this._useVAO&&c.enableVAO&&(this._useVAO=s.a.instance().hasVAO(),this._glContext=t.getGraphicContext()),i=this.generateDrawCommand(t,e,r,n),i.call(this,t),t.setVertexArrayObject(null))},setBound:function(t){this._boundingBox=t,this._boundingBoxComputed=!0},computeBoundingBox:function(t){t.init();var e=this.getVertexAttributeList().Vertex;if(e&&e.getElements()&&e.getItemSize()>2){for(var r=e.getElements(),i=e.getItemSize(),a=t.getMin(),n=t.getMax(),s=a[0],o=a[1],h=a[2],u=n[0],c=n[1],l=n[2],d=0,_=r.length;d<_;d+=i){var f=r[d],g=r[d+1],p=r[d+2];f<s&&(s=f),f>u&&(u=f),g<o&&(o=g),g>c&&(c=g),p<h&&(h=p),p>l&&(l=p)}a[0]=s,a[1]=o,a[2]=h,n[0]=u,n[1]=c,n[2]=l}return t},computeBoundingSphere:function(t){t.init();var e=this.getBoundingBox();return t.expandByBoundingBox(e),t}}),"osg","Geometry"),c.appendVertexAttributeToList=function(t,e,r){for(var i in t){var a=i;void 0!==r&&(a+="_"+r),e[a]=t[i]}},e.a=c},function(t,e,r){"use strict";e.a={RELATIVE_RF:0,ABSOLUTE_RF:1}},function(t,e,r){"use strict";var i=r(2),a=r(0),n=r(5),s=r(33),o=r(22),h=function(t){var e;return t instanceof a.a.Float32Array&&(e=5126),t instanceof a.a.Int16Array&&(e=5122),t instanceof a.a.Uint16Array&&(e=5123),t instanceof a.a.Int8Array&&(e=5120),t instanceof a.a.Uint8Array&&(e=5121),t instanceof a.a.Uint8ClampedArray&&(e=5121),t instanceof a.a.Int32Array&&(e=5124),t instanceof a.a.Uint32Array&&(e=5125),e},u=function(t,e,r){s.a.call(this),this._instanceID=n.a.getInstanceID(),this.dirty(),this._itemSize=r,this._target="string"==typeof t?u[t]:t,this._type=void 0,this._normalize=!1,e&&(void 0===e.byteLength&&(i.a.warn("BufferArray with non typedArray elements is deprecated"),e=this._target===u.ELEMENT_ARRAY_BUFFER?new a.a.Uint16Array(e):new a.a.Float32Array(e)),this.setElements(e)),this._usage=u.STATIC_DRAW};u.ELEMENT_ARRAY_BUFFER=34963,u.ARRAY_BUFFER=34962,u.STATIC_DRAW=35044,u.DYNAMIC_DRAW=35048,u.STREAM_DRAW=35040,u._sDeletedGLBufferArrayCache=new window.Map,u.deleteGLBufferArray=function(t,e){u._sDeletedGLBufferArrayCache.has(t)||u._sDeletedGLBufferArrayCache.set(t,[]),u._sDeletedGLBufferArrayCache.get(t).push(e)},u.flushDeletedGLBufferArrays=function(t,e){if(e<=0)return e;if(!u._sDeletedGLBufferArrayCache.has(t))return e;for(var r=0,i=o.a.instance().tick(),a=u._sDeletedGLBufferArrayCache.get(t),n=a.length,s=n-1;s>=0&&r<e;s--)t.deleteBuffer(a[s]),a.splice(s,1),r=o.a.instance().deltaS(i,o.a.instance().tick());return e-r},u.flushAllDeletedGLBufferArrays=function(t){if(u._sDeletedGLBufferArrayCache.has(t))for(var e=u._sDeletedGLBufferArrayCache.get(t),r=e.length,i=r-1;i>=0;i--)t.deleteBuffer(e[i]),e.splice(i,1)},u.onLostContext=function(t){if(u._sDeletedGLBufferArrayCache.has(t)){u._sDeletedGLBufferArrayCache.get(t).length=0}},a.a.createPrototypeObject(u,a.a.objectInherit(s.a.prototype,{setUsage:function(t){this._usage=t},getUsage:function(){return this._usage},getInstanceID:function(){return this._instanceID},setItemSize:function(t){this._itemSize=t},isValid:function(){return!!this._buffer||!(!this._elements||!this._elements.length)},invalidate:function(){this._buffer=void 0,this.dirty()},releaseGLObjects:function(){void 0!==this._buffer&&null!==this._buffer&&void 0!==this._gl&&(u.deleteGLBufferArray(this._gl,this._buffer),s.a.removeObject(this._gl,this)),this.invalidate()},setNormalize:function(t){this._normalize=t},getNormalize:function(){return this._normalize},bind:function(t){this._gl||this.setGraphicContext(t);var e=this._target,r=this._buffer;if(r)return void t.bindBuffer(e,r);!r&&this._elements.length>0&&(this._buffer=t.createBuffer(),this._numItems=this._elements.length/this._itemSize,t.bindBuffer(e,this._buffer))},getItemSize:function(){return this._itemSize},dirty:function(){this._dirty=!0},isDirty:function(){return this._dirty},compile:function(t){this._dirty&&(t.bufferData(this._target,this._elements,this._usage),this._dirty=!1)},getElements:function(){return this._elements},setElements:function(t){this._elements=t,this._type=h(t),this._dirty=!0},getType:function(){return this._type}}),"osg","BufferArray"),e.a=u},function(e,r){e.exports=t},function(t,e,r){"use strict";var i=r(0),a=r(23),n=r(49),s=r(1),o=r(7),h=r(12),u=function(){a.a.call(this),n.a.call(this),this.viewport=void 0,this._graphicContext=void 0,this._scissor=void 0,this.setClearColor(s.g.fromValues(0,0,0,1)),this.setClearDepth(1),this.setClearMask(u.COLOR_BUFFER_BIT|u.DEPTH_BUFFER_BIT),this.setViewMatrix(s.c.create()),this.setProjectionMatrix(s.c.create()),this.renderOrder=u.NESTED_RENDER,this.renderOrderNum=0,this._view=void 0,this._renderer=void 0,this._attachments={}};u.PRE_RENDER=0,u.NESTED_RENDER=1,u.POST_RENDER=2,u.COLOR_BUFFER_BIT=16384,u.DEPTH_BUFFER_BIT=256,u.STENCIL_BUFFER_BIT=1024,i.a.createPrototypeNode(u,i.a.objectInherit(n.a.prototype,i.a.objectInherit(a.a.prototype,{getView:function(){return this._view},setView:function(t){this._view=t},getRenderer:function(){return this._renderer},setRenderer:function(t){this._renderer=t},setFinalDrawCallback:function(t){this._finalDrawCallback=t},getFinalDrawCallback:function(){return this._finalDrawCallback},setInitialDrawCallback:function(t){this._initialDrawCallback=t},getInitialDrawCallback:function(){return this._initialDrawCallback},getAttachments:function(){return this._attachments},setGraphicContext:function(t){this._graphicContext=t},getGraphicContext:function(){return this._graphicContext},setClearDepth:function(t){this.clearDepth=t},getClearDepth:function(){return this.clearDepth},setClearMask:function(t){this.clearMask=t},getClearMask:function(){return this.clearMask},setClearColor:function(t){this.clearColor=t},getClearColor:function(){return this.clearColor},setViewport:function(t){this.viewport=t,this.getOrCreateStateSet().setAttributeAndModes(t)},getViewport:function(){return this.viewport},setScissor:function(t){this._scissor=t,this.getOrCreateStateSet().setAttributeAndModes(this._scissor)},getScissor:function(){return this._scissor},setViewMatrix:function(t){this.modelviewMatrix=t},setViewMatrixAsLookAt:function(t,e,r){s.c.lookAt(this.getViewMatrix(),t,e,r)},setProjectionMatrix:function(t){this.projectionMatrix=t},setProjectionMatrixAsOrtho:function(t,e,r,i,a,n){s.c.ortho(this.getProjectionMatrix(),t,e,r,i,a,n)},isRenderToTextureCamera:function(){return window.Object.keys(this._attachments).length>0},getViewMatrix:function(){return this.modelviewMatrix},getProjectionMatrix:function(){return this.projectionMatrix},getRenderOrder:function(){return this.renderOrder},setRenderOrder:function(t,e){this.renderOrder=t,this.renderOrderNum=e},getFrameBufferObject:function(){return this.frameBufferObject},setFrameBufferObject:function(t){this.frameBufferObject=t},detachAll:function(){this._attachments={},this.frameBufferObject&&this.frameBufferObject.dirty()},resetAttachments:function(){this.frameBufferObject&&(this.frameBufferObject.reset(),this.frameBufferObject=0),this._attachments={}},attachTexture:function(t,e,r){this.frameBufferObject&&this.frameBufferObject.dirty(),r||(r=o.default.TEXTURE_2D),this._attachments[t]={attachment:t,texture:e,textureTarget:r}},attachRenderBuffer:function(t,e){this.frameBufferObject&&this.frameBufferObject.dirty(),this._attachments[t]={format:e,attachment:t}},computeLocalToWorldMatrix:function(t){return this.referenceFrame===h.a.RELATIVE_RF?s.c.mul(t,t,this.modelviewMatrix):s.c.copy(t,this.modelviewMatrix),!0},computeWorldToLocalMatrix:function(){var t=s.c.create();return function(e){return s.c.invert(t,this.modelviewMatrix),this.referenceFrame===h.a.RELATIVE_RF?s.c.mul(e,t,e):s.c.copy(e,t),!0}}()})),"osg","Camera"),e.a=u},function(t,e,r){"use strict";var i=r(0),a=r(1),n=r(23),s=r(12),o=function(){n.a.call(this),this.matrix=a.c.create()};i.a.createPrototypeNode(o,i.a.objectInherit(n.a.prototype,{getMatrix:function(){return this.matrix},setMatrix:function(t){this.matrix=t,this.dirtyBound()},computeLocalToWorldMatrix:function(t){return this.referenceFrame===s.a.RELATIVE_RF?a.c.mul(t,t,this.matrix):a.c.copy(t,this.matrix),!0},computeWorldToLocalMatrix:function(){var t=a.c.create();return function(e){return a.c.invert(t,this.matrix),this.referenceFrame===s.a.RELATIVE_RF?a.c.mul(e,t,e):a.c.copy(e,t),!0}}()}),"osg","MatrixTransform"),e.a=o},function(t,e,r){"use strict";var i=r(5),a=r(4),n=r(0),s=function(){i.a.call(this),this._parents=[],this._attributeArray=[],this._textureAttributeArrayList=[],this._activeTextureAttributeUnit=[],this._activeAttribute=[],this._activeTextureAttribute=[],this._binName=void 0,this._binNumber=0,this._shaderGeneratorPair=null,this._updateCallbackList=[],this.uniforms={},this._hasUniform=!1,this._drawID=-1};s.AttributePair=function(t,e){this._object=t,this._value=e},s.AttributePair.prototype={getShaderGeneratorName:function(){return this._object},getAttribute:function(){return this._object},getUniform:function(){return this._object},getValue:function(){return this._value}},n.a.createPrototypeObject(s,n.a.objectInherit(i.a.prototype,{setDrawID:function(t){this._drawID=t},getDrawID:function(){return this._drawID},getAttributePair:function(t,e){return new s.AttributePair(t,e)},addUniform:function(t,e){var r=void 0!==e?e:a.a.ON,i=t.getName();this.uniforms[i]=this.getAttributePair(t,r),this._hasUniform=!0},addParent:function(t){this._parents.push(t)},removeParent:function(t){var e=this._parents.indexOf(t);-1!==e&&this._parents.splice(e,1)},removeUniform:function(t){this.removeUniformByName(t.getName())},removeUniformByName:function(t){delete this.uniforms[t],this._hasUniform=!!window.Object.keys(this.uniforms).length},hasUniform:function(){return this._hasUniform},getUniform:function(t){var e=this.uniforms;if(e[t])return e[t].getAttribute()},getUniformList:function(){return this.uniforms},setTextureAttributeAndModes:function(t,e,r){this._setTextureAttribute(t,this.getAttributePair(e,void 0!==r?r:a.a.ON))},getNumTextureAttributeLists:function(){return this._textureAttributeArrayList.length},getTextureAttribute:function(t,e){var r=n.a.getTextureIdFromTypeMember(e);if(void 0!==r&&this._hasTextureAttribute(t,r)){var i=this._textureAttributeArrayList[t];return i[r]?i[r].getAttribute():void 0}},removeTextureAttribute:function(t,e){var r=n.a.getTextureIdFromTypeMember(e);if(void 0!==r&&this._hasTextureAttribute(t,r)){this._textureAttributeArrayList[t][r]=void 0,this._computeValidTextureUnit()}},getAttribute:function(t){var e=n.a.getIdFromTypeMember(t);if(void 0!==e&&this._hasAttribute(e))return this._attributeArray[e].getAttribute()},setAttributeAndModes:function(t,e){this._setAttribute(this.getAttributePair(t,void 0!==e?e:a.a.ON))},setAttribute:function(t,e){this.setAttributeAndModes(t,e)},removeAttribute:function(t){var e=n.a.getIdFromTypeMember(t);this._hasAttribute(e)&&(this._attributeArray[e]=void 0,this._computeValidAttribute())},setRenderingHint:function(t){"OPAQUE_BIN"===t?this.setRenderBinDetails(0,"RenderBin"):"TRANSPARENT_BIN"===t?this.setRenderBinDetails(10,"DepthSortedBin"):this.setRenderBinDetails(0,"")},getUpdateCallbackList:function(){return this._updateCallbackList},removeUpdateCallback:function(t){var e=this._updateCallbackList.indexOf(t);if(-1!==e&&(this._updateCallbackList.splice(e,1),0===this._updateCallbackList.length))for(var r=this._parents,i=0,a=r.length;i<a;i++){var n=r[i];n.setNumChildrenRequiringUpdateTraversal(n.getNumChildrenRequiringUpdateTraversal()-1)}},requiresUpdateTraversal:function(){return!!this._updateCallbackList.length},addUpdateCallback:function(t){var e=Boolean(this._updateCallbackList.length);if(this._updateCallbackList.push(t),!e)for(var r=this._parents,i=0,a=r.length;i<a;i++){var n=r[i];n.setNumChildrenRequiringUpdateTraversal(n.getNumChildrenRequiringUpdateTraversal()+1)}},hasUpdateCallback:function(t){return-1!==this._updateCallbackList.indexOf(t)},setRenderBinDetails:function(t,e){this._binNumber=t,this._binName=e},getAttributeMap:function(){for(var t={},e=0,r=this._attributeArray.length;e<r;e++){var i=this._attributeArray[e];if(i){t[i.getAttribute().getTypeMember()]=i}}return t},getBinNumber:function(){return this._binNumber},getBinName:function(){return this._binName},setBinNumber:function(t){this._binNumber=t},setBinName:function(t){this._binName=t},getAttributeList:function(){for(var t=this._attributeArray,e=[],r=0,i=t.length;r<i;r++)t[r]&&e.push(t[r]);return e},setShaderGeneratorName:function(t,e){this._shaderGeneratorPair=this.getAttributePair(t,void 0!==e?e:a.a.ON)},getShaderGeneratorPair:function(){return this._shaderGeneratorPair},getShaderGeneratorName:function(){return this._shaderGeneratorPair?this._shaderGeneratorPair.getShaderGeneratorName():void 0},releaseGLObjects:function(){for(var t=0,e=this._textureAttributeArrayList.length;t<e;t++){var r=this.getTextureAttribute(t,"Texture");r&&r.releaseGLObjects()}for(var i=this.getAttributeList(),a=0,n=i.length;a<n;a++)i[a]._object.releaseGLObjects&&i[a]._object.releaseGLObjects()},_setTextureAttribute:function(t,e){n.a.arrayDense(t,this._textureAttributeArrayList),this._textureAttributeArrayList[t]||(this._textureAttributeArrayList[t]=[]);var r=n.a.getOrCreateTextureStateAttributeTypeMemberIndex(e.getAttribute());n.a.arrayDense(r,this._textureAttributeArrayList[t]),this._textureAttributeArrayList[t][r]=e,this._computeValidTextureUnit()},_computeValidTextureUnit:function(){this._activeTextureAttributeUnit.length=0,this._activeTextureAttribute.length=0;for(var t=this._textureAttributeArrayList,e=0,r=t.length;e<r;e++){var i=t[e];if(i&&i.length){for(var a=!1,n=0,s=i.length;n<s;n++)i[n]&&(a=!0,-1===this._activeTextureAttribute.indexOf(n)&&this._activeTextureAttribute.push(n));a&&this._activeTextureAttributeUnit.push(e)}}},_computeValidAttribute:function(){this._activeAttribute.length=0;for(var t=this._attributeArray,e=0,r=t.length;e<r;e++)t[e]&&this._activeAttribute.push(e)},_setAttribute:function(t){var e=n.a.getOrCreateStateAttributeTypeMemberIndex(t.getAttribute());n.a.arrayDense(e,this._attributeArray),this._attributeArray[e]=t,this._computeValidAttribute()},_hasAttribute:function(t){return!(t>=this._attributeArray.length)&&!!this._attributeArray[t]},_hasTextureAttribute:function(t,e){return!(t>=this._textureAttributeArrayList.length||!this._textureAttributeArrayList[t])&&(!(e>=this._textureAttributeArrayList[t].length)&&!!this._textureAttributeArrayList[t][e])}}),"osg","StateSet"),e.a=s},function(t,e,r){"use strict";var i=r(9),a=function(t,e){this.mode=i.a.POINTS,void 0!==t&&("string"==typeof t&&(t=i.a[t]),this.mode=t),this.count=0,this.offset=0,this.indices=e,this.uType=a.UNSIGNED_SHORT,void 0!==e&&this.setIndices(e)};a.UNSIGNED_BYTE=5121,a.UNSIGNED_SHORT=5123,a.UNSIGNED_INT=5125,a.prototype={getMode:function(){return this.mode},draw:function(t){0!==this.count&&(t.setIndexArray(this.indices),this.drawElements(t))},drawElements:function(t){t.getGraphicContext().drawElements(this.mode,this.count,this.uType,this.offset)},setIndices:function(t){this.indices=t;var e=t.getElements();this.count=e.length;var r=e.BYTES_PER_ELEMENT;1===r?this.uType=a.UNSIGNED_BYTE:2===r?this.uType=a.UNSIGNED_SHORT:4===r&&(this.uType=a.UNSIGNED_INT)},getIndices:function(){return this.indices},setFirst:function(t){this.offset=t},getFirst:function(){return this.offset},setCount:function(t){this.count=t},getCount:function(){return this.count},getNumIndices:function(){return this.indices.getElements().length},index:function(t){return this.indices.getElements()[t]}},e.a=a},function(t,e,r){"use strict";var i=function(){this._pool=[],this._length=0};i.prototype={clean:function(){this._length=0,this._pool.length=0},reset:function(){this._length=0},getLength:function(){return this._length},getArray:function(){return this._pool},back:function(){return this._pool[this._length-1]},pop:function(){return this._length--,this._pool[this._length]},push:function(t){this._length===this._pool.length?this._pool.push(t):this._pool[this._length]=t,this._length++},forEach:function(t){for(var e=0;e<this._length;e++)t(this._pool[e])}},e.a=i},function(t,e,r){"use strict";var i=r(9),a=function(t,e,r){this.mode=t,void 0!==t&&("string"==typeof t&&(t=i.a[t]),this.mode=t),this.first=e,this.count=r};a.prototype={draw:function(t){if(0!==this.count){t.getGraphicContext().drawArrays(this.mode,this.first,this.count)}},getMode:function(){return this.mode},setCount:function(t){this.count=t},getCount:function(){return this.count},setFirst:function(t){this.first=t},getFirst:function(){return this.first},getNumIndices:function(){return this.count},index:function(t){return this.first+t}},e.a=a},function(t,e,r){"use strict";var i,a=r(0),n=r(2),s=r(61),o=r(33),h=r(4),u=r(68),c=r(22),l=s.a.getOptionsURL().shaderStats?{}:void 0,d=s.a.getOptionsURL().syncCompile,_=new Uint8Array(4),f=function(t){t.flush(),t.finish(),t.readPixels(0,0,1,1,t.RGBA,t.UNSIGNED_BYTE,_)},g=new u.a,p=/uniform\s+\w+\s+(\w+)((\s)?\[(.*?)\])?/g,m=/(in|attribute)\s+\w+\s+(\w+)\s*;/g,v=function(t){for(var e,r,i={};null!==(e=m.exec(t));)r=e[2],i[r]=!0;return i},S=function(t){for(var e,r={};null!==(e=p.exec(t));){r[e[1]]=!0}return r},b=function(t,e){o.a.call(this),h.a.call(this),this._program=null,this._nullProgram=!0,this._vertex=void 0,this._fragment=void 0,this._uniformsCache=void 0,this._attributesCache=void 0,this._activeUniforms=void 0,this._foreignUniforms=void 0,this._trackAttributes=void 0,this._asyncCompilation=void 0,this._compileClean=void 0,t&&this.setVertexShader(t),e&&this.setFragmentShader(e),this._dirty=!0};b._sDeletedGLProgramCache=new window.Map,b.deleteGLProgram=function(t,e){b._sDeletedGLProgramCache.has(t)||b._sDeletedGLProgramCache.set(t,[]),b._sDeletedGLProgramCache.get(t).push(e)},b.flushDeletedGLPrograms=function(t,e){if(e<=0)return e;if(!b._sDeletedGLProgramCache.has(t))return e;for(var r=0,i=c.a.instance().tick(),a=b._sDeletedGLProgramCache.get(t),n=a.length,s=n-1;s>=0&&r<e;s--)t.deleteProgram(a[s]),a.splice(s,1),r=c.a.instance().deltaS(i,c.a.instance().tick());return e-r},b.flushAllDeletedGLPrograms=function(t){if(b._sDeletedGLProgramCache.has(t))for(var e=b._sDeletedGLProgramCache.get(t),r=e.length,i=r-1;i>=0;i--)t.deleteProgram(e[i]),e.splice(i,1)},b.onLostContext=function(t){if(b._sDeletedGLProgramCache.has(t)){b._sDeletedGLProgramCache.get(t).length=0}},a.a.createPrototypeStateAttribute(b,a.a.objectInherit(o.a.prototype,a.a.objectInherit(h.a.prototype,{attributeType:"Program",cloneType:function(){return new b},setVertexShader:function(t){this._vertex=t,this._nullProgram=!1,t.setText(g.processShader(t.getText()))},setFragmentShader:function(t){this._fragment=t,this._nullProgram=!1,t.setText(g.processShader(t.getText()))},getVertexShader:function(){return this._vertex},getFragmentShader:function(){return this._fragment},getProgram:function(){return this._program},setActiveUniforms:function(t){this._activeUniforms=t},getActiveUniforms:function(){return this._activeUniforms},setForeignUniforms:function(t){this._foreignUniforms=t},getForeignUniforms:function(){return this._foreignUniforms},setUniformsCache:function(t){this._uniformsCache=t},getUniformsCache:function(){return this._uniformsCache},setAttributesCache:function(t){this._attributesCache=t},getAttributesCache:function(){return this._attributesCache},setTrackAttributes:function(t){this._trackAttributes=t},getTrackAttributes:function(){return this._trackAttributes},releaseGLObjects:function(){void 0!==this._vertex&&this._vertex.releaseGLObjects(),void 0!==this._fragment&&this._fragment.releaseGLObjects(),null!==this._program&&(void 0!==this._gl&&(b.deleteGLProgram(this._gl,this._program),o.a.removeObject(this._gl,this)),this.invalidate())},dirty:function(){this._program=void 0},invalidate:function(){this._cacheUniformId=void 0,this._uniformsCache=void 0,this._attributesCache=void 0,this._foreignUniforms=void 0,this._trackAttributes=void 0,this._compileClean=void 0,this._program=void 0},_rebuildProgramFromSpector:function(t,e,r,i){this._dirty=!0,this._vertex.invalidate(),this._fragment.invalidate(),this.invalidate(),this._vertex.setText(t),this._fragment.setText(e),this._program=null,this._spectorOnCompiled=r,this._spectorOnError=i,this._compileClean=void 0},_onErrorToSpector:function(t){return!!this._spectorOnError&&(this._spectorOnError(t),!0)},_onCompilationToSpector:function(){this._spectorOnCompiled&&this._spectorOnCompiled(this._program)},_bindProgramToSpector:function(){window&&window.spector&&!this._program.__SPECTOR_rebuildProgram&&(this._program.__SPECTOR_rebuildProgram=this._rebuildProgramFromSpector.bind(this))},_logDebugShaders:function(t,e){if("Failed to create D3D shaders.\n"===e){var r=void 0!==t.rawgl?t.rawgl:t;void 0!==r&&void 0===r.getExtension&&(r=r.getExtension("WEBGL_debug_shaders"))&&(n.a.error(r.getTranslatedShaderSource(this._vertex.shader)),n.a.error(r.getTranslatedShaderSource(this._fragment.shader)))}},_activateFailSafe:function(t){var e=t.createProgram();this._vertex.failSafe(t,this._vertex.getText()),this._fragment.failSafe(t,this._fragment.getText()),this._glAttachAndLink(t,e,this._vertex,this._fragment),n.a.warn("FailSafe shader Activated "),this._program=e},_glAttachAndLink:function(t,e,r,i){t.attachShader(e,r.shader),t.attachShader(e,i.shader),t.linkProgram(e)},_glShaderCompile:function(t,e){e.shader||(l&&(e===this._vertex?l.vert=c.a.tick():l.frag=c.a.tick()),e.compile(t,i))},_glShaderCompilationResult:function(t,e){var r=e.getCompilationResult(t,i);return l&&(void 0===this._asyncCompilation&&f(t),e===this._vertex?l.vert=c.a.tick()-l.vert:l.frag=c.a.tick()-l.frag),r},compile:function(){var t=this._gl,e=this._fragment.getText(),r=this._vertex.getText();this._attributeMap=v(r),this._uniformMap=S(e+"\n"+r),this._glShaderCompile(t,this._vertex),this._glShaderCompile(t,this._fragment)},getShaderName:function(){if(this._shaderName)return this._shaderName;if(this._fragment&&this._fragment.getText()){var t=this._fragment.getText().match(/^#define\s+SHADER_NAME\s+(.*)$/m);return this._shaderName=t&&t[1]?t[1]:"",this._shaderName}},getCompilationResultAndLink:function(t){return!!this._compileClean||(l&&(l.vert=0,l.frag=0,l.link=0,l.total=0,void 0===this._asyncCompilation&&f(t),l.total=c.a.tick(),n.a.log(this.getShaderName()+" start"),n.a.timeStamp(this.getShaderName()+" start")),this._compileClean=this._glShaderCompilationResult(t,this._vertex),this._compileClean=this._glShaderCompilationResult(t,this._fragment)&&this._compileClean,l&&(n.a.log(this.getShaderName()+" compilation"),n.a.timeStamp(this.getShaderName()+" compilation")),!!this._compileClean&&(this._program=t.createProgram(),this._attributeMap.Vertex&&t.bindAttribLocation(this._program,0,"Vertex"),this._glAttachAndLink(t,this._program,this._vertex,this._fragment),!0))},getAsyncCompiling:function(){return this._asyncCompilation},_logShaderStats:function(t){if(void 0===this._asyncCompilation&&f(t),l.link=c.a.tick()-l.link,l.link){l.total=c.a.tick()-l.total,this._placeHolder&&(l.total=l.vert+l.frag+l.link);var e=(this._placeHolder?"Async":"")+this.getShaderName()+" - "+l.total.toFixed(2)+"ms";n.a.group(e),n.a.log("vertex : "+l.vert.toFixed(2)+"ms"),n.a.log("fragment : "+l.frag.toFixed(2)+"ms"),n.a.log("link : "+l.link.toFixed(2)+"ms"),n.a.log("total : "+l.total.toFixed(2)+"ms"),n.a.groupEnd(e)}},getLinkResult:function(t){if(this._compileClean){l&&(l.link=c.a.tick(),n.a.log(this.getShaderName()+" link"),n.a.timeStamp(this.getShaderName()+" link"));var e=t.getProgramParameter(this._program,t.LINK_STATUS);if(l&&this._logShaderStats(t),e||t.isContextLost())this._onCompilationToSpector(this._program);else{var r=t.getProgramInfoLog(this._program);if(n.a.errorFold(r,"can't link program\nvertex shader:\n"+this._vertex.text+"\n fragment shader:\n"+this._fragment.text),this._logDebugShaders(t,r),i&&i(this._vertex.text,this._fragment.text,r),this._compileClean=!1,this._onErrorToSpector(r))return}}return this._dirty=!1,this._asyncCompilation=-1,this._placeHolder=void 0,this._uniformsCache={},this._attributesCache={},this._compileClean?(this.cacheAttributeList(t,window.Object.keys(this._attributeMap)),this.cacheUniformList(t,window.Object.keys(this._uniformMap))):this._activateFailSafe(t),this._bindProgramToSpector(),this._compileClean},enableAsyncCompilation:function(t,e){this._placeHolder=t,this._asyncCompilation=e},apply:function(t){if(!this._nullProgram){if(this._gl||this.setGraphicContext(t.getGraphicContext()),this._program&&!this._dirty)return void t.applyProgram(this._program);if(this._placeHolder)return void this._placeHolder.apply(t);if(this.compile(),d||-1===this._fragment.getText().indexOf("#pragma compilationAsync"))return this.getCompilationResultAndLink(this._gl),this.getLinkResult(this._gl),t.applyProgram(this._program),void(this._dirty=!1);this._asyncCompilation=1}},cacheUniformList:function(t,e){for(var r=this._uniformsCache,i=0,a=e.length;i<a;i++){var n=e[i],s=t.getUniformLocation(this._program,n);void 0!==s&&null!==s&&void 0===r[n]&&(r[n]=s)}},cacheAttributeList:function(t,e){for(var r=this._attributesCache,i=0,a=e.length;i<a;i++){var n=e[i],s=t.getAttribLocation(this._program,n);-1!==s&&void 0!==s&&void 0===r[n]&&(r[n]=s)}}})),"osg","Program"),b.registerErrorCallback=function(t){i=t},e.a=b},function(t,e,r){"use strict";(function(t){var r=function(){var e=window||t;if(void 0===e.performance)return function(){return Date.now()};var r=e.performance.now||e.performance.mozNow||e.performance.msNow||e.performance.oNow||e.performance.webkitNow||function(){return Date.now()};return function(){return r.apply(e.performance,arguments)}}(),i=function(){};i.instance=function(){return i._instance||(i._instance=new i),i._instance},i.tick=r,i.prototype={deltaS:function(t,e){return(e-t)/1e3},deltaM:function(t,e){return e-t},tick:function(){return r()}},e.a=i}).call(e,r(178))},function(t,e,r){"use strict";var i=r(0),a=r(8),n=r(1),s=r(12),o=function(){a.a.call(this),this.referenceFrame=s.a.RELATIVE_RF};i.a.createPrototypeNode(o,i.a.objectInherit(a.a.prototype,{setReferenceFrame:function(t){this.referenceFrame=t},getReferenceFrame:function(){return this.referenceFrame},computeBoundingSphere:function(){var t=n.c.create();return function(e){return a.a.prototype.computeBoundingSphere.call(this,e),e.valid()?(n.c.identity(t),this.computeLocalToWorldMatrix(t),e.transformMat4(e,t),e):e}}()}),"osg","Transform"),e.a=o},function(t,e,r){"use strict";var i=r(2),a=r(0),n=r(1),s=function(){this._min=n.f.create(),this._max=n.f.create(),this.init()};a.a.createPrototypeObject(s,{init:function(){n.f.copy(this._min,n.f.INFINITY),n.f.copy(this._max,n.f.NEGATIVE_INFINITY)},volume:function(){var t=this._max[0]-this._min[0];return t*=this._max[1]-this._min[1],t*=this._max[2]-this._min[2]},copy:function(t){n.f.copy(this._min,t._min),n.f.copy(this._max,t._max)},valid:function(){return this._max[0]>=this._min[0]&&this._max[1]>=this._min[1]&&this._max[2]>=this._min[2]},expandByBoundingSphere:function(t){if(t.valid()){var e=this._max,r=this._min,i=t._radius,a=t._center[0],n=t._center[1],s=t._center[2];r[0]=Math.min(r[0],a-i),r[1]=Math.min(r[1],n-i),r[2]=Math.min(r[2],s-i),e[0]=Math.max(e[0],a+i),e[1]=Math.max(e[1],n+i),e[2]=Math.max(e[2],s+i)}},expandByvec3:function(t){i.a.warn("deprecated, use expandByVec3"),this.expandByVec3(t)},expandByVec3:function(t){var e=this._min,r=this._max;e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),r[0]=Math.max(r[0],t[0]),r[1]=Math.max(r[1],t[1]),r[2]=Math.max(r[2],t[2])},expandByBoundingBox:function(t){if(t.valid()){var e=this._min,r=this._max,i=t._min,a=t._max;i[0]<e[0]&&(e[0]=i[0]),a[0]>r[0]&&(r[0]=a[0]),i[1]<e[1]&&(e[1]=i[1]),a[1]>r[1]&&(r[1]=a[1]),i[2]<e[2]&&(e[2]=i[2]),a[2]>r[2]&&(r[2]=a[2])}},center:function(t){var e=this._min,r=this._max;return t[0]=.5*(e[0]+r[0]),t[1]=.5*(e[1]+r[1]),t[2]=.5*(e[2]+r[2]),t},radius:function(){return Math.sqrt(this.radius2())},radius2:function(){var t=this._min,e=this._max,r=e[0]-t[0],i=e[1]-t[1],a=e[2]-t[2];return.25*(r*r+i*i+a*a)},getMin:function(){return this._min},getMax:function(){return this._max},setMin:function(t){return n.f.copy(this._min,t),this},setMax:function(t){return n.f.copy(this._max,t),this},xMax:function(){return this._max[0]},yMax:function(){return this._max[1]},zMax:function(){return this._max[2]},xMin:function(){return this._min[0]},yMin:function(){return this._min[1]},zMin:function(){return this._min[2]},corner:function(t,e){return e[0]=1&t?this._max[0]:this._min[0],e[1]=2&t?this._max[1]:this._min[1],e[2]=4&t?this._max[2]:this._min[2],e},transformMat4:function(){var t=n.f.create(),e=n.f.create();return function(r,i){var a=this.getMin(),s=this.getMax();n.c.getTranslation(t,i),n.f.copy(e,t);for(var o=0;o<3;++o)for(var h=4*o,u=a[o],c=s[o],l=0;l<3;++l){var d=i[h+l],_=d*c,f=d*u;_<f?(t[l]+=_,e[l]+=f):(t[l]+=f,e[l]+=_)}var g=r.getMax(),p=r.getMin();return g[0]=e[0],g[1]=e[1],g[2]=e[2],p[0]=t[0],p[1]=t[1],p[2]=t[2],r}}()},"osg","BoundingBox"),e.a=s},function(t,e,r){"use strict";var i=function(t){this._createFunction=t,this._pool=[],this._length=0};i.prototype={clean:function(){this._pool.length=0,this._length=0},getLength:function(){return this._length},reset:function(){this._length=0},getOrCreateObject:function(){var t;return this._length===this._pool.length?(t=this._createFunction(),this._pool.push(t)):t=this._pool[this._length],this._length++,t},forEach:function(t){for(var e=0;e<this._length;e++)t(this._pool[e])}},e.a=i},function(t,e,r){"use strict";var i=r(2),a=r(0),n=r(22),s=r(33),o=function(t,e){s.a.call(this);var r=t;"string"==typeof t&&(r=o[t]),this.type=r,this.setText(e)};o.VERTEX_SHADER=35633,o.FRAGMENT_SHADER=35632;o.VS_DBG="#define _DEBUG 1\n#ifdef _DEBUG\nattribute vec3 Vertex;uniform mat4 uModelViewMatrix;uniform mat4 uProjectionMatrix;void main(void) {  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex, 1.0);}\n",o.FS_DBG="#define _DEBUG 1\n#ifdef _DEBUG\n precision lowp float; void main(void) { gl_FragColor = vec4(1.0, 0.6, 0.6, 1.0);}\n",o._sDeletedGLShaderCache=new window.Map,o.deleteGLShader=function(t,e){o._sDeletedGLShaderCache.has(t)||o._sDeletedGLShaderCache.set(t,[]),o._sDeletedGLShaderCache.get(t).push(e)},o.flushDeletedGLShaders=function(t,e){if(e<=0)return e;if(!o._sDeletedGLShaderCache.has(t))return e;for(var r=0,i=n.a.instance().tick(),a=o._sDeletedGLShaderCache.get(t),s=a.length,h=s-1;h>=0&&r<e;h--)t.deleteShader(a[h]),a.splice(h,1),r=n.a.instance().deltaS(i,n.a.instance().tick());return e-r},o.flushAllDeletedGLShaders=function(t){if(o._sDeletedGLShaderCache.has(t))for(var e=o._sDeletedGLShaderCache.get(t),r=e.length,i=r-1;i>=0;i--)t.deleteShader(e[i]),e.splice(i,1)},o.onLostContext=function(t){if(o._sDeletedGLShaderCache.has(t)){o._sDeletedGLShaderCache.get(t).length=0}},a.a.createPrototypeObject(o,a.a.objectInherit(s.a.prototype,{setText:function(t){this.text=t},getText:function(){return this.text},failSafe:function(t,e){this.shader=t.createShader(this.type);var r=e.match(/#define[\s]+SHADER_NAME[\s]+([\S]+)(\n|$)/);r=r?r[1]:"";var i=this.type===o.VERTEX_SHADER?o.VS_DBG:o.FS_DBG;i+="\n#define SHADER_NAME FailSafe"+r+"\n#else\n"+e+"\n#endif\n",t.shaderSource(this.shader,i),t.compileShader(this.shader)},processErrors:function(t,e){var r=/ERROR: [\d]+:([\d]+): (.+)/gim,a=e.split("\n"),n=a.length;if(0!==n){var s,o;if(null===r.exec(t)&&(r=/Shader compilation errors\n\((\d+)\, \d+\): (.+)/gim),null===r.exec(t))return void i.a.error(t);for(r.lastIndex=0;null!==(o=r.exec(t));){o.index===r.lastIndex&&r.lastIndex++;var h=parseInt(o[1],10);if(!(h>n)){i.a.error("ERROR "+o[2]+" in line "+h);var u=Math.max(0,h-7),c=Math.max(0,h-2);for(s=u;s<=c;s++)i.a.warn(a[s].replace(/^[ \t]+/g,""));for(c=Math.max(0,h-1),i.a.error(a[c].replace(/^[ \t]+/g,"")),u=Math.min(n,h),c=Math.min(n,h+5),s=u;s<c;s++)i.a.warn(a[s].replace(/^[ \t]+/g,""))}}}},compile:function(t){this._gl||this.setGraphicContext(t),this.shader=t.createShader(this.type),t.shaderSource(this.shader,this.text),t.compileShader(this.shader)},getCompilationResult:function(t,e){if(!t.getShaderParameter(this.shader,t.COMPILE_STATUS)&&!t.isContextLost()){var r=t.getShaderInfoLog(this.shader);this.processErrors(r,this.text);for(var a=this.text.split("\n"),n="\n",s=0,o=a.length;s<o;++s)n+=s+" "+a[s]+"\n";return i.a.errorFold("can't compile shader",n),e&&e(this.text,n,r),!1}return!0},releaseGLObjects:function(){void 0!==this._gl&&(o.deleteGLShader(this._gl,this.shader),s.a.removeObject(this._gl,this)),this.invalidate()},invalidate:function(){this.shader=void 0}}),"osg","Shader"),e.a=o},function(t,e){var r={};r.EPSILON=1e-6,r.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,r.RANDOM=Math.random,r.ENABLE_SIMD=!1,r.SIMD_AVAILABLE=r.ARRAY_TYPE===Float32Array&&"SIMD"in this,r.USE_SIMD=r.ENABLE_SIMD&&r.SIMD_AVAILABLE,r.setMatrixArrayType=function(t){r.ARRAY_TYPE=t};var i=Math.PI/180;r.toRadian=function(t){return t*i},r.equals=function(t,e){return Math.abs(t-e)<=r.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))},t.exports=r},function(t,e,r){"use strict";var i,a=r(2),n=r(107),s=r(61),o=function(){i||(i=r(7).default),this._checkRTT={},this._webGLExtensions={},this._webGLParameters={},this._webGLShaderMaxInt="NONE",this._webGLShaderMaxFloat="NONE",this._bugsDB={},this._webGLPlatforms={},this._webGLParameters.MAX_COMBINED_TEXTURE_IMAGE_UNITS=8,this._webGLParameters.MAX_CUBE_MAP_TEXTURE_SIZE=16,this._webGLParameters.MAX_FRAGMENT_UNIFORM_VECTORS=16,this._webGLParameters.MAX_RENDERBUFFER_SIZE=1,this._webGLParameters.MAX_TEXTURE_IMAGE_UNITS=8,this._webGLParameters.MAX_TEXTURE_SIZE=64,this._webGLParameters.MAX_VARYING_VECTORS=8,this._webGLParameters.MAX_VERTEX_ATTRIBS=8,this._webGLParameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS=0,this._webGLParameters.MAX_VERTEX_UNIFORM_VECTORS=128,this._webGLParameters.MAX_VIEWPORT_DIMS=[1,1],this._webGLParameters.NUM_COMPRESSED_TEXTURE_FORMATS=0,this._webGLParameters.MAX_SHADER_PRECISION_FLOAT="none",this._webGLParameters.MAX_SHADER_PRECISION_INT="none",this._gl=void 0};o.instance=function(t,e){if(!o._instance){var r,i=t;if(!i){"undefined"!=typeof window&&window.gli&&(r=window.gli.host.inspectContext,window.gli.host.inspectContext=!1);var h=document.createElement("canvas");h.width=32,h.height=32;var u=new s.a;u.extend({antialias:!1}),u.extendWithOptionsURL(),i=n.a.setupWebGL(h,u,function(){})}o._instance=new o,i?o._instance.init(i):a.a.warn("no support for webgl context detected."),r&&(window.gli.host.inspectContext=r)}return t&&(e||t!==o._instance.getContext())&&o._instance.initContextDependant(t),o._instance},o.prototype={getContext:function(){return this._gl},initContextDependant:function(t){this._gl=t,this._isGL2=void 0!==window.WebGL2RenderingContext&&t instanceof window.WebGL2RenderingContext,this.initWebGLExtensions(t),this.hasLinearHalfFloatRTT(t),this.hasLinearFloatRTT(t),this.hasHalfFloatRTT(t),this.hasFloatRTT(t)},init:function(t){if(this.initWebGLParameters(t),this.initPlatformSupport(),this.initBugDB(t),this.initContextDependant(t),this._isGL2)for(var e=["OES_element_index_uint","EXT_sRGB","EXT_blend_minmax","EXT_frag_depth","WEBGL_depth_texture","EXT_shader_texture_lod","OES_standard_derivatives","OES_texture_float","OES_texture_half_float","OES_texture_half_float_linear","OES_texture_float_linear","OES_vertex_array_object","WEBGL_draw_buffers","OES_fbo_render_mipmap","ANGLE_instanced_arrays"],r=o._instance.getWebGLExtensions(),i=function(){},a=0,n=e.length;a<n;a++)r[e[a]]=i},isWebGL2:function(){return this._isGL2},initBugDB:function(t){var e=this._webGLPlatforms,r=this._webGLParameters;if(e.Apple&&(r.UNMASKED_VENDOR_WEBGL&&-1===r.UNMASKED_VENDOR_WEBGL.indexOf("Intel")||(this._bugsDB.OES_standard_derivatives=!0)),t.getExtension("EXT_shader_texture_lod")){var i={type:"FRAGMENT_SHADER",text:["#version 100","#extension GL_EXT_shader_texture_lod : require","#ifdef GL_FRAGMENT_PRECISION_HIGH","  precision highp float;","#else"," precision mediump float;","#endif","uniform samplerCube uT0;","varying vec3 vC;","void main(void) {","  gl_FragColor = textureCubeLodEXT(uT0, vC, 1.0);","}"].join("\n")};this.checkShader(t,i.type,i.text)||(this._bugsDB.EXT_shader_texture_lod=!0)}},checkShader:function(t,e,r){var i=e;"string"==typeof i&&(i=t[e]);var n=t.createShader(i);return t.shaderSource(n,r),t.compileShader(n),!(!t.getShaderParameter(n,t.COMPILE_STATUS)&&!t.isContextLost())||(a.a.warn(t.getShaderInfoLog(n)),!1)},initPlatformSupport:function(){var t=this._webGLPlatforms;t.Apple=-1!==navigator.vendor.indexOf("Apple")||-1!==navigator.vendor.indexOf("OS X"),t.Mobile=/Mobi/.test(navigator.userAgent)||/ablet/.test(navigator.userAgent)},getWebGLPlatform:function(t){return this._webGLPlatforms[t]},getWebGLPlatforms:function(){return this._webGLPlatforms},getWebGLParameter:function(t){return this._webGLParameters[t]},getWebGLParameters:function(){return this._webGLParameters},getShaderMaxPrecisionFloat:function(){return this._webGLParameters.MAX_SHADER_PRECISION_FLOAT},getShaderMaxPrecisionInt:function(){return this._webGLParameters.MAX_SHADER_PRECISION_INT},checkSupportRTT:function(t,e,r){var i=e+","+r;if(this._isGL2)return!!this._webGLExtensions.EXT_color_buffer_float;if(void 0!==this._checkRTT[i])return this._checkRTT[i];if(!t)return!1;var a=t.createTexture();t.bindTexture(t.TEXTURE_2D,a),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,2,2,0,t.RGBA,e,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,r);var n=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,a,0);var s=this._checkRTT[i]=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.deleteTexture(a),t.deleteFramebuffer(n),t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),s},hasLinearHalfFloatRTT:function(t){return this._webGLExtensions.OES_texture_half_float_linear&&this.checkSupportRTT(t,i.HALF_FLOAT_OES,i.LINEAR)},hasLinearFloatRTT:function(t){return this._webGLExtensions.OES_texture_float_linear&&this.checkSupportRTT(t,i.FLOAT,i.LINEAR)},hasHalfFloatRTT:function(t){return this._webGLExtensions.OES_texture_half_float&&this.checkSupportRTT(t,i.HALF_FLOAT_OES,i.NEAREST)},hasFloatRTT:function(t){return this._webGLExtensions.OES_texture_float&&this.checkSupportRTT(t,i.FLOAT,i.NEAREST)},queryPrecision:function(t,e,r){var i=t.getShaderPrecisionFormat(e,r);return!!i&&0!==i.precision},hasVAO:function(){return!!this._webGLExtensions.OES_vertex_array_object},getDisjointTimerQuery:function(){return this._webGLExtensions.EXT_disjoint_timer_query_webgl2||this._webGLExtensions.EXT_disjoint_timer_query},initWebGLParameters:function(t){if(t){for(var e=["MAX_COMBINED_TEXTURE_IMAGE_UNITS","MAX_CUBE_MAP_TEXTURE_SIZE","MAX_FRAGMENT_UNIFORM_VECTORS","MAX_RENDERBUFFER_SIZE","MAX_TEXTURE_IMAGE_UNITS","MAX_TEXTURE_SIZE","MAX_VARYING_VECTORS","MAX_VERTEX_ATTRIBS","MAX_VERTEX_TEXTURE_IMAGE_UNITS","MAX_VERTEX_UNIFORM_VECTORS","MAX_VIEWPORT_DIMS","SHADING_LANGUAGE_VERSION","VERSION","VENDOR","RENDERER","ALIASED_LINE_WIDTH_RANGE","ALIASED_POINT_SIZE_RANGE","RED_BITS","GREEN_BITS","BLUE_BITS","ALPHA_BITS","DEPTH_BITS","STENCIL_BITS"],r=this._webGLParameters,i=0,a=e.length;i<a;++i){var n=e[i];r[n]=t.getParameter(t[n])}this.queryPrecision(t,t.FRAGMENT_SHADER,t.HIGH_FLOAT)?r.MAX_SHADER_PRECISION_FLOAT="high":this.queryPrecision(t,t.FRAGMENT_SHADER,t.MEDIUM_FLOAT)?r.MAX_SHADER_PRECISION_FLOAT="medium":this.queryPrecision(t,t.FRAGMENT_SHADER,t.LOW_FLOAT)&&(r.MAX_SHADER_PRECISION_FLOAT="low"),this.queryPrecision(t,t.FRAGMENT_SHADER,t.HIGH_INT)?r.MAX_SHADER_PRECISION_INT="high":this.queryPrecision(t,t.FRAGMENT_SHADER,t.MEDIUM_INT)?r.MAX_SHADER_PRECISION_INT="medium":this.queryPrecision(t,t.FRAGMENT_SHADER,t.LOW_INT)&&(r.MAX_SHADER_PRECISION_INT="low");var s=t.getExtension("WEBGL_debug_renderer_info");s&&(r.UNMASKED_RENDERER_WEBGL=t.getParameter(s.UNMASKED_RENDERER_WEBGL),r.UNMASKED_VENDOR_WEBGL=t.getParameter(s.UNMASKED_VENDOR_WEBGL))}},applyExtension:function(t,e){var r=t.getExtension(e),i=e.split("_")[0],a="_"+i,n=new RegExp(i+"$"),s=new RegExp(a);for(var o in r){if("function"==typeof r[o]){var h=o.replace(n,"");void 0===t[h]&&(t[h]=r[o].bind(r))}else{var u=o.replace(s,"");void 0===t[u]&&(t[u]=r[o])}}},getWebGLExtension:function(t){return this._webGLExtensions[t]},getWebGLExtensions:function(){return this._webGLExtensions},_checkShader:function(t,e,r){var i=e;"string"==typeof i&&(i=t[e]);var a=t.createShader(i);return t.shaderSource(a,r),t.compileShader(a),!(!t.getShaderParameter(a,t.COMPILE_STATUS)&&!t.isContextLost())},_doubleCheckExtension:function(t,e){var r=["#version 100","#extension GL_%ext% : require","precision mediump float;","varying vec3 vColor;","void main() {","gl_FragColor = vec4(vColor, 1.0);","}"].join("\n");return this._checkShader(t,"FRAGMENT_SHADER",r.replace(/\%ext\%/g,e))},initWebGLExtensions:function(t,e){if(t){var r=e;void 0===r&&(r=!0);var a=t.getSupportedExtensions();if(a){for(var n=this._webGLExtensions,s=0,o=a.length;s<o;++s){var h=a[s];r&&this._bugsDB[h]||(n[h]=t.getExtension(h),this._isGL2||this.applyExtension(t,h))}if(!this._isGL2){var u="EXT_shader_texture_lod";n[u]&&!this._doubleCheckExtension(t,u)&&delete n[u]}var c=this.getWebGLExtension("EXT_texture_filter_anisotropic");c&&(i.ANISOTROPIC_SUPPORT_EXT=!0,i.ANISOTROPIC_SUPPORT_MAX=t.getParameter(c.MAX_TEXTURE_MAX_ANISOTROPY_EXT))}}}},e.a=o},function(t,e,r){"use strict";var i=r(0),a=r(4),n=function(t,e,r,i){a.a.call(this),this._sourceFactor=n.DISABLE,this._destinationFactor=n.DISABLE,this._sourceFactorAlpha=this._sourceFactor,this._destinationFactorAlpha=this._destinationFactor,this._separate=!1,void 0!==t&&this.setSource(t),void 0!==e&&this.setDestination(e),void 0!==r&&this.setSourceAlpha(r),void 0!==i&&this.setDestinationAlpha(i)};n.DISABLE=-1,n.ZERO=0,n.ONE=1,n.SRC_COLOR=768,n.ONE_MINUS_SRC_COLOR=769,n.SRC_ALPHA=770,n.ONE_MINUS_SRC_ALPHA=771,n.DST_ALPHA=772,n.ONE_MINUS_DST_ALPHA=773,n.DST_COLOR=774,n.ONE_MINUS_DST_COLOR=775,n.SRC_ALPHA_SATURATE=776,n.BLEND_DST_RGB=32968,n.BLEND_SRC_RGB=32969,n.BLEND_DST_ALPHA=32970,n.BLEND_SRC_ALPHA=32971,n.CONSTANT_COLOR=32769,n.ONE_MINUS_CONSTANT_COLOR=32770,n.CONSTANT_ALPHA=32771,n.ONE_MINUS_CONSTANT_ALPHA=32772,n.BLEND_COLOR=32773,i.a.createPrototypeStateAttribute(n,i.a.objectInherit(a.a.prototype,{attributeType:"BlendFunc",cloneType:function(){return new n},setSource:function(t){this.setSourceRGB(t),this.setSourceAlpha(t)},getSource:function(){return this._sourceFactor},setDestination:function(t){this.setDestinationRGB(t),this.setDestinationAlpha(t)},getDestination:function(){return this._destinationFactor},getSeparate:function(){return this._separate},checkSeparate:function(){return this._sourceFactor!==this._sourceFactorAlpha||this._destinationFactor!==this._destinationFactorAlpha},setSourceRGB:function(t){this._sourceFactor="string"==typeof t?n[t]:t,this._separate=this.checkSeparate()},getSourceRGB:function(){return this._sourceFactor},setSourceAlpha:function(t){this._sourceFactorAlpha="string"==typeof t?n[t]:t,this._separate=this.checkSeparate()},getSourceAlpha:function(){return this._sourceFactorAlpha},setDestinationRGB:function(t){this._destinationFactor="string"==typeof t?n[t]:t,this._separate=this.checkSeparate()},getDestinationRGB:function(){return this._destinationFactor},setDestinationAlpha:function(t){this._destinationFactorAlpha="string"==typeof t?n[t]:t,this._separate=this.checkSeparate()},getDestinationAlpha:function(){return this._destinationFactorAlpha},apply:function(t){t.applyBlendFunc(this)}}),"osg","BlendFunc"),e.a=n},function(t,e,r){"use strict";var i=r(2),a=r(0),n=r(33),s=r(4),o=r(22),h=r(28),u=function(){n.a.call(this),s.a.call(this),this._fbo=void 0,this._rbo=void 0,this._attachments=[],this._buffers=[],this._dirty=!0,this._hasMRT=h.a.instance().getWebGLExtension("WEBGL_draw_buffers")};u.COLOR_ATTACHMENT0=36064,u.DEPTH_ATTACHMENT=36096,u.DEPTH_COMPONENT16=33189,u._sDeletedGLFrameBufferCache=new window.Map,u.deleteGLFrameBuffer=function(t,e){u._sDeletedGLFrameBufferCache.has(t)||u._sDeletedGLFrameBufferCache.set(t,[]),u._sDeletedGLFrameBufferCache.get(t).push(e)},u.flushDeletedGLFrameBuffers=function(t,e){if(e<=0)return e;if(!u._sDeletedGLFrameBufferCache.has(t))return e;var r=u._sDeletedGLFrameBufferCache.get(t);if(0===r.length)return e;for(var i=0,a=o.a.instance().tick(),n=r.length,s=n-1;s>=0&&i<e;s--)t.deleteFramebuffer(r[s]),r.splice(s,1),i=o.a.instance().deltaS(a,o.a.instance().tick());return e-i},u.flushAllDeletedGLFrameBuffers=function(t){if(u._sDeletedGLFrameBufferCache.has(t)){var e=u._sDeletedGLFrameBufferCache.get(t);if(0!==e.length)for(var r=e.length,i=r-1;i>=0;i--)t.deleteFramebuffer(e[i]),e.splice(i,1)}},u._sDeletedGLRenderBufferCache=new window.Map,u.deleteGLRenderBuffer=function(t,e){u._sDeletedGLRenderBufferCache.has(t)||u._sDeletedGLRenderBufferCache.set(t,[]),u._sDeletedGLRenderBufferCache.get(t).push(e)},u.flushDeletedGLRenderBuffers=function(t,e){if(e<=0)return e;if(!u._sDeletedGLRenderBufferCache.has(t))return e;for(var r=0,i=o.a.instance().tick(),a=u._sDeletedGLRenderBufferCache.get(t),n=a.length,s=n-1;s>=0&&r<e;s--)t.deleteRenderbuffer(a[s]),a.splice(s,1),r=o.a.instance().deltaS(i,o.a.instance().tick());return e-r},u.flushAllDeletedGLRenderBuffers=function(t){if(u._sDeletedGLRenderBufferCache.has(t))for(var e=u._sDeletedGLRenderBufferCache.get(t),r=e.length,i=r-1;i>=0;i--)t.deleteRenderbuffer(e[i]),e.splice(i,1)},u.onLostContext=function(t){if(u._sDeletedGLFrameBufferCache.has(t)){var e=u._sDeletedGLFrameBufferCache.get(t);e.length=0,u._sDeletedGLRenderBufferCache.has(t)&&(e=u._sDeletedGLRenderBufferCache.get(t),e.length=0)}},a.a.createPrototypeStateAttribute(u,a.a.objectInherit(n.a.prototype,a.a.objectInherit(s.a.prototype,{attributeType:"FrameBufferObject",cloneType:function(){return new u},invalidate:function(){if(this._rbo&&this._attachments){for(var t=0,e=this._attachments.length;t<e;++t){var r=this._attachments[t];r.texture||(r.renderBufferObject=void 0)}this._rbo=void 0}this._fbo=void 0,this._buffers.length=0,this._dirty=!0},dirty:function(){this._buffers.length=0,this._dirty=!0},isDirty:function(){return this._dirty},setAttachment:function(t){this._attachments.push(t)},getAttachment:function(t){if(this._attachments)for(var e=0,r=this._attachments.length;e<r;++e){var i=this._attachments[e];if(i.attachment===t)return i}},releaseGLObjects:function(){void 0!==this._fbo&&void 0!==this._gl&&u.deleteGLFrameBuffer(this._gl,this._fbo),this._fbo=void 0,void 0!==this._rbo&&void 0!==this._gl&&u.deleteGLRenderBuffer(this._gl,this._rbo),this.invalidate()},_reportFrameBufferError:function(t){switch(t){case 36054:i.a.debug("FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case 36055:i.a.debug("FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case 36057:i.a.debug("FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case 36061:i.a.debug("FRAMEBUFFER_UNSUPPORTED");break;default:i.a.debug("FRAMEBUFFER unknown error "+t.toString(16))}},reset:function(){this.releaseGLObjects(),this._attachments=[]},getFrameBufferObject:function(){return this._fbo},getRenderBufferObject:function(){return this._rbo},createFrameBufferObject:function(t){this.setGraphicContext(t.getGraphicContext()),this._fbo=this._gl.createFramebuffer()},createRenderBuffer:function(t,e,r){var i=this._gl,a=i.createRenderbuffer();return i.bindRenderbuffer(i.RENDERBUFFER,a),i.renderbufferStorage(i.RENDERBUFFER,t,e,r),a},framebufferRenderBuffer:function(t,e){var r=this._gl;r.bindRenderbuffer(r.RENDERBUFFER,e),r.framebufferRenderbuffer(r.FRAMEBUFFER,t,r.RENDERBUFFER,e)},framebufferTexture2D:function(t,e,r,i){var a=this._gl;if(t.applyTextureAttribute(1,i),i.isDirty()||!i.getTextureObject())return!1;var n=a.DRAW_FRAMEBUFFER||a.FRAMEBUFFER;return a.framebufferTexture2D(n,e,r,i.getTextureObject().id(),0),!0},bindFrameBufferObject:function(){var t=this._gl;t.bindFramebuffer(t.FRAMEBUFFER,this._fbo)},checkStatus:function(){var t=this._gl,e=t.checkFramebufferStatus(t.FRAMEBUFFER);e!==t.FRAMEBUFFER_COMPLETE&&this._reportFrameBufferError(e)},_checkAllowedSize:function(t,e){var r=h.a.instance().getWebGLParameter("MAX_RENDERBUFFER_SIZE");return!(0===t||0===e||e>r||t>r)||(i.a.error("width ("+t+") or height ("+t+') makes frame buffer not bindable. Max RenderBuffer is "'+r+'"'),!1)},apply:function(t){this._gl||this.setGraphicContext(t.getGraphicContext());var e=this._gl,r=this._attachments,a=r.length;if(0===a&&!this._fbo)return void e.bindFramebuffer(e.FRAMEBUFFER,null);var n=0;if(!this.isDirty()){for(n=0;n<a;++n){var s=r[n].texture;s&&s.isDirty()&&t.applyTextureAttribute(1,s)}return e.bindFramebuffer(e.FRAMEBUFFER,this._fbo),void(!0===i.a.reportWebGLError&&this.checkStatus())}this._fbo||this.createFrameBufferObject(t),this.bindFrameBufferObject();var o=this._hasMRT?this._buffers:void 0,h=!1;for(n=0;n<a;++n){var u=r[n];if(u.texture){var c=u.texture;if(!this._checkAllowedSize(c.getWidth(),c.getHeight()))return void this.releaseGLObjects();if(this._hasMRT&&u.attachment>=e.COLOR_ATTACHMENT0&&u.attachment<=e.COLOR_ATTACHMENT15&&-1===o.indexOf(u.attachment)&&o.push(u.attachment),!this.framebufferTexture2D(t,u.attachment,u.textureTarget,c))return void this.releaseGLObjects()}else{if(!this._checkAllowedSize(u.width,u.height))return void this.releaseGLObjects();u.renderBufferObject?this._rbo=u.renderBufferObject:(this._rbo=this.createRenderBuffer(u.format,u.width,u.height),u.renderBufferObject=this._rbo),this.framebufferRenderBuffer(u.attachment,this._rbo),h=!0}}o&&o.length>0&&e.drawBuffers(o),this.checkStatus(),h&&e.bindRenderbuffer(e.RENDERBUFFER,null),this._dirty=!1}})),"osg","FrameBufferObject"),e.a=u},function(t,e,r){"use strict";var i=r(0),a=r(4),n=function(t,e,r,i){a.a.call(this),this._func=n.LESS,this._near=0,this._far=1,this._writeMask=!0,void 0!==t&&(this._func="string"==typeof t?n[t]:t),void 0!==e&&(this._near=e),void 0!==r&&(this._far=r),void 0!==i&&(this._writeMask=i)};n.DISABLE=0,n.NEVER=512,n.LESS=513,n.EQUAL=514,n.LEQUAL=515,n.GREATER=516,n.NOTEQUAL=517,n.GEQUAL=518,n.ALWAYS=519,i.a.createPrototypeStateAttribute(n,i.a.objectInherit(a.a.prototype,{attributeType:"Depth",cloneType:function(){return new n},setRange:function(t,e){this._near=t,this._far=e},setWriteMask:function(t){this._writeMask=t},getWriteMask:function(){return this._writeMask},getFunc:function(){return this._func},apply:function(t){t.applyDepth(this)}}),"osg","Depth"),e.a=n},function(t,e,r){"use strict";var i=function(t){this._manipulator=t,this._enable=!0};i.prototype={isEnabled:function(){return this._enable},setEnable:function(t){this._enable=t}},e.a=i},function(t,e,r){"use strict";var i=(r(2),function(){this._gl=void 0,this._onLostContextCallback=void 0});i.prototype={setGraphicContext:function(t){this._gl=t,i.addObject(this._gl,this)},getGraphicContext:function(){return this._gl},setLostContextCallback:function(t){this._onLostContextCallback=t},onLostContext:function(){this.invalidate&&"function"==typeof this.invalidate&&this.invalidate(),this._onLostContextCallback&&this._onLostContextCallback()}},i._sResourcesArrayCache=new window.Map,i.addObject=function(t,e){i._sResourcesArrayCache.has(t)||i._sResourcesArrayCache.set(t,[]);var r=i._sResourcesArrayCache.get(t);-1===r.indexOf(e)&&r.push(e)},i.removeObject=function(t,e){if(i._sResourcesArrayCache.has(t)){var r=i._sResourcesArrayCache.get(t),a=r.indexOf(e);-1!==a&&r.splice(a,1)}},i.onLostContext=function(t){if(i._sResourcesArrayCache.has(t))for(var e=i._sResourcesArrayCache.get(t),r=0,a=e.length;r<a;r++)e[r].onLostContext()},e.a=i},function(t,e,r){"use strict";var i=r(0),a=r(81),n=r(2),s=r(1),o=r(11),h=r(17),u=r(113),c=r(4),l=r(24),d=function(){o.a.call(this),this._shape=null,this._targets=[],this._stateSetAnimation=new h.a,this._targetWeights=new Float32Array(d.MAX_MORPH_GPU),this._morphAttribute=void 0,this._morphTargetNames=void 0,this._maxMorphGPU=d.MAX_MORPH_GPU,this._isInitialized=!1};d.EFFECTIVE_EPS=.05,d.MAX_MORPH_GPU=4,i.a.createPrototypeNode(d,i.a.objectInherit(o.a.prototype,{init:function(){return this._morphAttribute?(this._isInitialized=!0,!1):(this._morphAttribute=new u.a(Math.min(this._maxMorphGPU,this.getMorphTargets().length)),this.getStateSetAnimation().setAttributeAndModes(this._morphAttribute,c.a.ON),this._morphAttribute.setTargetWeights(this.getTargetsWeight()),this._targets[0]?(this._morphTargetNames=window.Object.keys(this._targets[0].getVertexAttributeList()),this._morphAttribute.copyTargetNames(this._morphTargetNames)):(this._morphTargetNames=[],n.a.error("No Targets in the MorphGeometry !")),this._isInitialized=!0,!0)},getMaximumPossibleMorphGPU:function(){return this._maxMorphGPU},setMaximumPossibleMorphGPU:function(t){this._maxMorphGPU=t,this._isInitialized=!1,this._morphAttribute&&this._morphAttribute.setNumTargets(t)},getMorphTargetNames:function(){return this._morphTargetNames},getStateSetAnimation:function(){return this._stateSetAnimation},getMorphTargets:function(){return this._targets},isInitialized:function(){return this._isInitialized},getTargetsWeight:function(){return this._targetWeights},computeBoundingBox:function(){var t=new l.a;return function(e){o.a.prototype.computeBoundingBox.call(this,e);for(var r=0,i=this._targets.length;r<i;r++)e.expandByBoundingBox(this._targets[r].computeBoundingBox(t));return e}}(),mergeChildrenVertexAttributeList:function(){for(var t=0,e=this._targets.length;t<e;t++){var r=this._targets[t],i=r.getVertexAttributeList();for(var n in i){var s=i[n];s&&!s.getBufferArray&&(i[n]=new a.a(s))}o.a.appendVertexAttributeToList(r.getVertexAttributeList(),this.getVertexAttributeList(),t)}},_computeEffectiveSumWeights:function(){for(var t=0,e=this._targetWeights,r=0,i=e.length;r<i;++r){var a=e[r];Math.abs(a)<=d.EFFECTIVE_EPS||(t+=a)}return Math.abs(t)>1e-5?t:t<0?-1e-5:1e-5},computeTransformedVertex:function(t,e){e=e||s.f.create();var r=3*t,i=this._targetWeights,a=this.getVertexAttributeList(),n=a.Vertex.getElements(),o=1-this._computeEffectiveSumWeights();e[0]=o*n[r],e[1]=o*n[r+1],e[2]=o*n[r+2];for(var h=0,u=i.length;h<u;++h){var c=i[h];if(!(Math.abs(c)<=d.EFFECTIVE_EPS)){var l=a["Vertex_"+h].getElements();e[0]+=c*l[r],e[1]+=c*l[r+1],e[2]+=c*l[r+2]}}return e},computeTransformedVertices:function(){for(var t=this._targetWeights,e=this.getVertexAttributeList(),r=e.Vertex.getElements(),i=r.length,a=this._morphedVerts=this._morphedVerts||new Float32Array(i),n=1-this._computeEffectiveSumWeights(),s=0;s<i;++s)a[s]=n*r[s];for(var o=0,h=t.length;o<h;++o){var u=t[o];if(!(Math.abs(u)<=d.EFFECTIVE_EPS))for(var c=e["Vertex_"+o].getElements(),l=0;l<i;++l)a[l]+=u*c[l]}return a}}),"osgAnimation","MorphGeometry"),e.a=d},function(t,e,r){"use strict";var i=r(1),a=r(13),n=r(11),s=r(9),o=r(20),h=r(18),u=r(21),c=r(26),l=r(0),d=function(t,e,r,i,o,u){var c,d,_,f=void 0!==t?t:0,g=void 0!==e?e:0,p=void 0!==r?r:0,m=void 0!==i?i:1,v=void 0!==o?o:1,S=void 0!==u?u:1,b=new n.a;c=m/2,d=v/2,_=S/2;var x=new l.a.Float32Array(72),y=new l.a.Float32Array(48),M=new l.a.Float32Array(72);x[0]=f-c,x[1]=g-d,x[2]=p+_,M[0]=0,M[1]=-1,M[2]=0,y[0]=0,y[1]=1,x[3]=f-c,x[4]=g-d,x[5]=p-_,M[3]=0,M[4]=-1,M[5]=0,y[2]=0,y[3]=0,x[6]=f+c,x[7]=g-d,x[8]=p-_,M[6]=0,M[7]=-1,M[8]=0,y[4]=1,y[5]=0,x[9]=f+c,x[10]=g-d,x[11]=p+_,M[9]=0,M[10]=-1,M[11]=0,y[6]=1,y[7]=1,x[12]=f+c,x[13]=g+d,x[14]=p+_,M[12]=0,M[13]=1,M[14]=0,y[8]=0,y[9]=1,x[15]=f+c,x[16]=g+d,x[17]=p-_,M[15]=0,M[16]=1,M[17]=0,y[10]=0,y[11]=0,x[18]=f-c,x[19]=g+d,x[20]=p-_,M[18]=0,M[19]=1,M[20]=0,y[12]=1,y[13]=0,x[21]=f-c,x[22]=g+d,x[23]=p+_,M[21]=0,M[22]=1,M[23]=0,y[14]=1,y[15]=1,x[24]=f+c,x[25]=g-d,x[26]=p+_,M[24]=1,M[25]=0,M[26]=0,y[16]=0,y[17]=1,x[27]=f+c,x[28]=g-d,x[29]=p-_,M[27]=1,M[28]=0,M[29]=0,y[18]=0,y[19]=0,x[30]=f+c,x[31]=g+d,x[32]=p-_,M[30]=1,M[31]=0,M[32]=0,y[20]=1,y[21]=0,x[33]=f+c,x[34]=g+d,x[35]=p+_,M[33]=1,M[34]=0,M[35]=0,y[22]=1,y[23]=1,x[36]=f-c,x[37]=g+d,x[38]=p+_,M[36]=-1,M[37]=0,M[38]=0,y[24]=0,y[25]=1,x[39]=f-c,x[40]=g+d,x[41]=p-_,M[39]=-1,M[40]=0,M[41]=0,y[26]=0,y[27]=0,x[42]=f-c,x[43]=g-d,x[44]=p-_,M[42]=-1,M[43]=0,M[44]=0,y[28]=1,y[29]=0,x[45]=f-c,x[46]=g-d,x[47]=p+_,M[45]=-1,M[46]=0,M[47]=0,y[30]=1,y[31]=1,x[48]=f-c,x[49]=g+d,x[50]=p+_,M[48]=0,M[49]=0,M[50]=1,y[32]=0,y[33]=1,x[51]=f-c,x[52]=g-d,x[53]=p+_,M[51]=0,M[52]=0,M[53]=1,y[34]=0,y[35]=0,x[54]=f+c,x[55]=g-d,x[56]=p+_,M[54]=0,M[55]=0,M[56]=1,y[36]=1,y[37]=0,x[57]=f+c,x[58]=g+d,x[59]=p+_,M[57]=0,M[58]=0,M[59]=1,y[38]=1,y[39]=1,x[60]=f+c,x[61]=g+d,x[62]=p-_,M[60]=0,M[61]=0,M[62]=-1,y[40]=0,y[41]=1,x[63]=f+c,x[64]=g-d,x[65]=p-_,M[63]=0,M[64]=0,M[65]=-1,y[42]=0,y[43]=0,x[66]=f-c,x[67]=g-d,x[68]=p-_,M[66]=0,M[67]=0,M[68]=-1,y[44]=1,y[45]=0,x[69]=f-c,x[70]=g+d,x[71]=p-_,M[69]=0,M[70]=0,M[71]=-1,y[46]=1,y[47]=1;var T=new l.a.Uint16Array(36);T[0]=0,T[1]=1,T[2]=2,T[3]=0,T[4]=2,T[5]=3,T[6]=4,T[7]=5,T[8]=6,T[9]=4,T[10]=6,T[11]=7,T[12]=8,T[13]=9,T[14]=10,T[15]=8,T[16]=10,T[17]=11,T[18]=12,T[19]=13,T[20]=14,T[21]=12,T[22]=14,T[23]=15,T[24]=16,T[25]=17,T[26]=18,T[27]=16,T[28]=18,T[29]=19,T[30]=20,T[31]=21,T[32]=22,T[33]=20,T[34]=22,T[35]=23,b.getAttributes().Vertex=new a.a(a.a.ARRAY_BUFFER,x,3),b.getAttributes().Normal=new a.a(a.a.ARRAY_BUFFER,M,3),b.getAttributes().TexCoord0=new a.a(a.a.ARRAY_BUFFER,y,2);var A=new h.a(s.a.TRIANGLES,new a.a(a.a.ELEMENT_ARRAY_BUFFER,T,1));return b.getPrimitives().push(A),b},_=function(){var t=new n.a,e=new l.a.Float32Array([4,-1,-1,4,-1,-1]),r=new a.a(a.a.ARRAY_BUFFER,e,2);t.getAttributes().Vertex=r,t.getAttributes().TexCoord0=r;var i=new o.a(s.a.TRIANGLES,0,3);return t.getPrimitives().push(i),function(){return t}}(),f=function(t,e,r,o,u,c,d,_,f,g,p,m,v){void 0===m&&void 0===v&&(m=g,v=p,g=0,p=0);var S=new n.a,b=new l.a.Float32Array(12);b[0]=t+d,b[1]=e+_,b[2]=r+f,b[3]=t,b[4]=e,b[5]=r,b[6]=t+o,b[7]=e+u,b[8]=r+c,b[9]=t+o+d,b[10]=e+u+_,b[11]=r+c+f,void 0===m&&(m=1),void 0===v&&(v=1);var x=new l.a.Float32Array(8);x[0]=g,x[1]=v,x[2]=g,x[3]=p,x[4]=m,x[5]=p,x[6]=m,x[7]=v;var y=i.f.fromValues(o,u,c);i.f.cross(y,y,i.f.fromValues(d,_,f)),i.f.normalize(y,y);var M=new l.a.Float32Array(12);M[0]=y[0],M[1]=y[1],M[2]=y[2],M[3]=y[0],M[4]=y[1],M[5]=y[2],M[6]=y[0],M[7]=y[1],M[8]=y[2],M[9]=y[0],M[10]=y[1],M[11]=y[2];var T=new l.a.Uint16Array(6);T[0]=0,T[1]=1,T[2]=2,T[3]=0,T[4]=2,T[5]=3,S.getAttributes().Vertex=new a.a(a.a.ARRAY_BUFFER,b,3),S.getAttributes().Normal=new a.a(a.a.ARRAY_BUFFER,M,3),S.getAttributes().TexCoord0=new a.a(a.a.ARRAY_BUFFER,x,2);var A=new h.a(s.a.TRIANGLES,new a.a(a.a.ELEMENT_ARRAY_BUFFER,T,1));return S.getPrimitives().push(A),S},g=function(t){void 0===t&&(t=1),void 0===g.getShader&&(g.getShader=function(){if(void 0===g.getShader.program){var t=["#ifdef GL_ES","precision highp float;","#endif","attribute vec3 Vertex;","attribute vec4 Color;","uniform mat4 uModelViewMatrix;","uniform mat4 uProjectionMatrix;","","varying vec4 vColor;","","void main(void) {","  gl_Position = uProjectionMatrix * (uModelViewMatrix * vec4(Vertex, 1.0));","  vColor = Color;","}"].join("\n"),e=["#ifdef GL_ES","precision highp float;","#endif","varying vec4 vColor;","void main(void) {","gl_FragColor = vColor;","}"].join("\n"),r=new u.a(new c.a("VERTEX_SHADER",t),new c.a("FRAGMENT_SHADER",e));g.getShader.program=r}return g.getShader.program});var e=new n.a,r=new l.a.Float32Array(18);r[3]=t,r[10]=t,r[17]=t;var i=new l.a.Float32Array(24);i[0]=i[3]=1,i[4]=i[7]=1,i[9]=i[11]=1,i[13]=i[15]=1,i[18]=i[19]=1,i[22]=i[23]=1,e.getAttributes().Vertex=new a.a(a.a.ARRAY_BUFFER,r,3),e.getAttributes().Color=new a.a(a.a.ARRAY_BUFFER,i,4);var h=new o.a(s.a.LINES,0,6);return e.getPrimitives().push(h),e.getOrCreateStateSet().setAttributeAndModes(g.getShader()),e},p=function(t,e,r,u,c,d,_){t=t||1,u=void 0!==u?u:0,c=void 0!==c?c:2*Math.PI,d=void 0!==d?d:0,_=void 0!==_?_:Math.PI;for(var f=Math.max(3,Math.floor(e)||8),g=Math.max(2,Math.floor(r)||6),p=f*g/3>=65536,m=p?f*g*6:f*g*4,v=new l.a.Float32Array(3*m),S=new l.a.Float32Array(3*m),b=new l.a.Float32Array(2*m),x=p?void 0:new l.a.Uint16Array(f*g*6),y=0,M=0,T=new l.a.Float32Array(3),A=new l.a.Float32Array(3),C=new l.a.Float32Array(3),I=new l.a.Float32Array(3),w=new l.a.Float32Array(3),E=new l.a.Float32Array(3),N=new l.a.Float32Array(3),R=new l.a.Float32Array(3),O=new l.a.Float32Array(2),F=new l.a.Float32Array(2),P=new l.a.Float32Array(2),L=new l.a.Float32Array(2),D=function(e,r,a,n,s){a[0]=-t*Math.cos(u+e*c)*Math.sin(d+r*_),a[1]=t*Math.cos(d+r*_),a[2]=t*Math.sin(u+e*c)*Math.sin(d+r*_),i.f.normalize(n,a),s[0]=e,s[1]=1-r},V=0;V<g;V++)for(var B=0;B<f;B++){D((B+1)/f,V/g,T,w,O),D(B/f,V/g,A,E,F),D(B/f,(V+1)/g,C,N,P),D((B+1)/f,(V+1)/g,I,R,L);var U=3*y;v[U]=T[0],v[U+1]=T[1],v[U+2]=T[2],v[U+3]=A[0],v[U+4]=A[1],v[U+5]=A[2],v[U+6]=C[0],v[U+7]=C[1],v[U+8]=C[2],S[U]=w[0],S[U+1]=w[1],S[U+2]=w[2],S[U+3]=E[0],S[U+4]=E[1],S[U+5]=E[2],S[U+6]=N[0],S[U+7]=N[1],S[U+8]=N[2];var k=2*y;if(b[k]=O[0],b[k+1]=O[1],b[k+2]=F[0],b[k+3]=F[1],b[k+4]=P[0],b[k+5]=P[1],y+=3,p)U=3*y,v[U]=T[0],v[U+1]=T[1],v[U+2]=T[2],v[U+3]=C[0],v[U+4]=C[1],v[U+5]=C[2],v[U+6]=I[0],v[U+7]=I[1],v[U+8]=I[2],S[U]=w[0],S[U+1]=w[1],S[U+2]=w[2],S[U+3]=N[0],S[U+4]=N[1],S[U+5]=N[2],S[U+6]=R[0],S[U+7]=R[1],S[U+8]=R[2],k=2*y,b[k]=O[0],b[k+1]=O[1],b[k+2]=P[0],b[k+3]=P[1],b[k+4]=L[0],b[k+5]=L[1],y+=3;else{U=3*y,v[U]=I[0],v[U+1]=I[1],v[U+2]=I[2],S[U]=R[0],S[U+1]=R[1],S[U+2]=R[2],k=2*y,b[k]=L[0],b[k+1]=L[1];var G=3*M,j=y-3;x[G]=j,x[G+1]=j+1,x[G+2]=j+2,x[G+3]=j,x[G+4]=j+2,x[G+5]=j+3,M+=2,y+=1}}var z=new n.a;return z.getAttributes().Vertex=new a.a("ARRAY_BUFFER",v,3),z.getAttributes().Normal=new a.a("ARRAY_BUFFER",S,3),z.getAttributes().TexCoord0=new a.a("ARRAY_BUFFER",b,2),p?z.getPrimitives().push(new o.a(s.a.TRIANGLES,0,v.length/3)):z.getPrimitives().push(new h.a(s.a.TRIANGLES,new a.a("ELEMENT_ARRAY_BUFFER",x,1))),z},m=function(t,e,r,i,h,u,c,l,d,_,f){t=void 0!==t?t:-.5,e=void 0!==e?e:-.5,r=void 0!==r?r:0,i=void 0!==i?i:1,h=void 0!==h?h:0,u=void 0!==u?u:0,c=void 0!==c?c:0,l=void 0!==l?l:1,d=void 0!==d?d:0,_=void 0!==_?_:5,f=void 0!==f?f:_,_+=2,f+=2;var g=new n.a,p=new Float32Array(2*(_+f)*3),m=0,v=0,S=i/(_-1),b=h/(_-1),x=u/(_-1),y=t+i+c,M=e+h+l,T=r+u+d;for(m=0;m<_;++m)v=6*m,p[v]=t+S*m,p[v+1]=e+b*m,p[v+2]=r+x*m,p[v+3]=y-S*(_-m-1),p[v+4]=M-b*(_-m-1),p[v+5]=T-x*(_-m-1);for(S=c/(f-1),b=l/(f-1),x=d/(f-1),m=0;m<f;++m)v=6*(_+m),p[v]=t+S*m,p[v+1]=e+b*m,p[v+2]=r+x*m,p[v+3]=y-S*(f-m-1),p[v+4]=M-b*(f-m-1),p[v+5]=T-x*(f-m-1);g.getAttributes().Vertex=new a.a(a.a.ARRAY_BUFFER,p,3);var A=new o.a(s.a.LINES,0,2*(_+f));return g.getPrimitives().push(A),g},v=function(t){var e=new n.a,r=new Float32Array([-.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,-.5,.5,-.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5]);e.getAttributes().Vertex=new a.a(a.a.ARRAY_BUFFER,r,3),t||(t=[1,0,0,1]);for(var i=new l.a.Float32Array(32),o=0;o<8;o++)for(var u=0;u<4;u++)i[3*o+u]=t[u];e.getAttributes().Color=new a.a(a.a.ARRAY_BUFFER,i,4);var c=new l.a.Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);return e.getPrimitives().push(new h.a(s.a.LINES,new a.a("ELEMENT_ARRAY_BUFFER",c,1))),e};e.a={createTexturedBoxGeometry:d,createTexturedQuadGeometry:f,createTexturedSphereGeometry:p,createTexturedFullScreenFakeQuadGeometry:_,createAxisGeometry:g,createTexturedSphere:p,createGridGeometry:m,createBoundingBoxGeometry:v}},function(t,e,r){"use strict";var i=r(1),a=r(125),n={};n.InvalidTargetID=-1;var s=function(t,e,r){return{type:t,id:n.InvalidTargetID,channels:[],value:e,defaultValue:r}},o=function(t){return s(a.a.Quat,i.d.copy(i.d.create(),t),i.d.copy(i.d.create(),t))},h=function(t){return s(a.a.Matrix,i.c.copy(i.c.create(),t),i.c.copy(i.c.create(),t))},u=function(t){return s(a.a.Vec3,i.f.copy(i.f.create(),t),i.f.copy(i.f.create(),t))},c=function(t){return s(a.a.Float,t,t)};n.createQuatTarget=o,n.createVec3Target=u,n.createFloatTarget=c,n.createMatrixTarget=h,e.a=n},function(t,e,r){"use strict";var i=r(0),a=r(4),n=r(1),s=function(t,e,r,i){a.a.call(this),this._x=void 0!==t?t:0,this._y=void 0!==e?e:0,this._width=void 0!==r?r:800,this._height=void 0!==i?i:600};i.a.createPrototypeStateAttribute(s,i.a.objectInherit(a.a.prototype,{attributeType:"Viewport",cloneType:function(){return new s},setViewport:function(t,e,r,i){this._x=t,this._y=e,this._width=r,this._height=i},x:function(){return this._x},y:function(){return this._y},width:function(){return this._width},height:function(){return this._height},computeWindowMatrix:function(){var t=n.c.create(),e=n.c.create(),r=n.f.create();return function(i){n.c.fromTranslation(t,n.f.ONE),n.c.fromScaling(e,[.5*this._width,.5*this._height,.5]);var a=n.c.fromTranslation(i,n.f.set(r,this._x,this._y,0));return n.c.mul(a,a,n.c.mul(e,e,t))}}(),apply:function(t){t.applyViewport(this)}}),"osg","Viewport"),e.a=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(2),a=r(0),n=r(6),s=r(29),o=r(11),h=r(13),u=r(9),c=r(20),l=r(18),d=r(17),_=r(8),f=r(1),g=r(16),p=r(83),m=r(55),v={};v.ObjectWrapper={},v.ObjectWrapper.serializers={},v.readImage=function(t,e){return v.registry().readImageURL(t,e)},v.readImageURL=v.readImage,v.readBinaryArrayURL=function(t,e){return v.registry().readBinaryArrayURL(t,e)},v.readNodeURL=function(t,e){var r=t.substr(t.lastIndexOf(".")+1),i=m.a.instance().getReaderWriterForExtension(r);return void 0!==i?i.readNodeURL(t,e):v.registry().readNodeURL(t,e)},v.registry=function(){var t=r(90).default;return void 0===v.registry._input&&(v.registry._input=new t),v.registry._input},v.parseSceneGraph=function(t,e){if(!(void 0!==t.Version&&t.Version>0)){a.a.time("osgjs.metric:ReaderParser.parseSceneGraphDeprecated",i.a.INFO);var r=v.parseSceneGraphDeprecated(t);return a.a.timeEnd("osgjs.metric:ReaderParser.parseSceneGraphDeprecated",i.a.INFO),r}a.a.time("osgjs.metric:ReaderParser.parseSceneGraph",i.a.INFO);var n;for(var s in t)if("Generator"!==s&&"Version"!==s){n=s;break}if(n){var o={};o[n]=t[n];var h=v.registry().clone();h.setJSON(o);var u=a.a.objectMix(a.a.objectMix({},v.registry().getOptions()),e||{});h.setOptions(u);var c=h.readObject();return a.a.timeEnd("osgjs.metric:ReaderParser.parseSceneGraph",i.a.INFO),c}i.a.log("can't parse scenegraph "+t,i.a.INFO)},v.parseSceneGraphDeprecated=function(t){var e,m=function(t,e){var r=e[t];return void 0===r&&(r=e[t.toLowerCase()]),r},S=function(t,e){var r=m("Name",e);r&&void 0!==t.setName&&t.setName(r)},b=function(t,e){S(t,e),t.setAmbient(m("Ambient",e)),t.setDiffuse(m("Diffuse",e)),t.setEmission(m("Emission",e)),t.setSpecular(m("Specular",e)),t.setShininess(m("Shininess",e))},x=function(t,e){S(t,e),t.setSourceRGB(e.SourceRGB),t.setSourceAlpha(e.SourceAlpha),t.setDestinationRGB(e.DestinationRGB),t.setDestinationAlpha(e.DestinationAlpha)},y=function(t,e){var r=e.MagFilter||e.mag_filter||void 0;r&&t.setMagFilter(r);var a=e.MinFilter||e.min_filter||void 0;a&&t.setMinFilter(a);var n=e.WrapT||e.wrap_t||void 0;n&&t.setWrapT(n);var s=e.WrapS||e.wrap_s||void 0;s&&t.setWrapS(s);var o=m("File",e);v.readImage(o).then(function(e){t.setImage(e)}).catch(function(){i.a.log("Can't read image")})},M=t.children,T=t._primitives||t.primitives||t.Primitives||void 0,A=t._attributes||t.attributes||t.Attributes||void 0;if(T||A){var C=new o.a;S(C,t),C.stateset=t.stateset,t=C;for(var I=0,w=T.length;I<w;I++){var E=T[I].mode;if(T[I].indices){var N=T[I].indices;N=new h.a(h.a[N.type],N.elements,N.itemSize),E=E?u.a[E]:"TRIANGLES",C.getPrimitiveSetList().push(new l.a(E,N))}else{E=u.a[E];var R=T[I].first,O=T[I].count;C.getPrimitiveSetList().push(new c.a(E,R,O))}}for(var F in A){var P=A[F];C.getVertexAttributeList()[F]=new h.a(P.type,P.elements,P.itemSize)}}var L=m("StateSet",t);if(L){var D=new d.a;!function(t,e){S(t,e);var a=m("Textures",e)||m("TextureAttributeList",e)||void 0;if(a)for(var o=0,h=a.length;o<h;o++){var u=m("File",a[o]);if(u){var c=r(7).default,l=new c;y(l,a[o]),t.setTextureAttributeAndModes(o,l),t.addUniform(n.a.createInt1(o,"Texture"+o))}else i.a.log("no texture on unit "+o+" skip it")}var d=m("BlendFunc",e);if(d){var _=new s.a;x(_,d),t.setAttributeAndModes(_)}var f=m("Material",e);if(f){var g=r(118).default,p=new g;b(p,f),t.setAttributeAndModes(p)}}(D,L),t.stateset=D}var V=t.matrix||t.Matrix||void 0;V&&(e=new g.a,S(e,t),a.a.extend(e,t),f.c.copy(e.getMatrix(),V),t=e);var B=t.projection||t.Projection||void 0;if(B&&(e=new p.a,S(e,t),a.a.extend(e,t),f.c.copy(e.setProjectionMatrix(),B),t=e),void 0===t.typeID&&(e=new _.a,S(e,t),a.a.extend(e,t),t=e),M){t.children=[];for(var U=0,k=M.length;U<k;U++)t.addChild(v.parseSceneGraphDeprecated(M[U]))}return t},e.default=v},function(t,e,r){"use strict";var i=function(t,e,r){return Math.min(r,Math.max(e,t))},a=function(t,e,r){if(r<=t)return 0;if(r>=e)return 1;var i=(r-t)/(e-t);return i*i*(3-2*i)},n=function(t){return t!==t};e.a={clamp:i,smoothStep:a,isNaN:n}},function(t,e,r){"use strict";var i=r(2),a=r(0),n=r(24),s=r(1),o=function(){this._center=s.f.create(),this._radius=-1};a.a.createPrototypeObject(o,{init:function(){s.f.init(this._center),this._radius=-1},valid:function(){return this._radius>=0},set:function(t,e){this._center=t,this._radius=e},center:function(){return this._center},radius:function(){return this._radius},radius2:function(){return this._radius*this._radius},volume:function(){var t=this._radius;return t*t*t*Math.PI*4/3},copy:function(t){this._radius=t._radius,s.f.copy(this._center,t._center)},copyBoundingBox:function(t){t.center(this._center),this._radius=t.radius()},expandByBoundingBox:function(){var t=s.f.create(),e=new n.a;return function(r){if(r.valid()){if(!this.valid())return void this.copyBoundingBox(r);s.f.copy(e._min,r._min),s.f.copy(e._max,r._max);for(var i=0;i<8;i++)s.f.sub(t,r.corner(i,t),this._center),s.f.normalize(t,t),s.f.scaleAndAdd(t,this._center,t,-this._radius),e.expandByVec3(t);e.center(this._center),this._radius=e.radius()}}}(),expandByvec3:function(t){i.a.warn("deprecated, use expandByVec3"),this.expandByVec3(t)},expandByVec3:function(){var t=s.f.create();return function(e){if(this.valid()){s.f.sub(t,e,this.center(t));var r=s.f.length(t);if(r>this.radius()){var i=.5*(r-this.radius());this._center[0]+=t[0]*(i/r),this._center[1]+=t[1]*(i/r),this._center[2]+=t[2]*(i/r),this._radius+=i}}else this._center[0]=e[0],this._center[1]=e[1],this._center[2]=e[2],this._radius=0}}(),expandRadiusBySphere:function(t){if(t.valid())if(this.valid()){var e=s.f.distance(this._center,t._center)+t._radius;e>this._radius&&(this._radius=e)}else s.f.copy(this._center,t._center),this._radius=t._radius},expandByBoundingSphere:function(t){if(t.valid()){if(!this.valid())return this._center[0]=t._center[0],this._center[1]=t._center[1],this._center[2]=t._center[2],void(this._radius=t.radius());var e=s.f.distance(t.center(),this.center());if(!(e+t.radius()<=this.radius())){if(e+this.radius()<=t.radius())return this._center[0]=t._center[0],this._center[1]=t._center[1],this._center[2]=t._center[2],void(this._radius=t._radius);var r=.5*(this.radius()+e+t.radius()),i=(r-this.radius())/e;this._center[0]+=(t._center[0]-this._center[0])*i,this._center[1]+=(t._center[1]-this._center[1])*i,this._center[2]+=(t._center[2]-this._center[2])*i,this._radius=r}}},contains:function(t){return!!this.valid()&&s.f.sqrDist(this.center(),t)<=this.radius2()},intersects:function(t){if(!this.valid()||!t.valid())return!1;var e=this.radius()+t.radius();return s.f.sqrDist(t.center(),this.center())<=e*e},transformMat4:function(){var t=s.f.create();return function(e,r){if(!this.valid())return e;e._center!==this._center&&(s.f.copy(e._center,this._center),e._radius=this._radius);var i=e._center,a=e._radius;return s.c.getSqrScale(t,r),a*=Math.sqrt(Math.max(Math.max(t[0],t[1]),t[2])),e._radius=a,s.f.transformMat4(i,i,r),e}}()},"osg","BoundingSphere"),e.a=o},function(t,e,r){"use strict";var i=(r(2),r(0)),a=r(5),n=window.ImageBitmap||function(){},s=function(t){a.a.call(this),this._imageObject=void 0,this._url=void 0,this._width=void 0,this._height=void 0,this._dirty=!0,this._mipmap=[],t&&this.setImage(t),this._isGreyscale=void 0};i.a.createPrototypeObject(s,i.a.objectInherit(a.a.prototype,{dirty:function(){this._isGreyscale=void 0,this._dirty=!0},isDirty:function(){return this._dirty},setDirty:function(t){this._dirty=t},getImage:function(){return this._imageObject instanceof s?this._imageObject.getImage():this._imageObject},getURL:function(){return this._url},setURL:function(t){this._url=t},useOrCreateImage:function(t){return t instanceof s==!1?new s(t):t},setImage:function(t){if(!this._url&&t&&(t.src||t.currentSrc)&&(this._url=t.src||t.currentSrc),this._mipmap.length=0,Array.isArray(t)){for(var e=0,r=t.length;e<r;e++)this._mipmap.push(this.useOrCreateImage(t[e]));this.setWidth(this._mipmap[0].getWidth()),this.setHeight(this._mipmap[0].getHeight())}else this._mipmap.push(t);this._imageObject=this._mipmap[0],this.dirty()},isCanvas:function(){return this.getImage()instanceof window.HTMLCanvasElement},isBitmap:function(){return this.getImage()instanceof n},isVideo:function(){return this.getImage()instanceof window.HTMLVideoElement},isImage:function(){return this.getImage()instanceof window.Image},isTypedArray:function(){var t=this.getImage();return t instanceof Uint8Array||t instanceof Float32Array||t instanceof Uint16Array},setWidth:function(t){this._width=t},setHeight:function(t){this._height=t},getWidth:function(){var t=this.getImage();return this.isImage()?t.naturalWidth:this.isVideo()?t.videoWidth:this.isCanvas()||this.isBitmap()?t.width:this._width},getHeight:function(){var t=this.getImage();return this.isImage()?t.naturalHeight:this.isVideo()?t.videoHeight:this.isCanvas()||this.isBitmap()?t.height:this._height},isGreyscale:function(t){if(void 0!==this._isGreyscale)return this._isGreyscale;if(void 0!==this._imageObject&&this.isReady()&&void 0===this._isGreyscale){var e=this._imageObject;this.isCanvas()||(e=document.createElement("canvas"));var r=e.getContext("2d");e.width=this._imageObject.width,e.height=this._imageObject.height,r.drawImage(this._imageObject,0,0);var i,a;t||(i=e.width,a=e.height),t>0&&(t=Math.min(Math.min(e.width,e.height),t),i=a=t);for(var n=!0,s=e.width/i,o=e.height/a,h=0;h<i;h++)for(var u=0;u<a;u++){var c=Math.floor(s*(h+.5)),l=Math.floor(o*(u+.5)),d=r.getImageData(c,l,1,1).data;if(d[0]!==d[1]||d[0]!==d[2]){n=!1;break}}this._isGreyscale=n}return this._isGreyscale},isReady:function(){if(this._imageObject&&this._imageObject instanceof s)return this._imageObject.isReady();if(this.isCanvas()||this.isTypedArray()||this.isBitmap())return!0;if(this.isImage()){var t=this.getImage();if(t.complete)return void 0===t.naturalWidth||0!==t.naturalWidth}if(this.isVideo()&&0!==this.getWidth())return!0;var e=this.getImage();return!!e.complete&&(void 0===e.naturalWidth||0!==e.naturalWidth)},getMipmap:function(){return this._mipmap},hasMipmap:function(){return this._mipmap.length>1},release:function(){this._mipmap.length=0,this._imageObject=void 0}}),"osg","Image"),e.a=s},function(t,e,r){"use strict";var i=r(0),a=r(4),n=function(t){a.a.call(this),this.setMode(void 0!==t?t:n.BACK)};n.DISABLE=0,n.FRONT=1028,n.BACK=1029,n.FRONT_AND_BACK=1032,i.a.createPrototypeStateAttribute(n,i.a.objectInherit(a.a.prototype,{attributeType:"CullFace",cloneType:function(){return new n},setMode:function(t){var e=t;"string"==typeof e&&(e=n[e]),this._mode=e},getMode:function(){return this._mode},apply:function(t){t.applyCullFace(this)}}),"osg","CullFace"),e.a=n},function(t,e,r){"use strict";var i=r(0),a=r(1),n=i.a.objectInherit(a.g,{INSIDE:1,INTERSECT:2,OUTSIDE:3,transformProvidingInverse:function(){var t=n.create();return function(e,r){var i=e[0],a=e[1],s=e[2],o=e[3];return t[0]=r[0]*i+r[1]*a+r[2]*s+r[3]*o,t[1]=r[4]*i+r[5]*a+r[6]*s+r[7]*o,t[2]=r[8]*i+r[9]*a+r[10]*s+r[11]*o,t[3]=r[12]*i+r[13]*a+r[14]*s+r[15]*o,n.normalizeEquation(t),n.copy(t,e),e}},normalizeEquation:function(t){var e=1/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]*=e,t[1]*=e,t[2]*=e,t[3]*=e},getNormal:function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},setNormal:function(t,e){t[0]=e[0],t[1]=e[1],t[2]=e[2]},getDistance:function(t){return t[3]},setDistance:function(t,e){t[3]=e},distanceToPlane:function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]},intersectsOrContainsBoundingSphere:function(t,e){if(!e.valid())return n.OUTSIDE;var r=e.center(),i=e.radius(),a=this.distanceToPlane(t,r);return a<-i?n.OUTSIDE:a<=i?n.INTERSECT:n.INSIDE},instersectsBoundingSphere:function(t,e){return this.intersectsOrContainsBoundingSphere(t,e)===n.INTERSECT},intersectsOrContainsBoundingBox:function(){var t=a.f.create();return function(e,r){var i=(e[0]>=0?1:0)|(e[1]>=0?2:0)|(e[2]>=0?4:0),a=7&~i;return this.distanceToPlane(e,r.corner(a,t))>0?n.INSIDE:this.distanceToPlane(e,r.corner(i,t))<0?n.OUTSIDE:n.INTERSECT}}(),intersectsBoundingBox:function(t,e,r){return this.intersectsOrContainsBoundingBox(t,e,r)===n.INTERSECT},intersectOrContainsVertices:function(t,e){for(var r=-1,i=0;i<e.length;i++){var a=this.distanceToPlane(t,e[i]);if(a<0){if(1===r)return n.INTERSECT;r=2}else{if(!(a>0))return n.INTERSECT;if(2===r)return n.INTERSECT;r=1}}return r>0?n.INSIDE:n.OUTSIDE},intersectVertices:function(t,e){return this.intersectOrContainsVertices(t,e)===n.INTERSECT}});e.a=n},function(t,e,r){"use strict";var i=r(0),a=r(1),n=r(24),s=r(16),o=r(67),h=function(t){void 0!==t&&this.setName(t),s.a.call(this),this._invBindInSkeletonSpace=a.c.create(),this._boneInSkeletonSpace=a.c.create(),this._boneBoundingBox=new n.a};i.a.createPrototypeNode(h,i.a.objectInherit(s.a.prototype,{getOrCreateDebugColor:function(){return this._boneColor?this._boneColor:(this._boneColor=a.f.fromValues(Math.random(),Math.random(),Math.random()),this._boneColor)},getBoneBoundingBox:function(){return this._boneBoundingBox},setBoneBoundingBox:function(t){this._boneBoundingBox=t},getMatrixInSkeletonSpace:function(){return this._boneInSkeletonSpace},getInvBindMatrixInSkeletonSpace:function(){return this._invBindInSkeletonSpace},setMatrixInSkeletonSpace:function(t){a.c.copy(this._boneInSkeletonSpace,t)},setInvBindMatrixInSkeletonSpace:function(t){a.c.copy(this._invBindInSkeletonSpace,t)},getBoneParent:function(){for(var t=this.getParents(),e=0,r=t.length;e<r;e++){if(t[e].getTypeID()===h.getTypeID())return t[e]}},setDefaultUpdateCallback:function(t){this.addUpdateCallback(new o.a(void 0!==t?t:this.getName()))}}),"osgAnimation","Bone"),e.a=h},function(t,e,r){"use strict";var i=r(0),a=r(1),n=r(11),s=r(2),o=r(17),h=r(34),u=r(190),c=r(192),l=r(53),d=r(48),_=function(){n.a.call(this),this._shape=null,this.addUpdateCallback(new u.a),this._root=void 0,this._pathToRoot=void 0,this._isAnimatedPath=!1,this._boneNameID={},this._matrixFromSkeletonToGeometry=a.c.create(),this._invMatrixFromSkeletonToGeometry=a.c.create(),this._rigTransformImplementation=new c.a,this._geometry=void 0,this._stateSetAnimation=new o.a,this._needToComputeMatrix=!0};i.a.createPrototypeNode(_,i.a.objectInherit(n.a.prototype,{getStateSetAnimation:function(){return this._stateSetAnimation},getSkeleton:function(){return this._root},setSkeleton:function(t){this._root=t},setPathToSkeleton:function(t){this._pathToRoot=t,this._isAnimatedPath=l.a.checkPathIsAnimated(t)},setNeedToComputeMatrix:function(t){this._needToComputeMatrix=t},getNeedToComputeMatrix:function(){return this._needToComputeMatrix},computeBoundingBox:function(t){t.init();var e=this.getVertexAttributeList().Vertex,r=this.getVertexAttributeList().Weights;if(e&&r&&e.getElements()&&e.getItemSize()>2){for(var i=r.getElements(),a=e.getElements(),n=e.getItemSize(),s=t.getMin(),o=t.getMax(),h=s[0],u=s[1],c=s[2],l=o[0],d=o[1],_=o[2],f=0,g=0,p=a.length;f<p;f+=n,g+=4)if(0===i[f]&&0===i[f+1]&&0===i[f+2]&&0===i[f+3]){var m=a[f],v=a[f+1],S=a[f+2];m<h&&(h=m),m>l&&(l=m),v<u&&(u=v),v>d&&(d=v),S<c&&(c=S),S>_&&(_=S)}s[0]=h,s[1]=u,s[2]=c,o[0]=l,o[1]=d,o[2]=_}return t},computeMatrixFromRootSkeleton:function(){if(!this._root)return void s.a.warn("Warning "+this.className()+".computeMatrixFromRootSkeleton if you have this message it means you miss to call buildTransformer( root ), or your RigGeometry ("+this.getName()+") is not attached to a Skeleton subgraph");a.c.identity(this._matrixFromSkeletonToGeometry),d.a.computeLocalToWorld(this._pathToRoot,!0,this._matrixFromSkeletonToGeometry),a.c.invert(this._invMatrixFromSkeletonToGeometry,this._matrixFromSkeletonToGeometry),this._isAnimatedPath||(this._needToComputeMatrix=!1)},getMatrixFromSkeletonToGeometry:function(){return this._matrixFromSkeletonToGeometry},getInvMatrixFromSkeletonToGeometry:function(){return this._invMatrixFromSkeletonToGeometry},getSourceGeometry:function(){return this._geometry},setSourceGeometry:function(t){this._geometry=t},getBoneNameID:function(){return this._boneNameID},setBoneNameID:function(t){this._boneNameID=t},mergeChildrenVertexAttributeList:function(){this._geometry instanceof h.a&&this._geometry.mergeChildrenVertexAttributeList();var t=this._geometry.getVertexAttributeList();n.a.appendVertexAttributeToList(t,this.getVertexAttributeList())},mergeChildrenData:function(){this.mergeChildrenVertexAttributeList();var t=this._geometry.getPrimitiveSetList();this.getPrimitiveSetList().length=0;for(var e=0,r=t.length;e<r;e++)this.getPrimitiveSetList()[e]=t[e];this.getStateSet()&&console.error("A stateset in the rig is already present : "+this.getStateSet()),this.setStateSet(this._geometry.getStateSet())},update:function(){this._rigTransformImplementation.update(this)},computeTransformedVertex:function(t,e){e=e||a.f.create();var r=this.getVertexAttributeList(),i=r.Weights.getElements(),n=r.Bones.getElements(),s=0,o=0,h=0;if(this._geometry.computeTransformedVertex)this._geometry.computeTransformedVertex(t,e),s=e[0],o=e[1],h=e[2];else{var u=r.Vertex.getElements();s=u[3*t],o=u[3*t+1],h=u[3*t+2]}for(var c=4*t,l=this._rigTransformImplementation._skinningAttribute.getMatrixPalette(),d=0,_=0,f=0,g=0,p=0,m=0,v=0,S=0,b=0,x=0,y=0,M=0,T=0,A=!1,C=0;C<4;++C){var I=i[c+C];if(0!==I){var w=12*n[c+C];d+=l[w+0]*I,g+=l[w+1]*I,v+=l[w+2]*I,x+=l[w+3]*I,_+=l[w+4]*I,p+=l[w+5]*I,S+=l[w+6]*I,y+=l[w+7]*I,f+=l[w+8]*I,m+=l[w+9]*I,b+=l[w+10]*I,M+=l[w+11]*I,T+=I,A=!0}}A||(e[0]=s,e[1]=o,e[2]=h);var E=1/T;return e[0]=(d*s+g*o+v*h+x)*E,e[1]=(_*s+p*o+S*h+y)*E,e[2]=(f*s+m*o+b*h+M)*E,e},computeTransformedVertices:function(){for(var t=this.getVertexAttributeList(),e=this._geometry.computeTransformedVertices?this._geometry.computeTransformedVertices():t.Vertex.getElements(),r=t.Weights.getElements(),i=t.Bones.getElements(),a=this._riggedVerts||new Float32Array(e.length),n=this._rigTransformImplementation._skinningAttribute.getMatrixPalette(),s=0,o=0,h=e.length;s<h;s+=3,o+=4){var u,c=0,l=0,d=0,_=0,f=0,g=0,p=0,m=0,v=0,S=0,b=0,x=0,y=0,M=!1,T=r[o];0!==T&&(u=12*i[o],c+=n[u+0]*T,_+=n[u+1]*T,p+=n[u+2]*T,S+=n[u+3]*T,l+=n[u+4]*T,f+=n[u+5]*T,m+=n[u+6]*T,b+=n[u+7]*T,d+=n[u+8]*T,g+=n[u+9]*T,v+=n[u+10]*T,x+=n[u+11]*T,y+=T,M=!0),T=r[o+1],0!==T&&(u=12*i[o+1],c+=n[u+0]*T,_+=n[u+1]*T,p+=n[u+2]*T,S+=n[u+3]*T,l+=n[u+4]*T,f+=n[u+5]*T,m+=n[u+6]*T,b+=n[u+7]*T,d+=n[u+8]*T,g+=n[u+9]*T,v+=n[u+10]*T,x+=n[u+11]*T,y+=T,M=!0),T=r[o+2],0!==T&&(u=12*i[o+2],c+=n[u+0]*T,_+=n[u+1]*T,p+=n[u+2]*T,S+=n[u+3]*T,l+=n[u+4]*T,f+=n[u+5]*T,m+=n[u+6]*T,b+=n[u+7]*T,d+=n[u+8]*T,g+=n[u+9]*T,v+=n[u+10]*T,x+=n[u+11]*T,y+=T,M=!0),T=r[o+3],0!==T&&(u=12*i[o+3],c+=n[u+0]*T,_+=n[u+1]*T,p+=n[u+2]*T,S+=n[u+3]*T,l+=n[u+4]*T,f+=n[u+5]*T,m+=n[u+6]*T,b+=n[u+7]*T,d+=n[u+8]*T,g+=n[u+9]*T,v+=n[u+10]*T,x+=n[u+11]*T,y+=T,M=!0);var A=e[s],C=e[s+1],I=e[s+2];if(M){var w=1/y;a[s]=(c*A+_*C+p*I+S)*w,a[s+1]=(l*A+f*C+m*I+b)*w,a[s+2]=(d*A+g*C+v*I+x)*w}else a[s]=A,a[s+1]=C,a[s+2]=I}return a}}),"osgAnimation","RigGeometry"),e.a=_},function(t,e,r){"use strict";var i=r(1),a=r(36),n=r(125),s={},o=function(t,e,r,i,a,n){var s=r[0],o=r[r.length-1];return n.start=s,n.keys=e,n.end=o,n.times=r,n.type=t,n.duration=o-s,n.target=i,n.name=a,n},h=function(t,e,r,i,a){return o(n.a.Vec3,t,e,r,i,a||{})},u=function(t,e,r,i,a){return o(n.a.Float,t,e,r,i,a||{})},c=function(t,e,r,i,a){return o(n.a.Quat,t,e,r,i,a||{})},l=function(t,e,r,i,a){return o(n.a.QuatSlerp,t,e,r,i,a||{})},d=function(t,e,r,i,a){return o(n.a.FloatCubicBezier,t,e,r,i,a||{})},_=function(t,e,r,i,a){return o(n.a.Vec3CubicBezier,t,e,r,i,a||{})},f={create:function(){return 0}},g={create:function(){return i.f.create32()}},p={create:function(){return i.d.create32()}},m=function(t,e){return{channel:e,value:t.create(),targetID:a.a.InvalidTargetID,weight:1,key:0,start:0,end:0}},v=function(t){return m(g,t)},S=function(t){return m(p,t)},b=function(t){return m(f,t)},x=function(t){return m(f,t)},y=function(t){return m(g,t)},M=function(t){return s[t.type](t)};s.createInstanceChannel=M,s.createInstanceVec3Channel=v,s.createInstanceQuatChannel=S,s.createInstanceQuatSlerpChannel=S,s.createInstanceFloatChannel=b,s.createInstanceFloatCubicBezierChannel=x,s.createInstanceVec3CubicBezierChannel=y,s.createVec3Channel=h,s.createQuatChannel=c,s.createQuatSlerpChannel=l,s.createFloatChannel=u,s.createFloatCubicBezierChannel=d,s.createVec3CubicBezierChannel=_,s[n.a.Vec3]=v,s[n.a.Quat]=S,s[n.a.QuatSlerp]=S,s[n.a.Float]=b,s[n.a.FloatCubicBezier]=x,s[n.a.Vec3CubicBezier]=y,s.ChannelType=n.a,e.a=s},function(t,e,r){"use strict";var i=function(t){this._target=t,this._supportedEvents=[]};i.prototype={supportsEvent:function(t){for(var e=0;e<this._supportedEvents.length;e++){var r=this._supportedEvents[e];if(0===t.indexOf(r))return!0}return!1},setInputManager:function(t){this._inputManager=t}},e.a=i},function(t,e,r){"use strict";var i=r(1),a=r(12),n=function(t,e,r,n){var s=e,o=void 0!==n?n:t.length;void 0===s&&(s=!0);var h=r||i.c.create(),u=0;if(s){for(u=o-1;u>=0;u--){var c=t[u];if("Camera"===c.className()&&(c.getReferenceFrame()!==a.a.RELATIVE_RF||0===c.getParents().length))break}u+=1}for(var l=u,d=o;l<d;l++){var _=t[l];_.computeLocalToWorldMatrix&&_.computeLocalToWorldMatrix(h)}return h};e.a={computeLocalToWorld:n}},function(t,e,r){"use strict";var i=function(){i.prototype.reset.call(this)};i.prototype={reset:function(){this._computeNearFar=!0,this._nearFarRatio=.005,this._enableFrustumCulling=!1,this._settingsSourceOverrider=this,this._LODScale=1,this._clampProjectionMatrixCallback=void 0},setCullSettings:function(t){this._computeNearFar=t._computeNearFar,this._nearFarRatio=t._nearFarRatio,this._enableFrustumCulling=t._enableFrustumCulling,this._settingsSourceOverrider=t._settingsSourceOverrider,this._clampProjectionMatrixCallback=t._clampProjectionMatrixCallback},setNearFarRatio:function(t){this._nearFarRatio=t},getNearFarRatio:function(){return this._nearFarRatio},setComputeNearFar:function(t){this._computeNearFar=t},getComputeNearFar:function(){return this._computeNearFar},setEnableFrustumCulling:function(t){this._enableFrustumCulling=t},getEnableFrustumCulling:function(){return this._enableFrustumCulling},getSettingSourceOverrider:function(){return this._settingsSourceOverrider},setClampProjectionMatrixCallback:function(t){this._clampProjectionMatrixCallback=t},getClampProjectionMatrixCallback:function(){return this._clampProjectionMatrixCallback},setLODScale:function(t){this._LODScale=t},getLODScale:function(){return this._LODScale}},e.a=i},function(t,e,r){"use strict";var i=r(2),a=r(0),n=r(39),s=r(3),o=r(49),h=r(109),u=r(1),c=r(16),l=r(80),d=r(83),_=r(84),f=r(103),g=r(11),p=r(110),m=r(51),v=r(65),S=r(8),b=r(85),x=r(111),y=r(86),M=r(15),T=r(12),A=r(66),C=r(45),I=r(44),w=r(34),E=r(19),N=r(25),R=function(){return new p.a},O=function(){return new o.a},F=function(){s.a.call(this,s.a.TRAVERSE_ACTIVE_CHILDREN),o.a.call(this),h.a.call(this),this._rootStateGraph=void 0,this._currentStateGraph=void 0,this._currentRenderBin=void 0,this._currentRenderStage=void 0,this._rootRenderStage=void 0,this._computedNear=Number.POSITIVE_INFINITY,this._computedFar=Number.NEGATIVE_INFINITY,this._camera=void 0,this._pooledLeaf=new N.a(R),this._pooledRenderStages={},this._pooledCullSettings=new N.a(O),this._renderBinStack=new E.a,this.visitorType=s.a.CULL_VISITOR,this._identityMatrix=u.c.create(),this._renderer=void 0,this._renderStageType=v.a,this._numCamera=0,this._numMatrixTransform=0,this._numProjection=0,this._numNode=0,this._numLightSource=0,this._numGeometry=0};F.registerApplyFunction=f.default.registerApplyFunction,F.getApplyFunction=f.default.getApplyFunction,a.a.createPrototypeObject(F,a.a.objectInherit(h.a.prototype,a.a.objectInherit(s.a.prototype,{applyFunctionArray:f.default.applyFunctionArray,distance:function(t,e){return-(t[0]*e[2]+t[1]*e[6]+t[2]*e[10]+e[14])},getComputedNear:function(){return this._computedNear},getComputedFar:function(){return this._computedFar},resetStats:function(){this._numCamera=0,this._numMatrixTransform=0,this._numProjection=0,this._numNode=0,this._numLightSource=0,this._numGeometry=0},handleCullCallbacksAndTraverse:function(t){var e=t.getCullCallback();e&&!e.cull(t,this)||this.traverse(t)},getCurrentCamera:function(){return this._currentRenderBin.getStage().getCamera()},updateCalculatedNearFar:function(){var t=u.f.create(),e=u.f.create();return function(r,i){var a,n,s=i.getBoundingBox();if(a=this.distance(s.corner(this._bbCornerNear,t),r),n=this.distance(s.corner(this._bbCornerFar,e),r),a>n){var o=a;a=n,n=o}return!(n<0)&&(a<this._computedNear&&(this._computedNear=a),n>this._computedFar&&(this._computedFar=n),!0)}}(),setStateGraph:function(t){this._rootStateGraph=t,this._currentStateGraph=t},setRenderStage:function(t){this._rootRenderStage=t,this._currentRenderBin=t},setRenderer:function(t){this._renderer=t},getRenderer:function(){return this._renderer},reset:function(){h.a.prototype.reset.call(this),this._pooledLeaf.reset(),this._pooledCullSettings.reset();for(var t in this._pooledRenderStages)this._pooledRenderStages[t].reset();m.a.reset(),this._computedNear=Number.POSITIVE_INFINITY,this._computedFar=Number.NEGATIVE_INFINITY},getCurrentRenderBin:function(){return this._currentRenderBin},setCurrentRenderBin:function(t){this._currentRenderBin=t},addPositionedAttribute:function(t,e){var r=t||this._identityMatrix;this._currentRenderBin.getStage().addPositionAttribute(r,e)},pushStateSet:function(t){if(this._currentStateGraph=this._currentStateGraph.findOrInsert(t),void 0!==t.getBinName()){var e=this._renderBinStack,r=this._currentRenderBin;e.push(r),this._currentRenderBin=r.getStage().findOrInsert(t.getBinNumber(),t.getBinName())}},popStateSet:function(){var t=this._currentStateGraph,e=t.getStateSet();if(this._currentStateGraph=t.getParent(),void 0!==e.getBinName()){var r=this._renderBinStack;0===r.getLength()?this._currentRenderBin=this._currentRenderBin.getStage():this._currentRenderBin=r.pop()}},popProjectionMatrix:function(){if(!0===this._computeNearFar&&this._computedFar>=this._computedNear){var t=this.getCurrentProjectionMatrix();void 0!==this._clampProjectionMatrixCallback?this._clampProjectionMatrixCallback(t,this._computedNear,this._computedFar,this._nearFarRatio):this.clampProjectionMatrix(t,this._computedNear,this._computedFar,this._nearFarRatio)}h.a.prototype.popProjectionMatrix.call(this)},clampProjectionMatrix:function(t,e,r,a,n){if(r<e-1e-6)return i.a.log("clampProjectionMatrix not applied, invalid depth range, znear = "+e+"  zfar = "+r,!1,!0),!1;var s,o;if(r<e+1e-6){var h=.5*(e+r);e=h-1e-6,r=h+1e-6}if(Math.abs(t[3])<1e-6&&Math.abs(t[7])<1e-6&&Math.abs(t[11])<1e-6){var u=.02*(r-e);u<1&&(u=1),s=e-u,o=r+u,e=s,r=o,t[10]=-2/(o-s),t[14]=-(o+s)/(o-s)}else{s=.98*e,o=1.02*r;var c=r*a;s<c&&(s=c),e=s,r=o;var l=t[10],d=t[14],_=t[11],f=t[15],g=(-s*l+d)/(-s*_+f),p=(-o*l+d)/(-o*_+f),m=Math.abs(2/(g-p)),v=-(g+p)/2,S=v*m;t[2]=t[2]*m+t[3]*S,t[6]=t[6]*m+t[7]*S,t[10]=l*m+_*S,t[14]=d*m+f*S}return void 0!==n&&(n[0]=e,n[1]=r),!0},popCameraModelViewProjectionMatrix:function(){this.popModelViewMatrix(),this.popProjectionMatrix()},pushCameraModelViewProjectionMatrix:function(t,e,r){this.pushModelViewMatrix(e),this.pushProjectionMatrix(r)},apply:function(t){this.applyFunctionArray[t.nodeTypeID].call(this,t)},createOrReuseRenderLeaf:function(){return this._pooledLeaf.getOrCreateObject()},createOrReuseRenderStage:function(t){var e=t?t.className():"RenderStage";if(!this._pooledRenderStages[e]){var r=t?t.constructor:v.a,i=function(){return new r};this._pooledRenderStages[e]=new N.a(i)}return this._pooledRenderStages[e].getOrCreateObject().init()},postPushGeometry:function(t,e){var r,i;e instanceof C.a?(i=e.getStateSetAnimation(),i&&t.pushStateSet(i),(r=e.getSourceGeometry())instanceof w.a&&(i=r.getStateSetAnimation())&&t.pushStateSet(i)):e instanceof w.a&&(i=e.getStateSetAnimation())&&t.pushStateSet(i)},prePopGeometry:function(t,e){if(e instanceof C.a){var r=e.getSourceGeometry();r instanceof w.a&&r.getStateSetAnimation()&&t.popStateSet(),e.getStateSetAnimation()&&t.popStateSet()}else e instanceof w.a&&e.getStateSetAnimation()&&t.popStateSet()},pushLeaf:function(t,e){var r=this._currentStateGraph.getLeafs();r.getLength()||this._currentRenderBin.addStateGraph(this._currentStateGraph);var i=this.createOrReuseRenderLeaf();i.init(this._currentStateGraph,t,this.getCurrentProjectionMatrix(),this.getCurrentViewMatrix(),this.getCurrentModelViewMatrix(),this.getCurrentModelMatrix(),e),r.push(i)}})),"osg","CullVisitor");var P=function(t){this._numCamera++;var e=t.getStateSet();e&&this.pushStateSet(e);var r=this._pooledMatrix.getOrCreateObject(),i=this._pooledMatrix.getOrCreateObject();if(t.getReferenceFrame()===T.a.RELATIVE_RF){var a=this.getCurrentProjectionMatrix();u.c.mul(i,a,t.getProjectionMatrix());var n=this.getCurrentModelViewMatrix();u.c.mul(r,n,t.getViewMatrix())}else u.c.copy(r,t.getViewMatrix()),u.c.copy(i,t.getProjectionMatrix());var s=this._computedNear,o=this._computedFar,h=this._pooledCullSettings.getOrCreateObject();if(h.reset(),h.setCullSettings(this),this._computedNear=Number.POSITIVE_INFINITY,this._computedFar=Number.NEGATIVE_INFINITY,this.setCullSettings(t),h.getSettingSourceOverrider()===this&&h.getEnableFrustumCulling()&&this.setEnableFrustumCulling(!0),this.pushCameraModelViewProjectionMatrix(t,r,i),t.getViewport()&&this.pushViewport(t.getViewport()),t.getRenderOrder()===M.a.NESTED_RENDER)this.handleCullCallbacksAndTraverse(t);else{var c=this.getCurrentRenderBin(),l=c.getStage(),d=this.createOrReuseRenderStage(this._rootRenderStage);d.setCamera(t),d.setClearDepth(t.getClearDepth()),d.setClearColor(t.getClearColor()),d.setClearMask(t.getClearMask());var _=t.getViewport()?t.getViewport():l.getViewport(),f=t.getScissor()?t.getScissor():l.getScissor();d.setViewport(_),d.setScissor(f),this.setCurrentRenderBin(d),this.handleCullCallbacksAndTraverse(t),this.setCurrentRenderBin(c),t.getRenderOrder()===M.a.PRE_RENDER?this.getCurrentRenderBin().getStage().addPreRenderStage(d,t.renderOrderNum):this.getCurrentRenderBin().getStage().addPostRenderStage(d,t.renderOrderNum)}this.popCameraModelViewProjectionMatrix(t),t.getViewport()&&this.popViewport(),this.setCullSettings(h),this._computedNear=s,this._computedFar=o,e&&this.popStateSet()},L=function(t){if(this._numMatrixTransform++,!this.isCulled(t,this.nodePath)){this.pushCurrentMask();var e=this._pooledMatrix.getOrCreateObject(),r=this.getCurrentModelViewMatrix();u.c.copy(e,r),t.computeLocalToWorldMatrix(e),this.pushModelViewMatrix(e);var i=t.getStateSet();i&&this.pushStateSet(i),this.handleCullCallbacksAndTraverse(t),i&&this.popStateSet(),this.popModelViewMatrix(),this.popCurrentMask()}},D=function(t){this._numProjection++;var e=this.getCurrentProjectionMatrix(),r=this._pooledMatrix.getOrCreateObject();u.c.mul(r,e,t.getProjectionMatrix()),this.pushProjectionMatrix(r);var i=t.getStateSet();i&&this.pushStateSet(i),this.handleCullCallbacksAndTraverse(t),i&&this.popStateSet(),this.popProjectionMatrix()},V=function(t){if(this._numNode++,!this.isCulled(t,this.nodePath)){this.pushCurrentMask();var e=t.getStateSet();e&&this.pushStateSet(e),this.handleCullCallbacksAndTraverse(t),e&&this.popStateSet(),this.popCurrentMask()}},B=function(t){this._numLightSource++;var e=t.getStateSet();e&&this.pushStateSet(e);var r=t.getLight();r&&(t.getReferenceFrame()===T.a.RELATIVE_RF?this.addPositionedAttribute(this.getCurrentModelViewMatrix(),r):this.addPositionedAttribute(null,r)),this.handleCullCallbacksAndTraverse(t),e&&this.popStateSet()},U=u.f.create(),k=!1,G=function(t){this._numGeometry++;var e=this.getCurrentModelViewMatrix(),r=t.getBoundingBox();if(!this._computeNearFar||!r.valid()||this.updateCalculatedNearFar(e,t)){var a=t.getCullCallback();if(!a||a.cull(t,this)){var s=t.getStateSet();s&&this.pushStateSet(s),this.postPushGeometry(this,t);var o=0;r.valid()&&(o=this.distance(r.center(U),e)),n.a.isNaN(o)?k||(i.a.warn("warning geometry has a NaN depth, "+e+" center "+U),k=!0):this.pushLeaf(t,o),this.prePopGeometry(this,t),s&&this.popStateSet()}}};f.default.registerApplyFunction(S.a.nodeTypeID,V),f.default.registerApplyFunction(x.a.nodeTypeID,V),f.default.registerApplyFunction(y.a.nodeTypeID,V),f.default.registerApplyFunction(M.a.nodeTypeID,P),f.default.registerApplyFunction(c.a.nodeTypeID,L),f.default.registerApplyFunction(d.a.nodeTypeID,D),f.default.registerApplyFunction(g.a.nodeTypeID,G),f.default.registerApplyFunction(A.a.nodeTypeID,L),f.default.registerApplyFunction(I.a.nodeTypeID,L),f.default.registerApplyFunction(l.a.nodeTypeID,L),f.default.registerApplyFunction(b.a.nodeTypeID,V),f.default.registerApplyFunction(_.a.nodeTypeID,B),f.default.registerApplyFunction(C.a.nodeTypeID,G),f.default.registerApplyFunction(w.a.nodeTypeID,G),e.a=F},function(t,e,r){"use strict";var i=r(0),a=r(2),n=r(5),s=r(39),o=r(25),h=r(19),u=r(63),c=function(){return[null,null]},l=function(t){n.a.call(this),this._renderStage=void 0,this._parent=void 0,this._binNum=0,this._sorted=!1,this._sortMode=void 0!==t?t:l.defaultSortMode,this._drawCallback=void 0,this._leafs=[],this._pooledPositionedAttribute=new o.a(c),this._positionedAttribute=new h.a,this._stateGraphList=new h.a,this._bins=new u.a,l.prototype.init.call(this,t)};l.SORT_BY_STATE=0,l.SORT_BACK_TO_FRONT=1,l.SORT_FRONT_TO_BACK=2,l.defaultSortMode=l.SORT_BY_STATE;var d=function(){return new l},_=new o.a(d);l.BinPrototypes={RenderBin:function(){return _.getOrCreateObject().init()},DepthSortedBin:function(){return _.getOrCreateObject().init(l.SORT_BACK_TO_FRONT)}};var f=function(t,e){return e._depth-t._depth},g=function(t,e){return t._depth-e._depth},p=function(t,e){return t._binNum-e._binNum};i.a.createPrototypeObject(l,i.a.objectInherit(n.a.prototype,{init:function(t){return this._renderStage=void 0,this._parent=void 0,this._binNum=0,this._sortMode=void 0!==t?t:l.defaultSortMode,this._drawCallback=void 0,l.prototype._initInternal.call(this),this},_initInternal:function(){this._bins.reset(),this._stateGraphList.reset(),this._positionedAttribute.reset(),this._pooledPositionedAttribute.reset(),this._leafs.length=0,this._sorted=!1},_createRenderBin:function(t){var e=l.BinPrototypes.RenderBin;return t&&l.BinPrototypes[t]&&(e=l.BinPrototypes[t]),e()},addPositionAttribute:function(t,e){var r=this._pooledPositionedAttribute.getOrCreateObject();r[0]=t,r[1]=e,this._positionedAttribute.push(r)},getStateGraphList:function(){return this._stateGraphList},getPositionedAttribute:function(){return this._positionedAttribute},copyLeavesFromStateGraphListToRenderLeafList:function(){this._leafs.length=0;for(var t=!1,e=this._stateGraphList.getArray(),r=this._stateGraphList.getLength(),i=0;i<r;i++)for(var n=e[i]._leafs,o=n.getArray(),h=n.getLength(),u=0;u<h;u++){var c=o[u];s.a.isNaN(c._depth)?t=!0:this._leafs.push(c)}t&&a.a.debug("warning: RenderBin::copyLeavesFromStateGraphListToRenderLeafList() detected NaN depth values, database may be corrupted."),this._stateGraphList.reset()},getSortMode:function(){return this._sortMode},sortBackToFront:function(){this.copyLeavesFromStateGraphListToRenderLeafList(),this._leafs.sort(f)},sortFrontToBack:function(){this.copyLeavesFromStateGraphListToRenderLeafList(),this._leafs.sort(g)},sortImplementation:function(){var t=l;switch(this._sortMode){case t.SORT_BACK_TO_FRONT:this.sortBackToFront();break;case t.SORT_FRONT_TO_BACK:this.sortFrontToBack();break;case t.SORT_BY_STATE:}},sort:function(){if(!this._sorted){for(var t=this._bins.getKeys(),e=this._bins.getMap(),r=t.getArray(),i=t.getLength(),a=0;a<i;a++){e[r[a]].sort()}this.sortImplementation(),this._sorted=!0}},setParent:function(t){this._parent=t},getParent:function(){return this._parent},getBinNumber:function(){return this._binNum},findOrInsert:function(t,e){var r=this._bins.getMap(),i=r[t];return i||(i=this._createRenderBin(e),i._parent=this,i._binNum=t,i._renderStage=this._renderStage,this._bins.set(t,i)),i},getStage:function(){return this._renderStage},addStateGraph:function(t){this._stateGraphList.push(t)},reset:function(){l.prototype._initInternal.call(this)},draw:function(t,e){var r=e;return r=this._drawCallback&&this._drawCallback.drawImplementation?this._drawCallback.drawImplementation(this,t,r):this.drawImplementation(t,r)},applyPositionedAttribute:function(t,e){for(var r=e.getArray(),i=e.getLength(),a=0,n=i;a<n;a++){var s=r[a],o=s[1],h=s[0];t.setGlobalDefaultAttribute(o),o.apply(t),o.applyPositionedUniform(h,t),t.haveAppliedAttribute(o)}},drawImplementation:function(t,e){for(var r=e,i=[],a=this._bins.getMap(),n=this._bins.getKeys(),s=n.getLength(),o=n.getArray(),h=0;h<s;h++){var u=o[h];i.push(a[u])}i.sort(p);for(var c,l=0,d=i.length;l<d&&(c=i[l],!(c.getBinNumber()>0));l++)r=c.draw(t,r);for(r=this.drawLeafs(t,r);l<d;l++)c=i[l],r=c.draw(t,r);return r},drawLeafs:function(t,e){for(var r,i=this._stateGraphList.getArray(),a=this._stateGraphList.getLength(),n=this._leafs,s=e,o=0,h=n.length;o<h;o++)r=n[o],r.render(t,s),s=r;for(var u=0,c=a;u<c;u++)for(var l=i[u],d=l._leafs.getArray(),_=l._leafs.getLength(),f=0;f<_;f++)r=d[f],r.render(t,s),s=r;return s}}),"osg","RenderBin"),l.reset=function(){_.reset()},l.clean=function(){_.clean()},e.a=l},function(t,e,r){"use strict";var i=r(0),a=r(1),n=r(53),s=function(){n.a.call(this),this._stackedTransforms=[],this._matrix=a.c.create(),this._dirty=!1};i.a.createPrototypeObject(s,i.a.objectInherit(n.a.prototype,{getStackedTransforms:function(){return this._stackedTransforms},setMatrix:function(t){a.c.copy(this._matrix,t),this._dirty=!0},getMatrix:function(){return this._matrix},computeChannels:function(){this._dirty=!0;var t=this._matrix;a.c.identity(t);for(var e=this._stackedTransforms,r=0,i=e.length;r<i;r++){e[r].applyToMatrix(t)}},reset:function(){for(var t=this._stackedTransforms,e=0,r=t.length;e<r;e++)t[e].resetToDefaultValue();this.computeChannels()},update:function(t){return a.c.copy(t.getMatrix(),this._matrix),this._dirty&&(t.dirtyBound(),this._dirty=!1),!0}}),"osgAnimation","UpdateMatrixTransform"),e.a=s},function(t,e,r){"use strict";var i=r(0),a=r(5),n=r(16),s=function(){a.a.call(this)};s.checkPathIsAnimated=function(t){for(var e=0,r=t.length;e<r;++e){var i=t[e];if(i instanceof n.a)for(var a=i.getUpdateCallbackList(),o=0,h=a.length;o<h;++o)if(a[o]instanceof s)return!0}return!1},i.a.createPrototypeObject(s,i.a.objectInherit(a.a.prototype,{computeChannels:function(){},reset:function(){}}),"osgAnimation","AnimationUpdateCallback"),e.a=s},function(t,e,r){"use strict";var i=r(0),a=r(4),n=r(6),s=r(1),o=function(t,e){a.a.call(this);var r=void 0!==t?t:0;this._ambient=s.g.fromValues(.2,.2,.2,1),this._diffuse=s.g.fromValues(.8,.8,.8,1),this._specular=s.g.fromValues(.2,.2,.2,1),this._position=s.g.fromValues(0,0,1,0),this._direction=s.f.fromValues(0,0,-1),this._ground=s.g.fromValues(.2,.2,.2,-1),this._spotCutoff=180,this._spotBlend=.01,this._attenuation=s.g.fromValues(1,0,0,0),this._lightNumber=r,this._enable=!e,this._dirtyHash=!0,this._hash=""};o.DIRECTION="DIRECTION",o.SPOT="SPOT",o.POINT="POINT",o.HEMI="HEMI",o.uniforms={},i.a.createPrototypeStateAttribute(o,i.a.objectInherit(a.a.prototype,{attributeType:"Light",cloneType:function(){return new o(this._lightNumber,!0)},getTypeMember:function(){return this.attributeType+this._lightNumber},getUniformName:function(t){return"u"+this.getTypeMember()+"_"+t},getHash:function(){return this._dirtyHash?(this._hash=this._computeInternalHash(),this._dirtyHash=!1,this._hash):this._hash},_computeInternalHash:function(){return this.getTypeMember()+this.getLightType()+this.isEnabled().toString()},getOrCreateUniforms:function(){var t=o,e=this.getTypeMember();return t.uniforms[e]?t.uniforms[e]:(t.uniforms[e]={viewPosition:n.a.createFloat4(this.getUniformName("viewPosition")),viewDirection:n.a.createFloat3(this.getUniformName("viewDirection")),modelViewMatrix:n.a.createMatrix4(this.getUniformName("modelViewMatrix")),modelViewNormalMatrix:n.a.createMatrix3(this.getUniformName("modelViewNormalMatrix")),ambient:n.a.createFloat4(this.getUniformName("ambient")),diffuse:n.a.createFloat4(this.getUniformName("diffuse")),specular:n.a.createFloat4(this.getUniformName("specular")),attenuation:n.a.createFloat4(this.getUniformName("attenuation")),spotCutOff:n.a.createFloat1(this.getUniformName("spotCutOff")),spotBlend:n.a.createFloat1(this.getUniformName("spotBlend")),ground:n.a.createFloat4(this.getUniformName("ground"))},t.uniforms[e])},isEnabled:function(){return this._enable},setEnabled:function(t){this._enable=t,this._dirtyHash=!0},setAmbient:function(t){s.g.copy(this._ambient,t)},getAmbient:function(){return this._ambient},setDiffuse:function(t){s.g.copy(this._diffuse,t)},getDiffuse:function(){return this._diffuse},setSpecular:function(t){s.g.copy(this._specular,t)},getSpecular:function(){return this._specular},setPosition:function(t){s.g.copy(this._position,t)},getPosition:function(){return this._position},setDirection:function(t){s.f.copy(this._direction,t)},getDirection:function(){return this._direction},setSpotCutoff:function(t){this._spotCutoff=t},getSpotCutoff:function(){return this._spotCutoff},setSpotBlend:function(t){this._spotBlend=t},getSpotBlend:function(){return this._spotBlend},setGround:function(t){s.f.copy(this._ground,t)},getGround:function(){return this._ground},setConstantAttenuation:function(t){this._attenuation[0]=t},getConstantAttenuation:function(){return this._attenuation[0]},setLinearAttenuation:function(t){this._attenuation[1]=t},getLinearAttenuation:function(){return this._attenuation[1]},setQuadraticAttenuation:function(t){this._attenuation[2]=t},getQuadraticAttenuation:function(){return this._attenuation[2]},setLightType:function(t){return t===o.DIRECTION?this.setLightAsDirection():t===o.SPOT?this.setLightAsSpot():t===o.HEMI?this.setLightAsHemi():this.setLightAsPoint()},getLightType:function(){return this.isDirectionLight()?o.DIRECTION:this.isSpotLight()?o.SPOT:this.isHemiLight()?o.HEMI:o.POINT},setLightAsSpot:function(){s.g.set(this._position,0,0,0,1),s.f.set(this._direction,0,0,-1),this._ground[3]=-1,this._spotCutoff=90,this._dirtyHash=!0},setLightAsPoint:function(){s.g.set(this._position,0,0,0,1),s.f.set(this._direction,0,0,-1),this._ground[3]=-1,this._dirtyHash=!0},setLightAsDirection:function(){s.g.set(this._position,0,0,1,0),this._spotCutoff=180,this._ground[3]=-1,this._dirtyHash=!0},setLightAsHemi:function(){s.g.set(this._position,0,0,1,0),this._spotCutoff=180,this._ground[3]=1,this._dirtyHash=!0},setLightNumber:function(t){this._lightNumber=t,this._dirtyHash=!0},getLightNumber:function(){return this._lightNumber},isSpotLight:function(){return this._spotCutoff<180},isDirectionLight:function(){return 0===this._position[3]&&-1===this._ground[3]},isHemiLight:function(){return 1===this._ground[3]},applyPositionedUniform:function(t){var e=this.getOrCreateUniforms(),r=e.modelViewMatrix.getInternalArray(),i=e.modelViewNormalMatrix.getInternalArray(),a=e.viewPosition.getInternalArray(),n=e.viewDirection.getInternalArray();s.c.copy(r,t),s.b.normalFromMat4(i,t),s.g.transformMat4(a,this._position,r),s.f.transformMat3(n,this._direction,i)},apply:function(){if(this._enable){var t=this.getOrCreateUniforms();if(this.isSpotLight()){var e=Math.cos(this._spotCutoff*Math.PI/180);t.spotCutOff.setFloat(e),t.spotBlend.setFloat((1-e)*this._spotBlend)}this.isHemiLight()&&t.ground.setFloat4(this._ground),t.attenuation.setFloat4(this._attenuation),t.diffuse.setFloat4(this._diffuse),t.specular.setFloat4(this._specular),t.ambient.setFloat4(this._ambient)}}}),"osg","Light"),e.a=o},function(t,e,r){"use strict";var i=r(2),a={instance:function(){return a._instance||(a._instance=a,a._instance.plugins=new window.Map),a._instance},addReaderWriter:function(t,e){void 0!==a.instance().plugins.get(t)&&i.a.warn("the '"+t+"' plugin already exists"),a.instance().plugins.set(t,e)},getReaderWriterForExtension:function(t){return a.instance().plugins.get(t)}};e.a=a},function(t,e,r){"use strict";var i=r(0),a=r(3),n=r(1),s=r(25),o=r(19),h=r(12),u=function(){a.a.call(this),this._intersector=void 0,this._projectionStack=new o.a,this._modelStack=new o.a,this._viewStack=new o.a,this._windowStack=new o.a,this._pooledMatrix=new s.a(n.c.create),this.reset()};i.a.createPrototypeObject(u,i.a.objectInherit(a.a.prototype,{reset:function(){this._pooledMatrix.reset(),this._viewStack.reset(),this._modelStack.reset(),this._projectionStack.reset(),this._windowStack.reset(),this._viewStack.push(n.c.IDENTITY),this._modelStack.push(n.c.IDENTITY),this._projectionStack.push(n.c.IDENTITY),this._windowStack.push(n.c.IDENTITY)},setIntersector:function(t){this._intersector=t},getIntersector:function(){return this._intersector},pushModelMatrix:function(t){this._modelStack.push(t)},getModelMatrix:function(){return this._modelStack.back()},popModelMatrix:function(){return this._modelStack.pop()},pushViewMatrix:function(t){this._viewStack.push(t)},getViewMatrix:function(){return this._viewStack.back()},popViewMatrix:function(){return this._viewStack.pop()},pushProjectionMatrix:function(t){this._projectionStack.push(t)},getProjectionMatrix:function(){return this._projectionStack.back()},popProjectionMatrix:function(){return this._projectionStack.pop()},pushWindowMatrix:function(t){this._windowStack.push(t)},pushWindowMatrixUsingViewport:function(t){this._windowStack.push(t.computeWindowMatrix(this._pooledMatrix.getOrCreateObject()))},getWindowMatrix:function(){return this._windowStack.back()},popWindowMatrix:function(){return this._windowStack.pop()},getTransformation:function(){var t=n.c.create64();return function(){return n.c.copy(t,this.getWindowMatrix()),n.c.mul(t,t,this.getProjectionMatrix()),n.c.mul(t,t,this.getViewMatrix()),n.c.mul(t,t,this.getModelMatrix()),t}}(),enter:function(t){return this._intersector.enter(t)},apply:function(t){t.getViewMatrix?this.applyCamera(t):t.getMatrix?this.applyTransform(t):this.applyNode(t)},applyCamera:function(t){var e=t.getViewport();void 0!==e&&this.pushWindowMatrixUsingViewport(e);var r,i,a;t.getReferenceFrame()===h.a.RELATIVE_RF&&this.getViewMatrix()&&this.getProjectionMatrix()?(r=n.c.mul(this._pooledMatrix.getOrCreateObject(),this.getProjectionMatrix(),t.getProjectionMatrix()),i=this.getViewMatrix(),a=n.c.mul(this._pooledMatrix.getOrCreateObject(),this.getModelMatrix(),t.getViewMatrix())):(r=t.getProjectionMatrix(),i=t.getViewMatrix(),a=n.c.identity(this._pooledMatrix.getOrCreateObject())),this.pushProjectionMatrix(r),this.pushViewMatrix(i),this.pushModelMatrix(a),this._intersector.setCurrentTransformation(this.getTransformation()),this.traverse(t),this.popModelMatrix(),this.popViewMatrix(),this.popProjectionMatrix(),void 0!==e&&this.popWindowMatrix(),this._intersector.setCurrentTransformation(this.getTransformation())},applyNode:function(t){if(this.enter(t))return t.getPrimitiveSetList?void this._intersector.intersect(this,t):void(t.traverse&&this.traverse(t))},applyTransform:function(t){if(this.enter(t)){if(t.getReferenceFrame()===h.a.ABSOLUTE_RF){var e=this._pooledMatrix.getOrCreateObject();this.pushViewMatrix(n.c.identity(e)),this.pushModelMatrix(t.getMatrix())}else if(this._modelStack.getLength()>0){var r=n.c.copy(this._pooledMatrix.getOrCreateObject(),this.getModelMatrix());n.c.mul(r,r,t.getMatrix()),this.pushModelMatrix(r)}else this.pushModelMatrix(t.getMatrix());this._intersector.setCurrentTransformation(this.getTransformation()),this.traverse(t),this.popModelMatrix(),t.getReferenceFrame()===h.a.ABSOLUTE_RF&&this.popViewMatrix(),this._intersector.setCurrentTransformation(this.getTransformation())}}}),"osgUtil","IntersectionVisitor"),e.a=u},function(t,e,r){"use strict";var i=r(0),a=r(1),n=r(74),s=r(140),o=function(){n.a.call(this),this._start=a.f.create(),this._iStart=a.f.create(),this._end=a.f.create(),this._iEnd=a.f.create(),this._threshold=0,this._iThreshold=0};i.a.createPrototypeObject(o,i.a.objectInherit(n.a.prototype,{set:function(t,e,r){a.f.copy(this._start,t),a.f.copy(this._iStart,t),a.f.copy(this._end,e),a.f.copy(this._iEnd,e),void 0!==r&&(this._threshold=this._iThreshold=r)},setStart:function(t){a.f.copy(this._start,t),a.f.copy(this._iStart,t)},setEnd:function(t){a.f.copy(this._end,t),a.f.copy(this._iEnd,t)},intersectNode:function(t){return this.intersectBoundingSphere(t.getBoundingSphere())},intersectBoundingSphere:function(){var t=a.f.create(),e=a.f.create();return function(r){if(!r.valid())return!1;a.f.sub(t,this._iStart,r.center());var i=a.f.sqrLen(t)-r.radius2();if(i<=0)return!0;a.f.sub(e,this._iEnd,this._iStart);var n=a.f.sqrLen(e),s=2*a.f.dot(t,e),o=s*s-4*n*i;if(o<0)return!1;o=Math.sqrt(o);var h=.5/n,u=(-s-o)*h,c=(-s+o)*h;return!(u<=0&&c<=0)&&!(u>1&&c>1)}}(),intersect:function(){var t=new s.a;return function(e,r){t.setGeometry(r),t.setIntersectionVisitor(e),t.setIntersector(this),t.set(this._iStart,this._iEnd,this._iThreshold);var i=r.getShape();if(i)return void i.intersectLineSegment(t,i.getNodes()[0],this._iStart,this._iEnd,this._iThreshold);r.computeTransformedVertices&&t.setVertices(r.computeTransformedVertices()),t.apply(r),t.reset()}}(),setCurrentTransformation:function(t){if(a.c.invert(t,t),this._threshold>0){var e=this._iStart;a.c.getScale(e,t);var r=e[0],i=e[1],n=e[2];this._iThreshold=this._threshold*(r>i?r>n?r:n:i>n?i:n)}a.f.transformMat4(this._iStart,this._start,t),a.f.transformMat4(this._iEnd,this._end,t)}}),"osgUtil","LineSegmentIntersector"),e.a=o},function(t,e,r){"use strict";var i=r(0),a=r(2),n=r(21),s=r(26),o=r(59),h=r(68),u=function(){this._cache={},this._shaderProcessor=new h.a,this._ShaderCompiler=void 0,this.setShaderCompiler(o.a)};u.prototype={setShaderCompiler:function(t){this._ShaderCompiler=t,t._validAttributeTypeMemberCache||this._computeStateAttributeCache(t)},getShaderCompiler:function(){return this._ShaderCompiler},getShaderProcessor:function(){return this._shaderProcessor},setShaderProcessor:function(t){this._shaderProcessor=t},filterAttributeTypes:function(t){return!(!t.isEnabled||t.isEnabled())},getActiveAttributeList:function(t,e){for(var r="",i=t._attributeArray,a=this._ShaderCompiler._validAttributeTypeMemberCache,n=0,s=a.length;n<s;n++){var o=a[n],h=o<i.length?i[o]:void 0;if(h){var u=h._lastApplied;u&&!this.filterAttributeTypes(u)&&(r+=u.getHash(),e.push(u))}}return r},getActiveAttributeListCache:function(t){for(var e="",r=this._ShaderCompiler._validAttributeTypeMemberCache,i=0,a=r.length;i<a;i++){var n=r[i],s=n<t._attributeArray.length?t._attributeArray[n]:void 0;if(s){var o=s._lastApplied;if(!o||this.filterAttributeTypes(o))continue;e+=s._lastApplied.getHash()}}return e},getActiveTextureAttributeListCache:function(t){for(var e="",r=this._ShaderCompiler._validTextureAttributeTypeMemberCache,i=t._textureAttributeArrayList,a=0;a<i.length;a++){var n=i[a];if(n)for(var s=n.length,o=0;o<r.length;o++){var h=r[o],u=h<s?n[h]:void 0;if(u){var c=u._lastApplied;if(!c||this.filterAttributeTypes(c)||c.isTextureNull())continue;e+=c.getHash()}}}return e},getActiveTextureAttributeList:function(t,e){var r,i,a="",n=t._textureAttributeArrayList,s=this._ShaderCompiler._validTextureAttributeTypeMemberCache;for(r=0,i=n.length;r<i;r++){var o=n[r];if(o){e[r]=[];for(var h=0,u=s.length;h<u;h++){var c=s[h],l=c<o.length?o[c]:void 0;if(l){var d=l._lastApplied;!d||this.filterAttributeTypes(d)||d.isTextureNull()||(a+=d.getHash(),e[r].push(d))}}}}return a},getActiveUniforms:function(t,e,r){for(var i={},a=0,n=e.length;a<n;a++){var s=e[a];if(s.getOrCreateUniforms){var o=s.getOrCreateUniforms();if(void 0!==o)for(var h in o){var u=o[h];i[u.getName()]=u}}}for(var c=0,l=r.length;c<l;c++){var d=r[c];if(d)for(var _=0,f=d.length;_<f;_++){var g=d[_],p=g.getOrCreateUniforms(c);for(var m in p){var v=p[m];i[v.getName()]=v}}}return i},_computeStateAttributeCache:function(t){var e,r,n,s,o,h=t.stateAttributeConfig.attribute||[],u=[];for(r=0,n=h.length;r<n;r++)e=h[r],void 0!==(o=i.a.getIdFromTypeMember(e))&&(-1!==u.indexOf(o)?a.a.warn("Compiler "+t.name+" contains duplicate attribute entry "+e+", check the Compiler configuration"):u.push(o));for(s=new Uint8Array(u),t._validAttributeTypeMemberCache=s,h=t.stateAttributeConfig.textureAttribute||[],u=[],r=0,n=h.length;r<n;r++)e=h[r],o=i.a.getTextureIdFromTypeMember(e),-1!==u.indexOf(o)?a.a.warn("Compiler "+t.name+" contains duplicate texture attribute entry "+e+", check the Compiler configuration"):u.push(o);s=new Uint8Array(u),t._validTextureAttributeTypeMemberCache=s},_createWaitingProgram:function(t,e,r){var i=new n.a(new s.a(s.a.VERTEX_SHADER,"attribute vec3 Vertex;uniform mat4 uModelViewMatrix;uniform mat4 uProjectionMatrix;void main(void) {  gl_Position = vec4(10.0,10.0,10.0,1.0);}\n"),new s.a(s.a.FRAGMENT_SHADER,"#define SHADER_NAME WaitSafe\nprecision lowp float; void main(void) { gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);}\n"));return this.getActiveAttributeList(t,e),i.setActiveUniforms(this.getActiveUniforms(t,e,r)),i.generated=!0,i.apply(t),i},getOrCreateProgram:function(){var t=[],e=[];return function(r){var i=this.getActiveAttributeListCache(r)+this.getActiveTextureAttributeListCache(r),a=this._getProgram(i,r,e,t);return void 0!==a?a:this._createProgram(i,r,e,t)}}(),_getProgram:function(t){return this._cache[t]},_createProgram:function(t,e,r,i){r.length=0,i.length=0,this.getActiveAttributeList(e,r),this.getActiveTextureAttributeList(e,i);var a=this._ShaderCompiler,o=new a(r,i,this._shaderProcessor),h=o.createFragmentShader(),u=o.createVertexShader(),c=new n.a(new s.a(s.a.VERTEX_SHADER,u),new s.a(s.a.FRAGMENT_SHADER,h));return c.hash=t,c.setActiveUniforms(this.getActiveUniforms(e,r,i)),c.generated=!0,this._cache[t]=c,c.apply(e),c},resetCache:function(){this._cache={}}},e.a=u},function(t,e,r){"use strict";var i=r(2),a=r(6),n=r(155),s=r(0),o=r(231),h=r(232),u=function(t,e,r){this._attributes=t,this._textureAttributes=e,this._fragmentShaderMode=!1,this._activeNodeMap={},this._compiledNodeMap={},this._traversedNodeMap={},this._variables={},this._varyings={},this._vertexShader=[],this._fragmentShader=[],this._shaderProcessor=r,this._texturesByName={},this._shadowsTextures=[],this._lights=[],this._shadows=[],this._textures=[],this._material=null,this._invariantPosition=!1,this._isBillboard=!1,this._customVertexShader=!1,this._customFragmentShader=!1,this.initAttributes(),this.initTextureAttributes()};u.cloneStateAttributeConfig=function(t){return JSON.parse(JSON.stringify(t.stateAttributeConfig))},u.setStateAttributeConfig=function(t,e){t.stateAttributeConfig=e,e.attribute.forEach(s.a.getOrCreateStateAttributeTypeMemberIndexFromName),e.textureAttribute.forEach(s.a.getOrCreateTextureStateAttributeTypeMemberIndexFromName),t.validAttributeTypeMember=e.attribute,t.validTextureAttributeTypeMember=e.textureAttribute},u.setStateAttributeConfig(u,{attribute:["Light0","ShadowReceive0","Light1","ShadowReceive1","Light2","ShadowReceive2","Light3","ShadowReceive3","Light4","Light5","Light6","Light7","Material","PointSize","Billboard","Morph","Skinning"],textureAttribute:["Texture"]}),u.prototype=s.a.extend({},o.a,h.a,{constructor:u,createFragmentShader:function(){return this._fragmentShaderMode=!0,this._createFragmentShader()},createVertexShader:function(){return this._fragmentShaderMode=!1,this._createVertexShader()},getOrCreateProjectionMatrix:function(){return this.getOrCreateUniform("mat4","uProjectionMatrix")},getCompilerName:function(){return this._material?"CompilerOSGJS":"NoMaterialCompilerOSGJS"},getFragmentShaderName:function(){var t=this.getCompilerName(),e=this._material&&this._material.getName();return e&&(e=e.replace(/[^a-zA-Z0-9]+/g,"_").slice(0,20),t+="("+e+")"),t},getVertexShaderName:function(){return this.getFragmentShaderName()},getDebugIdentifier:function(){var t=this.getVertexShaderName(),e=this.getFragmentShaderName();return t===e?e:t+"|"+e},logError:function(t){i.a.error(this.getDebugIdentifier()+" : "+t)},logWarn:function(t){i.a.warn(this.getDebugIdentifier()+" : "+t)},getOrCreateConstantOne:function(t){return this.getOrCreateConstant(t,t+"White").setValue(t+"(1.0)")},getOrCreateConstantZero:function(t){return this.getOrCreateConstant(t,t+"Black").setValue(t+"(0.0)")},initAttributes:function(){for(var t=this._attributes,e=this._lights,r=this._shadows,i=0,a=t.length;i<a;i++){var n=t[i].className();"Light"===n?e.push(t[i]):"Material"===n?this._material=t[i]:"ShadowReceiveAttribute"===n?r.push(t[i]):"Billboard"===n?this._isBillboard=!!t[i]:"SkinningAttribute"===n?this._skinningAttribute=t[i]:"MorphAttribute"===n?this._morphAttribute=t[i]:"PointSizeAttribute"===n&&(this._pointSizeAttribute=t[i])}},initTextureAttributes:function(){var t=this._textureAttributes,e=t.length;this._textures.length=this._shadowsTextures.length=e;for(var r=0;r<e;r++){var i=t[r];if(void 0!==i)for(var a=0,n=i.length;a<n;a++)this.registerTextureAttributes(i[a],r)}},registerTextureAttributes:function(t,e){var r=t.className();return"Texture"===r?this.registerTexture(t,e):-1!==r.indexOf("ShadowTexture")?this.registerTextureShadow(t,e):void 0},registerTexture:function(t,e){var r=t.getName();r||(r="Texture"+e,t.setName(r)),this._textures[e]=t,this._texturesByName[r]={texture:t,variable:void 0,textureUnit:e}},registerTextureShadow:function(t,e){var r=t.getName();r||(r="Texture"+e,t.setName(r)),this._shadowsTextures[e]=t,this._texturesByName[r]={texture:t,variable:void 0,textureUnit:e,shadow:!0}},getTextureByName:function(t){var e=this._texturesByName[t];if(!e||e.variable)return e;var r,i=e.texture,a=e.textureUnit,n=i.className(),s="Texture"+a;if("Texture"===n)r=this.getOrCreateSampler("sampler2D",s);else{if("TextureCubeMap"!==n)return;r=this.getOrCreateSampler("samplerCube",s)}var o=this._fragmentShaderMode?this.getOrCreateVarying("vec2","vTexCoord"+a):this.getOrCreateAttribute("vec2","TexCoord"+a);return e.variable=this.createTextureRGBA(i,r,o),e},createShaderFromGraphs:function(t){this._compiledNodeMap={};var e=[];for(var r in this._variables){var i=this._variables[r],a=i.declare();a&&e.push(a)}var n=this.evaluateExtensions(t),s=this.evaluateDefines(t),o=[];o.push("\n"),o.push(this.evaluateGlobalVariableDeclaration(t)),this._invariantPosition&&!this._fragmentShaderMode&&o.push("\ninvariant gl_Position;"),o.push("\n"),o.push(this.evaluateGlobalFunctionDeclaration(t)),o.push("void main() {"),0!==e.length&&(o.push("// vars\n"),o.push(e.join(" ")),o.push("\n// end vars\n")),0===t.length&&this.logError("shader without any final Node output (need at least one)"),o.push(this.evaluate(t)),o.push("}");var h=o.join("\n");return this._shaderProcessor.processShader(h,s,n,this._fragmentShaderMode?"fragment":"vertex")},_logLookForVariable:function(t,e){var r=[];for(var i in t)t[i]===e&&r.push(i);return r},getNode:function(){var t=n.a.getNode.apply(n.a,arguments);t||i.a.error("Unknown Node type : "+arguments[0]);var e=t.getID();return this._activeNodeMap[e]=t,t},getVariable:function(t){return this._variables[t]},getAttributeType:function(t){for(var e=0;e<this._attributes.length;e++)if(this._attributes[e].getType()===t)return this._attributes[e]},createVariable:function(t,e,r){var i=e;if(void 0===i){i="tmp_"+window.Object.keys(this._variables).length}else if(this._variables[i]){if(i+=r,void 0===r)return this.createVariable(t,e,1);if(this._variables[i])return r++,this.createVariable(t,e,r)}var a=this.getNode("Variable",t,i);return this._variables[i]=a,a},getOrCreateUniform:function(t,e,r){var i=e;if(t instanceof a.a){var n=t;t=n.getType(),i=n.getName()}else void 0===i&&this.logError("Cannot create unamed Uniform");var s=this._variables[i];if(s&&s.getType()===t)return s;var o=this.getNode("Uniform",t,i,r);return this._variables[i]=o,o},getOrCreateSampler:function(t,e){void 0===e&&this.logError("No name given for sampler type : "+t);var r=this._variables[e];if(r)return r;var i=this.getNode("Sampler",t,e);return this._variables[e]=i,i},getOrCreateAttribute:function(t,e){this._fragmentShaderMode&&this.logError("No Vertex Attribute in Fragment Shader");var r=this._variables[e];if(r)return r;var i=this.getNode("Attribute",t,e);return this._variables[e]=i,i},getOrCreateConstant:function(t,e){var r=e;if(void 0===r){r="tmp_"+window.Object.keys(this._variables).length}else{var i=this._variables[r];if(i)return i}var a=this.getNode("Constant",t,r);return this._variables[r]=a,a},getOrCreateVarying:function(t,e){void 0===e&&this.logError("Error: Mandatory to name varying (as you need to retrieve them)");var r=this._variables[e];return r?(this._varyings[e]||this.logError("Error: requesting a varying not declared with getOrCreateVarying previously"),r.getType()!==t&&this.logError("Error: Same varying, but different type"),r):(this._fragmentShaderMode||this._customFragmentShader||this.logError("Error: requesting a varying not declared in Fragment Shader Graph (for Custom Vertex Shader, add this._customFragmentShader to the processor): "+e+" "+t),r=this._variables[e]=this._varyings[e]=this.getNode("Varying",t,e))},markNodeAsVisited:function(t){var e=t.getID();this._activeNodeMap[e]===t?this._compiledNodeMap[e]=t:this.logWarn("Node not requested by using Compiler getNode and/or not registered in nodeFactory "+t.toString())},checkOrMarkNodeAsTraversed:function(t){var e=t.getID();return!!this._traversedNodeMap[e]||(this._traversedNodeMap[e]=t,!1)},traverse:function(t,e){if(!this.checkOrMarkNodeAsTraversed(e)){var r=e.getInputs();if(!Array.isArray(r)){var i=[];for(var a in r)i.push(r[a]);r=i}for(var n=0,s=r.length;n<s;n++){e.checkInputsOutputs();var o=r[n];o&&o!==e&&this.traverse(t,o)}t.call(t,e),this.markNodeAsVisited(e)}},_getAndInitFunctor:function(t){this._traversedNodeMap={};var e={},r=[];return t=t.bind(this,e,r),t._map=e,t._text=r,t},_functorEvaluateAndGatherField:function(t,e,r,i){var a=i.getType();void 0!==a&&""!==a||this.logError("Your node "+i+" has no type"),i[t]&&!e[a]&&(e[a]=!0,Array.prototype.push.apply(r,i[t]()))},evaluateAndGatherField:function(t,e){for(var r=this._getAndInitFunctor(this._functorEvaluateAndGatherField.bind(this,e)),i=0,a=t.length;i<a;i++)this.traverse(r,t[i]);return r._text},_functorEvaluateGlobalFunctionDeclaration:function(t,e,r){var i=r.getType();if(void 0!==i&&""!==i||this.logError("Your node "+r+" has no type"),r.globalFunctionDeclaration&&!t[i]){t[i]=!0;var a=r.globalFunctionDeclaration();a&&e.push(a)}},evaluateGlobalFunctionDeclaration:function(t){for(var e=this._getAndInitFunctor(this._functorEvaluateGlobalFunctionDeclaration),r=0,i=t.length;r<i;r++)this.traverse(e,t[r]);return e._text.join("\n")},_functorEvaluateGlobalVariableDeclaration:function(t,e,r){var i=r.getID();if(r.globalDeclaration&&!t[i]){t[i]=!0;var a=r.globalDeclaration();a&&e.push(a)}},evaluateGlobalVariableDeclaration:function(t){var e=this._getAndInitFunctor(this._functorEvaluateGlobalVariableDeclaration),r=0,i=t.length;for(r=0;r<i;r++)this.traverse(e,t[r]);var a=e._text,n=a.length;if(n>0){this.sortDeclarations(a);var s=a[0][0];for(r=0;r<n;++r){var o=a[r][0];o!==s&&(s=o,a[r-1]+="\n")}}return a.join("\n")},sortDeclarations:function(t){if(t.sort(),!this._fragmentShaderMode)for(var e=0,r=t.length;e<r;++e){var i=t[e];if("a"!==i[0])break;if(-1!==i.indexOf("Vertex")){t.splice(e,1),t.unshift(i);break}}},_functorEvaluate:function(t,e,r){var i=r.getID();if(!t[i]){t[i]=!0;var a=r.computeShader();if(a){var n=r.getComment&&r.getComment();n&&e.push(n),e.push(a)}}},evaluate:function(t){for(var e=this._getAndInitFunctor(this._functorEvaluate),r=0,i=t.length;r<i;r++)this.traverse(e,t[r]);return e._text.join("\n")},evaluateDefines:function(t){return this.evaluateAndGatherField(t,"getDefines")},evaluateExtensions:function(t){return this.evaluateAndGatherField(t,"getExtensions")},getOrCreateModelVertex:function(){if(this._fragmentShaderMode)return this.getOrCreateVarying("vec3","vModelVertex");var t=this._variables.modelVertex;return t||(t=this.createVariable("vec3","modelVertex"),this.getNode("MatrixMultPosition").inputs({matrix:this.getOrCreateUniform("mat4","uModelMatrix"),vec:this.getOrCreateLocalVertex()}).outputs({vec:t}),t)},getOrCreateModelNormal:function(){if(this._fragmentShaderMode)return this.getOrCreateVarying("vec3","vModelNormal");var t=this._variables.modelNormal;return t||(t=this.createVariable("vec3","modelNormal"),this.getNode("MatrixMultDirection").inputs({matrix:this.getOrCreateUniform("mat3","uModelNormalMatrix"),vec:this.getOrCreateLocalNormal()}).outputs({vec:t}),t)},getOrCreateModelTangent:function(){if(this._fragmentShaderMode)return this.getOrCreateVarying("vec4","vModelTangent");var t=this._variables.modelTangent;return t||(t=this.createVariable("vec4","modelTangent"),this.getNode("MatrixMultDirection").setOverwriteW(!1).inputs({matrix:this.getOrCreateUniform("mat3","uModelNormalMatrix"),vec:this.getOrCreateLocalTangent()}).outputs({vec:t}),t)},getOrCreateViewVertex:function(){if(this._fragmentShaderMode)return this.getOrCreateVarying("vec4","vViewVertex");var t=this._variables.viewVertex;return t||(t=this.createVariable("vec4","viewVertex"),this.getNode("MatrixMultPosition").inputs({matrix:this.getOrCreateUniform("mat4","uModelViewMatrix"),vec:this.getOrCreateLocalVertex()}).outputs({vec:t}),t)},getOrCreateViewNormal:function(){if(this._fragmentShaderMode)return this.getOrCreateVarying("vec3","vViewNormal");var t=this._variables.viewNormal;return t||(t=this.createVariable("vec3","viewNormal"),this.getNode("MatrixMultDirection").inputs({matrix:this.getOrCreateUniform("mat3","uModelViewNormalMatrix"),vec:this.getOrCreateLocalNormal()}).outputs({vec:t}),t)},getOrCreateViewTangent:function(){if(this._fragmentShaderMode)return this.getOrCreateVarying("vec4","vViewTangent");var t=this._variables.viewTangent;return t||(t=this.createVariable("vec4","viewTangent"),this.getNode("MatrixMultDirection").setOverwriteW(!1).inputs({matrix:this.getOrCreateUniform("mat3","uModelViewNormalMatrix"),vec:this.getOrCreateLocalTangent()}).outputs({vec:t}),t)}}),e.a=u},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(24),a=r(11),n=r(1),s=r(23),o=r(3),h=r(0),u=r(19),c=r(25),l=function(t){o.a.call(this,t),this._pooledMatrix=new c.a(n.c.create),this._matrixStack=new u.a,this._matrixStack.push(n.c.IDENTITY),this._bb=new i.a};h.a.createPrototypeObject(l,h.a.objectInherit(o.a.prototype,{reset:function(){this._pooledMatrix.reset(),this._matrixStack.reset(),this._matrixStack.push(n.c.IDENTITY),this._bb.init()},getBoundingBox:function(){return this._bb},applyTransform:function(t){var e=this._pooledMatrix.getOrCreateObject();n.c.copy(e,this._matrixStack.back()),t.computeLocalToWorldMatrix(e,this),this.pushMatrix(e),this.traverse(t),this.popMatrix()},apply:function(t){return t instanceof s.a?void this.applyTransform(t):t instanceof a.a?void this.applyBoundingBox(t.getBoundingBox()):void this.traverse(t)},pushMatrix:function(t){this._matrixStack.push(t)},popMatrix:function(){this._matrixStack.pop()},applyBoundingBox:function(){var t=new i.a;return function(e){e.valid()&&(e.transformMat4(t,this._matrixStack.back()),this._bb.expandByBoundingBox(t))}}(),getMatrixStack:function(){return this._matrixStack}}),"osg","ComputeBoundsVisitor"),e.default=l},function(t,e,r){"use strict";var i,a=r(2),n=r(0),s={antialias:!0,fullscreen:!0,enableFrustumCulling:!1,scrollwheel:!0,webgl2:!1,powerPreference:"high-performance",shaderStats:!1,stats:!1},o=function(){for(var t in s)this[t]=s[t]};o.getOptionsURL=function(){if(i)return i;if(i={},!window.location.search)return i;for(var t,e=[],r=window.location.search.slice(1).split("&"),n=0;n<r.length;n++){t=r[n].split("=");var s=t[0];e.push(s);var o=t[1];"0"!==o&&"false"!==o&&(void 0===o&&(o="1"),i[s]=o)}if(void 0!==i.log){switch(i.log.toLowerCase()){case"debug":a.a.setNotifyLevel(a.a.DEBUG);break;case"info":a.a.setNotifyLevel(a.a.INFO);break;case"notice":a.a.setNotifyLevel(a.a.NOTICE);break;case"warn":a.a.setNotifyLevel(a.a.WARN);break;case"error":a.a.setNotifyLevel(a.a.ERROR);break;case"html":var h=[],u=document.createElement("div"),c=document.createElement("pre");document.addEventListener("DOMContentLoaded",function(){document.body.insertBefore(u,document.body.firstChild),u.appendChild(c)});var l=function(t){h.unshift(t),c.innerHTML=h.join("\n")};u.style.overflow="hidden",u.style.position="absolute",u.style.zIndex="10000",u.style.height="100%",u.style.maxWidth="600px",u.style.pointerEvents="none",c.style.overflow="scroll",c.style.width="105%",c.style.height="100%",c.style.fontSize="10px",c.style.pointerEvents="none",["log","error","warn","info","debug"].forEach(function(t){window.console[t]=l})}}return i},o.prototype={extend:function(t){return n.a.objectMix(this,t),this},get:function(t){return this[t]},getBoolean:function(t){var e=this.getString(t);if(e)return"false"!==e&&"0"!==e},getNumber:function(t){var e=this[t];if(e)return Number(e)},getString:function(t){if(void 0!==this[t])return this[t].toString()},extendWithOptionsURL:function(){this.extend(o.getOptionsURL())}},e.a=o},function(t,e,r){"use strict";var i=r(0),a=r(5),n=r(33),s=r(22),o=function(){n.a.call(this),this._instanceID=a.a.getInstanceID(),this._vaoObject=void 0,this.dirty()};o._sDeletedGLVertexArrayObjectCache=new window.Map,o.deleteGLVertexArrayObject=function(t,e){o._sDeletedGLVertexArrayObjectCache.has(t)||o._sDeletedGLVertexArrayObjectCache.set(t,[]),o._sDeletedGLVertexArrayObjectCache.get(t).push(e)},o.flushDeletedGLVertexArrayObjects=function(t,e){if(e<=0)return e;if(!o._sDeletedGLVertexArrayObjectCache.has(t))return e;for(var r=0,i=s.a.instance().tick(),a=o._sDeletedGLVertexArrayObjectCache.get(t),n=a.length,h=n-1;h>=0&&r<e;h--)t.deleteVertexArray(a[h]),a.splice(h,1),r=s.a.instance().deltaS(i,s.a.instance().tick());return e-r},o.flushAllDeletedGLVertexArrayObjects=function(t){if(o._sDeletedGLVertexArrayObjectCache.has(t))for(var e=o._sDeletedGLVertexArrayObjectCache.get(t),r=e.length,i=r-1;i>=0;i--)t.deleteVertexArray(e[i]),e.splice(i,1)},o.onLostContext=function(t){if(o._sDeletedGLVertexArrayObjectCache.has(t)){o._sDeletedGLVertexArrayObjectCache.get(t).length=0}},i.a.createPrototypeObject(o,i.a.objectInherit(n.a.prototype,{getInstanceID:function(){return this._instanceID},invalidate:function(){this._vaoObject=void 0,this.dirty()},releaseGLObjects:function(){void 0!==this._vaoObject&&void 0!==this._gl&&(o.deleteGLVertexArrayObject(this._gl,this._vaoObject),n.a.removeObject(this._gl,this)),this.invalidate()},create:function(t){this._vaoObject=t.createVertexArray(),this._dirty=!1},bind:function(t){this._gl||this.setGraphicContext(t),this._vaoObject&&t.bindVertexArray(this._vaoObject)},dirty:function(){this._dirty=!0},isDirty:function(){return this._dirty}}),"osg","VertexArrayObject"),e.a=o},function(t,e,r){"use strict";var i=r(19),a=function(){this._keys=new i.a,this._map={}};a.prototype={reset:function(){for(var t=this._keys.getArray(),e=this._keys.getLength(),r=0;r<e;r++){var i=t[r];this._map[i]=void 0}this._keys.reset()},set:function(t,e){this._keys.push(t),this._map[t]=e},hasKey:function(t){return void 0!==this._map[t]},getMap:function(){return this._map},getKeys:function(){return this._keys},forEach:function(t){for(var e=this._keys.getArray(),r=this._keys.getLength(),i=0;i<r;i++){var a=e[i];t(a,this._map[a])}}},e.a=a},function(t,e,r){"use strict";var i=r(0),a=r(19),n=r(63),s=r(25),o=function(){this._depth=0,this._children=new n.a,this._leafs=new a.a,this._stateset=void 0,this._parent=void 0},h=function(){return new o};o.pooledStateGraph=new s.a(h),o.statsNbMoveStateGraph=0,o.reset=function(){o.pooledStateGraph.reset(),o.statsNbMoveStateGraph=0},i.a.createPrototypeObject(o,{clean:function(){this._leafs.reset(),this._children.reset(),this._depth=0,this._stateset=void 0,this._parent=void 0},getStateSet:function(){return this._stateset},getLeafs:function(){return this._leafs},getParent:function(){return this._parent},findOrInsert:function(t){var e=t.getInstanceID(),r=this._children.getMap(),i=r[e];return i||(i=o.pooledStateGraph.getOrCreateObject(),i.clean(),i._parent=this,i._depth=this._depth+1,i._stateset=t,this._children.set(e,i)),i}},"osg","StateGraph"),o.moveStateGraph=function(){var t=new a.a,e=t.getArray();return function(r,i,a){o.statsNbMoveStateGraph++,t.reset();var n,s,h=a,u=i;if(h!==u&&void 0!==h)if(void 0!==u){if(u._parent===h._parent)return void 0!==u._stateset&&r.popStateSet(),void(void 0!==h._stateset&&r.pushStateSet(h._stateset));for(;u._depth>h._depth;)void 0!==u._stateset&&r.popStateSet(),u=u._parent;for(t.reset();h._depth>u._depth;)void 0!==h._stateset&&t.push(h._stateset),h=h._parent;for(;u!==h;)void 0!==u._stateset&&r.popStateSet(),u=u._parent,void 0!==h._stateset&&t.push(h._stateset),h=h._parent;for(n=t._length-1,s=0;n>=s;--n)r.pushStateSet(e[n])}else{do{void 0!==h._stateset&&t.push(h._stateset),h=h._parent}while(h);for(n=t._length-1,s=0;n>=s;--n)r.pushStateSet(e[n])}}}(),e.a=o},function(t,e,r){"use strict";var i=r(0),a=r(15),n=r(30),s=r(2),o=r(51),h=r(1),u=r(25),c=function(){o.a.call(this),this._clearColor=h.g.create(),this._clearDepth=void 0,this._clearMask=void 0,this._camera=void 0,this._viewport=void 0,this._scissor=void 0,this._preRenderList=[],this._postRenderList=[],c.prototype.init.call(this)},l=function(){return{renderStage:null,order:null}},d=new u.a(l);i.a.createPrototypeObject(c,i.a.objectInherit(o.a.prototype,{init:function(){return o.a.prototype.init.call(this),this._clearDepth=1,h.g.set(this._clearColor,0,0,0,1),this._clearMask=a.a.COLOR_BUFFER_BIT|a.a.DEPTH_BUFFER_BIT,this._camera=void 0,this._viewport=void 0,this._scissor=void 0,this._renderStage=this,c.prototype._initInternal.call(this),this},_initInternal:function(){this._preRenderList.length=0,this._postRenderList.length=0},reset:function(){d.reset(),o.a.prototype.reset.call(this),c.prototype._initInternal.call(this)},setClearDepth:function(t){this._clearDepth=t},getClearDepth:function(){return this._clearDepth},setClearColor:function(t){h.g.copy(this._clearColor,t)},getClearColor:function(){return this._clearColor},setClearMask:function(t){this._clearMask=t},getClearMask:function(){return this._clearMask},setViewport:function(t){this._viewport=t},getViewport:function(){return this._viewport},setScissor:function(t){this._scissor=t},getScissor:function(){return this._scissor},setCamera:function(t){this._camera=t},getCamera:function(){return this._camera},getPreRenderStageList:function(){return this._preRenderList},getPostRenderStageList:function(){return this._postRenderList},addPreRenderStage:function(t,e){for(var r=0,i=this._preRenderList.length;r<i;r++){if(e<this._preRenderList[r].order)break}var a=d.getOrCreateObject();a.order=e,a.renderStage=t,r<this._preRenderList.length?this._preRenderList.splice(r,0,a):this._preRenderList.push(a)},addPostRenderStage:function(t,e){for(var r=0,i=this._postRenderList.length;r<i;r++){if(e<this._postRenderList[r].order)break}var a=d.getOrCreateObject();a.order=e,a.renderStage=t,r<this._postRenderList.length?this._postRenderList.splice(r,0,a):this._postRenderList.push(a)},drawPreRenderStages:function(t,e){for(var r=e,i=0,a=this._preRenderList.length;i<a;++i){r=this._preRenderList[i].renderStage.draw(t,r)}return r},draw:function(t,e){this._camera&&this._camera.getInitialDrawCallback()&&this._camera.getInitialDrawCallback()(t);var r=this.drawPreRenderStages(t,e);return r=this.drawImplementation(t,r),r=this.drawPostRenderStages(t,r),this._camera&&this._camera.getFinalDrawCallback()&&this._camera.getFinalDrawCallback()(t),r},sort:function(){for(var t=0,e=this._preRenderList.length;t<e;++t)this._preRenderList[t].renderStage.sort();o.a.prototype.sort.call(this);for(var r=0,i=this._postRenderList.length;r<i;++r)this._postRenderList[r].renderStage.sort()},drawPostRenderStages:function(t,e){for(var r=e,i=0,a=this._postRenderList.length;i<a;++i){r=this._postRenderList[i].renderStage.draw(t,r)}return r},applyCamera:function(t){var e=t.getGraphicContext();if(void 0===this._camera)return void e.bindFramebuffer(e.FRAMEBUFFER,null);var r=this._camera.getViewport(),i=this._camera.frameBufferObject;if(i||(i=new n.a,this._camera.frameBufferObject=i),i.isDirty()){var a,s,o=this._camera.getAttachments(),h=o[n.a.COLOR_ATTACHMENT0];h&&h.texture&&(a=h.texture.getWidth(),s=h.texture.getHeight());for(var u in o){h=o[u];var c={};c.attachment=h.attachment,void 0===h.texture?(c.format=h.format,c.width=void 0!==a?a:r.width(),c.height=void 0!==s?s:r.height()):(c.texture=h.texture,c.textureTarget=h.textureTarget,h.format&&(c.format=h.format)),i.setAttachment(c)}}i.apply(t)},drawImplementation:function(t,e){var r=t.getGraphicContext();return this.applyCamera(t),void 0===this._viewport&&s.a.log("RenderStage does not have a valid viewport"),t.applyAttribute(this._viewport),this._scissor&&t.applyAttribute(this._scissor),0!==this._clearMask&&(this._clearMask&r.COLOR_BUFFER_BIT&&t.clearColor(this._clearColor),this._clearMask&r.DEPTH_BUFFER_BIT&&(t.depthMask(!0),t.clearDepth(this._clearDepth)),t.clear(this._clearMask)),0!==this._positionedAttribute.getLength()&&this.applyPositionedAttribute(t,this._positionedAttribute),o.a.prototype.drawImplementation.call(this,t,e)}}),"osg","RenderStage"),c.clean=function(){d.clean()},e.a=c},function(t,e,r){"use strict";var i=r(0),a=r(16),n=r(112),s=r(3),o=r(52),h=r(44),u=function(){s.a.call(this,s.a.TRAVERSE_ALL_CHILDREN)};i.a.createPrototypeObject(u,i.a.objectInherit(s.a.prototype,{apply:function(t){if(t.getTypeID()===h.a.getTypeID()){var e=t.getUpdateCallback();if(e instanceof o.a){for(var r=e._stackedTransforms,i=0,a=r.length;i<a;i++){r[i].resetToDefaultValue()}e.computeChannels()}}this.traverse(t)}}),"osgAnimation","ResetRestPoseVisitor");var c=new u,l=function(){a.a.call(this)};i.a.createPrototypeNode(l,i.a.objectInherit(a.a.prototype,{setDefaultUpdateCallback:function(){this.addUpdateCallback(new n.a)},setRestPose:function(){this.accept(c)}}),"osgAnimation","Skeleton"),e.a=l},function(t,e,r){"use strict";var i=r(0),a=r(2),n=r(52),s=r(1),o=r(3),h=function(){n.a.call(this)};i.a.createPrototypeObject(h,i.a.objectInherit(n.a.prototype,{update:function(t,e){if(e.getVisitorType()===o.a.UPDATE_VISITOR){if(t.className&&"Bone"!==t.className())return a.a.warn("Warning: UpdateBone set on non-Bone object."),!1;var r=t;n.a.prototype.update.call(this,t),r.setMatrix(r.getMatrix());var i=r.getMatrix(),h=r.getBoneParent();h?s.c.mul(r.getMatrixInSkeletonSpace(),h.getMatrixInSkeletonSpace(),i):r.setMatrixInSkeletonSpace(i)}return!0}}),"osgAnimation","UpdateBone"),e.a=h},function(t,e,r){"use strict";var i=r(2),a=r(119),n=r(120),s=r(28),o=function(t){if(!t){if(o.instance)return o.instance;o.instance=this}return this.addShaders(a.a),this.addShaders(n.a),this};o.prototype={_shadersText:{},_shadersList:{},_globalDefaultprecision:"#ifdef GL_FRAGMENT_PRECISION_HIGH\n precision highp float;\n #else\n precision mediump float;\n#endif",_debugLines:!1,_includeR:/#pragma include "([^"]+)"/g,_includeCondR:/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,_defineR:/\#define\s+([a-zA-Z_0-9]+)/,_precisionR:/precision\s+(high|low|medium)p\s+float/,addShaders:function(t){for(var e in t)this._shadersList[e]=e,this._shadersText[e]=t[e]},instrumentShaderlines:function(t,e){return"\n#line 0 "+e+"\n"+t},hasShader:function(t){return void 0!==this._shadersText[t]},getShaderTextPure:function(t){var e=this._shadersText[t];return e||(i.a.error("shader file/text: "+t+" not registered"),e=""),e},getShader:function(t,e,r,i){var a=this.getShaderTextPure(t);return this.processShader(a,e,r,i)},preprocess:function(t,e,r,i){var a=this;return t.replace(this._includeCondR,function(t,n){var s=n.split(" "),o=s[0].replace(/"/g,"");if(s.length>1&&i){for(var h=!1,u=i.map(function(t){return a._defineR.test(t)&&t.replace(/\s+/g," ").split(" ")[1]}),c=1;c<s.length&&!h;c++)for(var l=s[c].replace(/"/g,""),d=0;d<u.length&&!h;d++)if(!1!==u[d]&&u[d]===l){h=!0;break}if(!h)return""}if(-1!==r.indexOf(o))return"";var _=this.getShaderTextPure(o);return r.push(o),this._debugLines&&(_=this.instrumentShaderlines(_,e)),e++,_=this.preprocess(_,e,r,i)}.bind(this))},_getSortedUnique:function(){var t=function(t,e,r){return!e||t!==r[e-1]};return function(e){return e&&e.sort().filter(t)}}(),_convertExtensionsToWebGL2:function(){var t=function(t,e){return"core_"+e},e=function(t,e){return"#define "+e},r="(GL_EXT_shader_texture_lod|GL_OES_standard_derivatives|GL_EXT_draw_buffers|GL_EXT_frag_depth)",i=new RegExp("#\\s*extension\\s+"+r+".*","g"),a=new RegExp(r,"g");return function(r){return r=r.replace(i,e),r=r.replace(a,t)}}(),_convertToWebGL2:function(){var t=[],e=function(e,r){var i="glFragData_"+r;return t[r]="layout(location = "+r+") out vec4 "+i+";",i};return function(r,i){return r?(r=r.replace(/attribute\s+/g,"in "),r=r.replace(/varying\s+/g,i?"in ":"out "),r=r.replace(/(texture2D|textureCube)\s*\(/g,"texture("),r=r.replace(/(textureCubeLodEXT)\s*\(/g,"textureLod("),r=this._convertExtensionsToWebGL2(r),i&&(t.length=0,r=r.replace(/gl_FragData\s*\[\s*(\d+)\s*\]/g,e),t.length||t.push("out vec4 glFragColor_0;"),r=r.replace(/gl_FragColor/g,"glFragColor_0"),r=r.replace(/void\s+main\s*\(/g,t.join("\n")+"\nvoid main(")),r):r}}(),_hasVersion:function(t){var e=t.match(/^#(.*)$/m);return e&&-1!==e[0].indexOf("version")},processShader:function(t,e,r,i){if(this._hasVersion(t))return t;var a=[],n=t,o=0;this._debugLines&&(n=this.instrumentShaderlines(n,o),o++),e=this._getSortedUnique(e),r=this._getSortedUnique(r);var h=this.preprocess(n,o,a,e,i);h=h.replace(/#pragma DECLARE_FUNCTION/g,"//#pragma DECLARE_FUNCTION");var u=-1===h.indexOf("gl_Position"),c=s.a.instance().isWebGL2(),l=c?"#version 300 es":"#version 100";l+="\n";var d=r?r.join("\n")+"\n":"",_=e?e.join("\n")+"\n":"";c?(d=this._convertExtensionsToWebGL2(d),_=this._convertToWebGL2(_,u),h=this._convertToWebGL2(h,u)):(_=_.replace(/\\\n/g,""),h=h.replace(/\\\n/g,""));var f="";return this._globalDefaultprecision&&!this._precisionR.test(h)&&(f=this._globalDefaultprecision+"\n"),l+d+f+_+h}},e.a=o},function(t,e,r){"use strict";var i=r(46),a=0,n=function(t,e){for(var r=1/0,i=-1/0,n=0;n<t.length;n++)r=Math.min(r,t[n].start),i=Math.max(i,t[n].end);var s=i-r,o=e||"animation"+a.toString();return a++,{channels:t,duration:s,name:o,start:r}},s=function(t){for(var e=[],r=0;r<t.channels.length;r++){var a=i.a.createInstanceChannel(t.channels[r]);e.push(a)}return{channels:e,duration:t.duration,start:0,name:t.name,firstKeyTime:t.start}},o=function(){};o.createAnimation=n,o.createInstanceAnimation=s,e.a=o},function(t,e,r){"use strict";var i=r(0),a=r(13),n=r(45),s=r(53),o=r(36),h=r(34),u=function(){s.a.call(this),this._targets=[],this._targetNames=[],this._morphs=[],this._weights=new Float32Array(h.a.MAX_MORPH_GPU),this._indexMap=new Uint32Array(h.a.MAX_MORPH_GPU),this._gpuMorphed=[],this._maxMorphGPU=-1},c=function(t,e){return Math.abs(e.value)-Math.abs(t.value)};i.a.createPrototypeObject(u,i.a.objectInherit(s.a.prototype,{_initNode:function(t){var e;t instanceof h.a?e=t:t instanceof n.a&&t.getSourceGeometry()instanceof h.a&&(e=t.getSourceGeometry()),e&&e.getName()===this.getName()&&(e.isInitialized()||e.init(),this._morphs.push(e),this._maxMorphGPU=Math.min(this._maxMorphGPU,e.getMaximumPossibleMorphGPU()))},init:function(t){this._maxMorphGPU=h.a.MAX_MORPH_GPU,this._morphs.length=0;var e=t.getChildren();if(!e.length)return void this._initNode(t);for(var r=0,i=e.length;r<i;r++)this._initNode(e[r])},isInitialized:function(){var t=this._morphs,e=t.length;if(!e)return!1;for(var r=0;r<e;++r)if(!t[r].isInitialized())return!1;return!0},getNumTarget:function(){return this._targets.length},getTarget:function(t){return this._targets[t]},getTargetName:function(t){return this._targetNames[t]},addTarget:function(t,e){this._targets[e]=o.a.createFloatTarget(0),this._targetNames[e]=t},_remapBufferArrays:function(){for(var t=this._indexMap,e=this._morphs,r=0;r<this._maxMorphGPU;++r)for(var i=t[r],a="_"+r,n="_"+i,s=0,o=e.length;s<o;++s)for(var h=e[s],u=h.getVertexAttributeList(),c=h.getMorphTargetNames(),l=0,d=c.length;l<d;++l){var _=c[l];u[_+a].setBufferArray(u[_+n].getInitialBufferArray())}},_mergeExtraMorphTarget:function(t,e,r){var i=0,n=this._gpuMorphed,s=t[e],o=s.getElements().length,u=o/s.getItemSize(),c=s.getItemSize();s._cpuMorph=s._cpuMorph||new a.a(a.a.ARRAY_BUFFER,new Float32Array(o),c);var l=s._cpuMorph.getElements();for(i=0;i<o;++i)l[i]=0;for(var d=this._targets,_=0,f=d.length;_<f;++_)if(!0!==n[_]){var g=d[_].value;if(!(Math.abs(g)<=h.a.EFFECTIVE_EPS)){g/=r;var p=t[e+"_"+_].getInitialBufferArray().getElements();for(i=0;i<u;++i){var m=i*c;l[m]+=g*p[m],l[m+1]+=g*p[m+1],l[m+2]+=g*p[m+2]}}}t[e+"_"+(this._maxMorphGPU-1)].setBufferArray(s._cpuMorph),s._cpuMorph.dirty()},_computeExtraWeightsSum:function(){for(var t=this._gpuMorphed,e=0,r=this._targets,i=0,a=r.length;i<a;++i)if(!0!==t[i]){var n=r[i].value;Math.abs(n)<=h.a.EFFECTIVE_EPS||(e+=n)}return Math.abs(e)>1e-5?e:e<0?-1e-5:1e-5},_morphBufferArrayCPU:function(){for(var t=this._weights[this._maxMorphGPU-1]=this._computeExtraWeightsSum(),e={},r=this._morphs,i=0,a=r.length;i<a;++i)for(var n=r[i],s=n.getVertexAttributeList(),o=n.getMorphTargetNames(),h=0,u=o.length;h<u;++h){var c=o[h],l=s[c];l&&!e[l.getInstanceID()]&&(e[l.getInstanceID()]=!0,this._mergeExtraMorphTarget(s,c,t))}},updateWeights:function(){if(0!==this._maxMorphGPU){var t=0,e=this._targets,r=e.length,i=this._weights;if(i[0]=i[1]=i[2]=i[3]=0,r<=this._maxMorphGPU)for(t=0;t<r;++t)i[t]=e[t].value;else{var a=this._indexMap;a[0]=a[1]=a[2]=a[3]=0;var n=this._gpuMorphed;for(n.length=r,t=0;t<r;++t)n[t]=!1;var s=e.slice(0).sort(c);for(t=0;t<this._maxMorphGPU;++t){var o=e.indexOf(s[t]);n[o]=!0,a[t]=o,i[t]=s[t].value}var u=Math.abs(s[this._maxMorphGPU].value),l=u>h.a.EFFECTIVE_EPS;n[a[this._maxMorphGPU-1]]=!l,this._remapBufferArrays(),l&&this._morphBufferArrayCPU()}}},reset:function(){for(var t=this._targets,e=0,r=t.length;e<r;++e)t[e].value=t[e].defaultValue},update:function(t){this.isInitialized()||this.init(t),this.updateWeights();for(var e=this._weights,r=Math.min(this._maxMorphGPU,this._targets.length),i=this._morphs,a=0,n=i.length;a<n;++a)for(var s=i[a].getTargetsWeight(),o=0;o<r;o++)s[o]=e[o];return!0}}),"osgAnimation","UpdateMorph"),e.a=u},function(t,e,r){"use strict";var i=r(14),a=r.n(i),n=r(38),s=r(55),o=r(132),h=r(2),u=function(t){return"string"==typeof t||t instanceof String},c=function(t){return"blob:http"===t.substr(0,9)},l=function(t){return"http://"===t.substr(0,7)||"https://"===t.substr(0,8)},d=function(t){return!!u(t)&&(c(t)||l(t))},_=window.zip,f=new window.Map,g=function(t){return new a.a(function(e,r){var i=new window.Image;i.onerror=function(){r(i)},i.onload=function(){e(i)},i.src=t})},p=function(t){var e=window.URL.createObjectURL(t),r=g(e);return r.finally(function(){window.URL.revokeObjectURL(e)}),r},m=function(t){return new a.a(function(e,r){var i=new window.FileReader;i.onerror=function(){r(i)},i.onload=function(){e(this.result)},i.readAsArrayBuffer(t)})},v=function(t){return Object(o.a)(t,{responseType:"arraybuffer"})},S=function(t){return Object(o.a)(t).then(function(t){return JSON.parse(t)})},b=function(t){var e=JSON.parse(t);return a.a.resolve(e)},x={createJSONFromURL:S,createArrayBufferFromURL:v,createArrayBufferFromBlob:m,createImageFromBlob:p,createImageFromURL:g,requestURI:o.a,requestResource:function(t,e){var r=x.getExtension(t),i=x.getMimeType(r);if(e&&e.responseType?e.responseType.toLowerCase():void 0)return Object(o.a)(t,e);if(i){if(i.match("image"))return g(t);if(i.match("binary"))return v(t);if(i.match("json"))return S(t);if(i.match("text"))return Object(o.a)(t)}return Object(o.a)(t)},resolveData:function(t,e){var r,i=x.getExtension(t),n=x.getMimeType(i);n&&(n.match("image")?u(e)?r=g:e instanceof window.Blob&&(r=p):n.match("json")?r=d(e)?S:b:n.match("binary")&&(u(e)?r=v:e instanceof window.Blob&&(r=m)));return r?r(e):a.a.resolve(e)},resolveFilesMap:function(t){var e=[];for(var r in t){var i=t[r],n=x.resolveData(r,i).then(function(t,e){this[t]=e}.bind(t,r));e.push(n)}return a.a.all(e).then(function(){return t})},_unzipEntry:function(t){return new a.a(function(e){var r=t.filename,i=x.getExtension(r),a=x.getMimeType(i),n=_.BlobWriter;null===a.match("text")&&null===a.match("json")||(n=_.TextWriter),t.getData(new n(a),function(t){e({filename:r,data:t})})})},unzipBlob:function(t){return new a.a(function(e,r){var i={},n=[];_.createReader(new _.BlobReader(t),function(t){t.getEntries(function(r){for(var s=0;s<r.length;s++)if(!r[s].directory){var o=x._unzipEntry(r[s]);o.then(function(t){i[t.filename]=t.data}),n.push(o)}a.a.all(n).then(function(){t.close(),x.resolveFilesMap(i).then(function(t){e(t)})})})},function(){r(this)})})},unzip:function(t){if(!window.zip)return a.a.reject("missing deps to unzip, require https://github.com/gildas-lormeau/zip.js");if(u(t))return x.requestResource(t).then(function(t){var e=new window.Blob([t],{type:f.get("zip")});return x.unzipBlob(e)});if(t instanceof window.Blob)return x.unzipBlob(t);if(t instanceof window.ArrayBuffer){var e=new window.Blob([t],{type:f.get("zip")});return x.unzipBlob(e)}return a.a.reject("cant unzip input")},readFileList:function(t){var e,r,i={},h=[];for(r=0;r<t.length;++r){var u=x.getExtension(t[r].name);void 0===s.a.instance().getReaderWriterForExtension(u)&&"osgjs"!==u||(e=t[r].name);var c,l=x.getMimeType(u);c=l.match("image")?"blob":l.match("json")||l.match("text")?"string":"arraybuffer",h.push(Object(o.a)(t[r],{responseType:c}))}return a.a.all(h).then(function(a){for(r=0;r<a.length;++r)i[t[r].name]=a[r];return x.resolveFilesMap(i).then(function(t){return n.default.readNodeURL(e,{filesMap:t})})})},getMimeType:function(t){return f.get(t)},getExtension:function(t){return t.substr(t.lastIndexOf(".")+1)},addMimeTypeForExtension:function(t,e){void 0!==f.has(t)&&h.a.warn("the '"+t+"' already has a mimetype: "+f.get(t)),f.set(t,e)}};f.set("bin","application/octet-binary"),f.set("b3dm","application/octet-binary"),f.set("glb","application/octet-binary"),f.set("zip","application/octet-binary"),f.set("gz","application/octet-binary"),f.set("png","image/png"),f.set("jpg","image/jpeg"),f.set("jpeg","image/jpeg"),f.set("gif","image/gif"),f.set("json","application/json"),f.set("gltf","application/json"),f.set("osgjs","application/json"),f.set("txt","text/plain"),f.set("glsl","text/plain"),e.a=x},function(t,e,r){"use strict";var i=r(14),a=r.n(i),n=r(0),s=r(12),o=n.a.rejectObject,h={};h.Object=function(t,e){var r=t.getJSON();if(r.Name&&e.setName(r.Name),r.UserDataContainer){var i=t.setJSON(r.UserDataContainer).readUserDataContainer();void 0!==i&&e.setUserData(i)}return e},h.Node=function(t,e){var r=t.getJSON();h.Object(t,e);var i=[];if(r.UpdateCallbacks)for(var n=e.addUpdateCallback.bind(e),s=0,o=r.UpdateCallbacks.length;s<o;s++){var u=t.setJSON(r.UpdateCallbacks[s]).readObject();i.push(u),u.then(n)}if(r.StateSet){var c=t.setJSON(r.StateSet).readObject();i.push(c),c.then(e.setStateSet.bind(e))}var l=[];if(r.Children)for(var d=0,_=r.Children.length;d<_;d++)l.push(t.setJSON(r.Children[d]).readObject());return a.a.all(i).then(function(){return a.a.all(l).then(function(t){for(var r=t.length,i=0;i<r;i++)e.addChild(t[i]);return e})})},h.StateSet=function(t,e){var r=t.getJSON();h.Object(t,e),void 0!==r.RenderingHint&&e.setRenderingHint(r.RenderingHint);var i=[];if(void 0!==r.AttributeList)for(var n=0,s=r.AttributeList.length;n<s;n++)!function(r){var a=t.setJSON(r).readObject();a.isRejected()||(i.push(a),a.then(e.setAttributeAndModes.bind(e)))}(r.AttributeList[n]);if(r.TextureAttributeList)for(var o=r.TextureAttributeList,u=0,c=o.length;u<c;u++)for(var l=o[u],d=0,_=l.length;d<_;d++)!function(r,a){var n=t.setJSON(a).readObject();n.isRejected()||(i.push(n),n.then(e.setTextureAttributeAndModes.bind(e,r)))}(u,l[d]);return a.a.all(i).then(function(){return e})},h.Material=function(t,e){var r=t.getJSON();return r.Diffuse&&r.Emission&&r.Specular&&void 0!==r.Shininess?(h.Object(t,e),e.setAmbient(r.Ambient),e.setDiffuse(r.Diffuse),e.setEmission(r.Emission),e.setSpecular(r.Specular),e.setShininess(r.Shininess),a.a.resolve(e)):o("Material",r)},h.BlendFunc=function(t,e){var r=t.getJSON();return r.SourceRGB&&r.SourceAlpha&&r.DestinationRGB&&r.DestinationAlpha?(h.Object(t,e),e.setSourceRGB(r.SourceRGB),e.setSourceAlpha(r.SourceAlpha),e.setDestinationRGB(r.DestinationRGB),e.setDestinationAlpha(r.DestinationAlpha),a.a.resolve(e)):o("BlendFunc",r)},h.CullFace=function(t,e){var r=t.getJSON();return void 0===r.Mode?o("CullFace",r):(h.Object(t,e),e.setMode(r.Mode),a.a.resolve(e))},h.BlendColor=function(t,e){var r=t.getJSON();return r.ConstantColor?(h.Object(t,e),e.setConstantColor(r.ConstantColor),a.a.resolve(e)):o("BlendColor",r)},h.Light=function(t,e){var r=t.getJSON();return r.Ambient&&r.Diffuse&&r.Direction&&r.Position&&r.Specular&&void 0!==r.LightNum&&void 0!==r.SpotCutoff&&void 0!==r.LinearAttenuation&&void 0!==r.ConstantAttenuation&&void 0!==r.QuadraticAttenuation?(h.Object(t,e),e.setAmbient(r.Ambient),e.setConstantAttenuation(r.ConstantAttenuation),e.setDiffuse(r.Diffuse),e.setDirection(r.Direction),e.setLightNumber(r.LightNum),e.setLinearAttenuation(r.LinearAttenuation),e.setPosition(r.Position),e.setQuadraticAttenuation(r.QuadraticAttenuation),e.setSpecular(r.Specular),e.setSpotCutoff(r.SpotCutoff),e.setSpotBlend(.01),void 0!==r.SpotExponent&&e.setSpotBlend(r.SpotExponent/128),a.a.resolve(e)):o("Light",r)},h.Texture=function(t,e){var r=t.getJSON();h.Object(t,e),r.MinFilter&&e.setMinFilter(r.MinFilter),r.MagFilter&&e.setMagFilter(r.MagFilter),r.WrapT&&e.setWrapT(r.WrapT),r.WrapS&&e.setWrapS(r.WrapS);var i=r.File;return void 0===i&&(i="no-image-provided"),t.readImageURL(i).then(function(t){return e.setImage(t),e})},h.Projection=function(t,e){var r=t.getJSON();if(!r.Matrix)return o("Projection",r);var i=h.Node(t,e);return e.setMatrix(r.Matrix),i},h.MatrixTransform=function(t,e){var r=t.getJSON();if(!r.Matrix)return o("MatrixTransform",r);var i=h.Node(t,e);return e.setMatrix(r.Matrix),i},h.LightSource=function(t,e){var r=t.getJSON();if(!r.Light)return o("LightSource",r);var i=h.Node(t,e);return a.a.all([t.setJSON(r.Light).readObject(),i]).then(function(t){var i=t[0];return e.setLight(i),"ABSOLUTE_RF"===r.ReferenceFrame&&e.setReferenceFrame(s.a.ABSOLUTE_RF),e})},h.functionSortAttributes=function(t,e){return-1!==t.indexOf("TexCoord")&&-1!==e.indexOf("TexCoord")?parseInt(t.substr(8),10)-parseInt(e.substr(8),10):t<e?-1:t>e?1:0},h.Geometry=function(t,e){var r=t.getJSON();if(!r.VertexAttributeList)return o("Geometry",r);r.PrimitiveSetList=r.PrimitiveSetList||[];var i=[];i.push(h.Node(t,e));var n=e.getPrimitives(),s=n.push.bind(n),u=0,c=r.PrimitiveSetList.length;for(u=0;u<c;u++){var l=t.setJSON(r.PrimitiveSetList[u]).readPrimitiveSet();i.push(l),l.then(s)}var d=function(t,e){this.getVertexAttributeList()[t]=e},_=r.VertexAttributeList,f=window.Object.keys(_);for(f.sort(h.functionSortAttributes),c=f.length,u=0;u<c;u++){var g=f[u],p=t.setJSON(_[g]).readBufferArray();i.push(p),p.then(d.bind(e,g))}return a.a.all(i).then(function(){return e})},h.PagedLOD=function(t,e){var r=t.getJSON();h.Object(t,e),"USE_BOUNDING_SPHERE_CENTER"===r.CenterMode?e.setCenterMode(0):"UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED"===r.CenterMode&&e.setCenterMode(2),e.setCenter([r.UserCenter[0],r.UserCenter[1],r.UserCenter[2]]),e.setRadius(r.UserCenter[3]),"PIXEL_SIZE_ON_SCREEN"===r.RangeMode&&e.setRangeMode(1);for(var i,n=r.RangeList,s=0;s<window.Object.keys(n).length;s++){i="Range "+s;var o=n[i];e.setRange(s,o[0],o[1])}for(n=r.RangeDataList,s=0;s<window.Object.keys(n).length;s++)i="File "+s,e.setFileName(s,n[i]);e.setDatabasePath(t.getDatabasePath());var u=[];if(r.Children)for(var c=0,l=r.Children.length;c<l;c++)u.push(t.setJSON(r.Children[c]).readObject());return a.a.all(u).then(function(t){var r=t.length;for(s=0;s<r;s++)e.addChildNode(t[s]);return e})},e.a=h},function(t,e,r){"use strict";var i=r(2),a=r(40),n=r(1),s=function(t){t&&(this._boundStrategy=t.boundStrategy,this.setInputManager(t.inputManager)),void 0===this._boundStrategy&&(this._boundStrategy=s.COMPUTE_HOME_USING_SPHERE),this._controllerList={},this._inverseMatrix=n.c.create(),this._camera=void 0,this._node=void 0,this._frustum={},this._computeBoundNodeMaskOverride=-1,this._tmpSphere=new a.a};s.prototype={setCamera:function(t){this._camera=t},getCamera:function(){return this._camera},setNode:function(t){this._node=t},setComputeBoundNodeMaskOverride:function(t){this._computeBoundNodeMaskOverride=t},getComputeBoundNodeMaskOverride:function(){return this._computeBoundNodeMaskOverride},setInputManager:function(t){this._inputManager=t},getInputManager:function(){return this._inputManager},getHomeBoundingSphere:function(t){var e=this._node;if(e){var i=void 0!==t?t:this._boundStrategy;if(i&s.COMPUTE_HOME_USING_BBOX){var a;if(-1===this._computeBoundNodeMaskOverride)a=e.getBoundingBox();else{var n=r(60).default,o=new n;o.setNodeMaskOverride(this._computeBoundNodeMaskOverride),o.reset(),o.apply(e),a=o.getBoundingBox()}if(!a.valid())return e.getBoundingSphere();if(i&s.COMPUTE_HOME_USING_SPHERE){var h=e.getBoundingSphere();if(h.valid()&&h.volume()<a.volume())return h}return this._tmpSphere.copyBoundingBox(a),this._tmpSphere}return e.getBoundingSphere()}},getHomeBound:function(t){return i.a.warn("Please use getHomeBoundingSphere instead"),this.getHomeBoundingSphere(t)},getHomeDistance:function(t){var e=this._frustum,r=t.radius();if(this._camera&&n.c.getFrustum(e,this._camera.getProjectionMatrix())){var i=Math.abs(e.right-e.left)/e.zNear/2,a=Math.abs(e.top-e.bottom)/e.zNear/2;r/=Math.sin(Math.atan2(a<i?a:i,1))}else r*=1.5;return r},update:function(){},getInverseMatrix:function(){return this._inverseMatrix},getControllerList:function(){return this._controllerList}},s.COMPUTE_HOME_USING_SPHERE=1,s.COMPUTE_HOME_USING_BBOX=2,e.a=s},function(t,e,r){"use strict";var i=r(75),a=function(){this._intersections=[],this._primitiveMask=i.a.ALL_PRIMITIVES,this._intersectionLimit=i.a.NO_LIMIT};a.prototype={reset:function(){this._intersections.length=0},enter:function(t){return!this.reachedLimit()&&(!t.isCullingActive()||this.intersectNode(t))},intersectNode:function(t){return this.intersectBoundingSphere(t.getBoundingSphere())||this.intersectBoundingBox(t.getBoundingBox())},intersectBoundingSphere:function(){return!1},intersectBoundingBox:function(){return!1},getIntersections:function(){return this._intersections},setIntersectionLimit:function(t){this._intersectionLimit=t},getIntersectionLimit:function(){return this._intersectionLimit},setPrimitiveMask:function(t){this._primitiveMask=t},getPrimitiveMask:function(){return this._primitiveMask},reachedLimit:function(){return this._intersectionLimit===i.a.LIMIT_ONE&&this._intersections.length>0},setCurrentTransformation:function(){},intersect:function(){}},e.a=a},function(t,e,r){"use strict";e.a={NO_LIMIT:0,LIMIT_ONE_PER_DRAWABLE:1,LIMIT_ONE:2,POINT_PRIMITIVES:1,LINE_PRIMITIVES:2,TRIANGLE_PRIMITIVES:4,ALL_PRIMITIVES:7}},function(t,e,r){"use strict";var i=r(1),a=r(87),n=r(75),s=function(){this._hit=!1,this._primitiveIndex=0,this._vertices=void 0,this._geometry=void 0,this._intersectionVisitor=void 0,this._intersector=void 0,this._limitOneIntersection=!1,this._primitiveMask=n.a.ALL_PRIMITIVES};s.Intersection=function(){this._nodePath=void 0,this._drawable=void 0,this._matrix=void 0,this._primitiveIndex=void 0,this._ratio=0,this._backface=!1,this._localIntersectionPoint=i.f.create()},s.prototype={reset:function(){this._hit=!1,this._vertices=void 0,this._primitiveIndex=0},setPrimitiveIndex:function(t){this._primitiveIndex=t},setGeometry:function(t){this._geometry=t,this._primitiveIndex=0,this._vertices=t.getAttributes().Vertex.getElements()},setVertices:function(t){this._vertices=t},setIntersectionVisitor:function(t){this._intersectionVisitor=t},setIntersector:function(t){this._intersector=t,this._primitiveMask=t.getPrimitiveMask();var e=t.getIntersectionLimit();this._limitOneIntersection=e===n.a.LIMIT_ONE_PER_DRAWABLE||e===n.a.LIMIT_ONE},setLimitOneIntersection:function(t){this._limitOneIntersection=t},leave:function(){},enter:function(){},initIntersection:function(t){return t._matrix=i.c.clone(this._intersectionVisitor.getModelMatrix()),t._nodePath=this._intersectionVisitor.getNodePath().slice(),t._primitiveIndex=this._primitiveIndex,t._drawable=this._geometry,this._intersector.getIntersections().push(t),this._hit=!0,t},intersectPoint:function(){},intersectLine:function(){},intersectTriangle:function(){},operatorPoint:function(){var t=i.f.create();return function(e){if(!(this._limitOneIntersection&&this._hit||0==(this._primitiveMask&n.a.POINT_PRIMITIVES))){var r=this._vertices;i.f.set(t,r[3*e],r[3*e+1],r[3*e+2]),this.intersectPoint(t,e),this._primitiveIndex++}}}(),operatorLine:function(){var t=i.f.create(),e=i.f.create();return function(r,a){if(!(this._limitOneIntersection&&this._hit||0==(this._primitiveMask&n.a.LINE_PRIMITIVES))){var s=this._vertices;i.f.set(t,s[3*r],s[3*r+1],s[3*r+2]),i.f.set(e,s[3*a],s[3*a+1],s[3*a+2]),this.intersectLine(t,e,r,a),this._primitiveIndex++}}}(),operatorTriangle:function(){var t=i.f.create(),e=i.f.create(),r=i.f.create();return function(a,s,o){if(!(this._limitOneIntersection&&this._hit||0==(this._primitiveMask&n.a.TRIANGLE_PRIMITIVES))){var h=this._vertices;i.f.set(t,h[3*a],h[3*a+1],h[3*a+2]),i.f.set(e,h[3*s],h[3*s+1],h[3*s+2]),i.f.set(r,h[3*o],h[3*o+1],h[3*o+2]),this.intersectTriangle(t,e,r,a,s,o),this._primitiveIndex++}}}(),apply:function(t){t.getAttributes().Vertex&&Object(a.a)(t,this)}},e.a=s},function(t,e,r){"use strict";var i=r(32),a=r(0),n=r(39),s=r(10),o=function(t){i.a.call(this,t),this.init()};a.a.createPrototypeObject(o,a.a.objectInherit(i.a.prototype,{init:function(){this._panFactor=[],this._panFactor[0]=1,this._panFactor[1]=-this._panFactor[0],this._rotateFactor=[],this._rotateFactor[0]=.6,this._rotateFactor[1]=-this._rotateFactor[0],this._zoomFactor=5,this._lastScale=0,this._zooming=!1,this._dragStarted=!1,this._initInputs(s.a.ORBIT_MANIPULATOR_TOUCH)},_initInputs:function(t){this._manipulator.getInputManager().group(t).addMappings({pinchEnd:"pinchend",pinchStart:"pinchstart",pinchInOut:["pinchin","pinchout"],startPan:["panstart 2"],startRotate:["panstart 1"],pan:["panmove 2"],rotate:["panmove 1"],endMotion:["touchend 2","touchcancel 2","touchend 1","touchcancel 1"]},this)},startPan:function(t){this._panning=!0,this.startMotion(this._manipulator.getPanInterpolator(),this._panFactor,t)},startRotate:function(t){this._rotating=!0,this.startMotion(this._manipulator.getRotateInterpolator(),this._rotateFactor,t)},pan:function(t){this._panning||(this.endMotion(),this.startPan(t)),this.move(this._manipulator.getPanInterpolator(),this._panFactor,t)},rotate:function(t){this._rotating||(this.endMotion(),this.startPan(t)),this.move(this._manipulator.getRotateInterpolator(),this._rotateFactor,t)},startMotion:function(t,e,r){if(!this._zooming){t.reset();var i=r.canvasX*e[0],a=r.canvasY*e[1];t.set(i,a)}},move:function(t,e,r){var i=r.canvasX*e[0],a=r.canvasY*e[1];t.setTarget(i,a)},endMotion:function(){(this._panning||this._rotating)&&(this._panning=!1,this._rotating=!1)},pinchStart:function(t){this._zooming=!0,this._lastScale=t.scale;var e=this._manipulator.getZoomInterpolator();e.reset(),e.set(this._lastScale)},pinchEnd:function(){this._zooming=!1},pinchInOut:function(t){if(this._zooming){var e=t.scale>this._lastScale?this._zoomFactor:3*this._zoomFactor,r=.5-Math.abs(t.velocity);e*=n.a.smoothStep(0,.5,r);var i=(t.scale-this._lastScale)*e;this._lastScale=t.scale;var a=this._manipulator.getZoomInterpolator();a.setTarget(a.getTarget()[0]-i)}},setManipulator:function(t){this._manipulator=t}})),e.a=o},function(t,e,r){"use strict";var i=function(t,e){this._current=new Float32Array(t),this._target=new Float32Array(t),this._delta=new Float32Array(t),this._delay=void 0!==e?e:.15,this._reset=!1,this._start=0,this.reset()};i.prototype={setDelay:function(t){this._delay=t},reset:function(){for(var t=0,e=this._current.length;t<e;t++)this._current[t]=this._target[t]=0;this._reset=!0},update:function(t){for(var e=Math.min(1,this._delay*t*60),r=0,i=this._current.length;r<i;r++){var a=(this._target[r]-this._current[r])*e;this._delta[r]=a,this._current[r]+=a}return this._delta},set:function(){for(var t=0,e=this._current.length;t<e;t++)this._current[t]=this._target[t]=arguments[t];this._reset=!1},isReset:function(){return this._reset},getCurrent:function(){return this._current},setTarget:function(){for(var t=0,e=this._target.length;t<e;t++)this._reset?this._target[t]=this._current[t]=arguments[t]:this._target[t]=arguments[t];this._reset=!1},addTarget:function(){for(var t=0;t<arguments.length;t++)this._target[t]+=arguments[t]},getTarget:function(){return this._target},getDelta:function(){return this._delta},getStart:function(){return this._start},setStart:function(t){this._start=t}},e.a=i},function(t,e,r){"use strict";var i=r(2),a=0,n=function(){this._name="AbstractNode",this._inputs=[],this._outputs=null,this._id=a++,this._text=void 0};n.prototype={getID:function(){return this._id},getName:function(){return this._name},getType:function(){return this.type},toString:function(){var t="name : "+this._name;return this.type&&(t+=" ("+this.type+")"),t},getInputs:function(){return this._inputs},getOutputs:function(){return this._outputs},checkInputsOutputs:function(){var t,e;if(this.validInputs)for(t=0;t<this.validInputs.length;t++)if(e=this.validInputs[t],!this._inputs[e])return i.a.error("Shader node "+this.type+" validation error input "+e+" is missing"),!1;if(this.validOutputs)for(t=0;t<this.validOutputs.length;t++)if(e=this.validOutputs[t],!this._outputs[e])return i.a.error("Shader node "+this.type+" validation error output "+e+" is missing"),!1;return!0},inputs:function(){for(var t=0,e=arguments.length;t<e;t++){var r=arguments[t];if(!r){i.a.error("Shader node "+this.type+" input number "+e+" is undefined ");break}if(Array.isArray(r))return this.inputs.apply(this,r),this;if("object"==typeof r&&null!==r&&r instanceof n==!1)return this._inputs=r,this;this._inputs.push(r)}return this},outputs:function(t){if(this._outputs=t,this._outputs instanceof n==!0)this.autoLink(this._outputs);else for(var e in this._outputs)this.autoLink(this._outputs[e]);return this},autoLink:function(t){return void 0===t?this:(t.inputs(this),this)},computeShader:function(){return this._text},comment:function(t){this._comment="//"+t},getComment:function(){return this._comment}},e.a=n},function(t,e,r){"use strict";var i=r(2),a=r(0),n=r(23),s=r(1),o=r(3),h=r(12),u=r(8),c=function(){n.a.call(this),this._matrix=s.c.create(),this._position=s.f.create(),this._matrixDirty=!0,this._scale=s.f.fromValues(1,1,1),this._minimumScale=0,this._maximumScale=Number.MAX_VALUE,this._rotation=s.d.create(),this._pivotPoint=s.f.create(),this._autoScaleToScreen=!1,this._autoRotateToScreen=!1,this._cachedMatrix=s.c.create(),this._firstTimeToInitEyePoint=!0,this._autoScaleTransitionWidthRatio=.25,this._billboardAttribute=void 0,this._previousWidth=0,this._previousHeight=0,this._previousProjection=s.c.create(),this._previousModelView=s.c.create(),this._previousPosition=s.f.create()};a.a.createPrototypeNode(c,a.a.objectInherit(n.a.prototype,{getMatrix:function(){return this._matrix},setMatrix:function(t){this._matrix=t,this.dirtyBound()},setPosition:function(t){this._position=t,this._matrixDirty=!0,this.dirtyBound()},getPosition:function(){return this._position},setRotation:function(t){this._rotation=t,this._matrixDirty=!0,this.dirtyBound()},getRotation:function(){return this._rotation},setScale:function(t){this.setScaleFromVec3(s.f.fromValues(t,t,t))},setScaleFromvec3:function(t){i.a.warn("deprecated, use setScaleFromVec3"),this.setScaleFromVec3(t)},setScaleFromVec3:function(t){this._scale=t,this._matrixDirty=!0,this.dirtyBound()},getScale:function(){return this._scale},setMinimumScale:function(t){this._minimumScale=t},getMinimumScale:function(){return this._minimumScale},setMaximumScale:function(t){this._maximumScale=t},getMaximumScale:function(){return this._maximumScale},setAutoScaleToScreen:function(t){this._autoScaleToScreen=t,this._matrixDirty=!0},getAutoScaleToScreen:function(){return this._autoScaleToScreen},setAutoRotateToScreen:function(t){this._autoRotateToScreen=t},getAutoRotateToScreen:function(){return this._autoRotateToScreen},setAutoScaleTransitionWidthRatio:function(t){this._autoScaleTransitionWidthRatio=t},getAutoScaleTransitionWidthRatio:function(){return this._autoScaleTransitionWidthRatio},computeLocalToWorldMatrix:function(t){this._matrixDirty&&this.computeMatrix(),this.referenceFrame===h.a.RELATIVE_RF?s.c.mul(t,t,this._matrix):s.c.copy(t,this._matrix)},computeMatrix:function(){var t=s.f.create(),e=s.c.create();return function(){this._matrixDirty&&(s.c.fromQuat(this._matrix,this._rotation),s.c.fromTranslation(e,this._position),s.c.mul(this._matrix,e,this._matrix),s.c.scale(this._matrix,this._matrix,this._scale),s.c.translate(this._matrix,this._matrix,s.f.neg(t,this._pivotPoint)),this._matrixDirty=!1)}}(),computeWorldToLocalMatrix:function(){var t=s.f.create(),e=s.d.create(),r=s.f.create(),i=s.c.create();return function(a){return(0!==this.scale[0]||0!==this.scale[1]||0!==this.scale[2])&&(r[0]=1/this._scale[0],r[1]=1/this._scale[1],r[2]=1/this._scale[2],this.referenceFrame===h.a.RELATIVE_RF?(s.c.fromTranslation(i,s.f.neg(t,this._position)),s.c.mul(a,i,a),s.d.zeroRotation(this._rotation)||(s.c.fromQuat(i,s.d.invert(e,this._rotation)),s.c.mul(a,i,a)),s.c.fromScaling(i,r),s.c.mul(a,i,a),s.c.fromTranslation(i,this._pivotPoint),s.c.mul(a,i,a)):(s.c.fromQuat(this._matrix,s.d.invert(e,this._rotation)),s.c.translate(a,a,s.f.neg(t,this._position)),s.c.fromScaling(i,r),s.c.mul(a,i,a),s.c.fromTranslation(i,this._pivotPoint),s.c.mul(a,i,a)),!0)}}(),computeBound:function(){var t=s.c.create();return function(e){return this._autoScaleToScreen&&this._firstTimeToInitEyePoint?e:(u.a.prototype.computeBound.call(this,e),e.valid()?(s.c.identity(t),this.computeLocalToWorldMatrix(t),e.transformMat4(e,t),e):e)}}(),accept:function(){return function(t){if(t.getVisitorType()===o.a.CULL_VISITOR){var e=t.getViewport().width(),r=t.getViewport().height(),i=t.getCurrentProjectionMatrix(),a=t.getCurrentModelViewMatrix(),n=this._position,h=this._firstTimeToInitEyePoint;if(this._firstTimeToInitEyePoint||(e!==this._previousWidth||r!==this._previousHeight?h=!0:s.c.exactEquals(i,this._previousProjection)&&s.c.exactEquals(a,this._previousModelView)?s.f.exactEquals(n,this._previousPosition)||(h=!0):h=!0),this._firstTimeToInitEyePoint=!1,h){if(this._autoScaleToScreen){var c=t.getViewport(),l=this.computePixelSizeVector(c,i,a),d=s.g.fromValues(this._position[0],this._position[1],this._position[2],1),_=s.g.dot(d,l);_=.48/_;var f=1/_;if(this._autoScaleTransitionWidthRatio>0){var g,p,m;if(this._minimumScale>0){var v=this._minimumScale,S=this._maximumScale<Number.MAX_VALUE?this._minimumScale+(this._maximumScale-this._minimumScale)*this._autoScaleTransitionWidthRatio:this._minimumScale*(1+this._autoScaleTransitionWidthRatio);g=1/(4*(S-v)),p=1-2*g*S,m=v+p*p/(4*g);f<-p/(2*g)?f=this._minimumScale:f<S&&(f=m+p*f+g*(f*f))}if(this._maximumScale<Number.MAX_VALUE){var b=this._maximumScale,x=this._minimumScale>0?this._maximumScale+(this._minimumScale-this._maximumScale)*this._autoScaleTransitionWidthRatio:this._maximumScale*(1-this._autoScaleTransitionWidthRatio);g=1/(4*(x-b)),p=1-2*g*x,m=b+p*p/(4*g);f>-p/(2*g)?f=this._maximumScale:f>x&&(f=m+p*f+g*(f*f))}}this.setScale(f)}if(this._autoRotateToScreen){var y=s.d.create();s.c.getRotation(y,a),this.setRotation(s.d.invert(y,y))}this._previousWidth=e,this._previousHeight=r,s.f.copy(this._previousPosition,n),s.c.copy(this._previousProjection,i),s.c.copy(this._previousModelView,a)}}u.a.prototype.accept.call(this,t)}}(),computePixelSizeVector:function(){var t=s.f.create(),e=s.f.create();return function(r,i,a){var n=i[0]*r.width()*.5,o=i[8]*r.width()*.5+i[11]*r.width()*.5;s.f.set(t,a[0]*n+a[2]*o,a[4]*n+a[6]*o,a[8]*n+a[10]*o);var h=i[5]*r.height()*.5,u=i[9]*r.height()*.5+i[11]*r.height()*.5;s.f.set(e,a[1]*h+a[2]*u,a[5]*h+a[6]*u,a[9]*h+a[10]*u);var c=i[11],l=i[15],d=s.g.fromValues(a[2]*c,a[6]*c,a[10]*c,a[14]*c+a[15]*l),_=.7071067811/Math.sqrt(s.f.sqrLen(t)+s.f.sqrLen(e));return s.g.scale(d,d,_),d}}()}),"osg","AutoTransform"),e.a=c},function(t,e,r){"use strict";var i=r(13),a=function(t){this._initialBufferArray=void 0,this._bufferArray=void 0,t&&(this.setBufferArray(t),this.setInitialBufferArray(t))},n={setInitialBufferArray:function(t){this._initialBufferArray=t},getInitialBufferArray:function(){return this._initialBufferArray},setBufferArray:function(t){this._bufferArray=t.getBufferArray?t.getBufferArray():t},getBufferArray:function(){return this._bufferArray}};for(var s in i.a.prototype)n[s]=function(t){return function(){return t.apply(this._bufferArray,arguments)}}(i.a.prototype[s]);a.prototype=n,e.a=a},function(t,e,r){"use strict";var i=r(5),a=r(43),n=r(0),s=r(1),o=r(19),h=function(){this._clippingMask=0,this._planeList=[a.a.create(),a.a.create(),a.a.create(),a.a.create(),a.a.create(),a.a.create()],this._vertexList=[],this._maskStack=new o.a,this._resultMask=0,this._maskStack.push(this._resultMask)};n.a.createPrototypeObject(h,n.a.objectInherit(i.a.prototype,{getPlanes:function(){return this._planeList},setPlanes:function(t){this._planeList=t,this.setupMask()},clear:function(){if(this._clippingMask=0,this._planeList)for(var t=0,e=this._planeList.length;t<e;++t)a.a.init(this._planeList[t]);this._vertexList=[],this.setupMask()},setToUnitFrustum:function(t,e){void 0===t&&(t=!0),void 0===e&&(e=!0),this._planeList.length=0,this._planeList.push(s.g.set(a.a.create(),1,0,0,1)),this._planeList.push(s.g.set(a.a.create(),-1,0,0,1)),this._planeList.push(s.g.set(a.a.create(),0,1,0,1)),this._planeList.push(s.g.set(a.a.create(),0,-1,0,1)),t&&this._planeList.push(s.g.set(a.a.create(),0,0,1,1)),e&&this._planeList.push(s.g.set(a.a.create(),0,0,-1,1)),this.setupMask()},setToBoundingBox:function(t){this._planeList.length=0,this._planeList.push(s.g.set(a.a.create(),1,0,0,-t.getMin()[0])),this._planeList.push(s.g.set(a.a.create(),-1,0,0,t.getMax()[0])),this._planeList.push(s.g.set(a.a.create(),0,1,0,-t.getMin()[1])),this._planeList.push(s.g.set(a.a.create(),0,-1,0,t.getMax()[1])),this._planeList.push(s.g.set(a.a.create(),0,0,1,-t.getMin()[2])),this._planeList.push(s.g.set(a.a.create(),0,0,-1,t.getMax()[2])),this.setupMask()},setAndTransformProvidingInverse:function(t,e){this._referenceVertexList=t._referenceVertexList;var r=this._maskStack.getLength()-1,i=t._maskStack[r];if(0===i)return this._maskStack.getArray()[r]=0,this._resultMask=0,void(this._planeList.length=0);var n,s=1,o=0;for(n=0;n!==t._planeList.length;++n)i&s&&++o,s<<=1;this._planeList.length=o,this._resultMask=0,s=1;var h=0;for(n=0;n!==t._planeList.length;++n)i&s&&(this._planeList[h]=t._planeList[n],a.a.transformProvidingInverse(this._planeList[h++],e),this._resultMask=this._resultMask<<1|1),s<<=1;this._maskStack.getArray()[r]=this._resultMask},voidset:function(t){this._planeList=t,this.setupMask()},add:function(t){this._planeList.push(t),this.setupMask()},empty:function(){return 0===this._planeList.length},setReferenceVertexList:function(t){this._referenceVertexList=t},getReferenceVertexList:function(){return this._referenceVertexList},setupMask:function(t){this._resultMask=0;for(var e=void 0!==t?t:this._planeList.length,r=0;r<e;++r)this._resultMask=this._resultMask<<1|1;this._maskStack.reset(),this._maskStack.push(this._resultMask)},getCurrentMask:function(){return this._maskStack.back()},setResultMask:function(t){this._resultMask=t},getResultMask:function(){return this._resultMask},getMaskStack:function(){return this._maskStack},pushCurrentMask:function(){this._maskStack.push(this._resultMask)},popCurrentMask:function(){return this._maskStack.pop()},containsVertex:function(t){var e=this._maskStack.back();if(!e)return!0;for(var r=1,i=0;i<this._planeList.length;++i){if(e&r&&a.a.distanceToPlane(this._planeList[i],t)<0)return!1;r<<=1}return!0},containsVertices:function(t){var e=this._maskStack.back();if(!e)return!0;this._resultMask=e;for(var r=0;r<t.length;++r){for(var i=t[r],n=!1,s=1,o=0;!n&&o<this._planeList.length;++o)e&s&&a.a.distanceToPlane(this._planeList[o],i)<0&&(n=!0),s<<=1;if(!n)return!0}return!1},containsBoundingSphere:function(t){var e=this._maskStack.back();if(!e||!t.valid())return!0;this._resultMask=e;for(var r=1,i=0;i<this._planeList.length;++i){if(this._resultMask&r){var n=a.a.intersectsOrContainsBoundingSphere(this._planeList[i],t);if(a.a.OUTSIDE===n)return!1;a.a.INSIDE===n&&(this._resultMask^=r)}r<<=1}return!0},containsBoundingBox:function(t){var e=this._maskStack.back();if(!e)return!0;this._resultMask=e;for(var r=1,i=0;i<this._planeList.length;++i){if(this._resultMask&r){var n=a.a.intersectsOrContainsBoundingBox(this._planeList[i],t);if(a.a.OUTSIDE===n)return!1;a.a.INSIDE===n&&(this._resultMask^=r)}r<<=1}return!0},containsAllOfVertices:function(t){var e=this._maskStack.back();if(!e)return!1;this._resultMask=e;for(var r=1,i=0;i<this._planeList.length;++i){if(this._resultMask&r){if(a.a.intersectsOrContainsVertices(this._planeList[i],t)<1)return!1;this._resultMask^=r}r<<=1}return!0},containsAllOfBoundingSphere:function(t){var e=this._maskStack.back();if(!e)return!1;this._resultMask=e;for(var r=1,i=0;i<this._planeList.length;++i){if(this._resultMask&r){if(a.a.intersectsOrContainsBoundingSphere(this._planeList[i],t)<1)return!1;this._resultMask^=r}r<<=1}return!0},containsAllOfBoundingBox:function(t){var e=this._maskStack.back();if(!e)return!1;this._resultMask=e;for(var r=1,i=0;i<this._planeList.length;++i){if(this._resultMask&r){if(a.a.intersectsOrContainsBoundingBox(this._planeList[i],t)<1)return!1;this._resultMask^=r}r<<=1}return!0},transformProvidingInverse:function(t){var e=this._maskStack.back();if(e){this._resultMask=e;for(var r=1,i=0;i<this._planeList.length;++i)e&r&&a.a.transformProvidingInverse(this._planeList[i],t),r<<=1}}}),"osg","Polytope"),e.a=h},function(t,e,r){"use strict";var i=r(0),a=r(8),n=r(1),s=function(){a.a.call(this),this.projection=n.c.create()};i.a.createPrototypeNode(s,i.a.objectInherit(a.a.prototype,{getProjectionMatrix:function(){return this.projection},setProjectionMatrix:function(t){this.projection=t}}),"osg","Projection"),e.a=s},function(t,e,r){"use strict";var i=r(0),a=r(8),n=r(12),s=r(1),o=function(){a.a.call(this),this.setCullingActive(!1),this._light=void 0,this._referenceFrame=n.a.RELATIVE_RF};i.a.createPrototypeNode(o,i.a.objectInherit(a.a.prototype,{getLight:function(){return this._light},setLight:function(t){this._light=t},setReferenceFrame:function(t){this._referenceFrame=t},getReferenceFrame:function(){return this._referenceFrame},computeBoundingSphere:function(){var t=s.f.create();return function(e){if(a.a.prototype.computeBoundingSphere.call(this,e),void 0!==this._light&&this._referenceFrame===n.a.RELATIVE_RF){var r=this._light.getPosition();0!==r[3]&&e.expandByVec3(s.f.scale(t,r,1/r[3]))}return e}}()}),"osg","LightSource"),e.a=o},function(t,e,r){"use strict";var i=r(0),a=r(8),n=r(3),s=r(1),o=r(40),h=function(){a.a.call(this),this._radius=-1,this._range=[],this._rangeMode=h.DISTANCE_FROM_EYE_POINT,this._userDefinedCenter=[],this._centerMode=h.USE_BOUNDING_SPHERE_CENTER};h.DISTANCE_FROM_EYE_POINT=0,h.PIXEL_SIZE_ON_SCREEN=1,h.USE_BOUNDING_SPHERE_CENTER=0,h.USER_DEFINED_CENTER=1,h.UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED=2,i.a.createPrototypeNode(h,i.a.objectInherit(a.a.prototype,{getRadius:function(){return this._radius},setRadius:function(t){this._radius=t},setCenter:function(t){this._centerMode!==h.UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED&&(this._centerMode=h.USER_DEFINED_CENTER),this._userDefinedCenter=t},getCenter:function(){return this._centerMode===h.USER_DEFINED_CENTER||this._centerMode===h.UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED?this._userDefinedCenter:this.getBound().center()},setCenterMode:function(t){this._centerMode=t},computeBoundingSphere:function(t){if(this._centerMode===h.USER_DEFINED_CENTER&&this._radius>=0)return t.set(this._userDefinedCenter,this._radius),t;if(this._centerMode===h.UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED&&this._radius>=0){t.set(this._userDefinedCenter,this._radius);var e=new o.a;return t.expandByBoundingSphere(a.a.prototype.computeBoundingSphere.call(this,e)),t}return a.a.prototype.computeBoundingSphere.call(this,t),t},projectBoundingSphere:function(){var t=s.f.create();return function(e,r,i){s.f.transformMat4(t,e.center(),r);var a=e.radius2(),n=t[2]*t[2],o=s.f.sqrLen(t);return-Math.PI*i*i*a*Math.sqrt(Math.abs((o-a)/(a-n)))/(a-n)}}(),setRangeMode:function(t){this._rangeMode=t},addChildNode:function(t){if(a.a.prototype.addChild.call(this,t),this.children.length>this._range.length){var e=[],r=0;this._range.lenght>0&&(r=this._range[this._range.length-1][1]),e.push(s.e.fromValues(r,r)),this._range.push(e)}return!0},addChild:function(t,e,r){if(a.a.prototype.addChild.call(this,t),this.children.length>this._range.length){var i=[];i.push(s.e.fromValues(e,e)),this._range.push(i)}return this._range[this.children.length-1][0]=e,this._range[this.children.length-1][1]=r,!0},traverse:function(){var t=s.f.create(),e=s.f.create(),r=s.c.create();return function(i){switch(i.traversalMode){case n.a.TRAVERSE_ALL_CHILDREN:for(var a=0;a<this.children.length;a++)this.children[a].accept(i);break;case n.a.TRAVERSE_ACTIVE_CHILDREN:var o=0,u=i.getCurrentModelViewMatrix();if(s.c.invert(r,u),this._rangeMode===h.DISTANCE_FROM_EYE_POINT)s.f.transformMat4(e,t,r),o=s.f.distance(this.getBound().center(),e)*i.getLODScale();else{var c=i.getCurrentProjectionMatrix();o=this.projectBoundingSphere(this.getBound(),u,c[0]),o=o*i.getViewport().width()*i.getViewport().width()*.25/i.getLODScale()}var l=this.children.length;this._range.length<l&&(l=this._range.length);for(var d=0;d<l;++d)this._range[d][0]<=o&&o<this._range[d][1]&&this.children[d].accept(i)}}}()}),"osg","Lod"),e.a=h},function(t,e,r){"use strict";var i=r(0),a=r(85),n=r(3),s=r(1),o=function(){a.a.call(this),this._perRangeDataList=[],this._loading=!1,this._expiryTime=0,this._expiryFrame=0,this._centerMode=a.a.USER_DEFINED_CENTER,this._frameNumberOfLastTraversal=0,this._databasePath="",this._numChildrenThatCannotBeExpired=0},h=function(){this.filename="",this.function=void 0,this.loaded=!1,this.timeStamp=0,this.frameNumber=0,this.frameNumberOfLastTraversal=0,this.dbrequest=void 0};i.a.createPrototypeNode(o,i.a.objectInherit(a.a.prototype,{setRange:function(t,e,r){if(t>=this._range.length){var i=[];i.push([e,e]),this._range.push(i)}this._range[t][0]=e,this._range[t][1]=r},setExpiryTime:function(t){this._expiryTime=t},setDatabasePath:function(t){this._databasePath=t},getDatabasePath:function(){return this._databasePath},setFileName:function(t,e){if(t>=this._perRangeDataList.length){var r=new h;r.filename=e,this._perRangeDataList.push(r)}else this._perRangeDataList[t].filename=e},setFunction:function(t,e){if(t>=this._perRangeDataList.length){var r=new h;r.function=e,this._perRangeDataList.push(r)}else this._perRangeDataList[t].function=e},addChild:function(t,e,r){a.a.prototype.addChild.call(this,t,e,r),this._perRangeDataList.push(new h)},addChildNode:function(t){a.a.prototype.addChildNode.call(this,t)},setFrameNumberOfLastTraversal:function(t){this._frameNumberOfLastTraversal=t},getFrameNumberOfLastTraversal:function(){return this._frameNumberOfLastTraversal},setTimeStamp:function(t,e){this._perRangeDataList[t].timeStamp=e},setFrameNumber:function(t,e){this._perRangeDataList[t].frameNumber=e},setNumChildrenThatCannotBeExpired:function(t){this._numChildrenThatCannotBeExpired=t},getNumChildrenThatCannotBeExpired:function(){return this._numChildrenThatCannotBeExpired},getDatabaseRequest:function(t){return this._perRangeDataList[t].dbrequest},removeExpiredChildren:function(t,e,r){if(!(this.children.length<=this._numChildrenThatCannotBeExpired)){var i,a,n=this.children.length-1;i=this._perRangeDataList[n].timeStamp+this._expiryTime,a=this._perRangeDataList[n].frameNumber+this._expiryFrame,i<t&&a<e&&(this._perRangeDataList[n].filename.length>0||void 0!==this._perRangeDataList[n].function)&&(r.push(this.children[n]),this.removeChild(this.children[n]),this._perRangeDataList[n].loaded=!1,void 0!==this._perRangeDataList[n].dbrequest&&(this._perRangeDataList[n].dbrequest._groupExpired=!0))}},traverse:function(){var t=s.f.create(),e=s.f.create(),r=s.c.create();return function(i){var o=i.traversalMode,h=!1;switch(i.getVisitorType()===n.a.CULL_VISITOR&&(this._frameNumberOfLastTraversal=i.getFrameStamp().getFrameNumber(),h=!0),o){case n.a.TRAVERSE_ALL_CHILDREN:for(var u=0;u<this.children.length;u++)this.children[u].accept(i);break;case n.a.TRAVERSE_ACTIVE_CHILDREN:var c=0,l=i.getCurrentModelViewMatrix();if(s.c.invert(r,l),this._rangeMode===a.a.DISTANCE_FROM_EYE_POINT){s.f.transformMat4(e,t,r);c=s.f.distance(this.getBound().center(),e)*i.getLODScale()}else{var d=i.getCurrentProjectionMatrix();c=this.projectBoundingSphere(this.getBound(),l,d[0]),c=c*i.getViewport().width()*i.getViewport().width()*.25/i.getLODScale(),c<0&&(c=this._range[this._range.length-1][0])}for(var _=!1,f=-1,g=0;g<this._range.length;++g)this._range[g][0]<=c&&c<this._range[g][1]&&(g<this.children.length?(h&&(this._perRangeDataList[g].timeStamp=i.getFrameStamp().getSimulationTime(),this._perRangeDataList[g].frameNumber=i.getFrameStamp().getFrameNumber()),this.children[g].accept(i),f=g):_=!0);if(_){var p=this.children.length;if(p>0&&p-1!==f&&(h&&(this._perRangeDataList[p-1].timeStamp=i.getFrameStamp().getSimulationTime(),this._perRangeDataList[p-1].frameNumber=i.getFrameStamp().getFrameNumber()),this.children[p-1].accept(i)),p<this._perRangeDataList.length){var m=(this._range[p][0]-c)/(this._range[p][1]-this._range[p][0]);this._rangeMode===a.a.PIXEL_SIZE_ON_SCREEN&&(m=-m);var v=i.nodePath[i.nodePath.length-1];if(!1===this._perRangeDataList[p].loaded){this._perRangeDataList[p].loaded=!0;var S=i.getDatabaseRequestHandler();this._perRangeDataList[p].dbrequest=S.requestNodeFile(this._perRangeDataList[p].function,this._databasePath+this._perRangeDataList[p].filename,v,i.getFrameStamp().getSimulationTime(),m)}else void 0!==this._perRangeDataList[p].dbrequest?(this._perRangeDataList[p].dbrequest._timeStamp=i.getFrameStamp().getSimulationTime(),this._perRangeDataList[p].dbrequest._priority=m):this._perRangeDataList[p].loaded=!1}}}}}()}),"osg","PagedLOD"),e.a=o},function(t,e,r){"use strict";var i=r(9),a=r(18),n=r(20),s=[],o=[];s[i.a.TRIANGLES]=function(t,e,r,i){for(var a=t+e,n=t;n<a;n+=3)i.operatorTriangle(r[n],r[n+1],r[n+2])},s[i.a.TRIANGLE_STRIP]=function(t,e,r,i){for(var a=2,n=t;a<e;++a,++n)a%2?i.operatorTriangle(r[n],r[n+2],r[n+1]):i.operatorTriangle(r[n],r[n+1],r[n+2])},s[i.a.TRIANGLE_FAN]=function(t,e,r,i){for(var a=r[t],n=2,s=t+1;n<e;++n,++s)i.operatorTriangle(a,r[s],r[s+1])},s[i.a.POINTS]=function(t,e,r,i){for(var a=t+e,n=t;n<a;++n)i.operatorPoint(r[n])},s[i.a.LINES]=function(t,e,r,i){for(var a=t+e,n=t;n<a;n+=2)i.operatorLine(r[n],r[n+1])},s[i.a.LINE_STRIP]=function(t,e,r,i){for(var a=t+e,n=t;n<a;++n)i.operatorLine(r[n],r[n+1])},s[i.a.LINE_LOOP]=function(t,e,r,i){for(var a=t+e,n=t;n<a;++n)i.operatorLine(r[n],r[n+1]);i.operatorLine(r[r.length-1],r[0])},o[i.a.TRIANGLES]=function(t,e,r){for(var i=2,a=t;i<e;i+=3,a+=3)r.operatorTriangle(a,a+1,a+2)},o[i.a.TRIANGLE_STRIP]=function(t,e,r){for(var i=2,a=t;i<e;++i,++a)i%2?r.operatorTriangle(a,a+2,a+1):r.operatorTriangle(a,a+1,a+2)},o[i.a.TRIANGLE_FAN]=function(t,e,r){for(var i=2,a=t+1;i<e;++i,++a)r.operatorTriangle(t,a,a+1)},o[i.a.POINTS]=function(t,e,r){for(var i=0,a=t;i<e;++i,++a)r.operatorPoint(a)},o[i.a.LINES]=function(t,e,r){for(var i=1,a=t;i<e;i+=2,a+=2)r.operatorLine(a,a+1)},o[i.a.LINE_STRIP]=function(t,e,r){for(var i=1,a=t;i<e;++i,++a)r.operatorLine(a,a+1)},o[i.a.LINE_LOOP]=function(t,e,r){for(var i=1,a=t;i<e;++i,++a)r.operatorLine(a,a+1);r.operatorLine(t+e-1,t)};var h=function(t,e){var r=t.getPrimitiveSetList();if(r)for(var i,h=r.length,u=0;u<h;u++){var c=r[u];if(c instanceof a.a){if(i=s[c.getMode()]){var l=c.indices.getElements();i(c.getFirst()/l.BYTES_PER_ELEMENT,c.getCount(),l,e)}}else c instanceof n.a&&(i=o[c.getMode()])&&i(c.getFirst(),c.getCount(),e)}};e.a=h},function(t,e,r){"use strict";var i=r(0),a=r(4),n=function(t,e,r,i){a.a.call(this),this._x=void 0!==t?t:-1,this._y=void 0!==e?e:-1,this._width=void 0!==r?r:-1,this._height=void 0!==i?i:-1};i.a.createPrototypeStateAttribute(n,i.a.objectInherit(a.a.prototype,{attributeType:"Scissor",cloneType:function(){return new n},setScissor:function(t,e,r,i){this._x=t,this._y=e,this._width=r,this._height=i},x:function(){return this._x},y:function(){return this._y},width:function(){return this._width},height:function(){return this._height},apply:function(t){t.applyScissor(this)}}),"osg","Scissor"),e.a=n},function(t,e,r){"use strict";var i=r(0),a=r(5),n=r(1),s=r(36),o=function(t,e){a.a.call(this),this._target=s.a.createVec3Target(e||n.f.ONE),t&&this.setName(t)};i.a.createPrototypeObject(o,i.a.objectInherit(a.a.prototype,{init:function(t){this.setScale(t),n.f.copy(this._target.defaultValue,t)},setScale:function(t){n.f.copy(this._target.value,t)},getTarget:function(){return this._target},resetToDefaultValue:function(){this.setScale(this._target.defaultValue)},applyToMatrix:function(t){var e=this._target.value;n.c.scale(t,t,e)}}),"osgAnimation","StackedScale"),e.a=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(14),a=r.n(i),n=r(0),s=r(101),o=r(71),h=r(221),u=r(133),c=r(2),l=r(41),d=r(13),_=r(20),f=r(115),g=r(18),p=r(9),m=n.a.rejectObject,v=function(t,e){this._json=t;var r=e;void 0===r&&(r={}),this._identifierMap=r,this._objectRegistry={},this._cacheReadObject={},this.setOptions(n.a.objectMix({},h.a))};v.imageFallback||(v.imageFallback=function(){var t=new window.Image;return t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQIW2P8DwQACgAD/il4QJ8AAAAASUVORK5CYII=",t}()),v.prototype={clone:function(){var t=new v;return t._objectRegistry=this._objectRegistry,t._cacheReadObject=this._cacheReadObject,t},setOptions:function(t){this._defaultOptions=t},getOptions:function(){return this._defaultOptions},setProgressXHRCallback:function(t){this._defaultOptions.progressXHRCallback=t},setReadNodeURLCallback:function(t){this._defaultOptions.readNodeURL=t},registerObject:function(t,e){this._objectRegistry[t]=e},getJSON:function(){return this._json},setJSON:function(t){return this._json=t,this},setPrefixURL:function(t){this._defaultOptions.prefixURL=t},getPrefixURL:function(){return this._defaultOptions.prefixURL},setDatabasePath:function(t){this._defaultOptions.databasePath=t},getDatabasePath:function(){return this._defaultOptions.databasePath},computeURL:function(t){return"string"==typeof this._defaultOptions.prefixURL&&this._defaultOptions.prefixURL.length>0?this._defaultOptions.prefixURL+t:t},requestFile:function(t,e){return o.a.requestURI(t,e)},getObjectWrapper:function(t){if(this._objectRegistry[t])return new this._objectRegistry[t];for(var e=s.a,r=t.split("."),i=0,a=r.length;i<a;i++){var n=e[r[i]];if(void 0===n)return;e=n}return this._objectRegistry[t]=e,new e},fetchImage:function(t,e,r){var i="data:image/"===e.substring(0,"data:image/".length),n=new window.Image;return!i&&r.imageCrossOrigin&&(n.crossOrigin=r.imageCrossOrigin),t.setURL(e),t.setImage(n),n.src=e,new a.a(function(i){n.onerror=function(){c.a.warn("warning use white texture as fallback instead of "+e),t.setImage(v.imageFallback),i(t)},n.onload=function(){r.imageOnload&&r.imageOnload.call(t),i(t)}})},readImageURL:function(t,e){if(void 0===e&&(e=this._defaultOptions),e.readImageURL)return e.readImageURL.call(this,t,e);"data:image"!==t.substr(0,10)&&(t=this.computeURL(t));var r=new l.a;return this.fetchImage(r,t,e)},readNodeURL:function(t,e){var i=e;if(void 0===i&&(i=this._defaultOptions),i.readNodeURL)return i.readNodeURL.call(this,t,i);t=this.computeURL(t);var a=this;if(i=n.a.objectMix({},i),!i.prefixURL){var s=a.getPrefixURL(),o=t.lastIndexOf("/");-1!==o&&(s=t.substring(0,o+1)),i.prefixURL=s}var h=r(38).default,l=function(e){return h.parseSceneGraph(e,i).then(function(e){return c.a.log("loaded "+t),e})},d=function(t){function e(t){return t.length<2?"0"+t:t}var r=t;u.a.isGunzipBuffer(t)&&(r=u.a.gunzip(t));var i=new Uint8Array(r);return function(t){for(var r="",i=0,a=t.length;i<a;++i)r+="%"+e(t[i].toString(16));return r=decodeURIComponent(r)}(i)};return n.a.time("osgjs.metric:Input.readNodeURL",c.a.INFO),a.requestFile(t).then(function(e){var r;try{r=JSON.parse(e)}catch(e){c.a.error("cant parse url "+t+" try to gunzip")}return r?l(r):a.requestFile(t,{responseType:"arraybuffer"}).then(function(t){var e=d(t);return r=JSON.parse(e),l(r)}).catch(function(e){var r="cant read file "+t+" status "+e;return c.a.error(r),r})}).catch(function(e){var r="cant get file "+t+" status "+e;return c.a.error(r),r}).finally(function(){n.a.timeEnd("osgjs.metric:Input.readNodeURL")})},_unzipTypedArray:function(t){var e=new Uint8Array(t);if(31===e[0]&&139===e[1]){var i=r(134);i||c.a.error("osg failed to use a gunzip.min.js to uncompress a gz file.\n You can add this vendors to enable this feature or adds the good header in your gzip file served by your server");return new i.Gunzip(e).decompress().buffer}return t},readBinaryArrayURL:function(t,e){if(void 0===e&&(e=this._defaultOptions),e.readBinaryArrayURL)return e.readBinaryArrayURL.call(this,t,e);if(t=this.computeURL(t),void 0!==this._identifierMap[t])return this._identifierMap[t];var r=this.requestFile(t,{responseType:"arraybuffer",progress:this._defaultOptions.progressXHRCallback}),i=this;return this._identifierMap[t]=r.then(function(t){return i._unzipTypedArray(t)}),this._identifierMap[t]},initializeBufferArray:function(t,e,r,i){if(void 0===i&&(i=this.getOptions()),i.initializeBufferArray)return i.initializeBufferArray.call(this,t,e,r);var a=t.File;return this.readBinaryArrayURL(a).then(function(i){var a,s;!function(){var t=new Uint8Array([18,52]),e=new Uint16Array(t.buffer);s="1234"===e[0].toString(16)}();var o=0;void 0!==t.Offset&&(o=t.Offset);var h=n.a[e].BYTES_PER_ELEMENT,u=t.Size,l=r.getItemSize(),d=u*h*l;if(s){c.a.log("big endian detected");var _=n.a[e],f=new _(u*l),g=new DataView(i,o,d),p=0,m=f.length;if("Uint16Array"===e)for(;p<m;p++)f[p]=g.getUint16(p*h,!0);else if("Float32Array"===e)for(;p<m;p++)f[p]=g.getFloat32(p*h,!0);a=f,g=null}else a=new n.a[e](i,o,l*u);return r.setElements(a),r})},readBufferArray:function(t){var e,r=this.getJSON(),i=r.UniqueID;if(void 0!==i&&void 0!==(e=this._identifierMap[i]))return e;if(void 0===t&&(t=this.getOptions()),t.readBufferArray)return t.readBufferArray.call(this);if(!r.Elements&&!r.Array||!r.ItemSize||!r.Type)return m("BufferArray",r);var s;if(r.Elements)s=a.a.resolve(new d.a(d.a[r.Type],r.Elements,r.ItemSize));else if(r.Array){var o=new d.a(d.a[r.Type]);o.setItemSize(r.ItemSize);var h,u;if(r.Array.Float32Array?(h=r.Array.Float32Array,u="Float32Array"):r.Array.Uint16Array?(h=r.Array.Uint16Array,u="Uint16Array"):r.Array.Uint8Array&&(h=r.Array.Uint8Array,u="Uint8Array"),void 0===h)return m("Typed Array "+window.Object.keys(r.Array)[0]);h.File?s=this.initializeBufferArray(h,u,o):h.Elements&&(o.setElements(new n.a[u](h.Elements)),s=a.a.resolve(o))}return void 0!==i&&(this._identifierMap[i]=s),s},readUserDataContainer:function(){var t,e=this.getJSON(),r=e.UniqueID;return void 0!==r&&void 0!==(t=this._identifierMap[r])?t.Values:(this._identifierMap[r]=e,e.Values)},readPrimitiveSet:function(){var t,e,r,i,n,s,o,h=this.getJSON(),u=h.DrawElementUShort||h.DrawElementUByte||h.DrawElementUInt||h.DrawElementsUShort||h.DrawElementsUByte||h.DrawElementsUInt,c=h.DrawArray||h.DrawArrays,l=h.DrawArrayLengths;if(u){if(void 0!==(t=u.UniqueID)&&void 0!==(e=this._identifierMap[t]))return e;n=u.Mode?p.a[u.Mode]:p.a.TRIANGLES,i=new g.a(n),this.setJSON(u.Indices),r=this.readBufferArray().then(function(t){return i.setIndices(t),i}),this.setJSON(h)}else if(c){if(void 0!==(t=c.UniqueID)&&void 0!==(e=this._identifierMap[t]))return e;n=c.Mode||c.mode,s=void 0!==c.First?c.First:c.first,o=void 0!==c.Count?c.Count:c.count,i=new _.a(p.a[n],s,o),r=a.a.resolve(i)}else if(l){if(void 0!==(t=l.UniqueID)&&void 0!==(e=this._identifierMap[t]))return e;n=l.Mode,s=l.First;var d=l.ArrayLengths;i=new f.a(p.a[n],s,d),r=a.a.resolve(i)}else r=m("PrimitiveSet",h);return void 0!==t&&(this._identifierMap[t]=r),r},readObject:function(){var t=this.getJSON(),e=window.Object.keys(t),i=e[0];if(!i)return m("can't find property for object "+e);var a,n=t[i].UniqueID;if(void 0!==n&&void 0!==(a=this._identifierMap[n]))return a;var s=this.getObjectWrapper(i);if(!s)return m("can't instanciate object "+i);var o=r(38).default,h=o.ObjectWrapper.serializers;if(this._cacheReadObject[i])h=this._cacheReadObject[i];else{for(var u=i.split("."),c=0,l=u.length;c<l;c++){var d=u[c],_=h[d];if(!_)return m("Unknown scope "+i+"("+d+")");h=_}this._cacheReadObject[i]=h}var f=h(this.setJSON(t[i]),s);return void 0!==n&&(this._identifierMap[n]=f,s._uniqueID=n),f}},e.default=v},function(t,e,r){"use strict";var i=r(32),a=r(0),n=r(39),s=r(144),o=r(10),h=function(t){i.a.call(this,t),this._zoomFactor=1,this.init()};a.a.createPrototypeObject(h,a.a.objectInherit(i.a.prototype,{init:function(){this._mode=void 0,this._inMotion=!1,this._initInputs(o.a.ORBIT_MANIPULATOR_MOUSEKEYBOARD,o.a.ORBIT_MANIPULATOR_RESETTOHOME)},_initInputs:function(t,e){var r=this._manipulator.getInputManager(),i=this.setMode.bind(this,s.a.ROTATE,this._manipulator.getRotateInterpolator()),a=this.setMode.bind(this,s.a.PAN,this._manipulator.getPanInterpolator()),n=this.setMode.bind(this,s.a.ZOOM,this._manipulator.getZoomInterpolator());r.group(t).addMappings({move:"mousemove",startPan:["mousedown shift 0","mousedown 1","mousedown 2"],startZoom:["mousedown ctrl 0","mousedown ctrl 2"],startRotate:"mousedown 0 !shift !ctrl",stopMotion:["mouseup","mouseout","keyup a","keyup s","keyup d"],zoom:"wheel"},this),r.group(e).addMappings({reset:"keydown space"},this),r.group(t).addMappings({setRotationMode:"keydown a"},i),r.group(t).addMappings({setPanMode:"keydown d"},a),r.group(t).addMappings({setZoomMode:"keydown s"},n)},getMode:function(){return this._mode},setMode:function(t,e){this.getMode()!==t&&(this._mode=t,e.reset(),this._inMotion=!0)},setManipulator:function(t){this._manipulator=t},getZoomFactor:function(){return this._zoomFactor},setZoomFactor:function(t){this._zoomFactor=t},move:function(t){if(!1!==this._inMotion){var e=t.canvasX,r=-t.canvasY,i=this._manipulator;if(!1===n.a.isNaN(e)&&!1===n.a.isNaN(r)){var a=this.getMode();if(a===s.a.ROTATE)i.getRotateInterpolator().setTarget(e,r);else if(a===s.a.PAN)i.getPanInterpolator().setTarget(e,r);else if(a===s.a.ZOOM){var o=i.getZoomInterpolator();o.isReset()&&(o.setStart(r),o.set(0));var h=r-o.getStart();o.setStart(r);var u=o.getTarget()[0];o.setTarget(u-h/20)}}}},startPan:function(t){var e=this._manipulator.getPanInterpolator();this.setMode(s.a.PAN,e),e.reset(),e.set(t.canvasX,-t.canvasY)},startRotate:function(t){var e=this._manipulator.getRotateInterpolator();this.setMode(s.a.ROTATE,e),e.reset(),e.set(t.canvasX,-t.canvasY)},startZoom:function(t){var e=this._manipulator.getZoomInterpolator();this.setMode(s.a.ZOOM,e),e.setStart(-t.canvasY),e.set(0)},stopMotion:function(){this._inMotion=!1,this._mode=void 0},zoom:function(t){var e=t.deltaY/this._zoomFactor,r=this._manipulator,i=r.getZoomInterpolator().getTarget()[0]-e;r.getZoomInterpolator().setTarget(i)},reset:function(){this._manipulator.computeHomePosition()}})),e.a=h},function(t,e,r){"use strict";var i=r(32),a=r(0),n=r(1),s=r(10),o=Math.PI/180,h=function(t,e,r,i,a){var n=Math.cos(e/2),s=Math.cos(r/2),o=Math.cos(i/2),h=Math.sin(e/2),u=Math.sin(r/2),c=Math.sin(i/2);return"XYZ"===a?(t[0]=h*s*o+n*u*c,t[1]=n*u*o-h*s*c,t[2]=n*s*c+h*u*o,t[3]=n*s*o-h*u*c):"YXZ"===a?(t[0]=h*s*o+n*u*c,t[1]=n*u*o-h*s*c,t[2]=n*s*c-h*u*o,t[3]=n*s*o+h*u*c):"ZXY"===a?(t[0]=h*s*o-n*u*c,t[1]=n*u*o+h*s*c,t[2]=n*s*c+h*u*o,t[3]=n*s*o-h*u*c):"ZYX"===a?(t[0]=h*s*o-n*u*c,t[1]=n*u*o+h*s*c,t[2]=n*s*c-h*u*o,t[3]=n*s*o+h*u*c):"YZX"===a?(t[0]=h*s*o+n*u*c,t[1]=n*u*o+h*s*c,t[2]=n*s*c-h*u*o,t[3]=n*s*o-h*u*c):"XZY"===a&&(t[0]=h*s*o-n*u*c,t[1]=n*u*o-h*s*c,t[2]=n*s*c+h*u*o,t[3]=n*s*o+h*u*c),t},u=function(t){i.a.call(this,t),this.init()};u.computeQuaternion=function(){var t=n.d.create(),e=n.d.fromValues(-Math.sqrt(.5),0,0,Math.sqrt(.5));return function(r,i,a){var s=i.alpha*o,u=i.beta*o,c=i.gamma*o,l=a*o;h(r,u,s,-c,"YXZ");var d=-l/2;t[1]=Math.sin(d),t[3]=Math.cos(d),n.d.mul(r,r,t),n.d.mul(r,r,e);var _=r[1];return r[1]=-r[2],r[2]=_,r}}(),a.a.createPrototypeObject(u,a.a.objectInherit(i.a.prototype,{init:function(){this._quat=n.d.create(),this._pos=n.f.create(),this._deviceOrientation=void 0,this._screenOrientation=void 0;var t=this._manipulator.getInputManager();t.group(s.a.FPS_MANIPULATOR_DEVICEORIENTATION).addMappings({setDeviceOrientation:"deviceorientation",setScreenOrientation:"orientationchange"},this),t.setEnable(s.a.FPS_MANIPULATOR_DEVICEORIENTATION,!1)},setDeviceOrientation:function(t){if(this._deviceOrientation||(this._deviceOrientation={}),this._deviceOrientation.alpha=t.alpha,this._deviceOrientation.beta=t.beta,this._deviceOrientation.gamma=t.gamma,t.screenOrientation)return void this.setScreenOrientation(t);this._update()},setScreenOrientation:function(t){this._screenOrientation=t.screenOrientation,this._update()},_update:function(){this._deviceOrientation&&this._screenOrientation&&(u.computeQuaternion(this._quat,this._deviceOrientation,this._screenOrientation),this._manipulator.setPoseVR(this._quat,this._pos))}})),e.a=u},function(t,e,r){"use strict";var i=r(0),a=r(2),n=r(79),s=function(t,e){if(!t||!e)return"";var r;for(var i in e)void 0!==(r=e[i])&&(r.getVariable&&(r=r.getVariable()),t=t.replace("%s",r));return t},o=function(t,e){var r=t,i=[],a=e;void 0===e&&(a="");for(var n=0,s=r.length;n<s;n++){var o,h=r[n];o=void 0===h?"undefined":"string"==typeof h?h:h.getType?h.getType()+" "+h.getVariable():h.getVariable(),i.push(a+o)}return i},h=function(t,e,i){var a=r(94).default,n=[],s="";if(a.debugShaderNode&&(n.push("\n// output"),Array.prototype.push.apply(n,o([e],"// "))),e&&(s=(e.getVariable?e.getVariable():e)+" = "),s=s+t+"( ",i&&i.length>0){a.debugShaderNode&&(n.push("// inputs"),Array.prototype.push.apply(n,o(i,"// ")));for(var h=0,u=i.length;h<u;h++)s+=i[h].getVariable?i[h].getVariable():i[h],h!==u-1&&(s+=", ")}return s+=" );\n",a.debugShaderNode?n.join("\n")+"\n"+s:s},u=function(t){var e=t.match(/([^\s]+):([^\s]+)/g),r={};if(!e)return r;for(var i=0;i<e.length;++i){var a=e[i].split(":");r[a[0]]=a[1]}return r},c=function(t,e){var r=e.indexOf("("),i=e.indexOf(")"),a=e.substring(0,r);a=a.replace(/[\r\n|\r|\n]/g,"").trim().replace(/\s+/g," ");var n=a.split(/\s/),s=n[0],o=n[1],h=u(t),c=h.result||"result",l=h.NODE_NAME;l||(l=o[0].toUpperCase()+o.substring(1));var d=[];h.DERIVATIVES&&d.push("#extension GL_OES_standard_derivatives : "+h.DERIVATIVES);var _,f=[],g="#define"===s;"void"!==s&&(_={name:c,type:!g&&s},f.push(_));var p=e.substring(r+1,i);p=p.replace(/[\r\n|\r|\n]/g,"");for(var m=p.split(/OPT_ARG_|,/),v=-1!==p.indexOf("OPT_ARG_"),S=[],b=[],x=0;x<m.length;++x){var y=m[x];if(y){var M=y.trim().replace(/\s+/g," ").split("[")[0],T=M.split(/\s/),A=T.length,C=A>=3&&-1!==T[A-3].indexOf("out"),I=T[A-1],w={isOutput:C,type:T[A-2],name:h[I]||I,optional:v&&-1!==p.indexOf("OPT_ARG_"+I)};b.push(w),w.optional||(C?f.push(w):S.push(w))}}return{nodeName:l,functionName:o,signature:{returnVariable:_,orderedArgs:b,outputs:f,inputs:S,extensions:d}}},l=function(t,e){var r=function(){n.a.call(this),this._defines=[],this._extensions=[],this._missingArgs=!1};return i.a.createPrototypeObject(r,i.a.objectInherit(n.a.prototype,{type:t.nodeName,signatures:[t.signature],globalDeclare:'#pragma include "'+e+'"',checkInputsOutputs:function(){},globalFunctionDeclaration:function(){return this.globalDeclare},addExtensions:function(t){return this._extensions.push.apply(this._extensions,t),this},getExtensions:function(){return this.getOrCreateSignature(),this._extensions},addDefines:function(t){return this._defines.push.apply(this._defines,t),this},getDefines:function(){return this._defines},_validateSameVariables:function(t,e){for(var r=t.length,i=0;i<r;++i)if(!e[t[i].name])return!1;return t.length===Object.keys(e).length},_validateSameType:function(t,e){for(var r=t.length,i=0;i<r;++i){if(e[t[i].name].getType()!==t[i].type)return!1}return!0},_getSignatureBestMatch:function(){if(1===this.signatures.length)return this.signatures[0];for(var t=[],e=[],r=[],i=this.signatures.length,a=0;a<i;++a){var n=this.signatures[a];this._validateSameVariables(n.outputs,this._outputs)&&(this._validateSameVariables(n.inputs,this._inputs)&&(t.push(n),this._validateSameType(n.outputs,this._outputs)&&(e.push(n),this._validateSameType(n.inputs,this._inputs)&&r.push(n))))}return t.length?1!==t.length&&e.length?1!==e.length&&r.length?r[0]:e[0]:t[0]:this.signatures[0]},getOrCreateSignature:function(){return this._signature||(this._signature=this._getSignatureBestMatch(),this.addExtensions(this._signature.extensions)),this._signature},_typeDownCast:function(e){var r;if(e.optional){if(!(r=this._inputs[e.name]||this._outputs[e.name]))return}else r=e.isOutput?this._outputs[e.name]:this._inputs[e.name];if(!r){var i=e.isOutput?"output":"input";return a.a.error("missing "+i+" "+e.name+" on NodeCustom "+t.nodeName),void(this._missingArgs=!0)}var n=r.getType(),s=e.type;return s&&s!==n?"vec3"===s?r.getVariable()+".rgb":"vec2"===s?r.getVariable()+".rg":"float"===s?r.getVariable()+".r":r:r},computeShader:function(){var e=this.getOrCreateSignature(),r=e.returnVariable&&e.returnVariable.name,i=r?this._outputs[r]:void 0;r&&!i&&(a.a.error("missing output "+r+" on NodeCustom "+t.nodeName),this._missingArgs=!0);for(var n=[],s=0;s<e.orderedArgs.length;++s){var o=this._typeDownCast(e.orderedArgs[s]);o&&n.push(o)}return this._missingArgs?"":h(t.functionName,i,n)}}),"osgShader",t.nodeName),r},d={},_=function(t,e){for(var r=t[e].split(/#pragma DECLARE_FUNCTION(.*)[\r\n|\r|\n]/),i=(r.length-1)/2,a={},n=0;n<i;++n){var s=c(r[2*n+1],r[2*n+2]),o=s.nodeName,h=a[o];h?h.prototype.signatures.push(s.signature):(h=d[o],h?(h.prototype.signatures=[s.signature],h.prototype.globalDeclare='#pragma include "'+e+'"'):h=l(s,e),a[o]=h,d[o]=h)}return a};e.a={callFunction:h,checkVariableType:o,sprintf:s,extractFunctions:_}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(59),a=r(58),n=r(229),s=r(68),o=r(155),h=r(79),u=r(93),c={};c.Compiler=i.a,c.ShaderGenerator=a.a,c.ShaderGeneratorProxy=n.a,c.ShaderProcessor=s.a,c.nodeFactory=o.a,c.utils=u.a,c.node={},c.node.Node=h.a,o.a._nodes.forEach(function(t,e){c.node[e]=t}),c.debugShaderNode=!1,e.default=c},function(t,e,r){"use strict";var i,a=r(233),n=r(159),s=r(2),o=function(){try{i=r(234)}catch(t){s.a.warn("You will not be able to use osgUtil.DisplayGraph until you add jQuery in your page")}},h=function(t){this.options=t;var e=document.createElement("style");e.type="text/css",e.innerHTML=[".osgDebugSimpleTooltip {","display: none;","position: absolute;","margin-left: 10px;","border-radius: 4px;","padding: 10px;","background: rgba(0,0,0,.9);","color: #ffffff;","}",".osgDebugSimpleTooltip:before {","content: ",";","position: absolute;","left: -10px;","top: 8px;","border: 10px solid transparent;","border-width: 10px 10px 10px 0;","border-right-color: rgba(0,0,0,.9);","}"].join("\n"),document.getElementsByTagName("head")[0].appendChild(e),this.el=document.createElement("div"),this.el.className="osgDebugSimpleTooltip",document.body.appendChild(this.el);for(var r=document.querySelectorAll(this.options.selector),i=0;i<r.length;i++)r[i].addEventListener("mouseover",this.showTooltip.bind(this),!1),r[i].addEventListener("mouseout",this.hideTooltip.bind(this),!1)};h.prototype={showTooltip:function(t){if(i){var e=t.currentTarget;this.el.innerHTML=e.getAttribute("title"),this.el.style.display="block",this.el.style.left=i(e).position().left+i(e).get(0).getBoundingClientRect().width+"px",this.el.style.top=i(e).position().top+"px"}},hideTooltip:function(){this.el.style.display="none"}};var u=function(){o(),i&&(this._selectables=new window.Map,this._graphNode=new n.a(this._selectables),this._graphRender=new a.a(this._selectables),this._displayNode=!0,this._displayRenderer=!1,this._cbSelect=void 0,this._focusedElement="graph",this._idToDomElement=new window.Map,this._$svg=i("<svg width=100% height=100%></svg>"),i("body").append(this._$svg),this._css=".node {text-align: center;cursor: pointer;}.node rect {stroke: #FFF;}.edgePath path {stroke: #FFF;fill: none;}table {text-align: right;}svg {position: absolute;left: 0px;top: 0px;}.osgDebugButton {position: absolute;left: 15px;top: 15px;z-index: 5;border: 0;background: #65a9d7;background: -webkit-gradient(linear, left top, left bottom, from(#3e779d), to(#65a9d7));background: -webkit-linear-gradient(top, #3e779d, #65a9d7);background: -moz-linear-gradient(top, #3e779d, #65a9d7);background: -ms-linear-gradient(top, #3e779d, #65a9d7);background: -o-linear-gradient(top, #3e779d, #65a9d7);padding: 5px 10px;-webkit-border-radius: 7px;-moz-border-radius: 7px;border-radius: 7px;-webkit-box-shadow: rgba(0,0,0,1) 0 1px 0;-moz-box-shadow: rgba(0,0,0,1) 0 1px 0;box-shadow: rgba(0,0,0,1) 0 1px 0;text-shadow: rgba(0,0,0,.4) 0 1px 0;color: white;font-size: 15px;font-family: Helvetica, Arial, Sans-Serif;text-decoration: none;vertical-align: middle;}.osgDebugButton:hover {border-top-color: #28597a;background: #28597a;color: #ccc;}.osgDebugButton:active {border-top-color: #1b435e;background: #1b435e;}.osgDebugSimpleTooltip .osgDebugName {font-weight: bold;color: #60b1fc;margin: 0;}.osgDebugSimpleTooltip .osgDebugDescription {margin: 0;}")};u.instance=function(){return u._instance||(u._instance=new u),u._instance},u.prototype={getColorFromClassName:n.a.prototype.getColorFromClassName,setCallbackSelect:function(t){this._cbSelect=t},reset:function(){i&&(this._selectables.clear(),this._$svg.empty(),this._focusedElement="scene",i(".osgDebugButton").hide())},setDisplayGraphRenderer:function(t){this._displayRenderer=t},createRenderGraph:function(t){this._graphRender.createGraph(t),this.displayGraph()},createGraph:function(t){i&&(this.reset(),this._displayNode=!!t,t&&this._graphNode.createGraph(t),this._displayRenderer?r(96).default.debugGraph=!0:this.displayGraph())},displayGraph:function(){if(i){if(window.d3&&window.dagreD3)return void this._createGraphApply();var t=this._createGraphApply.bind(this);i.getScript("//cdnjs.cloudflare.com/ajax/libs/d3/3.4.13/d3.min.js").done(function(){i.getScript("//cdn.jsdelivr.net/dagre-d3/0.2.9/dagre-d3.min.js").done(t)})}},_createGraphApply:function(){var t=new window.dagreD3.Digraph;this._displayNode&&this._graphNode.generateNodeAndLink(t),this._displayRenderer&&this._graphRender.generateNodeAndLink(t),this.injectStyleElement(),i(".osgDebugButton").show();var e=this.renderer=new window.dagreD3.Renderer,r=window.d3.select(this._$svg.get(0)),a=r.append("g"),n=e.zoom();e.zoom(function(t,e){var r=n(t,e);return r.scale(.75).event(e),r});var s=function(t,e){return'<p class="osgDebugName">'+t+'</p><pre class="osgDebugDescription">'+e+"</pre>"},o=this._idToDomElement,u=e.drawNodes();e.drawNodes(function(t,e){var r=u(t,e);return r.attr("title",function(e){return o.set(e,this),s(e,t.node(e).description||"")}),r}),e.run(t,a),this.tooltip=new h({selector:".node"}),i(".node").click(this.onNodeSelect.bind(this)),this.focusOnGraph()},selectNode:function(t){var e=t.getInstanceID(),r=this._idToDomElement.get(e);r&&i(r).click()},onNodeSelect:function(t){var e=t.currentTarget,r=i(e.getAttribute("title"))[0].innerHTML,a=this._selectables;this.lastNode&&(this.lastNode.style.fill=this.lastColor);var n=a.get(r);n&&(this.lastNode=e.childNodes[0],this.lastColor=this.lastNode.style.fill,e.childNodes[0].style.fill="#f00",window.activeNode=n,s.a.info("window.activeNode is set with the node below !"),s.a.log(window.activeNode),s.a.log("\n"),this._cbSelect&&this._cbSelect(n))},focusOnScene:function(){i(".osgDebugButton").text("Access to the graph"),this._$svg.css("zIndex","-2"),this._focusedElement="scene"},focusOnGraph:function(){i(".osgDebugButton").text("Access to the scene"),this._$svg.css("zIndex","2"),i(".osgDebugSimpleTooltip").css("zIndex","3"),this._focusedElement="graph"},injectStyleElement:function(){if(!this._cssInjected){this._cssInjected=!0,i("body").append('<button class="osgDebugButton">Access to the scene</button>'),i(".osgDebugButton").click(function(){"scene"===this._focusedElement?this.focusOnGraph():this.focusOnScene()}.bind(this));var t=document.createElement("style");t.type="text/css",t.innerHTML=this._css,document.getElementsByTagName("head")[0].appendChild(t)}}},e.a=u},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(0),a=r(49),n=r(50),s=r(5),o=r(65),h=r(122),u=r(64),c=r(1),l=r(94),d=r(95),_=function(t){s.a.call(this),this._state=void 0,this._camera=t,this._renderStage=void 0,this._stateGraph=void 0,this._frameStamp=void 0,this._previousCullsettings=new a.a,this.setDefaults()};_.debugGraph=!1,i.a.createPrototypeObject(_,i.a.objectInherit(s.a.prototype,{setDefaults:function(){this._state=new h.a(new l.default.ShaderGeneratorProxy),this._cullVisitor=new n.a,this._cullVisitor.setRenderer(this),this._stateGraph=new u.a,this.getCamera().setClearColor(c.g.create()),this.setRenderStage(new o.a);var t=r(102).default,e=this.getCamera().getOrCreateStateSet();e.setAttributeAndModes(new t.Material),e.setAttributeAndModes(new t.Depth),e.setAttributeAndModes(new t.BlendFunc),e.setAttributeAndModes(new t.CullFace)},getCullVisitor:function(){return this._cullVisitor},setCullVisitor:function(t){t&&!t.getRenderer()&&t.setRenderer(this),this._cullVisitor=t},setRenderStage:function(t){this._renderStage=t},getCamera:function(){return this._camera},setFrameStamp:function(t){this._frameStamp=t},getFrameStamp:function(){return this._frameStamp},getState:function(){return this._state},setState:function(t){this._state=t},setGraphicContext:function(t){this._state.setGraphicContext(t)},getGraphicContext:function(){return this._state.getGraphicContext()},cullAndDraw:function(){this.cull(),this.draw()},cull:function(){var t=this.getCamera(),e=t.getView();this._cullVisitor.setFrameStamp(this._frameStamp),this._cullVisitor.resetStats(),u.a.reset(),this._stateGraph.clean(),this._renderStage.reset(),this._cullVisitor.reset(),this._cullVisitor.setStateGraph(this._stateGraph),this._cullVisitor.setRenderStage(this._renderStage),this._cullVisitor.pushStateSet(t.getStateSet()),this._previousCullsettings.reset(),this._previousCullsettings.setCullSettings(this._cullVisitor),this._cullVisitor.setCullSettings(t),this._previousCullsettings.getSettingSourceOverrider()===this._cullVisitor&&this._previousCullsettings.getEnableFrustumCulling()&&this._cullVisitor.setEnableFrustumCulling(!0),this._cullVisitor.pushCameraModelViewProjectionMatrix(t,t.getViewMatrix(),t.getProjectionMatrix()),t.getBound();var i=e.getLight(),a=r(97).default;if(i)switch(e.getLightingMode()){case a.LightingMode.HEADLIGHT:this._cullVisitor.addPositionedAttribute(null,i);break;case a.LightingMode.SKY_LIGHT:this._cullVisitor.addPositionedAttribute(t.getViewMatrix(),i)}var n=t.getViewport(),s=t.getScissor();this._cullVisitor.pushViewport(n),this._renderStage.setClearDepth(t.getClearDepth()),this._renderStage.setClearColor(t.getClearColor()),this._renderStage.setClearMask(t.getClearMask()),this._renderStage.setViewport(n),this._renderStage.setScissor(s),this._cullVisitor.setDatabaseRequestHandler(this._camera.getView().getDatabasePager()),this._cullVisitor.handleCullCallbacksAndTraverse(t),this._cullVisitor.popCameraModelViewProjectionMatrix(t),this._cullVisitor.setCullSettings(this._previousCullsettings),this._cullVisitor.popViewport(),this._cullVisitor.popStateSet(),this._renderStage.sort()},draw:function(){var t=this.getState();t.resetCacheFrame(),t.resetStats(),this._renderStage.setCamera(this._camera),this._renderStage.draw(t),_.debugGraph&&(d.a.instance().createRenderGraph(this._renderStage),_.debugGraph=!1),this._renderStage.setCamera(void 0),t.applyDefault()}}),"osgViewer","Renderer"),e.default=_},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(13),a=r(15),n=r(116),s=r(30),o=r(54),h=r(1),u=r(7),c=r(21),l=r(26),d=r(88),_=r(37),f=r(62),g=r(28),p=r(56),m=r(57),v=r(96),S=r(160),b=r(95),x=r(2),y=function(){this._camera=new a.a,this._camera.setName("OSGJS camera"),this._scene=new S.a,this._camera.setName("OSGJS Scene"),this._frameStamp=new n.a,this._lightingMode=void 0,this._manipulator=void 0,this._canvasWidth=0,this._canvasHeight=0,this._requestContinousUpdate=!0,this._requestRedraw=!0,this.setLightingMode(y.LightingMode.HEADLIGHT);var t=this.createRenderer(this.getCamera());t.setFrameStamp(this._frameStamp),this.getCamera().setRenderer(t),this.getCamera().setView(this)};y.LightingMode={NO_LIGHT:0,HEADLIGHT:1,SKY_LIGHT:2},y.prototype={requestRedraw:function(){this._requestRedraw=!0},requestContinuousUpdate:function(t){this._requestContinousUpdate=t},createRenderer:function(t){return new v.default(t)},setGraphicContext:function(t){this.getCamera().getRenderer().getState().setGraphicContext(t)},getGraphicContext:function(){return this.getCamera().getRenderer().getState().getGraphicContext()},initWebGLCaps:function(t,e){g.a.instance(t,e)},computeCanvasSize:function(){var t,e,r;return function(i){r||(window.ResizeObserver?(r=new ResizeObserver(function(){t=i.clientWidth,e=i.clientHeight}),r.observe(i),t=i.clientWidth,e=i.clientHeight):(t=i.clientWidth,e=i.clientHeight)),t<1&&(t=1),e<1&&(e=1);var a=this._devicePixelRatio,n=Math.floor(t*a),s=Math.floor(e*a),o=!1;return this._canvasWidth!==n&&(i.width=n,this._canvasWidth=n,o=!0),this._canvasHeight!==s&&(i.height=s,this._canvasHeight=s,o=!0),o}}(),getCanvasWidth:function(){return this._canvasWidth},getCanvasHeight:function(){return this._canvasHeight},getCanvasClientWidth:function(){return Math.ceil(this._canvasWidth/this._devicePixelRatio)},getCanvasClientHeight:function(){return Math.ceil(this._canvasHeight/this._devicePixelRatio)},getCanvasPixelRatio:function(){return this._devicePixelRatio},setUpView:function(t,e){var r=window.devicePixelRatio||1,i=e.getNumber("overrideDevicePixelRatio"),a=e.getNumber("maxDevicePixelRatio")||-1;"number"==typeof i?r=i:-1!==a&&(r=Math.min(r,a)),this._devicePixelRatio=r,this.computeCanvasSize(t);var n=t.width,s=t.height,o=n/s;if(this._camera.setViewport(new _.a(0,0,n,s)),this._camera.setScissor(new d.a),this._camera.setGraphicContext(this.getGraphicContext()),h.c.lookAt(this._camera.getViewMatrix(),h.f.fromValues(0,0,-10),h.f.create(),h.f.fromValues(0,1,0)),h.c.perspective(this._camera.getProjectionMatrix(),Math.PI/180*55,o,1,1e3),e&&e.enableFrustumCulling&&this.getCamera().getRenderer().getCullVisitor().setEnableFrustumCulling(!0),e&&e.debugGraph){var u=this.getCamera();b.a.instance().refreshGraph=function(){var t=b.a.instance();t.setDisplayGraphRenderer(!0),t.createGraph(u)},x.a.log("to refresh the graphs type in the console:\nOSG.osgUtil.DisplayGraph.instance().refreshGraph()")}},computeIntersections:function(t,e,r){return void 0===r&&(r=-1),this._lsi?this._lsi.reset():this._lsi=new m.a,this._origIntersect||(this._origIntersect=h.f.create(),this._dstIntersect=h.f.create()),this._lsi.set(h.f.set(this._origIntersect,t,e,0),h.f.set(this._dstIntersect,t,e,1)),this._iv?this._iv.reset():(this._iv=new p.a,this._iv.setIntersector(this._lsi)),this._iv.setTraversalMask(r),this._camera.accept(this._iv),this._lsi.getIntersections()},setFrameStamp:function(t){this._frameStamp=t},getFrameStamp:function(){return this._frameStamp},setCamera:function(t){this._camera=t},getCamera:function(){return this._camera},setSceneData:function(t){if(t!==this._scene.getSceneData()){this._scene.setSceneData(t);for(var e=this._camera.getChildren(),r=void 0,i=0,a=e.length;i<a;i++)if("osgStats"===e[i].getName()){r=e[i];break}this._camera.removeChildren(),this._camera.addChild(t),r&&this._camera.addChild(r)}},getSceneData:function(){return this._scene.getSceneData()},setDatabasePager:function(t){this._scene.setDatabasePager(t)},getDatabasePager:function(){return this._scene.getDatabasePager()},getScene:function(){return this._scene},getManipulator:function(){return this._manipulator},setManipulator:function(t){this._manipulator=t},getLight:function(){return this._light},setLight:function(t){this._light=t,this._lightingMode!==y.LightingMode.NO_LIGHT&&this._scene.getOrCreateStateSet().setAttributeAndModes(this._light)},getLightingMode:function(){return this._lightingMode},setLightingMode:function(t){this._lightingMode!==t&&(this._lightingMode=t,this._lightingMode!==y.LightingMode.NO_LIGHT?this._light||(this._light=new o.a):this._light=void 0)},flushDeletedGLObjects:function(t){var e=this.getGraphicContext(),r=t;r=i.a.flushDeletedGLBufferArrays(e,r),r=f.a.flushDeletedGLVertexArrayObjects(e,r),r=u.default.getTextureManager(e).flushDeletedTextureObjects(e,r),r=c.a.flushDeletedGLPrograms(e,r),r=l.a.flushDeletedGLShaders(e,r),r=s.a.flushDeletedGLFrameBuffers(e,r),s.a.flushDeletedGLRenderBuffers(e,r)},flushAllDeletedGLObjects:function(){var t=this.getGraphicContext();f.a.flushAllDeletedGLVertexArrayObjects(t),i.a.flushAllDeletedGLBufferArrays(t),u.default.getTextureManager(t).flushAllDeletedTextureObjects(t),c.a.flushAllDeletedGLPrograms(t),l.a.flushAllDeletedGLShaders(t),s.a.flushAllDeletedGLFrameBuffers(t),s.a.flushAllDeletedGLRenderBuffers(t)}},e.default=y},function(t,e,r){"use strict";var i=function(){this._values=new Float32Array(i.maxGraphValue),this._index=0,this._maxValue=0,this._x=0,this._y=0};i.maxGraphValue=120,i.prototype={getIndex:function(){return this._index},getValues:function(){return this._values},setDisplayPosition:function(t,e){this._x=t,this._y=e},getX:function(){return this._x},getY:function(){return this._y},addValue:function(t,e){var r=this._index;this._maxValue=t>this._maxValue?t:this._maxValue,this._maxValue*=.99,this._values[r]=t/(1.1*this._maxValue),e&&(this._values[r]+=e),this._index=(this._index+1)%i.maxGraphValue}},e.a=i},function(t,e,r){"use strict";var i=r(2),a=r(5),n=r(0),s=function(){a.a.call(this),this._shadowedScene=void 0,this._dirty=!1,this._continuousUpdate=!0,this._needRedraw=!0};n.a.createPrototypeObject(s,n.a.objectInherit(a.a.prototype,{dirty:function(){this._dirty=!0},getShadowedScene:function(){return this._shadowedScene},setContinuousUpdate:function(t){this._continuousUpdate=t},isContinuousUpdate:function(){return this._continuousUpdate},needRedraw:function(){return this._needRedraw},requestRedraw:function(){this._needRedraw=!0},setShadowedScene:function(t){this._shadowedScene=t},init:function(){i.a.log("No ShadowTechnique activated: normal rendering activated")},valid:function(){return!1},updateShadowTechnique:function(){},cullShadowCasting:function(){},cleanSceneGraph:function(){i.a.log("No ShadowTechnique activated: normal rendering activated")}}),"osgShadow","ShadowTechnique"),e.a=s},function(t,e,r){"use strict";var i=r(2),a=r(7),n=r(6),s=r(0),o=r(1),h=function(){a.default.call(this),this._uniforms={},this._mapSize=o.g.create(),this._renderSize=o.e.create(),this._lightNumber=-1,this._dirtyHash=!0,this._hash=""};h.uniforms={},s.a.createPrototypeStateAttribute(h,s.a.objectInherit(a.default.prototype,{cloneType:function(){return new h},invalidate:function(){a.default.prototype.invalidate.call(this),this.dirty()},hasLightNumber:function(t){return this._lightNumber===t},setLightNumber:function(t){this._lightNumber=t,this._dirtyHash=!0},getLightNumber:function(){return this._lightNumber},getUniformName:function(t){return"uShadow_"+this.getType()+this._lightNumber.toString()+"_"+t},setInternalFormatType:function(t){a.default.prototype.setInternalFormatType.call(this,t),this._dirtyHash=!0},getOrCreateUniforms:function(t){var e=h;if(i.a.assert(void 0!==t),i.a.assert(-1!==this._lightNumber),void 0!==e.uniforms[t])return e.uniforms[t];var r=e.uniforms[t]={ViewRight:n.a.createFloat4(this.getUniformName("viewRight")),ViewUp:n.a.createFloat4(this.getUniformName("viewUp")),ViewLook:n.a.createFloat4(this.getUniformName("viewLook")),Projection:n.a.createFloat3(this.getUniformName("projection")),DepthRange:n.a.createFloat2(this.getUniformName("depthRange")),MapSize:n.a.createFloat4(this.getUniformName("mapSize")),RenderSize:n.a.createFloat2(this.getUniformName("renderSize"))},a="Texture"+t,s=n.a.createInt1(t,a);return r[a]=s,e.uniforms[t]},setViewMatrix:function(t){this._viewMatrix=t},setProjection:function(t){this._projection=t},setDepthRange:function(t){this._depthRange=t},setTextureSize:function(t,e){a.default.prototype.setTextureSize.call(this,t,e),this.dirty(),this._mapSize[0]=t,this._mapSize[1]=e,this._mapSize[2]=1/t,this._mapSize[3]=1/e,this._renderSize[0]=1/t,this._renderSize[1]=1/e},_updateViewMatrixUniforms:function(t,e,r,i){var a,n=t;a=e.getInternalArray(),a[0]=n[0],a[1]=n[4],a[2]=n[8],a[3]=n[12],a=r.getInternalArray(),a[0]=n[1],a[1]=n[5],a[2]=n[9],a[3]=n[13],a=i.getInternalArray(),a[0]=n[2],a[1]=n[6],a[2]=n[10],a[3]=n[14]},apply:function(t,e){if(a.default.prototype.apply.call(this,t,e),-1!==this._lightNumber){var r=this.getOrCreateUniforms(e);this._updateViewMatrixUniforms(this._viewMatrix,r.ViewRight,r.ViewUp,r.ViewLook),r.Projection.setFloat3(this._projection),r.DepthRange.setFloat2(this._depthRange),r.MapSize.setFloat4(this._mapSize),r.RenderSize.setFloat2(this._renderSize)}},getHash:function(){return this._dirtyHash?(this._hash=this._computeInternalHash(),this._dirtyHash=!1,this._hash):this._hash},_computeInternalHash:function(){return this.getTypeMember()+"_"+this._lightNumber+"_"+this._type}}),"osgShadow","ShadowTexture"),e.a=h},function(t,e,r){"use strict";var i=r(177),a=r.n(i);e.a={name:a.a.name,version:a.a.version,author:a.a.author}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(80),a=r(187),n=r(188),s=r(29),o=r(24),h=r(40),u=r(13),c=r(81),l=r(15),d=r(189),_=r(60),f=r(48),g=r(42),p=r(108),m=r(49),v=r(109),S=r(50),b=r(31),x=r(115),y=r(20),M=r(18),T=r(194),A=r(30),C=r(116),I=r(11),w=r(1),E=r(33),N=r(41),R=r(195),O=r(117),F=r(196),P=r(54),L=r(84),D=r(197),V=r(85),B=r(118),U=r(39),k=r(16),G=r(25),j=r(19),z=r(63),W=r(8),H=r(3),q=r(2),X=r(5),Y=r(61),K=r(86),Q=r(82),Z=r(198),J=r(43),$=r(199),tt=r(87),et=r(9),rt=r(21),it=r(83),at=r(51),nt=r(110),st=r(65),ot=r(26),ht=r(35),ut=r(121),ct=r(122),lt=r(4),dt=r(64),_t=r(17),ft=r(111),gt=r(7),pt=r(215),mt=r(23),vt=r(216),St=r(6),bt=r(123),xt=r(0),yt=r(37),Mt=r(88),Tt=r(12),At=r(22),Ct=r(124),It=r(62),wt=r(28),Et={};Et.AutoTransform=i.a,Et.BillboardAttribute=a.a,Et.BlendColor=n.a,Et.BlendFunc=s.a,Et.BoundingBox=o.a,Et.BoundingSphere=h.a,Et.BufferArray=u.a,Et.BufferArrayProxy=c.a,Et.ColorMask=d.a,Et.Camera=l.a,Et.ColorMask=d.a,Et.ComputeBoundsVisitor=_.default,xt.a.objectMix(Et,f.a),Et.CullFace=g.a,Et.CullingSet=p.a,Et.CullSettings=m.a,Et.CullStack=v.a,Et.CullVisitor=S.a,Et.Depth=b.a,Et.DrawArrayLengths=x.a,Et.DrawArrays=y.a,Et.DrawElements=M.a,Et.EllipsoidModel=T.a,Et.WGS_84_RADIUS_EQUATOR=T.a.WGS_84_RADIUS_EQUATOR,Et.WGS_84_RADIUS_POLAR=T.a.WGS_84_RADIUS_POLAR,Et.FrameBufferObject=A.a,Et.FrameStamp=C.a,Et.Geometry=I.a,Et.GLObject=E.a,Et.Image=N.a,Et.ImageStream=R.a,Et.KdTree=O.a,Et.KdTreeBuilder=F.a,Et.Light=P.a,Et.LightSource=L.a,Et.LineWidth=D.a,Et.Lod=V.a,Et.Material=B.default,xt.a.objectMix(Et,U.a),Et.MatrixTransform=k.a,Et.PooledResource=G.a,Et.PooledArray=j.a,Et.PooledMap=z.a,Et.Node=W.a,Et.NodeVisitor=H.a,xt.a.objectMix(Et,q.a),Et.Object=X.a,Et.Options=Y.a,Et.PagedLOD=K.a,Et.Plane=J.a,Et.PointSizeAttribute=Z.a,Et.Polytope=Q.a,Et.primitiveSet=et.a,Et.primitiveFunctor=$.a,Et.primitiveIndexFunctor=tt.a,Et.Program=rt.a,Et.Projection=it.a,Et.RenderBin=at.a,Et.RenderLeaf=nt.a,Et.RenderStage=st.a,Et.Shader=ot.a,xt.a.objectMix(Et,ht.a),Et.StackObjectPairPool=ut.a,Et.State=ct.a,Et.StateAttribute=lt.a,Et.StateGraph=dt.a,Et.StateSet=_t.a,Et.Scissor=Mt.a,Et.Switch=ft.a,Et.Texture=gt.default,Et.TextureCubeMap=pt.a,Et.Transform=mt.a,Et.TriangleIndexFunctor=vt.a,Et.Uniform=St.a,Et.UpdateVisitor=bt.a,xt.a.objectMix(Et,xt.a),Et.Viewport=yt.a,Et.VertexArrayObject=It.a,Et.vec2=w.a.vec2,Et.vec3=w.a.vec3,Et.vec4=w.a.vec4,Et.quat=w.a.quat,Et.mat3=w.a.mat3,Et.mat4=w.a.mat4,Et.Transform.RELATIVE_RF=Tt.a.RELATIVE_RF,Et.Transform.ABSOLUTE_RF=Tt.a.ABSOLUTE_RF,Et.Timer=At.a,Et.TimerGPU=Ct.a,Et.WebGLCaps=wt.a,e.default=Et},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=[],a=function(t,e){i[t]=e},n=function(t){return i[t]};e.default={applyFunctionArray:i,registerApplyFunction:a,getApplyFunction:n}},function(t,e,r){var i=r(27),a={};a.create=function(){var t=new i.ARRAY_TYPE(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},a.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},a.clone=function(t){var e=new i.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},a.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},a.fromValues=function(t,e,r,a,n,s,o,h,u){var c=new i.ARRAY_TYPE(9);return c[0]=t,c[1]=e,c[2]=r,c[3]=a,c[4]=n,c[5]=s,c[6]=o,c[7]=h,c[8]=u,c},a.set=function(t,e,r,i,a,n,s,o,h,u){return t[0]=e,t[1]=r,t[2]=i,t[3]=a,t[4]=n,t[5]=s,t[6]=o,t[7]=h,t[8]=u,t},a.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},a.transpose=function(t,e){if(t===e){var r=e[1],i=e[2],a=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=i,t[7]=a}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},a.invert=function(t,e){var r=e[0],i=e[1],a=e[2],n=e[3],s=e[4],o=e[5],h=e[6],u=e[7],c=e[8],l=c*s-o*u,d=-c*n+o*h,_=u*n-s*h,f=r*l+i*d+a*_;return f?(f=1/f,t[0]=l*f,t[1]=(-c*i+a*u)*f,t[2]=(o*i-a*s)*f,t[3]=d*f,t[4]=(c*r-a*h)*f,t[5]=(-o*r+a*n)*f,t[6]=_*f,t[7]=(-u*r+i*h)*f,t[8]=(s*r-i*n)*f,t):null},a.adjoint=function(t,e){var r=e[0],i=e[1],a=e[2],n=e[3],s=e[4],o=e[5],h=e[6],u=e[7],c=e[8];return t[0]=s*c-o*u,t[1]=a*u-i*c,t[2]=i*o-a*s,t[3]=o*h-n*c,t[4]=r*c-a*h,t[5]=a*n-r*o,t[6]=n*u-s*h,t[7]=i*h-r*u,t[8]=r*s-i*n,t},a.determinant=function(t){var e=t[0],r=t[1],i=t[2],a=t[3],n=t[4],s=t[5],o=t[6],h=t[7],u=t[8];return e*(u*n-s*h)+r*(-u*a+s*o)+i*(h*a-n*o)},a.multiply=function(t,e,r){var i=e[0],a=e[1],n=e[2],s=e[3],o=e[4],h=e[5],u=e[6],c=e[7],l=e[8],d=r[0],_=r[1],f=r[2],g=r[3],p=r[4],m=r[5],v=r[6],S=r[7],b=r[8];return t[0]=d*i+_*s+f*u,t[1]=d*a+_*o+f*c,t[2]=d*n+_*h+f*l,t[3]=g*i+p*s+m*u,t[4]=g*a+p*o+m*c,t[5]=g*n+p*h+m*l,t[6]=v*i+S*s+b*u,t[7]=v*a+S*o+b*c,t[8]=v*n+S*h+b*l,t},a.mul=a.multiply,a.translate=function(t,e,r){var i=e[0],a=e[1],n=e[2],s=e[3],o=e[4],h=e[5],u=e[6],c=e[7],l=e[8],d=r[0],_=r[1];return t[0]=i,t[1]=a,t[2]=n,t[3]=s,t[4]=o,t[5]=h,t[6]=d*i+_*s+u,t[7]=d*a+_*o+c,t[8]=d*n+_*h+l,t},a.rotate=function(t,e,r){var i=e[0],a=e[1],n=e[2],s=e[3],o=e[4],h=e[5],u=e[6],c=e[7],l=e[8],d=Math.sin(r),_=Math.cos(r);return t[0]=_*i+d*s,t[1]=_*a+d*o,t[2]=_*n+d*h,t[3]=_*s-d*i,t[4]=_*o-d*a,t[5]=_*h-d*n,t[6]=u,t[7]=c,t[8]=l,t},a.scale=function(t,e,r){var i=r[0],a=r[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=a*e[3],t[4]=a*e[4],t[5]=a*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},a.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},a.fromRotation=function(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=-r,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},a.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},a.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},a.fromQuat=function(t,e){var r=e[0],i=e[1],a=e[2],n=e[3],s=r+r,o=i+i,h=a+a,u=r*s,c=i*s,l=i*o,d=a*s,_=a*o,f=a*h,g=n*s,p=n*o,m=n*h;return t[0]=1-l-f,t[3]=c-m,t[6]=d+p,t[1]=c+m,t[4]=1-u-f,t[7]=_-g,t[2]=d-p,t[5]=_+g,t[8]=1-u-l,t},a.normalFromMat4=function(t,e){var r=e[0],i=e[1],a=e[2],n=e[3],s=e[4],o=e[5],h=e[6],u=e[7],c=e[8],l=e[9],d=e[10],_=e[11],f=e[12],g=e[13],p=e[14],m=e[15],v=r*o-i*s,S=r*h-a*s,b=r*u-n*s,x=i*h-a*o,y=i*u-n*o,M=a*u-n*h,T=c*g-l*f,A=c*p-d*f,C=c*m-_*f,I=l*p-d*g,w=l*m-_*g,E=d*m-_*p,N=v*E-S*w+b*I+x*C-y*A+M*T;return N?(N=1/N,t[0]=(o*E-h*w+u*I)*N,t[1]=(h*C-s*E-u*A)*N,t[2]=(s*w-o*C+u*T)*N,t[3]=(a*w-i*E-n*I)*N,t[4]=(r*E-a*C+n*A)*N,t[5]=(i*C-r*w-n*T)*N,t[6]=(g*M-p*y+m*x)*N,t[7]=(p*b-f*M-m*S)*N,t[8]=(f*y-g*b+m*v)*N,t):null},a.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},a.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))},a.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t},a.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t},a.sub=a.subtract,a.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t},a.multiplyScalarAndAdd=function(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t},a.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},a.equals=function(t,e){var r=t[0],a=t[1],n=t[2],s=t[3],o=t[4],h=t[5],u=t[6],c=t[7],l=t[8],d=e[0],_=e[1],f=e[2],g=e[3],p=e[4],m=e[5],v=t[6],S=e[7],b=e[8];return Math.abs(r-d)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(a-_)<=i.EPSILON*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(n-f)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(s-g)<=i.EPSILON*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(o-p)<=i.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(h-m)<=i.EPSILON*Math.max(1,Math.abs(h),Math.abs(m))&&Math.abs(u-v)<=i.EPSILON*Math.max(1,Math.abs(u),Math.abs(v))&&Math.abs(c-S)<=i.EPSILON*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(l-b)<=i.EPSILON*Math.max(1,Math.abs(l),Math.abs(b))},t.exports=a},function(t,e,r){var i=r(27),a={};a.create=function(){var t=new i.ARRAY_TYPE(3);return t[0]=0,t[1]=0,t[2]=0,t},a.clone=function(t){var e=new i.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},a.fromValues=function(t,e,r){var a=new i.ARRAY_TYPE(3);return a[0]=t,a[1]=e,a[2]=r,a},a.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},a.set=function(t,e,r,i){return t[0]=e,t[1]=r,t[2]=i,t},a.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t},a.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t},a.sub=a.subtract,a.multiply=function(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t},a.mul=a.multiply,a.divide=function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t},a.div=a.divide,a.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},a.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},a.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t},a.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t},a.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},a.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t},a.scaleAndAdd=function(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t},a.distance=function(t,e){var r=e[0]-t[0],i=e[1]-t[1],a=e[2]-t[2];return Math.sqrt(r*r+i*i+a*a)},a.dist=a.distance,a.squaredDistance=function(t,e){var r=e[0]-t[0],i=e[1]-t[1],a=e[2]-t[2];return r*r+i*i+a*a},a.sqrDist=a.squaredDistance,a.length=function(t){var e=t[0],r=t[1],i=t[2];return Math.sqrt(e*e+r*r+i*i)},a.len=a.length,a.squaredLength=function(t){var e=t[0],r=t[1],i=t[2];return e*e+r*r+i*i},a.sqrLen=a.squaredLength,a.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},a.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},a.normalize=function(t,e){var r=e[0],i=e[1],a=e[2],n=r*r+i*i+a*a;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n),t},a.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},a.cross=function(t,e,r){var i=e[0],a=e[1],n=e[2],s=r[0],o=r[1],h=r[2];return t[0]=a*h-n*o,t[1]=n*s-i*h,t[2]=i*o-a*s,t},a.lerp=function(t,e,r,i){var a=e[0],n=e[1],s=e[2];return t[0]=a+i*(r[0]-a),t[1]=n+i*(r[1]-n),t[2]=s+i*(r[2]-s),t},a.hermite=function(t,e,r,i,a,n){var s=n*n,o=s*(2*n-3)+1,h=s*(n-2)+n,u=s*(n-1),c=s*(3-2*n);return t[0]=e[0]*o+r[0]*h+i[0]*u+a[0]*c,t[1]=e[1]*o+r[1]*h+i[1]*u+a[1]*c,t[2]=e[2]*o+r[2]*h+i[2]*u+a[2]*c,t},a.bezier=function(t,e,r,i,a,n){var s=1-n,o=s*s,h=n*n,u=o*s,c=3*n*o,l=3*h*s,d=h*n;return t[0]=e[0]*u+r[0]*c+i[0]*l+a[0]*d,t[1]=e[1]*u+r[1]*c+i[1]*l+a[1]*d,t[2]=e[2]*u+r[2]*c+i[2]*l+a[2]*d,t},a.random=function(t,e){e=e||1;var r=2*i.RANDOM()*Math.PI,a=2*i.RANDOM()-1,n=Math.sqrt(1-a*a)*e;return t[0]=Math.cos(r)*n,t[1]=Math.sin(r)*n,t[2]=a*e,t},a.transformMat4=function(t,e,r){var i=e[0],a=e[1],n=e[2],s=r[3]*i+r[7]*a+r[11]*n+r[15];return s=s||1,t[0]=(r[0]*i+r[4]*a+r[8]*n+r[12])/s,t[1]=(r[1]*i+r[5]*a+r[9]*n+r[13])/s,t[2]=(r[2]*i+r[6]*a+r[10]*n+r[14])/s,t},a.transformMat3=function(t,e,r){var i=e[0],a=e[1],n=e[2];return t[0]=i*r[0]+a*r[3]+n*r[6],t[1]=i*r[1]+a*r[4]+n*r[7],t[2]=i*r[2]+a*r[5]+n*r[8],t},a.transformQuat=function(t,e,r){var i=e[0],a=e[1],n=e[2],s=r[0],o=r[1],h=r[2],u=r[3],c=u*i+o*n-h*a,l=u*a+h*i-s*n,d=u*n+s*a-o*i,_=-s*i-o*a-h*n;return t[0]=c*u+_*-s+l*-h-d*-o,t[1]=l*u+_*-o+d*-s-c*-h,t[2]=d*u+_*-h+c*-o-l*-s,t},a.rotateX=function(t,e,r,i){var a=[],n=[];return a[0]=e[0]-r[0],a[1]=e[1]-r[1],a[2]=e[2]-r[2],n[0]=a[0],n[1]=a[1]*Math.cos(i)-a[2]*Math.sin(i),n[2]=a[1]*Math.sin(i)+a[2]*Math.cos(i),t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2],t},a.rotateY=function(t,e,r,i){var a=[],n=[];return a[0]=e[0]-r[0],a[1]=e[1]-r[1],a[2]=e[2]-r[2],n[0]=a[2]*Math.sin(i)+a[0]*Math.cos(i),n[1]=a[1],n[2]=a[2]*Math.cos(i)-a[0]*Math.sin(i),t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2],t},a.rotateZ=function(t,e,r,i){var a=[],n=[];return a[0]=e[0]-r[0],a[1]=e[1]-r[1],a[2]=e[2]-r[2],n[0]=a[0]*Math.cos(i)-a[1]*Math.sin(i),n[1]=a[0]*Math.sin(i)+a[1]*Math.cos(i),n[2]=a[2],t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2],t},a.forEach=function(){var t=a.create();return function(e,r,i,a,n,s){var o,h;for(r||(r=3),i||(i=0),h=a?Math.min(a*r+i,e.length):e.length,o=i;o<h;o+=r)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],n(t,t,s),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2];return e}}(),a.angle=function(t,e){var r=a.fromValues(t[0],t[1],t[2]),i=a.fromValues(e[0],e[1],e[2]);a.normalize(r,r),a.normalize(i,i);var n=a.dot(r,i);return n>1?0:Math.acos(n)},a.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},a.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},a.equals=function(t,e){var r=t[0],a=t[1],n=t[2],s=e[0],o=e[1],h=e[2];return Math.abs(r-s)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(a-o)<=i.EPSILON*Math.max(1,Math.abs(a),Math.abs(o))&&Math.abs(n-h)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))},t.exports=a},function(t,e,r){var i=r(27),a={};a.create=function(){var t=new i.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},a.clone=function(t){var e=new i.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},a.fromValues=function(t,e,r,a){var n=new i.ARRAY_TYPE(4);return n[0]=t,n[1]=e,n[2]=r,n[3]=a,n},a.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},a.set=function(t,e,r,i,a){return t[0]=e,t[1]=r,t[2]=i,t[3]=a,t},a.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t},a.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t},a.sub=a.subtract,a.multiply=function(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t},a.mul=a.multiply,a.divide=function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t},a.div=a.divide,a.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},a.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},a.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t},a.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t},a.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},a.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},a.scaleAndAdd=function(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t},a.distance=function(t,e){var r=e[0]-t[0],i=e[1]-t[1],a=e[2]-t[2],n=e[3]-t[3];return Math.sqrt(r*r+i*i+a*a+n*n)},a.dist=a.distance,a.squaredDistance=function(t,e){var r=e[0]-t[0],i=e[1]-t[1],a=e[2]-t[2],n=e[3]-t[3];return r*r+i*i+a*a+n*n},a.sqrDist=a.squaredDistance,a.length=function(t){var e=t[0],r=t[1],i=t[2],a=t[3];return Math.sqrt(e*e+r*r+i*i+a*a)},a.len=a.length,a.squaredLength=function(t){var e=t[0],r=t[1],i=t[2],a=t[3];return e*e+r*r+i*i+a*a},a.sqrLen=a.squaredLength,a.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},a.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},a.normalize=function(t,e){var r=e[0],i=e[1],a=e[2],n=e[3],s=r*r+i*i+a*a+n*n;return s>0&&(s=1/Math.sqrt(s),t[0]=r*s,t[1]=i*s,t[2]=a*s,t[3]=n*s),t},a.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},a.lerp=function(t,e,r,i){var a=e[0],n=e[1],s=e[2],o=e[3];return t[0]=a+i*(r[0]-a),t[1]=n+i*(r[1]-n),t[2]=s+i*(r[2]-s),t[3]=o+i*(r[3]-o),t},a.random=function(t,e){return e=e||1,t[0]=i.RANDOM(),t[1]=i.RANDOM(),t[2]=i.RANDOM(),t[3]=i.RANDOM(),a.normalize(t,t),a.scale(t,t,e),t},a.transformMat4=function(t,e,r){var i=e[0],a=e[1],n=e[2],s=e[3];return t[0]=r[0]*i+r[4]*a+r[8]*n+r[12]*s,t[1]=r[1]*i+r[5]*a+r[9]*n+r[13]*s,t[2]=r[2]*i+r[6]*a+r[10]*n+r[14]*s,t[3]=r[3]*i+r[7]*a+r[11]*n+r[15]*s,t},a.transformQuat=function(t,e,r){var i=e[0],a=e[1],n=e[2],s=r[0],o=r[1],h=r[2],u=r[3],c=u*i+o*n-h*a,l=u*a+h*i-s*n,d=u*n+s*a-o*i,_=-s*i-o*a-h*n;return t[0]=c*u+_*-s+l*-h-d*-o,t[1]=l*u+_*-o+d*-s-c*-h,t[2]=d*u+_*-h+c*-o-l*-s,t[3]=e[3],t},a.forEach=function(){var t=a.create();return function(e,r,i,a,n,s){var o,h;for(r||(r=4),i||(i=0),h=a?Math.min(a*r+i,e.length):e.length,o=i;o<h;o+=r)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],t[3]=e[o+3],n(t,t,s),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2],e[o+3]=t[3];return e}}(),a.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},a.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},a.equals=function(t,e){var r=t[0],a=t[1],n=t[2],s=t[3],o=e[0],h=e[1],u=e[2],c=e[3];return Math.abs(r-o)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(a-h)<=i.EPSILON*Math.max(1,Math.abs(a),Math.abs(h))&&Math.abs(n-u)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(s-c)<=i.EPSILON*Math.max(1,Math.abs(s),Math.abs(c))},t.exports=a},function(t,e,r){"use strict";var i=function(){var t=function(t){return'<div style="margin: auto; width:500px;z-index:10000;margin-top:20em;text-align:center;">'+t+"</div>"},e='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>',r='It doesn\'t appear your computer can support WebGL.<br/><a href="http://get.webgl.org">Click here for more information.</a>',i=!0,a=function(a,n,o){function h(a){if(i){var n=document.getElementsByTagName("body")[0];if(n){var s=window.WebGLRenderingContext?r:e;a&&(s+="<br/><br/>Status: "+a),n.innerHTML=t(s)}}}o=o||h,a.addEventListener&&a.addEventListener("webglcontextcreationerror",function(t){o(t.statusMessage)},!1);var u=s(a,n);return u||o(""),u},n=function(t,e,r){for(var i=null,a=0;a<r.length;++a){try{i=t.getContext(r[a],e)}catch(t){}if(i)break}return i},s=function(t,e){var r;if(e&&e.webgl2){if(i=!1,r=n(t,e,["webgl2","experimental-webgl2"]))return r;i=!0}return n(t,e,["webgl","experimental-webgl","webkit-3d","moz-webgl"])};return{create3DContext:s,setupWebGL:a}}();window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,e){window.setTimeout(t,1e3/60)}}()),window.cancelRequestAnimFrame||(window.cancelAnimationFrame=function(){return window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout}()),Date.now||(Date.now=function(){return(new Date).getTime()}),e.a=i},function(t,e,r){"use strict";var i=r(82),a=function(){this._mask=a.DEFAULT_CULLING,this._frustum=new i.a};a.prototype={reset:function(){this._mask=a.DEFAULT_CULLING,this._frustum.clear()},setCullingMask:function(t){this._mask=t},getCullingMask:function(){return this._mask},setFrustum:function(t){this._frustum=t},getFrustum:function(){return this._frustum},getCurrentResultMask:function(){return this._frustum.getCurrentMask()},pushCurrentMask:function(){this._frustum.pushCurrentMask()},popCurrentMask:function(){this._frustum.popCurrentMask()},resetCullingMask:function(){this._frustum.setResultMask(this._frustum.getCurrentMask())},isBoundingBoxCulled:function(t){return!(!(this._mask&a.VIEW_FRUSTUM_CULLING)||this._frustum.containsBoundingBox(t))},isBoundingSphereCulled:function(t){return!(!(this._mask&a.VIEW_FRUSTUM_CULLING)||this._frustum.containsBoundingSphere(t))},isVerticesCulled:function(t){return!(!(this._mask&a.VIEW_FRUSTUM_CULLING)||this._frustum.containsVertices(t))}},a.NO_CULLING=0,a.VIEW_FRUSTUM_LEFT_CULLING=1,a.VIEW_FRUSTUM_RIGHT_CULLING=2,a.VIEW_FRUSTUM_TOP_CULLING=3,a.VIEW_FRUSTUM_BOTTOM_CULLING=4,a.NEAR_PLANE_CULLING=5,a.FAR_PLANE_CULLING=6,a.VIEW_FRUSTUM_SIDES_CULLING=a.VIEW_FRUSTUM_LEFT_CULLING|a.VIEW_FRUSTUM_RIGHT_CULLING|a.VIEW_FRUSTUM_BOTTOM_CULLING|a.VIEW_FRUSTUM_TOP_CULLING,a.VIEW_FRUSTUM_CULLING=a.VIEW_FRUSTUM_SIDES_CULLING|a.NEAR_PLANE_CULLING|a.FAR_PLANE_CULLING,a.DEFAULT_CULLING=a.VIEW_FRUSTUM_SIDES_CULLING,a.ENABLE_ALL_CULLING=a.VIEW_FRUSTUM_CULLING,e.a=a},function(t,e,r){"use strict";var i=r(0),a=r(40),n=r(15),s=r(48),o=r(49),h=r(108),u=r(1),c=r(43),l=r(23),d=r(12),_=r(19),f=r(25),g=r(63),p=function(){return new h.a},m=function(){this._modelViewMatrixStack=new _.a,this._projectionMatrixStack=new _.a,this._viewportStack=new _.a,this._cullingSetStack=new _.a,this._frustumVolume=-1,this._bbCornerFar=0,this._bbCornerNear=0,this._pooledMatrix=new f.a(u.c.create),this._pooledCullingSet=new f.a(p),this._cameraIndexStack=new _.a,this._cameraModelViewIndexStack=new _.a,this._cameraMatrixInverse=new g.a,this._cameraMatrixInverseRoot=void 0};i.a.createPrototypeObject(m,i.a.objectInherit(o.a.prototype,{reset:function(){this._modelViewMatrixStack.reset(),this._projectionMatrixStack.reset(),this._cullingSetStack.reset(),this._pooledMatrix.reset(),this._pooledCullingSet.reset(),this._cameraModelViewIndexStack.reset(),this._cameraIndexStack.reset(),this._cameraMatrixInverse.reset(),this._cameraMatrixInverseRoot=void 0},getProjectionMatrixStack:function(){return this._projectionMatrixStack},getCurrentProjectionMatrix:function(){return this._projectionMatrixStack.back()},getCurrentModelViewMatrix:function(){return this._modelViewMatrixStack.back()},getCameraInverseMatrix:function(){if(!this._cameraIndexStack.getLength())return this._cameraMatrixInverseRoot;var t=this._cameraIndexStack.back(),e=this.getNodePath()[t],r=e.getInstanceID(),i=this._cameraMatrixInverse.getMap(),a=i[r];if(void 0===a){var n=this._cameraModelViewIndexStack.back(),s=this._modelViewMatrixStack.getArray()[n];a=this._pooledMatrix.getOrCreateObject(),u.c.invert(a,s),this._cameraMatrixInverse.set(r,a)}return a},getCurrentModelMatrix:function(){var t=this.getCameraInverseMatrix(),e=this._pooledMatrix.getOrCreateObject();return u.c.mul(e,t,this.getCurrentModelViewMatrix())},getCurrentViewMatrix:function(){var t=this._modelViewMatrixStack.getArray();return this._cameraIndexStack.getLength()?t[this._cameraModelViewIndexStack.back()]:t[0]},getViewport:function(){if(0!==this._viewportStack.getLength())return this._viewportStack.back()},getLookVectorLocal:function(t){var e=this.getCurrentModelViewMatrix();return u.f.set(t,-e[2],-e[6],-e[10])},pushViewport:function(t){this._viewportStack.push(t)},popViewport:function(){this._viewportStack.pop()},getFrustumPlanes:function(){var t=u.c.create();return function(e,r,i,a){u.c.mul(t,r,i);var n=!!a,s=e[0];s[0]=t[3]-t[0],s[1]=t[7]-t[4],s[2]=t[11]-t[8],s[3]=t[15]-t[12];var o=e[1];o[0]=t[3]+t[0],o[1]=t[7]+t[4],o[2]=t[11]+t[8],o[3]=t[15]+t[12];var h=e[2];h[0]=t[3]+t[1],h[1]=t[7]+t[5],h[2]=t[11]+t[9],h[3]=t[15]+t[13];var l=e[3];if(l[0]=t[3]-t[1],l[1]=t[7]-t[5],l[2]=t[11]-t[9],l[3]=t[15]-t[13],n){var d=e[4];d[0]=t[3]-t[2],d[1]=t[7]-t[6],d[2]=t[11]-t[10],d[3]=t[15]-t[14];var _=e[5];_[0]=t[3]+t[2],_[1]=t[7]+t[6],_[2]=t[11]+t[10],_[3]=t[15]+t[14]}for(var f=a?6:4,g=0;g<f;g++)c.a.normalizeEquation(e[g])}}(),pushCullingSet:function(){var t=this._pooledCullingSet.getOrCreateObject();this._enableFrustumCulling&&(u.c.getFrustumPlanes(t.getFrustum().getPlanes(),this.getCurrentProjectionMatrix(),this.getCurrentModelViewMatrix(),!1),t.getFrustum().setupMask(4)),this._cullingSetStack.push(t)},popCullingSet:function(){return this._cullingSetStack.pop()},getCurrentCullingSet:function(){return this._cullingSetStack.back()},pushCurrentMask:function(){var t=this.getCurrentCullingSet();t&&t.pushCurrentMask()},popCurrentMask:function(){var t=this.getCurrentCullingSet();t&&t.popCurrentMask()},isVerticesCulled:function(t){return!!this._enableFrustumCulling&&this.getCurrentCullingSet().isVerticesCulled(t)},isBoundingBoxCulled:function(t){return!!this._enableFrustumCulling&&(t.valid()&&this.getCurrentCullingSet().isBoundingBoxCulled(t))},isBoundingSphereCulled:function(t){return!!this._enableFrustumCulling&&(t.valid()&&this.getCurrentCullingSet().isBoundingSphereCulled(t))},isCulled:function(){var t=new a.a;return function(e,r){if(!this._enableFrustumCulling)return!1;if(e.isCullingActive()){if(0===this.getCurrentCullingSet().getCurrentResultMask())return!1;var i=this._pooledMatrix.getOrCreateObject();u.c.identity(i);var a=r.length;return e instanceof l.a&&a--,s.a.computeLocalToWorld(r,!0,i,a),e.getBound().transformMat4(t,i),this.getCurrentCullingSet().isBoundingSphereCulled(t)}return this.getCurrentCullingSet().resetCullingMask(),!1}}(),pushModelViewMatrix:function(){var t=u.f.create();return function(e){var r=this.getNodePath(),i=r.length;if(i){var a=i-1;r[a].getTypeID()===n.a.getTypeID()&&r[a].getReferenceFrame()===d.a.ABSOLUTE_RF&&(this._cameraIndexStack.push(a),this._cameraModelViewIndexStack.push(this._modelViewMatrixStack.getLength()))}else{var s=this._pooledMatrix.getOrCreateObject();u.c.invert(s,e),this._cameraMatrixInverseRoot=s}this._modelViewMatrixStack.push(e),this.getLookVectorLocal(t),this._bbCornerFar=(t[0]>=0?1:0)|(t[1]>=0?2:0)|(t[2]>=0?4:0),this._bbCornerNear=7&~this._bbCornerFar}}(),popModelViewMatrix:function(){var t=u.f.create();return function(){var e=this.getNodePath(),r=e.length-1;this._cameraIndexStack.getLength()&&r===this._cameraIndexStack.back()&&(this._cameraIndexStack.pop(),this._cameraModelViewIndexStack.pop()),this._modelViewMatrixStack.pop(),this._modelViewMatrixStack.getLength()?this.getLookVectorLocal(t):u.f.set(t,0,0,-1),this._bbCornerFar=(t[0]>=0?1:0)|(t[1]>=0?2:0)|(t[2]>=0?4:0),this._bbCornerNear=7&~this._bbCornerFar}}(),pushProjectionMatrix:function(t){this._projectionMatrixStack.push(t),this._frustumVolume=-1,this.pushCullingSet()},popProjectionMatrix:function(){this._projectionMatrixStack.pop(),this._frustumVolume=-1,this.popCullingSet()}}),"osg","CullStack"),e.a=m},function(t,e,r){"use strict";var i=r(64),a=[function(t,e,r,i,a){t.applyModelViewMatrix(e,r),t.applyProjectionMatrix(a)},function(t,e,r,i,a){var n=t.getGraphicContext(),s=t.applyModelViewMatrix(e,r);if(t.applyProjectionMatrix(a),s){var o=t._modelMatrix;o.setMatrix4(r),o.apply(n,this.modelUniform)}},function(t,e,r,i,a){var n=t.getGraphicContext(),s=t.applyModelViewMatrix(e,r);if(t.applyProjectionMatrix(a),s){var o=t._viewMatrix;o.setMatrix4(i),o.apply(n,this.viewUniform)}},function(t,e,r,i,a){var n=t.getGraphicContext(),s=t.applyModelViewMatrix(e,r);if(t.applyProjectionMatrix(a),s){var o=t._modelMatrix;o.setMatrix4(r),o.apply(n,this.modelUniform);var h=t._viewMatrix;h.setMatrix4(i),h.apply(n,this.viewUniform)}}],n=function(t,e){this.modelUniform=e._uniformsCache[t._modelMatrix.getName()],this.viewUniform=e._uniformsCache[t._viewMatrix.getName()];var r=0;this.modelUniform&&(r=1),this.viewUniform&&(r|=2),this.apply=a[r]},s=function(){this._parent=void 0,this._geometry=void 0,this._depth=0,this._projection=void 0,this._view=void 0,this._model=void 0,this._modelView=void 0};s.prototype={reset:function(){this._parent=void 0,this._geometry=void 0,this._depth=0,this._projection=void 0,this._view=void 0,this._model=void 0,this._modelView=void 0},init:function(t,e,r,i,a,n,s){this._parent=t,this._geometry=e,this._depth=s,this._projection=r,this._view=i,this._model=n,this._modelView=a},drawGeometry:function(){return function(t){var e=t.getLastProgramApplied(),r=e.getInstanceID(),i=t.getCacheUniformsApplyRenderLeaf(),a=i[r];a||(a=new n(t,e),i[r]=a),a.apply(t,this._modelView,this._model,this._view,this._projection),this._geometry.drawImplementation(t)}}(),render:function(){var t=0,e=-1;return function(r,a){var n,s,o=this._parent,h=o._parent,u=o._stateset;void 0!==a?(n=a._parent,s=n._parent,s!==h?(i.a.moveStateGraph(r,s,h),r.applyStateSet(u)):o!==n?r.applyStateSet(u):r._stateSetStackChanged(t,e)&&r.applyStateSet(u)):(i.a.moveStateGraph(r,void 0,h),r.applyStateSet(u)),r._setStateSetsDrawID(++t),e=r.getStateSetStackSize(),this.drawGeometry(r)}}()},e.a=s},function(t,e,r){"use strict";var i=r(0),a=r(8),n=r(3),s=function(){a.a.call(this),this._values=[]};i.a.createPrototypeNode(s,i.a.objectInherit(a.a.prototype,{addChild:function(t,e){return a.a.prototype.addChild.call(this,t),void 0===e&&(e=!0),this.children.length>this._values.length?this._values.push(e):this._values[this.children.length-1]=e,!0},setValue:function(t,e){t<this._values.length&&(this._values[t]=e)},getValue:function(t){if(t<this._values.length)return this._values[t]},setAllChildrenOff:function(){for(var t=0;t<this._values.length;++t)this._values[t]=!1},setAllChildrenOn:function(){for(var t=0;t<this._values.length;++t)this._values[t]=!0},traverse:function(){return function(t){switch(t.traversalMode){case n.a.TRAVERSE_ALL_CHILDREN:for(var e=0;e<this.children.length;++e)this.children[e].accept(t);break;case n.a.TRAVERSE_ACTIVE_CHILDREN:var r=this.children.length;for(this._values.length<r&&(r=this._values.length),e=0;e<r;++e)!0===this._values[e]&&this.children[e].accept(t)}}}()}),"osg","Switch"),e.a=s},function(t,e,r){"use strict";var i=r(0),a=r(44),n=r(3),s=r(2),o=r(5),h=function(){n.a.call(this)};i.a.createPrototypeObject(h,i.a.objectInherit(n.a.prototype,{apply:function(t){if(t.getTypeID()===a.a.getTypeID()){for(var e=!1,r=t.getChildren(),i=0,n=t.getChildren().length;i<n;i++){if(r[i].getTypeID()===a.a.getTypeID()){if(e)return void s.a.warn("Warning: a Bone was found after a non-Bone child within a Skeleton. Children of a Bone must be ordered with all child Bones first for correct update order.")}else e=!0}this.traverse(t)}}}),"osgAnimation","ValidateSkeletonVisitor");var u=function(t,e){return(t instanceof a.a?0:1)-(e instanceof a.a?0:1)},c=function(){this._needValidate=!0};i.a.createPrototypeObject(c,i.a.objectInherit(o.a.prototype,{needToValidate:function(){return this._needValidate},update:function(t,e){if(this._needValidate&&e.getVisitorType()===n.a.UPDATE_VISITOR&&t.className&&"Skeleton"===t.className()){for(var r=new h,i=t.getChildren(),a=0,s=i.length;a<s;a++){i[a].accept(r)}i.sort(u),this._needValidate=!1}return!0}}),"osgAnimation","UpdateSkeleton"),e.a=c},function(t,e,r){"use strict";var i=r(0),a=r(4),n=r(6),s=function(t,e){a.a.call(this),this._nbTarget=t,this._enable=!e,this._targetNames={},this._hashNames="",this._hash="",this._dirtyHash=!0};s.uniforms={},i.a.createPrototypeStateAttribute(s,i.a.objectInherit(a.a.prototype,{attributeType:"Morph",cloneType:function(){return new s(void 0,!0)},hasTarget:function(t){return!!this._targetNames[t]},copyTargetNames:function(t){for(var e=this._targetNames,r="",i=e.length=t.length,a=0;a<i;++a){var n=t[a];e[n]=!0,r+=n}this._hashNames=r,this._dirtyHash=!0},getOrCreateUniforms:function(){var t=s,e=this.getNumTargets();return t.uniforms[e]?t.uniforms[e]:(t.uniforms[e]={uTargetWeights:n.a.createFloat4("uTargetWeights")},t.uniforms[e])},setNumTargets:function(t){this._nbTarget=t,this._dirtyHash=!0},getNumTargets:function(){return this._nbTarget},setTargetWeights:function(t){this._targetWeights=t},getTargetWeights:function(){return this._targetWeights},isEnabled:function(){return this._enable},getHash:function(){return this._dirtyHash?(this._hash=this._computeInternalHash(),this._dirtyHash=!1,this._hash):this._hash},_computeInternalHash:function(){return this.getTypeMember()+this._hashNames+this.getNumTargets()+this.isEnabled()},apply:function(){if(this._enable){this.getOrCreateUniforms().uTargetWeights.setFloat4(this._targetWeights)}}}),"osgAnimation","MorphAttribute"),e.a=s},function(t,e,r){"use strict";var i=r(0),a=r(4),n=r(6),s=function(t,e){a.a.call(this),this._enable=!t,this._boneUniformSize=e,this._dirtyHash=!0,this._hash=""};s.uniforms={},s.maxBoneUniformSize=1,s.maxBoneUniformAllowed=1/0,i.a.createPrototypeStateAttribute(s,i.a.objectInherit(a.a.prototype,{attributeType:"Skinning",cloneType:function(){return new s(!0)},getBoneUniformSize:function(){return void 0!==this._boneUniformSize?this._boneUniformSize:s.maxBoneUniformSize},getOrCreateUniforms:function(){var t=s,e=this.getBoneUniformSize();return t.uniforms[e]?t.uniforms[e]:(t.uniforms[e]={uBones:n.a.createFloat4Array("uBones",e)},t.uniforms[e])},setMatrixPalette:function(t){this._matrixPalette=t,void 0===this._boneUniformSize&&(s.maxBoneUniformSize=Math.max(s.maxBoneUniformSize,t.length/4),s.maxBoneUniformSize=Math.min(s.maxBoneUniformAllowed,s.maxBoneUniformSize))},getMatrixPalette:function(){return this._matrixPalette},isEnabled:function(){return this._enable},getHash:function(){return this._dirtyHash?(this._hash=this._computeInternalHash(),this._dirtyHash=!0,this._hash):this._hash},_computeInternalHash:function(){return this.getTypeMember()+this.getBoneUniformSize()+this.isEnabled()},apply:function(){this._enable&&this.getOrCreateUniforms().uBones.getInternalArray().set(this._matrixPalette)}}),"osgAnimation","SkinningAttribute"),e.a=s},function(t,e,r){"use strict";var i=function(t,e,r){this._mode=t,this._first=e,this._arrayLengths=r.slice(0)};i.prototype={draw:function(t){for(var e=t.getGraphicContext(),r=this._mode,i=this._first,a=this._arrayLengths,n=0,s=a.length;n<s;n++){var o=a[n];e.drawArrays(r,i,o),i+=o}},getMode:function(){return this._mode},getNumIndices:function(){for(var t=0,e=this._arrayLengths,r=0,i=e.length;r<i;r++)t+=e[r];return t},getCount:function(){return this.getNumIndices()},getArrayLengths:function(){return this._arrayLengths},getFirst:function(){return this._first},setFirst:function(t){this._first=t}},e.a=i},function(t,e,r){"use strict";var i=function(){this._frame=0,this._startSimulation=0,this._currentSimulation=0,this._deltaTime=0};i.prototype={setReferenceTime:function(t){this._startSimulation=t},getReferenceTime:function(){return this._startSimulation},setSimulationTime:function(t){this._currentSimulation=t},getSimulationTime:function(){return this._currentSimulation},setDeltaTime:function(t){this._deltaTime=t},getDeltaTime:function(){return this._deltaTime},setFrameNumber:function(t){this._frame=t},getFrameNumber:function(){return this._frame}},e.a=i},function(t,e,r){"use strict";var i=r(0),a=r(1),n=r(24),s=r(87),o=r(9),h=r(2),u=function(t,e){this._bb=new n.a,this._first=t,this._second=e,this._nodeRayStart=a.f.create(),this._nodeRayEnd=a.f.create()},c=function(){this._numVertexIndices=0};c.prototype={apply:function(t){t.getAttributes().Vertex&&Object(s.a)(t,this)},operatorPoint:function(){this._numVertexIndices+=2},operatorLine:function(){this._numVertexIndices+=3},operatorTriangle:function(){this._numVertexIndices+=4}};var l=function(t){this._buildKdTree=t,this._numIndices=0};l.prototype={apply:function(t){t.getAttributes().Vertex&&Object(s.a)(t,this)},operatorPoint:function(t){var e=this._buildKdTree._kdTree.getVertices(),r=3*t;this._buildKdTree._kdTree.addPoint(t),this._buildKdTree._primitiveIndices[this._numIndices]=this._numIndices;var i=this._buildKdTree._centers,a=3*this._numIndices;i[a]=e[r],i[a+1]=e[r+1],i[a+2]=e[r+2],this._numIndices++},operatorLine:function(t,e){if(t!==e){var r=this._buildKdTree._kdTree.getVertices(),i=3*t,a=3*e;this._buildKdTree._kdTree.addLine(t,e);var n=this._numIndices;this._buildKdTree._primitiveIndices[n]=n;var s=3*n,o=r[i],h=r[i+1],u=r[i+2],c=r[a],l=r[a+1],d=r[a+2],_=o<c?o:c,f=h<l?h:l,g=u<d?u:d,p=o>c?o:c,m=h>l?h:l,v=u>d?u:d,S=this._buildKdTree._centers;S[s]=.5*(_+p),S[s+1]=.5*(f+m),S[s+2]=.5*(g+v),this._numIndices++}},operatorTriangle:function(t,e,r){if(t!==e&&t!==r&&e!==r){var i=this._buildKdTree._kdTree.getVertices(),a=3*t,n=3*e,s=3*r;this._buildKdTree._kdTree.addTriangle(t,e,r);var o=this._numIndices;this._buildKdTree._primitiveIndices[o]=o;var h=3*o,u=i[a],c=i[a+1],l=i[a+2],d=i[n],_=i[n+1],f=i[n+2],g=i[s],p=i[s+1],m=i[s+2],v=u<d?u<g?u:g:d<g?d:g,S=c<_?c<p?c:p:_<p?_:p,b=l<f?l<m?l:m:f<m?f:m,x=u>d?u>g?u:g:d>g?d:g,y=c>_?c>p?c:p:_>p?_:p,M=l>f?l>m?l:m:f>m?f:m,T=this._buildKdTree._centers;T[h]=.5*(v+x),T[h+1]=.5*(S+y),T[h+2]=.5*(b+M),this._numIndices++}}};var d=function(t){this._kdTree=t,this._bb=new n.a,this._primitiveIndices=void 0,this._centers=void 0,this._axisOrder=a.f.create(),this._stackLength=0};d.prototype={build:function(t,e){var r=t._targetNumTrianglesPerLeaf,i=e.getVertexAttributeList().Vertex;if(!i)return!1;var a=i.getElements();if(!a)return!1;var s=a.length/3;if(s<r)return!1;this._bb.copy(e.getBoundingBox()),this._kdTree.setVertices(a),this.computeDivisions(t),t._numVerticesProcessed+=s;for(var h=0,d=e.getPrimitiveSetList(),_=d.length,f=0;f<_;f++){var g=d[f],p=g.getMode();p===o.a.TRIANGLE_STRIP||p===o.a.TRIANGLE_FAN?h+=3*Math.abs(g.getCount()-2):h+=3*g.getCount()}var m=new c(this);m.apply(e);var v=m._numVertexIndices;this._primitiveIndices=new Uint32Array(h/3),this._centers=new Float32Array(h),this._kdTree.setPrimitiveIndices(new Uint32Array(h));var S=s>65535?new Uint32Array(v):new Uint16Array(v);this._kdTree.setVertexIndices(S);var b=new l(this);b.apply(e);var x=this._kdTree.getPrimitiveIndices().slice(0,this._kdTree.getNumPrimitiveIndices());this._kdTree.setPrimitiveIndices(x);var y=this._kdTree.getVertexIndices().slice(0,this._kdTree.getNumVertexIndices());this._kdTree.setVertexIndices(y),this._primitiveIndices=this._primitiveIndices.slice(0,b._numIndices),this._centers=this._centers.slice(0,3*b._numIndices);var M=new u(-1,this._primitiveIndices.length);M._bb.copy(this._bb);var T=this._kdTree.addNode(M),A=new n.a;A.copy(this._bb),this.divide(t,A,T,0);var C=this._kdTree.getPrimitiveIndices();for(_=this._primitiveIndices.length,f=0;f<_;++f)this._primitiveIndices[f]=C[this._primitiveIndices[f]];return this._kdTree.setPrimitiveIndices(this._primitiveIndices),this._kdTree.getNodes().length>0},computeDivisions:function(t){this._stackLength=t._maxNumLevels;var e=this._bb._max,r=this._bb._min,i=e[0]-r[0],a=e[1]-r[1],n=e[2]-r[2],s=this._axisOrder;s[0]=i>=a&&i>=n?0:a>=n?1:2,s[2]=i<a&&i<n?0:a<n?1:2;var o=s[0]+s[2];s[1]=3===o?0:2===o?1:2},divide:function(t,e,r,i){var a=this._kdTree,n=this._primitiveIndices,s=a.getNodes(),o=s[r],h=o._first,c=o._second,l=i<this._stackLength&&h<0&&c>t._targetNumTrianglesPerLeaf,d=-h-1,_=d+c-1;if(!l)return h<0&&this.computeNodeBox(o,d,_),r;if(h>=0)return r;for(var f=this._axisOrder[i%3],g=e._min[f],p=e._max[f],m=.5*(g+p),v=0,S=0,b=!1,x=d,y=_,M=this._centers;x<y;){for(;x<y&&M[3*n[x]+f]<=m;)++x;for(;x<y&&M[3*n[y]+f]>m;)--y;if(x<y){var T=n[x];n[x]=n[y],n[y]=T,++x,--y}}x===y&&(M[3*n[x]+f]<=m?++x:--y),y-d<=-1?(v=0,S=r,b=!0):_-x<=-1?(v=r,S=0,b=!0):(v=a.addNode(new u(-d-1,y-d+1)),S=a.addNode(new u(-x-1,_-x+1)));var A=e._max[f];e._max[f]=m;var C=0!==v?this.divide(t,e,v,i+1):0;e._max[f]=A,A=e._min[f],e._min[f]=m;var I=0!==S?this.divide(t,e,S,i+1):0;if(e._min[f]=A,!b){o._first=C,o._second=I,b=!0;var w=o._bb;w.init(),0!==C&&w.expandByBoundingBox(s[C]._bb),0!==I&&w.expandByBoundingBox(s[I]._bb)}return r},computeNodeBox:function(t,e,r){for(var i=1/0,a=1/0,n=1/0,s=-1/0,o=-1/0,h=-1/0,u=this._kdTree.getVertexIndices(),c=this._kdTree.getPrimitiveIndices(),l=this._kdTree.getVertices(),d=e;d<=r;++d)for(var _=c[this._primitiveIndices[d]],f=u[_++],g=0;g<f;++g){var p=3*u[_++],m=l[p],v=l[p+1],S=l[p+2];m<i&&(i=m),v<a&&(a=v),S<n&&(n=S),m>s&&(s=m),v>o&&(o=v),S>h&&(h=S)}var b=t._bb,x=b._min,y=b._max;x[0]=i-1e-6,x[1]=a-1e-6,x[2]=n-1e-6,y[0]=s+1e-6,y[1]=o+1e-6,y[2]=h+1e-6}};var _=function(){this._vertices=null,this._kdNodes=[],this._primitiveIndices=void 0,this._vertexIndices=void 0,this._numVertexIndices=0,this._numPrimitiveIndices=0};i.a.createPrototypeObject(_,{getVertices:function(){return this._vertices},setVertices:function(t){this._vertices=t},getNumPrimitiveIndices:function(){return this._numPrimitiveIndices},getNumVertexIndices:function(){return this._numVertexIndices},setPrimitiveIndices:function(t){this._primitiveIndices=t},getPrimitiveIndices:function(){return this._primitiveIndices},setVertexIndices:function(t){this._vertexIndices=t},getVertexIndices:function(){return this._vertexIndices},getNodes:function(){return this._kdNodes},addPoint:function(t){var e=this._numVertexIndices;this._primitiveIndices[this._numPrimitiveIndices++]=e,this._vertexIndices[this._numVertexIndices++]=1,this._vertexIndices[this._numVertexIndices++]=t},addLine:function(t,e){var r=this._numVertexIndices;this._primitiveIndices[this._numPrimitiveIndices++]=r,this._vertexIndices[this._numVertexIndices++]=2,this._vertexIndices[this._numVertexIndices++]=t,this._vertexIndices[this._numVertexIndices++]=e},addTriangle:function(t,e,r){var i=this._numVertexIndices;this._primitiveIndices[this._numPrimitiveIndices++]=i,this._vertexIndices[this._numVertexIndices++]=3,this._vertexIndices[this._numVertexIndices++]=t,this._vertexIndices[this._numVertexIndices++]=e,this._vertexIndices[this._numVertexIndices++]=r},addNode:function(t){return this._kdNodes.push(t),this._kdNodes.length-1},build:function(t,e){return new d(this).build(t,e)},_intersectFunctor:function(t,e){var r=-e._first-1,i=r+e._second,a=this._vertexIndices;t.setVertices(this._vertices),t.setPrimitiveIndex(r);for(var n=r;n<i;++n){var s=this._primitiveIndices[n],o=a[s++];3===o?t.operatorTriangle(a[s],a[s+1],a[s+2]):2===o?t.operatorLine(a[s],a[s+1]):1===o?t.operatorPoint(a[s]):h.a.error("KdTree::intersect() unsupported vertices count :"+o)}},intersect:function(t,e){if(e._first<0)return void this._intersectFunctor(t,e);t.enter(e._bb)&&(e._first>0&&this.intersect(t,this._kdNodes[e._first]),e._second>0&&this.intersect(t,this._kdNodes[e._second]),t.leave())},intersectLineSegment:function(t,e,r,i){if(e._first<0)return void this._intersectFunctor(t,e);var n=e._nodeRayStart,s=e._nodeRayEnd;a.f.copy(n,r),a.f.copy(s,i);var o,h=this._kdNodes;e._first>0&&(o=h[e._first],t.enter(o._bb,n,s)&&this.intersectLineSegment(t,o,n,s)),e._second>0&&(a.f.copy(n,r),a.f.copy(s,i),o=h[e._second],t.enter(o._bb,n,s)&&this.intersectLineSegment(t,o,n,s))}},"osg","KdTree"),e.a=_},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(0),a=r(4),n=r(1),s=r(6),o=function(){a.a.call(this),this._ambient=n.g.fromValues(.2,.2,.2,1),this._diffuse=n.g.fromValues(.8,.8,.8,1),this._specular=n.g.fromValues(0,0,0,1),this._emission=n.g.fromValues(0,0,0,1),this._shininess=12.5};i.a.createPrototypeStateAttribute(o,i.a.objectInherit(a.a.prototype,{attributeType:"Material",cloneType:function(){return new o},getParameterName:function(t){return"u"+this.getType()+"_"+t},getOrCreateUniforms:function(){var t=o;return t.uniforms?t.uniforms:(t.uniforms={ambient:s.a.createFloat4("uMaterialAmbient"),diffuse:s.a.createFloat4("uMaterialDiffuse"),specular:s.a.createFloat4("uMaterialSpecular"),emission:s.a.createFloat4("uMaterialEmission"),shininess:s.a.createFloat1("uMaterialShininess")},t.uniforms)},setEmission:function(t){n.g.copy(this._emission,t)},getEmission:function(){return this._emission},setAmbient:function(t){n.g.copy(this._ambient,t)},getAmbient:function(){return this._ambient},setSpecular:function(t){n.g.copy(this._specular,t)},getSpecular:function(){return this._specular},setDiffuse:function(t){n.g.copy(this._diffuse,t)},getDiffuse:function(){return this._diffuse},setShininess:function(t){this._shininess=t},getShininess:function(){return this._shininess},setTransparency:function(t){this._diffuse[3]=1-t},getTransparency:function(){return this._diffuse[3]},apply:function(){var t=this.getOrCreateUniforms();t.ambient.setFloat4(this._ambient),t.diffuse.setFloat4(this._diffuse),t.specular.setFloat4(this._specular),t.emission.setFloat4(this._emission),t.shininess.setFloat(this._shininess)}}),"osg","Material"),e.default=o},function(t,e,r){"use strict";var i=r(200),a=r.n(i),n=r(201),s=r.n(n),o=r(202),h=r.n(o),u=r(203),c=r.n(u),l=r(204),d=r.n(l),_=r(205),f=r.n(_),g=r(206),p=r.n(g),m=r(207),v=r.n(m),S=r(208),b=r.n(S);e.a={"common.glsl":a.a,"functions.glsl":s.a,"lightCommon.glsl":h.a,"lights.glsl":c.a,"skinning.glsl":d.a,"morphing.glsl":f.a,"textures.glsl":p.a,"colorEncode.glsl":v.a,"billboard.glsl":b.a}},function(t,e,r){"use strict";var i=r(209),a=r.n(i),n=r(210),s=r.n(n),o=r(211),h=r.n(o),u=r(212),c=r.n(u),l=r(213),d=r.n(l);e.a={"shadowCast.glsl":a.a,"shadowReceive.glsl":s.a,"shadowLinearSoft.glsl":h.a,"floatFromTex.glsl":c.a,"tapPCF.glsl":d.a}},function(t,e,r){"use strict";var i=function(){this._globalDefault=void 0,this._lastApplied=void 0,this._changed=!1,this._values=[],this._back=void 0,this._length=0};i.prototype={getLength:function(){return this._length},push:function(t,e){var r;this._length===this._values.length?(r={object:t,value:e},this._values.push(r)):(r=this._values[this._length],r.object=t,r.value=e),this._back=r,this._length++},pop:function(){if(this._length){var t=this._values;this._length--;var e=t[this._length];return this._back=this._length?t[this._length-1]:void 0,e}}},e.a=i},function(t,e,r){"use strict";var i=r(1),a=r(2),n=r(5),s=r(21),o=r(4),h=r(19),u=r(121),c=r(6),l=r(0),d=r(28),_=r(214),f=[void 0,function(t,e){return t[0]===e[0]||(e[0]=t[0],!1)},function(t,e){return t[0]===e[0]&&t[1]===e[1]||(e[0]=t[0],e[1]=t[1],!1)},function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]||(e[0]=t[0],e[1]=t[1],e[2]=t[2],!1)},function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]||(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],!1)}],g=function(t){n.a.call(this),this._excludeUniforms={uProjectionMatrix:!0,uModelMatrix:!0,uViewMatrix:!0,uModelViewMatrix:!0,uModelNormalMatrix:!0,uModelViewNormalMatrix:!0,uArrayColorEnabled:!0},this._graphicContext=void 0,this._shaderGeneratorProxy=t,void 0===t&&console.break(),this._currentVAO=null,this._currentIndexVBO=null,this._stateSets=new h.a,this._shaderGeneratorNames=new u.a,this._uniforms={},this._textureAttributeArrayList=[],this._attributeArray=[],this._projectionMatrix=c.a.createMatrix4(i.c.create(),"uProjectionMatrix"),this._modelMatrix=c.a.createMatrix4(i.c.create(),"uModelMatrix"),this._viewMatrix=c.a.createMatrix4(i.c.create(),"uViewMatrix"),this._modelViewMatrix=c.a.createMatrix4(i.c.create(),"uModelViewMatrix"),this._modelNormalMatrix=c.a.createMatrix3(i.b.create(),"uModelNormalMatrix"),this._modelViewNormalMatrix=c.a.createMatrix3(i.b.create(),"uModelViewNormalMatrix");var e=new u.a;e._globalDefault=c.a.createFloat1(0,"uArrayColorEnabled"),this._uniforms.ArrayColorEnabled=e,this._previousColorAttribPair={},this._vertexAttribMap={},this._vertexAttribMap._disable=[],this._vertexAttribMap._keys=[],this._frameStamp=void 0,this._programCommonUniformsCache={},this._lastAppliedModelViewMatrix=void 0,this._lastAppliedProjectionMatrix=void 0,this._program=void 0;var r=new s.a;this.applyAttribute(r),this._programType=l.a.getOrCreateStateAttributeTypeMemberIndex(r),this._programAttribute=this._attributeArray[this._programType],this._numPushStateSet=0,this._numApply=0,this._programUniformCache=[],this._cacheUniformId=0,this._stateCache=new _.a,this.resetStats()};l.a.createPrototypeObject(g,l.a.objectInherit(n.a.prototype,{getExcludeUniforms:function(){return this._excludeUniforms},resetCaches:function(){this._currentVAO=null,this._currentIndexVBO=null,this._previousColorAttribPair={},this._vertexAttribMap={},this._vertexAttribMap._disable=[],this._vertexAttribMap._keys=[],this._programCommonUniformsCache={}},applyColorMask:function(t){this._stateCache.applyColorMaskAttribute(t)},applyBlendFunc:function(t){this._stateCache.applyBlendFuncAttribute(t)},applyCullFace:function(t){this._stateCache.applyCullFaceAttribute(t)},applyDepth:function(t){this._stateCache.applyDepthAttribute(t)},applyViewport:function(t){this._stateCache.applyViewportAttribute(t)},applyScissor:function(t){this._stateCache.applyScissorAttribute(t)},viewport:function(t,e,r,i){this._stateCache.viewport(t,e,r,i)},depthMask:function(t){this._stateCache.depthMask(t)},clearDepth:function(t){this._stateCache.clearDepth(t)},clearColor:function(t){this._stateCache.clearColor(t)},clear:function(t){this._stateCache.clear(this._graphicContext,t)},drawGeometry:function(t){this._stateCache.drawGeometry(this._graphicContext,t)},getCacheUniformsApplyRenderLeaf:function(){return this._programCommonUniformsCache},setGraphicContext:function(t){this._graphicContext=t,this._extVAO=d.a.instance(t).getWebGLExtension("OES_vertex_array_object")},getGraphicContext:function(){return this._graphicContext},getShaderGeneratorProxy:function(){return this._shaderGeneratorProxy},pushCheckOverride:function(t,e,r){var i=this._evaluateOverrideObjectOnStack(t,e,r);i!==e?t.push(i,t._back.value):t.push(e,r)},_evaluateOverrideObjectOnStack:function(t,e,r){var i=t._back;return 0===t._length?e:i.value&o.a.OVERRIDE&&!(r&o.a.PROTECTED)?i.object:e},pushStateSet:function(t){this._numPushStateSet++,this._stateSets.push(t),this.pushAttributeMap(this._attributeArray,t._attributeArray,t._activeAttribute);for(var e=t._textureAttributeArrayList,r=t._activeTextureAttributeUnit,i=t._activeTextureAttribute,a=0,n=r.length;a<n;a++){var s=r[a],o=e[s],h=this.getOrCreateTextureAttributeArray(s);this.pushAttributeMap(h,o,i)}t.hasUniform()&&this.pushUniformsList(this._uniforms,t.getUniformList());var u=t.getShaderGeneratorPair();u&&this.pushCheckOverride(this._shaderGeneratorNames,u.getShaderGeneratorName(),u.getValue())},getStateSetStackSize:function(){return this._stateSets.getLength()},insertStateSet:function(){var t=new h.a,e=t.getArray();return function(r,i){t.reset();for(var a=this.getStateSetStackSize();a>r;)t.push(this._stateSets.back()),this.popStateSet(),a--;this.pushStateSet(i);for(var n=t._length-1;n>=0;n--)this.pushStateSet(e[n])}}(),removeStateSet:function(){var t=new h.a,e=t.getArray();return function(r){var i=this.getStateSetStackSize();if(r>=i)return void a.a.warn("Warning State:removeStateSet "+r+" out of range");for(t.reset();i-1>r;)t.push(this._stateSets.back()),this.popStateSet(),i--;this.popStateSet();for(var n=t._length-1;n>=0;n--)this.pushStateSet(e[n])}}(),resetCacheFrame:function(){this._lastAppliedModelViewMatrix=this._lastAppliedProjectionMatrix=void 0},resetStats:function(){this._numApply=0,this._numPushStateSet=0},applyProgram:function(t){this._program!==t&&(this._program=t,this.getGraphicContext().useProgram(t))},applyModelViewMatrix:function(){var t=i.b.create();return function(e,r){if(this._lastAppliedModelViewMatrix===e)return!1;var a=this.getLastProgramApplied(),n=a.getUniformsCache(),s=this._modelViewMatrix,o=n.uModelViewMatrix,h=this.getGraphicContext();o&&(s.setMatrix4(e),s.apply(h,o));var u;if(this._lastAppliedModelViewMatrix){for(var c=this._lastAppliedModelViewMatrix,l=0;l<11;l++)if(e[l]!==c[l]){u=!0;break}}else u=!0;return u&&(s=this._modelViewNormalMatrix,o=n.uModelViewNormalMatrix,o&&(i.b.normalFromMat4(t,e),s.setMatrix3(t),s.apply(h,o)),(o=n.uModelNormalMatrix)&&(i.b.normalFromMat4(t,r),s.setMatrix3(t),s.apply(h,o))),this._lastAppliedModelViewMatrix=e,!0}}(),applyProjectionMatrix:function(t){if(this._lastAppliedProjectionMatrix!==t){this._lastAppliedProjectionMatrix=t;var e=this.getLastProgramApplied(),r=this._projectionMatrix,i=e.getUniformsCache()[r.getName()];i&&(r.setMatrix4(t),r.apply(this.getGraphicContext(),i))}},getCurrentShaderGeneratorStateSet:function(t){var e=this._programAttribute,r=t._attributeArray[this._programType];if(!(0!==e._length&&e._back.value!==o.a.OFF||r&&r.getValue()!==o.a.OFF)){var i,a=t.getShaderGeneratorPair(),n=this._shaderGeneratorNames;if(a){var s=a.getValue(),h=a.getShaderGeneratorName();i=this._evaluateOverrideObjectOnStack(this._shaderGeneratorNames,h,s)}else n._length&&(i=n._back.object);var u=i;return this._shaderGeneratorProxy.getShaderGenerator(u)}},_applyAttributeMapStateSet:function(t,e){for(var r=t.length>e.length?t.length:e.length,i=0,a=r;i<a;i++){var n,s=i,o=s<t.length?t[s]:void 0,h=s<e.length?e[s]:void 0,u=!!o,c=u&&o._changed;if(h||c){var l=h?h.getAttribute():void 0;if(u)if(l){var d=h.getValue();n=this._evaluateOverrideObjectOnStack(o,l,d),n!==l?o._changed&&(this._applyAttributeStack(n,o),o._changed=!1):this._applyAttributeStack(n,o)&&(o._changed=!0)}else o._length?(o._changed=!1,this._applyAttributeStack(o._back.object,o)):(o._changed=!1,this._applyAttributeStack(o._globalDefault,o));else o=this._createAttributeStack(t,s,l.cloneType()),o._changed=!0,this._applyAttributeStack(l,o)}}},_applyTextureAttributeMapListStateSet:function(t,e){for(var r,i,a,n=0;n<16;n++){var s=n;r=s<t.length?t[s]:void 0;var o=s<e.length?e[s]:void 0;if(r||o){i=a=0,r?(a=r.length,o&&(i=o.length)):(r=this.getOrCreateTextureAttributeArray(s),i=o.length);for(var h=a>i?a:i,u=0;u<h;u++){var c,l=u,d=l<a?r[l]:void 0,_=o&&l<o.length?o[l]:void 0,f=!!d,g=f&&d._changed;if(_||g){var p=_?_.getAttribute():void 0;if(f)if(p){var m=_.getValue();c=this._evaluateOverrideObjectOnStack(d,p,m),c!==p?d._changed&&(this._applyTextureAttribute(s,c,d),d._changed=!1):this._applyTextureAttribute(s,c,d)&&(d._changed=!0)}else d._length?(d._changed=!1,this._applyTextureAttribute(s,d._back.object,d)):(d._changed=!1,this._applyTextureAttribute(s,d._globalDefault,d));else c=_.getAttribute(),d=this._createAttributeStack(r,l,c.cloneType()),d._changed=!0,this._applyTextureAttribute(s,c,d)}}}}},applyStateSet:function(t){this._numApply++;var e=this.getLastProgramApplied();this._currentShaderGenerator=this.getCurrentShaderGeneratorStateSet(t),this._applyAttributeMapStateSet(this._attributeArray,t._attributeArray),this._applyTextureAttributeMapListStateSet(this._textureAttributeArrayList,t._textureAttributeArrayList);var r;if(this._currentShaderGenerator){var i=this._currentShaderGenerator.getOrCreateProgram(this);this.applyAttribute(i),r=i,this._applyGeneratedProgramUniforms(i,t)}else r=this.getLastProgramApplied(),this._applyCustomProgramUniforms(r,t);e!==r&&(this._lastAppliedModelViewMatrix=void 0,this._lastAppliedProjectionMatrix=void 0)},popAllStateSets:function(){for(;this._stateSets._length;)this.popStateSet()},popStateSet:function(){if(this._stateSets._length){var t=this._stateSets.pop();this.popAttributeMap(this._attributeArray,t._attributeArray,t._activeAttribute);for(var e=t._textureAttributeArrayList,r=t._activeTextureAttributeUnit,i=t._activeTextureAttribute,a=0,n=r.length;a<n;a++){var s=r[a],o=e[s],h=this._textureAttributeArrayList[s];this.popAttributeMap(h,o,i)}t.hasUniform()&&this.popUniformsList(this._uniforms,t.getUniformList()),t.getShaderGeneratorPair()&&this._shaderGeneratorNames.pop()}},_createAttributeStack:function(t,e,r){l.a.arrayDense(e,t);var i=new u.a;return i._globalDefault=r,t[e]=i,i},haveAppliedAttribute:function(t){if(t){var e=this._attributeArray,r=l.a.getOrCreateStateAttributeTypeMemberIndex(t),i=r<e.length?e[r]:void 0;i||(i=this._createAttributeStack(e,r,t.cloneType())),i._lastApplied=t,i._changed=!0}},applyAttribute:function(t){var e=l.a.getOrCreateStateAttributeTypeMemberIndex(t),r=this._attributeArray,i=e<r.length?r[e]:void 0;i||(i=this._createAttributeStack(r,e,t.cloneType())),i._changed=!0,this._applyAttributeStack(t,i)},_applyAttributeStack:function(t,e){return e._lastApplied!==t&&(t.apply&&t.apply(this),e._lastApplied=t,!0)},_applyTextureAttribute:function(t,e,r){if(r._lastApplied===e)return!1;if(r._lastApplied=e,!e.apply)return!0;var i=this.getGraphicContext();return i.activeTexture(i.TEXTURE0+t),e.apply(this,t),!0},applyTextureAttribute:function(t,e){var r=l.a.getOrCreateTextureStateAttributeTypeMemberIndex(e),i=this.getOrCreateTextureAttributeArray(t),a=i[r];a||(a=this._createAttributeStack(i,r,e.cloneType())),a._changed=!0,this._applyTextureAttribute(t,e,a)},getLastProgramApplied:function(){return this._programAttribute._lastApplied},applyDefault:function(){this.popAllStateSets(),this._currentShaderGenerator=void 0,this.applyAttributeMap(this._attributeArray),this.applyTextureAttributeMapList(this._textureAttributeArrayList)},applyAttributeMap:function(t){for(var e,r=0,i=t.length;r<i;r++)if(e=t[r]){var a;a=e._length?e._back.object:e._globalDefault,e._changed&&(e._lastApplied!==a&&(a.apply&&a.apply(this),e._lastApplied=a),e._changed=!1)}},pushUniformsList:function(t,e){var r,i;for(var a in e){var n=e[a];i=n.getUniform(),r=i.getName(),t[r]||this._createAttributeStack(t,r,i),this.pushCheckOverride(t[r],i,n.getValue())}},popUniformsList:function(t,e){for(var r in e)t[r].pop()},applyTextureAttributeMapList:function(t){for(var e,r=this._graphicContext,i=0,a=t.length;i<a;i++)if(e=t[i])for(var n=0,s=e.length;n<s;n++){var o=e[n];if(o){var h;h=o._length?o._back.object:o._globalDefault,o._changed&&(o._lastApplied!==h&&(r.activeTexture(r.TEXTURE0+i),h.apply(this,i),o._lastApplied=h),o._changed=!1)}}},setGlobalDefaultAttribute:function(t){var e=l.a.getOrCreateStateAttributeTypeMemberIndex(t);e>=this._attributeArray.length||!this._attributeArray[e]?this._createAttributeStack(this._attributeArray,e,t):this._attributeArray[e]._globalDefault=t},getGlobalDefaultAttribute:function(t){var e=this._attributeArray,r=l.a.getIdFromTypeMember(t);if(!(void 0===r||r>=e.length))return e[r]?e[r]._globalDefault:void 0},setGlobalDefaultTextureAttribute:function(t,e){var r=this.getOrCreateTextureAttributeArray(t),i=l.a.getOrCreateTextureStateAttributeTypeMemberIndex(e);i>=r.length||!r[i]?this._createAttributeStack(r,i,e):r[i]._globalDefault=e},getGlobalDefaultTextureAttribute:function(t,e){var r=this.getOrCreateTextureAttributeArray(t),i=l.a.getTextureIdFromTypeMember(e);if(!(void 0===i||i>=r.length))return r[i]?r[i]._globalDefault:void 0},getOrCreateTextureAttributeArray:function(t){return l.a.arrayDense(t,this._textureAttributeArrayList),this._textureAttributeArrayList[t]||(this._textureAttributeArrayList[t]=[]),this._textureAttributeArrayList[t]},pushAttributeMap:function(t,e,r){for(var i,a=e.length,n=t.length,s=0,o=r.length;s<o;s++){var h=r[s],u=h<a?e[h]:void 0,c=u.getAttribute();i=h<n?t[h]:void 0,i||(i=this._createAttributeStack(t,h,c.cloneType())),this.pushCheckOverride(i,c,u.getValue()),i._changed=!0}},popAttributeMap:function(t,e,r){for(var i=0,a=r.length;i<a;i++){var n=r[i],s=t[n];s.pop(),s._changed=!0}},setIndexArray:function(t){var e=this._graphicContext;this._currentIndexVBO!==t&&(t.bind(e),this._currentIndexVBO=t),t.isDirty()&&t.compile(e)},lazyDisablingOfVertexAttributes:function(){for(var t=this._vertexAttribMap._keys,e=0,r=t.length;e<r;e++){var i=t[e];this._vertexAttribMap[i]&&(this._vertexAttribMap._disable[i]=!0)}},enableVertexColor:function(){var t=this._programAttribute._lastApplied;if(t.getUniformsCache().uArrayColorEnabled&&t.getAttributesCache().Color){var e=this._uniforms.ArrayColorEnabled._globalDefault;this._previousColorAttribPair[t.getInstanceID()]||(e.setFloat(1),e.apply(this.getGraphicContext(),t.getUniformsCache().uArrayColorEnabled),this._previousColorAttribPair[t.getInstanceID()]=!0)}},disableVertexColor:function(){var t=this._programAttribute._lastApplied;if(t.getUniformsCache().uArrayColorEnabled&&t.getAttributesCache().Color){var e=this._uniforms.ArrayColorEnabled._globalDefault;this._previousColorAttribPair[t.getInstanceID()]&&(e.setFloat(0),e.apply(this.getGraphicContext(),t.getUniformsCache().uArrayColorEnabled),this._previousColorAttribPair[t.getInstanceID()]=!1)}},applyDisablingOfVertexAttributes:function(){for(var t=this._vertexAttribMap._keys,e=0,r=t.length;e<r;e++)if(!0===this._vertexAttribMap._disable[t[e]]){var i=t[e];this._graphicContext.disableVertexAttribArray(i),this._vertexAttribMap._disable[i]=!1,this._vertexAttribMap[i]=!1}},clearVertexAttribCache:function(){for(var t=this._vertexAttribMap,e=t._keys,r=0,i=e.length;r<i;r++){var a=e[r];t[a]=void 0,t._disable[a]=!1}this._vertexAttribMap._disable.length=0,this._vertexAttribMap._keys.length=0},setVertexArrayObject:function(t){return this._currentVAO!==t&&(this._currentVAO=t,t?t.bind(this._graphicContext):(this._graphicContext.bindVertexArray(null),this.clearVertexAttribCache()),this._currentIndexVBO=void 0,!0)},setVertexAttribArray:function(t,e,r){var i=this._vertexAttribMap;i._disable[t]=!1;var a=this._graphicContext,n=!1;e.isDirty()&&(e.bind(a),e.compile(a),n=!0);var s=i[t];s!==e&&(n||e.bind(a),s||(a.enableVertexAttribArray(t),void 0===s&&i._keys.push(t)),i[t]=e,a.vertexAttribPointer(t,e.getItemSize(),e.getType(),r,0,0))},_getActiveUniformsFromProgramAttributes:function(t,e){var r=this._attributeArray,i=t.getTrackAttributes().attributeKeys;if(i.length>0)for(var a=0,n=i.length;a<n;a++){var s=i[a],o=this.typeMember[s],h=r[o];if(h){var u=h._globalDefault;if(u.getOrCreateUniforms){var c=u.getOrCreateUniforms();for(var l in c)e.push(c[l])}}}},_getActiveUniformsFromProgramTextureAttributes:function(t,e){var r=t.getTrackAttributes().textureAttributeKeys;if(r)for(var i=0,a=r.length;i<a;i++){var n=r[i];if(n){var s=this._textureAttributeArrayList[i];if(s)for(var o=0,h=n.length;o<h;o++){var u=n[o],c=s[u];if(c){var l=c._globalDefault;if(l.getOrCreateUniforms){var d=l.getOrCreateUniforms();for(var _ in d)e.push(d[_])}}}}}},_cacheUniformsForCustomProgram:function(t,e){this._getActiveUniformsFromProgramAttributes(t,e),this._getActiveUniformsFromProgramTextureAttributes(t,e);for(var r=this._graphicContext,i={},a=0,n=e.length;a<n;a++){var s=e[a],o=s.getName(),h=r.getUniformLocation(t._program,o);void 0!==h&&null!==h&&(i[o]=s)}t.trackUniforms=i},_applyCustomProgramUniforms:function(){var t=[];return function(e,r){t.length=0,void 0!==e.getTrackAttributes()&&void 0===e.trackUniforms&&this._cacheUniformsForCustomProgram(e,t);var i,a=e.getUniformsCache(),n=this._uniforms;e.trackUniforms&&(i=e.trackUniforms);var s;for(var o in a){var h=a[o],u=n[o],c=r&&r.uniforms[o];if(u||c)if(c){var l=r.uniforms[o],d=l.getValue(),_=l.getUniform();s=u?this._evaluateOverrideObjectOnStack(u,_,d):_}else s=u._length?u._back.object:u._globalDefault;else{if(void 0===i){this._checkErrorUniform(o);continue}s=i[o]}s.apply(this._graphicContext,h)}}}(),_checkErrorUniform:function(t){var e=t.substr(7);this._textureAttributeArrayList[e]&&t==="Texture"+e||this._excludeUniforms[t]||(this._excludeUniforms[t]=1,a.a.error("Uniform not in the scene hierarchy : "+t))},_computeForeignUniforms:function(t,e){var r=[];for(var i in t){void 0!==t[i]&&void 0===e[i]&&(this._excludeUniforms[i]||r.push(i))}return r},_removeUniformsNotRequiredByProgram:function(t,e){for(var r in t){var i=e[r];void 0!==i&&null!==i||delete t[r]}},_cacheUniformsForGeneratedProgram:function(t){var e=t.getUniformsCache(),r=t.getActiveUniforms(),i=this._computeForeignUniforms(e,r);t.setForeignUniforms(i),this._removeUniformsNotRequiredByProgram(r,e)},_copyUniformEntry:function(t){var e,r=t.getInternalArray();return r.length<16&&(e=new r.constructor(r.length)),e},_initUniformCache:function(t){var e,r,i,a,n,s,o=t.getActiveUniforms(),h=t.getForeignUniforms(),u=this._uniforms,c=[],l=[];if(t._cacheUniformId=this._cacheUniformId++,this._programUniformCache[t._cacheUniformId]={},h.length)for(i=c,e=0,r=h.length;e<r;e++){a=h[e];var d=u[a];d&&(s=d._globalDefault,n=this._copyUniformEntry(s),i.push(n))}for(var _ in o)s=o[_],n=this._copyUniformEntry(s),l.push(n);this._programUniformCache[t._cacheUniformId].foreign=c,this._programUniformCache[t._cacheUniformId].active=l},_checkCacheAndApplyUniform:function(t,e,r,i,a){var n,s=t.getInternalArray(),o=s.length;if(o<=4){var h=e[r];n=f[o](s,h)}else n=!1;if(!n){var u=i[a];t.apply(this._graphicContext,u)}},_applyGeneratedProgramUniforms:function(t,e){var r,i,a,n,s=this._uniforms,o=t.getForeignUniforms();if(!o){if(this._cacheUniformsForGeneratedProgram(t),o=t.getForeignUniforms(),e){var h=e.uniforms;for(n=0;n<o.length;n++)i=o[n],s[i]||h[i]&&(r=h[i].getUniform(),this._createAttributeStack(s,i,r))}this._initUniformCache(t)}var u=t.getUniformsCache(),c=t.getActiveUniforms(),l=this._programUniformCache[t._cacheUniformId].active,d=this._programUniformCache[t._cacheUniformId].foreign,_=0;for(var f in c)r=c[f],this._checkCacheAndApplyUniform(r,l,_,u,f),_++;_=0;var g=o.length;for(n=0;n<g;n++){i=o[n],a=s[i];var p=e&&e.uniforms[i];if(p||a){if(p){var m=e.uniforms[i],v=m.getValue(),S=m.getUniform();r=this._evaluateOverrideObjectOnStack(a,S,v)}else a._length?r=a._back.object:(r=a._globalDefault,this._checkErrorUniform(i));this._checkCacheAndApplyUniform(r,d,_,u,i),_++}else this._checkErrorUniform(i)}},_setStateSetsDrawID:function(t){for(var e=this._stateSets.getArray(),r=0,i=this._stateSets.length;r<i;r++)e[r].setDrawID(t)},_stateSetStackChanged:function(t,e){var r=this._stateSets.getArray(),i=this._stateSets.length;if(e!==i)return!0;for(var a=0;a<i;a++)if(t!==r[a].getDrawID())return!0;return!1}}),"osg","State"),e.a=g},function(t,e,r){"use strict";var i=r(0),a=r(3),n=function(){a.a.call(this),this.visitorType=a.a.UPDATE_VISITOR,this._numUpdateCallback=0};i.a.createPrototypeObject(n,i.a.objectInherit(a.a.prototype,{resetStats:function(){this._numUpdateCallback=0},apply:function(t){var e=t.getStateSet();if(e&&e.requiresUpdateTraversal()){var r=e.getUpdateCallbackList(),i=r.length;if(i){this._numUpdateCallback+=i;for(var a=0,n=i;a<n;a++)r[a].update(e,this)}}for(var s=t.getUpdateCallbackList(),o=s.length,h=0;h<o;h++)if(this._numUpdateCallback++,!s[h].update(t,this))return;t.getNumChildrenRequiringUpdateTraversal()>0&&this.traverse(t)}}),"osg","NodeVisitor"),e.a=n},function(t,e,r){"use strict";var i=r(2),a=r(28),n=function(t){this._enabled=!1,this.reset(t)};n.FRAME_COUNT=0,n.instance=function(t,e){return n._instance?t&&(n._instance.getContext()!==t||e)&&(n._instance.setContext(t),n._instance.reset(t)):n._instance=new n(t),n._instance},n.prototype={reset:function(t){if(t){var e=a.a.instance(t).getDisjointTimerQuery();if(!e)return this;if(t.getQueryParameter||(t.getQueryParameter=e.getQueryObjectEXT.bind(e)),this._hasTimeElapsed=t.getQuery(e.TIME_ELAPSED_EXT,e.QUERY_COUNTER_BITS_EXT)>=30,this._hasTimeStamp=t.getQuery(e.TIMESTAMP_EXT,e.QUERY_COUNTER_BITS_EXT)>=30,!this._hasTimeElapsed&&!this._hasTimeStamp)return this;this._hasTimeStamp||i.a.debug("Warning: do not use interleaved GPU query"),this._ext=e,this._gl=t,this._enabled=!0}this._frameAverageCount=10,this._glQueries=[],this._queriesByID={},this._userQueries=[],this._queryCount=0,this._nbOpened=0},getContext:function(){return this._gl},setContext:function(t){this._gl=t},setFrameAverageCount:function(t){this._frameAverageCount=t},clearQueries:function(){for(var t=this._glQueries,e=0,r=t.length;e<r;++e){var i=t[e];this._gl.deleteQuery(i._pollingStartQuery),i._pollingEndQuery&&this._gl.deleteQuery(i)}this._userQueries.length=0,this._glQueries.length=0,this._queriesByID={}},supportTimeStamp:function(){return this._hasTimeStamp},enable:function(){this._enabled=!!this._ext},disable:function(){this._enabled=!1},isEnabled:function(){return this._enabled},setCallback:function(t){this._callback=t},createUserQuery:function(t){var e;return e=this._hasTimeStamp?this.createGLQuery():{_startIndex:0,_endIndex:0},e._id=t,e._frame=n.FRAME_COUNT,e._isOpened=!0,e._siblings=[],e},createGLQuery:function(){var t={};return t._isWaiting=!1,t._pollingStartQuery=void 0,t._pollingEndQuery=void 0,t._averageTimer=0,t._resultCount=0,this._hasTimeStamp&&(t._pollingEndQuery=this._gl.createQuery()),t._pollingStartQuery=this._gl.createQuery(),this._glQueries.push(t),t},getOrCreateLastGLQuery:function(){var t=this._glQueries[this._queryCount-1];return t||(t=this._glQueries[this._queryCount-1]=this.createGLQuery())},beginCurrentQuery:function(){if(0!==this._nbOpened){this._queryCount++;var t=this.getOrCreateLastGLQuery();t._isWaiting||this._gl.beginQuery(this._ext.TIME_ELAPSED_EXT,t._pollingStartQuery)}},endCurrentQuery:function(){0!==this._nbOpened&&(this.getOrCreateLastGLQuery()._isWaiting||this._gl.endQuery(this._ext.TIME_ELAPSED_EXT))},getAvailableQueryByID:function(t){var e=this._queriesByID[t];if(!e)return e=this._queriesByID[t]=this.createUserQuery(t),this._userQueries.push(e),e;if(e._frame===n.FRAME_COUNT){if(e._isOpened)return e;for(var r=e._siblings,i=0,a=r.length;i<a;++i){var s=r[i];if(s._frame!==n.FRAME_COUNT||s._isOpened)return s._frame=n.FRAME_COUNT,s}var o=this.createUserQuery();return r.push(o),o}return e._frame=n.FRAME_COUNT,e},start:function(t){if(this._enabled){var e=this.getAvailableQueryByID(t);e._isOpened=!0,this._hasTimeStamp?e._isWaiting||this._ext.queryCounterEXT(e._pollingStartQuery,this._ext.TIMESTAMP_EXT):(this.endCurrentQuery(),this._nbOpened++,e._startIndex=this._queryCount,this.beginCurrentQuery())}},end:function(t){if(this._enabled){var e=this.getAvailableQueryByID(t);e._isOpened=!1,this._hasTimeStamp?e._isWaiting||this._ext.queryCounterEXT(e._pollingEndQuery,this._ext.TIMESTAMP_EXT):(this.endCurrentQuery(),e._endIndex=this._queryCount,this._nbOpened--,this.beginCurrentQuery())}},computeQueryAverageTime:function(t){for(var e=0,r=this._glQueries,i=t._startIndex;i<t._endIndex;++i){var a=r[i]._averageTimer;if(a<0)return-1;e+=a}return e},computeFullAverageTime:function(t){var e=this.computeQueryAverageTime(t);if(e<0)return-1;for(var r=t._siblings,i=0,a=r.length;i<a;++i){var s=r[i];if(s._frame===n.FRAME_COUNT-1){var o=this.computeQueryAverageTime(s);if(o<0)return-1;e+=o}}return e},pollQueries:function(){if(n.FRAME_COUNT++,this._queryCount=0,this._nbOpened=0,this._enabled&&this._callback){var t,e=this._glQueries,r=e.length;if(this._gl.getParameter(this._ext.GPU_DISJOINT_EXT))for(t=0;t<r;++t)e[t]._isWaiting=!1;else{for(t=0;t<r;++t)this.pollQuery(e[t]);var i=this._userQueries,a=i.length;for(t=0;t<a;++t){var s=i[t],o=this.computeFullAverageTime(s);o>0&&this._callback(o,s._id)}}}},pollQuery:function(t){t._isWaiting=!1;var e=this._hasTimeStamp?t._pollingEndQuery:t._pollingStartQuery;if(!this._gl.getQueryParameter(e,this._gl.QUERY_RESULT_AVAILABLE))return t._isWaiting=!0,0;var r;if(this._hasTimeStamp){var i=this._gl.getQueryParameter(t._pollingStartQuery,this._gl.QUERY_RESULT);r=this._gl.getQueryParameter(e,this._gl.QUERY_RESULT)-i}else r=this._gl.getQueryParameter(e,this._gl.QUERY_RESULT);return t._resultCount++,t._resultCount>this._frameAverageCount&&(t._averageTimer=0,t._resultCount=1),t._averageTimer=t._averageTimer+(r-t._averageTimer)/t._resultCount,t._averageTimer}},e.a=n},function(t,e,r){"use strict";e.a={Vec3:0,Quat:1,Float:2,FloatCubicBezier:3,Vec3CubicBezier:4,QuatSlerp:5,Matrix:6,Count:7}},function(t,e,r){"use strict";var i=r(2),a=r(0),n=r(5),s=r(1),o=r(46),h=r(69),u=r(127),c=r(128),l=r(36),d=r(70),_=r(67),f=r(52),g={lerp:function(t,e,r){return t+(e-t)*r},init:function(){return 0},copy:function(t,e){return e},create:function(){return 0}},p=[];p[o.a.ChannelType.Float]=1,p[o.a.ChannelType.FloatCubicBezier]=1,p[o.a.ChannelType.Vec3]=3,p[o.a.ChannelType.Vec3CubicBezier]=3,p[o.a.ChannelType.Quat]=4,p[o.a.ChannelType.QuatSlerp]=4,p[o.a.ChannelType.Matrix]=16;var m=[];m.length=o.a.ChannelType.Count,m[o.a.ChannelType.Vec3]=s.f,m[o.a.ChannelType.Quat]=s.d,m[o.a.ChannelType.QuatSlerp]=s.d,m[o.a.ChannelType.Float]=g,m[o.a.ChannelType.FloatCubicBezier]=g,m[o.a.ChannelType.Vec3CubicBezier]=s.f,m[o.a.ChannelType.Matrix]=s.c;var v=function(){n.a.call(this),this._simulationTime=0,this._pauseTime=0,this._timeFactor=1,this._startTime=0,this._instanceAnimations={},this._startAnimations={},this._targets=[],this._targetsMap={},this._targetsByTypes=[],this._targetsByTypes.length=o.a.ChannelType.Count;for(var t=0,e=this._targetsByTypes.length;t<e;t++)this._targetsByTypes[t]=[];this._activeAnimations={},this._activeAnimationList=[],this._activeChannelsByTypes=[],this._activeChannelsByTypes.length=o.a.ChannelType.Count;for(var r=0,i=this._activeChannelsByTypes.length;r<i;r++)this._activeChannelsByTypes[r]=[];this._animationsUpdateCallback={},this._animationsUpdateCallbackArray=[],this._animationsToRegister=[],this._pause=!1,this._dirty=!1,this._seekTime=-1};a.a.createPrototypeObject(v,a.a.objectInherit(n.a.prototype,{init:function(t){this._simulationTime=0,this._pauseTime=0,this._timeFactor=1,this._startTime=0,this._instanceAnimations={},this._startAnimations={},this._resetTargets(),this._activeAnimations={},this._activeAnimationList.length=0;for(var e=0,r=this._activeChannelsByTypes.length;e<r;e++)this._activeChannelsByTypes[e].length=0;this._animationsUpdateCallback={},this._animationsUpdateCallbackArray.length=0,this._pause=!1,this._seekTime=-1,this.addAnimations(t)},addAnimations:function(t){var e=this._addAnimation(t);Array.prototype.push.apply(this._animationsToRegister,e),this._dirty=!0,this._registerAnimations()},update:function(t,e){this._dirty&&(this._findAnimationUpdateCallback(t),this._registerTargetFoundInAnimationCallback(),this._registerAnimations());var r=e.getFrameStamp().getSimulationTime();return-1!==this._seekTime&&(this._pauseTime=-this._seekTime+this._startTime+r),this._seekTime=-1,this._pause?this._pauseTime=r-this._simulationTime+this._startTime:this._simulationTime=this._startTime+(r-this._pauseTime),this.updateManager(this._simulationTime*this._timeFactor),!0},updateManager:function(t){this._processStartAnimation(t);for(var e=o.a.ChannelType.Count,r=0;r<e;r++){var i=this._activeChannelsByTypes[r];this._updateChannelsType(t,i,u.a[r])}for(var a=0;a<e;a++){var n=this._targetsByTypes[a];this._updateTargetType(n,m[a])}for(var s=0,h=this._animationsUpdateCallbackArray.length;s<h;s++){this._animationsUpdateCallbackArray[s].computeChannels()}this._removeFinishedAnimation(t)},togglePause:function(){this._pause=!this._pause,this._pause||(this._seekTime=this._simulationTime)},getSimulationTime:function(){return this._simulationTime},setSimulationTime:function(t){this._simulationTime=t},setSeekTime:function(t){this._simulationTime=t,this._seekTime=t},stopAnimation:function(t){for(var e=this._activeAnimationList,r=0,i=e.length;r<i;++r)if(e[r].name===t)return this._removeActiveChannels(this._instanceAnimations[t]),this._activeAnimations[t]=void 0,void e.splice(r,1)},stopAllAnimation:function(){for(var t=this._activeAnimationList,e=0,r=t.length;e<r;++e){var i=t[e].name;this._removeActiveChannels(this._instanceAnimations[i]),this._activeAnimations[i]=void 0}t.length=0},setTimeFactor:function(t){var e=t/this._timeFactor;this._startTime+=(this._simulationTime-this._simulationTime*e)/e,this._timeFactor=t,this._pause&&(this._simulationTime+=(this._simulationTime-this._simulationTime*e)/e)},getTimeFactor:function(){return this._timeFactor},isPlaying:function(t){return!!this._activeAnimations[t]},playAnimationObject:function(t){var e=this._instanceAnimations[t.name];if(!e)return void i.a.info("no animation "+t.name+" found");this.isPlaying(t.name)||(e.priority=void 0===t.priority?0:t.priority,e.weight=void 0===t.weight?1:t.weight,e.loop=void 0===t.loop||t.loop,this._startAnimations[e.name]=e)},playAnimation:function(t,e,r,i){var a;return a="object"==typeof t?t:{name:t,priority:r,weight:i,loop:e},this.playAnimationObject(a)},getAnimations:function(){return this._instanceAnimations},_registerAnimations:function(){if(this._targets.length){for(var t=0,e=this._animationsToRegister.length;t<e;t++){var r=this._animationsToRegister[t];this._registerInstanceAnimation(r)}this._animationsToRegister.length=0,this._dirty=!1}},_registerInstanceAnimation:function(t){for(var e=t.channels,r=0,a=e.length;r<a;r++){var n=e[r],s=n.channel.target,o=n.channel.name,h=s+"."+o;this._targetMap[h]?n.targetID=this._targetMap[h].id:i.a.warn("registerInstanceAnimation did not find targetName ("+h+") in the scene graph")}return!0},_findAnimationUpdateCallback:function(t){var e=new c.a;t.accept(e),this._animationsUpdateCallback=e.getAnimationUpdateCallbackMap()},_registerTargetFoundInAnimationCallback:function(){this._resetTargets();var t,e,r,a=0,n=this._targetMap,s=this._targets,o=function(t,e){if(n[t])e!==n[t]&&i.a.warn("detected differents target instance with the same name ("+t+")");else{n[t]=e,e.id=a++,s.push(e);var r=e.type;this._targetsByTypes[r].push(e)}}.bind(this);for(var h in this._animationsUpdateCallback){var u=this._animationsUpdateCallback[h];if(u instanceof f.a||u instanceof _.a){var c=u.getStackedTransforms(),l=c.length;if(!l)continue;this._animationsUpdateCallbackArray.push(u);for(var g=0;g<l;g++){var p=c[g];t=p.getTarget(),e=p.getName(),r=u.getName()+"."+e,o(r,t,e)}}else if(u instanceof d.a){var m=u.getNumTarget();if(!m)continue;this._animationsUpdateCallbackArray.push(u);for(var v=0;v<m;v++)e=u.getTargetName(v),r=e+"."+v,t=u.getTarget(v),o(r,t,e)}}},_addAnimation:function(t){for(var e=[],r=0,i=t.length;r<i;r++){var a=t[r],n=a.name;if(!this._instanceAnimations[n]){var s=h.a.createInstanceAnimation(a);this._instanceAnimations[n]=s,e.push(s)}}return e},_addActiveChannels:function(t,e){for(var r=e.channels,i=0,a=r.length;i<a;i++){var n=r[i],s=n.channel.type;n.t=t,n.instanceAnimation=e;var o=n.targetID;o!==l.a.InvalidTargetID&&(this._activeChannelsByTypes[s].push(n),this._targets[o].channels.push(n))}},_removeActiveChannels:function(t){for(var e=t.channels,r=0,i=e.length;r<i;r++){var a=e[r],n=a.channel.type,s=a.targetID;if(s!==l.a.InvalidTargetID){var o=this._targets[s].channels,h=o.indexOf(a);o.splice(h,1);var u=this._activeChannelsByTypes[n],c=u.indexOf(a);u.splice(c,1)}}},_updateTargetType:function(t,e){for(var r=0,i=t.length;r<i;r++){var a=t[r],n=a.channels,s=n.length;if(0===s)a.value=e.copy(a.value,a.defaultValue);else if(1===s)a.value=e.copy(a.value,n[0].value);else{a.value=e.init(a.value);for(var o=0,h=0,u=n.length;h<u;h++){var c=n[h],l=c.weight;if(0!==(o+=l)&&0!==l){var d=l/o;a.value=e.lerp(a.value,a.value,c.value,d)}}}}},_updateChannelsType:function(t,e,r){for(var i=0,a=e.length;i<a;i++){var n=e[i],s=n.instanceAnimation,o=s.loop,h=t-n.t;o&&s.duration>0&&(h%=s.duration),r(h+s.firstKeyTime,n)}},_removeFinishedAnimation:function(t){for(var e=this._activeAnimationList,r=0;r<e.length;){var i=e[r],a=i.name;t>i.end&&!1===i.loop?(this._removeActiveChannels(i),this._activeAnimations[a]=void 0,e.splice(r,1)):r++}},_addActiveAnimation:function(t,e){this._activeAnimations[e.name]=e;var r=this._instanceAnimations[e.name];r.start=t,r.end=t+r.duration,this._addActiveChannels(t,r),this._activeAnimationList.push(r)},_processStartAnimation:function(t){if(this._targets.length){var e;for(e in this._startAnimations){var r=this._startAnimations[e],i=r.name;this.isPlaying(i)||this._addActiveAnimation(t,r)}void 0!==e&&(this._startAnimations={})}},_resetTargets:function(){this._targetMap={},this._targets.length=0;for(var t=0,e=this._targetsByTypes.length;t<e;t++)this._targetsByTypes[t].length=0},resetUpdateCallbacks:function(){for(var t=this._animationsUpdateCallbackArray,e=0,r=t.length;e<r;e++)t[e].reset()},resetAllStackedTransforms:function(){i.a.warn("Uses resetUpdateCallback instead"),this.resetUpdateCallbacks()},setAnimationLerpEndStart:function(t,e){var r=t.channels;void 0===t.originalDuration&&(t.originalDuration=t.duration),t.duration=t.originalDuration+e;for(var i=t.firstKeyTime,a=t.originalDuration,n=0,s=r.length;n<s;++n){var o=r[n].channel;if(!(Math.abs(o.start-i)>.01||Math.abs(o.duration-a)>.01)){void 0===o.originalEnd&&(o.originalEnd=o.end),o.end=o.originalEnd+e;var h=p[o.type],u=o.times.buffer.byteLength/4;if(0===e)o.keys=new Float32Array(o.keys.buffer,0,(u-1)*h),o.times=new Float32Array(o.times.buffer,0,u-1);else{o.keys=new Float32Array(o.keys.buffer,0,u*h);for(var c=(u-1)*h,l=0;l<h;++l)o.keys[c+l]=o.keys[l];o.times=new Float32Array(o.times.buffer,0,u),o.times[u-1]=o.times[u-2]+e}}}}}),"osgAnimation","BasicAnimationManager"),v.TypeToSize=p,e.a=v},function(t,e,r){"use strict";var i=r(1),a=r(46),n=function(t,e,r){r[0]=e[t++],r[1]=e[t++],r[2]=e[t++]},s=function(t,e,r){r[0]=e[t++],r[1]=e[t++],r[2]=e[t++],r[3]=e[t++]},o=function(t,e){var r=e.channel,i=e.value,a=r.keys,s=r.times;if(t>=s[s.length-1])return e.key=0,void n(a.length-3,a,i);if(t<=s[0])return e.key=0,void n(0,a,i);var o=e.key;if(t>s[o])for(;s[o+1]<t;)o++;else if(t<s[o])for(;s[o]>t;)o--;var h=s[o],u=s[o+1],c=3*o,l=a[c++],d=a[c++],_=a[c++],f=a[c++],g=a[c++],p=a[c++],m=(t-h)/(u-h);i[0]=l+(f-l)*m,i[1]=d+(g-d)*m,i[2]=_+(p-_)*m,e.key=o},h=function(){var t=i.d.create32(),e=i.d.create32();return function(r,a){var n=a.channel,o=a.value,h=n.keys,u=n.times;if(r>=u[u.length-1])return a.key=0,void s(h.length-4,h,o);if(r<=u[0])return a.key=0,void s(0,h,o);var c=a.key;if(r>u[c])for(;u[c+1]<r;)c++;else if(r<u[c])for(;u[c]>r;)c--;var l=u[c],d=u[c+1],_=4*c;t[0]=h[_++],t[1]=h[_++],t[2]=h[_++],t[3]=h[_++],e[0]=h[_++],e[1]=h[_++],e[2]=h[_++],e[3]=h[_++];var f=(r-l)/(d-l);i.d.nlerp(o,t,e,f),a.key=c}}(),u=function(){var t=i.d.create32(),e=i.d.create32();return function(r,a){var n=a.channel,o=a.value,h=n.keys,u=n.times;if(r>=u[u.length-1])return a.key=0,void s(h.length-4,h,o);if(r<=u[0])return a.key=0,void s(0,h,o);var c=a.key;if(r>u[c])for(;u[c+1]<r;)c++;else if(r<u[c])for(;u[c]>r;)c--;var l=u[c],d=u[c+1],_=4*c;t[0]=h[_++],t[1]=h[_++],t[2]=h[_++],t[3]=h[_++],e[0]=h[_++],e[1]=h[_++],e[2]=h[_++],e[3]=h[_++];var f=(r-l)/(d-l);i.d.slerp(o,t,e,f),a.key=c}}(),c=function(t,e){var r=e.channel,i=e.value,a=r.keys,n=r.times;if(t>=n[n.length-1])return e.key=0,void(e.value=a[a.length-1]);if(t<=n[0])return e.key=0,void(e.value=a[0]);var s=e.key;if(t>n[s])for(;n[s+1]<t;)s++;else if(t<n[s])for(;n[s]>t;)s--;var o=n[s],h=n[s+1],u=s,c=a[u++];i=c+(a[u++]-c)*((t-o)/(h-o)),e.key=s,e.value=i},l=function(t,e){var r=e.channel,i=e.value,a=r.keys,n=r.times;if(t>=n[n.length-1])return e.key=0,void(e.value=a[a.length-3]);if(t<=n[0])return e.key=0,void(e.value=a[0]);var s=e.key;if(t>n[s])for(;n[s+1]<t;)s++;else if(t<n[s])for(;n[s]>t;)s--;var o=(t-n[s])/(n[s+1]-n[s]),h=1-o,u=h*h,c=u*h,l=o*o,d=3*s;i=a[d]*c+a[d+1]*(3*o*u)+a[d+2]*(3*l*h)+a[d+3]*(l*o),e.key=s,e.value=i},d=function(){var t=i.f.create(),e=i.f.create(),r=i.f.create(),a=i.f.create();return function(s,o){var h=o.channel,u=o.value,c=h.keys,l=h.times;if(s>=l[l.length-1])return o.key=0,void n(c.length-9,c,u);if(s<=l[0])return o.key=0,void n(0,c,u);var d=o.key;if(s>l[d])for(;l[d+1]<s;)d++;else if(s<l[d])for(;l[d]>s;)d--;var _=(s-l[d])/(l[d+1]-l[d]),f=1-_,g=f*f,p=g*f,m=_*_,v=9*d;i.f.scale(t,i.f.set(t,c[v++],c[v++],c[v++]),p),i.f.scale(e,i.f.set(e,c[v++],c[v++],c[v++]),3*_*g),i.f.scale(r,i.f.set(r,c[v++],c[v++],c[v++]),3*m*f),i.f.scale(a,i.f.set(a,c[v++],c[v++],c[v++]),m*_),u[0]=t[0]+e[0]+r[0]+a[0],u[1]=t[1]+e[1]+r[1]+a[1],u[2]=t[2]+e[2]+r[2]+a[2],o.key=d}}(),_=a.a.ChannelType,f={};f[_.Vec3]=o,f[_.Quat]=h,f[_.QuatSlerp]=u,f[_.Float]=c,f[_.FloatCubicBezier]=l,f[_.Vec3CubicBezier]=d,f.Vec3LerpInterpolator=o,f.QuatLerpInterpolator=h,f.QuatSlerpInterpolator=u,f.FloatLerpInterpolator=c,f.FloatCubicBezierInterpolator=l,f.Vec3CubicBezierInterpolator=d,e.a=f},function(t,e,r){"use strict";var i=r(0),a=r(3),n=r(53),s=function(){a.a.call(this),this._animationUpdateCallback={}};i.a.createPrototypeObject(s,i.a.objectInherit(a.a.prototype,{getAnimationUpdateCallbackMap:function(){return this._animationUpdateCallback},apply:function(t){for(var e=t.getUpdateCallbackList(),r=0,i=e.length;r<i;r++){var a=e[r];a instanceof n.a&&(this._animationUpdateCallback[a.getInstanceID()]=a)}this.traverse(t)}}),"osgAnimation","CollectAnimationUpdateCallbackVisitor"),e.a=s},function(t,e,r){"use strict";var i=r(0),a=r(5),n=r(1),s=r(36),o=function(t,e){a.a.call(this),this._target=s.a.createMatrixTarget(e||n.c.IDENTITY),t&&this.setName(t)};i.a.createPrototypeObject(o,i.a.objectInherit(a.a.prototype,{init:function(t){this.setMatrix(t),n.c.copy(this._target.defaultValue,t)},getTarget:function(){return this._target},getMatrix:function(){return this._target.value},setMatrix:function(t){n.c.copy(this._target.value,t)},resetToDefaultValue:function(){this.setMatrix(this._target.defaultValue)},applyToMatrix:function(t){n.c.mul(t,t,this._target.value)}}),"osgAnimation","StackedMatrix"),e.a=o},function(t,e,r){"use strict";var i=r(0),a=r(5),n=r(1),s=r(36),o=n.d.create(),h=function(t,e){a.a.call(this),this._target=s.a.createQuatTarget(e||o),t&&this.setName(t)};i.a.createPrototypeObject(h,i.a.objectInherit(a.a.prototype,{init:function(t){this.setQuaternion(t),n.d.copy(this._target.defaultValue,t)},setQuaternion:function(t){n.d.copy(this._target.value,t)},getTarget:function(){return this._target},resetToDefaultValue:function(){this.setQuaternion(this._target.defaultValue)},applyToMatrix:function(){var t=n.c.create();return function(e){var r=t;n.c.fromQuat(r,this._target.value),n.c.mul(e,e,r)}}()}),"osgAnimation","StackedQuaternion"),e.a=h},function(t,e,r){"use strict";var i=r(0),a=r(5),n=r(1),s=r(36),o=function(t,e){a.a.call(this),this._target=s.a.createVec3Target(e||n.f.ZERO),t&&this.setName(t)};i.a.createPrototypeObject(o,i.a.objectInherit(a.a.prototype,{init:function(t){this.setTranslate(t),n.f.copy(this._target.defaultValue,t)},setTranslate:function(t){n.f.copy(this._target.value,t)},getTarget:function(){return this._target},resetToDefaultValue:function(){this.setTranslate(this._target.defaultValue)},applyToMatrix:function(t){n.c.translate(t,t,this._target.value)}}),"osgAnimation","StackedTranslate"),e.a=o},function(t,e,r){"use strict";var i=r(14),a=r.n(i),n=function(t,e){return new a.a(function(r,i){var a=new XMLHttpRequest;a.open("GET",t,!0);var n=e&&e.responseType?e.responseType.toLowerCase():void 0;n&&(a.responseType=n),e&&e.progress&&a.addEventListener("progress",e.progress,!1),a.addEventListener("error",i,!1),a.addEventListener("load",function(){r("arraybuffer"===a.responseType||"blob"===a.responseType?a.response:a.responseText)}),a.send(null)})},s=function(t,e){return new a.a(function(r){var i=e&&e.responseType?e.responseType.toLowerCase():void 0,a=new window.FileReader;a.onload=function(t){r(t.target.result)},i?"arraybuffer"===i?a.readAsArrayBuffer(t):"blob"===i?r(t):"string"===i?a.readAsText(t):a.readAsDataURL(t):a.readAsText(t)})},o=function(t,e){return"string"==typeof t?n(t,e):s(t,e)};e.a=o},function(t,e,r){"use strict";var i=r(2),a=function(t){var e=new Uint8Array(t);return 31===e[0]&&139===e[1]},n=function(t){var e=new Uint8Array(t),a=r(134);return a||i.a.error("osg failed to use a gunzip.min.js to uncompress a gz file.\n You can add this vendors to enable this feature or get it at https://github.com/imaya/zlib.js/blob/master/bin/gunzip.min.js"),new a.Gunzip(e).decompress().buffer};e.a={isGunzipBuffer:a,gunzip:n}},function(t,r){t.exports=e},function(t,e,r){"use strict";var i=r(14),a=r.n(i),n=r(0),s=r(3),o=r(86),h=r(22),u=function(){s.a.call(this,s.a.TRAVERSE_ALL_CHILDREN),this._activePagedLODList=void 0,this._frameNumber=0};n.a.createPrototypeObject(u,n.a.objectInherit(s.a.prototype,{apply:function(t){t.getTypeID()===o.a.getTypeID()&&(t.setFrameNumberOfLastTraversal(this._frameNumber),this._activePagedLODList.add(t)),this.traverse(t)},set:function(t,e){this._activePagedLODList=t,this._frameNumber=e}}),"osgDB","FindPagedLODsVisitor");var c=function(){s.a.call(this,s.a.TRAVERSE_ALL_CHILDREN)};n.a.createPrototypeObject(c,n.a.objectInherit(s.a.prototype,{apply:function(t){t.releaseGLObjects(),this.traverse(t)}}),"osgDB","ReleaseVisitor");var l=function(){s.a.call(this,s.a.TRAVERSE_ALL_CHILDREN),this._childrenList=[]};n.a.createPrototypeObject(l,n.a.objectInherit(s.a.prototype,{apply:function(t){t.getTypeID()===o.a.getTypeID()&&(this._childrenList.push(t),this._markRequestsExpired(t)),this.traverse(t)},removeExpiredChildrenAndFindPagedLODs:function(t,e,r,i){if(!t.children.length)return!1;var a=i.length;t.removeExpiredChildren(e,r,i);for(var n=a;n<i.length;n++)i[n].accept(this);return a!==i.length},_markRequestsExpired:function(t){for(var e,r=t._perRangeDataList.length,i=0;i<r;i++)void 0!==(e=t.getDatabaseRequest(i))&&(e._groupExpired=!0,e._loadedModel=null)},reset:function(){this._childrenList.length=0}}),"osgDB","ExpiredPagedLODVisitor");var d=function(t,e){return e._timeStamp-t._timeStamp},_=function(t,e){var r=t._timeStamp-e._timeStamp;return 0===r&&(r=t._priority-e._priority),r},f=function(){this._pendingRequests=[],this._pendingNodes=[],this._loading=!1,this._progressCallback=void 0,this._lastCB=!0,this._activePagedLODList=new Set,this._childrenToRemoveList=new Set,this._downloadingRequestsNumber=0,this._maxRequestsPerFrame=10,this._acceptNewRequests=!0,this._releaseVisitor=new c,this._expiredPagedLODVisitor=new l,this._findPagedLODsVisitor=new u,this._targetMaximumNumberOfPagedLOD=75,this._elapsedTime=0,this._beginTime=0,this._availableTime=0},g=function(){this._loadedModel=void 0,this._group=void 0,this._url=void 0,this._function=void 0,this._timeStamp=0,this._groupExpired=!1,this._priority=0};n.a.createPrototypeObject(f,{setTargetMaximumNumberOfPageLOD:function(t){this._targetMaximumNumberOfPagedLOD=t},getTargetMaximumNumberOfPageLOD:function(){return this._targetMaximumNumberOfPagedLOD},setAcceptNewDatabaseRequests:function(t){this._acceptNewRequests=t},getAcceptNewDatabaseRequests:function(){return this._acceptNewRequests},reset:function(){this._pendingRequests=[],this._pendingNodes=[],this._loading=!1,this._lastCB=!0,this._activePagedLODList.clear(),this._childrenToRemoveList.clear(),this._downloadingRequestsNumber=0,this._maxRequestsPerFrame=10,this._acceptNewRequests=!0,this._targetMaximumNumberOfPagedLOD=75},updateSceneGraph:function(t){void 0!==this._progressCallback&&this.executeProgressCallback(),this.removeExpiredSubgraphs(t,.0025),this.takeRequests(),this.addLoadedDataToSceneGraph(t,.005)},executeProgressCallback:function(){this._pendingRequests.length>0||this._pendingNodes.length>0?(this._progressCallback(this._pendingRequests.length+this._downloadingRequestsNumber,this._pendingNodes.length),this._lastCB=!1):this._lastCB||(this._progressCallback(this._pendingRequests.length+this._downloadingRequestsNumber,this._pendingNodes.length),this._lastCB=!0)},setMaxRequestsPerFrame:function(t){this._maxRequestsPerFrame=t},getMaxRequestsPerFrame:function(){return this._maxRequestsPerFrame},getRequestListSize:function(){return this._pendingRequests.length+this._downloadingRequestsNumber},setProgressCallback:function(t){this._progressCallback=t},addLoadedDataToSceneGraph:function(t,e){if(!this._pendingNodes.length||e<=0)return 0;var r=0,i=h.a.instance().tick();this._pendingNodes.sort(d);for(var a=0;a<this._pendingNodes.length;a++){if(r>e)return 0;var n=this._pendingNodes.shift(),s=t.getFrameNumber(),o=t.getSimulationTime();if(!1===n._groupExpired){var u=n._group;u.setTimeStamp(u.children.length,o),u.setFrameNumber(u.children.length,s),u.addChildNode(n._loadedModel),this._activePagedLODList.has(u)?this.registerPagedLODs(n._loadedModel,s):this.registerPagedLODs(u,s)}else n._loadedModel=void 0,n=void 0;r=h.a.instance().deltaS(i,h.a.instance().tick())}return e-=r},isLoading:function(){return this._loading},registerPagedLODs:function(t,e){t&&(this._findPagedLODsVisitor.set(this._activePagedLODList,e),t.accept(this._findPagedLODsVisitor))},requestNodeFile:function(t,e,r,i,a){if(this._acceptNewRequests){var n=new g;return n._group=r,n._function=t,n._url=e,n._timeStamp=i,n._priority=a,this._pendingRequests.push(n),n}},takeRequests:function(){if(this._pendingRequests.length){var t=Math.min(this._maxRequestsPerFrame,this._pendingRequests.length);this._pendingRequests.sort(_);for(var e=0;e<t;e++)this._downloadingRequestsNumber++,this.processRequest(this._pendingRequests.shift())}},processRequest:function(t){this._loading=!0;var e=this;if(t._groupExpired)return e._downloadingRequestsNumber--,void(this._loading=!1);void 0!==t._function?this.loadNodeFromFunction(t._function,t._group).then(function(r){e._downloadingRequestsNumber--,t._loadedModel=r,e._pendingNodes.push(t),e._loading=!1}):""!==t._url&&this.loadNodeFromURL(t._url).then(function(r){e._downloadingRequestsNumber--,t._loadedModel=r,e._pendingNodes.push(t),e._loading=!1})},loadNodeFromFunction:function(t,e){var r=t(e);return r?r&&r.then?r:a.a.resolve(r):a.a.reject()},loadNodeFromURL:function(t){return r(38).default.readNodeURL(t)},releaseGLExpiredSubgraphs:function(t){return this._availableTime=t,!this._childrenToRemoveList.size||t<=0?0:(this._elapsedTime=0,this._beginTime=h.a.instance().tick(),this._childrenToRemoveList.forEach(this._releaseExpiredSubgraphs,this),this._availableTime-=this._elapsedTime,this._availableTime)},_releaseExpiredSubgraphs:function(t){this._elapsedTime>this._availableTime||(this._childrenToRemoveList.delete(t),t.accept(this._releaseVisitor),t.removeChildren(),t=null,this._elapsedTime=h.a.instance().deltaS(this._beginTime,h.a.instance().tick()))},removeExpiredSubgraphs:function(t,e){if(0===t.getFrameNumber())return 0;var r=this._activePagedLODList.size-this._targetMaximumNumberOfPagedLOD,i=t.getSimulationTime()-.1,a=t.getFrameNumber()-1;return r>0&&(e=this.removeExpiredChildren(r,i,a,e)),e},removeExpiredChildren:function(t,e,r,i){var a=0,n=h.a.instance().tick(),s=this,o=[],u=this._expiredPagedLODVisitor;return u.reset(),this._activePagedLODList.forEach(function(c){if(a>i)return 0;if(t<0)return i;if(r<c.getFrameNumberOfLastTraversal())return i;u.removeExpiredChildrenAndFindPagedLODs(c,e,r,o);for(var l=0;l<u._childrenList.length;l++)s._activePagedLODList.delete(u._childrenList[l]),t--;for(l=0;l<o.length;l++)s._childrenToRemoveList.add(o[l]);u._childrenList.length=0,o.length=0,a=h.a.instance().deltaS(n,h.a.instance().tick())}),i-=a}},"osgDB","DatabasePager"),e.a=f},function(t,e,r){"use strict";var i=r(14),a=r.n(i),n=r(0),s=r(2),o=r(72),h=r(46),u=r(69),c=r(38),l=r(129),d=r(89),_=r(34),f=r(11),g=n.a.rejectObject,p={},m=function(){},v=c.default.registry();v.registerObject("osgAnimation.Vec3LerpChannel",m),v.registerObject("osgAnimation.FloatLerpChannel",m),v.registerObject("osgAnimation.QuatSlerpChannel",m),v.registerObject("osgAnimation.QuatLerpChannel",m),v.registerObject("osgAnimation.FloatCubicBezierChannel",m),v.registerObject("osgAnimation.Vec3CubicBezierChannel",m),v.registerObject("osgAnimation.StackedMatrixElement",l.a),v.registerObject("osgAnimation.StackedScaleElement",d.a),p.Animation=function(t){var e=t.getJSON();if(void 0===e.Name||!e.Channels||0===e.Channels.length)return g("Animation",e);for(var r=[],i=0,n=e.Channels.length;i<n;i++){var s=t.setJSON(e.Channels[i]).readObject();r.push(s)}return a.a.all(r).then(function(t){return u.a.createAnimation(t,e.Name)})},p.StandardVec3Channel=function(t,e,r){var i=t.getJSON();if(!(void 0!==i.TargetName&&i.KeyFrames&&i.Name&&i.KeyFrames.Time&&i.KeyFrames.Key&&3===i.KeyFrames.Key.length))return g("StandardVec3Channel",i);var n=t.setJSON(i.KeyFrames.Time).readBufferArray(),s=t.setJSON(i.KeyFrames.Key[0]).readBufferArray(),o=t.setJSON(i.KeyFrames.Key[1]).readBufferArray(),h=t.setJSON(i.KeyFrames.Key[2]).readBufferArray();return a.a.all([n,s,o,h]).then(function(t){for(var a=t[0].getElements(),n=t[1].getElements(),s=t[2].getElements(),o=t[3].getElements(),h=a.length,u=new Float32Array(new ArrayBuffer(4*(h+1)*3),0,3*h),c=new Float32Array(new ArrayBuffer(4*(h+1)),0,h),l=0;l<h;l++){var d=3*l;c[l]=a[l],u[d++]=n[l],u[d++]=s[l],u[d]=o[l]}return r(u,c,i.TargetName,i.Name,e),e})},p.StandardQuatChannel=function(t,e,r){var i=t.getJSON();if(!(void 0!==i.TargetName&&i.KeyFrames&&i.Name&&i.KeyFrames.Time&&i.KeyFrames.Key&&4===i.KeyFrames.Key.length))return g("StandardQuatChannel",i);var n=t.setJSON(i.KeyFrames.Time).readBufferArray(),s=t.setJSON(i.KeyFrames.Key[0]).readBufferArray(),o=t.setJSON(i.KeyFrames.Key[1]).readBufferArray(),h=t.setJSON(i.KeyFrames.Key[2]).readBufferArray(),u=t.setJSON(i.KeyFrames.Key[3]).readBufferArray();return a.a.all([n,s,o,h,u]).then(function(t){for(var a=t[0].getElements(),n=t[1].getElements(),s=t[2].getElements(),o=t[3].getElements(),h=t[4].getElements(),u=a.length,c=new Float32Array(new ArrayBuffer(4*(u+1)*4),0,4*u),l=new Float32Array(new ArrayBuffer(4*(u+1)),0,u),d=0;d<u;d++){var _=4*d;l[d]=a[d],c[_++]=n[d],c[_++]=s[d],c[_++]=o[d],c[_]=h[d]}return r(c,l,i.TargetName,i.Name,e),e})},p.StandardFloatChannel=function(t,e,r){var i=t.getJSON();if(!(void 0!==i.TargetName&&i.KeyFrames&&i.Name&&i.KeyFrames.Time&&i.KeyFrames.Key))return g("StandardFloatChannel",i);var n=t.setJSON(i.KeyFrames.Time).readBufferArray(),s=t.setJSON(i.KeyFrames.Key).readBufferArray();return a.a.all([n,s]).then(function(t){for(var a=t[0].getElements(),n=t[1].getElements(),s=a.length,o=new Float32Array(new ArrayBuffer(4*(s+1)),0,s),h=new Float32Array(new ArrayBuffer(4*(s+1)),0,s),u=0;u<s;u++)h[u]=a[u],o[u]=n[u];return r(o,h,i.TargetName,i.Name,e),e})},p.Vec3LerpChannel=function(t,e){return p.StandardVec3Channel(t,e,h.a.createVec3Channel)},p.QuatLerpChannel=function(t,e){return p.StandardQuatChannel(t,e,h.a.createQuatChannel)},p.QuatSlerpChannel=function(t,e){return p.StandardQuatChannel(t,e,h.a.createQuatChannel)},p.FloatLerpChannel=function(t,e){return p.StandardFloatChannel(t,e,h.a.createFloatChannel)},p.FloatCubicBezierChannel=function(t,e){var r=t.getJSON();if(!(void 0!==r.TargetName&&r.KeyFrames&&r.Name&&r.KeyFrames.Time&&r.KeyFrames.Position&&r.KeyFrames.ControlPointOut&&r.KeyFrames.ControlPointIn))return g("FloatCubicBezierChannel",r);var i,n=[],s=window.Object.keys(r.KeyFrames);for(i=0;i<s.length;i++)n.push(t.setJSON(r.KeyFrames[s[i]]).readBufferArray());return a.a.all(n).then(function(t){var a=t[0].getElements(),n=t[1].getElements(),s=t[2].getElements(),o=t[3].getElements(),u=o.length,c=new Float32Array(new ArrayBuffer(4*(u+1)*3),0,3*u),l=new Float32Array(new ArrayBuffer(4*(u+1)),0,u);for(i=0;i<u;i++){var d=3*i;l[i]=o[i],c[d++]=s[i],c[d++]=a[i],c[d]=n[i]}return h.a.createFloatCubicBezierChannel(c,l,r.TargetName,r.Name,e),e})},p.Vec3CubicBezierChannel=function(t,e){var r=t.getJSON();if(!(void 0!==r.TargetName&&r.KeyFrames&&r.Name&&r.KeyFrames.Time&&r.KeyFrames.Position&&r.KeyFrames.ControlPointOut&&r.KeyFrames.ControlPointIn&&3===r.KeyFrames.Position.length&&3===r.KeyFrames.ControlPointIn.length&&3===r.KeyFrames.ControlPointOut.length))return g("Vec3CubicBezierChannel",r);var i,n=[],s=window.Object.keys(r.KeyFrames);for(i=0;i<s.length;i++){var o=s[i],u=r.KeyFrames[o];"Time"!==o?(n.push(t.setJSON(u[0]).readBufferArray()),n.push(t.setJSON(u[1]).readBufferArray()),n.push(t.setJSON(u[2]).readBufferArray())):n.push(t.setJSON(u).readBufferArray())}return a.a.all(n).then(function(t){var a=t[0].getElements(),n=t[1].getElements(),s=t[2].getElements(),o=t[3].getElements(),u=t[4].getElements(),c=t[5].getElements(),l=t[6].getElements(),d=t[7].getElements(),_=t[8].getElements(),f=t[9].getElements(),g=f.length,p=new Float32Array(new ArrayBuffer(4*(g+1)*9),0,9*g),m=new Float32Array(new ArrayBuffer(4*(g+1)),0,g);for(i=0;i<g;i++){var v=9*i;m[i]=f[i],p[v++]=l[i],p[v++]=d[i],p[v++]=_[i],p[v++]=a[i],p[v++]=n[i],p[v++]=s[i],p[v++]=o[i],p[v++]=u[i],p[v]=c[i]}return h.a.createVec3CubicBezierChannel(p,m,r.TargetName,r.Name,e),e})},p.BasicAnimationManager=function(t,e){var r=t.getJSON();if(!r.Animations)return g("BasicAnimationManager",r);o.a.Object(t,e);for(var i=[],n=0,h=r.Animations.length;n<h;n++){var u=t.setJSON(r.Animations[n]).readObject();u.isRejected()?s.a.warn("An Animation failed on the parsing!"):i.push(u)}return a.a.all(i).then(function(t){return e.init(t),e})},p.UpdateMatrixTransform=function(t,e){var r=t.getJSON();if(/*!jsonObj.Name ||*/!r.StackedTransforms)return g("UpdateMatrixTransform",r);o.a.Object(t,e);var i,n,h=[];for(i=0,n=r.StackedTransforms.length;i<n;i++){var u=t.setJSON(r.StackedTransforms[i]).readObject();u.isRejected()?s.a.warn("A stacked transforms failed on the parsing!"):h.push(u)}return a.a.all(h).then(function(t){var r=e.getStackedTransforms();for(i=0,n=t.length;i<n;i++)r.push(t[i]);return e.computeChannels(),e})},p.StackedTranslate=function(t,e){var r=t.getJSON();return r.Name&&r.Translate?(o.a.Object(t,e),e.init(r.Translate),a.a.resolve(e)):g("StackedTranslate",r)},p.StackedQuaternion=function(t,e){var r=t.getJSON();return r.Name&&r.Quaternion?(o.a.Object(t,e),e.init(r.Quaternion),a.a.resolve(e)):g("StackedQuaternion",r)},p.StackedRotateAxis=function(t,e){var r=t.getJSON();return r.Axis&&void 0!==r.Angle?(o.a.Object(t,e),e.init(r.Axis,r.Angle),a.a.resolve(e)):g("StackedRotateAxis",r)},p.StackedMatrix=function(t,e){var r=t.getJSON();return r.Name&&r.Matrix?(o.a.Object(t,e),e.init(r.Matrix),a.a.resolve(e)):g("StackedMatrix",r)},p.StackedScale=function(t,e){var r=t.getJSON();return r.Name&&r.Scale?(o.a.Object(t,e),e.init(r.Scale),a.a.resolve(e)):g("StackedScale",r)},p.Bone=function(t,e){var r=t.getJSON();if(!r.InvBindMatrixInSkeletonSpace)return g("Bone",r);var i=o.a.MatrixTransform(t,e);if(e.setInvBindMatrixInSkeletonSpace(r.InvBindMatrixInSkeletonSpace),r.BoundingBox){var a=e.getBoneBoundingBox();a.setMax(r.BoundingBox.max),a.setMin(r.BoundingBox.min)}return i},p.UpdateBone=p.UpdateMatrixTransform,p.UpdateSkeleton=function(t,e){return o.a.Object(t,e),a.a.resolve(e)},p.Skeleton=o.a.MatrixTransform,p.RigGeometry=function(t,e){var r=t.getJSON();if(!r.SourceGeometry)return g("RigGeometry",r);r.BoneMap||s.a.warn("No boneMap found in a RigGeometry !");var i=o.a.Geometry(t,e);e._boneNameID=r.BoneMap;var n,h=r.SourceGeometry["osg.Geometry"];return h?(t.setJSON(h),e.setSourceGeometry(new f.a),n=o.a.Geometry(t,e.getSourceGeometry())):(h=r.SourceGeometry["osgAnimation.MorphGeometry"],h?(t.setJSON(h),e.setSourceGeometry(new _.a),n=p.MorphGeometry(t,e.getSourceGeometry())):s.a.warn("SourceGeometry type no recognized")),void 0===e._uniqueID&&(e._uniqueID=h.UniqueID),a.a.all([i,n]).then(function(){return e.mergeChildrenData(),e})},p.MorphGeometry=function(t,e){var r=t.getJSON();if(!r.MorphTargets)return g("MorphGeometry",r);var i=r.MorphTargets,n=[];n.push(o.a.Geometry(t,e));for(var s=0,h=i.length;s<h;s++)n.push(t.setJSON(i[s]).readObject());return a.a.all(n).then(function(t){for(var e=t[0],r=e.getMorphTargets(),i=1,a=t.length;i<a;i++)r.push(t[i]);return e.mergeChildrenVertexAttributeList(),e})},p.UpdateMorph=function(t,e){var r=t.getJSON();if(!r.TargetMap)return g("UpdateMorph",r);o.a.Object(t,e);for(var i=window.Object.keys(r.TargetMap),n=0,s=i.length;n<s;n++){var h=i[n];e.addTarget(r.TargetMap[h],parseInt(h,10))}return a.a.resolve(e)},p.StackedMatrixElement=p.StackedMatrix,p.StackedScaleElement=p.StackedScale,e.a=p},function(t,e,r){"use strict";var i=r(14),a=r.n(i),n=r(72),s=r(2),o=r(138),h={};h.Text=function(t,e){var r=t.getJSON();if(!r.Text)return a.a.reject();var i=n.a.Node(t,e);if(e.setColor(r.Color),e.setText(r.Text),e.setAutoRotateToScreen(r.AutoRotateToScreen),e.setPosition(r.Position),e.setCharacterSize(r.CharacterSize),"VERTICAL"===r.Layout)return s.a.error("Vertical Alignment not supported"),a.a.reject();var h=r.Alignment;return r.Alignment.indexOf("BASE_LINE")>-1&&("LEFT_BASE_LINE"===r.Alignment?h=o.a.LEFT_CENTER:"CENTER_BASE_LINE"===r.Alignment?h=o.a.CENTER_CENTER:"RIGHT_BASE_LINE"===r.Alignment?h=o.a.RIGHT_CENTER:"LEFT_BOTTOM_BASE_LINE"===r.Alignment?h=o.a.LEFT_BOTTOM:"CENTER_BOTTOM_BASE_LINE"===r.Alignment?h=o.a.CENTER_BOTTOM:"RIGHT_BOTTOM_BASE_LINE"===r.Alignment&&(h=o.a.RIGHT_BOTTOM)),e.setAlignment(h),e.setLayout(r.Layout),i},e.a=h},function(t,e,r){"use strict";var i=r(50),a=r(0),n=r(1),s=r(80),o=r(16),h=r(35),u=r(7),c=r(29),l=r(3),d=r(8),_=function(t){s.a.call(this),this._canvas=document.createElement("canvas"),this._context=this._canvas.getContext("2d"),this._matrixTransform=new o.a,this.addChild(this._matrixTransform),this._text="",void 0!==t&&(this._text=t),this._font="monospace",this._color=n.g.fromValues(0,0,0,1),this._fillStyle="rgba( 0, 0, 0, 1 )",this._context.textAlign="center",this._textX=void 0,this._context.baseLine="middle",this._textY=void 0,this._characterSize=1,this._characterSizeMode=_.OBJECT_COORDS,this._fontSize=32,this._geometry=void 0,this._autoRotateToScreen=!1,this._position=n.f.create(),this._layout=_.LEFT_TO_RIGHT,this._alignment=_.CENTER_CENTER,this._forcePowerOfTwo=!1,this._texture=new u.default,this.drawText(),this._dirty=!1,this._previousModelView=n.c.create()};_.OBJECT_COORDS=0,_.SCREEN_COORDS=1,_.OBJECT_COORDS_WITH_MAXIMUM_SCREEN_SIZE_CAPPED_BY_FONT_HEIGHT=2,_.LEFT_TO_RIGHT="ltr",_.RIGHT_TO_LEFT="rtl",_.LEFT_TOP=0,_.LEFT_CENTER=1,_.LEFT_BOTTOM=2,_.CENTER_TOP=3,_.CENTER_CENTER=4,_.CENTER_BOTTOM=5,_.RIGHT_TOP=6,_.RIGHT_CENTER=7,_.RIGHT_BOTTOM=8,a.a.createPrototypeNode(_,a.a.objectInherit(s.a.prototype,{drawText:function(){if(void 0!==this._geometry&&(this._matrixTransform.removeChild(this._geometry),this._geometry.releaseGLObjects()),this._text){this.setTextProperties(),this._canvas.width=this._context.measureText(this._text).width,this._canvas.height=2*this._fontSize,this._forcePowerOfTwo&&(this._canvas.width=this._nextPowerOfTwo(this._canvas.width),this._canvas.height=this._nextPowerOfTwo(this._canvas.height)),this.setTextProperties(),this._context.clearRect(0,0,this._canvas.width,this._canvas.height),this._context.fillText(this._text,this._textX,this._textY);var t=this._canvas.width/this._canvas.height,e=this._characterSize*t;this._geometry=h.a.createTexturedQuadGeometry(-e/2,-this._characterSize/2,0,e,0,0,0,this._characterSize,0),this._texture.setTextureSize(this._canvas.width,this._canvas.height),this._texture.setMinFilter("LINEAR"),this._texture.setMagFilter("LINEAR"),this._texture.setImage(this._canvas);var r=this._geometry.getOrCreateStateSet();r.setTextureAttributeAndModes(0,this._texture),r.setRenderingHint("TRANSPARENT_BIN"),r.setAttributeAndModes(new c.a(c.a.ONE,c.a.ONE_MINUS_SRC_ALPHA)),this._matrixTransform.addChild(this._geometry),this.dirtyBound()}},setText:function(t){this._text=t,this._dirty=!0},getText:function(){return this._text},setFont:function(t){this._font=t,this._dirty=!0},setColor:function(t){this._color=t,this._fillStyle="rgba("+Math.round(255*t[0])+","+Math.round(255*t[1])+","+Math.round(255*t[2])+","+t[3]+")",this._context.fillStyle=this._fillStyle,this._context.fillText(this._text,this._textX,this._textY)},getColor:function(){return this._color},setCharacterSize:function(t){this._characterSize=t,this._characterSizeMode!==_.OBJECT_COORDS&&(n.c.fromScaling(this._matrixTransform.getMatrix(),[this._characterSize,this._characterSize,this._characterSize]),this._characterSizeMode===_.OBJECT_COORDS_WITH_MAXIMUM_SCREEN_SIZE_CAPPED_BY_FONT_HEIGHT&&this.setMaximumScale(this._characterSize)),this._dirty=!0},getCharacterSize:function(){return this._characterSize},setCharacterSizeMode:function(t){this._characterSizeMode=t,this._characterSizeMode!==_.OBJECT_COORDS?(n.c.fromScaling(this._matrixTransform.getMatrix(),[this._characterSize,this._characterSize,this._characterSize]),this.setAutoScaleToScreen(!0),this.setMaximumScale(Number.MAX_VALUE),this._characterSizeMode===_.OBJECT_COORDS_WITH_MAXIMUM_SCREEN_SIZE_CAPPED_BY_FONT_HEIGHT&&this.setMaximumScale(this._characterSize)):(this._matrixTransform.setMatrix(n.c.create()),this.setAutoScaleToScreen(!1)),this._dirty=!0},getCharacterSizeMode:function(){return this._characterSizeMode},setFontResolution:function(t){this._fontSize=t,this._dirty=!0},getFontResolution:function(){return this._fontSize},setPosition:function(t){this._position=t,n.c.fromTranslation(this.getMatrix(),t)},getPosition:function(){return this._position},setTextProperties:function(){this._context.fillStyle=this._fillStyle,this._setAlignmentValues(this._alignment),this._context.font=this._fontSize+"px "+this._font,this._context.direction=this._layout},setAutoRotateToScreen:function(t){s.a.prototype.setAutoRotateToScreen.call(this,t),this._dirty=!0},getAutoRotateToScreen:function(){return this._autoRotateToScreen},setLayout:function(t){this._layout="string"==typeof t?_[t]:t,this._dirty=!0},getLayout:function(){return this._layout},setAlignment:function(t){this._alignment="string"==typeof t?_[t]:t,this._dirty=!0},getAlignment:function(){return this._alignment},accept:function(){return function(t){if(this._dirty&&(this.drawText(),this._dirty=!1),t.getVisitorType()===l.a.CULL_VISITOR){var e=t.getViewport().width(),r=t.getViewport().height(),i=t.getCurrentProjectionMatrix(),a=t.getCurrentModelViewMatrix(),s=this._position,o=this._firstTimeToInitEyePoint;if(this._firstTimeToInitEyePoint||(n.c.exactEquals(a,this._previousModelView)?e!==this._previousWidth||r!==this._previousHeight?o=!0:n.c.exactEquals(i,this._previousProjection)?n.f.exactEquals(s,this._previousPosition)||(o=!0):o=!0:o=!0),this._firstTimeToInitEyePoint=!1,o){if(this._autoScaleToScreen){var h=t.getViewport(),u=this.computePixelSizeVector(h,i,a),c=n.g.fromValues(this._position[0],this._position[1],this._position[2],1),_=n.g.dot(c,u);_=.48/_;var f=1/_;if(this._autoScaleTransitionWidthRatio>0){var g,p,m;if(this._minimumScale>0){var v=this._minimumScale,S=this._maximumScale<Number.MAX_VALUE?this._minimumScale+(this._maximumScale-this._minimumScale)*this._autoScaleTransitionWidthRatio:this._minimumScale*(1+this._autoScaleTransitionWidthRatio);g=1/(4*(S-v)),p=1-2*g*S,m=v+p*p/(4*g);f<-p/(2*g)?f=this._minimumScale:f<S&&(f=m+p*f+g*(f*f))}if(this._maximumScale<Number.MAX_VALUE){var b=this._maximumScale,x=this._minimumScale>0?this._maximumScale+(this._minimumScale-this._maximumScale)*this._autoScaleTransitionWidthRatio:this._maximumScale*(1-this._autoScaleTransitionWidthRatio);g=1/(4*(x-b)),p=1-2*g*x,m=b+p*p/(4*g);f>-p/(2*g)?f=this._maximumScale:f>x&&(f=m+p*f+g*(f*f))}}this.setScale(f)}if(this._autoRotateToScreen){var y=n.d.create(),M=t.getCurrentModelViewMatrix();n.c.getRotation(y,M),this.setRotation(n.d.invert(y,y))}this._previousWidth=e,this._previousHeight=r,n.f.copy(this._previousPosition,s),n.c.copy(this._previousProjection,i),n.c.copy(this._previousModelView,a)}}d.a.prototype.accept.call(this,t)}}(),_setAlignmentValues:function(t){switch(t){case _.LEFT_TOP:this._context.textAlign="left",this._textX=0,this._context.textBaseline="top",this._textY=0;break;case _.LEFT_CENTER:this._context.textAlign="left",this._textX=0,this._context.textBaseline="middle",this._textY=this._canvas.height/2;break;case _.LEFT_BOTTOM:this._context.textAlign="left",this._textX=0,this._context.textBaseline="bottom",this._textY=this._canvas.height;break;case _.CENTER_TOP:this._context.textAlign="center",this._textX=this._canvas.width/2,this._context.textBaseline="top",this._textY=0;break;case _.CENTER_CENTER:this._context.textAlign="center",this._textX=this._canvas.width/2,this._context.textBaseline="middle",this._textY=this._canvas.height/2;break;case _.CENTER_BOTTOM:this._context.textAlign="center",this._textX=this._canvas.width/2,this._context.textBaseline="bottom",this._textY=this._canvas.height;break;case _.RIGHT_TOP:this._context.textAlign="right",this._textX=this._canvas.width,this._context.textBaseline="top",this._textY=0;break;case _.RIGHT_CENTER:this._context.textAlign="right",this._textX=this._canvas.width,this._context.textBaseline="middle",this._textY=this._canvas.height/2;break;case _.RIGHT_BOTTOM:this._context.textAlign="right",this._textX=this._canvas.width,this._context.textBaseline="bottom",this._textY=this._canvas.height}},setForcePowerOfTwo:function(t){this._forcePowerOfTwo=t},getForcePowerOfTwo:function(){return this._forcePowerOfTwo},_nextPowerOfTwo:function(t){var e=t;return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}}),"osgText","Text"),i.a.registerApplyFunction(_.nodeTypeID,i.a.getApplyFunction(s.a.nodeTypeID)),e.a=_},function(t,e){t.exports=r},function(t,e,r){"use strict";var i=r(0),a=r(1),n=r(76),s=function(){n.a.Intersection.call(this),this._localIntersectionNormal=a.f.clone(a.f.ONE),this._i1=-1,this._i2=-1,this._i3=-1,this._r1=0,this._r2=0,this._r3=0},o=function(){n.a.call(this),this._threshold=0,this._d=a.f.create(),this._length=0,this._invLength=0,this._start=a.f.create(),this._end=a.f.create(),this._dInvX=a.f.create(),this._dInvY=a.f.create(),this._dInvZ=a.f.create(),this._hit=!1};i.a.createPrototypeObject(o,i.a.objectInherit(n.a.prototype,{set:function(t,e,r){this._start=t,this._end=e,a.f.sub(this._d,e,t),this._length=a.f.length(this._d),this._invLength=0!==this._length?1/this._length:0,a.f.scale(this._d,this._d,this._invLength),0!==this._d[0]&&a.f.scale(this._dInvX,this._d,1/this._d[0]),0!==this._d[1]&&a.f.scale(this._dInvY,this._d,1/this._d[1]),0!==this._d[2]&&a.f.scale(this._dInvZ,this._d,1/this._d[2]),void 0!==r&&(this._threshold=r)},enter:function(t,e,r){var i=t._min,n=i[0],s=i[1],o=i[2],h=t._max,u=h[0],c=h[1],l=h[2],d=this._dInvX,_=this._dInvY,f=this._dInvZ;if(e[0]<=r[0]){if(r[0]<n)return!1;if(e[0]>u)return!1;e[0]<n&&a.f.scaleAndAdd(e,e,d,n-e[0]),r[0]>u&&a.f.scaleAndAdd(r,e,d,u-e[0])}else{if(e[0]<n)return!1;if(r[0]>u)return!1;r[0]<n&&a.f.scaleAndAdd(r,e,d,n-e[0]),e[0]>u&&a.f.scaleAndAdd(e,e,d,u-e[0])}if(e[1]<=r[1]){if(r[1]<s)return!1;if(e[1]>c)return!1;e[1]<s&&a.f.scaleAndAdd(e,e,_,s-e[1]),r[1]>c&&a.f.scaleAndAdd(r,e,_,c-e[1])}else{if(e[1]<s)return!1;if(r[1]>c)return!1;r[1]<s&&a.f.scaleAndAdd(r,e,_,s-e[1]),e[1]>c&&a.f.scaleAndAdd(e,e,_,c-e[1])}if(e[2]<=r[2]){if(r[2]<o)return!1;if(e[2]>l)return!1;e[2]<o&&a.f.scaleAndAdd(e,e,f,o-e[2]),r[2]>l&&a.f.scaleAndAdd(r,e,f,l-e[2])}else{if(e[2]<o)return!1;if(r[2]>l)return!1;r[2]<o&&a.f.scaleAndAdd(r,e,f,o-e[2]),e[2]>l&&a.f.scaleAndAdd(e,e,f,l-e[2])}return!0},intersectPoint:function(){var t=a.f.create(),e=a.f.create();return function(r,i){var n=this._start;a.f.sub(t,r,n),a.f.sub(e,this._end,n);var o=a.f.dot(t,e)*this._invLength*this._invLength;if(!((o<0?a.f.sqrLen(t):o>1?a.f.sqrDist(r,this._end):a.f.sqrLen(a.f.scaleAndAdd(t,t,e,-o)))>this._threshold*this._threshold)){var h=this.initIntersection(new s);h._i1=i,h._r1=1,a.f.scaleAndAdd(h._localIntersectionPoint,n,e,o),h._ratio=o}}}(),intersectLine:function(){var t=a.f.create(),e=a.f.create(),r=a.f.create(),i=a.f.create(),n=a.f.create();return function(o,h,u,c){a.f.sub(t,h,o),a.f.sub(e,this._end,this._start),a.f.sub(r,o,this._start);var l,d,_=a.f.dot(t,t),f=a.f.dot(t,e),g=a.f.dot(e,e),p=a.f.dot(t,r),m=a.f.dot(e,r),v=_*g-f*f,S=v,b=v;v<1e-8?(l=0,S=1,d=m,b=g):(l=f*m-g*p,d=_*m-f*p,l<0?(l=0,d=m,b=g):l>S&&(l=S,d=m+f,b=g)),d<0?(d=0,-p<0?l=0:-p>_?l=S:(l=-p,S=_)):d>b&&(d=b,-p+f<0?l=0:-p+f>_?l=S:(l=-p+f,S=_));var x=Math.abs(l)<1e-8?0:l/S,y=Math.abs(d)<1e-8?0:d/b;if(a.f.scaleAndAdd(i,o,t,x),a.f.scaleAndAdd(n,this._start,e,y),!(a.f.sqrDist(i,n)>this._threshold*this._threshold)){var M=this.initIntersection(new s);M._i1=u,M._i2=c,M._r1=1-y,M._r2=y,a.f.copy(M._localIntersectionPoint,n),M._ratio=y}}}(),intersectTriangle:function(){var t=a.f.create(),e=a.f.create(),r=a.f.create(),i=a.f.create(),n=a.f.create(),o=a.f.create();return function(h,u,c,l,d,_){var f=this._d;a.f.sub(e,c,h),a.f.sub(r,u,h),a.f.cross(n,f,e);var g=a.f.dot(n,r);if(!(g>-1e-20&&g<1e-20)){var p=1/g;a.f.sub(i,this._start,h);var m=a.f.dot(n,i)*p;if(!(m<0||m>1)){a.f.cross(o,i,r);var v=a.f.dot(o,f)*p;if(!(v<0||m+v>1)){var S=a.f.dot(o,e)*p;if(!(S<1e-20||S>this._length)){var b=1-m-v,x=m,y=v,M=S*this._invLength,T=h[0]*b+u[0]*x+c[0]*y,A=h[1]*b+u[1]*x+c[1]*y,C=h[2]*b+u[2]*x+c[2]*y;a.f.cross(t,r,e),a.f.normalize(t,t);var I=this.initIntersection(new s);I._i1=l,I._i2=d,I._i3=_,I._r1=b,I._r2=x,I._r3=y,a.f.set(I._localIntersectionPoint,T,A,C),a.f.copy(I._localIntersectionNormal,t),I._ratio=M,I._backface=a.c.determinant(I._matrix)*g<0}}}}}}(),operatorPoint:function(t){this._threshold<=0||n.a.prototype.operatorPoint.call(this,t)},operatorLine:function(t,e){this._threshold<=0||n.a.prototype.operatorLine.call(this,t,e)}}),"osgUtil","LineSegmentIntersectFunctor"),e.a=o},function(t,e,r){"use strict";var i=r(0),a=r(1),n=r(82),s=r(43),o=r(74),h=r(142),u=function(){o.a.call(this),this._index=0,this._polytope=new n.a,this._iPolytope=new n.a,this._referencePlane=a.g.create(),this._iReferencePlane=a.g.create()},c=function(t,e,r){var i=e[0],a=e[1],n=e[2],s=e[3];t[0]=r[0]*i+r[1]*a+r[2]*n+r[3]*s,t[1]=r[4]*i+r[5]*a+r[6]*n+r[7]*s,t[2]=r[8]*i+r[9]*a+r[10]*n+r[11]*s,t[3]=r[12]*i+r[13]*a+r[14]*n+r[15]*s};i.a.createPrototypeObject(u,i.a.objectInherit(o.a.prototype,{setPolytope:function(t){this._polytope.setPlanes(t);for(var e=[],r=0;r<t.length;++r){var i=t[r];e[r]=a.g.copy(this._iPolytope.getPlanes()[r]||s.a.create(),i)}this._iPolytope.setPlanes(e),a.g.copy(this._referencePlane,t[t.length-1]),a.g.copy(this._iReferencePlane,this._referencePlane)},getPolytope:function(){return this._iPolytope},setPolytopeFromWindowCoordinates:function(t,e,r,i){this.setPolytope([a.g.fromValues(1,0,0,-t),a.g.fromValues(-1,0,0,r),a.g.fromValues(0,1,0,-e),a.g.fromValues(0,-1,0,i),a.g.fromValues(0,0,1,0)])},intersectBoundingBox:function(t){return this._iPolytope.containsBoundingBox(t)},intersectBoundingSphere:function(t){return this._iPolytope.containsBoundingSphere(t)},intersect:function(){var t=new h.a;return function(e,r){t.setGeometry(r),t.setIntersectionVisitor(e),t.setIntersector(this);var i=r.getShape();i?i.intersect(t,i.getNodes()[0]):(r.computeTransformedVertices&&t.setVertices(r.computeTransformedVertices()),t.apply(r)),t.reset()}}(),setCurrentTransformation:function(t){for(var e=this._polytope.getPlanes(),r=this._iPolytope.getPlanes(),i=0,n=e.length;i<n;i++){var s=r[i]=r[i]||a.g.create();c(s,e[i],t),a.g.scale(s,s,1/a.f.len(s))}c(this._iReferencePlane,this._referencePlane,t),a.g.scale(this._iReferencePlane,this._iReferencePlane,1/a.f.len(this._iReferencePlane))}}),"osgUtil","PolytopeIntersector"),e.a=u},function(t,e,r){"use strict";var i=r(0),a=r(1),n=r(43),s=r(76),o=function(){s.a.Intersection.call(this),this._intersectionPoints=[],this._distance=0,this._maxDistance=0,this._numIntersectionPoints=0},h=function(){s.a.call(this),this._src=[],this._dest=[],this._maxNumIntersectionsPoints=6};i.a.createPrototypeObject(h,i.a.objectInherit(s.a.prototype,{reset:function(){s.a.prototype.reset.call(this),this._src=[],this._dest=[]},enter:function(t){return!!this._intersector.getPolytope().containsBoundingBox(t)&&(this._intersector.getPolytope().pushCurrentMask(),!0)},leave:function(){this._intersector.getPolytope().popCurrentMask()},addIntersection:function(){this._src=i.a.arrayUniq(this._src);for(var t=this._src,e=a.f.create(),r=-Number.MAX_VALUE,s=this._intersector._iReferencePlane,h=0;h<t.length;++h){a.f.add(e,e,t[h]);var u=n.a.distanceToPlane(s,t[h]);u>r&&(r=u)}a.f.scale(e,e,1/t.length);var c=this.initIntersection(new o);c._distance=n.a.distanceToPlane(s,e),c._maxDistance=r,a.f.copy(c._localIntersectionPoint,e);var l=this._maxNumIntersectionsPoints;for(c._numIntersectionPoints=t.length<l?t.length:l,h=0;h<c._numIntersectionPoints;++h)c._intersectionPoints.push(a.f.clone(this._src[h]))},contains:function(){var t=this._intersector.getPolytope(),e=t.getPlanes(),r=t.getCurrentMask();if(!r)return!0;for(var i=1,s=0;s<e.length;++s)if(r&0===i)i<<=1;else{this._dest=[];for(var o=e[s],h=this._src[0],u=n.a.distanceToPlane(o,h),c=1;c<this._src.length;++c){var l=this._src[c],d=n.a.distanceToPlane(o,l);if(u>=0&&this._dest.push(a.f.clone(h)),u*d<0){var _=u-d,f=u/_,g=a.f.add(a.f.create(),a.f.scale(a.f.create(),h,1-f),a.f.scale(a.f.create(),l,f));this._dest.push(g)}u=d,h=l}if(u>=0&&this._dest.push(a.f.clone(h)),this._dest.length<=1)return!1;var p=this._src.slice();this._src=this._dest.slice(),this._dest=p}return!0},containsPoint:function(t){return!!this._intersector.getPolytope().containsVertex(t)&&(this._src=[],this._src[0]=t,!0)},containsLine:function(t,e){return this._src=[],this._src[0]=t,this._src[1]=e,this._src[2]=t,this.contains()},containsTriangle:function(t,e,r){return this._src=[],this._src[0]=t,this._src[1]=e,this._src[2]=r,this._src[3]=t,this.contains()},intersectPoint:function(t){this.containsPoint(t)&&this.addIntersection()},intersectLine:function(t,e){this.containsLine(t,e)&&this.addIntersection()},intersectTriangle:function(t,e,r){this.containsTriangle(t,e,r)&&this.addIntersection()}}),"osgUtil","PolytopeIntersectFunctor"),e.a=h},function(t,e,r){"use strict";var i=r(91),a=r(10),n=r(0),s=function(t){i.a.call(this,t),this._timer=!1};n.a.createPrototypeObject(s,n.a.objectInherit(i.a.prototype,{_initInputs:function(){i.a.prototype._initInputs.call(this,a.a.CAD_MANIPULATOR_MOUSEKEYBOARD,a.a.CAD_MANIPULATOR_RESETTOHOME),this._manipulator.getInputManager().group(a.a.CAD_MANIPULATOR_MOUSEKEYBOARD).addMappings({savePosition:"mousemove"},this)},zoom:function(t){var e=-t.deltaY/this._zoomFactor,r=this._manipulator,i=r.getZoomInterpolator().getTarget()[0]-e;if(r.getZoomInterpolator().setTarget(i),!1===this._timer){this._timer=!0;var a=this;this._timerRef&&clearTimeout(this._timerRef),this._timerRef=setTimeout(function(){a._timer=!1},200),r.computeIntersections(t.glX,t.glY)}},savePosition:function(t){this._lastX=t.glX,this._lastY=t.glY},setMode:function(t,e,r){this._inMotion||this._manipulator.computeIntersections(this._lastX,this._lastY),i.a.prototype.setMode.call(this,t,e,r)},center:function(t){var e=this._manipulator;e.getZoomInterpolator().set(0);var r=e.getZoomInterpolator().getTarget()[0]-10;e.getZoomInterpolator().setTarget(r),e.computeIntersections(t.glX,t.glY)}})),e.a=s},function(t,e,r){"use strict";e.a={ROTATE:0,PAN:1,ZOOM:2}},function(t,e,r){"use strict";var i=r(77),a=r(10),n=r(0),s=function(t){i.a.call(this,t),this._timer=!1};n.a.createPrototypeObject(s,n.a.objectInherit(i.a.prototype,{_initInputs:function(){i.a.prototype._initInputs.call(this,a.a.CAD_MANIPULATOR_TOUCH)},startMotion:function(t,e,r){i.a.prototype.startMotion.call(this,t,e,r),this._manipulator.computeIntersections(r.glX,r.glY)}})),e.a=s},function(t,e,r){"use strict";var i=r(77),a=r(10),n=r(0),s=function(t){i.a.call(this,t),this._timer=!1};n.a.createPrototypeObject(s,n.a.objectInherit(i.a.prototype,{_initInputs:function(){i.a.prototype._initInputs.call(this,a.a.FPS_MANIPULATOR_TOUCH)}})),e.a=s},function(t,e,r){"use strict";var i=r(32),a=r(0),n=r(1),s=r(10),o=n.d.create(),h=n.f.create(),u=function(t){i.a.call(this,t),this.init()};a.a.createPrototypeObject(u,a.a.objectInherit(i.a.prototype,{init:function(){this._pos=n.f.create(),this._quat=n.d.create();var t=this._manipulator.getInputManager();t.group(s.a.FPS_MANIPULATOR_WEBVR).addMappings({update:"vrdisplayposechanged"},this),t.setEnable(s.a.FPS_MANIPULATOR_WEBVR,!1)},update:function(t){var e=t.pose.orientation;e&&(t.sitToStandMatrix&&(e=n.c.getRotation(o,t.sitToStandMatrix),n.d.mul(e,e,t.pose.orientation)),this._quat[0]=e[0],this._quat[1]=-e[2],this._quat[2]=e[1],this._quat[3]=e[3]);var r=t.pose.position;r&&(t.sitToStandMatrix&&(r=n.f.transformMat4(h,r,t.sitToStandMatrix)),this._pos[0]=r[0]*t.worldFactor,this._pos[1]=-r[2]*t.worldFactor,this._pos[2]=r[1]*t.worldFactor),this._manipulator.setPoseVR(this._quat,this._pos)}})),e.a=u},function(t,e,r){"use strict";var i=r(32),a=r(0),n=r(10),s=function(t){i.a.call(this,t),this.init()};a.a.createPrototypeObject(s,a.a.objectInherit(i.a.prototype,{init:function(){this._delay=.15,this._stepFactor=1,this._looking=!1;var t=this._manipulator.getInputManager();t.group(n.a.FPS_MANIPULATOR_MOUSEKEYBOARD).addMappings({startLookAt:"mousedown",lookAt:"mousemove",stopLookAt:["mouseup","mouseout"],goForward:["keydown w","keydown z","keydown ArrowUp"],goBackward:["keydown s","keydown ArrowDown"],goLeft:["keydown a","keydown q","keydown ArrowLeft"],goRight:["keydown d","keydown ArrowRight"],stopMoving:["keyup w","keyup z","keyup ArrowUp","keyup s","keyup ArrowDown"],stopStrafing:["keyup a","keyup q","keyup ArrowLeft","keyup d","keyup ArrowRight"],changeStepFactor:"wheel"},this),t.group(n.a.FPS_MANIPULATOR_RESETTOHOME).addMappings({reset:"keydown space"},this)},setEnable:function(t){t||(this._buttonup=!0),i.a.prototype.setEnable.call(this,t)},setManipulator:function(t){this._manipulator=t,this._manipulator.setStepFactor(this._stepFactor)},stopLookAt:function(){this._looking=!1},startLookAt:function(t){this._manipulator.getLookPositionInterpolator().set(t.canvasX,-t.canvasY),this._looking=!0},lookAt:function(t){this._looking&&(this._manipulator.getLookPositionInterpolator().setDelay(this._delay),this._manipulator.getLookPositionInterpolator().setTarget(t.canvasX,-t.canvasY))},changeStepFactor:function(t){this._stepFactor=Math.min(Math.max(.001,this._stepFactor+.01*t.deltaY),4),this._manipulator.setStepFactor(this._stepFactor)},reset:function(){this._manipulator.computeHomePosition()},goForward:function(){this._manipulator.getForwardInterpolator().setDelay(this._delay),this._manipulator.getForwardInterpolator().setTarget(1)},goBackward:function(){this._manipulator.getForwardInterpolator().setDelay(this._delay),this._manipulator.getForwardInterpolator().setTarget(-1)},goLeft:function(){this._manipulator.getSideInterpolator().setDelay(this._delay),this._manipulator.getSideInterpolator().setTarget(-1)},goRight:function(){this._manipulator.getSideInterpolator().setDelay(this._delay),this._manipulator.getSideInterpolator().setTarget(1)},stopMoving:function(){this._manipulator.getForwardInterpolator().setDelay(this._delay),this._manipulator.getForwardInterpolator().setTarget(0)},stopStrafing:function(){this._manipulator.getSideInterpolator().setDelay(this._delay),this._manipulator.getSideInterpolator().setTarget(0)}})),e.a=s},function(t,e,r){"use strict";var i=r(0),a=r(1),n=r(73),s=r(150),o=r(151),h=r(77),u=r(91),c=r(152),l=r(78),d=r(10),_=function(t){n.a.call(this,t),this._homePosition=a.f.create(),this._frustum={},this.init()};_.AvailableControllerList=["StandardMouseKeyboard","GamePad","Hammer","DeviceOrientation","WebVR"],_.ControllerList=["StandardMouseKeyboard","GamePad","Hammer","DeviceOrientation","WebVR"];var f=2*Math.PI,g=function(t,e){return t<e+1e-5};i.a.createPrototypeObject(_,i.a.objectInherit(n.a.prototype,{init:function(){this._distance=25,this._target=a.f.create(),this._upz=a.f.fromValues(0,0,1),a.f.init(this._target);var t=a.c.fromRotation(a.c.create(),-Math.PI,this._upz),e=a.c.fromRotation(a.c.create(),Math.PI/10,a.f.fromValues(1,0,0));this._rotation=a.c.create(),a.c.mul(this._rotation,t,e),this._time=0,this._vrMatrix=a.c.create(),this._rotate=new l.a(2),this._pan=new l.a(2),this._zoom=new l.a(1),this._minSpeed=1e-4,this._scaleMouseMotion=1,this._inverseMatrix=a.c.create(),this._autoPushTarget=!0,this._limitPitchUp=.5*Math.PI*.9,this._limitPitchDown=-this._limitPitchUp,this._limitYawLeft=-Math.PI,this._limitYawRight=-this._limitYawLeft,this._limitZoomIn=1e-4,this._limitZoomOut=1/0,this._constrainYaw=!1,this._constrainPitch=!1,this._constrainYaw=!1,this._constrainZoom=!1;var r=this;_.ControllerList.forEach(function(t){void 0!==_[t]&&(r._controllerList[t]?r._controllerList[t].init():r._controllerList[t]=new _[t](r))})},setLimitPitchUp:function(t){this._limitPitchUp=t},setLimitPitchDown:function(t){this._limitPitchDown=t},setLimitYawLeft:function(t){this._limitYawLeft=t,this._constrainYaw=!0},setLimitYawRight:function(t){this._limitYawRight=t,this._constrainYaw=!0},setLimitZoomOut:function(t){this._limitZoomOut=t,this._constrainZoom=!0},setLimitZoomIn:function(t){this._limitZoomIn=t,this._constrainZoom=!0},setConstrainPitch:function(t){this._constrainPitch=t,this._previousPitch=void 0},isConstrainPitch:function(){return this._constrainPitch},setConstrainYaw:function(t){this._constrainYaw=t,this._previousYaw=void 0},isConstrainYaw:function(){return this._constrainYaw},setConstrainZoom:function(t){this._constrainZoom=t},isConstrainZoom:function(){return this._constrainZoom},setDelay:function(t){this._rotate.setDelay(t),this._pan.setDelay(t),this._zoom.setDelay(t)},reset:function(){this.init()},setTarget:function(t){a.f.copy(this._target,t);var e=a.f.create();this.getEyePosition(e),this._distance=a.f.distance(t,e)},setEyePosition:function(){var t=a.f.create(),e=a.f.create(),r=a.f.create();return function(i){var n=this._rotation,s=this._target;a.f.sub(t,i,s),a.f.normalize(t,t),a.f.cross(e,t,this._upz),a.f.normalize(e,e),a.f.cross(r,e,t),a.f.normalize(r,r),n[0]=e[0],n[1]=t[0],n[2]=r[0],n[3]=0,n[4]=e[1],n[5]=t[1],n[6]=r[1],n[7]=0,n[8]=e[2],n[9]=t[2],n[10]=r[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this._distance=a.f.distance(s,i)}}(),setEnable:function(t){this.getInputManager().setEnable(d.a.ORBIT_MANIPULATOR,t)},computeHomePosition:function(t){var e=this.getHomeBoundingSphere(t);e&&e.valid()&&(this.setDistance(this.getHomeDistance(e)),this.setTarget(e.center()))},getHomePosition:function(){if(void 0!==this._node){var t=this._target,e=this.getDistance();this.computeEyePosition(t,e,this._homePosition)}return this._homePosition},setMinSpeed:function(t){this._minSpeed=t},getMinSpeed:function(){return this._minSpeed},setDistance:function(t){this._distance=t},getDistance:function(){return this._distance},getSpeedFactor:function(){return Math.max(this._distance,this._minSpeed)},computePan:function(){var t=a.c.create(),e=a.f.create(),r=a.f.create();return function(i,n){var s=this._camera.getProjectionMatrix(),o=1===s[15]?1:2/s[5],h=this.getSpeedFactor()*o;n*=h,i*=h,a.c.invert(t,this._rotation),e[0]=t[0],e[1]=t[1],e[2]=t[2],a.f.normalize(e,e),r[0]=t[8],r[1]=t[9],r[2]=t[10],a.f.normalize(r,r),a.f.scale(e,e,-i),a.f.scale(r,r,n),a.f.add(this._target,this._target,e),a.f.add(this._target,this._target,r)}}(),computeRotation:function(){var t=a.f.fromValues(1,0,0);return function(e,r){var i=Math.atan(-this._rotation[6]/this._rotation[5]);isNaN(i)&&(i=0);var n=this._computePitch(i,r),s=e/10,o=Math.atan2(this._rotation[4],this._rotation[0]),h=this._computeYaw(o,s);a.c.fromRotation(this._rotation,-n,t),a.c.rotate(this._rotation,this._rotation,-h,this._upz)}}(),_computePitch:function(t,e){var r=t+e/10;return Math.min(Math.max(r,this._limitPitchDown),this._limitPitchUp)},_computeYaw:function(t,e){var r=t+e,i=this._limitYawLeft,a=this._limitYawRight;if(this._constrainYaw){if(a<i&&(r>Math.PI&&(t-=f,r-=f),r<-Math.PI&&(t+=f,r+=f)),0===e){var n=!1;n=i>a?r<i&&r>a:r<i||r>a,n&&(r=Math.abs(r-i)>Math.abs(r-a)?a:i)}e>0&&g(t,a)&&r>a?r=a:e<0&&g(i,t)&&r<i&&(r=i)}return r},computeZoom:function(t){this.zoom(t)},setAutoPushTarget:function(t){this._autoPushTarget=t},zoom:function(){var t=a.f.create();return function(e){var r=this._distance+this.getSpeedFactor()*(e-1);this._autoPushTarget&&r<this._limitZoomIn&&(a.f.sub(t,this._target,this.getEyePosition(t)),a.f.normalize(t,t),a.f.scale(t,t,this._limitZoomIn-r),a.f.add(this._target,this._target,t));var i=this._constrainZoom?this._limitZoomIn:1e-4,n=this._constrainZoom?this._limitZoomOut:1/0;this._distance=Math.max(i,Math.min(n,r))}}(),getRotateInterpolator:function(){return this._rotate},getPanInterpolator:function(){return this._pan},getZoomInterpolator:function(){return this._zoom},getTarget:function(t){return a.f.copy(t,this._target)},getEyePosition:function(t){return this.computeEyePosition(this._target,this._distance,t),t},computeEyePosition:function(){var t=a.f.create(),e=a.c.create();return function(r,i,n){a.c.invert(e,this._rotation),t[1]=i,a.f.transformMat4(n,t,e),a.f.add(n,r,n)}}(),update:function(){var t=a.f.create();return function(e){var r,i=e.getFrameStamp().getDeltaTime();r=this._rotate.update(i),this.computeRotation(.1*-r[0]*this._scaleMouseMotion,.1*-r[1]*this._scaleMouseMotion);r=this._pan.update(i),this.computePan(.002*-r[0],.002*-r[1]),r=this._zoom.update(i),this.computeZoom(1+r[0]/10);var n=this._target,s=this._distance;a.c.invert(this._inverseMatrix,this._rotation),a.c.mul(this._inverseMatrix,this._vrMatrix,this._inverseMatrix),a.f.set(t,0,s,0),a.f.transformMat4(t,t,this._inverseMatrix),a.c.lookAt(this._inverseMatrix,a.f.add(t,n,t),n,this._upz)}}(),setPoseVR:function(t){a.c.fromQuat(this._vrMatrix,t)}}),"osgGA","OrbitManipulator"),_.DeviceOrientation=s.a,_.GamePad=o.a,_.Hammer=h.a,_.WebVR=c.a,_.StandardMouseKeyboard=u.a,e.a=_},function(t,e,r){"use strict";var i=r(32),a=r(0),n=r(1),s=r(92),o=r(10),h=function(t){i.a.call(this,t),this.init()};a.a.createPrototypeObject(h,a.a.objectInherit(i.a.prototype,{init:function(){this._quat=n.d.create(),this._pos=n.f.create(),this._deviceOrientation=void 0,this._screenOrientation=void 0;var t=this._manipulator.getInputManager();t.group(o.a.ORBIT_MANIPULATOR_DEVICEORIENTATION).addMappings({setDeviceOrientation:"deviceorientation",setScreenOrientation:"orientationchange"},this),t.setEnable(o.a.ORBIT_MANIPULATOR_DEVICEORIENTATION,!1)},setDeviceOrientation:function(t){if(this._deviceOrientation||(this._deviceOrientation={}),this._deviceOrientation.alpha=t.alpha,this._deviceOrientation.beta=t.beta,this._deviceOrientation.gamma=t.gamma,t.screenOrientation)return void this.setScreenOrientation(t);this._update()},setScreenOrientation:function(t){this._screenOrientation=t.screenOrientation,this._update()},_update:function(){this._deviceOrientation&&this._screenOrientation&&(s.a.computeQuaternion(this._quat,this._deviceOrientation,this._screenOrientation),this._manipulator.setPoseVR(this._quat,this._pos))}})),e.a=h},function(t,e,r){"use strict";var i=r(32),a=r(0),n=r(1),s=r(10),o=function(t){i.a.call(this,t),this.init()};a.a.createPrototypeObject(o,a.a.objectInherit(i.a.prototype,{init:function(){this._delay=.15,this._zoomFactor=.5,this._rotateFactor=5,this._panFactor=10,this._rotate=this._manipulator.getRotateInterpolator(),this._zoom=this._manipulator.getZoomInterpolator(),this._pan=this._manipulator.getPanInterpolator(),this._rotate.setDelay(this._delay),this._zoom.setDelay(this._delay),this._pan.setDelay(this._delay);var t=this._manipulator.getInputManager();t.group(s.a.ORBIT_MANIPULATOR_GAMEPAD).addMappings({addZoom:"axis 3",addRotateX:"axis 0",addRotateY:"axis 1"},this),t.group(s.a.ORBIT_MANIPULATOR_GAMEPAD).addMappings({panUp:"buttonvalue 12"},this.pan.bind(this,n.e.fromValues(0,1))),t.group(s.a.ORBIT_MANIPULATOR_GAMEPAD).addMappings({panDown:"buttonvalue 13"},this.pan.bind(this,n.e.fromValues(0,-1))),t.group(s.a.ORBIT_MANIPULATOR_GAMEPAD).addMappings({panLeft:"buttonvalue 14"},this.pan.bind(this,n.e.fromValues(1,0))),t.group(s.a.ORBIT_MANIPULATOR_GAMEPAD).addMappings({panRight:"buttonvalue 15"},this.pan.bind(this,n.e.fromValues(-1,0)))},pan:function(t){var e=this._pan.getTarget();this._pan.setTarget(e[0]-t[0]*this._panFactor,e[1]+t[1]*this._panFactor)},addZoom:function(t){this._zoom.addTarget(-t.value*this._zoomFactor)},addRotateX:function(t){this._rotate.addTarget(-t.value*this._rotateFactor)},addRotateY:function(t){this._rotate.addTarget(0,t.value*this._rotateFactor)}})),e.a=o},function(t,e,r){"use strict";var i=r(32),a=r(0),n=r(1),s=r(10),o=n.d.create(),h=n.f.create(),u=function(t){i.a.call(this,t),this.init()};a.a.createPrototypeObject(u,a.a.objectInherit(i.a.prototype,{init:function(){this._pos=n.f.create(),this._quat=n.d.create();var t=this._manipulator.getInputManager();t.group(s.a.ORBIT_MANIPULATOR_WEBVR).addMappings({update:"vrdisplayposechanged"},this),t.setEnable(s.a.ORBIT_MANIPULATOR_WEBVR,!1)},update:function(t){var e=t.pose.orientation;e&&(t.sitToStandMatrix&&(e=n.c.getRotation(o,t.sitToStandMatrix),n.d.mul(e,e,t.pose.orientation)),this._quat[0]=e[0],this._quat[1]=-e[2],this._quat[2]=e[1],this._quat[3]=e[3]);var r=t.pose.position;r&&(t.sitToStandMatrix&&(r=n.f.transformMat4(h,r,t.sitToStandMatrix)),this._pos[0]=r[0]*t.worldFactor,this._pos[1]=-r[2]*t.worldFactor,this._pos[2]=r[1]*t.worldFactor),this._manipulator.setPoseVR(this._quat,this._pos)}})),e.a=u},function(t,e,r){"use strict";var i=r(35),a=function(t,e){var r,i;e?(r=e[0],i=e[1]):(r=t[14]/(t[10]-1),i=t[14]/(1+t[10]));var a=r*(t[8]-1)/t[0],n=r*(1+t[8])/t[0],s=r*(1+t[9])/t[5],o=r*(t[9]-1)/t[5],h=i*(t[8]-1)/t[0],u=i*(1+t[8])/t[0],c=i*(1+t[9])/t[5],l=i*(t[9]-1)/t[5],d=this.getAttributes().Vertex,_=d.getElements();_[0]=a,_[1]=o,_[2]=-r,_[3]=n,_[4]=o,_[5]=-r,_[6]=n,_[7]=s,_[8]=-r,_[9]=a,_[10]=s,_[11]=-r,_[12]=h,_[13]=l,_[14]=-i,_[15]=u,_[16]=l,_[17]=-i,_[18]=u,_[19]=c,_[20]=-i,_[21]=h,_[22]=c,_[23]=-i,d.dirty()},n=function(){var t=i.a.createBoundingBoxGeometry();return t.updateGeometry=a,t};e.a={createDebugFrustumGeometry:n}},function(t,e,r){"use strict";var i=r(0),a=r(3),n=r(11),s=r(13),o=r(20),h=r(9),u=r(17),c=r(6),l=r(31),d=r(1),_=r(58),f=r(59),g=r(45),p=r(34),m=r(70),v=function(){f.a.apply(this,arguments)},S=f.a.cloneStateAttributeConfig(f.a);S.textureAttribute=[],f.a.setStateAttributeConfig(v,S),i.a.createPrototypeObject(v,i.a.objectInherit(f.a.prototype,{getCompilerName:function(){return"CompilerOffsetNormal"},initTextureAttributes:function(){},createFragmentShaderGraph:function(){var t=this.getNode("glFragColor");return this.getNode("SetAlpha").inputs({color:this.getOrCreateUniform("vec3","uColorDebug"),alpha:this.createVariable("float").setValue("1.0")}).outputs({result:t}),[t]},getOffsetDirection:function(){return this.getOrCreateModelNormal()},getOrCreateModelVertex:function(){var t=this.getVariable("vertexOffset");if(t)return t;t=this.createVariable("vec3","vertexOffset");return this.getNode("InlineCode").code("%out = %offset == 1.0 ? %vertex + normalize(%direction.xyz) * %scale: %vertex;").inputs({offset:this.getOrCreateAttribute("float","Offset"),direction:this.getOffsetDirection(),vertex:f.a.prototype.getOrCreateModelVertex.call(this),scale:this.getOrCreateUniform("float","uScale")}).outputs({out:t}),t},getOrCreateViewVertex:function(){var t=this._variables.FragEyeVector;return t&&!t.isEmpty()?t:(t=this._varyings.FragEyeVector||this.createVariable("vec4","FragEyeVector"),this.getNode("MatrixMultPosition").inputs({matrix:this.getOrCreateUniform("mat4","uViewMatrix"),vec:this.getOrCreateModelVertex()}).outputs({vec:t}),t)}}),"osgUtil","CompilerOffsetNormal");var b=function(){_.a.apply(this,arguments),this.setShaderCompiler(v)};i.a.createPrototypeObject(b,i.a.objectInherit(_.a.prototype,{}),"osgUtil","ShaderGeneratorCompilerOffsetNormal");var x=function(){v.apply(this,arguments)},y=S;f.a.setStateAttributeConfig(x,y),i.a.createPrototypeObject(x,i.a.objectInherit(v.prototype,{getCompilerName:function(){return"CompilerOffsetTangent"},getOffsetDirection:function(){return this.getOrCreateModelTangent()}}),"osgUtil","CompilerOffsetTangent");var M=function(){_.a.apply(this,arguments),this.setShaderCompiler(x)};i.a.createPrototypeObject(M,i.a.objectInherit(_.a.prototype,{}),"osgUtil","ShaderGeneratorCompilerOffsetTangent");var T=function(){a.a.call(this),this._unifScale=c.a.createFloat(1,"uScale");var t=this._normalStateSet=new u.a;t.addUniform(c.a.createFloat3(d.f.fromValues(1,0,0),"uColorDebug")),t.addUniform(this._unifScale),t.setAttributeAndModes(new l.a(l.a.NEVER)),t.setShaderGeneratorName("debugNormal");var e=this._tangentStateSet=new u.a;e.addUniform(c.a.createFloat3(d.f.fromValues(0,1,0),"uColorDebug")),e.addUniform(this._unifScale),e.setAttributeAndModes(new l.a(l.a.NEVER)),e.setShaderGeneratorName("debugTangent")};T.CompilerOffsetNormal=v,T.CompilerOffsetTangent=x,T.ShaderGeneratorCompilerOffsetNormal=b,T.ShaderGeneratorCompilerOffsetTangent=M,i.a.createPrototypeObject(T,i.a.objectInherit(a.a.prototype,{setScale:function(t){this._unifScale.setFloat(t)},setTangentVisibility:function(t){this._tangentStateSet.setAttributeAndModes(new l.a(t?l.a.LESS:l.a.NEVER))},setNormalVisibility:function(t){this._normalStateSet.setAttributeAndModes(new l.a(t?l.a.LESS:l.a.NEVER))},apply:function(t){if(!t._isVisitedNormalDebug){if(t._isVisitedNormalDebug=!0,t instanceof n.a)return this._createDebugGeom(t,"Normal",this._normalStateSet),void this._createDebugGeom(t,"Tangent",this._tangentStateSet);this.traverse(t);for(var e=t.getUpdateCallbackList(),r=0,i=e.length;r<i;++r)e[r]instanceof m.a&&e[r].init(t)}},_createDoubleOffsetArray:function(t){for(var e=new Float32Array(2*t),r=0;r<t;++r)e[2*r]=1;return new s.a(s.a.ARRAY_BUFFER,e,1)},_createDoubledBufferArray:function(t){t.getInitialBufferArray&&(t=t.getInitialBufferArray());for(var e=t.getItemSize(),r=t.getElements(),i=r.length/e,a=r.constructor,n=new a(2*r.length),o=0;o<i;++o)for(var h=o*e,u=2*h,c=0;c<e;++c)n[u+c]=n[u+c+e]=r[h+c];return new s.a(s.a.ARRAY_BUFFER,n,e)},_addMorphTargets:function(t,e,r){var i=e.getMorphTargets();e.setName(t.getName());for(var a=t.getMorphTargets(),s=0,o=a.length;s<o;++s){var h=a[s],u=h.getVertexAttributeList(),c=new n.a;c.setName(h.getName());var l=c.getVertexAttributeList();l.Vertex=this._createDoubledBufferArray(u.Vertex),u[r]&&(l[r]=this._createDoubledBufferArray(u[r])),i.push(c)}return e.mergeChildrenVertexAttributeList(),e},_createDebugGeom:function(t,e,r){var i=t.getAttributes(),a=i[e];if(a){var s=i.Vertex;if(s){var u;t instanceof p.a?u=t:t.getSourceGeometry&&t.getSourceGeometry()instanceof p.a&&(u=t.getSourceGeometry());var c=s.getElements().length/s.getItemSize(),l=u?new p.a:new n.a;l.getAttributes().Vertex=this._createDoubledBufferArray(s),l.getAttributes().Offset=this._createDoubleOffsetArray(c),l.getAttributes()[e]=this._createDoubledBufferArray(a),l.getPrimitives().push(new o.a(h.a.LINES,0,2*c)),u&&this._addMorphTargets(u,l,e);var d;if(t instanceof g.a){var _=new g.a;_.setSourceGeometry(l),_.getVertexAttributeList().Bones=this._createDoubledBufferArray(i.Bones),_.getVertexAttributeList().Weights=this._createDoubledBufferArray(i.Weights),_._rigTransformImplementation=t._rigTransformImplementation,_._stateSetAnimation=t._stateSetAnimation,_.mergeChildrenData(),d=_}else d=l;var f=t.getParents(),m=f.length;d._isVisitedNormalDebug=!0,d._isNormalDebug=!0,d.setStateSet(r);for(var v=0;v<m;++v)f[v].addChild(d);return d}}}}),"osgUtil","DisplayNormalVisitor"),e.a=T},function(t,e,r){"use strict";var i=r(2),a=r(228),n=r(230),s=r(93),o=r(119),h=r(120),u=function(){this._nodes=new window.Map,this.extractFunctions(o.a,"lights.glsl"),this.extractFunctions(o.a,"lightCommon.glsl"),this.extractFunctions(o.a,"skinning.glsl"),this.extractFunctions(o.a,"morphing.glsl"),this.extractFunctions(o.a,"billboard.glsl"),this.extractFunctions(o.a,"functions.glsl"),this.extractFunctions(o.a,"textures.glsl"),this.extractFunctions(h.a,"shadowCast.glsl"),this.extractFunctions(h.a,"shadowReceive.glsl"),this.registerNodes(a.a),this.registerNodes(n.a)};u.prototype={registerNodes:function(t){for(var e in t)this.registerNode(e,t[e])},registerNode:function(t,e){this._nodes.has(t)&&i.a.warn("Node "+t+" already registered"),this._nodes.set(t,e)},extractFunctions:function(t,e){this.registerNodes(s.a.extractFunctions(t,e))},getNode:function(t){var e=this._nodes.get(t);if(!e)return void i.a.warn("Node "+t+" does not exist");var r=window.Object.create(e.prototype);return e.apply(r,Array.prototype.slice.call(arguments,1)),r}};var c=new u;e.a=c},function(t,e,r){"use strict";var i=r(58),a=r(157),n=function(){i.a.apply(this,arguments),this.setShaderCompiler(a.a)};n.prototype=i.a.prototype,e.a=n},function(t,e,r){"use strict";var i=r(0),a=r(59),n=function(){a.a.apply(this,arguments)},s=a.a.cloneStateAttributeConfig(a.a);s.attribute=["ShadowCast","Morph","Skinning","PointSize"],a.a.setStateAttributeConfig(n,s),i.a.createPrototypeObject(n,i.a.objectInherit(a.a.prototype,{getCompilerName:function(){return"ShadowCast"},initAttributes:function(){for(var t=this._attributes,e=0,r=t.length;e<r;e++){var i=t[e].className();"ShadowCastAttribute"===i?this._shadowCastAttribute=t[e]:"Billboard"===i?this._isBillboard=!!t[e]:"SkinningAttribute"===i?this._skinningAttribute=t[e]:"MorphAttribute"===i?this._morphAttribute=t[e]:"PointSizeAttribute"===i&&(this._pointSizeAttribute=t[e])}},registerTextureAttributes:function(){},createShadowCastDepth:function(t){var e=this._shadowCastAttribute.getDefines();return this.getNode("ShadowCast").inputs({shadowDepthRange:this.getOrCreateUniform("vec4","uShadowDepthRange"),fragEye:this.getOrCreateViewVertex()}).outputs({result:t}).getDefines=function(){return e},t},createFragmentShaderGraph:function(){var t=this.getNode("glFragColor");return[this.createShadowCastDepth(t)]}}),"osgShader","CompilerShadowCast"),e.a=n},function(t,e,r){"use strict";var i=r(0),a=r(3),n=r(11),s=r(45),o=r(6),h=r(17),u=r(1),c=r(58),l=r(59),d=r(13),_=r(20),f=r(9),g=r(16),p=r(31),m=function(){l.a.apply(this,arguments)},v=l.a.cloneStateAttributeConfig(l.a);v.textureAttribute=[],v.attribute=["PointSize","Morph","Skinning"],l.a.setStateAttributeConfig(m,v),i.a.createPrototypeObject(m,i.a.objectInherit(l.a.prototype,{getCompilerName:function(){return"CompilerDebugGeometry"},initTextureAttributes:function(){},createFragmentShaderGraph:function(){var t=this.getNode("glFragColor");return this.getNode("SetAlpha").inputs({color:this.getOrCreateUniform("vec3","uColorDebug"),alpha:this.createVariable("float").setValue("1.0")}).outputs({result:t}),[t]}}),"osgUtil","CompilerColorGeometry");var S=function(){c.a.apply(this,arguments),this.setShaderCompiler(m)};i.a.createPrototypeObject(S,i.a.objectInherit(c.a.prototype,{}),"osgUtil","ShaderGeneratorCompilerColorGeometry");var b=function(){l.a.apply(this,arguments)},x=l.a.cloneStateAttributeConfig(l.a);x.textureAttribute=[],l.a.setStateAttributeConfig(b,x),i.a.createPrototypeObject(b,i.a.objectInherit(l.a.prototype,{getCompilerName:function(){return"CompilerDebugSkinning"},initTextureAttributes:function(){},createFragmentShaderGraph:function(){var t=this.getNode("glFragColor");return this.getNode("SetAlpha").inputs({color:this.getOrCreateVarying("vec3","vBonesColor"),alpha:this.createVariable("float").setValue("1.0")}).outputs({result:t}),[t]},declareVertexVaryings:function(t){var e=this.getOrCreateVarying("vec3","vBonesColor");return this.getNode("SetFromNode").inputs(this.getOrCreateAttribute("vec3","BonesColor")).outputs(e),l.a.prototype.declareVertexVaryings.call(this,t)}}),"osgUtil","CompilerColorSkinning");var y=function(){c.a.apply(this,arguments),this.setShaderCompiler(b)};i.a.createPrototypeObject(y,i.a.objectInherit(c.a.prototype,{}),"osgUtil","ShaderGeneratorCompilerColorSkinning");var M=function(){a.a.call(this),this._debugColor=!0,this._debugSkinning=!1,this._stCenter=new h.a,this._stCenter.setShaderGeneratorName("debugGeometry")};M.CompilerColorGeometry=m,M.ShaderGeneratorCompilerColorGeometry=S,M.CompilerSkinningGeometry=b,M.ShaderGeneratorCompilerColorSkinning=y,i.a.createPrototypeObject(M,i.a.objectInherit(a.a.prototype,{setGeometryDebug:function(t){this._stCenter.setAttributeAndModes(new p.a(p.a.ALWAYS)),this._debugColor=!0,this._debugSkinning=!1,this.apply(t)},setSkinningDebug:function(t){this._stCenter.setAttributeAndModes(new p.a(p.a.NEVER)),this._debugColor=!1,this._debugSkinning=!0,this.apply(t)},disableDebug:function(t){this._stCenter.setAttributeAndModes(new p.a(p.a.NEVER)),this._debugColor=!1,this._debugSkinning=!1,this.apply(t)},_debugCenterGeometry:function(t,e){var r=t.getBound(),i=new Float32Array(18),a=.1*r.radius();i[0]=a,i[3]=-a,i[7]=a,i[10]=-a,i[14]=a,i[17]=-a;var s=new n.a;s.getAttributes().Vertex=new d.a(d.a.ARRAY_BUFFER,i,3);var h=new _.a(f.a.LINES,0,6);s.getPrimitives().push(h);var c=new g.a,l=r.center();c.getMatrix()[12]=l[0],c.getMatrix()[13]=l[1],c.getMatrix()[14]=l[2],c.addChild(s),this.nodePath[this.nodePath.length-2].addChild(c),e=u.f.fromValues(.8*e[0],.8*e[1],.8*e[2]),s.getOrCreateStateSet().addUniform(o.a.createFloat3(e,"uColorDebug")),c.setStateSet(this._stCenter),c._isCenterDebug=!0},_debugRigGeometry:function(t){var e=t.getVertexAttributeList();if(!e.BonesColor){for(var r=e.Bones.getElements(),i=e.Weights.getElements(),a=t._rigTransformImplementation._bones,n=r.length/4,s=new Float32Array(3*n),o=0;o<n;++o){var h=4*o,u=a[r[h]].getOrCreateDebugColor(),c=a[r[h+1]].getOrCreateDebugColor(),l=a[r[h+2]].getOrCreateDebugColor(),_=a[r[h+3]].getOrCreateDebugColor(),f=i[h],g=i[h+1],p=i[h+2],m=i[h+3],v=3*o;s[v]=f*u[0]+g*c[0]+p*l[0]+m*_[0],s[v+1]=f*u[1]+g*c[1]+p*l[1]+m*_[1],s[v+2]=f*u[2]+g*c[2]+p*l[2]+m*_[2]}e.BonesColor=new d.a(d.a.ARRAY_BUFFER,s,3)}},_debugGeometry:function(t){var e=this._debugColor,r=this._debugSkinning&&t instanceof s.a;if(!e&&!r)return void(void 0!==t._originalStateSet&&t.setStateSet(t._originalStateSet||void 0));void 0===t._originalStateSet&&(t._originalStateSet=t.getStateSet()||null);var i=new h.a;if(t.setStateSet(i),r)return i.setShaderGeneratorName("debugSkinning"),void this._debugRigGeometry(t);var a=u.f.fromValues(Math.random(),Math.random(),Math.random());i.addUniform(o.a.createFloat3(a,"uColorDebug")),i.setShaderGeneratorName("debugGeometry"),this._debugCenterGeometry(t,a)},apply:function(t){t._isNormalDebug||t._isCenterDebug||(t instanceof n.a&&this._debugGeometry(t),this.traverse(t))}}),"osgUtil","GeometryColorDebugVisitor"),e.a=M},function(t,e,r){"use strict";var i=r(0),a=r(3),n=r(34),s=function(t){a.a.call(this,a.a.TRAVERSE_ALL_CHILDREN),this._selectables=t,this._nodeList=[],this._linkList=[],this._uniqueNodes=new window.Set,this._uniqueEdges=new window.Set};i.a.createPrototypeObject(s,i.a.objectInherit(a.a.prototype,{getColorFromClassName:function(t){switch(t){case"ShadowedScene":return"#3D3D3D";case"Camera":return"#AB7BCF";case"RenderBin":return"#59778B";case"LightSource":return"#53967D";case"RenderStage":return"#DDCC55";case"RenderLeaf":case"Geometry":return"#FFCC55";case"RigGeometry":return"#DD8800";case"MorphGeometry":return"#AA5500";case"MatrixTransform":return"#CE697E";case"StateSet":return"#0099FF";case"StateGraph":case"Skeleton":return"#96999E";case"Bone":return"#A9DEAA";case"Node":return"#FFFFFF";default:return"#FF00AA"}},createGraph:function(t){this.reset(),t.accept(this)},reset:function(){this._nodeList.length=0,this._linkList.length=0,this._uniqueNodes.clear(),this._uniqueEdges.clear()},apply:function(t){if(!t._isNormalDebug){if(this._uniqueNodes.has(t.getInstanceID())||(this._uniqueNodes.add(t.getInstanceID()),this._nodeList.push(t)),this.nodePath.length>=2){var e=this.nodePath[this.nodePath.length-2].getInstanceID(),r=t.getInstanceID(),i=e+"+"+r;this._uniqueEdges.has(i)||(this._linkList.push({parentNode:e,childrenNode:r}),this._uniqueEdges.add(i))}this.traverse(t)}},createMatrixGrid:function(t,e){var r="";return r+="<table><tr><td>"+e[0]+"</td>",r+="<td>"+e[4]+"</td>",r+="<td>"+e[8]+"</td>",r+="<td>"+e[12]+"</td></tr>",r+="<tr><td>"+e[1]+"</td>",r+="<td>"+e[5]+"</td>",r+="<td>"+e[9]+"</td>",r+="<td>"+e[13]+"</td></tr>",r+="<tr><td>"+e[2]+"</td>",r+="<td>"+e[6]+"</td>",r+="<td>"+e[10]+"</td>",r+="<td>"+e[14]+"</td></tr>",r+="<tr><td>"+e[3]+"</td>",r+="<td>"+e[7]+"</td>",r+="<td>"+e[11]+"</td>",r+="<td>"+e[15]+"</td></tr></table>"},getLabel:function(t){var e=t.className()+" ("+t.getInstanceID()+")";return t.getName&&t.getName()&&(e+="\n"+t.getName()),e},generateNode:function(t,e){var r="";e.getMatrix&&e.getMatrix()&&(r+="<br /><br />"+this.createMatrixGrid(e,e.getMatrix())),this._selectables.set(e.getInstanceID().toString(),e),t.addNode(e.getInstanceID(),{label:this.getLabel(e),description:r,style:"fill: "+this.getColorFromClassName(e.className())+";stroke-width: 0px;"})},generateStateSet:function(t,e){var r=e.getStateSet(),i=r.getInstanceID(),a=this.getLabel(r);a+="\nNbTexture : "+r.getNumTextureAttributeLists(),t.hasNode(i)||(this._selectables.set(i.toString(),r),t.addNode(i,{label:a,style:"fill: "+this.getColorFromClassName(r.className())+";stroke-width: 0px;"})),t.addEdge(null,e.getInstanceID(),i,{style:"stroke: "+this.getColorFromClassName(r.className())+";"})},generateSourceGeometry:function(t,e){var r=e.getSourceGeometry(),i=r.getInstanceID();this._selectables.set(i.toString(),r),t.addNode(i,{label:this.getLabel(r),style:"fill: "+this.getColorFromClassName(r.className())+";stroke-width: 0px;"}),t.addEdge(null,e.getInstanceID(),i,{style:"stroke: "+this.getColorFromClassName(r.className())+";"})},generateNodeAndLink:function(t){for(var e=0,r=this._nodeList.length;e<r;e++){var i=this._nodeList[e];this.generateNode(t,i),i.getStateSet()&&this.generateStateSet(t,i),i.getSourceGeometry&&i.getSourceGeometry()instanceof n.a&&this.generateSourceGeometry(t,i)}for(var a=0,s=this._linkList.length;a<s;a++)t.addEdge(null,this._linkList[a].parentNode,this._linkList[a].childrenNode)}}),"osgUtil","DisplayGraphNode"),e.a=s},function(t,e,r){"use strict";var i=r(0),a=r(5),n=r(135),s=function(){a.a.call(this),this._databasePager=new n.a,this._sceneData=void 0};i.a.createPrototypeObject(s,i.a.objectInherit(a.a.prototype,{getSceneData:function(){return this._sceneData},setSceneData:function(t){this._sceneData=t},setDatabasePager:function(t){this._databasePager=t},getDatabasePager:function(){return this._databasePager},updateSceneGraph:function(t){this._databasePager&&this._databasePager.updateSceneGraph(t.getFrameStamp()),this._sceneData&&this._sceneData.accept(t)}}),"osgViewer","Scene"),e.a=s},function(t,e,r){"use strict";var i,a,n,s=r(13),o=r(11),h=r(9),u=r(20),c=r(18),l=r(21),d=r(26),_=["#ifdef GL_ES","precision highp float;","#endif"].join("\n"),f=function(){if(i)return i;var t="#define SHADER_NAME GizmoLine3D",e=[_,"attribute vec3 Vertex;","uniform mat4 uModelViewMatrix;","uniform mat4 uProjectionMatrix;",t,"","void main(void) {","  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex, 1.0);","}"].join("\n"),r=[_,"uniform vec4 uColor;",t,"","void main(void) {","  gl_FragColor = uColor;","}"].join("\n");return i=new l.a(new d.a(d.a.VERTEX_SHADER,e),new d.a(d.a.FRAGMENT_SHADER,r))},g=function(){if(a)return a;var t="#define SHADER_NAME GizmoLine2D",e=[_,"attribute vec2 Vertex;",t,"","void main(void) {","  gl_Position = vec4(Vertex, 0.0, 1.0);","}"].join("\n"),r=[_,t,"","void main(void) {","  gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);","}"].join("\n");return a=new l.a(new d.a(d.a.VERTEX_SHADER,e),new d.a(d.a.FRAGMENT_SHADER,r))},p=function(){if(n)return n;var t="#define SHADER_NAME GizmoQuadCircle",e=[_,"attribute vec3 Vertex;","uniform mat4 uModelViewMatrix;","uniform mat4 uProjectionMatrix;","varying vec3 vViewVertex;",t,"","void main(void) {","  vViewVertex = Vertex;","  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex, 1.0);","}"].join("\n"),r=[_,"uniform float uAngle;","uniform vec3 uBase;","varying vec3 vViewVertex;","const float PI = 3.14159265358979323846264;","const float PI2 = PI * 2.0;",t,"","void main(void) {","  if(length(vViewVertex) > 0.5)","    discard;","  vec3 vn = normalize(vViewVertex);","  float angle = atan(uBase.y * vn.x - uBase.x * vn.y, dot(uBase, vn));","  if(angle > 0.0) {","    if(uAngle >= 0.0 && angle > uAngle) discard;","    if(uAngle < -PI && angle < uAngle + PI2) discard;","    if(uAngle < 0.0 && uAngle > -PI) discard;","  }","  if(angle < 0.0) {","    if(uAngle <= 0.0 && angle < uAngle) discard;","    if(uAngle > PI && angle > uAngle - PI2) discard;","    if(uAngle > 0.0 && uAngle < PI) discard;","  }","  gl_FragColor = vec4(1.0, 1.0, 0.0, 0.5);","}"].join("\n");return n=new l.a(new d.a(d.a.VERTEX_SHADER,e),new d.a(d.a.FRAGMENT_SHADER,r))},m=function(){i=void 0,a=void 0,n=void 0},v=function(){var t=new o.a;t.getAttributes().Vertex=new s.a(s.a.ARRAY_BUFFER,new Float32Array(4),2);var e=new u.a(h.a.LINES,0,2);return t.getPrimitives().push(e),t.getOrCreateStateSet().setAttributeAndModes(g()),t},S=function(t,e,r,i,a){var n=void 0!==t?t:1,u=void 0!==e?e:.2,l=void 0!==r?r:6,d=void 0!==i?i:64,_=void 0!==a?a:2*Math.PI,g=(l+1)*(d+1),p=l*d*2,m=new o.a,v=new Float32Array(3*g),S=new Uint16Array(3*p);_=_||2*Math.PI;var b=0,x=0,y=0,M=0;for(M=0;M<=l;++M)for(y=0;y<=d;++y){var T=y/d*_,A=M/l*Math.PI*2;x=3*b,v[x]=(n+u*Math.cos(A))*Math.cos(T),v[x+1]=(n+u*Math.cos(A))*Math.sin(T),v[x+2]=u*Math.sin(A),b++}for(b=0,M=1;M<=l;++M)for(y=1;y<=d;++y)x=6*b,S[x]=(d+1)*M+y-1,S[x+1]=S[x+3]=(d+1)*(M-1)+y-1,S[x+2]=S[x+5]=(d+1)*M+y,S[x+4]=(d+1)*(M-1)+y,b++;return m.getAttributes().Vertex=new s.a(s.a.ARRAY_BUFFER,v,3),m.getOrCreateStateSet().setAttributeAndModes(f()),m.getPrimitives().push(new c.a(h.a.TRIANGLES,new s.a(s.a.ELEMENT_ARRAY_BUFFER,S,1))),m},b=function(t,e,r,i,a,n,u){var l=void 0!==t?t:1,d=void 0!==e?e:1,_=void 0!==r?r:5,g=void 0!==i?i:32,p=void 0!==a?a:1,m=void 0===n||n,v=void 0===u||u;m=m&&l>0,v=v&&d>0;var S=.5*_,b=(p+1)*(g+1),x=p*g*2;m&&(b+=1,x+=g),v&&(b+=1,x+=g);var y=new o.a,M=new Float32Array(3*b),T=new Uint16Array(3*x),A=0,C=0,I=0,w=0;for(I=0;I<=p;I++){var E=I/p,N=E*(d-l)+l;for(w=0;w<=g;w++){var R=w/g;C=3*A,M[C]=N*Math.sin(R*Math.PI*2),M[C+1]=N*Math.cos(R*Math.PI*2),M[C+2]=-E*_+S,A++}}for(A=0,w=0;w<g;w++)for(I=0;I<p;I++)C=6*A,T[C]=(g+1)*I+w,T[C+1]=T[C+3]=(g+1)*(I+1)+w,T[C+2]=T[C+5]=(g+1)*I+w+1,T[C+4]=(g+1)*(I+1)+w+1,A++;A*=2;var O;if(m)for(O=(v?M.length-6:M.length-3)/3,M[3*O+2]=S,w=0;w<g;w++)C=3*A,T[C]=w,T[C+1]=w+1,T[C+2]=O,A++;if(v){O=(M.length-3)/3,M[3*O+2]=-S;var F=(g+1)*I;for(w=0;w<g;w++)C=3*A,T[C]=F+w+1,T[C+1]=F+w,T[C+2]=O,A++}return y.getAttributes().Vertex=new s.a(s.a.ARRAY_BUFFER,M,3),y.getOrCreateStateSet().setAttributeAndModes(f()),y.getPrimitives().push(new c.a(h.a.TRIANGLES,new s.a(s.a.ELEMENT_ARRAY_BUFFER,T,1))),y},x=function(t,e,r){for(var i=new o.a,a=new Float32Array(3*t),n=r||2*Math.PI,c=0;c<t;++c){var l=3*c,d=n*c/t;a[l]=Math.cos(d)*e,a[l+1]=Math.sin(d)*e}i.getAttributes().Vertex=new s.a(s.a.ARRAY_BUFFER,a,3);var _=new u.a(h.a.LINE_STRIP,0,t);return i.getOrCreateStateSet().setAttributeAndModes(f()),i.getPrimitives().push(_),i},y=function(t,e){var r=t?.5*t:.5,i=e?.5*e:.5,a=new o.a,n=new Float32Array(12);n[0]=-r,n[1]=-i,n[3]=r,n[4]=-i,n[6]=-r,n[7]=i,n[9]=r,n[10]=i,a.getAttributes().Vertex=new s.a(s.a.ARRAY_BUFFER,n,3);var c=new u.a(h.a.TRIANGLE_STRIP,0,4);return a.getOrCreateStateSet().setAttributeAndModes(f()),a.getPrimitives().push(c),a},M=function(){var t=y();return t.getOrCreateStateSet().setAttributeAndModes(p()),t},T={};T.createCircleGeometry=x,T.createCylinderGeometry=b,T.createTorusGeometry=S,T.createDebugLineGeometry=v,T.createPlaneGeometry=y,T.createQuadCircleGeometry=M,T.resetPrograms=m,e.a=T},function(t,e,r){"use strict";var i=r(0),a=r(29),n=r(15),s=r(42),o=r(31),h=r(16),u=r(21),c=r(26),l=r(23),d=r(7),_=r(1),f=r(163),g=r(164),p=r(98),m=r(165),v=r(56),S=r(57),b=r(35),x=r(24),y=r(10),M=function(){var t=["attribute vec4 Vertex;","uniform mat4 uModelViewMatrix;","uniform mat4 uProjectionMatrix;","","varying vec2 vTexCoord0;","","void main(void) {","  vTexCoord0 = Vertex.zw;","  gl_Position = uProjectionMatrix * (uModelViewMatrix * vec4(Vertex.xy,0.0, 1.0));","}"].join("\n"),e=["#define SHADER_NAME STATS","varying vec2 vTexCoord0;","uniform sampler2D Texture0;","void main(void) {","  vec4 color = vec4(1.0);","  vec2 uv =  vTexCoord0;","  int isText = 0;","  if ( uv.y < 0.0 ) {","     isText = 1;","     uv.y = -uv.y;","  }","  if ( uv.y >= "+(f.a.backgroundColor-1).toFixed(1)+" ) {","     color = vec4(0.0,0.0,0.0,0.5);","     uv.y -= "+f.a.backgroundColor.toFixed(1)+";","  } else if ( uv.y >= "+(f.a.redColor-1).toFixed(1)+" ) {","     color = vec4(1.0,0.0,0.0,1.0);","     uv.y -= "+f.a.redColor.toFixed(1)+";","  } else if ( uv.y == "+(f.a.greyColor-1).toFixed(1)+" ) {","     color = vec4(0.5,0.5,0.5,1.0);","     uv.y -= "+f.a.greyColor.toFixed(1)+";","  } else {","     uv.y -= "+f.a.whiteColor.toFixed(1)+";","  }","  if ( isText == 1 ) {","     color *= texture2D( Texture0, uv.xy);","  }","  gl_FragColor = color;","}"].join("\n");return new u.a(new c.a("VERTEX_SHADER",t),new c.a("FRAGMENT_SHADER",e))},T=function(t,e){this._captionsBuffer=void 0,this._valuesBuffer=void 0,this._dirtyCaptions=!0,this._dirtyValues=!0,this._viewer=t,this._labelMaxWidth=0,this._viewport=t.getCamera().getViewport(),this._node=void 0,this._text=void 0,this._offsetGroup=void 0,this._counters={},this._groups={},this._updates=[],this._displayableCounters={},this._x=0,this._y=0,this._width=0,this._height=0,this._maxCaptionTextLength=32,this._lineFactor=1.1,this._displayFilter=[],this._backgroundWidth=0,this._backgroundHeight=0,this._bufferStats=new f.a,this._historyGraph={},this._graphToDisplay=[],this._valuesMaxWidth=72,this._showGraph=!1,this._backgroundPicking=b.a.createTexturedQuadGeometry(0,0,0,10,0,0,0,10,0),this._backgroundPicking.setName("osgStats-Background-picking"),this._dragStop=_.e.create(),this._dragStart=_.e.create(),this._startTransformation=_.c.create(),this._init(e)};i.a.createPrototypeObject(T,{getCounter:function(t){return this._counters[t]||(this._counters[t]=new g.a({caption:t,average:!0})),this._counters[t]},getBufferStats:function(){return this._bufferStats},addConfig:function(t){if(!t.init||t.init()){for(var e in t.values){var r=t.values[e],i=new g.a(r);this._counters[e]=i}if(t.groups)for(var a=0;a<t.groups.length;a++){var n=t.groups[a],s={caption:n.caption,values:n.values,textCursorY:new Float32Array(n.values.length)},o=n.name?n.name:n.caption;this._groups[o]=s}t.update&&this._updates.push(t.update)}},reset:function(){this._bufferStats.resetCaptions(),this._bufferStats.resetValues(),this._dirtyCaptions=!0,this._dirtyValue=!0,this._bufferStats.resize(this._bufferStats._maxNbVertexes)},update:function(){for(var t=0;t<this._updates.length;t++)this._updates[t](this);this._dirtyValues=!0,(this._checkViewportChanged()||this._checkCounterDisplayableChanged())&&(this._dirtyCaptions=!0),this._dirtyCaptions&&(this._bufferStats.resetCaptions(),this._generateCaptions(),this._dirtyCaptions=!1),this._dirtyValues&&(this._bufferStats.resetValues(),this._generateValues(),this._dirtyValues=!1)},getNode:function(){return this._node},setShowFilter:function(t){if(this._dirtyCaptions=!0,!t)return void(this._displayFilter.length=0);this._displayFilter=t.slice()},_init:function(t){var e=new n.a;e.setRenderOrder(n.a.POST_RENDER,0),e.setReferenceFrame(l.a.ABSOLUTE_RF),e.setClearMask(0);var r=new h.a;r.setName("StatsNode"),r.addChild(this._backgroundPicking),this._nodeTransform=r,this._backgroundPicking.setNodeMask(0),e.addChild(r),e.setName("osgStats"),e.setViewport(this._viewport),this._node=e,this._text=new m.a;var i=12;if(t){var u=t.getString("statsFilter");if(u){var c=u.split(";");this.setShowFilter(c)}var _=t.getNumber("statsFontSize");void 0!==_&&(i=_),this._showGraph=t.getBoolean("statsShowGraph")}var f=new d.default;f.setMinFilter(d.default.NEAREST),f.setMagFilter(d.default.NEAREST),this._text.setFontSize(i*this._viewer.getCanvasPixelRatio()),this._text.getCanvas().then(function(t){this._dirtyCaptions=!0;var e=this._bufferStats.getGeometry();e.setNodeMask(-32769),r.addChild(e),f.setImage(t),e.setBound(new x.a)}.bind(this)),r.getOrCreateStateSet().setAttributeAndModes(M()),r.getOrCreateStateSet().setAttributeAndModes(new s.a(s.a.DISABLE));var g=new a.a("SRC_ALPHA","ONE_MINUS_SRC_ALPHA");r.getOrCreateStateSet().setAttributeAndModes(g),r.getOrCreateStateSet().setAttributeAndModes(new o.a(o.a.DISABLE)),r.getOrCreateStateSet().setTextureAttributeAndModes(0,f);var p=this._viewer.getGraphicContext().canvas;this._canvas=p;var v=this._viewer.getInputManager();v.group(y.a.STATS).addMappings({onMouseMove:["mousemove","touchmove"],onMouseDown:["mousedown","touchstart"],onMouseUp:["mouseup","mouseout","touchend","touchcancel"]},this),v.setPriority(y.a.STATS,v.getHigherPriority(y.a.SCENE))},onMouseDown:function(t){var e=this.computeNearestIntersection(t);this._onStats=!!e.length,this._onStats&&(this._viewer.getInputManager().setEnable(y.a.SCENE,!1),_.c.copy(this._startTransformation,this._nodeTransform.getMatrix()),_.e.set(this._dragStart,t.canvasX,t.canvasY),this._dragStop[1]=this._dragStart[1])},onMouseMove:function(){var t=_.f.create();return function(e){if(this._onStats){_.e.set(this._dragStop,e.canvasX,e.canvasY);var r=this._dragStop[1]-this._dragStart[1];_.c.translate(this._nodeTransform.getMatrix(),this._startTransformation,_.f.set(t,0,-r,0))}}}(),onMouseUp:function(){this._viewer.getInputManager().setEnable(y.a.SCENE,!0),this._onStats=!1},computeNearestIntersection:function(){var t=new S.a,e=_.f.create(),r=_.f.create(),i=new v.a;return i.setIntersector(t),function(a){var n=a.glX,s=a.glY;t.reset(),t.set(_.f.set(e,n,s,0),_.f.set(r,n,s,1)),i.reset(),this._backgroundPicking.setNodeMask(32768),i.setTraversalMask(32768),this._node.accept(i);var o=t.getIntersections();return this._backgroundPicking.setNodeMask(0),o}}(),_updateBackgroundPicking:function(t,e,r,i){var a=this._backgroundPicking.getVertexAttributeList().Vertex.getElements();a[0]=t,a[1]=e+i,a[3]=t,a[4]=e,a[6]=t+r,a[7]=e,a[9]=t+r,a[10]=e+i,this._backgroundPicking.getVertexAttributeList().Vertex.dirty(),this._backgroundPicking.dirtyBound()},_generateCaptions:function(){var t=this._text.getCharacterHeight(),e=0,r=this._viewport.height()-t;this._labelMaxWidth=0,this._bufferStats.generateBackground(0,this._viewport.height()-this._backgroundHeight,this._backgroundWidth,this._backgroundHeight),this._updateBackgroundPicking(0,this._viewport.height()-this._backgroundHeight,this._backgroundWidth,this._backgroundHeight);var i=this._displayFilter;for(var a in this._groups)if(!a||!i.length||-1!==i.indexOf(a)){var n=this._groups[a],s="--- "+n.caption+" ---",o=this._bufferStats.generateText(e,r,s,this._text,f.a.whiteColor);this._labelMaxWidth=Math.max(o,this._labelMaxWidth),e=0,r-=this._lineFactor*t;for(var h=0;h<n.values.length;h++){var u=n.values[h],c=this._counters[u];if(c&&c.isDisplayable()){n.textCursorY[h]=r;for(var l=c._caption,d=l.length/this._maxCaptionTextLength,_=0;_<d;_++){var g=_*this._maxCaptionTextLength,p=l.substr(g,this._maxCaptionTextLength);o=this._bufferStats.generateText(e,r,p,this._text,f.a.whiteColor),this._labelMaxWidth=Math.max(o,this._labelMaxWidth),r-=t,e=0}}}r-=t}this._bufferStats.captionsEnd()},_generateValues:function(){var t,e=this._text.getCharacterWidth(),r=this._labelMaxWidth+2*e,i=this._valuesMaxWidth+2*e,a=this._text.getCharacterHeight(),n=r,s=this._displayFilter,o=0;for(var h in this._groups)if(!h||!s.length||-1!==s.indexOf(h)){var u=this._groups[h];n=r;for(var c=0;c<u.values.length;c++){var l=u.values[c],d=this._counters[l];if(d&&d.isDisplayable()){var _,g=d.getAverageMs()?d.getAverageValue():d.getValue();_=Number.isInteger(g)?g.toString():g.toFixed(2),t=u.textCursorY[c];var m=f.a.whiteColor,v=d.getOver(),S=d.getBelow();0!==v?m=g>v?f.a.redColor:m:0!==S&&(m=g<S?f.a.redColor:m);var b=this._bufferStats.generateText(n,t,_,this._text,m);o=Math.max(b,o),this._showGraph&&d._graph&&(this._historyGraph[l]||(this._historyGraph[l]=new p.a),this._graphToDisplay.push(this._historyGraph[l]),this._historyGraph[l].setDisplayPosition(r+i,t),this._historyGraph[l].addValue(g,m)),n=r}}}this._bufferStats.valuesEnd(),this._valuesMaxWidth=o;for(var x=0;x<this._graphToDisplay.length;x++){var y=this._graphToDisplay[x];this._bufferStats.generateGraph(y,a-2)}var M=r+i;this._graphToDisplay.length&&(M+=2*p.a.maxGraphValue+1);var T=this._viewport.height()-t;this._backgroundWidth===M&&this._backgroundHeight===T||(this._backgroundWidth=M,this._backgroundHeight=T,this._dirtyCaptions=!0),this._graphToDisplay.length=0,this._bufferStats.graphsEnd(),this._bufferStats.update()},_checkCounterDisplayableChanged:function(){var t=!1;for(var e in this._counters){var r=this._counters[e];this._displayableCounters[e]!==r.isDisplayable()&&(this._displayableCounters[e]=r.isDisplayable(),t=!0)}return t},_checkViewportChanged:function(){var t=this._viewport.x(),e=this._viewport.y(),r=this._viewport.width(),i=this._viewport.height();if(t!==this._x||e!==this._y||r!==this._width||i!==this._height){this._x=t,this._y=e,this._width=r,this._height=i;var a=this._node;return _.c.ortho(a.getProjectionMatrix(),this._x,this._width,this._y,this._height,-5,5),!0}return!1}}),e.a=T},function(t,e,r){"use strict";var i=r(0),a=r(13),n=r(11),s=r(9),o=r(18),h=r(20),u=r(2),c=r(98),l=function(){this._usageHint=a.a.DYNAMIC_DRAW;this._nbVertexes=0,this._maxNbVertexes=0,this._captionNbVertexes=0,this._valuesNbVertexes=0,this._graphsNbVertexes=0,this.resize(6560)};l.backgroundColor=10,l.redColor=7,l.greyColor=4,l.whiteColor=1,i.a.createPrototypeObject(l,{getGeometry:function(){return this._geometry},generateBackground:function(t,e,r,i){var a=this._vertexes;this._nbVertexes+=4,a[0]=t,a[1]=e,a[2]=0,a[3]=l.backgroundColor;var n=t+r,s=e+i;a[4]=t,a[5]=s,a[6]=0,a[7]=l.backgroundColor,a[8]=n,a[9]=s,a[10]=0,a[11]=l.backgroundColor,a[12]=n,a[13]=e,a[14]=0,a[15]=l.backgroundColor},generateCharacter:function(t,e,r,i,a,n,s){var o=this._vertexes,h=this._nbVertexes;this._nbVertexes+=4;var u=4*h;o[u++]=t,o[u++]=e,o[u++]=a,o[u++]=-(0+s);var c=t+r,l=e+i;o[u++]=t,o[u++]=l,o[u++]=a,o[u++]=-(1+s),o[u++]=c,o[u++]=l,o[u++]=n,o[u++]=-(1+s),o[u++]=c,o[u++]=e,o[u++]=n,o[u++]=-(0+s)},generateText:function(t,e,r,i,a){var n=r.length;this._nbVertexes+4*n>=this._maxNbVertexes&&this.resize(2*this._maxNbVertexes);for(var s=i._characterSizeUV,o=i._characterWidth,h=i._characterHeight,u=0;u<n;u++){var c=r.charCodeAt(u),l=i.getCharacterUV(c);this.generateCharacter(t,e,o,h,l,l+s,a),t+=o}return n*o},generateGraph:function(t,e){this._nbVertexes+2*c.a.maxGraphValue>=this._maxNbVertexes&&this.resize(2*this._maxNbVertexes);var r=this._vertexes,i=this._nbVertexes,a=t.getValues(),n=a.length,s=t.getIndex(),o=t.getX(),h=t.getY();this._nbVertexes+=2*n;for(var u=0;u<n;u++){var d=(s+u)%n,_=a[d],f=i+2*u,g=4*f,p=_,m=l.greyColor;p>=l.redColor&&(m=l.redColor,p-=l.redColor),p>1&&(p=1),p*=e,p<1&&(p=1),r[g]=o+2*u,r[g+1]=h,r[g+2]=0,r[g+3]=m,r[g+4]=o+2*u,r[g+5]=h+p,r[g+6]=0,r[g+7]=m}},resize:function(t){u.a.log("resize buffer to "+t),this._maxNbVertexes=t;var e=new Float32Array(4*t);this._vertexes&&e.set(this._vertexes),this._vertexes=e;var r=Math.ceil(t/4);this._indexes=new Uint16Array(6*r);for(var i=0,c=0;i<r;i++)this._indexes[c++]=4*i+0,this._indexes[c++]=4*i+1,this._indexes[c++]=4*i+3,this._indexes[c++]=4*i+3,this._indexes[c++]=4*i+1,this._indexes[c++]=4*i+2;if(this._geometry)return this._geometry.getAttributes().Vertex.setElements(this._vertexes),void this._characterPrimitive.getIndices().setElements(this._indexes);this._geometry=new n.a,this._geometry.setName("osgStats-Stats"),this._geometry.getAttributes().Vertex=new a.a(a.a.ARRAY_BUFFER,this._vertexes,4,!0);var l=new a.a(a.a.ELEMENT_ARRAY_BUFFER,this._indexes,1);this._geometry.getAttributes().Vertex.setUsage(this._usageHint);var d=new o.a(s.a.TRIANGLES,l);this._characterPrimitive=d,this._geometry.getPrimitives().push(this._characterPrimitive);var _=new h.a(s.a.LINES,0,0);this._graphPrimitive=_,this._geometry.getPrimitives().push(this._graphPrimitive)},update:function(){var t=this._captionNbVertexes+this._valuesNbVertexes;this._characterPrimitive.setCount(t/4*6),this._graphPrimitive.setCount(this._graphsNbVertexes),this._graphPrimitive.setFirst(t),this._geometry.getAttributes().Vertex.dirty()},resetCaptions:function(){this._nbVertexes=0,this._captionNbVertexes=0},resetValues:function(){this._nbVertexes=this._captionNbVertexes,this._valuesNbVertexes=0,this._graphsNbVertexes=0},captionsEnd:function(){this._captionNbVertexes=this._nbVertexes},valuesEnd:function(){this._valuesNbVertexes=this._nbVertexes-this._captionNbVertexes},graphsEnd:function(){this._graphsNbVertexes=this._nbVertexes-(this._valuesNbVertexes+this._captionNbVertexes)},getCharacterPrimitive:function(){return this._characterPrimitive},getGraphPrimitive:function(){return this._graphPrimitive},getNbVertexes:function(){return this._nbVertexes}}),e.a=l},function(t,e,r){"use strict";var i=r(0),a=window.performance,n=function(t){this._caption=t.caption,this._accumValue=0,this._accumSamples=0,this._accumStart=0,this._value=0,this._averageValue=0,this._time=0,this._avgMs=0,this._over=t.over>0?t.over:0,this._below=t.below>0?t.below:0,this._graph=!!t.graph,t.average&&(this._avgMs=t.avgMs?t.avgMs:1e3),this._display=!1};i.a.createPrototypeObject(n,{isDisplayable:function(){return this._display},setDisplayable:function(t){this._display=t},getOver:function(){return this._over},getBelow:function(){return this._below},getGraph:function(){return this._graph},getAverageMs:function(){return this._avgMs},getAverageValue:function(){return this._averageValue},getValue:function(){return this._value},average:function(t){if(this._avgMs){this._accumValue+=t,this._accumSamples++;var e=a.now();e-this._accumStart>this._avgMs&&(this._averageValue=this._accumValue/this._accumSamples,this._accumValue=0,this._accumStart=e,this._accumSamples=0)}},start:function(){this._display=!0,this._time=a.now()},end:function(){this._value=a.now()-this._time,this.average(this._value)},set:function(t){this._display=!0,this._value=t,this.average(t)},tick:function(){this.end(),this.start()},frame:function(){var t=a.now()-this._time;this.set(1e3/t),this.start()}}),e.a=n},function(t,e,r){"use strict";var i=r(0),a=r(14),n=r.n(a),s=r(2),o=function(t){var e=document.getElementsByTagName("body")[0],r=document.createElement("div"),i=document.createTextNode("M");r.appendChild(i),r.setAttribute("style",t),e.appendChild(r);var a=r.offsetHeight;return e.removeChild(r),a},h=function(t){return new n.a(function(e,r){window.WebFontConfig={google:{families:[t+":200"]},active:function(){e(t)},inactive:function(t){r("loadFont error:"+t)}};var i=document.createElement("script"),a=document.scripts[0];i.src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js",i.async=!0,i.onerror=function(){r()},a.parentNode.insertBefore(i,a)})},u=function(){this._canvas=void 0,this._characterHeight=0,this._characterWidth=0,this._fontSize=16,this._fontFamily="Source Code Pro",this._characterFirstCode=" ".charCodeAt(),this._characterLastCode="z".charCodeAt(),this._characterSizeUV=0,this._backgroundColor="rgba(0,0,0,0.0)",this._createCanvas()};i.a.createPrototypeObject(u,{setFontSize:function(t){this._fontSize=t},getCharacterWidth:function(){return this._characterWidth},getCharacterHeight:function(){return this._characterHeight},getCanvas:function(){return this._promise},getCharacterUV:function(t){return(t-this._characterFirstCode)*this._characterSizeUV},_fillCanvas:function(t,e){var r=e+"px",i="font-family: "+t+"; font-size: "+r+";",a=o(i);s.a.debug(t+" "+r+" ==> "+a+" pixels high."),this._characterHeight=Math.ceil(a);var n=e+"px '"+t+"'",h=document.createElement("canvas"),u=h.getContext("2d");this._canvas=h,u.font=n,u.textBaseline="middle",this._characterWidth=u.measureText(" ").width,this._characterWidth=Math.ceil(this._characterWidth);var c=this._characterLastCode-this._characterFirstCode+1;s.a.info("Stats character size "+this._characterWidth+" x "+this._characterHeight+" texture width "+this._characterWidth*c),h.width=Math.ceil(this._characterWidth*c),h.height=this._characterHeight,this._characterSizeUV=this._characterWidth/h.width,u.font=n,u.textBaseline="middle",u.fillStyle="rgb(255,255,255)";for(var l=this._characterFirstCode,d=0;l<=this._characterLastCode;l++,d++){var _=String.fromCharCode(l),f=d*this._characterWidth,g=this._characterHeight/2;u.fillText(_,f,g)}return h},_createCanvas:function(){this._promise=h(this._fontFamily).then(function(t){return this._fillCanvas(t,this._fontSize)}.bind(this)).catch(function(){return this._fillCanvas("Courier New",this._fontSize)}.bind(this))}}),e.a=u},function(t,e,r){"use strict";var i={frame:{caption:"Total frame time",over:16,average:!0,graph:!0,max:4},stats:{caption:"stats",over:1,graph:!0},fps:{caption:"Framerate (FPS)",below:30,average:!0},raf:{caption:"Time since last rAF",average:!0,avgMs:500},update:{caption:"update",average:!0,graph:!0},cull:{caption:"cull",average:!0,graph:!0,max:16},render:{caption:"render",average:!0,graph:!0},glframe:{caption:"glframe",average:!0,graph:!0},textureused:{caption:"texture used"},texturereserved:{caption:"texture reserved"},texturetotal:{caption:"texture total"},pushstateset:{caption:"num pushStateSet"},applyStateSet:{caption:"num applyStateSet"},updatecallback:{caption:"num updateCallback"},cullcamera:{caption:"camera"},cullmatrixtransform:{caption:"matrixTransform"},cullprojection:{caption:"projection"},cullnode:{caption:"node"},culllightsource:{caption:"lightSource"},cullgeometry:{caption:"geometry"}},a=[{name:"framerate",caption:"Framerate",values:["fps","raf"]},{name:"frameBudget",caption:"Frame Budget",base:"frame",values:["frame","update","cull","render","glframe","stats"]},{name:"sceneGraph",caption:"Scene Graph ",values:["pushstateset","updatecallback","applyStateSet"]},{name:"cullVisitor",caption:"Cull",values:["cullnode","cullmatrixtransform","cullcamera","culllighsource","cullprojection","cullgeometry"]},{name:"texture",caption:"Texture Memory",values:["texturereserved","textureused","texturetotal"]}],n={values:i,groups:a};e.a=n},function(t,e,r){"use strict";var i=window.WebGLRenderingContext,a=window.WebGL2RenderingContext,n=[i,a],s=function(t,e){return function(){e.apply(this,arguments),t.apply(this,arguments)}},o=0,h=0,u=0,c=0,l=0,d=0,_=0,f=0,g=0,p=0,m=function(){for(var t=!1,e=0;e<n.length;e++){var r=n[e];r&&(t=!0,r.prototype.drawArrays=s(r.prototype.drawArrays,function(){o++,arguments[0]===this.POINTS?d+=arguments[2]:l+=arguments[2]}),r.prototype.drawElements=s(r.prototype.drawElements,function(){h++,c+=arguments[1]/3,l+=arguments[1]}),r.prototype.useProgram=s(r.prototype.useProgram,function(){u++}),r.prototype.bindTexture=s(r.prototype.bindTexture,function(){_++}))}return t},v=function(t){var e=t.getBufferStats(),r=e.getNbVertexes(),i=e.getCharacterPrimitive(),a=e.getGraphPrimitive();h-=1,a.getCount()&&(o-=1),_-=2,u-=1,l-=i.getCount()+a.getCount(),c-=i.getCount()/3,f=r,g=i.getCount()/3,p=a.getCount()/2,t.getCounter("glDrawCalls").set(h+o),t.getCounter("glDrawElements").set(h),t.getCounter("glDrawArrays").set(o),t.getCounter("glBindTexture").set(_),t.getCounter("glUseProgram").set(u),t.getCounter("glFaces").set(c),t.getCounter("glVertices").set(l),t.getCounter("glPoints").set(d),t.getCounter("statsVertices").set(f),t.getCounter("statsFaces").set(g),t.getCounter("statsLines").set(p),f=0,g=0,p=0,o=0,h=0,u=0,c=0,l=0,d=0,_=0}.bind(this),S={values:{glDrawCalls:{caption:"drawCalls"},glDrawElements:{caption:"drawElements"},glDrawArrays:{caption:"drawArrays"},glBindTexture:{caption:"bindTexture"},glUseProgram:{caption:"useProgram"},glFaces:{caption:"totalFaces"},glVertices:{caption:"totalVertices"},glPoints:{caption:"totalPoints"},statsFaces:{caption:"statsFaces"},statsVertices:{caption:"statsVertices"},statsLines:{caption:"statsLines"}},groups:[{name:"webgl",caption:"WebGL",values:["glDrawCalls","glDrawElements","glDrawArrays","glUseProgram","glBindTexture","glFaces","glVertices","glPoints","statsVertices","statsFaces","statsLines"]}],update:v,init:m};e.a=S},function(t,e,r){"use strict";var i=r(2),a=void 0,n=Math.log(1024),s=function(t){var e=Math.floor(Math.log(t)/n);return 0===t&&(e=1),Math.round(100*t/Math.pow(1024,e))/100},o=function(){return window.performance&&window.performance.memory&&(a=window.performance.memory),a&&0!==a.totalJSHeapSize||i.a.warn("Stats will not report memory, not supported by your browse"),!!a},h=function(t){var e=0,r=0;a&&(e=s(a.usedJSHeapSize),r=s(a.totalJSHeapSize)),t.getCounter("browserMemory").set(e),t.getCounter("browserMemoryTotal").set(r)},u={values:{browserMemory:{caption:"Used Memory",average:!0,avgMs:1e3},browserMemoryTotal:{caption:"Total Memory"}},groups:[{name:"browser",caption:"Browser",values:["browserMemory","browserMemoryTotal"]}],update:h,init:o};e.a=u},function(t,e,r){"use strict";var i=r(0),a=r(4),n=function(t,e){a.a.call(this),this._enable=!t,this._shadowReceiveAttribute=e,this._dirtyHash=!0,this._hash=""};i.a.createPrototypeStateAttribute(n,i.a.objectInherit(a.a.prototype,{attributeType:"ShadowCast",cloneType:function(){return new n(!0)},setReceiveAttribute:function(t){this._shadowReceiveAttribute=t},getReceiveAttribute:function(){return this._shadowReceiveAttribute},getDefines:function(){return this._shadowReceiveAttribute.getDefines()},_computeInternalHash:function(){return"ShadowCast"+this._enable+this._shadowReceiveAttribute.getPrecision()},getHash:function(){return this._shadowReceiveAttribute&&this._shadowReceiveAttribute._dirtyHash&&(this._receiveAttributeDirty=!0),this._dirtyHash?(this._hash=this._computeInternalHash(),this._dirtyHash=!1,this._hash):this._hash},isEnabled:function(){return this._enable}}),"osgShadow","ShadowCastAttribute"),e.a=n},function(t,e,r){"use strict";var i=r(29),a=r(15),n=r(31),s=r(54),o=r(84),h=r(3),u=r(0),c=function(t){h.a.call(this),this._noCastMask=t,this._nodeList=[]};u.a.createPrototypeObject(c,u.a.objectInherit(h.a.prototype,{reset:function(){this._nodeList=[]},removeNodeFromCasting:function(t){var e=t.getNodeMask();-1===e?(e=this._noCastMask,t.setNodeMask(e),this._nodeList.push(t)):0!=(e&~this._noCastMask)&&(t.setNodeMask(e|this._noCastMask),this._nodeList.push(t))},apply:function(t){var e=t.getStateSet();if(e){var r=e.getAttribute("BlendFunc");if(void 0!==r&&r.getSource()!==i.a.DISABLE){var h=e.getAttribute("Depth");if(h&&(h.getFunc()===n.a.DISABLE||!1===h.getWriteMask()))return void this.removeNodeFromCasting(t)}}return t.getTypeID()===s.a.typeID||t.getTypeID()===o.a.typeID?void this.removeNodeFromCasting(t):t.getTypeID()===a.a.typeID&&t.isRenderToTextureCamera()?void this.removeNodeFromCasting(t):void this.traverse(t)},setNoCastMask:function(t){this._noCastMask=t},restore:function(){for(var t=0,e=this._nodeList.length;t<e;t++){var r=this._nodeList[t],i=r.getNodeMask();i===this._noCastMask?r.setNodeMask(-1):r.setNodeMask(i&~this._noCastMask)}}}),"osgShadow","ShadowCasterVisitor"),e.a=c},function(t,e,r){"use strict";var i=r(15),a=r(50),n=r(29),s=r(31),o=r(30),h=r(1),u=r(16),c=r(2),l=r(35),d=r(4),_=r(17),f=r(153),g=r(7),p=r(23),m=r(6),v=r(0),S=r(9),b=r(37),x=r(28),y=r(172),M=r(169),T=r(99),A=r(100),C=r(88),I=function(t){this._shadowTechnique=t};v.a.createPrototypeObject(I,{cull:function(t,e){this._shadowTechnique.getShadowedScene().nodeTraverse(e);var r=e.getCurrentCullingSet(),i=e.getCurrentProjectionMatrix(),a=e.getComputedNear(),n=e.getComputedFar();return a===1/0&&n===-1/0?(this._shadowTechnique.markSceneAsNoShadow(),!1):(h.c.getFrustumPlanes(r.getFrustum().getPlanes(),i,e.getCurrentModelViewMatrix(),!1),r.getFrustum().setupMask(6),this._shadowTechnique.setLightFrustum(r.getFrustum(),a,n),!1)}},"osgShadow","CameraCullCallback");var w=function(t,e){T.a.call(this),this._projectionMatrix=h.c.create(),this._projection=h.f.create(),this._viewMatrix=h.c.create(),this._lightNumberArrayIndex=-1,this._lightUp=h.f.fromValues(0,0,1),this._light=t.light,this._cameraShadow=new i.a,this._cameraShadow.setCullCallback(new I(this)),this._cameraShadow.setRenderOrder(i.a.PRE_RENDER,0),this._cameraShadow.setReferenceFrame(p.a.ABSOLUTE_RF),this._cameraShadow.setClearColor(h.g.fromValues(1,1,1,1)),e?this._texture=e:(this._texture=new A.a,this._textureUnitBase=4,this._textureUnit=this._textureUnitBase,this._textureMagFilter=void 0,this._textureMinFilter=void 0),this._textureSize=256;var r=m.a.createFloat2("RenderSize");this._texelSizeUniform=m.a.createFloat1(1/this._textureSize,"texelSize"),this._renderSize=r.getInternalArray(),this._renderSize[0]=this._renderSize[1]=this._textureSize,this._receivingStateset=void 0,this._casterStateSet=new _.a,this._casterStateSet.addUniform(m.a.createFloat1(0,"exponent0")),this._casterStateSet.addUniform(m.a.createFloat1(0,"exponent1")),this._casterStateSet.addUniform(m.a.createFloat1(.005,"bias")),this._casterStateSet.addUniform(this._texelSizeUniform),this._casterStateSet.addUniform(r),this._casterStateSet.setAttributeAndModes(new s.a(s.a.LESS),d.a.ON|d.a.OVERRIDE),this._casterStateSet.setAttributeAndModes(new n.a,d.a.ON|d.a.OVERRIDE),this._shadowReceiveAttribute=new y.a(this._light.getLightNumber()),this._casterStateSet.setAttributeAndModes(this._shadowReceiveAttribute,d.a.ON|d.a.OVERRIDE),this._shadowCastShaderGeneratorName="ShadowCast";var a=m.a.createFloat4("uShadowDepthRange");this._casterStateSet.addUniform(a),this._depthRange=a.getInternalArray(),this._depthRange[0]=.001,this._depthRange[1]=1e3,this._worldLightPos=h.g.create(),this._worldLightPos[3]=0,this._worldLightDir=h.g.create(),this._worldLightDir[3]=1,this._castsShadowDrawTraversalMask=4294967295,this._castsShadowBoundsTraversalMask=4294967295,this._shaderProcessor=void 0,this._tmpVec=h.f.create(),this._tmpVecBis=h.f.create(),this._tmpVecTercio=h.f.create(),this._tmpMatrix=h.c.create(),t&&this.setShadowSettings(t),this._infiniteFrustum=!0;var o=new M.a(!1,this._shadowReceiveAttribute);this._casterStateSet.setAttributeAndModes(o,d.a.ON|d.a.OVERRIDE),this._casterStateSet.setShaderGeneratorName(this._shadowCastShaderGeneratorName,d.a.OVERRIDE|d.a.ON),this._debug=!1};v.a.createPrototypeObject(w,v.a.objectInherit(T.a.prototype,{getDepthRange:function(){return this._depthRange},setLightFrustum:function(t,e,r){this._lightFrustum=t,this._depthRange[0]=e,this._depthRange[1]=r,this.nearFarBounding(),this._debug&&(this._debugGeomFrustum.updateGeometry(this._projectionMatrix,this._depthRange),h.c.invert(this._debugNodeFrustum.getMatrix(),this._viewMatrix))},getCamera:function(){return this._cameraShadow},getTexture:function(){return this._texture},isDirty:function(){return this._dirty},setTextureUnitBase:function(t){this._textureUnitBase=t,this._textureUnit=t},setShadowSettings:function(t){t&&(this._light=t.light,this._shadowCastShaderGeneratorName=t.getShadowCastShaderGeneratorName(),this.setCastsShadowDrawTraversalMask(t.castsShadowDrawTraversalMask),this.setCastsShadowBoundsTraversalMask(t.castsShadowBoundsTraversalMask),this.setLight(this._light),this.setTextureSize(t.textureSize),this.setTexturePrecision(t.textureType),this.setKernelSizePCF(t.kernelSizePCF),this.setBias(t.bias),this.setNormalBias(t.normalBias))},setCastsShadowDrawTraversalMask:function(t){this._castsShadowDrawTraversalMask=t},getCastsShadowDrawTraversalMask:function(){return this._castsDrawShadowTraversalMask},setCastsShadowBoundsTraversalMask:function(t){this._castsShadowBoundsTraversalMask=t},getCastsShadowBoundsTraversalMask:function(){return this._castsShadowBoundsTraversalMask},getNormalBias:function(){return this._shadowReceiveAttribute.getNormalBias()},setNormalBias:function(t){this._shadowReceiveAttribute.setNormalBias(t)},getJitterOffset:function(){return this._shadowReceiveAttribute.getJitterOffset()},setJitterOffset:function(t){this._shadowReceiveAttribute.setJitterOffset(t)},getBias:function(){return this._shadowReceiveAttribute.getBias()},setBias:function(t){this._shadowReceiveAttribute.setBias(t),this._casterStateSet.getUniformList().bias.getUniform().setFloat(t)},getKernelSizePCF:function(){return this._shadowReceiveAttribute.getKernelSizePCF()},setKernelSizePCF:function(t){this._shadowReceiveAttribute.setKernelSizePCF(t)},setShadowedScene:function(t){T.a.prototype.setShadowedScene.call(this,t),this._receivingStateset=this._shadowedScene.getReceivingStateSet(),this.dirty()},checkLightNumber:function(){var t=this._light.getLightNumber();this._shadowReceiveAttribute.getLightNumber()!==t&&this._receivingStateset.getAttribute(this._shadowReceiveAttribute.getTypeMember())===this._shadowReceiveAttribute&&this._receivingStateset.removeAttribute(this._shadowReceiveAttribute.getTypeMember()),this._texture&&!this._texture.hasLightNumber(t)&&this._receivingStateset.getTextureAttribute(this._textureUnit,this._texture.getTypeMember())===this._texture&&this._receivingStateset.removeTextureAttribute(this._textureUnit,this._texture.getTypeMember())},_rebindFbo:function(){this._cameraShadow.detachAll(),this._cameraShadow.attachTexture(o.a.COLOR_ATTACHMENT0,this._texture),this._cameraShadow.attachRenderBuffer(o.a.DEPTH_ATTACHMENT,o.a.DEPTH_COMPONENT16)},init:function(t,e,r){if(this._shadowedScene){this._needRedraw=!0,this.checkLightNumber();var i=this._light.getLightNumber();t?(this._texture=t,this._lightNumberArrayIndex=e,this._textureUnit=r,this._shadowReceiveAttribute.setAtlas(!0)):(this.initTexture(),this._rebindFbo(),this._textureUnit=this._textureUnitBase+i,this._texture.setLightNumber(i),this._texture.setName("ShadowTexture"+this._textureUnit),this._shadowReceiveAttribute.setAtlas(!1)),this._cameraShadow.setName("light_shadow_camera"+this._light.getName()),this._shadowReceiveAttribute.setLightNumber(i);var a=d.a.OVERRIDE|d.a.ON;this._receivingStateset.setAttributeAndModes(this._shadowReceiveAttribute,a),this._preventTextureBindingDuringShadowCasting(),this._casterStateSet.setTextureAttributeAndModes(this._textureUnit,g.default.textureNull,d.a.PROTECTED),this._receivingStateset.setTextureAttributeAndModes(this._textureUnit,this._texture,a),this._dirty=!1}},_preventTextureBindingDuringShadowCasting:function(){for(var t=x.a.instance().getWebGLParameter("MAX_TEXTURE_IMAGE_UNITS"),e=0;e<t;e++)this._casterStateSet.setTextureAttributeAndModes(e,g.default.textureNull,d.a.OVERRIDE|d.a.ON)},valid:function(){return!0},updateShadowTechnique:function(t,e,r){var i=this._cameraShadow,a=this._texture;if(i&&a){var n=i.getViewport();if(n||(n=new b.a,i.setViewport(n)),e){var s=i.getScissor();s||(s=new C.a(e[0],e[1],e[2],e[3]),i.setScissor(s)),n.x()===e[0]&&n.y()===e[1]&&n.width()===e[2]&&n.height()===e[3]||(i.setFrameBufferObject(r),n.setViewport(e[0],e[1],e[2],e[3]),s.setScissor(e[0],e[1],e[2],e[3]))}else n.width()===a.getWidth()&&n.height()===a.getHeight()||(this._rebindFbo(),n.setViewport(0,0,a.getWidth(),a.getHeight()))}},updateShadowTechnic:function(){c.a.log("ShadowMap.updateShadowTechnic() is deprecated, use updateShadowTechnique instead"),this.updateShadowTechnique()},setTextureFiltering:function(){var t;switch(this.getTexturePrecision()){case"HALF_FLOAT":t=g.default.HALF_FLOAT;break;case"FLOAT":t=g.default.FLOAT;break;default:case"UNSIGNED_BYTE":t=g.default.UNSIGNED_BYTE}this._texture.setInternalFormatType(t),this._texture.setMinFilter(g.default.NEAREST),this._texture.setMagFilter(g.default.NEAREST),this._textureMagFilter=g.default.NEAREST,this._textureMinFilter=g.default.NEAREST},initTexture:function(){if(this._dirty){this._texture||(this._texture=new A.a,this._textureUnit=this._textureUnitBase),this._texture.setTextureSize(this._textureSize,this._textureSize),this._texelSizeUniform.setFloat(1/this._textureSize),this._renderSize[0]=this._textureSize,this._renderSize[1]=this._textureSize;var t;t=g.default.RGBA,this.setTextureFiltering(),this._texture.setInternalFormat(t),this._texture.setWrapS(g.default.CLAMP_TO_EDGE),this._texture.setWrapT(g.default.CLAMP_TO_EDGE),this._texture.dirty()}},setTexturePrecision:function(t){t!==this._shadowReceiveAttribute.getPrecision()&&(this._shadowReceiveAttribute.setPrecision(t),this.dirty())},getTexturePrecision:function(){return this._shadowReceiveAttribute.getPrecision()},setTextureSize:function(t){t!==this._textureSize&&(this._textureSize=t,this.dirty())},getCasterStateSet:function(){return this._casterStateSet},setLight:function(t){t&&t!==this._light&&(this._light=t,this.dirty())},getUp:function(t){return Math.abs(h.f.dot(this._lightUp,t))>=1&&(1===this._lightUp[0]?(this._lightUp[0]=0,this._lightUp[1]=1,this._lightUp[2]=0):(this._lightUp[0]=1,this._lightUp[1]=0,this._lightUp[2]=0)),this._lightUp},nearFarBounding:function(){var t=this._depthRange[0],e=this._depthRange[1],r=w.EPSILON;e<t-r?(this._emptyCasterScene=!0,e=1,t=r):t<r&&(t=r),this._depthRange[0]=t,this._depthRange[1]=e},makePerspectiveFromBoundingBox:function(t,e,r,i,a,n){var s=t.center(this._tmpVec),o=t.radius(),u=w.EPSILON,c=u,l=1;this._radius=o;var d=h.f.distance(s,r);d<=o?(c=u,l=d+o):(c=d-o,l=d+o),this._depthRange[0]=c,this._depthRange[1]=l,this.nearFarBounding();var _=this._depthRange[0]*Math.tan(e*Math.PI/180);_=_>o?o:_;var f=_,g=-f,p=_,m=-p,v=this.getUp(i);this._infiniteFrustum?h.c.infiniteFrustum(n,m,p,g,f,this._depthRange[0]):h.c.frustum(n,m,p,g,f,this._depthRange[0],this._depthRange[1]),this._projection[0]=this._projectionMatrix[0],this._projection[1]=this._projectionMatrix[5],this._projection[2]=0,h.c.lookAtDirection(a,r,i,v)},makeOrthoFromBoundingBox:function(t,e,r,i){var a=t.center(this._tmpVecTercio),n=t.radius(),s=n+n,o=1e-4,u=s+1e-4,c=this._tmpVec;h.f.scaleAndAdd(c,a,e,-s),o=n,u+=n;o<.001*u&&(o=.001*u);var l=this.getUp(e);h.c.lookAtDirection(r,c,e,l);var d,_;_=n,d=_,h.c.ortho(i,-d,d,-_,_,o,u),this._projection[0]=d,this._projection[1]=_,this._projection[2]=1,this._depthRange[0]=o,this._depthRange[1]=u},aimShadowCastingCamera:function(t,e){var r=this._light;if(!r)return void(this._emptyCasterScene=!0);var i=this._cameraShadow,a=this._worldLightPos,n=this._worldLightDir;h.c.copy(this._projectionMatrix,i.getProjectionMatrix()),h.c.copy(this._viewMatrix,i.getViewMatrix());for(var s,o=this._projectionMatrix,u=this._viewMatrix,l=t.getCurrentRenderBin().getPositionedAttribute(),d=l.getArray(),_=0;_<l.getLength();_++){var f=d[_],g=f[1],p=f[0];if(g===r){s=p;break}}if(void 0===s)return c.a.warn("light isnt inside children of shadowedScene Node"),void(this._emptyCasterScene=!0);var m=this._tmpMatrix;if(h.c.invert(m,t.getCurrentModelViewMatrix()),this._light.isDirectionLight())h.g.transformMat4(a,r.getPosition(),s),h.g.transformMat4(a,a,m),h.f.scale(a,a,-1),h.f.normalize(a,a),this.makeOrthoFromBoundingBox(e,a,u,o),this._debug&&h.c.invert(this._debugNodeFrustum.getMatrix(),u);else{h.c.mul(this._tmpMatrix,m,s);var v=this._tmpMatrix;h.f.transformMat4(a,r.getPosition(),v),v[12]=0,v[13]=0,v[14]=0,h.c.invert(v,v),h.c.transpose(v,v),h.f.copy(n,r.getDirection()),h.g.transformMat4(n,n,v),h.f.normalize(n,n),this.makePerspectiveFromBoundingBox(e,r.getSpotCutoff(),a,n,u,o)}h.c.copy(i.getProjectionMatrix(),this._projectionMatrix),h.c.copy(i.getViewMatrix(),this._viewMatrix)},frameShadowCastingFrustum:function(t){this._infiniteFrustum||a.a.prototype.clampProjectionMatrix(this._projectionMatrix,this._depthRange[0],this._depthRange[1],t.getNearFarRatio(),this._depthRange);var e=this._cameraShadow;h.c.copy(e.getProjectionMatrix(),this._projectionMatrix),h.c.copy(e.getViewMatrix(),this._viewMatrix),this.setShadowUniformsReceive(!1)},setShadowUniformsReceive:function(t){if(t&&h.e.set(this._depthRange,0,0),-1!==this._lightNumberArrayIndex){var e=this._light.getLightNumber();this._texture.setViewMatrix(e,this._viewMatrix),this._texture.setProjection(e,this._projection),this._texture.setDepthRange(e,this._depthRange)}else this._texture.setViewMatrix(this._viewMatrix),this._texture.setProjection(this._projection),this._texture.setDepthRange(this._depthRange)},markSceneAsNoShadow:function(){this.setShadowUniformsReceive(!0),this._needRedraw=!1},cullShadowCasting:function(t,e){if(this._debug){var r=e.getMin(),i=e.getMax();e.center(this._tmpVec);var a=this._debugNodeSceneCast.getMatrix();h.c.fromScaling(a,[i[0]-r[0],i[1]-r[1],i[2]-r[2],1]),h.c.setTranslation(a,this._tmpVec)}if(this._emptyCasterScene=!1,this.aimShadowCastingCamera(t,e),this._emptyCasterScene)return void this.markSceneAsNoShadow();var n=t.getTraversalMask();t.setTraversalMask(this._castsShadowDrawTraversalMask),t.pushStateSet(this._casterStateSet),this._cameraShadow.setEnableFrustumCulling(!0),this._cameraShadow.setComputeNearFar(!0),this._debug&&this._debugNode.accept(t),this._cameraShadow.accept(t),this.nearFarBounding(),this.frameShadowCastingFrustum(t),this._cameraShadow.setComputeNearFar(!1),t.popStateSet(),t.setTraversalMask(n),this._needRedraw=!1},cleanReceivingStateSet:function(t){if(this._receivingStateset){if(this._receivingStateset.getAttribute(this._shadowReceiveAttribute.getTypeMember())===this._shadowReceiveAttribute&&this._receivingStateset.removeAttribute(this._shadowReceiveAttribute.getTypeMember()),t)return;this._texture&&this._receivingStateset.getTextureAttribute(this._textureUnit,this._texture.getTypeMember())===this._texture&&this._receivingStateset.removeTextureAttribute(this._textureUnit,this._texture.getTypeMember())}},cleanSceneGraph:function(t){this._needRedraw=!0,this.cleanReceivingStateSet(t),this._texture=void 0,this._shadowedScene=void 0},setDebug:function(t){t&&!this._debug&&(this._debugNode||(this._debugGeomFrustum=f.a.createDebugFrustumGeometry(),this._debugGeomSceneCast=l.a.createBoundingBoxGeometry(),this._debugGeomSceneCast.getPrimitives()[0].mode=S.a.LINES,this._debugNode=new u.a,this._debugNodeFrustum=new u.a,this._debugNodeSceneCast=new u.a,this._debugNodeFrustum.addChild(this._debugGeomFrustum),this._debugNodeSceneCast.addChild(this._debugGeomSceneCast),this._debugNode.addChild(this._debugNodeFrustum),this._debugNode.addChild(this._debugNodeSceneCast))),this._debug=t},getDebug:function(){return this._debug},getLightNumber:function(){return this._light.getLightNumber()},getLight:function(){return this._light}}),"osgShadow","ShadowMap"),w.EPSILON=.005,e.a=w},function(t,e,r){"use strict";var i=r(0),a=r(4),n=r(6),s=function(t,e){a.a.call(this),this._lightNumber=t,this._bias=.001,this._normalBias=void 0,this._precision="UNSIGNED_BYTE",this._kernelSizePCF=void 0,this._fakePCF=!0,this._jitterOffset="none",this._enable=!e,this._isAtlasTexture=!1,this._dirtyHash=!0,this._hash=""};s.uniforms={},i.a.createPrototypeStateAttribute(s,i.a.objectInherit(a.a.prototype,{attributeType:"ShadowReceive",cloneType:function(){return new s(this._lightNumber,!0)},getTypeMember:function(){return this.attributeType+this.getLightNumber()},getLightNumber:function(){return this._lightNumber},getUniformName:function(t){return"u"+(this.getType()+this.getLightNumber().toString())+"_"+t},getAtlas:function(){return this._isAtlasTexture},setAtlas:function(t){this._isAtlasTexture=t},setBias:function(t){this._bias=t},getBias:function(){return this._bias},setNormalBias:function(t){this._normalBias=t},getNormalBias:function(){return this._normalBias},setJitterOffset:function(t){this._jitterOffset=t},getJitterOffset:function(){return this._jitterOffset},getKernelSizePCF:function(){return this._kernelSizePCF},setKernelSizePCF:function(t){this._kernelSizePCF=t,this._dirtyHash=!0},setPrecision:function(t){this._precision=t,this._dirtyHash=!0},getPrecision:function(){return this._precision},setLightNumber:function(t){this._lightNumber=t,this._dirtyHash=!0},getOrCreateUniforms:function(){var t=s,e=this.getTypeMember();return t.uniforms[e]?t.uniforms[e]:(t.uniforms[e]={bias:n.a.createFloat(this.getUniformName("bias")),normalBias:n.a.createFloat(this.getUniformName("normalBias"))},t.uniforms[e])},getDefines:function(){var t=[];switch(this.getKernelSizePCF()){case"4Tap(16texFetch)":t.push("#define _PCFx4");break;case"9Tap(36texFetch)":t.push("#define _PCFx9");break;case"16Tap(64texFetch)":t.push("#define _PCFx25");break;default:case"1Tap(4texFetch)":t.push("#define _PCFx1")}return"UNSIGNED_BYTE"!==this.getPrecision()&&t.push("#define _FLOATTEX"),this.getAtlas()&&t.push("#define _ATLAS_SHADOW"),this.getNormalBias()&&t.push("#define _NORMAL_OFFSET"),"none"!==this.getJitterOffset()&&t.push("#define _JITTER_OFFSET"),t},apply:function(){if(this._enable){var t=this.getOrCreateUniforms();t.normalBias.setFloat(this._normalBias),t.bias.setFloat(this._bias)}},isEnabled:function(){return this._enable},getHash:function(){return this._dirtyHash?(this._hash=this._computeInternalHash(),this._dirtyHash=!1,this._hash):this._hash},_computeInternalHash:function(){return this.getTypeMember()+"_"+this.getKernelSizePCF()}}),"osgShadow","ShadowReceiveAttribute"),e.a=s},function(t,e,r){"use strict";var i=r(2),a=r(7),n=r(100),s=r(6),o=r(0),h=r(1),u=function(){a.default.call(this),this._uniforms={},this._lightNumberArray=[],this._viewMatrices=[],this._projection=[],this._depthRanges=[],this._mapSizes=[],this._renderSize=h.e.create(),this._dirtyHash=!0,this._hash=""};u.uniforms={},o.a.createPrototypeStateAttribute(u,o.a.objectInherit(a.default.prototype,{cloneType:function(){return new u},getLightNumberArray:function(){return this._lightNumberArray},hasLightNumber:function(t){return-1!==this._lightNumberArray.indexOf(t)},setLightNumberArray:function(t){this._lightNumberArray=t,this._dirtyHash=!0},getUniformName:function(t,e){return"uShadow_"+this.getType()+t.toString()+"_"+e},setInternalFormatType:function(t){a.default.prototype.setInternalFormatType.call(this,t),this._dirtyHash=!0},createUniforms:function(t,e){e["ViewRight_"+t]=s.a.createFloat4(this.getUniformName(t,"viewRight")),e["ViewUp_"+t]=s.a.createFloat4(this.getUniformName(t,"viewUp")),e["ViewLook_"+t]=s.a.createFloat4(this.getUniformName(t,"viewLook")),e["Projection_"+t]=s.a.createFloat3(this.getUniformName(t,"projection")),e["DepthRange_"+t]=s.a.createFloat2(this.getUniformName(t,"depthRange")),e["MapSize_"+t]=s.a.createFloat4(this.getUniformName(t,"mapSize")),e["RenderSize_"+t]=e.RenderSize},getOrCreateUniforms:function(t){var e=u;if(i.a.assert(void 0!==t||0!==this._lightNumberArray.length),void 0!==e.uniforms[t])return e.uniforms[t];var r=e.uniforms[t]={},a=s.a.createFloat2(this.getUniformName(0,"renderSize"));r.RenderSize=a;for(var n=0,o=this._lightNumberArray.length;n<o;n++)this.createUniforms(this._lightNumberArray[n],r);var h="Texture"+t,c=s.a.createInt1(t,h);return r[h]=c,e.uniforms[t]},setViewMatrix:function(t,e){this._viewMatrices[t]=e},setProjection:function(t,e){this._projection[t]=e},setDepthRange:function(t,e){this._depthRanges[t]=e},setLightShadowMapSize:function(t,e){this._mapSizes[t]=e},apply:function(t,e){if(a.default.prototype.apply.call(this,t,e),0!==this._lightNumberArray.length){for(var r=this.getOrCreateUniforms(e),i=0,s=this._lightNumberArray.length;i<s;i++){var o=this._lightNumberArray[i];r["ViewRight_"+o]||this.createUniforms(o,r),n.a.prototype._updateViewMatrixUniforms.call(this,this._viewMatrices[o],r["ViewRight_"+o],r["ViewUp_"+o],r["ViewLook_"+o]),r["Projection_"+o].setFloat3(this._projection[o]),r["DepthRange_"+o].setFloat2(this._depthRanges[o]),r["MapSize_"+o].setFloat4(this._mapSizes[o])}r.RenderSize.setFloat2(this._renderSize)}},setTextureSize:function(t,e){this._renderSize[0]=1/t,this._renderSize[1]=1/e,a.default.prototype.setTextureSize.call(this,t,e),this.dirty()},_computeInternalHash:function(){for(var t=this.getTypeMember(),e=0,r=this._lightNumberArray.length;e<r;e++)t+="_"+this._lightNumberArray[e];return t+="_"+this._type},getHash:function(){return this._dirtyHash?(this._hash=this._computeInternalHash(),this._dirtyHash=!1,this._hash):this._hash}}),"osgShadow","ShadowTextureAtlas"),e.a=u},function(t,e,r){t.exports=r(175)},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(176),a=(r.n(i),r(101)),n=r(102),s=r(217),o=r(220),h=r(222),u=r(226),c=r(241),l=r(94),d=r(251),_=r(256),f=r(257),g=r(258),p=r(259);r.d(e,"osg",function(){return n.default}),r.d(e,"osgAnimation",function(){return s.a}),r.d(e,"osgDB",function(){return o.a}),r.d(e,"osgGA",function(){return h.a}),r.d(e,"osgUtil",function(){return u.a}),r.d(e,"osgViewer",function(){return c.a}),r.d(e,"osgShader",function(){return l.default}),r.d(e,"osgShadow",function(){return d.a}),r.d(e,"osgStats",function(){return _.a}),r.d(e,"osgText",function(){return f.a}),r.d(e,"osgWrappers",function(){return g.a}),r.d(e,"osgPlugins",function(){return p.a});var m=a.a;m.osg=n.default,m.osgAnimation=s.a,m.osgDB=o.a,m.osgGA=h.a,m.osgUtil=u.a,m.osgViewer=c.a,m.osgShader=l.default,m.osgShadow=d.a,m.osgStats=_.a,m.osgText=f.a,m.osgWrappers=g.a,m.osgPlugins=p.a,m.InputGroups=c.a.InputGroups,m.globalify=function(){window.osg=m.osg,window.osgAnimation=m.osgAnimation,window.osgDB=m.osgDB,window.osgGA=m.osgGA,window.osgUtil=m.osgUtil,window.osgViewer=m.osgViewer,window.osgShader=m.osgShader,window.osgShadow=m.osgShadow,window.osgStats=m.osgStats,window.osgText=m.osgText,window.osgWrappers=m.osgWrappers,window.osgPlugins=m.osgPlugins,window.InputGroups=m.InputGroups},e.default=m},function(t,e){function r(t,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var r=document.createEvent("CustomEvent");return r.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),r}if(window.Set&&window.Map&&window.Uint8ClampedArray){if(Math.sign||(Math.sign=function(t){return t>0?1:t<0?-1:0}),Math.log2||(Math.log2=function(t){return Math.log(t)*Math.LOG2E}),Math.log10||(Math.log10=function(t){return Math.log(t)*Math.LOG10E}),String.prototype.endsWith||(String.prototype.endsWith=function(t){return this.slice(-t.length)===t}),String.prototype.startsWith||(String.prototype.startsWith=function(t){return this.slice(0,t.length)===t}),!Float32Array.prototype.slice){var i=function(t,e){return new this.constructor(this.subarray(t,e))};Int8Array.prototype.slice=i,Uint8Array.prototype.slice=i,Uint8ClampedArray.prototype.slice=i,Int16Array.prototype.slice=i,Uint16Array.prototype.slice=i,Int32Array.prototype.slice=i,Uint32Array.prototype.slice=i,Float32Array.prototype.slice=i,Float64Array.prototype.slice=i}if(!new window.Set(["test"]).has("test")){var a=window.Set;window.Set=function(t){var e=new a;if(t)for(var r=0;r<t.length;++r)e.add(t[r]);return e}}"object"==typeof window.Event&&(r.prototype=window.Event.prototype,window.Event=r)}},function(t,e){t.exports={devDependencies:{chai:"^3.5.0",eslint:"4.1.1","eslint-config-google":"^0.8.0","eslint-config-standard":"^10.2.1","eslint-plugin-import":"^2.18.2","eslint-plugin-node":"^5.2.1","eslint-plugin-prettier":"^2.6.0","eslint-plugin-private-variables":"*","eslint-plugin-promise":"^3.8.0","eslint-plugin-standard":"^3.1.0","grunt-contrib-connect":"~0.9","grunt-documentation":"*","grunt-execute":"^0.2.2","grunt-plato":"~0.2.1","grunt-release":"^0.10.0","grunt-update-submodules":"^0.4.1",jsdom:"11.0.0","jsdom-global":"3.0.2",mocha:"^2.5.3",prettier:"1.12.0"},peerDependencies:{grunt:">=0.4.0"},dependencies:{"@trigrou/zip-js":"1.0.0",bluebird:"^3.5.5",d3:"^4.13.0",dagre:"^0.7.4","dat.gui":"dataarts/dat.gui#v0.6.4",extend:"^3.0.2","gl-matrix":"2.3.2",glob:"^7.1.4",grunt:"^1.0.4","grunt-contrib-clean":"^2.0.0","grunt-contrib-copy":"*","grunt-contrib-uglify":"^3.1.0","grunt-eslint":"^20.1.0","grunt-git":"^1.0.14","grunt-shell":"^3.0.1","grunt-webpack":"^3.0.2",hammerjs:"^2.0.8",jquery:"3.0.0","json-loader":"^0.5.4",path:"^0.11.14","raw-loader":"^0.5.1",webpack:"^3.7.1","webpack-dev-server":"^2.9.2","webpack-strip-block":"^0.2.0",zlibjs:"^0.3.1"},contributors:["Paul Cheyrou-Lagrèze <tuan.kuranes@gmail.com>","Jordi Torres <jtorresfabra@gmail.com>","Matt Fontaine <tehqin@gmail.com>","Stephane Ginier <stephane.ginier@gmail.com>"],version:"0.2.9",author:"Cedric Pinson <trigrou@trigrou.com> (http://cedricpinson.com)",license:"MIT",description:"OpenSceneGraph implementation in javascript",repository:{url:"git@github.com:cedricpinson/osgjs.git",type:"git"},name:"OpenSceneGraph"}},function(t,e){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e,r){e.glMatrix=r(27),e.mat2=r(180),e.mat2d=r(181),e.mat3=r(104),e.mat4=r(182),e.quat=r(183),e.vec2=r(184),e.vec3=r(105),e.vec4=r(106)},function(t,e,r){var i=r(27),a={};a.create=function(){var t=new i.ARRAY_TYPE(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},a.clone=function(t){var e=new i.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},a.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},a.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},a.fromValues=function(t,e,r,a){var n=new i.ARRAY_TYPE(4);return n[0]=t,n[1]=e,n[2]=r,n[3]=a,n},a.set=function(t,e,r,i,a){return t[0]=e,t[1]=r,t[2]=i,t[3]=a,t},a.transpose=function(t,e){if(t===e){var r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},a.invert=function(t,e){var r=e[0],i=e[1],a=e[2],n=e[3],s=r*n-a*i;return s?(s=1/s,t[0]=n*s,t[1]=-i*s,t[2]=-a*s,t[3]=r*s,t):null},a.adjoint=function(t,e){var r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t},a.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},a.multiply=function(t,e,r){var i=e[0],a=e[1],n=e[2],s=e[3],o=r[0],h=r[1],u=r[2],c=r[3];return t[0]=i*o+n*h,t[1]=a*o+s*h,t[2]=i*u+n*c,t[3]=a*u+s*c,t},a.mul=a.multiply,a.rotate=function(t,e,r){var i=e[0],a=e[1],n=e[2],s=e[3],o=Math.sin(r),h=Math.cos(r);return t[0]=i*h+n*o,t[1]=a*h+s*o,t[2]=i*-o+n*h,t[3]=a*-o+s*h,t},a.scale=function(t,e,r){var i=e[0],a=e[1],n=e[2],s=e[3],o=r[0],h=r[1];return t[0]=i*o,t[1]=a*o,t[2]=n*h,t[3]=s*h,t},a.fromRotation=function(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=-r,t[3]=i,t},a.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},a.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},a.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2))},a.LDU=function(t,e,r,i){return t[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-t[2]*r[1],[t,e,r]},a.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t},a.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t},a.sub=a.subtract,a.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},a.equals=function(t,e){var r=t[0],a=t[1],n=t[2],s=t[3],o=e[0],h=e[1],u=e[2],c=e[3];return Math.abs(r-o)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(a-h)<=i.EPSILON*Math.max(1,Math.abs(a),Math.abs(h))&&Math.abs(n-u)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(s-c)<=i.EPSILON*Math.max(1,Math.abs(s),Math.abs(c))},a.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},a.multiplyScalarAndAdd=function(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t},t.exports=a},function(t,e,r){var i=r(27),a={};a.create=function(){var t=new i.ARRAY_TYPE(6);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},a.clone=function(t){var e=new i.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},a.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},a.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},a.fromValues=function(t,e,r,a,n,s){var o=new i.ARRAY_TYPE(6);return o[0]=t,o[1]=e,o[2]=r,o[3]=a,o[4]=n,o[5]=s,o},a.set=function(t,e,r,i,a,n,s){return t[0]=e,t[1]=r,t[2]=i,t[3]=a,t[4]=n,t[5]=s,t},a.invert=function(t,e){var r=e[0],i=e[1],a=e[2],n=e[3],s=e[4],o=e[5],h=r*n-i*a;return h?(h=1/h,t[0]=n*h,t[1]=-i*h,t[2]=-a*h,t[3]=r*h,t[4]=(a*o-n*s)*h,t[5]=(i*s-r*o)*h,t):null},a.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},a.multiply=function(t,e,r){var i=e[0],a=e[1],n=e[2],s=e[3],o=e[4],h=e[5],u=r[0],c=r[1],l=r[2],d=r[3],_=r[4],f=r[5];return t[0]=i*u+n*c,t[1]=a*u+s*c,t[2]=i*l+n*d,t[3]=a*l+s*d,t[4]=i*_+n*f+o,t[5]=a*_+s*f+h,t},a.mul=a.multiply,a.rotate=function(t,e,r){var i=e[0],a=e[1],n=e[2],s=e[3],o=e[4],h=e[5],u=Math.sin(r),c=Math.cos(r);return t[0]=i*c+n*u,t[1]=a*c+s*u,t[2]=i*-u+n*c,t[3]=a*-u+s*c,t[4]=o,t[5]=h,t},a.scale=function(t,e,r){var i=e[0],a=e[1],n=e[2],s=e[3],o=e[4],h=e[5],u=r[0],c=r[1];return t[0]=i*u,t[1]=a*u,t[2]=n*c,t[3]=s*c,t[4]=o,t[5]=h,t},a.translate=function(t,e,r){var i=e[0],a=e[1],n=e[2],s=e[3],o=e[4],h=e[5],u=r[0],c=r[1];return t[0]=i,t[1]=a,t[2]=n,t[3]=s,t[4]=i*u+n*c+o,t[5]=a*u+s*c+h,t},a.fromRotation=function(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=-r,t[3]=i,t[4]=0,t[5]=0,t},a.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},a.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},a.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},a.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+1)},a.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t},a.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t},a.sub=a.subtract,a.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t},a.multiplyScalarAndAdd=function(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t},a.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},a.equals=function(t,e){var r=t[0],a=t[1],n=t[2],s=t[3],o=t[4],h=t[5],u=e[0],c=e[1],l=e[2],d=e[3],_=e[4],f=e[5];return Math.abs(r-u)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(a-c)<=i.EPSILON*Math.max(1,Math.abs(a),Math.abs(c))&&Math.abs(n-l)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-d)<=i.EPSILON*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(o-_)<=i.EPSILON*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(h-f)<=i.EPSILON*Math.max(1,Math.abs(h),Math.abs(f))},t.exports=a},function(t,e,r){var i=r(27),a={scalar:{},SIMD:{}};a.create=function(){var t=new i.ARRAY_TYPE(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},a.clone=function(t){var e=new i.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},a.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},a.fromValues=function(t,e,r,a,n,s,o,h,u,c,l,d,_,f,g,p){var m=new i.ARRAY_TYPE(16);return m[0]=t,m[1]=e,m[2]=r,m[3]=a,m[4]=n,m[5]=s,m[6]=o,m[7]=h,m[8]=u,m[9]=c,m[10]=l,m[11]=d,m[12]=_,m[13]=f,m[14]=g,m[15]=p,m},a.set=function(t,e,r,i,a,n,s,o,h,u,c,l,d,_,f,g,p){return t[0]=e,t[1]=r,t[2]=i,t[3]=a,t[4]=n,t[5]=s,t[6]=o,t[7]=h,t[8]=u,t[9]=c,t[10]=l,t[11]=d,t[12]=_,t[13]=f,t[14]=g,t[15]=p,t},a.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},a.scalar.transpose=function(t,e){if(t===e){var r=e[1],i=e[2],a=e[3],n=e[6],s=e[7],o=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=n,t[11]=e[14],t[12]=a,t[13]=s,t[14]=o}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},a.SIMD.transpose=function(t,e){var r,i,a,n,s,o,h,u,c,l;return r=SIMD.Float32x4.load(e,0),i=SIMD.Float32x4.load(e,4),a=SIMD.Float32x4.load(e,8),n=SIMD.Float32x4.load(e,12),s=SIMD.Float32x4.shuffle(r,i,0,1,4,5),o=SIMD.Float32x4.shuffle(a,n,0,1,4,5),h=SIMD.Float32x4.shuffle(s,o,0,2,4,6),u=SIMD.Float32x4.shuffle(s,o,1,3,5,7),SIMD.Float32x4.store(t,0,h),SIMD.Float32x4.store(t,4,u),s=SIMD.Float32x4.shuffle(r,i,2,3,6,7),o=SIMD.Float32x4.shuffle(a,n,2,3,6,7),c=SIMD.Float32x4.shuffle(s,o,0,2,4,6),l=SIMD.Float32x4.shuffle(s,o,1,3,5,7),SIMD.Float32x4.store(t,8,c),SIMD.Float32x4.store(t,12,l),t},a.transpose=i.USE_SIMD?a.SIMD.transpose:a.scalar.transpose,a.scalar.invert=function(t,e){var r=e[0],i=e[1],a=e[2],n=e[3],s=e[4],o=e[5],h=e[6],u=e[7],c=e[8],l=e[9],d=e[10],_=e[11],f=e[12],g=e[13],p=e[14],m=e[15],v=r*o-i*s,S=r*h-a*s,b=r*u-n*s,x=i*h-a*o,y=i*u-n*o,M=a*u-n*h,T=c*g-l*f,A=c*p-d*f,C=c*m-_*f,I=l*p-d*g,w=l*m-_*g,E=d*m-_*p,N=v*E-S*w+b*I+x*C-y*A+M*T;return N?(N=1/N,t[0]=(o*E-h*w+u*I)*N,t[1]=(a*w-i*E-n*I)*N,t[2]=(g*M-p*y+m*x)*N,t[3]=(d*y-l*M-_*x)*N,t[4]=(h*C-s*E-u*A)*N,t[5]=(r*E-a*C+n*A)*N,t[6]=(p*b-f*M-m*S)*N,t[7]=(c*M-d*b+_*S)*N,t[8]=(s*w-o*C+u*T)*N,t[9]=(i*C-r*w-n*T)*N,t[10]=(f*y-g*b+m*v)*N,t[11]=(l*b-c*y-_*v)*N,t[12]=(o*A-s*I-h*T)*N,t[13]=(r*I-i*A+a*T)*N,t[14]=(g*S-f*x-p*v)*N,t[15]=(c*x-l*S+d*v)*N,t):null},a.SIMD.invert=function(t,e){var r,i,a,n,s,o,h,u,c,l,d=SIMD.Float32x4.load(e,0),_=SIMD.Float32x4.load(e,4),f=SIMD.Float32x4.load(e,8),g=SIMD.Float32x4.load(e,12);return s=SIMD.Float32x4.shuffle(d,_,0,1,4,5),i=SIMD.Float32x4.shuffle(f,g,0,1,4,5),r=SIMD.Float32x4.shuffle(s,i,0,2,4,6),i=SIMD.Float32x4.shuffle(i,s,1,3,5,7),s=SIMD.Float32x4.shuffle(d,_,2,3,6,7),n=SIMD.Float32x4.shuffle(f,g,2,3,6,7),a=SIMD.Float32x4.shuffle(s,n,0,2,4,6),n=SIMD.Float32x4.shuffle(n,s,1,3,5,7),s=SIMD.Float32x4.mul(a,n),s=SIMD.Float32x4.swizzle(s,1,0,3,2),o=SIMD.Float32x4.mul(i,s),h=SIMD.Float32x4.mul(r,s),s=SIMD.Float32x4.swizzle(s,2,3,0,1),o=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,s),o),h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(r,s),h),h=SIMD.Float32x4.swizzle(h,2,3,0,1),s=SIMD.Float32x4.mul(i,a),s=SIMD.Float32x4.swizzle(s,1,0,3,2),o=SIMD.Float32x4.add(SIMD.Float32x4.mul(n,s),o),c=SIMD.Float32x4.mul(r,s),s=SIMD.Float32x4.swizzle(s,2,3,0,1),o=SIMD.Float32x4.sub(o,SIMD.Float32x4.mul(n,s)),c=SIMD.Float32x4.sub(SIMD.Float32x4.mul(r,s),c),c=SIMD.Float32x4.swizzle(c,2,3,0,1),s=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(i,2,3,0,1),n),s=SIMD.Float32x4.swizzle(s,1,0,3,2),a=SIMD.Float32x4.swizzle(a,2,3,0,1),o=SIMD.Float32x4.add(SIMD.Float32x4.mul(a,s),o),u=SIMD.Float32x4.mul(r,s),s=SIMD.Float32x4.swizzle(s,2,3,0,1),o=SIMD.Float32x4.sub(o,SIMD.Float32x4.mul(a,s)),u=SIMD.Float32x4.sub(SIMD.Float32x4.mul(r,s),u),u=SIMD.Float32x4.swizzle(u,2,3,0,1),s=SIMD.Float32x4.mul(r,i),s=SIMD.Float32x4.swizzle(s,1,0,3,2),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(n,s),u),c=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,s),c),s=SIMD.Float32x4.swizzle(s,2,3,0,1),u=SIMD.Float32x4.sub(SIMD.Float32x4.mul(n,s),u),c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(a,s)),s=SIMD.Float32x4.mul(r,n),s=SIMD.Float32x4.swizzle(s,1,0,3,2),h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(a,s)),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(i,s),u),s=SIMD.Float32x4.swizzle(s,2,3,0,1),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(a,s),h),u=SIMD.Float32x4.sub(u,SIMD.Float32x4.mul(i,s)),s=SIMD.Float32x4.mul(r,a),s=SIMD.Float32x4.swizzle(s,1,0,3,2),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(n,s),h),c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(i,s)),s=SIMD.Float32x4.swizzle(s,2,3,0,1),h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(n,s)),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(i,s),c),l=SIMD.Float32x4.mul(r,o),l=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(l,2,3,0,1),l),l=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(l,1,0,3,2),l),s=SIMD.Float32x4.reciprocalApproximation(l),l=SIMD.Float32x4.sub(SIMD.Float32x4.add(s,s),SIMD.Float32x4.mul(l,SIMD.Float32x4.mul(s,s))),(l=SIMD.Float32x4.swizzle(l,0,0,0,0))?(SIMD.Float32x4.store(t,0,SIMD.Float32x4.mul(l,o)),SIMD.Float32x4.store(t,4,SIMD.Float32x4.mul(l,h)),SIMD.Float32x4.store(t,8,SIMD.Float32x4.mul(l,u)),SIMD.Float32x4.store(t,12,SIMD.Float32x4.mul(l,c)),t):null},a.invert=i.USE_SIMD?a.SIMD.invert:a.scalar.invert,a.scalar.adjoint=function(t,e){var r=e[0],i=e[1],a=e[2],n=e[3],s=e[4],o=e[5],h=e[6],u=e[7],c=e[8],l=e[9],d=e[10],_=e[11],f=e[12],g=e[13],p=e[14],m=e[15];return t[0]=o*(d*m-_*p)-l*(h*m-u*p)+g*(h*_-u*d),t[1]=-(i*(d*m-_*p)-l*(a*m-n*p)+g*(a*_-n*d)),t[2]=i*(h*m-u*p)-o*(a*m-n*p)+g*(a*u-n*h),t[3]=-(i*(h*_-u*d)-o*(a*_-n*d)+l*(a*u-n*h)),t[4]=-(s*(d*m-_*p)-c*(h*m-u*p)+f*(h*_-u*d)),t[5]=r*(d*m-_*p)-c*(a*m-n*p)+f*(a*_-n*d),t[6]=-(r*(h*m-u*p)-s*(a*m-n*p)+f*(a*u-n*h)),t[7]=r*(h*_-u*d)-s*(a*_-n*d)+c*(a*u-n*h),t[8]=s*(l*m-_*g)-c*(o*m-u*g)+f*(o*_-u*l),t[9]=-(r*(l*m-_*g)-c*(i*m-n*g)+f*(i*_-n*l)),t[10]=r*(o*m-u*g)-s*(i*m-n*g)+f*(i*u-n*o),t[11]=-(r*(o*_-u*l)-s*(i*_-n*l)+c*(i*u-n*o)),t[12]=-(s*(l*p-d*g)-c*(o*p-h*g)+f*(o*d-h*l)),t[13]=r*(l*p-d*g)-c*(i*p-a*g)+f*(i*d-a*l),t[14]=-(r*(o*p-h*g)-s*(i*p-a*g)+f*(i*h-a*o)),t[15]=r*(o*d-h*l)-s*(i*d-a*l)+c*(i*h-a*o),t},a.SIMD.adjoint=function(t,e){var r,i,a,n,s,o,h,u,c,l,d,_,f,r=SIMD.Float32x4.load(e,0),i=SIMD.Float32x4.load(e,4),a=SIMD.Float32x4.load(e,8),n=SIMD.Float32x4.load(e,12);return c=SIMD.Float32x4.shuffle(r,i,0,1,4,5),o=SIMD.Float32x4.shuffle(a,n,0,1,4,5),s=SIMD.Float32x4.shuffle(c,o,0,2,4,6),o=SIMD.Float32x4.shuffle(o,c,1,3,5,7),c=SIMD.Float32x4.shuffle(r,i,2,3,6,7),u=SIMD.Float32x4.shuffle(a,n,2,3,6,7),h=SIMD.Float32x4.shuffle(c,u,0,2,4,6),u=SIMD.Float32x4.shuffle(u,c,1,3,5,7),c=SIMD.Float32x4.mul(h,u),c=SIMD.Float32x4.swizzle(c,1,0,3,2),l=SIMD.Float32x4.mul(o,c),d=SIMD.Float32x4.mul(s,c),c=SIMD.Float32x4.swizzle(c,2,3,0,1),l=SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,c),l),d=SIMD.Float32x4.sub(SIMD.Float32x4.mul(s,c),d),d=SIMD.Float32x4.swizzle(d,2,3,0,1),c=SIMD.Float32x4.mul(o,h),c=SIMD.Float32x4.swizzle(c,1,0,3,2),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(u,c),l),f=SIMD.Float32x4.mul(s,c),c=SIMD.Float32x4.swizzle(c,2,3,0,1),l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(u,c)),f=SIMD.Float32x4.sub(SIMD.Float32x4.mul(s,c),f),f=SIMD.Float32x4.swizzle(f,2,3,0,1),c=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(o,2,3,0,1),u),c=SIMD.Float32x4.swizzle(c,1,0,3,2),h=SIMD.Float32x4.swizzle(h,2,3,0,1),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(h,c),l),_=SIMD.Float32x4.mul(s,c),c=SIMD.Float32x4.swizzle(c,2,3,0,1),l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(h,c)),_=SIMD.Float32x4.sub(SIMD.Float32x4.mul(s,c),_),_=SIMD.Float32x4.swizzle(_,2,3,0,1),c=SIMD.Float32x4.mul(s,o),c=SIMD.Float32x4.swizzle(c,1,0,3,2),_=SIMD.Float32x4.add(SIMD.Float32x4.mul(u,c),_),f=SIMD.Float32x4.sub(SIMD.Float32x4.mul(h,c),f),c=SIMD.Float32x4.swizzle(c,2,3,0,1),_=SIMD.Float32x4.sub(SIMD.Float32x4.mul(u,c),_),f=SIMD.Float32x4.sub(f,SIMD.Float32x4.mul(h,c)),c=SIMD.Float32x4.mul(s,u),c=SIMD.Float32x4.swizzle(c,1,0,3,2),d=SIMD.Float32x4.sub(d,SIMD.Float32x4.mul(h,c)),_=SIMD.Float32x4.add(SIMD.Float32x4.mul(o,c),_),c=SIMD.Float32x4.swizzle(c,2,3,0,1),d=SIMD.Float32x4.add(SIMD.Float32x4.mul(h,c),d),_=SIMD.Float32x4.sub(_,SIMD.Float32x4.mul(o,c)),c=SIMD.Float32x4.mul(s,h),c=SIMD.Float32x4.swizzle(c,1,0,3,2),d=SIMD.Float32x4.add(SIMD.Float32x4.mul(u,c),d),f=SIMD.Float32x4.sub(f,SIMD.Float32x4.mul(o,c)),c=SIMD.Float32x4.swizzle(c,2,3,0,1),d=SIMD.Float32x4.sub(d,SIMD.Float32x4.mul(u,c)),f=SIMD.Float32x4.add(SIMD.Float32x4.mul(o,c),f),SIMD.Float32x4.store(t,0,l),SIMD.Float32x4.store(t,4,d),SIMD.Float32x4.store(t,8,_),SIMD.Float32x4.store(t,12,f),t},a.adjoint=i.USE_SIMD?a.SIMD.adjoint:a.scalar.adjoint,a.determinant=function(t){var e=t[0],r=t[1],i=t[2],a=t[3],n=t[4],s=t[5],o=t[6],h=t[7],u=t[8],c=t[9],l=t[10],d=t[11],_=t[12],f=t[13],g=t[14],p=t[15];return(e*s-r*n)*(l*p-d*g)-(e*o-i*n)*(c*p-d*f)+(e*h-a*n)*(c*g-l*f)+(r*o-i*s)*(u*p-d*_)-(r*h-a*s)*(u*g-l*_)+(i*h-a*o)*(u*f-c*_)},a.SIMD.multiply=function(t,e,r){var i=SIMD.Float32x4.load(e,0),a=SIMD.Float32x4.load(e,4),n=SIMD.Float32x4.load(e,8),s=SIMD.Float32x4.load(e,12),o=SIMD.Float32x4.load(r,0),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(o,0,0,0,0),i),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(o,1,1,1,1),a),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(o,2,2,2,2),n),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(o,3,3,3,3),s))));SIMD.Float32x4.store(t,0,h);var u=SIMD.Float32x4.load(r,4),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,0,0,0,0),i),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,1,1,1,1),a),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,2,2,2,2),n),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,3,3,3,3),s))));SIMD.Float32x4.store(t,4,c);var l=SIMD.Float32x4.load(r,8),d=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,0,0,0,0),i),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,1,1,1,1),a),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,2,2,2,2),n),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,3,3,3,3),s))));SIMD.Float32x4.store(t,8,d);var _=SIMD.Float32x4.load(r,12),f=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(_,0,0,0,0),i),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(_,1,1,1,1),a),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(_,2,2,2,2),n),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(_,3,3,3,3),s))));return SIMD.Float32x4.store(t,12,f),t},a.scalar.multiply=function(t,e,r){var i=e[0],a=e[1],n=e[2],s=e[3],o=e[4],h=e[5],u=e[6],c=e[7],l=e[8],d=e[9],_=e[10],f=e[11],g=e[12],p=e[13],m=e[14],v=e[15],S=r[0],b=r[1],x=r[2],y=r[3];return t[0]=S*i+b*o+x*l+y*g,t[1]=S*a+b*h+x*d+y*p,t[2]=S*n+b*u+x*_+y*m,t[3]=S*s+b*c+x*f+y*v,S=r[4],b=r[5],x=r[6],y=r[7],t[4]=S*i+b*o+x*l+y*g,t[5]=S*a+b*h+x*d+y*p,t[6]=S*n+b*u+x*_+y*m,t[7]=S*s+b*c+x*f+y*v,S=r[8],b=r[9],x=r[10],y=r[11],t[8]=S*i+b*o+x*l+y*g,t[9]=S*a+b*h+x*d+y*p,t[10]=S*n+b*u+x*_+y*m,t[11]=S*s+b*c+x*f+y*v,S=r[12],b=r[13],x=r[14],y=r[15],t[12]=S*i+b*o+x*l+y*g,t[13]=S*a+b*h+x*d+y*p,t[14]=S*n+b*u+x*_+y*m,t[15]=S*s+b*c+x*f+y*v,t},a.multiply=i.USE_SIMD?a.SIMD.multiply:a.scalar.multiply,a.mul=a.multiply,a.scalar.translate=function(t,e,r){var i,a,n,s,o,h,u,c,l,d,_,f,g=r[0],p=r[1],m=r[2];return e===t?(t[12]=e[0]*g+e[4]*p+e[8]*m+e[12],t[13]=e[1]*g+e[5]*p+e[9]*m+e[13],t[14]=e[2]*g+e[6]*p+e[10]*m+e[14],t[15]=e[3]*g+e[7]*p+e[11]*m+e[15]):(i=e[0],a=e[1],n=e[2],s=e[3],o=e[4],h=e[5],u=e[6],c=e[7],l=e[8],d=e[9],_=e[10],f=e[11],t[0]=i,t[1]=a,t[2]=n,t[3]=s,t[4]=o,t[5]=h,t[6]=u,t[7]=c,t[8]=l,t[9]=d,t[10]=_,t[11]=f,t[12]=i*g+o*p+l*m+e[12],t[13]=a*g+h*p+d*m+e[13],t[14]=n*g+u*p+_*m+e[14],t[15]=s*g+c*p+f*m+e[15]),t},a.SIMD.translate=function(t,e,r){var i=SIMD.Float32x4.load(e,0),a=SIMD.Float32x4.load(e,4),n=SIMD.Float32x4.load(e,8),s=SIMD.Float32x4.load(e,12),o=SIMD.Float32x4(r[0],r[1],r[2],0);e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11]),i=SIMD.Float32x4.mul(i,SIMD.Float32x4.swizzle(o,0,0,0,0)),a=SIMD.Float32x4.mul(a,SIMD.Float32x4.swizzle(o,1,1,1,1)),n=SIMD.Float32x4.mul(n,SIMD.Float32x4.swizzle(o,2,2,2,2));var h=SIMD.Float32x4.add(i,SIMD.Float32x4.add(a,SIMD.Float32x4.add(n,s)));return SIMD.Float32x4.store(t,12,h),t},a.translate=i.USE_SIMD?a.SIMD.translate:a.scalar.translate,a.scalar.scale=function(t,e,r){var i=r[0],a=r[1],n=r[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*a,t[5]=e[5]*a,t[6]=e[6]*a,t[7]=e[7]*a,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},a.SIMD.scale=function(t,e,r){var i,a,n,s=SIMD.Float32x4(r[0],r[1],r[2],0);return i=SIMD.Float32x4.load(e,0),SIMD.Float32x4.store(t,0,SIMD.Float32x4.mul(i,SIMD.Float32x4.swizzle(s,0,0,0,0))),a=SIMD.Float32x4.load(e,4),SIMD.Float32x4.store(t,4,SIMD.Float32x4.mul(a,SIMD.Float32x4.swizzle(s,1,1,1,1))),n=SIMD.Float32x4.load(e,8),SIMD.Float32x4.store(t,8,SIMD.Float32x4.mul(n,SIMD.Float32x4.swizzle(s,2,2,2,2))),t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},a.scale=i.USE_SIMD?a.SIMD.scale:a.scalar.scale,a.rotate=function(t,e,r,a){var n,s,o,h,u,c,l,d,_,f,g,p,m,v,S,b,x,y,M,T,A,C,I,w,E=a[0],N=a[1],R=a[2],O=Math.sqrt(E*E+N*N+R*R);return Math.abs(O)<i.EPSILON?null:(O=1/O,E*=O,N*=O,R*=O,n=Math.sin(r),s=Math.cos(r),o=1-s,h=e[0],u=e[1],c=e[2],l=e[3],d=e[4],_=e[5],f=e[6],g=e[7],p=e[8],m=e[9],v=e[10],S=e[11],b=E*E*o+s,x=N*E*o+R*n,y=R*E*o-N*n,M=E*N*o-R*n,T=N*N*o+s,A=R*N*o+E*n,C=E*R*o+N*n,I=N*R*o-E*n,w=R*R*o+s,t[0]=h*b+d*x+p*y,t[1]=u*b+_*x+m*y,t[2]=c*b+f*x+v*y,t[3]=l*b+g*x+S*y,t[4]=h*M+d*T+p*A,t[5]=u*M+_*T+m*A,t[6]=c*M+f*T+v*A,t[7]=l*M+g*T+S*A,t[8]=h*C+d*I+p*w,t[9]=u*C+_*I+m*w,t[10]=c*C+f*I+v*w,t[11]=l*C+g*I+S*w,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},a.scalar.rotateX=function(t,e,r){var i=Math.sin(r),a=Math.cos(r),n=e[4],s=e[5],o=e[6],h=e[7],u=e[8],c=e[9],l=e[10],d=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=n*a+u*i,t[5]=s*a+c*i,t[6]=o*a+l*i,t[7]=h*a+d*i,t[8]=u*a-n*i,t[9]=c*a-s*i,t[10]=l*a-o*i,t[11]=d*a-h*i,t},a.SIMD.rotateX=function(t,e,r){var i=SIMD.Float32x4.splat(Math.sin(r)),a=SIMD.Float32x4.splat(Math.cos(r));e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var n=SIMD.Float32x4.load(e,4),s=SIMD.Float32x4.load(e,8);return SIMD.Float32x4.store(t,4,SIMD.Float32x4.add(SIMD.Float32x4.mul(n,a),SIMD.Float32x4.mul(s,i))),SIMD.Float32x4.store(t,8,SIMD.Float32x4.sub(SIMD.Float32x4.mul(s,a),SIMD.Float32x4.mul(n,i))),t},a.rotateX=i.USE_SIMD?a.SIMD.rotateX:a.scalar.rotateX,a.scalar.rotateY=function(t,e,r){var i=Math.sin(r),a=Math.cos(r),n=e[0],s=e[1],o=e[2],h=e[3],u=e[8],c=e[9],l=e[10],d=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*a-u*i,t[1]=s*a-c*i,t[2]=o*a-l*i,t[3]=h*a-d*i,t[8]=n*i+u*a,t[9]=s*i+c*a,t[10]=o*i+l*a,t[11]=h*i+d*a,t},a.SIMD.rotateY=function(t,e,r){var i=SIMD.Float32x4.splat(Math.sin(r)),a=SIMD.Float32x4.splat(Math.cos(r));e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var n=SIMD.Float32x4.load(e,0),s=SIMD.Float32x4.load(e,8);return SIMD.Float32x4.store(t,0,SIMD.Float32x4.sub(SIMD.Float32x4.mul(n,a),SIMD.Float32x4.mul(s,i))),SIMD.Float32x4.store(t,8,SIMD.Float32x4.add(SIMD.Float32x4.mul(n,i),SIMD.Float32x4.mul(s,a))),t},a.rotateY=i.USE_SIMD?a.SIMD.rotateY:a.scalar.rotateY,a.scalar.rotateZ=function(t,e,r){var i=Math.sin(r),a=Math.cos(r),n=e[0],s=e[1],o=e[2],h=e[3],u=e[4],c=e[5],l=e[6],d=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*a+u*i,t[1]=s*a+c*i,t[2]=o*a+l*i,t[3]=h*a+d*i,t[4]=u*a-n*i,t[5]=c*a-s*i,t[6]=l*a-o*i,t[7]=d*a-h*i,t},a.SIMD.rotateZ=function(t,e,r){var i=SIMD.Float32x4.splat(Math.sin(r)),a=SIMD.Float32x4.splat(Math.cos(r));e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var n=SIMD.Float32x4.load(e,0),s=SIMD.Float32x4.load(e,4);return SIMD.Float32x4.store(t,0,SIMD.Float32x4.add(SIMD.Float32x4.mul(n,a),SIMD.Float32x4.mul(s,i))),SIMD.Float32x4.store(t,4,SIMD.Float32x4.sub(SIMD.Float32x4.mul(s,a),SIMD.Float32x4.mul(n,i))),t},a.rotateZ=i.USE_SIMD?a.SIMD.rotateZ:a.scalar.rotateZ,a.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},a.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},a.fromRotation=function(t,e,r){var a,n,s,o=r[0],h=r[1],u=r[2],c=Math.sqrt(o*o+h*h+u*u);return Math.abs(c)<i.EPSILON?null:(c=1/c,o*=c,h*=c,u*=c,a=Math.sin(e),n=Math.cos(e),s=1-n,t[0]=o*o*s+n,t[1]=h*o*s+u*a,t[2]=u*o*s-h*a,t[3]=0,t[4]=o*h*s-u*a,t[5]=h*h*s+n,t[6]=u*h*s+o*a,t[7]=0,t[8]=o*u*s+h*a,t[9]=h*u*s-o*a,t[10]=u*u*s+n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},a.fromXRotation=function(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},a.fromYRotation=function(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},a.fromZRotation=function(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},a.fromRotationTranslation=function(t,e,r){var i=e[0],a=e[1],n=e[2],s=e[3],o=i+i,h=a+a,u=n+n,c=i*o,l=i*h,d=i*u,_=a*h,f=a*u,g=n*u,p=s*o,m=s*h,v=s*u;return t[0]=1-(_+g),t[1]=l+v,t[2]=d-m,t[3]=0,t[4]=l-v,t[5]=1-(c+g),t[6]=f+p,t[7]=0,t[8]=d+m,t[9]=f-p,t[10]=1-(c+_),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t},a.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},a.getRotation=function(t,e){var r=e[0]+e[5]+e[10],i=0;return r>0?(i=2*Math.sqrt(r+1),t[3]=.25*i,t[0]=(e[6]-e[9])/i,t[1]=(e[8]-e[2])/i,t[2]=(e[1]-e[4])/i):e[0]>e[5]&e[0]>e[10]?(i=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/i,t[0]=.25*i,t[1]=(e[1]+e[4])/i,t[2]=(e[8]+e[2])/i):e[5]>e[10]?(i=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/i,t[0]=(e[1]+e[4])/i,t[1]=.25*i,t[2]=(e[6]+e[9])/i):(i=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/i,t[0]=(e[8]+e[2])/i,t[1]=(e[6]+e[9])/i,t[2]=.25*i),t},a.fromRotationTranslationScale=function(t,e,r,i){var a=e[0],n=e[1],s=e[2],o=e[3],h=a+a,u=n+n,c=s+s,l=a*h,d=a*u,_=a*c,f=n*u,g=n*c,p=s*c,m=o*h,v=o*u,S=o*c,b=i[0],x=i[1],y=i[2];return t[0]=(1-(f+p))*b,t[1]=(d+S)*b,t[2]=(_-v)*b,t[3]=0,t[4]=(d-S)*x,t[5]=(1-(l+p))*x,t[6]=(g+m)*x,t[7]=0,t[8]=(_+v)*y,t[9]=(g-m)*y,t[10]=(1-(l+f))*y,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t},a.fromRotationTranslationScaleOrigin=function(t,e,r,i,a){var n=e[0],s=e[1],o=e[2],h=e[3],u=n+n,c=s+s,l=o+o,d=n*u,_=n*c,f=n*l,g=s*c,p=s*l,m=o*l,v=h*u,S=h*c,b=h*l,x=i[0],y=i[1],M=i[2],T=a[0],A=a[1],C=a[2];return t[0]=(1-(g+m))*x,t[1]=(_+b)*x,t[2]=(f-S)*x,t[3]=0,t[4]=(_-b)*y,t[5]=(1-(d+m))*y,t[6]=(p+v)*y,t[7]=0,t[8]=(f+S)*M,t[9]=(p-v)*M,t[10]=(1-(d+g))*M,t[11]=0,t[12]=r[0]+T-(t[0]*T+t[4]*A+t[8]*C),t[13]=r[1]+A-(t[1]*T+t[5]*A+t[9]*C),t[14]=r[2]+C-(t[2]*T+t[6]*A+t[10]*C),t[15]=1,t},a.fromQuat=function(t,e){var r=e[0],i=e[1],a=e[2],n=e[3],s=r+r,o=i+i,h=a+a,u=r*s,c=i*s,l=i*o,d=a*s,_=a*o,f=a*h,g=n*s,p=n*o,m=n*h;return t[0]=1-l-f,t[1]=c+m,t[2]=d-p,t[3]=0,t[4]=c-m,t[5]=1-u-f,t[6]=_+g,t[7]=0,t[8]=d+p,t[9]=_-g,t[10]=1-u-l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},a.frustum=function(t,e,r,i,a,n,s){var o=1/(r-e),h=1/(a-i),u=1/(n-s);return t[0]=2*n*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*n*h,t[6]=0,t[7]=0,t[8]=(r+e)*o,t[9]=(a+i)*h,t[10]=(s+n)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=s*n*2*u,t[15]=0,t},a.perspective=function(t,e,r,i,a){var n=1/Math.tan(e/2),s=1/(i-a);return t[0]=n/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(a+i)*s,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*a*i*s,t[15]=0,t},a.perspectiveFromFieldOfView=function(t,e,r,i){var a=Math.tan(e.upDegrees*Math.PI/180),n=Math.tan(e.downDegrees*Math.PI/180),s=Math.tan(e.leftDegrees*Math.PI/180),o=Math.tan(e.rightDegrees*Math.PI/180),h=2/(s+o),u=2/(a+n);return t[0]=h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=-(s-o)*h*.5,t[9]=(a-n)*u*.5,t[10]=i/(r-i),t[11]=-1,t[12]=0,t[13]=0,t[14]=i*r/(r-i),t[15]=0,t},a.ortho=function(t,e,r,i,a,n,s){var o=1/(e-r),h=1/(i-a),u=1/(n-s);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+r)*o,t[13]=(a+i)*h,t[14]=(s+n)*u,t[15]=1,t},a.lookAt=function(t,e,r,n){var s,o,h,u,c,l,d,_,f,g,p=e[0],m=e[1],v=e[2],S=n[0],b=n[1],x=n[2],y=r[0],M=r[1],T=r[2];return Math.abs(p-y)<i.EPSILON&&Math.abs(m-M)<i.EPSILON&&Math.abs(v-T)<i.EPSILON?a.identity(t):(d=p-y,_=m-M,f=v-T,g=1/Math.sqrt(d*d+_*_+f*f),d*=g,_*=g,f*=g,s=b*f-x*_,o=x*d-S*f,h=S*_-b*d,g=Math.sqrt(s*s+o*o+h*h),g?(g=1/g,s*=g,o*=g,h*=g):(s=0,o=0,h=0),u=_*h-f*o,c=f*s-d*h,l=d*o-_*s,g=Math.sqrt(u*u+c*c+l*l),g?(g=1/g,u*=g,c*=g,l*=g):(u=0,c=0,l=0),t[0]=s,t[1]=u,t[2]=d,t[3]=0,t[4]=o,t[5]=c,t[6]=_,t[7]=0,t[8]=h,t[9]=l,t[10]=f,t[11]=0,t[12]=-(s*p+o*m+h*v),t[13]=-(u*p+c*m+l*v),t[14]=-(d*p+_*m+f*v),t[15]=1,t)},a.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},a.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))},a.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t},a.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t},a.sub=a.subtract,a.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t},a.multiplyScalarAndAdd=function(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t[9]=e[9]+r[9]*i,t[10]=e[10]+r[10]*i,t[11]=e[11]+r[11]*i,t[12]=e[12]+r[12]*i,t[13]=e[13]+r[13]*i,t[14]=e[14]+r[14]*i,t[15]=e[15]+r[15]*i,t},a.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},a.equals=function(t,e){var r=t[0],a=t[1],n=t[2],s=t[3],o=t[4],h=t[5],u=t[6],c=t[7],l=t[8],d=t[9],_=t[10],f=t[11],g=t[12],p=t[13],m=t[14],v=t[15],S=e[0],b=e[1],x=e[2],y=e[3],M=e[4],T=e[5],A=e[6],C=e[7],I=e[8],w=e[9],E=e[10],N=e[11],R=e[12],O=e[13],F=e[14],P=e[15];return Math.abs(r-S)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(S))&&Math.abs(a-b)<=i.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(n-x)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(x))&&Math.abs(s-y)<=i.EPSILON*Math.max(1,Math.abs(s),Math.abs(y))&&Math.abs(o-M)<=i.EPSILON*Math.max(1,Math.abs(o),Math.abs(M))&&Math.abs(h-T)<=i.EPSILON*Math.max(1,Math.abs(h),Math.abs(T))&&Math.abs(u-A)<=i.EPSILON*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(c-C)<=i.EPSILON*Math.max(1,Math.abs(c),Math.abs(C))&&Math.abs(l-I)<=i.EPSILON*Math.max(1,Math.abs(l),Math.abs(I))&&Math.abs(d-w)<=i.EPSILON*Math.max(1,Math.abs(d),Math.abs(w))&&Math.abs(_-E)<=i.EPSILON*Math.max(1,Math.abs(_),Math.abs(E))&&Math.abs(f-N)<=i.EPSILON*Math.max(1,Math.abs(f),Math.abs(N))&&Math.abs(g-R)<=i.EPSILON*Math.max(1,Math.abs(g),Math.abs(R))&&Math.abs(p-O)<=i.EPSILON*Math.max(1,Math.abs(p),Math.abs(O))&&Math.abs(m-F)<=i.EPSILON*Math.max(1,Math.abs(m),Math.abs(F))&&Math.abs(v-P)<=i.EPSILON*Math.max(1,Math.abs(v),Math.abs(P))},t.exports=a},function(t,e,r){var i=r(27),a=r(104),n=r(105),s=r(106),o={};o.create=function(){var t=new i.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},o.rotationTo=function(){var t=n.create(),e=n.fromValues(1,0,0),r=n.fromValues(0,1,0);return function(i,a,s){var h=n.dot(a,s);return h<-.999999?(n.cross(t,e,a),n.length(t)<1e-6&&n.cross(t,r,a),n.normalize(t,t),o.setAxisAngle(i,t,Math.PI),i):h>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(n.cross(t,a,s),i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=1+h,o.normalize(i,i))}}(),o.setAxes=function(){var t=a.create();return function(e,r,i,a){return t[0]=i[0],t[3]=i[1],t[6]=i[2],t[1]=a[0],t[4]=a[1],t[7]=a[2],t[2]=-r[0],t[5]=-r[1],t[8]=-r[2],o.normalize(e,o.fromMat3(e,t))}}(),o.clone=s.clone,o.fromValues=s.fromValues,o.copy=s.copy,o.set=s.set,o.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},o.setAxisAngle=function(t,e,r){r*=.5;var i=Math.sin(r);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(r),t},o.getAxisAngle=function(t,e){var r=2*Math.acos(e[3]),i=Math.sin(r/2);return 0!=i?(t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i):(t[0]=1,t[1]=0,t[2]=0),r},o.add=s.add,o.multiply=function(t,e,r){var i=e[0],a=e[1],n=e[2],s=e[3],o=r[0],h=r[1],u=r[2],c=r[3];return t[0]=i*c+s*o+a*u-n*h,t[1]=a*c+s*h+n*o-i*u,t[2]=n*c+s*u+i*h-a*o,t[3]=s*c-i*o-a*h-n*u,t},o.mul=o.multiply,o.scale=s.scale,o.rotateX=function(t,e,r){r*=.5;var i=e[0],a=e[1],n=e[2],s=e[3],o=Math.sin(r),h=Math.cos(r);return t[0]=i*h+s*o,t[1]=a*h+n*o,t[2]=n*h-a*o,t[3]=s*h-i*o,t},o.rotateY=function(t,e,r){r*=.5;var i=e[0],a=e[1],n=e[2],s=e[3],o=Math.sin(r),h=Math.cos(r);return t[0]=i*h-n*o,t[1]=a*h+s*o,t[2]=n*h+i*o,t[3]=s*h-a*o,t},o.rotateZ=function(t,e,r){r*=.5;var i=e[0],a=e[1],n=e[2],s=e[3],o=Math.sin(r),h=Math.cos(r);return t[0]=i*h+a*o,t[1]=a*h-i*o,t[2]=n*h+s*o,t[3]=s*h-n*o,t},o.calculateW=function(t,e){var r=e[0],i=e[1],a=e[2];return t[0]=r,t[1]=i,t[2]=a,t[3]=Math.sqrt(Math.abs(1-r*r-i*i-a*a)),t},o.dot=s.dot,o.lerp=s.lerp,o.slerp=function(t,e,r,i){var a,n,s,o,h,u=e[0],c=e[1],l=e[2],d=e[3],_=r[0],f=r[1],g=r[2],p=r[3];return n=u*_+c*f+l*g+d*p,n<0&&(n=-n,_=-_,f=-f,g=-g,p=-p),1-n>1e-6?(a=Math.acos(n),s=Math.sin(a),o=Math.sin((1-i)*a)/s,h=Math.sin(i*a)/s):(o=1-i,h=i),t[0]=o*u+h*_,t[1]=o*c+h*f,t[2]=o*l+h*g,t[3]=o*d+h*p,t},o.sqlerp=function(){var t=o.create(),e=o.create();return function(r,i,a,n,s,h){return o.slerp(t,i,s,h),o.slerp(e,a,n,h),o.slerp(r,t,e,2*h*(1-h)),r}}(),o.invert=function(t,e){var r=e[0],i=e[1],a=e[2],n=e[3],s=r*r+i*i+a*a+n*n,o=s?1/s:0;return t[0]=-r*o,t[1]=-i*o,t[2]=-a*o,t[3]=n*o,t},o.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},o.length=s.length,o.len=o.length,o.squaredLength=s.squaredLength,o.sqrLen=o.squaredLength,o.normalize=s.normalize,o.fromMat3=function(t,e){var r,i=e[0]+e[4]+e[8];if(i>0)r=Math.sqrt(i+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var a=0;e[4]>e[0]&&(a=1),e[8]>e[3*a+a]&&(a=2);var n=(a+1)%3,s=(a+2)%3;r=Math.sqrt(e[3*a+a]-e[3*n+n]-e[3*s+s]+1),t[a]=.5*r,r=.5/r,t[3]=(e[3*n+s]-e[3*s+n])*r,t[n]=(e[3*n+a]+e[3*a+n])*r,t[s]=(e[3*s+a]+e[3*a+s])*r}return t},o.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},o.exactEquals=s.exactEquals,o.equals=s.equals,t.exports=o},function(t,e,r){var i=r(27),a={};a.create=function(){var t=new i.ARRAY_TYPE(2);return t[0]=0,t[1]=0,t},a.clone=function(t){var e=new i.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},a.fromValues=function(t,e){var r=new i.ARRAY_TYPE(2);return r[0]=t,r[1]=e,r},a.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},a.set=function(t,e,r){return t[0]=e,t[1]=r,t},a.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t},a.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t},a.sub=a.subtract,a.multiply=function(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t},a.mul=a.multiply,a.divide=function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t},a.div=a.divide,a.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},a.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},a.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t},a.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t},a.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},a.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t},a.scaleAndAdd=function(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t},a.distance=function(t,e){var r=e[0]-t[0],i=e[1]-t[1];return Math.sqrt(r*r+i*i)},a.dist=a.distance,a.squaredDistance=function(t,e){var r=e[0]-t[0],i=e[1]-t[1];return r*r+i*i},a.sqrDist=a.squaredDistance,a.length=function(t){var e=t[0],r=t[1];return Math.sqrt(e*e+r*r)},a.len=a.length,a.squaredLength=function(t){var e=t[0],r=t[1];return e*e+r*r},a.sqrLen=a.squaredLength,a.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},a.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},a.normalize=function(t,e){var r=e[0],i=e[1],a=r*r+i*i;return a>0&&(a=1/Math.sqrt(a),t[0]=e[0]*a,t[1]=e[1]*a),t},a.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},a.cross=function(t,e,r){var i=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=i,t},a.lerp=function(t,e,r,i){var a=e[0],n=e[1];return t[0]=a+i*(r[0]-a),t[1]=n+i*(r[1]-n),t},a.random=function(t,e){e=e||1;var r=2*i.RANDOM()*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t},a.transformMat2=function(t,e,r){var i=e[0],a=e[1];return t[0]=r[0]*i+r[2]*a,t[1]=r[1]*i+r[3]*a,t},a.transformMat2d=function(t,e,r){var i=e[0],a=e[1];return t[0]=r[0]*i+r[2]*a+r[4],t[1]=r[1]*i+r[3]*a+r[5],t},a.transformMat3=function(t,e,r){var i=e[0],a=e[1];return t[0]=r[0]*i+r[3]*a+r[6],t[1]=r[1]*i+r[4]*a+r[7],t},a.transformMat4=function(t,e,r){var i=e[0],a=e[1];return t[0]=r[0]*i+r[4]*a+r[12],t[1]=r[1]*i+r[5]*a+r[13],t},a.forEach=function(){var t=a.create();return function(e,r,i,a,n,s){var o,h;for(r||(r=2),i||(i=0),h=a?Math.min(a*r+i,e.length):e.length,o=i;o<h;o+=r)t[0]=e[o],t[1]=e[o+1],n(t,t,s),e[o]=t[0],e[o+1]=t[1];return e}}(),a.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},a.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},a.equals=function(t,e){var r=t[0],a=t[1],n=e[0],s=e[1];return Math.abs(r-n)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(a-s)<=i.EPSILON*Math.max(1,Math.abs(a),Math.abs(s))},t.exports=a},function(t,e,r){"use strict";e.a={ArrayType:Float64Array}},function(t,e,r){"use strict";var i=r(2),a=r(22),n=function(t,e,r,i){this._target=t,this._internalFormat=e,this._width=r,this._height=i,this._size=0,this.computeSize()};n.prototype={match:function(t){return t._target===this._target&&t._internalFormat===this._internalFormat&&t._width===this._width&&t._height===this._height},computeSize:function(){var t=r(7).default,e=0;switch(this._internalFormat){case 1:case t.ALPHA:case t.LUMINANCE:e=8;break;case t.LUMINANCE_ALPHA:case 2:e=16;break;case t.RGB:case 3:e=24;break;case t.RGBA:case 4:e=32}var i=Math.ceil(this._width*this._height*e)/8;this._target===t.TEXTURE_CUBE_MAP&&(i*=6),i+=i/3,this._size=i},getSize:function(){return this._size}},n.getHash=function(){var t=Array.prototype.slice.call(arguments),e="";return t.forEach(function(t){e+=t}),e};var s=function(t,e,r){this._texture=t,this._id=e,this._textureSet=r};s.prototype={target:function(){return this._textureSet._profile._target},id:function(){return this._id},getTextureSet:function(){return this._textureSet},reset:function(){this._textureObject=null,this._texture=void 0},bind:function(t){t.bindTexture(this.target(),this._id)}};var o=function(t){this._profile=t,this._usedTextureObjects=[],this._orphanedTextureObjects=[]};o.prototype={getProfile:function(){return this._profile},getUsedTextureObjects:function(){return this._usedTextureObjects},getOrphanedTextureObjects:function(){return this._orphanedTextureObjects},takeOrGenerate:function(t,e){var r;if(this._orphanedTextureObjects.length>0)return r=this.takeFromOrphans(),r._texture=e,this._usedTextureObjects.push(r),r;var i=t.createTexture();return r=new s(e,i,this),this._usedTextureObjects.push(r),r},takeFromOrphans:function(){if(this._orphanedTextureObjects.length)return this._orphanedTextureObjects.pop()},orphan:function(t){var e=this._usedTextureObjects.indexOf(t);-1!==e&&(this._orphanedTextureObjects.push(this._usedTextureObjects[e]),this._usedTextureObjects.splice(e,1))},flushDeletedTextureObjects:function(t,e){if(e<=0)return e;var r,i=this._orphanedTextureObjects.length,n=0,s=a.a.instance().tick();for(r=0;r<i&&n<e;r++)t.deleteTexture(this._orphanedTextureObjects[r].id()),this._orphanedTextureObjects[r].reset(),n=a.a.instance().deltaS(s,a.a.instance().tick());return this._orphanedTextureObjects.splice(0,r),e-n},flushAllDeletedTextureObjects:function(t){for(var e=this._orphanedTextureObjects.length,r=this.getProfile().getSize(),a=0,n=e;a<n;++a)t.deleteTexture(this._orphanedTextureObjects[a].id()),this._orphanedTextureObjects[a].reset();this._orphanedTextureObjects.length=0,i.a.info("TextureManager: released "+e+" with "+e*r/1048576+" MB")},onLostContext:function(){var t,e;for(e=this._orphanedTextureObjects.length,t=0;t<e;++t)this._orphanedTextureObjects[t].reset();for(this._orphanedTextureObjects.length=0,e=this._usedTextureObjects.length,t=0;t<e;++t)this._usedTextureObjects[t].reset();this._usedTextureObjects.length=0}};var h=function(){this._textureSetMap={}};h.prototype={generateTextureObject:function(t,e,r,i,a,s){var h=n.getHash(r,i,a,s);return void 0===this._textureSetMap[h]&&(this._textureSetMap[h]=new o(new n(r,i,a,s))),this._textureSetMap[h].takeOrGenerate(t,e)},updateStats:function(t,e){var r=0,i=0;for(var a in this._textureSetMap){var n=this._textureSetMap[a].getProfile(),s=n.getSize(),o=this._textureSetMap[a].getUsedTextureObjects().length,h=this._textureSetMap[a].getOrphanedTextureObjects().length;r+=o*s,i+=h*s}var u=1048576;e.getCounter("textureused").set(r/u),e.getCounter("texturereserved").set(i/u),e.getCounter("texturetotal").set((r+i)/u)},reportStats:function(){var t=0;for(var e in this._textureSetMap){var r=this._textureSetMap[e].getProfile(),a=r.getSize()/1048576,n=this._textureSetMap[e].getUsedTextureObjects().length;a*=n,t+=a,i.a.notice(String(a)+" MB with "+n+" texture of "+r._width+"x"+r._height+" "+r._internalFormat)}i.a.notice(String(t)+" MB in total")},flushAllDeletedTextureObjects:function(t){for(var e in this._textureSetMap)this._textureSetMap[e].flushAllDeletedTextureObjects(t)},onLostContext:function(t){for(var e in this._textureSetMap)this._textureSetMap[e].onLostContext(t)},flushDeletedTextureObjects:function(t,e){var r=e;for(var i in this._textureSetMap)if((r=this._textureSetMap[i].flushDeletedTextureObjects(t,r))<=0)break;return r},releaseTextureObject:function(t){if(t){t.getTextureSet().orphan(t)}}},e.a=h},function(t,e,r){"use strict";var i=r(0),a=r(4),n=function(){a.a.call(this),this._attributeEnable=!1};i.a.createPrototypeStateAttribute(n,i.a.objectInherit(a.a.prototype,{attributeType:"Billboard",cloneType:function(){return new n},setEnabled:function(t){this._attributeEnable=t},isEnabled:function(){return this._attributeEnable},apply:function(){}}),"osg","Billboard"),e.a=n},function(t,e,r){"use strict";var i=r(0),a=r(4),n=r(1),s=function(t){a.a.call(this),this._constantColor=n.g.create(),n.g.set(this._constantColor,1,1,1,1),void 0!==t&&this.setConstantColor(t)};i.a.createPrototypeStateAttribute(s,i.a.objectInherit(a.a.prototype,{attributeType:"BlendColor",cloneType:function(){return new s},setConstantColor:function(t){n.g.copy(this._constantColor,t)},getConstantColor:function(){return this._constantColor},apply:function(t){t.getGraphicContext().blendColor(this._constantColor[0],this._constantColor[1],this._constantColor[2],this._constantColor[3])}}),"osg","BlendColor"),e.a=s},function(t,e,r){"use strict";var i=r(0),a=r(4),n=function(t,e,r,i){a.a.call(this),this._red=!0,this._green=!0,this._blue=!0,this._alpha=!0,void 0!==t&&void 0!==e&&void 0!==r&&this.setMask(t,e,r,i)};i.a.createPrototypeStateAttribute(n,i.a.objectInherit(a.a.prototype,{attributeType:"ColorMask",cloneType:function(){return new n},setMask:function(t,e,r,i){this._red=!!t,this._green=!!e,this._blue=!!r,this._alpha=!!i},apply:function(t){t.applyColorMask(this)}}),"osg","ColorMask"),e.a=n},function(t,e,r){"use strict";var i=r(0),a=r(2),n=r(5),s=r(191),o=function(){n.a.call(this)};i.a.createPrototypeObject(o,i.a.objectInherit(n.a.prototype,{init:function(t){var e=new s.a;if(t.getParents().length>1&&a.a.warn("A RigGeometry should not have multi parent ( "+t.getName()+" )"),t.getParents()[0].accept(e),!e._root)return void a.a.warn("A RigGeometry did not find a parent skeleton for RigGeometry ( "+t.getName()+" )");t.setSkeleton(e._root),t.setPathToSkeleton(e._pathToRoot)},update:function(t){if(t&&"RigGeometry"!==t.className())return!0;var e=t;return e.getSkeleton()||0===e.getParents().length||this.init(e),!e.getSkeleton()||(e.getNeedToComputeMatrix()&&e.computeMatrixFromRootSkeleton(),e.update(),!0)}}),"osgAnimation","UpdateRigGeometry"),e.a=o},function(t,e,r){"use strict";var i=r(0),a=r(3),n=r(66),s=function(){a.a.call(this,a.a.TRAVERSE_PARENTS),this._root=void 0,this._pathToRoot=void 0};i.a.createPrototypeObject(s,i.a.objectInherit(a.a.prototype,{apply:function(t){if(!this._root)return t.typeID===n.a.typeID?(this._root=t,void(this._pathToRoot=this.nodePath.slice(1))):void this.traverse(t)}}),"osgAnimation","FindNearestParentSkeleton"),e.a=s},function(t,e,r){"use strict";var i=r(1),a=r(4),n=r(114),s=r(193),o=function(){this._isInitialized=!1,this._bones=[]};o.prototype={computeBonePalette:function(t,e){var r=this._bones;for(var i in t){var a=e[i],n=t[i];void 0!==a&&(r[a]=n)}return r},init:function(t){var e=new s.a;t.getSkeleton().accept(e);var r=e.getBoneMap();this.computeBonePalette(r,t._boneNameID);var i=3*this._bones.length,o=this._skinningAttribute=new n.a;return o.setMatrixPalette(new Float32Array(4*i)),t.getStateSetAnimation().setAttributeAndModes(o,a.a.ON),this._isInitialized=!0,!0},computeMatrixPalette:function(){var t=i.c.create();return function(e,r){for(var a=this._bones,n=this._skinningAttribute.getMatrixPalette(),s=0,o=0,h=a.length;o<h;o++){var u=a[o],c=u.getInvBindMatrixInSkeletonSpace(),l=u.getMatrixInSkeletonSpace();i.c.mul(t,l,c),i.c.mul(t,r,t),i.c.mul(t,t,e),n[s++]=t[0],n[s++]=t[4],n[s++]=t[8],n[s++]=t[12],n[s++]=t[1],n[s++]=t[5],n[s++]=t[9],n[s++]=t[13],n[s++]=t[2],n[s++]=t[6],n[s++]=t[10],n[s++]=t[14]}}}(),update:function(t){this._isInitialized||this.init(t),this.computeMatrixPalette(t.getMatrixFromSkeletonToGeometry(),t.getInvMatrixFromSkeletonToGeometry())}},e.a=o},function(t,e,r){"use strict";var i=r(0),a=r(3),n=r(2),s=r(44),o=function(){a.a.call(this,a.a.TRAVERSE_ALL_CHILDREN),this._boneMap={}};i.a.createPrototypeObject(o,i.a.objectInherit(a.a.prototype,{apply:function(t){if(t.typeID===s.a.typeID){var e=t.getName();e?this._boneMap[e]=t:n.a.warn("found Bone without name")}this.traverse(t)},getBoneMap:function(){return this._boneMap}}),"osgAnimation","CollectBoneVisitor"),e.a=o},function(t,e,r){"use strict";var i=r(1),a=function(){this._radiusEquator=a.WGS_84_RADIUS_EQUATOR,this._radiusPolar=a.WGS_84_RADIUS_POLAR,this.computeCoefficients()};a.WGS_84_RADIUS_EQUATOR=6378137,a.WGS_84_RADIUS_POLAR=6356752.3142,a.prototype={setRadiusEquator:function(t){this._radiusEquator=t,this.computeCoefficients()},getRadiusEquator:function(){return this._radiusEquator},setRadiusPolar:function(t){this._radiusPolar=t,this.computeCoefficients()},getRadiusPolar:function(){return this._radiusPolar},convertLatLongHeightToXYZ:function(t,e,r,i){var a=Math.sin(t),n=Math.cos(t),s=this._radiusEquator/Math.sqrt(1-this._eccentricitySquared*a*a),o=(s+r)*n*Math.cos(e),h=(s+r)*n*Math.sin(e),u=(s*(1-this._eccentricitySquared)+r)*a;return i[0]=o,i[1]=h,i[2]=u,i},convertXYZToLatLongHeight:function(t,e,r,i){var a=Math.sqrt(t*t+e*e),n=Math.atan2(r*this._radiusEquator,a*this._radiusPolar),s=(this._radiusEquator*this._radiusEquator-this._radiusPolar*this._radiusPolar)/(this._radiusPolar*this._radiusPolar),o=Math.sin(n),h=Math.cos(n),u=Math.atan((r+s*this._radiusPolar*o*o*o)/(a-this._eccentricitySquared*this._radiusEquator*h*h*h)),c=Math.atan2(e,t),l=Math.sin(u),d=this._radiusEquator/Math.sqrt(1-this._eccentricitySquared*l*l),_=Math.cos(u);0===_&&(_=1);var f=a/_-d;return i[0]=u,i[1]=c,i[2]=f,i},computeLocalUpVector:function(t,e,r){var a,n,s=this.convertXYZToLatLongHeight(t,e,r,i.f.create());return a=s[0],n=s[1],[Math.cos(n)*Math.cos(a),Math.sin(n)*Math.cos(a),Math.sin(a)]},isWGS84:function(){return this._radiusEquator===a.WGS_84_RADIUS_EQUATOR&&this._radiusPolar===a.WGS_84_RADIUS_POLAR},computeCoefficients:function(){var t=(this._radiusEquator-this._radiusPolar)/this._radiusEquator;this._eccentricitySquared=2*t-t*t},computeLocalToWorldTransformFromLatLongHeight:function(t,e,r,a){var n=this.convertLatLongHeightToXYZ(t,e,r,a);return i.c.fromTranslation(a,n),this.computeCoordinateFrame(t,e,a),a},computeLocalToWorldTransformFromXYZ:function(t,e,r){var a=this.convertXYZToLatLongHeight(t,e,r,i.f.create()),n=i.c.fromTranslation(i.c.create(),i.f.fromValues(t,e,r));return this.computeCoordinateFrame(a[0],a[1],n),n},computeCoordinateFrame:function(){var t=i.f.create(),e=i.f.create(),r=i.f.create();return function(a,n,s){t[0]=Math.cos(n)*Math.cos(a),t[1]=Math.sin(n)*Math.cos(a),t[2]=Math.sin(a),e[0]=-Math.sin(n),e[1]=-Math.cos(n),i.f.cross(r,t,e),i.c.set(s,e[0],e[1],e[2],0,r[0],r[1],r[2],0,t[0],t[1],t[2],0,0,0,0,1)}}()},e.a=a},function(t,e,r){"use strict";var i=r(14),a=r.n(i),n=r(0),s=r(41),o=function(t){s.a.call(this,t),this._canPlayDefered=void 0};o.PAUSE=0,o.PLAYING=1,n.a.createPrototypeObject(o,n.a.objectInherit(s.a.prototype,{isDirty:function(){return this._status===o.PLAYING},setImage:function(t){s.a.prototype.setImage.call(this,t),this._status=o.STOP,t.addEventListener("ended",function(){this._imageObject.loop||this.stop()}.bind(this),!0),this.dirty()},setLooping:function(t){this._imageObject.loop=t},play:function(){this._imageObject.play(),this._status=o.PLAYING},stop:function(){this._imageObject.pause(),this._status=o.PAUSE},whenReady:function(){if(!this._imageObject)return a.a.reject();var t=this;return new a.a(function(e){t._canPlayDefered||(t._canPlayDefered=e,t._imageObject.readyState>3?t._canPlayDefered(t):t._imageObject.addEventListener("canplaythrough",t._canPlayDefered.bind(t._canPlayDefered,t),!0))})}}),"osg","ImageStream"),e.a=o},function(t,e,r){"use strict";var i=r(0),a=r(3),n=r(117),s=function(t){if(a.a.call(this),this._buildOptions={_numVerticesProcessed:0,_targetNumTrianglesPerLeaf:50,_maxNumLevels:20},t){var e=t._targetNumTrianglesPerLeaf,r=t._maxNumLevels;void 0!==e&&(this._buildOptions._targetNumTrianglesPerLeaf=e),void 0!==r&&(this._buildOptions._maxNumLevels=r)}};i.a.createPrototypeObject(s,i.a.objectInherit(a.a.prototype,{apply:function(t){if(t.getShape){if(void 0===t.getShape()){var e=new n.a;e.build(this._buildOptions,t)&&t.setShape(e)}}this.traverse(t)}}),"osg","KdTreeBuilder"),e.a=s},function(t,e,r){"use strict";var i=r(0),a=r(4),n=function(t){a.a.call(this),this.lineWidth=1,void 0!==t&&(this.lineWidth=t)};i.a.createPrototypeStateAttribute(n,i.a.objectInherit(a.a.prototype,{attributeType:"LineWidth",cloneType:function(){return new n},apply:function(t){t.getGraphicContext().lineWidth(this.lineWidth)}}),"osg","LineWidth"),e.a=n},function(t,e,r){"use strict";var i=r(0),a=r(4),n=r(6),s=function(t){a.a.call(this),this._enable=!t,this._pointSize=1,this._circleShape=!1,this._dirtyHash=!0,this._hash=""};i.a.createPrototypeStateAttribute(s,i.a.objectInherit(a.a.prototype,{attributeType:"PointSize",cloneType:function(){return new s(!0)},setCircleShape:function(t){this._circleShape=t,this._dirtyHash=!0},isCircleShape:function(){return this._circleShape},setEnabled:function(t){this._enable=t,this._dirtyHash=!0},isEnabled:function(){return this._enable},setPointSize:function(t){this._pointSize=t},getOrCreateUniforms:function(){var t=s;return t.uniforms?t.uniforms:(t.uniforms={pointSize:n.a.createFloat(1,"uPointSize")},t.uniforms)},getHash:function(){return this._dirtyHash?(this._hash=this._computeInternalHash(),this._dirtyHash=!1,this._hash):this._hash},_computeInternalHash:function(){return this.getTypeMember()+(this.isEnabled()?"1":"0")+(this._circleShape?"1":"0")},apply:function(){if(this._enable){this.getOrCreateUniforms().pointSize.setFloat(this._pointSize)}}}),"osg","PointSizeAttribute"),e.a=s},function(t,e,r){"use strict";var i=r(1),a=r(9),n=r(18),s=r(20),o=[],h=[];o[a.a.POINTS]=function(){var t=i.f.create();return function(e,r,i,a,n){for(var s=e+r,o=e;o<s;++o){var h=3*i[o];t[0]=n[h],t[1]=n[h+1],t[2]=n[h+2],a.operatorPoint(t)}}}(),o[a.a.LINES]=function(){var t=i.f.create(),e=i.f.create();return function(r,i,a,n,s){for(var o=r+i,h=r;h<o-1;h+=2){var u=3*a[h];t[0]=s[u],t[1]=s[u+1],t[2]=s[u+2],u=3*a[h+1],e[0]=s[u],e[1]=s[u+1],e[2]=s[u+2],n.operatorLine(t,e)}}}(),o[a.a.LINE_STRIP]=function(){var t=i.f.create(),e=i.f.create();return function(r,i,a,n,s){for(var o=r+i,h=r;h<o-1;++h){var u=3*a[h];t[0]=s[u],t[1]=s[u+1],t[2]=s[u+2],u=3*a[h+1],e[0]=s[u],e[1]=s[u+1],e[2]=s[u+2],n.operatorLine(t,e)}}}(),o[a.a.LINE_LOOP]=function(){var t=i.f.create(),e=i.f.create();return function(r,i,a,n,s){for(var o=r+i-1,h=r;h<o;++h){var u=3*a[h];t[0]=s[u],t[1]=s[u+1],t[2]=s[u+2],u=3*a[h+1],e[0]=s[u],e[1]=s[u+1],e[2]=s[u+2],n.operatorLine(t,e)}o=3*a[o],t[0]=s[o],t[1]=s[o+1],t[2]=s[o+2];var c=3*a[0];e[0]=s[c],e[1]=s[c+1],e[2]=s[c+2],n.operatorLine(t,e)}}(),o[a.a.TRIANGLES]=function(){var t=i.f.create(),e=i.f.create(),r=i.f.create();return function(i,a,n,s,o){for(var h=i+a,u=i;u<h;u+=3){var c=3*n[u];t[0]=o[c],t[1]=o[c+1],t[2]=o[c+2],c=3*n[u+1],e[0]=o[c],e[1]=o[c+1],e[2]=o[c+2],c=3*n[u+2],r[0]=o[c],r[1]=o[c+1],r[2]=o[c+2],s.operatorTriangle(t,e,r)}}}(),o[a.a.TRIANGLE_STRIP]=function(){var t=i.f.create(),e=i.f.create(),r=i.f.create();return function(i,a,n,s,o){for(var h=2,u=i;h<a;++h,++u){var c=3*n[u];t[0]=o[c],t[1]=o[c+1],t[2]=o[c+2],c=3*n[u+1],e[0]=o[c],e[1]=o[c+1],e[2]=o[c+2],c=3*n[u+2],r[0]=o[c],r[1]=o[c+1],r[2]=o[c+2],h%2?s.operatorTriangle(t,r,e):s.operatorTriangle(t,e,r)}}}(),o[a.a.TRIANGLE_FAN]=function(){var t=i.f.create(),e=i.f.create(),r=i.f.create();return function(i,a,n,s,o){for(var h=n[i],u=2,c=i+1;u<a;++u,++c){t[0]=o[h],t[1]=o[h+1],t[2]=o[h+2];var l=3*n[c];e[0]=o[l],e[1]=o[l+1],e[2]=o[l+2],l=3*n[c+1],r[0]=o[l],r[1]=o[l+1],r[2]=o[l+2],s.operatorTriangle(t,e,r)}}}(),h[a.a.POINTS]=function(){var t=i.f.create();return function(e,r,i,a){for(var n=e;n<e+r;++n){var s=3*n;t[0]=a[s],t[1]=a[s+1],t[2]=a[s+2],i.operatorPoint(t)}}}(),h[a.a.LINES]=function(){var t=i.f.create(),e=i.f.create();return function(r,i,a,n){for(var s=r;s<r+i-1;s+=2){var o=3*s;t[0]=n[o],t[1]=n[o+1],t[2]=n[o+2],o=3*(s+1),e[0]=n[o],e[1]=n[o+1],e[2]=n[o+2],a.operatorLine(t,e)}}}(),h[a.a.LINE_STRIP]=function(){var t=i.f.create(),e=i.f.create();return function(r,i,a,n){for(var s=r;s<r+i-1;++s){var o=3*s;t[0]=n[o],t[1]=n[o+1],t[2]=n[o+2],o=3*(s+1),e[0]=n[o],e[1]=n[o+1],e[2]=n[o+2],a.operatorLine(t,e)}}}(),h[a.a.LINE_LOOP]=function(){var t=i.f.create(),e=i.f.create();return function(r,i,a,n){for(var s=r+i-1,o=r;o<s;++o){var h=3*o;t[0]=n[h],t[1]=n[h+1],t[2]=n[h+2],h=3*(o+1),e[0]=n[h],e[1]=n[h+1],e[2]=n[h+2],a.operatorLine(t,e)}s*=3,t[0]=n[s],t[1]=n[s+1],t[2]=n[s+2],r*=3,e[0]=n[r],e[1]=n[r+1],e[2]=n[r+2],a.operatorLine(t,e)}}(),h[a.a.TRIANGLES]=function(){var t=i.f.create(),e=i.f.create(),r=i.f.create();return function(i,a,n,s){for(var o=i;o<i+a;o+=3){var h=3*o;t[0]=s[h],t[1]=s[h+1],t[2]=s[h+2],h=3*(o+1),e[0]=s[h],e[1]=s[h+1],e[2]=s[h+2],h=3*(o+2),r[0]=s[h],r[1]=s[h+1],r[2]=s[h+2],n.operatorTriangle(t,e,r)}}}(),h[a.a.TRIANGLE_STRIP]=function(){var t=i.f.create(),e=i.f.create(),r=i.f.create();return function(i,a,n,s){for(var o=2,h=i;o<a;++o,++h){var u=3*h;t[0]=s[u],t[1]=s[u+1],t[2]=s[u+2],u=3*(h+1),e[0]=s[u],e[1]=s[u+1],e[2]=s[u+2],u=3*(h+2),r[0]=s[u],r[1]=s[u+1],r[2]=s[u+2],o%2?n.operatorTriangle(t,r,e):n.operatorTriangle(t,e,r)}}}(),h[a.a.TRIANGLE_FAN]=function(){var t=i.f.create(),e=i.f.create(),r=i.f.create();return function(i,a,n,s){for(var o=2,h=i+1;o<a;++o,++h){t[0]=s[i],t[1]=s[i+1],t[2]=s[i+2];var u=3*h;e[0]=s[u],e[1]=s[u+1],e[2]=s[u+2],u=3*(h+1),r[0]=s[u],r[1]=s[u+1],r[2]=s[u+2],n.operatorTriangle(t,e,r)}}}();var u=function(t,e,r){var i=t.getPrimitiveSetList();if(i)for(var a,u=i.length,c=0;c<u;c++){var l=i[c];if(l instanceof n.a){if(a=o[l.getMode()]){var d=l.indices.getElements();a(l.getFirst()/d.BYTES_PER_ELEMENT,l.getCount(),d,e,r)}}else l instanceof s.a&&(a=h[l.getMode()])&&a(l.getFirst(),l.getCount(),e,r)}};e.a=u},function(t,e){t.exports="#define PI 3.141593\r\n#define saturate(_x) clamp(_x, 0., 1.)\r\n"},function(t,e){t.exports="// approximation such as http://chilliant.blogspot.fr/2012/08/srgb-approximations-for-hlsl.html\r\n// introduced slightly darker colors and more slight banding in the darks.\r\n\r\n// so we stick with the reference implementation (except we don't check if color >= 0.0):\r\n// https://www.khronos.org/registry/gles/extensions/EXT/EXT_sRGB.txt\r\n#define LIN_SRGB(x) x < 0.0031308 ? x * 12.92 : 1.055 * pow(x, 1.0/2.4) - 0.055\r\n#define SRGB_LIN(x) x < 0.04045 ? x * (1.0 / 12.92) : pow((x + 0.055) * (1.0 / 1.055), 2.4)\r\n\r\n#pragma DECLARE_FUNCTION\r\nfloat linearTosRGB(const in float color) { return LIN_SRGB(color); }\r\n\r\n#pragma DECLARE_FUNCTION\r\nvec3 linearTosRGB(const in vec3 color) { return vec3(LIN_SRGB(color.r), LIN_SRGB(color.g), LIN_SRGB(color.b)); }\r\n\r\n#pragma DECLARE_FUNCTION\r\nvec4 linearTosRGB(const in vec4 color) { return vec4(LIN_SRGB(color.r), LIN_SRGB(color.g), LIN_SRGB(color.b), color.a); }\r\n\r\n#pragma DECLARE_FUNCTION NODE_NAME:sRGBToLinear\r\nfloat sRGBToLinear(const in float color) { return SRGB_LIN(color); }\r\n\r\n#pragma DECLARE_FUNCTION NODE_NAME:sRGBToLinear\r\nvec3 sRGBToLinear(const in vec3 color) { return vec3(SRGB_LIN(color.r), SRGB_LIN(color.g), SRGB_LIN(color.b)); }\r\n\r\n#pragma DECLARE_FUNCTION NODE_NAME:sRGBToLinear\r\nvec4 sRGBToLinear(const in vec4 color) { return vec4(SRGB_LIN(color.r), SRGB_LIN(color.g), SRGB_LIN(color.b), color.a); }\r\n\r\n//http://graphicrants.blogspot.fr/2009/04/rgbm-color-encoding.html\r\nvec3 RGBMToRGB( const in vec4 rgba ) {\r\n    const float maxRange = 8.0;\r\n    return rgba.rgb * maxRange * rgba.a;\r\n}\r\n\r\nconst mat3 LUVInverse = mat3( 6.0013, -2.700, -1.7995, -1.332, 3.1029, -5.7720, 0.3007, -1.088, 5.6268 );\r\n\r\nvec3 LUVToRGB( const in vec4 vLogLuv ) {\r\n    float Le = vLogLuv.z * 255.0 + vLogLuv.w;\r\n    vec3 Xp_Y_XYZp;\r\n    Xp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\r\n    Xp_Y_XYZp.z = Xp_Y_XYZp.y / vLogLuv.y;\r\n    Xp_Y_XYZp.x = vLogLuv.x * Xp_Y_XYZp.z;\r\n    vec3 vRGB = LUVInverse * Xp_Y_XYZp;\r\n    return max(vRGB, 0.0);\r\n}\r\n\r\n// http://graphicrants.blogspot.fr/2009/04/rgbm-color-encoding.html\r\n#pragma DECLARE_FUNCTION\r\nvec4 encodeRGBM(const in vec3 color, const in float range) {\r\n    if(range <= 0.0) return vec4(color, 1.0);\r\n    vec4 rgbm;\r\n    vec3 col = color / range;\r\n    rgbm.a = clamp( max( max( col.r, col.g ), max( col.b, 1e-6 ) ), 0.0, 1.0 );\r\n    rgbm.a = ceil( rgbm.a * 255.0 ) / 255.0;\r\n    rgbm.rgb = col / rgbm.a;\r\n    return rgbm;\r\n}\r\n\r\n#pragma DECLARE_FUNCTION\r\nvec3 decodeRGBM(const in vec4 color, const in float range) {\r\n    if(range <= 0.0) return color.rgb;\r\n    return range * color.rgb * color.a;\r\n}\r\n\r\n// https://twitter.com/pyalot/status/711956736639418369\r\n// https://github.com/mrdoob/three.js/issues/10331\r\n#pragma DECLARE_FUNCTION NODE_NAME:FrontNormal\r\n#define _frontNormal(normal) gl_FrontFacing ? normal : -normal\r\n\r\n#pragma DECLARE_FUNCTION NODE_NAME:Normalize\r\n#define _normalize(vec) normalize(vec)\r\n\r\n#pragma DECLARE_FUNCTION\r\nvec4 preMultAlpha(const in vec3 color, const in float alpha) { return vec4(color.rgb * alpha, alpha); }\r\n\r\n#pragma DECLARE_FUNCTION\r\nvec4 preMultAlpha(const in vec4 color) { return vec4(color.rgb * color.a, color.a); }\r\n\r\n#pragma DECLARE_FUNCTION\r\nvec4 setAlpha(const in vec3 color, const in float alpha) { return vec4(color, alpha); }\r\n\r\n#pragma DECLARE_FUNCTION\r\nvec4 setAlpha(const in vec3 color, const in vec4 alpha) { return vec4(color, alpha.a); }\r\n"},function(t,e){t.exports="float getLightAttenuation(const in float dist, const in vec4 lightAttenuation) {\r\n    // lightAttenuation(constantEnabled, linearEnabled, quadraticEnabled)\r\n    // TODO find a vector alu instead of 4 scalar\r\n    float constant = lightAttenuation.x;\r\n    float linear = lightAttenuation.y * dist;\r\n    float quadratic = lightAttenuation.z * dist * dist;\r\n    return 1.0 / (constant + linear + quadratic);\r\n}\r\n\r\n#pragma DECLARE_FUNCTION\r\nvoid precomputeSpot(\r\n        const in vec3 normal,\r\n        const in vec3 viewVertex,\r\n                          \r\n        const in vec3 lightViewDirection,\r\n        const in vec4 lightAttenuation,\r\n        const in vec3 lightViewPosition,\r\n        const in float lightSpotCutOff,\r\n        const in float lightSpotBlend,\r\n                          \r\n        out float attenuation,\r\n        out vec3 eyeLightDir,\r\n        out float dotNL) {\r\n\r\n    eyeLightDir = lightViewPosition - viewVertex;\r\n    float dist = length(eyeLightDir);\r\n    eyeLightDir = dist > 0.0 ? eyeLightDir / dist : vec3( 0.0, 1.0, 0.0 );\r\n\r\n    float cosCurAngle = dot(-eyeLightDir, lightViewDirection);\r\n    float spot = cosCurAngle * smoothstep(0.0, 1.0, (cosCurAngle - lightSpotCutOff) / lightSpotBlend);\r\n\r\n    dotNL = dot(eyeLightDir, normal);\r\n    attenuation = spot * getLightAttenuation(dist, lightAttenuation);\r\n}\r\n\r\n#pragma DECLARE_FUNCTION\r\nvoid precomputePoint(\r\n        const in vec3 normal,\r\n        const in vec3 viewVertex,\r\n\r\n        const in vec4 lightAttenuation,\r\n        const in vec3 lightViewPosition,\r\n\r\n        out float attenuation,\r\n        out vec3 eyeLightDir,\r\n        out float dotNL) {\r\n\r\n    eyeLightDir = lightViewPosition - viewVertex;\r\n    float dist = length(eyeLightDir);\r\n\r\n    attenuation = getLightAttenuation(dist, lightAttenuation);\r\n    eyeLightDir = dist > 0.0 ? eyeLightDir / dist :  vec3( 0.0, 1.0, 0.0 );\r\n    dotNL = dot(eyeLightDir, normal);\r\n}\r\n\r\n#pragma DECLARE_FUNCTION\r\nvoid precomputeSun(\r\n        const in vec3 normal,\r\n        const in vec3 lightViewDirection,\r\n  \r\n        out float attenuation,\r\n        out vec3 eyeLightDir,\r\n        out float dotNL) {\r\n\r\n    attenuation = 1.0;\r\n    eyeLightDir = -lightViewDirection;\r\n    dotNL = dot(eyeLightDir, normal);\r\n}"},function(t,e){t.exports='#pragma include "lightCommon.glsl"\r\n\r\n////////////////\r\n// COOK TORRANCE\r\n////////////////\r\nvec3 specularCookTorrance(\r\n        const in vec3 normal,\r\n        const in vec3 lightDir,\r\n        const in vec3 eyeVector,\r\n        const in float materialShininess,\r\n        const in vec3 materialSpecular,\r\n        const in vec3 lightSpecular) {\r\n  \r\n    vec3 h = normalize(eyeVector + lightDir);\r\n    float nh = dot(normal, h);\r\n    float specfac = 0.0;\r\n\r\n    if(nh > 0.0) {\r\n        float nv = max( dot(normal, eyeVector), 0.0 );\r\n        float i = pow(nh, materialShininess);\r\n        i = i / (0.1 + nv);\r\n        specfac = i;\r\n    }\r\n    // ugly way to fake an energy conservation (mainly to avoid super bright stuffs with low glossiness)\r\n    float att = materialShininess > 100.0 ? 1.0 : smoothstep(0.0, 1.0, materialShininess * 0.01);\r\n    return specfac * materialSpecular * lightSpecular * att;\r\n}\r\n\r\nvec3 lambert(const in float dotNL,  const in vec3 materialDiffuse, const in vec3 lightDiffuse) {\r\n    return dotNL * materialDiffuse * lightDiffuse;\r\n}\r\n\r\n#pragma DECLARE_FUNCTION\r\nvoid computeLightLambertCookTorrance(\r\n        const in vec3 normal,\r\n        const in vec3 eyeVector,\r\n        const in float dotNL,\r\n        const in float attenuation,\r\n\r\n        const in vec3 materialDiffuse,\r\n        const in vec3 materialSpecular,\r\n        const in float materialShininess,\r\n\r\n        const in vec3 lightDiffuse,\r\n        const in vec3 lightSpecular,\r\n        const in vec3 eyeLightDir,\r\n\r\n        out vec3 diffuseOut,\r\n        out vec3 specularOut,\r\n        out bool lighted) {\r\n\r\n    lighted = dotNL > 0.0;\r\n    if (lighted == false) {\r\n        specularOut = diffuseOut = vec3(0.0);\r\n        return;\r\n    }\r\n\r\n    specularOut = attenuation * specularCookTorrance(normal, eyeLightDir, eyeVector, materialShininess, materialSpecular, lightSpecular);\r\n    diffuseOut = attenuation * lambert(dotNL, materialDiffuse, lightDiffuse);\r\n}\r\n\r\n///////\r\n// HEMI\r\n///////\r\n#pragma DECLARE_FUNCTION\r\nvoid hemiLight(\r\n        const in vec3 normal,\r\n        const in vec3 eyeVector,\r\n        const in float dotNL,\r\n        const in vec3 eyeLightDir,\r\n\r\n        const in vec3 materialDiffuse,\r\n        const in vec3 materialSpecular,\r\n        const in float materialShininess,\r\n\r\n        const in vec3 lightDiffuse,\r\n        const in vec3 lightGround,\r\n\r\n        out vec3 diffuseOut,\r\n        out vec3 specularOut,\r\n        out bool lighted) {\r\n\r\n    lighted = false;\r\n    float weight = 0.5 * dotNL + 0.5;\r\n    diffuseOut = materialDiffuse * mix(lightGround, lightDiffuse, weight);\r\n\r\n    // same cook-torrance as above for sky/ground\r\n    float skyWeight = 0.5 * dot(normal, normalize(eyeVector + eyeLightDir)) + 0.5;\r\n    float gndWeight = 0.5 * dot(normal, normalize(eyeVector - eyeLightDir)) + 0.5;\r\n    float skySpec = pow(skyWeight, materialShininess);\r\n    float skyGround = pow(gndWeight, materialShininess);\r\n    float divisor = (0.1 + max( dot(normal, eyeVector), 0.0 ));\r\n    float att = materialShininess > 100.0 ? 1.0 : smoothstep(0.0, 1.0, materialShininess * 0.01);\r\n    \r\n    specularOut = lightDiffuse * materialSpecular * weight * att * (skySpec + skyGround) / divisor;\r\n}\r\n'},function(t,e){t.exports="//////////////////////////////\r\n// OPTIMIZED VERSION (NO IF)\r\n//////////////////////////////\r\n#pragma DECLARE_FUNCTION\r\nmat4 skinning( const in vec4 weights, const in vec4 bonesIndex ) {\r\n    mat4 outMat_1;\r\n    mat4 tmpMat_2;\r\n    highp ivec4 tmpvar_3;\r\n    tmpvar_3 = (3 * ivec4(bonesIndex));\r\n    tmpMat_2 = mat4(1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0);\r\n    vec4 tmpvar_4;\r\n    tmpvar_4 = -(abs(weights));\r\n    tmpMat_2[0] = uBones[tmpvar_3.x];\r\n    tmpMat_2[1] = uBones[(tmpvar_3.x + 1)];\r\n    tmpMat_2[2] = uBones[(tmpvar_3.x + 2)];\r\n    outMat_1 = ((float(\r\n    ((tmpvar_4.x + tmpvar_4.y) >= -((tmpvar_4.z + tmpvar_4.w)))\r\n    ) * mat4(1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0)) + (weights.x * tmpMat_2));\r\n    tmpMat_2[0] = uBones[tmpvar_3.y];\r\n    tmpMat_2[1] = uBones[(tmpvar_3.y + 1)];\r\n    tmpMat_2[2] = uBones[(tmpvar_3.y + 2)];\r\n    outMat_1 = (outMat_1 + (weights.y * tmpMat_2));\r\n    tmpMat_2[0] = uBones[tmpvar_3.z];\r\n    tmpMat_2[1] = uBones[(tmpvar_3.z + 1)];\r\n    tmpMat_2[2] = uBones[(tmpvar_3.z + 2)];\r\n    outMat_1 = (outMat_1 + (weights.z * tmpMat_2));\r\n    tmpMat_2[0] = uBones[tmpvar_3.w];\r\n    tmpMat_2[1] = uBones[(tmpvar_3.w + 1)];\r\n    tmpMat_2[2] = uBones[(tmpvar_3.w + 2)];\r\n    outMat_1 = (outMat_1 + (weights.w * tmpMat_2));\r\n\r\n    return outMat_1;\r\n}\r\n\r\n//////////////////////////////\r\n// UN-OPTIMIZED VERSION (WITH IF)\r\n//////////////////////////////\r\n\r\n// //http://http.developer.nvidia.com/GPUGems/gpugems_ch04.html\r\n// mat4 getMat4FromVec4( const int index, inout mat4 myMat ) {\r\n//     // We have to use a global variable because we can't access dynamically\r\n//     // matrix is transpose so we should do vec * matrix\r\n//     myMat[0] = uBones[ index ];\r\n//     myMat[1] = uBones[ index + 1];\r\n//     myMat[2] = uBones[ index + 2];\r\n//     return myMat;\r\n// }\r\n\r\n// mat4 skinning( const in vec4 weights, const in vec4 bonesIndex ) {\r\n//     ivec4 idx =  3 * ivec4(bonesIndex);\r\n//     mat4 tmpMat = mat4(1.0);\r\n//     mat4 outMat = mat4(0.0);\r\n\r\n//     // we handle negative weights\r\n//     if(all(equal(weights, vec4(0.0)))) return tmpMat;\r\n\r\n//     if(weights.x != 0.0) outMat += weights.x * getMat4FromVec4( idx.x, tmpMat );\r\n//     if(weights.y != 0.0) outMat += weights.y * getMat4FromVec4( idx.y, tmpMat );\r\n//     if(weights.z != 0.0) outMat += weights.z * getMat4FromVec4( idx.z, tmpMat );\r\n//     if(weights.w != 0.0) outMat += weights.w * getMat4FromVec4( idx.w, tmpMat );\r\n//     return outMat;\r\n// }\r\n\r\n//////////////////////////////\r\n// UN-OPTIMIZED VERSION (NO IF)\r\n//////////////////////////////\r\n\r\n// mat4 skinning( const in vec4 weights, const in vec4 bonesIndex ) {\r\n//     ivec4 idx =  3 * ivec4(bonesIndex);\r\n//     mat4 tmpMat = mat4(1.0);\r\n\r\n//     // if sum is 0, return identity\r\n//     vec4 absWeights = -abs(weights);\r\n//     mat4 outMat = step(0.0, absWeights.x + absWeights.y + absWeights.z + absWeights.w) * tmpMat;\r\n\r\n//     // we handle negative weights\r\n//     // outMat[3][3] += weights.x + weights.y + weights.z + weights.w;\r\n\r\n//     tmpMat[0] = uBones[ idx.x ];\r\n//     tmpMat[1] = uBones[ idx.x + 1];\r\n//     tmpMat[2] = uBones[ idx.x + 2];\r\n//     outMat += weights.x * tmpMat;\r\n\r\n//     tmpMat[0] = uBones[ idx.y ];\r\n//     tmpMat[1] = uBones[ idx.y + 1];\r\n//     tmpMat[2] = uBones[ idx.y + 2];\r\n//     outMat += weights.y * tmpMat;\r\n\r\n//     tmpMat[0] = uBones[ idx.z ];\r\n//     tmpMat[1] = uBones[ idx.z + 1];\r\n//     tmpMat[2] = uBones[ idx.z + 2];\r\n//     outMat += weights.z * tmpMat;\r\n\r\n//     tmpMat[0] = uBones[ idx.w ];\r\n//     tmpMat[1] = uBones[ idx.w + 1];\r\n//     tmpMat[2] = uBones[ idx.w + 2];\r\n//     outMat += weights.w * tmpMat;\r\n\r\n//     return outMat;\r\n// }\r\n"},function(t,e){t.exports="#pragma DECLARE_FUNCTION\r\nvec3 morphing(\r\n        const in vec4 weights,\r\n        const in vec3 vertex,\r\n        const in vec3 target0) {\r\n\r\n    return mix(vertex, target0, weights[0]);\r\n}\r\n\r\n#pragma DECLARE_FUNCTION\r\nvec3 morphing(\r\n        const in vec4 weights,\r\n        const in vec3 vertex,\r\n        const in vec3 target0,\r\n        const in vec3 target1) {\r\n\r\n    vec3 vecOut = vertex * (1.0 - ( weights[0] + weights[1]));\r\n    vecOut += target0 * weights[0];\r\n    vecOut += target1 * weights[1];\r\n    return vecOut;\r\n}\r\n\r\n#pragma DECLARE_FUNCTION\r\nvec3 morphing(\r\n        const in vec4 weights,\r\n        const in vec3 vertex,\r\n        const in vec3 target0,\r\n        const in vec3 target1,\r\n        const in vec3 target2) {\r\n  \r\n    vec3 vecOut = vertex * (1.0 - ( weights[0] + weights[1] + weights[2]));\r\n    vecOut += target0 * weights[0];\r\n    vecOut += target1 * weights[1];\r\n    vecOut += target2 * weights[2];\r\n    return vecOut;\r\n}\r\n\r\n#pragma DECLARE_FUNCTION\r\nvec3 morphing(\r\n        const in vec4 weights,\r\n        const in vec3 vertex,\r\n        const in vec3 target0,\r\n        const in vec3 target1,\r\n        const in vec3 target2,\r\n        const in vec3 target3) {\r\n\r\n    vec3 vecOut = vertex * (1.0 - ( weights[0] + weights[1] + weights[2] + weights[3]));\r\n    vecOut += target0 * weights[0];\r\n    vecOut += target1 * weights[1];\r\n    vecOut += target2 * weights[2];\r\n    vecOut += target3 * weights[3];\r\n    return vecOut;\r\n}\r\n"},function(t,e){t.exports="#pragma DECLARE_FUNCTION\r\nvec3 textureRGB(const in sampler2D tex, const in vec2 uv) {\r\n    return texture2D(tex, uv.xy).rgb;\r\n}\r\n\r\n#pragma DECLARE_FUNCTION\r\nvec4 textureRGBA(const in sampler2D tex, const in vec2 uv) {\r\n    return texture2D(tex, uv.xy).rgba;\r\n}\r\n\r\n#pragma DECLARE_FUNCTION\r\nfloat textureIntensity(const in sampler2D tex, const in vec2 uv) {\r\n    return texture2D(tex, uv).r;\r\n}\r\n\r\n#pragma DECLARE_FUNCTION\r\nfloat textureAlpha(const in sampler2D tex, const in vec2 uv) {\r\n    return texture2D(tex, uv.xy).a;\r\n}\r\n"},function(t,e){t.exports="\r\nfloat decodeFloatRGBA( vec4 rgba ) {\r\n    return dot( rgba, vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/16581375.0) );\r\n}\r\n\r\nvec4 encodeFloatRGBA( float v ) {\r\n    vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * v;\r\n    enc = fract(enc);\r\n    enc -= enc.yzww * vec4(1.0/255.0,1.0/255.0,1.0/255.0,0.0);\r\n    return enc;\r\n}\r\n\r\nvec2 decodeHalfFloatRGBA( vec4 rgba ) {\r\n    return vec2(rgba.x + (rgba.y / 255.0), rgba.z + (rgba.w / 255.0));\r\n}\r\n\r\nvec4 encodeHalfFloatRGBA( vec2 v ) {\r\n    const vec2 bias = vec2(1.0 / 255.0, 0.0);\r\n    vec4 enc;\r\n    enc.xy = vec2(v.x, fract(v.x * 255.0));\r\n    enc.xy = enc.xy - (enc.yy * bias);\r\n\r\n    enc.zw = vec2(v.y, fract(v.y * 255.0));\r\n    enc.zw = enc.zw - (enc.ww * bias);\r\n    return enc;\r\n}\r\n"},function(t,e){t.exports="vec3 getScale( const in mat4 matrix ) {\r\n      // Only working with positive scales.\r\n      float xs = matrix[0][0] * matrix[0][1] * matrix[0][2] * matrix[0][3] < 0. ? -1. : 1.;\r\n      float ys = matrix[1][0] * matrix[1][1] * matrix[1][2] * matrix[1][3] < 0. ? -1. : 1.;\r\n      float zs = matrix[2][0] * matrix[2][1] * matrix[2][2] * matrix[2][3] < 0. ? -1. : 1.;\r\n      vec3 scale;\r\n      scale.x = xs * sqrt( matrix[0][0] * matrix[0][0] + matrix[0][1] * matrix[0][1] + matrix[0][2] * matrix[0][2]);\r\n      scale.y = ys * sqrt( matrix[1][0] * matrix[1][0] + matrix[1][1] * matrix[1][1] + matrix[1][2] * matrix[1][2]);\r\n      scale.z = zs * sqrt( matrix[2][0] * matrix[2][0] + matrix[2][1] * matrix[2][1] + matrix[2][2] * matrix[2][2]);\r\n      return scale;\r\n}\r\n\r\n#pragma DECLARE_FUNCTION\r\nvec4 billboard( const in vec3 vertex, const in mat4 modelViewMatrix, const in mat4 projectionMatrix ) {\r\n      vec3 scale = getScale( modelViewMatrix );\r\n      return projectionMatrix * ( vec4( scale.x* vertex.x , scale.y * vertex.y, scale.z * vertex.z, 1.0 ) + vec4( modelViewMatrix[ 3 ].xyz, 0.0 ) );\r\n}\r\n"},function(t,e){t.exports='#pragma include "colorEncode.glsl"\r\n\r\n#pragma DECLARE_FUNCTION\r\nvec4 shadowCast(const in vec4 fragEye, const in vec2 shadowDepthRange){\r\n    // distance to camera (we make sure we are near 0 and in [0,1])\r\n    float depth = (-fragEye.z * fragEye.w - shadowDepthRange.x) / (shadowDepthRange.y - shadowDepthRange.x);\r\n\r\n#ifdef _FLOATTEX\r\n    return vec4(depth, 0.0, 0.0, 1.0);\r\n#else\r\n    return encodeFloatRGBA(depth);\r\n#endif\r\n}\r\n'},function(t,e){t.exports="#ifdef _OUT_DISTANCE\r\n#define OPT_ARG_outDistance ,out float outDistance\r\n#define OPT_INSTANCE_ARG_outDistance ,outDistance\r\n#else\r\n#define OPT_ARG_outDistance\r\n#define OPT_INSTANCE_ARG_outDistance\r\n#endif\r\n\r\n#ifdef _ATLAS_SHADOW\r\n#define OPT_ARG_atlasSize ,const in vec4 atlasSize\r\n#else\r\n#define OPT_ARG_atlasSize\r\n#endif\r\n\r\n#ifdef _NORMAL_OFFSET\r\n#define OPT_ARG_normalBias ,const in float normalBias\r\n#else\r\n#define OPT_ARG_normalBias\r\n#endif\r\n\r\n#ifdef _JITTER_OFFSET\r\n#define OPT_ARG_jitter ,const in float jitter\r\n#define OPT_INSTANCE_ARG_jitter ,jitter\r\n#else\r\n#define OPT_ARG_jitter\r\n#define OPT_INSTANCE_ARG_jitter\r\n#endif\r\n\r\n#pragma include \"tapPCF.glsl\"\r\n\r\n#pragma DECLARE_FUNCTION DERIVATIVES:enable\r\nfloat shadowReceive(const in bool lighted,\r\n                    const in vec3 normalWorld,\r\n                    const in vec3 vertexWorld,\r\n\r\n                    const in sampler2D shadowTexture,\r\n\r\n                    const in vec2 shadowSize,\r\n                    const in vec3 shadowProjection,\r\n\r\n                    const in vec4 shadowViewRight,\r\n                    const in vec4 shadowViewUp,\r\n                    const in vec4 shadowViewLook,\r\n\r\n\r\n                    const in vec2 shadowDepthRange,\r\n                    const in float shadowBias\r\n                    OPT_ARG_atlasSize\r\n                    OPT_ARG_normalBias\r\n                    OPT_ARG_outDistance\r\n                    OPT_ARG_jitter) {\r\n\r\n    // 0 for early out\r\n    bool earlyOut = false;\r\n\r\n    // Calculate shadow amount\r\n    float shadow = 1.0;\r\n\r\n    if (!lighted) {\r\n        shadow = 0.0;\r\n#ifndef _OUT_DISTANCE\r\n        earlyOut = true;\r\n#endif // _OUT_DISTANCE\r\n    }\r\n\r\n    if (shadowDepthRange.x == shadowDepthRange.y) {\r\n        earlyOut = true;\r\n    }\r\n\r\n    vec4 shadowVertexEye;\r\n    vec4 shadowNormalEye;\r\n    float shadowReceiverZ = 0.0;\r\n    vec4 shadowVertexProjected;\r\n    vec2 shadowUV;\r\n    float N_Dot_L;\r\n    float invDepthRange;\r\n\r\n    if (!earlyOut) {\r\n\r\n        shadowVertexEye.x = dot(shadowViewRight.xyz, vertexWorld.xyz) + shadowViewRight.w;\r\n        shadowVertexEye.y = dot(shadowViewUp.xyz, vertexWorld.xyz) + shadowViewUp.w;\r\n        shadowVertexEye.z = dot(shadowViewLook.xyz, vertexWorld.xyz) + shadowViewLook.w;\r\n        shadowVertexEye.w = 1.0;\r\n\r\n\r\n        // derivated, only need z.\r\n        //vec3 shadowLightDir = vec3(0.0, 0.0, 1.0); // in shadow view light is camera\r\n        //shadowNormalEye =  shadowViewMatrix * normalFront;\r\n        //shadowNormalEye.x = dot(shadowViewRight.xyz, normalWorld.xyz);\r\n        //shadowNormalEye.y = dot(shadowViewUp.xyz, normalWorld.xyz);\r\n        shadowNormalEye.z = dot(shadowViewLook.xyz, normalWorld.xyz);\r\n        //shadowNormalEye.w = 0.0;\r\n\r\n        //N_Dot_L = dot(shadowNormalEye.xyz, shadowLightDir);\r\n        N_Dot_L = shadowNormalEye.z;\r\n\r\n        if (!earlyOut) {\r\n\r\n            invDepthRange = 1.0 / (shadowDepthRange.y - shadowDepthRange.x);\r\n\r\n#ifdef _NORMAL_OFFSET\r\n\r\n            // http://www.dissidentlogic.com/old/images/NormalOffsetShadows/GDC_Poster_NormalOffset.png\r\n            float normalOffsetScale = clamp(1.0  - N_Dot_L, 0.0 , 1.0);\r\n            normalOffsetScale *= abs((shadowVertexEye.z - shadowDepthRange.x) * invDepthRange);\r\n            normalOffsetScale *= max(shadowProjection.x, shadowProjection.y);\r\n            normalOffsetScale *= normalBias * invDepthRange;\r\n\r\n\r\n            vec4 shadowNormalShift =  vec4(normalWorld, 0.0) * normalOffsetScale;\r\n            shadowNormalEye.x = dot(shadowViewRight.xyz, shadowNormalShift.xyz);\r\n            shadowNormalEye.y = dot(shadowViewUp.xyz, shadowNormalShift.xyz);\r\n            shadowNormalEye.z = dot(shadowViewLook.xyz, shadowNormalShift.xyz);\r\n            shadowNormalEye.w = 0.0;\r\n\r\n            vec4 viewShadow = shadowVertexEye + shadowNormalEye;\r\n#else\r\n            vec4 viewShadow = shadowVertexEye;\r\n#endif\r\n\r\n\r\n            if (shadowProjection.z == 0.0){\r\n\r\n               // X, 0, 0, 0,\r\n               // 0, Y, 0, 0,\r\n               // 0, 0, -1, -1,\r\n               // 0, 0, -2.0*znear, 0\r\n               // mat4 shadowProjectionMatrix;\r\n               // shadowProjectionMatrix[0] = vec4(shadowProjection.x, 0.0, 0.0, 0.0 );\r\n               // shadowProjectionMatrix[1] = vec4(0.0, shadowProjection.y, 0.0, 0.0 );\r\n               // shadowProjectionMatrix[2] = vec4(0.0, 0.0, -1.0, -1.0 );\r\n               // shadowProjectionMatrix[3] = vec4(0.0, 0.0, -2.0*shadowDepthRange.x, 0.0 );\r\n               // shadowVertexProjected = shadowProjectionMatrix * shadowVertexEye;\r\n\r\n               // derivated optimisation\r\n               shadowVertexProjected.x = shadowProjection.x * viewShadow.x;\r\n               shadowVertexProjected.y = shadowProjection.y * viewShadow.y;\r\n\r\n               shadowVertexProjected.z = - viewShadow.z - (2.0 * shadowDepthRange.x * viewShadow.w);\r\n               shadowVertexProjected.w = - viewShadow.z;\r\n\r\n            }\r\n            else{\r\n                // lr = 1/(left-right);\r\n                // bt = 1/(bottom-top);\r\n                // nf = 1/(near-far);\r\n                // -2*lr,           0,               0,              0,\r\n                // 0,               -2*bt,           0,              0,\r\n                // 0,               0,               2*nf,           0.0,\r\n                // (left+right)*lr, (top+bottom)*bt, (far+near)*nf), 1\r\n                // here left = -right && top = -bottom\r\n                // float lr = 1.0 / (-2.0 * shadowProjection.x);\r\n                // float bt = 1.0 / (-2.0 * shadowProjection.y);\r\n                // float nf = 1.0 / (shadowDepthRange.x - shadowDepthRange.y);\r\n                float nfNeg = 1.0 / (shadowDepthRange.x - shadowDepthRange.y);\r\n                float nfPos = (shadowDepthRange.x + shadowDepthRange.y)*nfNeg;\r\n\r\n                //mat4 shadowProjectionMatrix;\r\n                //shadowProjectionMatrix[0] = vec4(1.0 / shadowProjection.x, 0.0,     0.0,  0.0 );\r\n                //shadowProjectionMatrix[1] = vec4(0.0,     1.0 / shadowProjection.y, 0.0,  0.0 );\r\n                //shadowProjectionMatrix[2] = vec4(0.0,     0.0, 2.0*nfNeg, 0.0 );\r\n                //shadowProjectionMatrix[3] = vec4(0.0,     0.0, nfPos, 1.0 );\r\n                //shadowdertexProjected = shadowProjectionMatrix * shadowVertexEye;\r\n\r\n                // derivated optimisation\r\n                shadowVertexProjected.x = viewShadow.x / shadowProjection.x;\r\n                shadowVertexProjected.y = viewShadow.y / shadowProjection.y;\r\n\r\n                shadowVertexProjected.z = 2.0 * nfNeg* viewShadow.z + nfPos * viewShadow.w;\r\n                shadowVertexProjected.w = viewShadow.w;\r\n\r\n            }\r\n\r\n\r\n            if (shadowVertexProjected.w < 0.0) {\r\n                earlyOut = true; // notably behind camera\r\n            }\r\n\r\n        }\r\n\r\n        if (!earlyOut) {\r\n\r\n            shadowUV.xy = shadowVertexProjected.xy / shadowVertexProjected.w;\r\n            shadowUV.xy = shadowUV.xy * 0.5 + 0.5;// mad like\r\n\r\n            if (any(bvec4 ( shadowUV.x > 1., shadowUV.x < 0., shadowUV.y > 1., shadowUV.y < 0.))) {\r\n                earlyOut = true;// limits of light frustum\r\n            }\r\n\r\n            // most precision near 0, make sure we are near 0 and in [0,1]\r\n            shadowReceiverZ = - shadowVertexEye.z;\r\n            shadowReceiverZ =  (shadowReceiverZ - shadowDepthRange.x) * invDepthRange;\r\n\r\n            if(shadowReceiverZ < 0.0) {\r\n                earlyOut = true; // notably behind camera\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    // pcf pbias to add on offset\r\n    vec2 shadowBiasPCF = vec2 (0.);\r\n\r\n#ifdef GL_OES_standard_derivatives\r\n#ifdef _RECEIVERPLANEDEPTHBIAS\r\n    vec2 biasUV;\r\n\r\n    vec3 texCoordDY = dFdx(shadowVertexEye.xyz);\r\n    vec3 texCoordDX = dFdy(shadowVertexEye.xyz);\r\n\r\n    biasUV.x = texCoordDY.y * texCoordDX.z - texCoordDX.y * texCoordDY.z;\r\n    biasUV.y = texCoordDX.x * texCoordDY.z - texCoordDY.x * texCoordDX.z;\r\n    biasUV *= 1.0 / ((texCoordDX.x * texCoordDY.y) - (texCoordDX.y * texCoordDY.x));\r\n\r\n    // Static depth biasing to make up for incorrect fractional sampling on the shadow map grid\r\n    float fractionalSamplingError = dot(vec2(1.0, 1.0) * shadowSize.xy, abs(biasUV));\r\n    float receiverDepthBias = min(fractionalSamplingError, 0.01);\r\n\r\n    shadowBiasPCF.x = biasUV.x;\r\n    shadowBiasPCF.y = biasUV.y;\r\n\r\n    shadowReceiverZ += receiverDepthBias;\r\n\r\n#else // _RECEIVERPLANEDEPTHBIAS\r\n    shadowBiasPCF.x = clamp(dFdx(shadowReceiverZ) * shadowSize.x, -1.0, 1.0 );\r\n    shadowBiasPCF.y = clamp(dFdy(shadowReceiverZ) * shadowSize.y, -1.0, 1.0 );\r\n#endif\r\n\r\n#endif // GL_OES_standard_derivatives\r\n\r\n\r\n    vec4 clampDimension;\r\n\r\n#ifdef _ATLAS_SHADOW\r\n    shadowUV.xy  = ((shadowUV.xy * atlasSize.zw ) + atlasSize.xy) * shadowSize.xy;\r\n\r\n    // clamp uv bias/filters by half pixel to avoid point filter on border\r\n    clampDimension.xy = atlasSize.xy + vec2(0.5);\r\n    clampDimension.zw = (atlasSize.xy + atlasSize.zw) - vec2(0.5);\r\n\r\n    clampDimension = clampDimension * shadowSize.xyxy;\r\n#else\r\n    clampDimension = vec4(0.0, 0.0, 1.0, 1.0);\r\n#endif // _RECEIVERPLANEDEPTHBIAS\r\n\r\n\r\n    // now that derivatives is done and we don't access any mipmapped/texgrad texture we can early out\r\n    // see http://teknicool.tumblr.com/post/77263472964/glsl-dynamic-branching-and-texture-samplers\r\n    if (earlyOut) {\r\n        // empty statement because of weird gpu intel bug\r\n    } else {\r\n\r\n        // depth bias: fighting shadow acne (depth imprecsion z-fighting)\r\n        // cosTheta is dot( n, l ), clamped between 0 and 1\r\n        // float shadowBias = 0.005*tan(acos(N_Dot_L));\r\n        // same but 4 cycles instead of 15\r\n        float depthBias = 0.05 * sqrt( 1.0 - N_Dot_L * N_Dot_L) / clamp(N_Dot_L, 0.0005, 1.0);\r\n\r\n        // That makes sure that plane perpendicular to light doesn't flicker due to\r\n        // selfshadowing and 1 = dot(Normal, Light) using a min bias\r\n        depthBias = clamp(depthBias, 0.00005, 2.0 * shadowBias);\r\n\r\n        // shadowZ must be clamped to [0,1]\r\n        // otherwise it's not comparable to shadow caster depth map\r\n        // which is clamped to [0,1]\r\n        // Not doing that makes ALL shadowReceiver > 1.0 black\r\n        // because they ALL becomes behind any point in Caster depth map\r\n        shadowReceiverZ = clamp(shadowReceiverZ, 0.0, 1.0 -depthBias) - depthBias;\r\n\r\n        // Now computes Shadow\r\n        float res = getShadowPCF(shadowTexture,\r\n                                 shadowSize,\r\n                                 shadowUV,\r\n                                 shadowReceiverZ,\r\n                                 shadowBiasPCF,\r\n                                 clampDimension\r\n                                 OPT_INSTANCE_ARG_outDistance\r\n                                 OPT_INSTANCE_ARG_jitter);\r\n#ifdef _OUT_DISTANCE\r\n        if (lighted) shadow = res;\r\n        outDistance *= shadowDepthRange.y - shadowDepthRange.x; // world space distance\r\n#else\r\n        shadow = res;\r\n#endif  // _OUT_DISTANCE\r\n    }\r\n\r\n    return shadow;\r\n\r\n}\r\n"},function(t,e){t.exports='#pragma include "floatFromTex.glsl"\r\n\r\n// simulation of texture2Dshadow glsl call on HW\r\n// http://codeflow.org/entries/2013/feb/15/soft-shadow-mapping/\r\nfloat texture2DCompare(const in sampler2D depths,\r\n                       const in vec2 uv,\r\n                       const in float compare,\r\n                       const in vec4 clampDimension){\r\n    float depth = getSingleFloatFromTex(depths, clamp(uv, clampDimension.xy, clampDimension.zw));\r\n    return compare - depth;\r\n}\r\n\r\n#ifdef _JITTER_OFFSET\r\n// TODO could be in a random.glsl file\r\n// https://github.com/EpicGames/UnrealEngine/blob/release/Engine/Shaders/Private/Random.ush#L27\r\nfloat shadowInterleavedGradientNoise(const in vec2 fragCoord, const in float frameMod) {\r\n    vec3 magic = vec3(0.06711056, 0.00583715, 52.9829189);\r\n    return fract(magic.z * fract(dot(fragCoord.xy + frameMod * vec2(47.0, 17.0) * 0.695, magic.xy)));\r\n}\r\n#endif\r\n\r\n// simulates linear fetch like texture2d shadow\r\nfloat texture2DShadowLerp(\r\n    const in sampler2D depths,\r\n    const in vec2 size,\r\n    const in vec2 uv,\r\n    const in float compare,\r\n    const in vec4 clampDimension\r\n    OPT_ARG_outDistance\r\n    OPT_ARG_jitter){\r\n\r\n    vec2 centroidCoord = uv / size.xy;\r\n\r\n#ifdef _JITTER_OFFSET\r\n    if (jitter > 0.0){\r\n        centroidCoord += shadowInterleavedGradientNoise(gl_FragCoord.xy, jitter);\r\n    }\r\n#endif\r\n\r\n    centroidCoord = centroidCoord + 0.5;\r\n    vec2 f = fract(centroidCoord);\r\n    vec2 centroidUV = floor(centroidCoord) * size.xy;\r\n\r\n    vec4 fetches;\r\n    const vec2 shift  = vec2(1.0, 0.0);\r\n    fetches.x = texture2DCompare(depths, centroidUV + size.xy * shift.yy, compare, clampDimension);\r\n    fetches.y = texture2DCompare(depths, centroidUV + size.xy * shift.yx, compare, clampDimension);\r\n    fetches.z = texture2DCompare(depths, centroidUV + size.xy * shift.xy, compare, clampDimension);\r\n    fetches.w = texture2DCompare(depths, centroidUV + size.xy * shift.xx, compare, clampDimension);\r\n\r\n\r\n\r\n#ifdef _OUT_DISTANCE\r\n    float _a = mix(fetches.x, fetches.y, f.y);\r\n    float _b = mix(fetches.z, fetches.w, f.y);\r\n    outDistance = mix(_a, _b, f.x);\r\n#endif\r\n\r\n    vec4 st = step(fetches, vec4(0.0));\r\n\r\n    float a = mix(st.x, st.y, f.y);\r\n    float b = mix(st.z, st.w, f.y);\r\n    return mix(a, b, f.x);\r\n}\r\n'},function(t,e){t.exports='#pragma include "colorEncode.glsl"\r\n\r\n// end Float codec\r\nfloat getSingleFloatFromTex(const in sampler2D depths, const in vec2 uv){\r\n#ifndef _FLOATTEX\r\n    return  decodeFloatRGBA(texture2D(depths, uv));\r\n#else\r\n    return texture2D(depths, uv).x;\r\n#endif\r\n}\r\n\r\nvec2 getDoubleFloatFromTex(const in sampler2D depths, const in vec2 uv){\r\n#ifndef _FLOATTEX\r\n    return decodeHalfFloatRGBA(texture2D(depths, uv));\r\n#else\r\n    return texture2D(depths, uv).xy;\r\n#endif\r\n}\r\n\r\nvec4 getQuadFloatFromTex(const in sampler2D depths, const in vec2 uv){\r\n    return texture2D(depths, uv).xyzw;\r\n}\r\n// end Float codec\r\n'},function(t,e){t.exports='#pragma include "shadowLinearSoft.glsl"\r\n\r\nfloat getShadowPCF(\r\n    const in sampler2D depths,\r\n    const in vec2 size,\r\n    const in vec2 uv,\r\n    const in float compare,\r\n    const in vec2 biasPCF,\r\n    const in vec4 clampDimension\r\n    OPT_ARG_outDistance\r\n    OPT_ARG_jitter) {\r\n\r\n     float res = 0.0;\r\n\r\n     res += texture2DShadowLerp(depths, size, uv + biasPCF, compare, clampDimension OPT_INSTANCE_ARG_outDistance OPT_INSTANCE_ARG_jitter);\r\n\r\n\r\n#if defined(_PCFx1)\r\n\r\n#else\r\n\r\n    float dx0 = -size.x;\r\n    float dy0 = -size.y;\r\n    float dx1 = size.x;\r\n    float dy1 = size.y;\r\n\r\n#define TSF(o1,o2) texture2DShadowLerp(depths, size, uv + vec2(o1, o2) + biasPCF, compare, clampDimension OPT_INSTANCE_ARG_outDistance OPT_INSTANCE_ARG_jitter)\r\n\r\n    res += TSF(dx0, dx0);\r\n    res += TSF(dx0, .0);\r\n    res += TSF(dx0, dx1);\r\n\r\n#if defined(_PCFx4)\r\n\r\n    res /=4.0;\r\n\r\n#elif defined(_PCFx9)\r\n    res += TSF(.0, dx0);\r\n    res += TSF(.0, dx1);\r\n\r\n    res += TSF(dx1, dx0);\r\n    res += TSF(dx1, .0);\r\n    res += TSF(dx1, dx1);\r\n\r\n\r\n    res /=9.0;\r\n\r\n#elif defined(_PCFx25)\r\n\r\n    float dx02 = 2.0*dx0;\r\n    float dy02 = 2.0*dy0;\r\n    float dx2 = 2.0*dx1;\r\n    float dy2 = 2.0*dy1;\r\n\r\n    // complete row above\r\n    res += TSF(dx0, dx02);\r\n    res += TSF(dx0, dx2);\r\n\r\n    res += TSF(.0, dx02);\r\n    res += TSF(.0, dx2);\r\n\r\n    res += TSF(dx1, dx02);\r\n    res += TSF(dx1, dx2);\r\n\r\n    // two new col\r\n    res += TSF(dx02, dx02);\r\n    res += TSF(dx02, dx0);\r\n    res += TSF(dx02, .0);\r\n    res += TSF(dx02, dx1);\r\n    res += TSF(dx02, dx2);\r\n\r\n    res += TSF(dx2, dx02);\r\n    res += TSF(dx2, dx0);\r\n    res += TSF(dx2, .0);\r\n    res += TSF(dx2, dx1);\r\n    res += TSF(dx2, dx2);\r\n\r\n\r\n    res/=25.0;\r\n\r\n#endif\r\n\r\n#undef TSF\r\n\r\n#endif\r\n    return res;\r\n}\r\n/////// end Tap\r\n'},function(t,e,r){"use strict";var i=r(31),a=r(29),n=r(42),s=function(){return{buffer:{separate:!1,enable:!1,sourceFactor:a.a.ONE,destinationFactor:a.a.ZERO,sourceFactorAlpha:a.a.ONE,destinationFactorAlpha:a.a.ZERO},state:{separate:void 0,enable:!1,sourceFactor:void 0,destinationFactor:void 0,sourceFactorAlpha:void 0,destinationFactorAlpha:void 0},changed:!0}},o=function(){return{buffer:{func:i.a.LESS,enable:!1,near:0,far:1},state:{func:void 0,enable:!1,near:void 0,far:void 0},changed:!0}},h=function(){return{buffer:{enable:!1,mode:n.a.BACK},state:{enable:!1,mode:void 0},changed:!0}},u=function(){return{buffer:{enable:!1,x:0,y:0,width:640,height:480},state:{enable:!1,x:void 0,y:void 0,width:void 0,height:void 0},changed:!0}},c=function(){return{buffer:{red:!0,green:!0,blue:!0,alpha:!0},state:{red:void 0,green:void 0,blue:void 0,alpha:void 0},changed:!0}},l=function(){return{buffer:{x:0,y:0,width:640,height:480},state:{x:void 0,y:void 0,width:void 0,height:void 0},changed:!0}},d=function(){return{state:{value:!0},buffer:{value:void 0},changed:!0}},_=function(){return{buffer:{value:1},state:{value:void 0},changed:!0}},f=function(){return{buffer:{red:0,green:0,blue:0,alpha:0},state:{red:void 0,green:void 0,blue:void 0,alpha:void 0},changed:!0}},g=function(){this._stateClearColor=f(),this._stateClearDepth=_(),this._stateDepthMask=d(),this._stateViewport=l(),this._stateColorMask=c(),this._stateScissor=u(),this._stateDepth=o(),this._stateCullFace=h(),this._stateBlendFunc=s()};g.prototype={clearColor:function(t){var e=this._stateClearColor,r=e.buffer,i=e.state;e.changed=!1,r.red=t[0],r.green=t[1],r.blue=t[2],r.alpha=t[3],i.red===t[0]&&i.green===t[1]&&i.blue===t[2]&&i.alpha===t[3]||(e.changed=!0)},applyClearColor:function(t){var e=this._stateClearColor,r=e.state,i=e.buffer;e.changed=!1,r.red=i.red,r.green=i.green,r.blue=i.blue,r.alpha=i.alpha,t.clearColor(r.red,r.green,r.blue,r.alpha)},clearDepth:function(t){var e=this._stateClearDepth,r=e.buffer,i=e.state;e.changed=!1,r.value=t,i.value!==t&&(e.changed=!0)},applyClearDepth:function(t){var e=this._stateClearDepth,r=e.buffer,i=e.state;e.changed=!1,i.value=r.value,t.clearDepth(i.value)},depthMask:function(t){var e=this._stateDepthMask,r=e.buffer,i=e.state;e.changed=!1,r.value=t,i.value!==t&&(e.changed=!0)},applyDepthMask:function(t){var e=this._stateDepthMask,r=e.buffer,i=e.state;e.changed=!1,i.value=r.value,t.depthMask(i.value)},applyViewportAttribute:function(t){this.viewport(t._x,t._y,t._width,t._height)},viewport:function(t,e,r,i){var a=this._stateViewport,n=a.buffer,s=a.state;a.changed=!1,n.x=t,n.y=e,n.width=r,n.height=i,s.x===t&&s.y===e&&s.width===r&&s.height===i||(a.changed=!0)},applyViewport:function(t){var e=this._stateViewport,r=e.buffer,i=e.state;e.changed=!1,i.x=r.x,i.y=r.y,i.width=r.width,i.height=r.height,t.viewport(i.x,i.y,i.width,i.height)},applyColorMaskAttribute:function(t){var e=this._stateColorMask,r=e.buffer,i=e.state;e.changed=!1,r.red=t._red,r.green=t._green,r.blue=t._blue,r.alpha=t._alpha,i.red===t._red&&i.green===t._green&&i.blue===t._blue&&i.alpha===t._alpha||(e.changed=!0)},applyColorMask:function(t){var e=this._stateColorMask,r=e.buffer,i=e.state;e.changed=!1,i.red=r.red,i.green=r.green,i.blue=r.blue,i.alpha=r.alpha,t.colorMask(i.red,i.green,i.blue,i.alpha)},applyScissorAttribute:function(t){var e=-1!==t._x,r=this._stateScissor,i=r.buffer,a=r.state;r.changed=!1,i.enable=e,i.x=t._x,i.y=t._y,i.width=t._width,i.height=t._height,a.enable===e&&a.x===t._x&&a.y===t._y&&a.width===t._width&&a.height===t._height||(r.changed=!0)},applyScissor:function(t){var e=this._stateScissor,r=e.buffer,i=e.state;e.changed=!1,i.enable!==r.enable&&(i.enable=r.enable,i.enable?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST)),i.enable&&(i.x===r.x&&i.y===r.y&&i.width===r.width&&i.height===r.height||(i.x=r.x,i.y=r.y,i.width=r.width,i.height=r.height,t.scissor(i.x,i.y,i.width,i.height)))},applyCullFaceAttribute:function(t){var e=this._stateCullFace,r=e.buffer,i=e.state,a=t._mode!==n.a.DISABLE;e.changed=!1,r.enable=a,r.mode=t._mode,i.enable===a&&i.mode===t._mode||(e.changed=!0)},applyCullFace:function(t){var e=this._stateCullFace,r=e.buffer,i=e.state;e.changed=!1,i.enable!==r.enable&&(i.enable=r.enable,i.enable?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE)),i.enable&&i.mode!==r.mode&&(i.mode=r.mode,t.cullFace(i.mode))},applyDepthAttribute:function(t){var e=t._func!==i.a.DISABLE,r=this._stateDepth,a=r.buffer,n=r.state;r.changed=!1,a.enable=e,a.func=t._func,a.far=t._far,a.near=t._near,n.enable===e&&n.func===t._func&&n.near===t._near&&n.far===t._far||(r.changed=!0),this.depthMask(t._writeMask)},applyDepth:function(t){var e=this._stateDepth,r=e.buffer,i=e.state;e.changed=!1,i.enable!==r.enable&&(i.enable=r.enable,i.enable?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST)),i.enable&&(i.func!==r.func&&(i.func=r.func,t.depthFunc(i.func)),i.near===r.near&&i.far===r.far||(i.far=r.far,i.near=r.near,t.depthRange(i.near,i.far)))},applyBlendFuncAttribute:function(t){var e=this._stateBlendFunc,r=e.buffer,i=e.state,n=t._sourceFactor!==a.a.DISABLE&&t._destinationFactor!==a.a.DISABLE;e.changed=!1,r.enable=n,r.separate=t._separate,r.sourceFactor=t._sourceFactor,r.destinationFactor=t._destinationFactor,r.sourceFactorAlpha=t._sourceFactorAlpha,r.destinationFactorAlpha=t._destinationFactorAlpha,i.enable===n&&i.sourceFactor===t._sourceFactor&&i.destinationFactor===t._destinationFactor&&i.sourceFactorAlpha===t._sourceFactorAlpha&&i.destinationFactorAlpha===t._destinationFactorAlpha||(e.changed=!0)},applyBlendFunc:function(t){var e=this._stateBlendFunc,r=e.buffer,i=e.state;e.changed=!1,i.enable!==r.enable&&(i.enable=r.enable,i.enable?t.enable(t.BLEND):t.disable(t.BLEND)),i.enable&&(i.separate=r.separate,i.separate?i.sourceFactor===r.sourceFactor&&i.destinationFactor===r.destinationFactor&&i.sourceFactorAlpha===r.sourceFactorAlpha&&i.destinationFactorAlpha===r.destinationFactorAlpha||(i.sourceFactor=r.sourceFactor,i.destinationFactor=r.destinationFactor,i.sourceFactorAlpha=r.sourceFactorAlpha,i.destinationFactorAlpha=r.destinationFactorAlpha,t.blendFuncSeparate(i.sourceFactor,i.destinationFactor,i.sourceFactorAlpha,i.destinationFactorAlpha)):i.sourceFactor===r.sourceFactor&&i.destinationFactor===r.destinationFactor||(i.sourceFactor=r.sourceFactor,i.destinationFactor=r.destinationFactor,t.blendFunc(i.sourceFactor,i.destinationFactor)))},applyClearStates:function(t){this._stateDepthMask.changed&&this.applyDepthMask(t),this._stateScissor.changed&&this.applyScissor(t),this._stateClearColor.changed&&this.applyClearColor(t),this._stateClearDepth.changed&&this.applyClearDepth(t),this._stateColorMask.changed&&this.applyColorMask(t)},applyDrawStates:function(t){this._stateViewport.changed&&this.applyViewport(t),this._stateScissor.changed&&this.applyScissor(t),this._stateDepth.changed&&this.applyDepth(t),this._stateDepthMask.changed&&this.applyDepthMask(t),this._stateCullFace.changed&&this.applyCullFace(t),this._stateBlendFunc.changed&&this.applyBlendFunc(t),this._stateColorMask.changed&&this.applyColorMask(t)},clear:function(t,e){this.applyClearStates(t),t.clear(e)},drawGeometry:function(t){this.applyDrawStates(t)}},e.a=g},function(t,e,r){"use strict";var i=r(0),a=r(41),n=r(2),s=r(7),o=function(){s.default.call(this),this._images={};for(var t=0;t<6;t++)this._images[s.default.TEXTURE_CUBE_MAP_POSITIVE_X+t]=new a.a};i.a.createPrototypeStateAttribute(o,i.a.objectInherit(s.default.prototype,{setDefaultParameters:function(){s.default.prototype.setDefaultParameters.call(this),this._textureTarget=s.default.TEXTURE_CUBE_MAP,this._flipY=!1},invalidate:function(){s.default.prototype.invalidate.call(this);for(var t=s.default.TEXTURE_CUBE_MAP_POSITIVE_X;t<s.default.TEXTURE_CUBE_MAP_POSITIVE_X+6;t++){var e=this._images[t];this._images[s.default.TEXTURE_CUBE_MAP_POSITIVE_X].getImage()&&e.dirty()}this.dirty()},cloneType:function(){return new o},setImage:function(t,e,r){var i=t;"string"==typeof i&&(i=s.default[i]),this._images[i].setImage(e,r),this.setImageFormat(r),this.setTextureSize(this._images[i].getWidth(),this._images[i].getHeight()),this._textureNull=!1,this.dirty()},getImage:function(t){return this._images[t].getImage()},initCubemapContent:function(t){var e=this._internalFormat;return this.applyTexImage2D(t,t.TEXTURE_CUBE_MAP_POSITIVE_X,0,e,this._textureWidth,this._textureHeight,0,e,this._type,null),this.applyTexImage2D(t,t.TEXTURE_CUBE_MAP_NEGATIVE_X,0,e,this._textureWidth,this._textureHeight,0,e,this._type,null),this.applyTexImage2D(t,t.TEXTURE_CUBE_MAP_POSITIVE_Y,0,e,this._textureWidth,this._textureHeight,0,e,this._type,null),this.applyTexImage2D(t,t.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,e,this._textureWidth,this._textureHeight,0,e,this._type,null),this.applyTexImage2D(t,t.TEXTURE_CUBE_MAP_POSITIVE_Z,0,e,this._textureWidth,this._textureHeight,0,e,this._type,null),this.applyTexImage2D(t,t.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,e,this._textureWidth,this._textureHeight,0,e,this._type,null),!0},generateMipmap:function(t,e){if(this.hasMipmapFilter()){if(this._images[s.default.TEXTURE_CUBE_MAP_POSITIVE_X].hasMipmap())for(var r=0;r<6;r++){var i=this._images[s.default.TEXTURE_CUBE_MAP_POSITIVE_X+r];i.hasMipmap()||n.a.error("mipmap not set correctly for TextureCubemap");for(var a=this._internalFormat,o=1;o<i.getMipmap().length;o++){var h=i.getMipmap()[o].getWidth();this.applyTexImage2D(t,t.TEXTURE_CUBE_MAP_POSITIVE_X+r,o,a,h,h,0,a,this._type,i.getMipmap()[o].getImage())}}else t.generateMipmap(e);this._dirtyMipmap=!1}},applyImageTarget:function(t,e,r){var i=this._images[r];return i.getImage()&&i.isReady()?i.isDirty()?(this.setTextureSize(i.getWidth(),i.getHeight()),i.setDirty(!1),i.isTypedArray()?this.applyTexImage2D(t,r,0,e,this._textureWidth,this._textureHeight,0,e,this._type,i.getImage()):this.applyTexImage2D(t,r,0,e,e,this._type,i.getImage()),!this._unrefImageDataAfterApply||this.hasMipmap()&&i.hasMipmap()||i.release(),1):1:0},initCubemapContentImage:function(t){var e=this._internalFormat,r=0;return r+=this.applyImageTarget(t,e,t.TEXTURE_CUBE_MAP_POSITIVE_X),r+=this.applyImageTarget(t,e,t.TEXTURE_CUBE_MAP_NEGATIVE_X),r+=this.applyImageTarget(t,e,t.TEXTURE_CUBE_MAP_POSITIVE_Y),r+=this.applyImageTarget(t,e,t.TEXTURE_CUBE_MAP_NEGATIVE_Y),r+=this.applyImageTarget(t,e,t.TEXTURE_CUBE_MAP_POSITIVE_Z),6===(r+=this.applyImageTarget(t,e,t.TEXTURE_CUBE_MAP_NEGATIVE_Z))},apply:function(t){var e=t.getGraphicContext();if(this._dirtyTextureObject&&(this.releaseGLObjects(),this.setGraphicContext(e)),void 0===this._textureObject||this.isDirty())if(this._textureNull)e.bindTexture(this._textureTarget,null);else{this._textureObject||(this.computeTextureFormat(),this.init(t)),this._textureObject.bind(e);var r;r=this._images[s.default.TEXTURE_CUBE_MAP_POSITIVE_X].getImage()?this.initCubemapContentImage(e):this.initCubemapContent(e),r&&(this._dirty=!1,this.applyFilterParameter(e,this._textureTarget),this.generateMipmap(e,this._textureTarget))}else this._textureObject.bind(e),this.isDirtyMipmap()&&this.generateMipmap(e,this._textureTarget)}}),"osg","TextureCubeMap"),e.a=o},function(t,e,r){"use strict";var i=r(9),a=r(18),n=r(20),s=function(){},o=s.functorDrawElements=[],h=s.functorDrawArrays=[];o[i.a.TRIANGLES]=function(t,e,r,i){for(var a=t+e,n=t;n<a;n+=3)i(r[n],r[n+1],r[n+2])},o[i.a.TRIANGLE_STRIP]=function(t,e,r,i){for(var a=2,n=t;a<e;++a,++n)a%2?i(r[n],r[n+2],r[n+1]):i(r[n],r[n+1],r[n+2])},o[i.a.TRIANGLE_FAN]=function(t,e,r,i){for(var a=r[t],n=2,s=t+1;n<e;++n,++s)i(a,r[s],r[s+1])},h[i.a.TRIANGLES]=function(t,e,r){for(var i=2,a=t;i<e;i+=3,a+=3)r(a,a+1,a+2)},h[i.a.TRIANGLE_STRIP]=function(t,e,r){for(var i=2,a=t;i<e;++i,++a)i%2?r(a,a+2,a+1):r(a,a+1,a+2)},h[i.a.TRIANGLE_FAN]=function(t,e,r){for(var i=2,a=t+1;i<e;++i,++a)r(t,a,a+1)},s.prototype={init:function(t,e){this._geom=t,this._cb=e},apply:function(){var t=this._geom,e=t.getPrimitiveSetList();if(e)for(var r,i=this._cb,s=e.length,u=0;u<s;u++){var c=e[u];if(c instanceof a.a){if(r=o[c.getMode()]){var l=c.indices.getElements();r(c.getFirst()/l.BYTES_PER_ELEMENT,c.getCount(),l,i)}}else c instanceof n.a&&(r=h[c.getMode()])&&r(c.getFirst(),c.getCount(),i)}}},e.a=s},function(t,e,r){"use strict";var i=r(0),a=r(69),n=r(114),s=r(53),o=r(126),h=r(44),u=r(46),c=r(128),l=r(218),d=r(127),_=r(113),f=r(34),g=r(45),p=r(66),m=r(129),v=r(130),S=r(219),b=r(89),x=r(131),y=r(67),M=r(52),T=r(70),A=r(112),C={};i.a.objectMix(C,l.a),i.a.objectMix(C,d.a),C.Animation=a.a,C.SkinningAttribute=n.a,C.AnimationUpdateCallback=s.a,C.BasicAnimationManager=o.a,C.Bone=h.a,C.Channel=u.a,C.CollectAnimationUpdateCallbackVisitor=c.a,C.MorphAttribute=_.a,C.MorphGeometry=f.a,C.RigGeometry=g.a,C.Skeleton=p.a,C.StackedMatrix=m.a,C.StackedQuaternion=v.a,C.StackedRotateAxis=S.a,C.StackedScale=b.a,C.StackedTranslate=x.a,C.UpdateBone=y.a,C.UpdateMatrixTransform=M.a,C.UpdateMorph=T.a,C.UpdateSkeleton=A.a,e.a=C},function(t,e,r){"use strict";function i(t){return t}function a(t){return t*t}function n(t){return t*t*t}function s(t){return t*t*t*t}function o(t){return t*t*t*t*t}function h(t){return t*t*t*t*t*t}function u(t){return t*t*t*t*t*t*t}function c(t){return t*t*t*t*t*t*t*t}function l(t){var e=t-1;return 1-e*e}function d(t){var e=t-1;return 1+e*e*e}function _(t){var e=t-1;return 1-e*e*e*e}function f(t){var e=t-1;return 1+e*e*e*e*e}function g(t){var e=t-1;return 1-e*e*e*e*e*e}function p(t){var e=t-1;return 1+e*e*e*e*e*e*e}function m(t){var e=t-1;return 1-e*e*e*e*e*e*e*e}function v(t){var e=t-1,r=2*t;return r<1?t*r:1-e*e*2}function S(t){var e=t-1,r=2*t;return r<1?t*r*r:1+e*e*e*4}function b(t){var e=t-1,r=2*t;return r<1?t*r*r*r:1-e*e*e*e*8}function x(t){var e=t-1,r=2*t;return r<1?t*r*r*r*r:1+e*e*e*e*e*16}function y(t){var e=t-1,r=2*t;return r<1?t*r*r*r*r*r:1-e*e*e*e*e*e*32}function M(t){var e=t-1,r=2*t;return r<1?t*r*r*r*r*r*r:1+e*e*e*e*e*e*e*64}function T(t){var e=t-1,r=2*t;return r<1?t*r*r*r*r*r*r*r:1-e*e*e*e*e*e*e*e*128}function A(t){var e=1.70158;return t*t*(t*(e+1)-e)}function C(t){var e=t-1,r=2*t,i=2.5949095;return t<.5?t*r*(r*(i+1)-i):1+2*e*e*(2*e*(i+1)+i)}function I(t){var e=t-1,r=1.70158;return 1+e*e*(e*(r+1)+r)}function w(t){return 1-Math.sqrt(1-t*t)}function E(t){var e=t-1,r=2*t;return r<1?.5*(1-Math.sqrt(1-r*r)):.5*(Math.sqrt(1-4*e*e)+1)}function N(t){var e=t-1;return Math.sqrt(1-e*e)}function R(t){return-1*Math.pow(2,10*t)*Math.sin(2*(t-1-.075)*Math.PI/.3)}function O(t){return Math.pow(2,-10*t)*Math.sin((t-.075)*(2*Math.PI)/.3)+1}function F(t){return(t*=2)<1?1*Math.pow(2,10*t)*-.5*Math.sin(2*(t-1-.45)*Math.PI/.45):1*Math.pow(2,-10*(t-=1))*Math.sin(2*(t-.45)*Math.PI/.45)*.5+1}function P(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}function L(t){return(t=1-t)<1/2.75?1-7.5625*t*t:t<2/2.75?1-(7.5625*(t-=1.5/2.75)*t+.75):t<2.5/2.75?1-(7.5625*(t-=2.25/2.75)*t+.9375):1-(7.5625*(t-=2.625/2.75)*t+.984375)}function D(t){var e;return t<.5?(e=!0,t=1-2*t):t=2*t-1,t<1/2.75?t*=7.5625*t:t=t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375,e?.5*(1-t):.5*t+.5}e.a={easeLinear:i,easeOutQuad:l,easeInQuad:a,easeInOutQuad:v,easeOutCubic:d,easeInCubic:n,easeInOutCubic:S,easeOutQuart:_,easeInQuart:s,easeInOutQuart:b,easeOutQuintic:f,easeInQuintic:o,easeInOutQuintic:x,easeOutSextic:g,easeInSextic:h,easeInOutSextic:y,easeOutSeptic:p,easeInSeptic:u,easeInOutSeptic:M,easeOutOctic:m,easeInOctic:c,easeInOutOctic:T,easeOutBack:I,easeInBack:A,easeInOutBack:C,easeOutCircle:N,easeInCircle:w,easeInOutCircle:E,easeOutElastic:O,easeInElastic:R,easeInOutElastic:F,easeOutBounce:P,easeInBounce:L,easeInOutBounce:D}},function(t,e,r){"use strict";var i=r(0),a=r(5),n=r(1),s=r(36),o=function(t,e,r){a.a.call(this),this._axis=n.f.fromValues(0,0,1),e&&n.f.copy(this._axis,e),this._target=s.a.createFloatTarget("number"==typeof r?r:0),t&&this.setName(t)};i.a.createPrototypeObject(o,i.a.objectInherit(a.a.prototype,{init:function(t,e){this.setAxis(t),this.setAngle(e),this._target.defaultValue=e},setAxis:function(t){n.f.copy(this._axis,t)},setAngle:function(t){this._target.value=t},getTarget:function(){return this._target},resetToDefaultValue:function(){this.setAngle(this._target.defaultValue)},applyToMatrix:function(){var t=n.c.create(),e=n.d.create();return function(r){var i=this._axis,a=e,s=t,o=this._target.value;n.d.setAxisAngle(a,i,o),n.c.fromQuat(s,a),n.c.mul(r,r,s)}}()}),"osgAnimation","StackedRotateAxis"),e.a=o},function(t,e,r){"use strict";var i=r(0),a=r(90),n=r(38),s=r(135),o=r(72),h=r(136),u=r(137),c=r(55),l=r(71),d=r(132),_=r(133),f={};f.Input=a.default,i.a.objectMix(f,n.default),f.DatabasePager=s.a,f.ObjectWrapper.serializers.osg=o.a,f.ObjectWrapper.serializers.osgAnimation=h.a,f.ObjectWrapper.serializers.osgText=u.a,f.Registry=c.a,f.fileHelper=l.a,f.requestFile=d.a,i.a.objectMix(f,_.a),e.a=f},function(t,e,r){"use strict";var i={prefixURL:"",databasePath:"",progressXHRCallback:void 0,readNodeURL:void 0,readImageURL:void 0,readBinaryArrayURL:void 0,imageLoadingUsePromise:!0,imageOnload:void 0,imageCrossOrigin:void 0};e.a=i},function(t,e,r){"use strict";var i=r(139),a=r.n(i),n=r(223),s=r(143),o=r(145),h=r(224),u=r(92),c=r(146),l=r(148),d=r(147),_=r(73),f=r(149),g=r(150),p=r(151),m=r(77),v=r(91),S=r(152),b=r(225),x=r(144),y=r(32),M={};a.a.NO_MOUSEEVENTS=!0,M.CADManipulator=n.a,M.getCADManipulatorStandardMouseKeyboardController=function(){return s.a},M.getCADManipulatorHammerController=function(){return o.a},M.FirstPersonManipulator=h.a,M.getFirstPersonDeviceOrientationController=function(){return u.a},M.getFirstPersonManipulatorHammerController=function(){return c.a},M.getFirstPersonStandardMouseKeyboardControllerClass=function(){return l.a},M.getFirstPersonWebVRControllerClass=function(){return d.a},M.Manipulator=_.a,M.OrbitManipulator=f.a,M.getOrbitManipulatorDeviceOrientationController=function(){return g.a},M.getOrbitManipulatorGamePadController=function(){return p.a},M.getOrbitManipulatorHammerController=function(){return m.a},M.getOrbitManipulatorStandardMouseKeyboardController=function(){return v.a},M.getOrbitManipulatorWebVRController=function(){return S.a},M.SwitchManipulator=b.a,M.OrbitManipulator.Rotate=x.a.ROTATE,M.OrbitManipulator.Pan=x.a.PAN,M.OrbitManipulator.Zoom=x.a.ZOOM,M.Controller=y.a,e.a=M},function(t,e,r){"use strict";var i=r(0),a=r(73),n=r(56),s=r(57),o=r(141),h=r(48),u=r(1),c=r(143),l=r(145),d=r(78),_=r(75),f=r(10),g=function(t){a.a.call(this,t),this._tmpHomePosition=u.f.create(),this._intersectionVisitor=new n.a,this._lineSegmentIntersector=new s.a,this._polytopeIntersector=void 0,this._usePolytopeIntersector=!1,this._primitiveMask=_.a.ALL_PRIMITIVES,this.init()};g.Interpolator=function(){this._current=u.e.create(),this._target=u.e.create(),this._delta=u.e.create(),this._reset=!1,this.reset(),this._width=void 0,this._height=void 0},g.Interpolator.prototype={setWidth:function(t){this._width=t},setHeight:function(t){this._height=t},reset:function(){for(var t=0,e=this._current.length;t<e;t++)this._current[t]=this._target[t]=0;this._reset=!0},update:function(){var t,e;return t=void 0===this._width?0:(this._target[0]-this._current[0])/this._width,this._delta[0]=t,this._current[0]=this._target[0],e=void 0===this._height?0:(this._target[1]-this._current[1])/this._height,this._delta[1]=e,this._current[1]=this._target[1],this._delta},set:function(){for(var t=0,e=this._current.length;t<e;t++)this._current[t]=this._target[t]=arguments[t];this._reset=!1},isReset:function(){return this._reset},getCurrent:function(){return this._current},setTarget:function(){for(var t=0,e=this._target.length;t<e;t++)this._reset?this._target[t]=this._current[t]=arguments[t]:this._target[t]=arguments[t];this._reset=!1},addTarget:function(){for(var t=0;t<arguments.length;t++)this._target[t]+=arguments[t]},getTarget:function(){return this._target},getDelta:function(){return this._delta}},g.AvailableControllerList=["StandardMouseKeyboard","Hammer"],g.ControllerList=["StandardMouseKeyboard","Hammer"],i.a.createPrototypeObject(g,i.a.objectInherit(a.a.prototype,{init:function(){this._distance=25,this._target=u.f.create(),this._upz=u.f.fromValues(0,0,1),this._right=u.f.fromValues(1,0,0),u.f.init(this._target);var t=u.c.fromRotation(u.c.create(),-Math.PI,this._upz),e=u.c.fromRotation(u.c.create(),Math.PI/10,this._right);this._rotation=u.c.create(),u.c.mul(this._rotation,t,e),this._time=0,this._rotate=new g.Interpolator,this._pan=new g.Interpolator,this._zoom=new d.a(1),this._panFactor=1.5,this._rotateFactor=1,this._zoomFactor=1,this._inverseMatrix=u.c.create(),this._homeEye=void 0,this._homeCenter=void 0,this._homeUp=u.f.fromValues(0,0,1),this._orientation=u.d.create(),this._pivotPoint=u.f.create(),this._eye=void 0,this._zoomDir=u.f.create();var r=this;g.ControllerList.forEach(function(t){void 0!==g[t]&&(r._controllerList[t]?r._controllerList[t].init():r._controllerList[t]=new g[t](r))})},setViewer:function(t){this._viewer=t},reset:function(){this.init()},setEnable:function(t){this.getInputManager().setEnable(f.a.CAD_MANIPULATOR,t)},setNode:function(t){this._node=t},setPivotPoint:function(t){u.f.copy(this._pivotPoint,t)},setTarget:function(){var t=u.f.create();return function(e){u.f.copy(this._target,e),this.getEyePosition(t),this._distance=u.f.distance(e,t)}}(),setEyePosition:function(t){u.f.copy(this._eye,t),this._distance=u.f.distance(this._target,t)},setHomePosition:function(t,e,r){this._homeEye=t,this._homeCenter=e,this._homeUp=r},computeHomePosition:function(){var t=u.f.create(),e=u.f.create(),r=u.f.create(),i=u.c.create();return function(a){var n=this.getHomeBoundingSphere(a);if(n){this.setDistance(this.getHomeDistance(n)),this.setTarget(n.center()),this.setPivotPoint(n.center()),void 0===this._homeEye&&(this._homeEye=u.f.create(),this.getEyePosition(this._homeEye)),void 0===this._homeCenter&&(this._homeCenter=u.f.create(),u.f.copy(this._homeCenter,n.center())),void 0===this._eye&&(this._eye=u.f.create()),u.f.copy(this._eye,this._homeEye),u.f.copy(this._target,this._homeCenter),u.f.copy(this._upz,this._homeUp),u.c.copy(i,this._rotation);var s=this._target,o=this._eye;u.f.sub(t,s,o),u.f.normalize(t,t),u.f.cross(e,t,this._upz),u.f.normalize(e,e),u.f.cross(r,e,t),u.f.normalize(r,r),i[0]=e[0],i[1]=r[0],i[2]=-t[0],i[3]=0,i[4]=e[1],i[5]=r[1],i[6]=-t[1],i[7]=0,i[8]=e[2],i[9]=r[2],i[10]=-t[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,u.c.getRotation(this._orientation,i),u.d.invert(this._orientation,this._orientation)}}}(),setZoomFactor:function(t){this._zoomFactor=t},setRotateFactor:function(t){this._rotateFactor=t},setPanFactor:function(t){this._panFactor=t},setDistance:function(t){this._distance=t},setUsePolytopeIntersector:function(t){this._usePolytopeIntersector=t},getUsePolytopeIntersector:function(){return this._usePolytopeIntersector},getDistance:function(){return this._distance},zoom:function(t){this._distance=t},getRotateInterpolator:function(){return this._rotate},getPanInterpolator:function(){return this._pan},getZoomInterpolator:function(){return this._zoom},getIntersectionVisitor:function(){return this._intersectionVisitor},getLineSegmentIntersector:function(){return this._lineSegmentIntersector},getOrCreatePolytopeIntersector:function(){return void 0===this._polytopeIntersector&&(this._polytopeIntersector=new o.a,this._polytopeIntersector.setIntersectionLimit(_.a.LIMIT_ONE_PER_DRAWABLE),this._polytopeIntersector.setPrimitiveMask(_.a.POINT_PRIMITIVES|_.a.LINE_PRIMITIVES)),this._polytopeIntersector},getTarget:function(t){return u.f.copy(t,this._target),t},getEyePosition:function(t){void 0===this._eye?this.computeEyePosition(this._target,this._distance,t):u.f.copy(t,this._eye)},computeEyePosition:function(){var t=u.f.create(),e=u.c.create();return function(r,i,a){u.c.invert(e,this._rotation),t[1]=i,u.f.transformMat4(a,t,e),u.f.add(a,r,a)}}(),computePan:function(){var t=u.f.create(),e=u.f.create(),r=u.f.create();return function(i,a,n){var s=u.f.length(u.f.sub(r,this._eye,this._pivotPoint))/this._panFactor;s<10&&(s=10),t[0]=i*s/2,t[1]=a*s/2,t[2]=0,u.f.transformMat4(e,t,n),u.f.add(this._eye,this._eye,e)}}(),computeZoom:function(){var t=u.f.create(),e=u.f.create();return function(r){var i=r*this._zoomFactor;u.f.sub(t,this._pivotPoint,this._eye),u.f.add(this._eye,this._eye,u.f.scale(e,t,i))}}(),computeRotation:function(){var t=u.f.create(),e=u.f.create(),r=u.f.create(),i=u.f.create(),a=u.d.create(),n=u.d.create(),s=u.d.create(),o=u.f.create(),h=u.f.create();return function(c,l){u.f.transformQuat(e,this._right,this._orientation),u.f.normalize(t,e),u.f.sub(r,this._eye,this._pivotPoint);var d=u.f.dot(t,r);u.f.sub(i,r,u.f.scale(h,t,d));var _=u.f.fromValues(-i[0],-i[1],0),f=Math.atan2(-i[2],u.f.length(_));l=Math.max(-Math.PI/2+.01,Math.min(Math.PI/2-.01,f+l))-f,u.d.setAxisAngle(a,e,l*this._rotateFactor),u.d.setAxisAngle(n,this._upz,c*this._rotateFactor),u.d.mul(s,n,a),u.f.transformQuat(o,r,s),u.f.add(this._eye,o,this._pivotPoint),u.d.mul(this._orientation,n,this._orientation),u.f.transformQuat(e,this._right,this._orientation),u.d.setAxisAngle(a,e,l*this._rotateFactor),u.d.mul(this._orientation,a,this._orientation)}}(),update:function(){var t=u.c.create(),e=u.c.create();return function(r){var i=r.getFrameStamp().getDeltaTime(),a=this._rotate.update();this.computeRotation(10*-a[0],10*a[1]),u.c.fromQuat(t,this._orientation);var n=this._pan.update();this.computePan(10*-n[0],10*-n[1],t),a=this._zoom.update(i),this.computeZoom(-a[0]/10),u.c.fromTranslation(e,this._eye),u.c.mul(this._inverseMatrix,e,t),u.c.invert(this._inverseMatrix,this._inverseMatrix)}}(),getInverseMatrix:function(){return this._inverseMatrix},computeIntersections:function(){var t=[],e=u.f.create();return function(r,i){var a=this._camera.getView(),n=this._camera,s=n.getViewport().width(),o=n.getViewport().height();this._rotate.setWidth(s),this._rotate.setHeight(o),this._pan.setWidth(s),this._pan.setHeight(o);var c,l;if(0!=(this._primitiveMask&_.a.TRIANGLE_PRIMITIVES)&&(t=a.computeIntersections(r,i),t.length>0&&(c=t[0]._localIntersectionPoint,t[0]._nodePath.shift(),l=h.a.computeLocalToWorld(t[0]._nodePath),u.f.transformMat4(e,c,l),this.setPivotPoint(e))),0===t.length&&this._usePolytopeIntersector){var d=this.getOrCreatePolytopeIntersector();d.reset(),d.setPolytopeFromWindowCoordinates(r-5,i-5,r+5,i+5);var f=this._intersectionVisitor;f.setIntersector(d),a.getCamera().accept(f),t=d.getIntersections(),t.sort(function(t,e){return t._distance-e._distance}),t.length>0&&(c=t[0]._localIntersectionPoint,t[0]._nodePath.shift(),l=h.a.computeLocalToWorld(t[0]._nodePath),u.f.transformMat4(e,c,l),this.setPivotPoint(e))}}}(),getPositionRelativeToCanvas:function(){var t=u.e.create(),e=u.e.create();return function(r,i){var a=this._camera._graphicContext.canvas;this.getOffsetRect(a,t);var n=a.width/a.clientWidth,s=a.height/a.clientHeight;return e[0]=(r-t[1])*n,e[1]=(a.clientHeight-(i-t[0]))*s,e}}(),getCanvasCenter:function(){var t=u.e.create(),e=u.e.create();return function(){var r=this._camera.getGraphicContext().canvas;this.getOffsetRect(r,t);var i=r.width/r.clientWidth,a=r.height/r.clientHeight;return e[0]=r.clientWidth/2*i,e[1]=r.clientHeight/2*a,e}}(),getOffsetRect:function(t,e){var r=t.getBoundingClientRect(),i=document.body,a=document.documentElement,n=window.pageYOffset||a.scrollTop||i.scrollTop,s=window.pageXOffset||a.scrollLeft||i.scrollLeft,o=a.clientTop||i.clientTop||0,h=a.clientLeft||i.clientLeft||0,u=r.top+n-o,c=r.left+s-h;return e[0]=Math.round(u),e[1]=Math.round(c),e}}),"osgGA","CADManipulator"),g.StandardMouseKeyboard=c.a,g.Hammer=l.a,e.a=g},function(t,e,r){"use strict";var i=r(0),a=r(73),n=r(1),s=r(92),o=r(146),h=r(147),u=r(148),c=r(78),l=r(10),d=function(t){a.a.call(this,t),this.init()};d.AvailableControllerList=["StandardMouseKeyboard","WebVR","DeviceOrientation","Hammer"],d.ControllerList=["StandardMouseKeyboard","WebVR","DeviceOrientation","Hammer"],i.a.createPrototypeObject(d,i.a.objectInherit(a.a.prototype,{computeHomePosition:function(t){var e=this.getHomeBoundingSphere(t);if(e&&e.valid()){this._distance=this.getHomeDistance(e);var r=e.center();n.f.scale(this._eye,this._direction,-this._distance),n.f.add(this._eye,r,this._eye),this.setTarget(r)}},init:function(){this._direction=n.f.fromValues(0,1,0),this._eye=n.f.fromValues(0,25,10),this._up=n.f.fromValues(0,0,1),this._distance=1,this._forward=new c.a(1),this._side=new c.a(1),this._lookPosition=new c.a(2),this._pan=new c.a(2),this._zoom=new c.a(1),this._stepFactor=1,this._angleVertical=0,this._angleHorizontal=0,this._tmpGetTargetDir=n.f.create(),this._vrEnable=!1,this._vrRot=n.d.create(),this._vrPos=n.f.create(),this._vrTrans=n.f.create();var t=this;this._controllerList={},d.ControllerList.forEach(function(e){void 0!==d[e]&&(t._controllerList[e]?t._controllerList[e].init():t._controllerList[e]=new d[e](t))})},setDelay:function(t){this._forward.setDelay(t),this._side.setDelay(t),this._lookPosition.setDelay(t),this._pan.setDelay(t),this._zoom.setDelay(t)},getEyePosition:function(t){return t[0]=this._eye[0],t[1]=this._eye[1],t[2]=this._eye[2],t},setEyePosition:function(t){return this._eye[0]=t[0],this._eye[1]=t[1],this._eye[2]=t[2],this},getTarget:function(t){var e=n.f.scale(this._tmpGetTargetDir,this._direction,this._distance);return n.f.add(t,this._eye,e),t},setEnable:function(t){this.getInputManager().setEnable(l.a.FPS_MANIPULATOR,t)},setTarget:function(t){var e=this._tmpGetTargetDir;n.f.sub(e,t,this._eye),e[2]=0,n.f.normalize(e,e),this._angleHorizontal=Math.acos(e[1]),e[0]<0&&(this._angleHorizontal=-this._angleHorizontal),n.f.sub(e,t,this._eye),n.f.normalize(e,e),this._angleVertical=-Math.asin(e[2]),n.f.copy(this._direction,e)},getLookPositionInterpolator:function(){return this._lookPosition},getSideInterpolator:function(){return this._side},getForwardInterpolator:function(){return this._forward},getPanInterpolator:function(){return this._pan},getZoomInterpolator:function(){return this._zoom},getRotateInterpolator:function(){return this._lookPosition},computeRotation:function(){var t=n.c.create(),e=n.c.create(),r=n.f.fromValues(1,0,0),i=n.f.fromValues(0,1,0),a=n.f.fromValues(0,0,1),s=.5*Math.PI;return function(o,h){this._angleVertical+=.01*h,this._angleHorizontal-=.01*o,this._angleVertical>s?this._angleVertical=s:this._angleVertical<-s&&(this._angleVertical=-s),this._vrEnable?(n.f.transformQuat(this._direction,i,this._vrRot),n.f.normalize(this._direction,this._direction),n.f.transformQuat(this._up,a,this._vrRot)):(n.c.fromRotation(t,-this._angleVertical,r),n.c.fromRotation(e,-this._angleHorizontal,a),n.c.mul(e,e,t),n.f.transformMat4(this._direction,i,e),n.f.normalize(this._direction,this._direction),n.f.transformMat4(this._up,a,e))}}(),reset:function(){this.init()},setDistance:function(t){this._distance=t},getDistance:function(){return this._distance},setStepFactor:function(t){this._stepFactor=t},computePosition:function(){var t=n.e.create();return function(e){this._forward.update(e),this._side.update(e);var r=this._distance<.001?.001:this._distance,i=this._camera.getProjectionMatrix(),a=1===i[15]?1:2/i[5];t[0]=this._forward.getCurrent()[0],t[1]=this._side.getCurrent()[0];var s=n.e.sqrLen(t);s>1&&n.e.scale(t,t,1/Math.sqrt(s));var o=this._pan.update(e),h=this._zoom.update(e),u=this._stepFactor*r*a*e,c=this._stepFactor*r*a*.005;this.moveForward(t[0]*u-h[0]*c*20),this.strafe(t[1]*u-o[0]*c),this.strafeVertical(-o[1]*c),this._vrEnable&&(n.f.add(this._eye,this._eye,this._vrTrans),n.f.init(this._vrTrans))}}(),update:function(){var t=n.f.create();return function(e){var r=e.getFrameStamp().getDeltaTime(),i=this._lookPosition.update(r);this.computeRotation(.5*-i[0],.5*-i[1]),this.computePosition(r),n.f.add(t,this._eye,this._direction),n.c.lookAt(this._inverseMatrix,this._eye,t,this._up),this._vrEnable=!1}}(),setPoseVR:function(t,e){this._vrEnable=!0,n.d.copy(this._vrRot,t),n.f.sub(this._vrTrans,e,this._vrPos),n.f.copy(this._vrPos,e)},moveForward:function(){var t=n.f.create();return function(e){n.f.normalize(t,this._direction),n.f.scale(t,t,e),n.f.add(this._eye,this._eye,t)}}(),strafe:function(){var t=n.f.create();return function(e){n.f.cross(t,this._direction,this._up),n.f.normalize(t,t),n.f.scale(t,t,e),n.f.add(this._eye,this._eye,t)}}(),strafeVertical:function(){var t=n.f.create();return function(e){n.f.normalize(t,this._up),n.f.scale(t,t,e),n.f.add(this._eye,this._eye,t)}}()}),"osgGA","FirstPersonManipulator"),d.DeviceOrientation=s.a,d.Hammer=o.a,d.WebVR=h.a,d.StandardMouseKeyboard=u.a,e.a=d},function(t,e,r){"use strict";var i=r(2),a=function(t){this._manipulatorList=[],this._currentManipulator=void 0,this._inputManager=t};a.prototype={getCamera:function(){return this.getCurrentManipulator().getCamera()},setCamera:function(t){for(var e=this.getManipulatorList(),r=0,i=e.length;r<i;++r)e[r].setCamera(t)},update:function(t){var e=this.getCurrentManipulator();if(void 0!==e)return e.update(t)},getInputManager:function(){return this._inputManager},setEnable:function(t){this.getCurrentManipulator().setEnable(t)},getNode:function(){return this.getCurrentManipulator()._node},setNode:function(t){for(var e=this.getManipulatorList(),r=0,i=e.length;r<i;++r)e[r].setNode(t)},getControllerList:function(){return this.getCurrentManipulator().getControllerList()},getNumManipulator:function(){return this._manipulatorList.length},addManipulator:function(t){this._manipulatorList.push(t),void 0===this._currentManipulator&&this.setManipulatorIndex(0)},getManipulatorList:function(){return this._manipulatorList},setManipulatorIndex:function(t){this._currentManipulator=t},getCurrentManipulatorIndex:function(){return this._currentManipulator},getCurrentManipulator:function(){return this._manipulatorList[this._currentManipulator]},reset:function(){this.getCurrentManipulator().reset()},computeHomePosition:function(t){var e=this.getCurrentManipulator();void 0!==e&&e.computeHomePosition(t)},getInverseMatrix:function(){var t=this.getCurrentManipulator();if(void 0!==t)return t.getInverseMatrix()},getHomeBound:function(t){return i.a.warn("Please use getHomeBoundingSphere instead"),this.getHomeBoundingSphere(t)},getHomeBoundingSphere:function(t){return this.getCurrentManipulator().getHomeBoundingSphere(t)},getHomeDistance:function(t){return this.getCurrentManipulator().getHomeDistance(t)}},e.a=a},function(t,e,r){"use strict";var i=r(227),a=r(153),n=r(78),s=r(154),o=r(158),h=r(95),u=r(76),c=r(74),l=r(56),d=r(57),_=r(140),f=r(0),g=r(235),p=r(161),m=r(141),v=r(142),S=r(236),b=r(238),x=r(239),y=r(240),M=r(75),T={};T.ComposerPostProcess=i.a,f.a.objectMix(T,a.a),T.DelayInterpolator=n.a,T.DisplayNormalVisitor=s.a,T.DisplayGeometryVisitor=o.a,T.DisplayGraph=h.a,T.IntersectFunctor=u.a,T.Intersector=c.a,T.IntersectionVisitor=l.a,T.LineSegmentIntersector=d.a,T.LineSegmentIntersectFunctor=_.a,T.NodeGizmo=g.a,T.GizmoGeometry=p.a,T.WebVRCustom=x.a,T.PolytopeIntersector=m.a,T.PolytopeIntersectFunctor=v.a,T.SphereIntersector=S.a,T.TangentSpaceGenerator=b.a,T.WebVR=y.a,T.NO_LIMIT=M.a.NO_LIMIT,T.LIMIT_ONE_PER_DRAWABLE=M.a.LIMIT_ONE_PER_DRAWABLE,T.LIMIT_ONE=M.a.LIMIT_ONE,T.POINT_PRIMITIVES=M.a.POINT_PRIMITIVES,T.LINE_PRIMITIVES=M.a.LINE_PRIMITIVES,T.TRIANGLE_PRIMITIVES=M.a.TRIANGLE_PRIMITIVES,T.ALL_PRIMITIVES=M.a.ALL_PRIMITIVES,e.a=T},function(t,e,r){"use strict";var i=r(0),a=r(8),n=r(42),s=r(31),o=r(7),h=r(6),u=r(17),c=r(15),l=r(30),d=r(37),_=r(21),f=r(26),g=r(35),p=r(12),m=r(68),v=function(){a.a.call(this),this._feedbackSwapped=!1,this._syncFeedbackUniforms=!1,this._syncOnNextFrame=!1,this._lastXratio=1,this._lastYratio=1,this._xViewportRatio=1,this._yViewportRatio=1,this._xTextureRatio=1,this._yTextureRatio=1,this._finalPassUpScaleToScreen=!0,this._methodWrapUV=0,this._thresholdWrapUV=1,this._texInfos=void 0,this._screenWidth=this._screenHeight=0,this._shaderProcessor=Object(m.a)(),this._feedbackData={},this._cameras=[],this._stateSets=[],this._textureUniforms=[],this._programs={},this._externalTextures={},this._internalPasses=[],this._textures={},this._userTextures={},this._currentPoolIndex=0,this._texturePool={},this._firstTexture="";var t=this.getOrCreateStateSet();t.setAttributeAndModes(new s.a(s.a.DISABLE)),t.setAttributeAndModes(new n.a(n.a.BACK)),this.setCullCallback(this)};v.VertexShader=["attribute vec3 Vertex;","void main(void) {","  gl_Position = vec4(Vertex * 2.0 - 1.0, 1.0);","}","","#define SHADER_NAME %name%",""].join("\n"),v.FragmentShader=["#ifdef GL_FRAGMENT_PRECISION_HIGH\n precision highp float;\n#else\n precision mediump float;\n#endif","uniform float uRGBMRange;","vec2 gTexCoord;","%uniforms%","",'#pragma include "functions.glsl"',"","%header%","","%texturesColorSpace%","","%functionBodies%","","void main() {","\tgTexCoord = gl_FragCoord.xy / uTextureOutputSize.xy;","\tvec4 color = %firstFunc%(%firstArg%);","%optionalFuncs%","%colorSpaces%","\tgl_FragColor = color;","}","","#define SHADER_NAME %name%",""].join("\n"),i.a.createPrototypeObject(v,i.a.objectInherit(a.a.prototype,{clear:function(){this._textures={},this._internalPasses.length=0,this._firstTexture="";for(var t in this._texturePool)this._texturePool[t].usage=-1;this._feedbackData={},this._cameras.length=0,this._stateSets.length=0,this._textureUniforms.length=0,this.removeChildren()},clearShaderCache:function(){this._programs={}},getGlobalXRatio:function(){return this._xViewportRatio*this._xTextureRatio},getGlobalYRatio:function(){return this._yViewportRatio*this._yTextureRatio},setFinalPassUpScaleToScreen:function(t){this._finalPassUpScaleToScreen=t},_enforceFromInputParameter:function(t,e){var r=e.name,i=this._textures[r],a=this._textures[r+"FeedbackTexture"],n=e[t];void 0!==n&&(void 0!==i[t]&&i[t]!==n&&console.error("Mismatch on parameter "+t+" : "+r),i[t]=n,a&&(a[t]=n))},_updatePassInfoFromInputs:function(t,e,r){var i=this._textures[e],a=r.srgb;r.srgb=void 0;for(var n=0;n<t.textures.length;n++){var s=t.textures[n];this._renameTextureAlias(s,e,r.name);var o=s.name;if(!this._externalTextures[o]){this._usages[o]=(this._usages[o]||0)+1;var h=s.srgb;this._enforceFromInputParameter("filter",s),this._enforceFromInputParameter("rgbm",s),this._enforceFromInputParameter("srgb",s);var u=this._textures[o];if(!u){var c=o.substring(0,o.indexOf("FeedbackTexture"));u=this._textures[c]}void 0!==a&&void 0!==h&&a!==h&&(u.encodeSRGB=!0),this._setInferredParameter("rgbmInferred","rgbm",i,u),this._setInferredParameter("srgbInferred","srgb",i,u)}}void 0===r.srgb&&(r.srgb=void 0===i.srgb?i.srgbInferred:i.srgb)},_setInferredParameter:function(t,e,r,i){void 0===r[t]&&(r[t]=void 0===i[e]?i[t]:i[e])},_createTextureOut:function(t,e,r){var i={srgb:t.out.srgb,rgbm:t.out.rgbm,filter:t.out.filter,type:t.out.type},a=t.out.type!==o.default.UNSIGNED_BYTE;return void 0===i.rgbm&&(r||a)&&(i.rgbm=!1),void 0===i.srgb&&(r?i.srgb=!0:(i.rgbm||a)&&(i.srgb=!1)),i},_processUserPasses:function(t){t=this._internalPasses.concat(t);for(var e=this._preprocessUserPasses(t),r=e.length,i=[],a={name:this._firstTexture,srgb:void 0},n={},s=0;s<r;s++){var o=e[s],h=s===r-1;if(h||!this._collapsePasses(o,e[s+1])){var u=o.out.name,c="%next"===u;c&&(u=o.funcs.join("_"),n[u]?u+=n[u]++:n[u]=1);var l=this._createTextureOut(o,u,h);this._textures[u]=l,this._updatePassInfoFromInputs(o,u,a),o.feedbackLoop&&(this._textures[u+"FeedbackTexture"]={srgb:l.srgb,rgbm:l.rgbm,srgbInferred:l.srgbInferred,rgbmInferred:l.rgbmInferred,filter:l.filter}),c&&(a.name=u,o.out.name=u),i.push(o)}else e.splice(s+1,1),r--,s--}return i},_hasFreeTexture:function(t,e,r){if(t===r.name&&this._texturePool[t])return t;if(!r.immuable)for(var i in this._texturePool){var a=this._texturePool[i];if(a.reusable&&(!(a.usage>0)&&a.texture.divisor===r.divisor&&a.texture.getInternalFormatType()===r.type)){if(-1===a.usage)return a.texture.getMinFilter()!==e&&(a.texture.setMinFilter(e),a.texture.setMagFilter(e)),i;if(a.texture.getMinFilter()===e)return i}}},_setOrCreateTextureKey:function(t,e,r){var i="linear"===this._textures[e].filter,a=i?o.default.LINEAR:o.default.NEAREST,n=this._hasFreeTexture(e,a,r);if(n)return this._texturePool[n].usage=t,void(this._textures[e].key=n);n=r.immuable?e:"key"+this._currentPoolIndex++,this._texturePool[n]={usage:t,texture:this._createTexture(e,r.divisor,r.type,a),immuable:r.immuable,reusable:r.reusable},-1===r.divisor&&(this._texturePool[n].width=r.width,this._texturePool[n].height=r.height),this._textures[e].key=n},_addStateSet:function(t,e){for(var r=0;r<t.funcs.length;r++){var i=t.funcs[r].name;this._stateSets[i]=e}},_addTextureToStateSet:function(t,e,r,i,a){e.addUniform(h.a.createInt1(r,t.uniformName));var n,s=t.name;if(void 0!==this._textures[s]){var o=this._textures[s].key;n=this._texturePool[o].texture}else n=this._externalTextures[s];if(this._addTextureUniforms(t.uniformName,n,e,i,a),"TexturePrevious"===t.uniformName)return r;e.setTextureAttributeAndModes(r,n)},_getUniformName:function(t){return"u"+t[0].toUpperCase()+t.slice(1)},_addTextureUniforms:function(t,e,r,i,a){var n=this._getUniformName(t),s=h.a.createFloat2(n+"Size"),o=h.a.createFloat2(n+"Ratio");r.addUniform(s),r.addUniform(o),i.push(s),i.push(o),this._textureUniforms.push({size:s,ratio:o,texture:e,isFeedback:!!a})},_checkInferredParameters:function(){for(var t in this._textures){var e=this._textures[t];void 0===e.srgb&&(e.srgb=e.srgbInferred),void 0===e.rgbm&&(e.rgbm=e.rgbmInferred)}},_buildPass:function(t,e){var r=e[t],i=r.out.name;this._setOrCreateTextureKey(this._usages[i],i,r.out);var a=r.out.name+"FeedbackTexture";if(r.feedbackLoop&&this._setOrCreateTextureKey(this._usages[a],a,r.out),!r.funcs.length){var n=this._textures[i].key;return void(this._userTextures[i]=this._texturePool[n].texture)}var s=new u.a;this._addStateSet(r,s);var o;for(o=0;o<r.uniforms.length;o++)s.addUniform(r.uniforms[o]);var h=[],c=void 0;for(o=0;o<r.textures.length;o++){var l=r.textures[o],d=l.name===a;if(!d&&!this._externalTextures[l.name]){var _=this._textures[l.name].key;this._texturePool[_].usage--}var f=this._addTextureToStateSet(l,s,o,h,d);if(void 0!==f&&(c=f),void 0!==this._feedbackData[l.name]){var g={stateSet:s,textureUnit:o};this._feedbackData[l.name].nextPasses.push(g)}}var p=void 0;if(t!==e.length-1){var m=this._textures[i].key;p=this._texturePool[m].texture}this._addTextureUniforms("TextureOutput",p,s,h),s.setAttributeAndModes(this._createProgram(r,h)),r.feedbackLoop?this._feedbackData[i]=this._createFeedbackLoopCameras(i,s,p,c):this.addChild(this._createCamera(i,s,p))},_buildGraphFromPasses:function(t){for(var e=0;e<t.length;e++)this._buildPass(e,t)},build:function(t){this._usages={};var e=this._processUserPasses(t);this._checkInferredParameters(e),this._buildGraphFromPasses(e),this.resize(this._screenWidth,this._screenHeight)},_createFeedbackLoopCameras:function(t,e,r,i){var n=this._textures[t+"FeedbackTexture"].key,s=this._texturePool[n].texture,o=new a.a;o.setStateSet(e);var h=this._createFeedbackLoopCamera(t,r,s,i),u=this._createFeedbackLoopCamera(t+"FeedbackTexture",s,r,i);u.setNodeMask(0),o.addChild(h),o.addChild(u),this.addChild(o);var c={};return c.camera1=h,c.camera2=u,c.texture1=r,c.texture2=s,c.nextPasses=[],c},_createFeedbackLoopCamera:function(t,e,r,i){var a=new u.a;a.setTextureAttributeAndModes(i,r);var n=this._createCamera(t,a,e);return n.setStateSet(a),n},_createCamera:function(t,e,r){var i=new c.a;i.setName(t),i.setStateSet(e),i.setClearMask(0),i.setReferenceFrame(p.a.ABSOLUTE_RF),r&&(i.setRenderOrder(c.a.PRE_RENDER,0),i.attachTexture(l.a.COLOR_ATTACHMENT0,r)),i.setViewport(new d.a);var a=g.a.createTexturedFullScreenFakeQuadGeometry();return a.setName("composer layer"),i.addChild(a),this._cameras.push(i),i},swapFeedbackLoopTextures:function(t){for(var e in this._feedbackData){var r=this._feedbackData[e];r.camera1.setNodeMask(t?-1:0),r.camera2.setNodeMask(t?0:-1);for(var i=t?r.texture1:r.texture2,a=0;a<r.nextPasses.length;a++){var n=r.nextPasses[a];n.stateSet.setTextureAttributeAndModes(n.textureUnit,i)}}this._feedbackSwapped=!0},_createFuncFromUserData:function(t){var e="string"==typeof t?{name:t,file:t+".glsl"}:t;return e.toString=function(){return this.name},e},_createTextureInfoFromUserData:function(t){var e={name:"",uniformName:"",rgbm:void 0,srgb:void 0,filter:void 0};return"string"==typeof t?e.name=t:(e.name=t.name,t.uniformName&&(e.uniformName=t.uniformName),void 0!==t.rgbm&&(e.rgbm=t.rgbm),void 0!==t.srgb&&(e.srgb=t.srgb),void 0!==t.filter&&(e.filter=t.filter)),e},_preprocessUserPasses:function(t){for(var e=[],r=0;r<t.length;r++){var i=t[r],a={};if(a.funcs=[],i.func&&a.funcs.push(this._createFuncFromUserData(i.func)),a.textures=[],a.feedbackLoop=!1,void 0!==i.textures){Array.isArray(i.textures)||(i.textures=[i.textures]);for(var n=0;n<i.textures.length;n++){var s=this._createTextureInfoFromUserData(i.textures[n]);"%previous"===s.name&&(a.feedbackLoop=!0),a.textures.push(s)}}"string"==typeof i.header?a.header=[i.header]:a.header=i.header||[],void 0!==i.uniforms?Array.isArray(i.uniforms)?a.uniforms=i.uniforms:a.uniforms=[i.uniforms]:a.uniforms=[],a.out=i.out,a.out.divisor=a.out.divisor||1,a.out.type=a.out.type||o.default.UNSIGNED_BYTE,void 0===a.out.immuable&&(a.out.immuable=!1),void 0===a.out.reusable&&(a.out.reusable=!0),(a.feedbackLoop||-1===a.out.divisor)&&(a.out.immuable=!0,a.out.reusable=!1),a.collapsible=i.collapsible||!1,e.push(a)}return e},_canBeCollapsed:function(t,e){return t.funcs.length&&e.collapsible&&"%next"===t.out.name&&t.out.divisor===e.out.divisor&&t.out.width===t.out.width&&t.out.height===t.out.height},_collapsePasses:function(t,e){return!!this._canBeCollapsed(t,e)&&(t.funcs=t.funcs.concat(e.funcs),t.header=t.header.concat(e.header),t.textures=this._mergeWithoutDuplicates(t.textures,e.textures,function(t,e){return t.name===e.name}),t.uniforms=this._mergeWithoutDuplicates(t.uniforms,e.uniforms,function(t,e){return t.getName()===e.getName()}),!0)},_renameTextureAlias:function(t,e,r){"%last"===t.name?(t.name=r,t.uniformName=t.uniformName||"TextureInput"):"%previous"===t.name?(t.name=e+"FeedbackTexture",t.uniformName=t.uniformName||"TexturePrevious"):t.uniformName||(t.uniformName=t.name)},_createTexture:function(t,e,r,i){var a=new o.default;return a.setTextureSize(1,1),a.setInternalFormatType(r),a.setInternalFormat(o.default.RGBA),a.setMinFilter(i),a.setMagFilter(i),a.divisor=e,a.setName(t),a},_computeHashFromPass:function(t){for(var e="",r=0;r<t.funcs.length;r++)e+=t.funcs[r].name+"_"+t.funcs[r].file+"_";for(t.header&&(e+=t.header.join("_")),r=0;r<t.textures.length;r++)e+=!!t.textures[r].rgbm+"_"+!!t.textures[r].srgb+"_";return e+=!!t.out.encodeSRGB+"_",e+=!!this._textures[t.out.name].rgbm+"_"},_writeDeclarations:function(t,e,r,i){var a,n="uniform sampler2D TextureInput;\n";for(a=0;a<r.length;a++){n+="uniform sampler2D "+(r[a].uniformName||r[a].name)+";\n"}for(a=0;a<e.length;a++){var s=e[a];n+="uniform "+s.getType()+" "+s.getName()+";\n"}return t=t.replace("%uniforms%",n),i&&(t=t.replace("%header%",i.join("\n"))),t},setMethodWrapUV:function(t,e){void 0!==t&&(this._methodWrapUV=t),void 0!==e&&(this._thresholdWrapUV=e),this._texInfos=void 0},_getInfos:function(){if(this._texInfos)return this._texInfos;var t="texture2D(%tex, (uv) * %ratio)",e="texture2D(%tex, (floor((uv) * %size) + 0.5) * %ratio / %size, -99999.0)",r="texture2D(%tex, (uv) * %ratio)",i=this._thresholdWrapUV.toExponential();if(1===this._methodWrapUV){var a="min(uv, 1.0 - "+i+" / %size.xy)";t=t.replace(/(uv)/g,a),e=e.replace(/(uv)/g,a),r=r.replace(/(uv)/g,a)}else if(2===this._methodWrapUV){var n="step((uv).x, 1.0 - "+i+" / %size.x) *";n+="step((uv).y, 1.0 - "+i+" / %size.y) * ",t=n+t,e=n+e,r=n+r}return this._texInfos={TEXTURE_2D:{signature:"TEXTURE_2D_%tex(uv)",body:t},TEXTURE_2D_NEAREST:{signature:"TEXTURE_2D_NEAREST_%tex(uv)",body:e},TEXTURE_2D_BIAS:{signature:"TEXTURE_2D_BIAS_%tex(uv, bias)",body:r}},this._texInfos},_extractTextures:function(t){var e=this._getInfos(),r=t.match(/TEXTURE_2D(?:_BIAS|_NEAREST)?_\w+\(/g);if(!r)return{};for(var i={},a=0;a<r.length;a++){var n=r[a].match(/((TEXTURE_2D(?:_BIAS|_NEAREST)?)_(\w+))\(/),s=e[n[2]];i[n[1]]={name:n[3],signature:s.signature,body:s.body}}return i},_writeFunctionBodies:function(t,e,r,i){for(var a=[],n="",s={},o=0;o<e.length;o++){n+=this._shaderProcessor.getShaderTextPure(e[o].file)+"\n"}var h=["functions.glsl"];n=this._shaderProcessor.preprocess(n,0,h);var u=this._extractTextures(n);if(i){var c=this._getInfos().TEXTURE_2D;u.TEXTURE_2D_TextureInput={name:"TextureInput",signature:c.signature,body:c.body}}for(var l in u)if(!s[l]){s[l]=!0;for(var d=u[l],_=d.name,f=!1,g=0;g<r.length;g++){var p=r[g];if(p.uniformName===_){var m=this._textures[p.name];if(m&&m.rgbm){f=m.rgbm;break}}}var v=d.body;f&&(v="vec4(decodeRGBM("+v+", uRGBMRange), 1.0)"),v="#define "+d.signature+" ("+v+")";var S=this._getUniformName(_);v=v.replace(/%size/g,S+"Size"),v=v.replace(/%ratio/g,S+"Ratio"),v=v.replace(/%tex/g,_),a.push(v)}return t=t.replace("%texturesColorSpace%",a.join("\n")),t.replace("%functionBodies%",n.replace(/\\\n/g,""))},_writeMainFunction:function(t,e,r,i){t=t.replace("%firstFunc%",e[0].name);var a=r?"TEXTURE_2D_TextureInput(gTexCoord)":"";t=t.replace("%firstArg%",a);for(var n="",s=1;s<e.length;s++)n+="\tcolor = "+e[s].name+"(color);\n";if(t=t.replace("%optionalFuncs%",n),!0===this._textures[i].encodeSRGB){n="\tcolor.rgb = "+(this._textures[i].srgb?"linearTosRGB":"sRGBToLinear")+"(color.rgb);\n"}else n="";return this._textures[i].rgbm?n+="\tcolor = encodeRGBM(color.rgb, uRGBMRange);":n+="",t.replace("%colorSpaces%",n)},_removeDuplicatedUniforms:function(t){for(var e=t.split("\n"),r={},i=e.length,a=0;a<i;a++){var n=e[a].match(/uniform(?:\s+){1,}\w+(?:\s+){1,}(\w+)/);if(null!==n){var s=n[1];void 0!==r[s]?(e.splice(a,1),i--,a--):r[s]=!0}}return e.join("\n")},_createProgram:function(t,e){var r=this._computeHashFromPass(t);if(void 0!==this._programs[r])return this._programs[r];var i=this._writeDeclarations(v.FragmentShader,e,t.textures,t.header);i=this._writeFunctionBodies(i,t.funcs,t.textures,t.collapsible),i=this._writeMainFunction(i,t.funcs,t.collapsible,t.out.name),i=i.replace("%name%",t.out.name),i=this._removeDuplicatedUniforms(i);var a=v.VertexShader.replace("%name%",t.out.name),n=new _.a(new f.a(f.a.VERTEX_SHADER,a),new f.a(f.a.FRAGMENT_SHADER,i));return this._programs[r]=n,n},resize:function(t,e){this.setScreenSize(t,e);for(var r in this._texturePool){var i=this._texturePool[r].texture;void 0===this._texturePool[r].width?i.setTextureSize(this._getTextureSize(t,i.divisor),this._getTextureSize(e,i.divisor)):i.setTextureSize(this._texturePool[r].width,this._texturePool[r].height)}this.resizeRatio()},resizeRatio:function(t,e,r,i){void 0!==t&&(this._xViewportRatio=t),void 0!==e&&(this._yViewportRatio=e),void 0!==r&&(this._xTextureRatio=r),void 0!==i&&(this._yTextureRatio=i),this._resizeViewports(),this._resizeTextureUniforms()},_resizeViewports:function(){for(var t=this.getGlobalXRatio(),e=this.getGlobalYRatio(),r=this._cameras,i=0;i<r.length;++i){var a=r[i],n=a.isRenderToTextureCamera(),s=1;if(n){s=a.getAttachments()[l.a.COLOR_ATTACHMENT0].texture.divisor}if(i===r.length-1&&this._finalPassUpScaleToScreen&&(t=this._xViewportRatio,e=this._yViewportRatio),-1!==s){var o=this._getTextureSize(this._screenWidth,s/t),h=this._getTextureSize(this._screenHeight,s/e);a.getViewport().setViewport(0,0,o,h)}}},_resizeTextureUniforms:function(){var t=this.getGlobalXRatio(),e=this.getGlobalYRatio(),r=this._finalPassUpScaleToScreen?this._xViewportRatio:t,i=this._finalPassUpScaleToScreen?this._yViewportRatio:e;this._syncFeedbackUniforms=!0;for(var a=this._textureUniforms,n=0;n<a.length;++n){var s=a[n],o=s.size.getInternalArray(),h=s.ratio.getInternalArray();if(!s.isFeedback||!o[0]){h[0]=t,h[1]=e;var u=s.texture;u?!u.divisor||u.divisor<0?(o[0]=u.getWidth(),o[1]=u.getHeight(),h[0]=h[1]=1):(o[0]=t*u.getWidth(),o[1]=e*u.getHeight()):(o[0]=this._screenWidth*r,o[1]=this._screenHeight*i)}}},_resizeFeedbackTextureUniforms:function(){for(var t=this._lastXratio,e=this._lastYratio,r=this._textureUniforms,i=0;i<r.length;++i){var a=r[i];if(a.isFeedback){var n=a.size.getInternalArray(),s=a.ratio.getInternalArray(),o=a.texture;s[0]=t,s[1]=e,n[0]=t*o.getWidth(),n[1]=e*o.getHeight()}}},cull:function(){return this._syncOnNextFrame&&(this._resizeFeedbackTextureUniforms(),this._syncOnNextFrame=!1),this._syncFeedbackUniforms&&this._feedbackSwapped&&(this._syncFeedbackUniforms=!1,this._syncOnNextFrame=!0,this._lastXratio=this.getGlobalXRatio(),this._lastYratio=this.getGlobalYRatio()),this._feedbackSwapped=!1,!0},_mergeWithoutDuplicates:function(t,e,r){for(var i=0;i<e.length;i++){for(var a=e[i],n=!0,s=0;s<t.length;s++)if(r(t[s],a)){n=!1;break}n&&t.push(a)}return t},_getTextureSize:function(t,e){return Math.max(1,Math.round(t/e))},setScreenSize:function(t,e){this._screenWidth=t,this._screenHeight=e},setShaderProcessor:function(t){this._shaderProcessor=t},addInternalTexture:function(t){this._internalPasses.push({out:{name:t.name,divisor:t.divisor,type:t.type,filter:t.filter,srgb:t.srgb,rgbm:t.rgbm,immuable:t.immuable,reusable:t.reusable}})},addExternalTexture:function(t,e){this._externalTextures[t]=e},setInputTexture:function(t){this._firstTexture=t},getCameras:function(){return this._cameras},getStateSetPass:function(t){return this._stateSets[t]},getInternalTexture:function(t){return this._userTextures[t]}}),"osgUtil","ComposerPostProcess"),e.a=v},function(t,e,r){"use strict";var i=r(0),a=r(93),n=r(79),s=a.a.sprintf,o=function(t,e){n.a.call(this),this._name="Variable",this._prefix=e,this._type=t,this._value=void 0};i.a.createPrototypeObject(o,i.a.objectInherit(n.a.prototype,{getType:function(){return this._type},getVariable:function(){return this._prefix},setValue:function(t){return this._value=t,this},toString:function(){var t=this._name+" "+this._prefix;return this._type&&(t+=" ("+this._type+")"),t+=" - id:"+this._id},declare:function(){return void 0!==this._value?s("%s %s = %s;",[this._type,this.getVariable(),this._value]):s("%s %s;",[this._type,this.getVariable()])},isEmpty:function(){return void 0===this._value&&0===this._inputs.length},reset:function(){this._inputs=[],this._outputs=null,this._value=void 0,this._text=void 0}}),"osgShader","Variable");var h=function(t,e){o.call(this,t,e)};i.a.createPrototypeObject(h,i.a.objectInherit(o.prototype,{declare:function(){return s("const %s %s = %s;",[this._type,this.getVariable(),this._value])}}),"osgShader","Constant");var u=function(t,e,r){o.call(this,t,e),this._size=r};i.a.createPrototypeObject(u,i.a.objectInherit(o.prototype,{declare:function(){},globalDeclaration:function(){return this._size?s("uniform %s %s[%s];",[this._type,this.getVariable(),this._size]):s("uniform %s %s;",[this._type,this.getVariable()])}}),"osgShader","Uniform");var c=function(t,e){o.call(this,t,e)};i.a.createPrototypeObject(c,i.a.objectInherit(o.prototype,{declare:function(){},globalDeclaration:function(){return s("attribute %s %s;",[this._type,this.getVariable()])}}),"osgShader","Attribute");var l=function(t,e){o.call(this,t,e)};i.a.createPrototypeObject(l,i.a.objectInherit(o.prototype,{declare:function(){},globalDeclaration:function(){return s("varying %s %s;",[this._type,this.getVariable()])}}),"osgShader","Varying");var d=function(t,e){o.call(this,t,e)};i.a.createPrototypeObject(d,i.a.objectInherit(o.prototype,{declare:function(){},globalDeclaration:function(){return s("uniform %s %s;",[this._type,this.getVariable()])}}),"osgShader","Sampler");var _=function(t,e){o.call(this,t,e)};i.a.createPrototypeObject(_,i.a.objectInherit(o.prototype,{_unique:!0,isUnique:function(){return this._unique},outputs:function(){return this},getVariable:function(){return this._prefix}}),"osgShader","Output");var f=function(){_.call(this,"vec4","gl_FragColor"),this._name="glFragColor"};i.a.createPrototypeObject(f,i.a.objectInherit(_.prototype,{}),"osgShader","glFragColor");var g=function(){_.call(this,"vec4","gl_Position"),this._name="glPosition"};i.a.createPrototypeObject(g,i.a.objectInherit(_.prototype,{}),"osgShader","glPosition");var p=function(){_.call(this,"float","gl_PointSize"),this._name="glPointSize"};i.a.createPrototypeObject(p,i.a.objectInherit(_.prototype,{}),"osgShader","glPointSize");var m=function(t){n.a.call(this),this._defineName=t,this._defineValue=""};i.a.createPrototypeObject(m,i.a.objectInherit(n.a.prototype,{type:"Define",setValue:function(t){return this._defineValue=t,this},getDefines:function(){return["#define "+this._defineName+" "+this._defineValue]}}),"osgShader","Define"),e.a={Output:_,glPointSize:p,glPosition:g,glFragColor:f,Sampler:d,Variable:o,Constant:h,Attribute:c,Varying:l,Uniform:u,Define:m}},function(t,e,r){"use strict";var i=r(2),a=r(58),n=r(156),s=r(154),o=r(158),h=function(){return this._generators={},this.addShaderGenerator("default",new a.a),this.addShaderGenerator("ShadowCast",new n.a),this.addShaderGenerator("debugNormal",new s.a.ShaderGeneratorCompilerOffsetNormal),this.addShaderGenerator("debugTangent",new s.a.ShaderGeneratorCompilerOffsetTangent),this.addShaderGenerator("debugGeometry",new o.a.ShaderGeneratorCompilerColorGeometry),this.addShaderGenerator("debugSkinning",new o.a.ShaderGeneratorCompilerColorSkinning),this};h.prototype={getShaderGenerator:function(t){if(!t)return this._generators.default;var e=this._generators[t];return e||(i.a.error("ShaderGenerator "+t+" does not exist in ShaderGeneratorProxy"),this._generators.default)},addShaderGenerator:function(t,e){this._generators[t]=e}},e.a=h},function(t,e,r){"use strict";var i=r(2),a=r(0),n=r(79),s=function(){n.a.call(this)};s.prototype=n.a.prototype;var o=function(){s.call(this)};a.a.createPrototypeObject(o,a.a.objectInherit(s.prototype,{type:"Add",operator:"+",_getFirstVariableCast:function(){var t=this._inputs[0].getVariable(),e=this._inputs[0].getType(),r=this._outputs.getType();return r===e?t:"float"===e?r+"("+t+")":"vec3"===r?t+".rgb":"vec2"===r?t+".rg":"float"===r?t+".r":(i.a.error("Mismatch type : "+r+" with "+e+", "+t),t)},computeShader:function(){var t=this._outputs.getType(),e="";"vec4"===t?e=".rgba":"vec3"===t?e=".rgb":"vec2"===t&&(e=".rg");for(var r=this._getFirstVariableCast(),i=this._outputs.getVariable()+" = "+r,a=1,n=this._inputs.length;a<n;a++){var s=this._inputs[a];i+=this.operator+s.getVariable();var o=s.getType();"float"!==o&&o!==t&&(i+=e)}return i+=";"}}),"osgShader","Add");var h=function(){o.call(this)};a.a.createPrototypeObject(h,a.a.objectInherit(o.prototype,{type:"Mult",operator:"*"}),"osgShader","Mult");var u=function(){o.call(this)};a.a.createPrototypeObject(u,a.a.objectInherit(o.prototype,{type:"SetFromNode"}),"osgShader","SetFromNode");var c=function(){o.call(this),this._overwriteW=!0,this._forceComplement=!0,this._inverseOp=!1};a.a.createPrototypeObject(c,a.a.objectInherit(o.prototype,{type:"MatrixMultDirection",operator:"*",validInputs:["vec","matrix"],validOutputs:["vec"],complement:"0.",setInverse:function(t){return this._inverseOp=t,this},setForceComplement:function(t){return this._forceComplement=t,this},setOverwriteW:function(t){return this._overwriteW=t,this},computeShader:function(){var t=this._inputs.vec.getVariable(),e=this._inputs.matrix.getVariable(),r=this._outputs.vec.getVariable(),i=this._inputs.vec.getType(),a=this._outputs.vec.getType(),n=this._inputs.matrix.getType(),s=r;if("mat4"===n){s+=" = ","vec4"!==a&&(s+=a+"(");var o=t;(this._forceComplement||"vec4"!==i)&&(o="vec4("+t+".xyz, "+this.complement+")"),s+=this._inverseOp?o+this.operator+e:e+this.operator+o,"vec4"!==a&&(s+=")"),s+=";",this._overwriteW||"vec4"!==i||(s+="\n"+r+".a = "+t+".a;")}else{"vec4"===a&&(s+=".xyz"),s+=" = ";var h=t+".xyz";s+=(this._inverseOp?h+this.operator+e:e+this.operator+h)+";",this._overwriteW||"vec4"!==a||"vec4"!==i||(s+="\n"+r+".a = "+t+".a;")}return s}}),"osgShader","MatrixMultDirection");var l=function(){c.call(this),this._forceComplement=!1};a.a.createPrototypeObject(l,a.a.objectInherit(c.prototype,{type:"MatrixMultPosition",complement:"1."}),"osgShader","MatrixMultPosition");var d=function(){s.apply(this),this._mode="MIX"};a.a.createPrototypeObject(d,a.a.objectInherit(s.prototype,{type:"Blend",mode:function(t){return this._mode=t,this},computeShader:function(){return this[void 0===this._mode?"MIX":this._mode]()},ADD:function(){return this._outputs.getVariable()+" = "+this._inputs[0].getVariable()+" + ("+this._inputs[1].getVariable()+" * "+this._inputs[2].getVariable()+");"},MIX:function(){return this._outputs.getVariable()+" = mix("+this._inputs[0].getVariable()+", "+this._inputs[1].getVariable()+", "+this._inputs[2].getVariable()+");"},MULTIPLY:function(){return this._outputs.getVariable()+" = "+this._inputs[0].getVariable()+" * mix( "+this._inputs[0].getType()+"(1.0), "+this._inputs[1].getVariable()+", "+this._inputs[2].getVariable()+");"}}));var _=function(){n.a.call(this)};a.a.createPrototypeObject(_,a.a.objectInherit(n.a.prototype,{type:"InlineCode",code:function(t){return this._text=t,this},computeShader:function(){var t=a.a.objectMix({},this._inputs);t=a.a.objectMix(t,this._outputs);for(var e=new RegExp("%[A-Za-z0-9_]+","gm"),r=this._text,n=this._text.match(e),s=new Set,o=0;o<n.length;o++){var h=n[o].substr(1);if(!s.has(h)){t[h]||(i.a.error("error with inline code\n"+this._text),i.a.error("input "+h+" not provided for "+n[o]));var u=new RegExp(n[o].toString(),"gm");r=r.replace(u,t[h].getVariable()),s.add(h)}}return r}}),"osgShader","InlineCode"),e.a={BaseOperator:s,Mult:h,MatrixMultPosition:l,MatrixMultDirection:c,Add:o,Blend:d,InlineCode:_,SetFromNode:u}},function(t,e,r){"use strict";var i=r(2),a={_createVertexShader:function(){var t=this.declareVertexMain(),e=this.getVertexShaderName();e&&t.push(this.getNode("Define","SHADER_NAME").setValue(e));var r=this.createShaderFromGraphs(t);return i.a.debug(this.getDebugIdentifier()),i.a.debug(r),r},declareVertexMain:function(){var t=[this.declarePointSize(),this.declareVertexPosition()];return this.declareVertexVaryings(t),t},declarePointSize:function(){var t=this.getNode("glPointSize");return this._pointSizeAttribute&&this._pointSizeAttribute.isEnabled()?(this.getNode("InlineCode").code("%pointSize = min(64.0, max(1.0, -%size / %position.z));").inputs({position:this.getOrCreateViewVertex(),size:this.getOrCreateUniform("float","uPointSize")}).outputs({pointSize:t}),t):(this.getNode("SetFromNode").inputs(this.getOrCreateConstantOne("float")).outputs(t),t)},declareVertexVaryings:function(t){var e=this._varyings;e.vModelVertex&&this.getNode("SetFromNode").inputs(this.getOrCreateModelVertex()).outputs(e.vModelVertex),e.vModelNormal&&this.getNode("SetFromNode").inputs(this.getOrCreateModelNormal()).outputs(e.vModelNormal),e.vModelTangent&&this.getNode("SetFromNode").inputs(this.getOrCreateModelTangent()).outputs(e.vModelTangent),e.vViewVertex&&this.getNode("SetFromNode").inputs(this.getOrCreateViewVertex()).outputs(e.vViewVertex),e.vViewNormal&&this.getNode("SetFromNode").inputs(this.getOrCreateViewNormal()).outputs(e.vViewNormal),e.vViewTangent&&this.getNode("SetFromNode").inputs(this.getOrCreateViewTangent()).outputs(e.vViewTangent),e.vVertexColor&&this.getNode("InlineCode").code("%vcolor = %venabled == 1.0 ? %acolor : vec4(1.0, 1.0, 1.0, 1.0);").inputs({venabled:this.getOrCreateUniform("float","uArrayColorEnabled"),acolor:this.getOrCreateAttribute("vec4","Color")}).outputs({vcolor:this.getOrCreateVarying("vec4","vVertexColor")});for(var r in e){var i=e[r];t.push(i);var a=i.getVariable();-1!==a.indexOf("vTexCoord")&&this.getNode("SetFromNode").inputs(this.getOrCreateAttribute("vec2",a.substring(1))).outputs(i)}},declareVertexPosition:function(){var t=this.getNode("glPosition");return this._isBillboard?this.declareVertexTransformBillboard(t):this.declareScreenVertex(t),t},declareScreenVertex:function(t){this.getNode("MatrixMultPosition").inputs({matrix:this.getOrCreateProjectionMatrix(),vec:this.getOrCreateViewVertex()}).outputs({vec:t})},declareVertexTransformBillboard:function(t){this.getNode("Billboard").inputs({Vertex:this.getOrCreateAttribute("vec3","Vertex"),ModelViewMatrix:this.getOrCreateUniform("mat4","uModelViewMatrix"),ProjectionMatrix:this.getOrCreateUniform("mat4","uProjectionMatrix")}).outputs({result:t})},getOrCreateBoneMatrix:function(){var t=this._variables.boneMatrix;if(t)return t;t=this.createVariable("mat4","boneMatrix");var e=this.getOrCreateAttribute("vec4","Weights"),r=this.getOrCreateAttribute("vec4","Bones"),i=this.getOrCreateUniform("vec4","uBones",this._skinningAttribute.getBoneUniformSize());return this.getNode("Skinning").inputs({weights:e,bonesIndex:r,matrixPalette:i}).outputs({result:t}),t},getTarget:function(t,e){var r=-1!==t.indexOf("Tangent")?"vec4":"vec3";return this.getOrCreateAttribute(r,t+"_"+e)},morphTangentApproximation:function(t,e){var r=this.getOrCreateLocalNormal();return this._skinningAttribute&&(r=this.createVariable("vec3"),this.getNode("Normalize").inputs({vec:this.getOrCreateMorphNormal()}).outputs({result:r})),this.getNode("InlineCode").code("%out = %tangent.rgb - dot(%tangent.rgb, %normal) * %normal;").inputs({tangent:t,normal:r}).outputs({out:e}),e},getTargetWeights:function(t){var e=this.getOrCreateUniform("vec4","uTargetWeights");if(-1===t.indexOf("Normal")&&-1===t.indexOf("Tangent"))return e;var r=this.getVariable("nTargetWeights");if(r)return r;r=this.createVariable("vec4","nTargetWeights");var i="%output = abs(%wts)\n;";return i+="%output = %wts / max(1.0, %output.x + %output.y + %output.z + %output.w);",this.getNode("InlineCode").code(i).inputs({wts:e}).outputs({output:r}),r},morphTransformVec3:function(t,e){for(var r={vertex:t,weights:this.getTargetWeights(t.getVariable())},i=this._morphAttribute.getNumTargets(),a=0;a<i;a++)r["target"+a]=this.getTarget(t.getVariable(),a);return this.getNode("Morphing").inputs(r).outputs({result:e}),e},skinTransformVertex:function(t,e){return this.getNode("MatrixMultPosition").setInverse(!0).inputs({matrix:this.getOrCreateBoneMatrix(),vec:t}).outputs({vec:e}),e},skinTransformNormal:function(t,e){return this.getNode("MatrixMultDirection").setInverse(!0).inputs({matrix:this.getOrCreateBoneMatrix(),vec:t}).outputs({vec:e}),e},getOrCreateMorphVertex:function(){var t=this.getVariable("morphVertex");if(t)return t;var e=this.getOrCreateAttribute("vec3","Vertex");return this._morphAttribute&&this._morphAttribute.hasTarget("Vertex")?this.morphTransformVec3(e,this.createVariable("vec3","morphVertex")):e},getOrCreateMorphNormal:function(){var t=this.getVariable("morphNormal");if(t)return t;var e=this.getOrCreateAttribute("vec3","Normal");return this._morphAttribute&&this._morphAttribute.hasTarget("Normal")?this.morphTransformVec3(e,this.createVariable("vec3","morphNormal")):e},getOrCreateMorphTangent:function(){var t=this.getVariable("morphTangent");if(t)return t;var e=this.getOrCreateAttribute("vec4","Tangent");return this._morphAttribute&&this._morphAttribute.hasTarget("Tangent")?this.morphTransformVec3(e,this.createVariable("vec3","morphTangent")):e},getOrCreateSkinVertex:function(){var t=this.getVariable("skinVertex");if(t)return t;var e=this.getOrCreateMorphVertex();return this._skinningAttribute?this.skinTransformVertex(e,this.createVariable("vec3","skinVertex")):e},getOrCreateSkinNormal:function(){var t=this.getVariable("skinNormal");if(t)return t;var e=this.getOrCreateMorphNormal();return this._skinningAttribute?this.skinTransformNormal(e,this.createVariable("vec3","skinNormal")):e},getOrCreateSkinTangent:function(){var t=this.getVariable("skinTangent");if(t)return t;var e=this.getOrCreateMorphTangent();return this._skinningAttribute?this.skinTransformNormal(e,this.createVariable("vec3","skinTangent")):e},getOrCreateLocalVertex:function(){return this.getOrCreateSkinVertex()},getOrCreateLocalNormal:function(){var t=this.getVariable("localNormal");if(t)return t;var e=this.getOrCreateSkinNormal();return e===this.getOrCreateAttribute("vec3","Normal")?e:(t=this.createVariable("vec3","localNormal"),this.getNode("Normalize").inputs({vec:e}).outputs({result:t}),t)},getOrCreateLocalTangent:function(){var t=this.getVariable("localTangent");if(t)return t;var e=this.getOrCreateAttribute("vec4","Tangent"),r=this.getOrCreateSkinTangent();return r===e?r:this.normalizeAndSetAlpha(r,e,this.createVariable("vec4","localTangent"))},normalizeAndSetAlpha:function(t,e,r){var i=this.createVariable("vec3");return this.getNode("Normalize").inputs({vec:t}).outputs({result:i}),this.getNode("SetAlpha").inputs({color:i,alpha:e}).outputs({result:r}),r}};for(var n in a)a[n]=function(t,e){return function(){return this._fragmentShaderMode&&this.logError("This function should not be called from fragment shader : "+e),t.apply(this,arguments)}}(a[n],n);e.a=a},function(t,e,r){"use strict";var i=r(54),a=r(2),n={_createFragmentShader:function(){var t=this.createFragmentShaderGraph(),e=this.getFragmentShaderName();e&&t.push(this.getNode("Define","SHADER_NAME").setValue(e));var r=this.createShaderFromGraphs(t);return a.a.debug(this.getDebugIdentifier()),a.a.debug(r),this.cleanAfterFragment(),r},applyPointSizeCircle:function(t){return this._pointSizeAttribute&&this._pointSizeAttribute.isEnabled()&&this._pointSizeAttribute.isCircleShape()?(this.getNode("InlineCode").code("if (length(2.0 * gl_PointCoord - 1.0) > %radius) discard;").inputs({radius:this.getOrCreateConstantOne("float")}).outputs({output:t}),t):t},cleanAfterFragment:function(){this._variables={},this._activeNodeMap={};for(var t in this._texturesByName)this._texturesByName[t].variable=void 0;for(var e in this._varyings){var r=this._varyings[e];r.reset(),this._activeNodeMap[r.getID()]=r,this._variables[e]=r}},createDefaultFragmentShaderGraph:function(){var t=this.getOrCreateConstant("vec4","fofd").setValue("vec4(1.0, 0.0, 1.0, 0.7)"),e=this.getNode("glFragColor");return this.getNode("SetFromNode").inputs(t).outputs(e),e},createFragmentShaderGraph:function(){var t=[];if(!this._material)return t.push(this.createDefaultFragmentShaderGraph()),t;var e=this._lights.length>0?this.getLighting():this.getOrCreateMaterialDiffuseColor(),r=this.getOrCreateMaterialEmission();if(r){var i=this.createVariable("vec3");this.getNode("Add").inputs(e,r).outputs(i),e=i}var a=this.getDiffuseColorFromTextures();if(a){var n=this.createVariable("vec3");this.getNode("Mult").inputs(e,a).outputs(n),e=n}var s=this.getAlpha();e=this.getPremultAlpha(e,s);var o=this.getNode("glFragColor");return this.applyPointSizeCircle(o),this.getNode("SetAlpha").inputs({color:e,alpha:s}).outputs({result:o}),t.push(o),t},getAlpha:function(){var t=this.createVariable("float"),e=this.getFirstValidTexture(),r={color:this.getOrCreateMaterialDiffuseColor()};e&&(r.texelAlpha=e);var i=e?"%alpha = %color.a * %texelAlpha.a;":"%alpha = %color.a;";return this._isBillboard&&(i+="if ( %alpha == 0.0) discard;"),this.getNode("InlineCode").code(i).inputs(r).outputs({alpha:t}),t},getOrCreateFrontViewTangent:function(){var t=this._variables.frontViewTangent;return t||(t=this.createVariable("vec4","frontViewTangent"),this.getNode("FrontNormal").inputs({normal:this.getOrCreateViewTangent()}).outputs({result:t}),t)},getOrCreateFrontViewNormal:function(){var t=this._variables.frontViewNormal;return t||(t=this.createVariable("vec3","frontViewNormal"),this.getNode("FrontNormal").inputs({normal:this.getOrCreateViewNormal()}).outputs({result:t}),t)},getOrCreateNormalizedViewEyeDirection:function(){var t=this._variables.eyeVector;return t||(t=this.createVariable("vec3","eyeVector"),this.getNode("SetFromNode").inputs(this.getOrCreateViewVertex()).outputs(t),this.getNode("Normalize").inputs({vec:t}).outputs({result:t}),this.getNode("Mult").inputs(t,this.createVariable("float").setValue("-1.0")).outputs(t),t)},getOrCreateNormalizedFrontViewNormal:function(){var t=this._variables.nFrontViewNormal;return t||(t=this.createVariable("vec3","nFrontViewNormal"),this.getNode("Normalize").inputs({vec:this.getOrCreateFrontViewNormal()}).outputs({result:t}),t)},getOrCreateFrontModelNormal:function(){var t=this._variables.frontModelNormal;return t||(t=this.createVariable("vec3","frontModelNormal"),this.getNode("FrontNormal").inputs({normal:this.getOrCreateModelNormal()}).outputs({result:t}),t)},getOrCreateNormalizedFrontModelNormal:function(){var t=this._variables.nFrontModelNormal;return t||(t=this.createVariable("vec3","nFrontModelNormal"),this.getNode("Normalize").inputs({vec:this.getOrCreateFrontModelNormal()}).outputs({result:t}),t)},getPremultAlpha:function(t,e){if(void 0===e)return t;var r=this.createVariable("vec4");return this.getNode("PreMultAlpha").inputs({color:t,alpha:e}).outputs({result:r}),r},getColorsRGB:function(t){var e=this.createVariable("vec3");return this.getNode("LinearTosRGB").inputs({color:t}).outputs({color:e}),e},multiplyDiffuseWithVertexColor:function(t){var e=this.getOrCreateVarying("vec4","vVertexColor"),r=this.getOrCreateUniform("float","uArrayColorEnabled"),i=this.createVariable("vec4"),a=["","%color = %diffuse;","if ( %hasVertexColor == 1.0)","  %color *= %vertexColor;"].join("\n");return this.getNode("InlineCode").code(a).inputs({diffuse:t,hasVertexColor:r,vertexColor:e}).outputs({color:i}).comment("diffuse color = diffuse color * vertex color"),i},getDiffuseColorFromTextures:function(){var t=[],e=this._texturesByName;for(var r in e){e[r].shadow||t.push(this.getTextureByName(r).variable)}if(t.length>1){var i=this.createVariable("vec3","texDiffuseAccum");return this.getNode("Mult").inputs(t).outputs(i),i}if(1===t.length)return t[0]},getFirstValidTexture:function(){for(var t=this._textures,e=0,r=t.length;e<r;++e){var i=t[e];if(i)return this.getTextureByName(i.getName()).variable}},_getShadowReceiveAttributeFromLightNum:function(t,e){for(var r=0;r<t.length;r++){var i=t[r];if(i&&i.getLightNumber()===e)return i}},_getShadowTextureFromLightNum:function(t,e){for(var r=0;r<t.length;r++){var i=t[r];if(i&&i.hasLightNumber(e))return i}},getInputsFromShadow:function(t,e,r,i){var a=t.getOrCreateUniforms(),n=this._shadowsTextures.indexOf(e),s=e.getOrCreateUniforms(n),o=t.getAtlas()?"_"+i:"",h={lighted:r,normalWorld:this.getOrCreateNormalizedFrontModelNormal(),vertexWorld:this.getOrCreateModelVertex(),shadowTexture:this.getOrCreateSampler("sampler2D","Texture"+n),shadowSize:this.getOrCreateUniform(s.RenderSize),shadowProjection:this.getOrCreateUniform(s["Projection"+o]),shadowViewRight:this.getOrCreateUniform(s["ViewRight"+o]),shadowViewUp:this.getOrCreateUniform(s["ViewUp"+o]),shadowViewLook:this.getOrCreateUniform(s["ViewLook"+o]),shadowDepthRange:this.getOrCreateUniform(s["DepthRange"+o]),shadowBias:this.getOrCreateUniform(a.bias)};return t.getAtlas()&&(h.atlasSize=this.getOrCreateUniform(s["MapSize"+o])),t.getNormalBias()&&(h.normalBias=this.getOrCreateUniform(a.normalBias)),h},getOrCreateDistanceShadow:function(t){if(this._computeShadowOutDistance){var e="shadowDistance"+t,r=this.getVariable(e);return r||(r=this.createVariable("float",e).setValue("0.0")),r}},getOrCreateJitterShadow:function(){return!1},hasLightShadow:function(t){var e=this._getShadowTextureFromLightNum(this._shadowsTextures,t),r=this._getShadowReceiveAttributeFromLightNum(this._shadows,t);return!!e&&!!r},createShadowingLight:function(t,e){var r=t.getLightNumber(),i=this._getShadowTextureFromLightNum(this._shadowsTextures,r),a=this._getShadowReceiveAttributeFromLightNum(this._shadows,r);if(i&&a){var n=this.getInputsFromShadow(a,i,e,r),s=this.createVariable("float"),o={result:s},h=a.getDefines(),u=this.getOrCreateDistanceShadow(r);u&&(o.outDistance=u,h.push("#define _OUT_DISTANCE"));var c=this.getOrCreateJitterShadow(r);return c&&(n.jitter=c),this.getNode("ShadowReceive").inputs(n).outputs(o).addDefines(h),s}},getOrCreateMaterialNormal:function(){return this.getOrCreateNormalizedFrontViewNormal()},getOrCreateMaterialDiffuseColor:function(){var t=this.getVariable("materialDiffuseColor");if(t)return t;t=this.createVariable("vec4","materialDiffuseColor");var e=this.getOrCreateUniform(this._material.getOrCreateUniforms().diffuse);return this.getNode("Mult").inputs(this.multiplyDiffuseWithVertexColor(e)).outputs(t),t},getOrCreateMaterialEmission:function(){return this.getOrCreateUniform(this._material.getOrCreateUniforms().emission)},getOrCreateMaterialSpecularColor:function(){return this.getOrCreateUniform(this._material.getOrCreateUniforms().specular)},getOrCreateMaterialSpecularHardness:function(){return this.getOrCreateUniform(this._material.getOrCreateUniforms().shininess)},getOrCreateMaterialAmbient:function(){return this.getOrCreateUniform(this._material.getOrCreateUniforms().ambient)},getLighting:function(){if(0!==this._lights.length){var t=this.getLightingSeparate(),e=this.createVariable("vec3");return this.getNode("Add").inputs(t.diffuse,t.specular).outputs(e),e}},getLightingSeparate:function(){if(0!==this._lights.length){for(var t=[],e=[],r=0;r<this._lights.length;r++){var i=this._lights[r],a=this.getLightSeparate(i);t.push(a.diffuseOut),e.push(a.specularOut)}var n,s;return 1===this._lights.length?(n=t[0],s=e[0]):(n=this.createVariable("vec3"),this.getNode("Add").inputs(t).outputs(n),s=this.createVariable("vec3"),this.getNode("Add").inputs(e).outputs(s)),{diffuse:n,specular:s}}},getLightSeparate:function(t){var e=this.getPrecomputeLight(t),r=this.getLightWithPrecompute(t,e),i=this.createShadowingLight(t,r.lighted);i&&(this.getNode("Mult").inputs(r.diffuseOut,i).outputs(r.diffuseOut),this.getNode("Mult").inputs(r.specularOut,i).outputs(r.specularOut));var a=this.getAmbientLight(t);return a&&this.getNode("Add").inputs(r.diffuseOut,a).outputs(r.diffuseOut),{diffuseOut:r.diffuseOut,specularOut:r.specularOut,lighted:r.lighted,attenuation:e.attenuation,eyeLightDir:e.eyeLightDir,dotNL:e.dotNL}},getPrecomputeLight:function(t){var e,r=t.getOrCreateUniforms(),a={attenuation:this.createVariable("float"),eyeLightDir:this.createVariable("vec3"),dotNL:this.createVariable("float")},n={normal:this.getOrCreateMaterialNormal()},s=t.getLightType();return s===i.a.POINT?(e="PrecomputePoint",n.viewVertex=this.getOrCreateViewVertex(),n.lightAttenuation=this.getOrCreateUniform(r.attenuation),n.lightViewPosition=this.getOrCreateUniform(r.viewPosition)):s===i.a.SPOT?(e="PrecomputeSpot",n.viewVertex=this.getOrCreateViewVertex(),n.lightViewDirection=this.getOrCreateUniform(r.viewDirection),n.lightAttenuation=this.getOrCreateUniform(r.attenuation),n.lightSpotCutOff=this.getOrCreateUniform(r.spotCutOff),n.lightSpotBlend=this.getOrCreateUniform(r.spotBlend),n.lightViewPosition=this.getOrCreateUniform(r.viewPosition)):(e="PrecomputeSun",n.lightViewDirection=this.getOrCreateUniform(r.viewDirection)),this.getNode(e).inputs(n).outputs(a),a},getLightWithPrecompute:function(t,e){var r=t.getOrCreateUniforms(),a={normal:this.getOrCreateMaterialNormal(),eyeVector:this.getOrCreateNormalizedViewEyeDirection(),dotNL:e.dotNL,attenuation:e.attenuation,materialDiffuse:this.getOrCreateMaterialDiffuseColor(),materialSpecular:this.getOrCreateMaterialSpecularColor(),materialShininess:this.getOrCreateMaterialSpecularHardness(),lightDiffuse:this.getOrCreateUniform(r.diffuse),lightSpecular:this.getOrCreateUniform(r.specular),eyeLightDir:e.eyeLightDir},n="ComputeLightLambertCookTorrance";t.getLightType()===i.a.HEMI&&(a.lightGround=this.getOrCreateUniform(r.ground),n="HemiLight");var s=this.getOutputsFromLight();return this.getNode(n).inputs(a).outputs(s),s},getAmbientLight:function(t){var e=this.createVariable("vec3"),r=this.getOrCreateUniform(t.getOrCreateUniforms().ambient),i=this.getOrCreateMaterialAmbient();return this.getNode("Mult").inputs(i,r).outputs(e),e},getOutputsFromLight:function(){var t={diffuseOut:this.createVariable("vec3"),specularOut:this.createVariable("vec3"),lighted:this.createVariable("bool")};return t.lighted.silenceWarning=!0,t},createTextureRGBA:function(t,e,r){var i=this.createVariable("vec4");return this.getNode("TextureRGBA").inputs({tex:e,uv:r}).outputs({result:i}),i}};for(var s in n)n[s]=function(t,e){return function(){return this._fragmentShaderMode||this.logError("This function should not be called from vertex shader : "+e),t.apply(this,arguments)}}(n[s],s);e.a=n},function(t,e,r){"use strict";var i=r(159),a=r(51),n=function(t){this._selectables=t,this._nodeList=[],this._linkList=[],this._renderBinMap=new window.Map,this._renderBinStack=[],this._generatorID=0,this._refID=0,this._uniqueEdges=new window.Set};n.prototype={getColorFromClassName:i.a.prototype.getColorFromClassName,createGraph:function(t){this.reset(),this.apply(t)},reset:function(){this._renderBinMap.clear(),this._renderBinStack.length=0,this._generatorID=0,this._refID++,this._nodeList.length=0,this._linkList.length=0,this._uniqueEdges.clear()},apply:function(t){var e=t.getInstanceID();if(this._renderBinMap.has(e)||this._renderBinMap.set(e,t),this._renderBinStack.push(t),t.getPreRenderStageList)for(var r=t.getPreRenderStageList(),i=0,a=r.length;i<a;++i)this.apply(r[i].renderStage);if(this.registerNode(t),t.getPostRenderStageList)for(var n=t.getPostRenderStageList(),s=0,o=n.length;s<o;++s)this.apply(n[s].renderStage);this._renderBinStack.pop()},registerNode:function(t){var e=t.getInstanceID();if(this._nodeList.push(t),t._bins.forEach(function(t,e){this.apply(e)}.bind(this)),t._leafs.length)for(var r=0,i=t._leafs.length;r<i;r++)this.createNodeAndSetID(e,t._leafs[r]);var a=this,n={},s=function(t){a.createNodeAndSetID(this.stateGraphID,t)}.bind(n),o=function(t){a.createNodeAndSetID(e,t);var r=t._instanceID,i=t.getLeafs();n.stateGraphID=r,i.forEach(s)};if(t.getStateGraphList().forEach(o),!(this._renderBinStack.length<2)){var h=this._renderBinStack[this._renderBinStack.length-2].getInstanceID();this.createLink(h,e)}},createLink:function(t,e){var r=t+"+"+e;this._uniqueEdges.has(r)||(this._linkList.push({parentNode:t,childrenNode:e}),this._uniqueEdges.add(r))},createNodeAndSetID:function(t,e){this._nodeList.push(e),(void 0===e._instanceID||e._instanceID<0&&e._refID!==this._refID)&&(e._instanceID=-1-this._generatorID++,e._refID=this._refID),this.createLink(t,e._instanceID)},generateRenderLeaf:function(t,e){var r=e._instanceID,i=e._geometry&&e._geometry.getName()?"\n"+e._geometry.getName():"Geometry",a="RenderLeaf ( "+e._instanceID+" )";a+="\n"+i+" ( "+e._geometry.getInstanceID()+" )",this._selectables.set(r.toString(),e),t.addNode(r,{label:a,description:"",style:"fill: "+this.getColorFromClassName("RenderLeaf")+";stroke-width: 0px;"})},generateStateGraph:function(t,e){var r=e._instanceID,i="StateGraph ( "+e._instanceID+" )";i+="\n"+e._leafs._length+" leafs",this._selectables.set(r.toString(),e),t.addNode(r,{label:i,description:"",style:"fill: "+this.getColorFromClassName("StateGraph")+";stroke-width: 0px;"})},generateRenderStage:function(t,e){var r=e.className()+" ( "+e._instanceID+" )";e.getName()&&(r+="\n"+e.getName()),r+="\nViewport ( "+e.getViewport().width()+" x "+e.getViewport().height()+" )",this._selectables.set(e.getInstanceID().toString(),e),t.addNode(e.getInstanceID(),{label:r,description:"",style:"fill: "+this.getColorFromClassName(e.className())+";stroke-width: 0px;"})},generateRenderBin:function(t,e){var r=e.className()+" ( "+e.getInstanceID()+" )";e.getName()&&(r+="\n"+e.getName());var i="";e.getSortMode()===a.a.SORT_BACK_TO_FRONT&&(i="SortMode: BackToFront");var n="BinNumber: "+e.getBinNumber()+"\n"+i;this._selectables.set(e.getInstanceID().toString(),e),t.addNode(e.getInstanceID(),{label:r,description:n,style:"fill: "+this.getColorFromClassName(e.className())+";stroke-width: 0px;"})},generateNodeAndLink:function(t){for(var e=0,r=this._nodeList.length;e<r;e++){var i=this._nodeList[e];i._geometry&&void 0!==i._depth?this.generateRenderLeaf(t,i):"StateGraph"===i.className()?this.generateStateGraph(t,i):"RenderStage"===i.className()?this.generateRenderStage(t,i):this.generateRenderBin(t,i)}for(var a=0,n=this._linkList.length;a<n;a++)t.addEdge(null,this._linkList[a].parentNode,this._linkList[a].childrenNode)}},e.a=n},function(t,e){if(void 0===i){var r=new Error('Cannot find module "undefined"');throw r.code="MODULE_NOT_FOUND",r}t.exports=i},function(t,e,r){"use strict";var i=r(8),a=r(3),n=r(16),s=r(31),o=r(29),h=r(42),u=r(6),c=r(1),l=r(56),d=r(57),_=r(161),f=r(12),g=r(0),p=r(10),m=function(){};m.prototype={cull:function(){return!1}};var v=new o.a(o.a.SRC_ALPHA,o.a.ONE_MINUS_SRC_ALPHA),S=function(t){this._testPlane=t,this._inter=c.f.create(),d.a.call(this)};g.a.createPrototypeObject(S,g.a.objectInherit(d.a.prototype,{setTestPlane:function(t){this._testPlane=t},getTranslateDistance:function(){return this._inter},enter:function(){var t=c.f.create(),e=c.f.create();return function(r){if(void 0===r._nbAxis)return!0;if(c.f.init(t),t[r._nbAxis]=1,this._testPlane){var i=c.f.dot(this._iStart,t),a=c.f.dot(this._iEnd,t);if(i===a)return!1;var n=-i/(a-i);this._inter[0]=this._iStart[0]+(this._iEnd[0]-this._iStart[0])*n,this._inter[1]=this._iStart[1]+(this._iEnd[1]-this._iStart[1])*n,this._inter[2]=this._iStart[2]+(this._iEnd[2]-this._iStart[2])*n}else{c.f.normalize(e,c.f.sub(e,this._iEnd,this._iStart));var s=-c.f.dot(e,t),o=c.f.dot(this._iStart,e),h=Math.abs(1-s*s),u=-c.f.dot(this._iStart,t);c.f.init(this._inter),this._inter[r._nbAxis]=(s*o-u)/h}return!1}}(),intersectTriangle:function(){},intersectLine:function(){},intersectPoint:function(){}}),"osgUtil","LineCustomIntersector");var b=c.c.create(),x=function(t){n.a.call(this),this._tmask=1,this._autoInsertMT=!1,this._correctPivotOnAutoInsert=!1,this._viewer=t,this._canvas=t.getGraphicContext().canvas,this._rotateNode=new n.a,this._translateNode=new n.a,this._planeNode=new n.a,this._rotateInLocal=!0,this._translateInLocal=!0,this._showAngle=new n.a,this._downCanvasCoord=c.e.create(),this._hoverNode=null,this._keepHoverColor=c.g.create(),this._isEditing=!1,this._editLineOrigin=c.f.create(),this._editLineDirection=c.f.create(),this._editOffset=c.f.create(),this._editLocal=c.c.create(),this._editWorldTrans=c.c.create(),this._editWorldScaleRot=c.c.create(),this._editInvWorldScaleRot=c.c.create(),this._debugNode=new i.a,this._lastDistToEye=0,this._attachedNode=null,this._pivotOffset=c.f.create(),this.attachToNode(null),this._lsi=new S,this._origIntersect=c.f.create(),this._dstIntersect=c.f.create(),this._iv=new l.a,this._iv.setIntersector(this._lsi),this.init()};x.NO_PICK=1,x.PICK_ARC_X=2,x.PICK_ARC_Y=4,x.PICK_ARC_Z=8,x.PICK_ARROW_X=16,x.PICK_ARROW_Y=32,x.PICK_ARROW_Z=64,x.PICK_PLANE_X=128,x.PICK_PLANE_Y=256,x.PICK_PLANE_Z=512,x.NO_FULL_CIRCLE=1024,x.CORRECT_PIVOT=2048,x.PICK_ARC=x.PICK_ARC_X|x.PICK_ARC_Y|x.PICK_ARC_Z,x.PICK_ARROW=x.PICK_ARROW_X|x.PICK_ARROW_Y|x.PICK_ARROW_Z,x.PICK_PLANE=x.PICK_PLANE_X|x.PICK_PLANE_Y|x.PICK_PLANE_Z,x.PICK_GIZMO=x.PICK_ARC|x.PICK_ARROW|x.PICK_PLANE;var y=function(){a.a.call(this,a.a.TRAVERSE_PARENTS),this._editableNode=null};g.a.createPrototypeObject(y,g.a.objectInherit(a.a.prototype,{reset:function(){a.a.prototype.reset.call(this),this._editableNode=null},getEditableNode:function(){return this._editableNode},apply:function(t){if(!this._editableNode){var e=t.editMask;if(e&&e&x.PICK_GIZMO)return void(this._editableNode=t);this.traverse(t)}}})),g.a.createPrototypeNode(x,g.a.objectInherit(n.a.prototype,{setRotateInLocal:function(t){this._rotateInLocal=t},setTranslateInLocal:function(t){this._translateInLocal=t},setTraversalMask:function(t){this._tmask=t},setAutoMatrixTransformInsertion:function(t){this._autoInsertMT=t},setCorrectPivotOnAutoInsert:function(t){this._correctPivotOnAutoInsert=t},isEditing:function(){return this._isEditing},getAttachedNode:function(){return this._attachedNode},init:function(){this.getOrCreateStateSet().setAttributeAndModes(new s.a(s.a.DISABLE)),this.getOrCreateStateSet().setAttributeAndModes(new h.a(h.a.DISABLE)),this.addUpdateCallback(this),this.addChild(this.initNodeTranslate()),this.addChild(this.initNodeTranslatePlane()),this.addChild(this.initNodeRotate()),this._debugNode&&(this._debugNode.addChild(_.a.createDebugLineGeometry()),this.addChild(this._debugNode),this._debugNode.setNodeMask(0));var t=this._viewer.getInputManager();t.group(p.a.NODE_GIZMO).addMappings({onMouseMove:"mousemove",onMouseDown:"mousedown",onMouseUp:["mouseup","mouseout"]},this),t.setPriority(p.a.NODE_GIZMO,t.getHigherPriority(p.a.MANIPULATORS))},_insertEditNode:function(t,e){var r=new n.a;return r.editMask=x.PICK_GIZMO,this._correctPivotOnAutoInsert&&(r.editMask|=x.CORRECT_PIVOT),t.addChild(r),t.removeChild(e),r.addChild(e),r._isInserted=!0,r},_findEditNodeFromNodePath:function(t){if(!t)return null;var e=t[t.length-1];if(e.editMask)return e;if(!this._autoInsertMT){for(var r=t.length-1;r>=0;--r){var i=t[r].editMask;if(i&&i&x.PICK_GIZMO)return t[r]}return null}var a=t[t.length-2];return a.editMask?a:this._insertEditNode(a,e)},_findEditNodeFromNode:function(t){if(!t)return null;if(t.editMask)return t;if(this._autoInsertMT){for(var e=t.getParents(),r=0;r<e.length;++r){var i=e[r].editMask;if(i&&i&x.PICK_GIZMO)return e[r]}return this._insertEditNode(e[0],t)}return this._getEditNodeVisitor?this._getEditNodeVisitor.reset():this._getEditNodeVisitor=new y,t.accept(this._getEditNodeVisitor),this._getEditNodeVisitor.getEditableNode()},attachToNodePath:function(t){var e=this._findEditNodeFromNodePath(t);this._attachEditNode(e,t&&t[t.length-1])},attachToNode:function(t){var e=this._findEditNodeFromNode(t);this._attachEditNode(e,t)},_attachEditNode:function(t,e){this._attachedNode=t,t&&e&&e!==t&&t.editMask&x.CORRECT_PIVOT&&c.f.copy(this._pivotOffset,e.getBoundingSphere().center()),this.updateGizmoMask()},updateGizmoMask:function(){if(!this._attachedNode)return c.f.init(this._pivotOffset),void this.setNodeMask(0);var t=this._attachedNode.editMask;this.setNodeMask(t&x.PICK_GIZMO?x.NO_PICK:0),this._translateNode.setNodeMask(t&x.PICK_ARROW?x.PICK_ARROW:0),this._rotateNode.setNodeMask(t&x.PICK_ARC?x.PICK_ARC:0),this._planeNode.setNodeMask(t&x.PICK_PLANE?x.PICK_PLANE:0);var e=this._translateNode.getChildren();e[0].setNodeMask(t&x.PICK_ARROW_X?x.PICK_ARROW_X:0),e[1].setNodeMask(t&x.PICK_ARROW_Y?x.PICK_ARROW_Y:0),e[2].setNodeMask(t&x.PICK_ARROW_Z?x.PICK_ARROW_Z:0);var r=this._rotateNode.getChildren();r[0].setNodeMask(t&x.NO_FULL_CIRCLE?0:x.NO_PICK),r[1].setNodeMask(t&x.PICK_ARC_X?x.PICK_ARC_X:0),r[2].setNodeMask(t&x.PICK_ARC_Y?x.PICK_ARC_Y:0),r[3].setNodeMask(t&x.PICK_ARC_Z?x.PICK_ARC_Z:0);var i=this._planeNode.getChildren();i[0].setNodeMask(t&x.PICK_PLANE_X?x.PICK_PLANE_X:0),i[1].setNodeMask(t&x.PICK_PLANE_Y?x.PICK_PLANE_Y:0),i[2].setNodeMask(t&x.PICK_PLANE_Z?x.PICK_PLANE_Z:0)},onNodeHovered:function(){var t=c.g.fromValues(1,1,0,1);return function(e){if(this._hoverNode&&this._hoverNode.getStateSet().getUniform("uColor").setFloat4(this._keepHoverColor),!e)return void(this._hoverNode=null);for(var r=e._nodePath,i=r.length-1,a=r[i];void 0===a._nbAxis;){if(0===i)return;a=r[--i]}var n=a.getStateSet().getUniform("uColor");this._hoverNode=a,c.g.copy(this._keepHoverColor,n.getInternalArray()),n.setFloat4(t)}}(),initNodeRotate:function(){var t=_.a.createTorusGeometry(1,.01,6,64,2*Math.PI),e=_.a.createTorusGeometry(1,.01,6,64,Math.PI),r=_.a.createTorusGeometry(1,.1,6,64,Math.PI),a=new n.a,s=new n.a,o=new n.a,h=new n.a;s._nbAxis=0,o._nbAxis=1,h._nbAxis=2;var l=new i.a;l.setCullCallback(new m),l.addChild(r),t.setNodeMask(x.NO_PICK),e.setNodeMask(x.NO_PICK),s.setNodeMask(x.PICK_ARC_X),o.setNodeMask(x.PICK_ARC_Y),h.setNodeMask(x.PICK_ARC_Z),a.addChild(t),s.addChild(e),o.addChild(e),h.addChild(e),s.addChild(l),o.addChild(l),h.addChild(l),a.getOrCreateStateSet().addUniform(u.a.createFloat4(c.g.fromValues(.2,.2,.2,1),"uColor")),s.getOrCreateStateSet().addUniform(u.a.createFloat4(c.g.fromValues(1,0,0,1),"uColor")),o.getOrCreateStateSet().addUniform(u.a.createFloat4(c.g.fromValues(0,1,0,1),"uColor")),h.getOrCreateStateSet().addUniform(u.a.createFloat4(c.g.fromValues(0,0,1,1),"uColor"));var d=this._showAngle;d.getOrCreateStateSet().setAttributeAndModes(v),d.setNodeMask(0),d.getOrCreateStateSet().addUniform(u.a.createFloat3(c.f.fromValues(1,0,0),"uBase")),d.getOrCreateStateSet().addUniform(u.a.createFloat(0,"uAngle")),d.addChild(_.a.createQuadCircleGeometry());var f=this._rotateNode;return f.setNodeMask(x.PICK_ARC),f.addChild(a),f.addChild(s),f.addChild(o),f.addChild(h),f.addChild(d),f},initNodeTranslate:function(){var t=new n.a;c.c.fromTranslation(t.getMatrix(),c.f.fromValues(0,0,1.65)),t.addChild(_.a.createCylinderGeometry(0,.07,.3,32,1,!0,!0));var e=new n.a;c.c.fromTranslation(e.getMatrix(),c.f.fromValues(0,0,.75)),e.addChild(_.a.createCylinderGeometry(.01,.01,1.5,32,1,!0,!0));var r=new i.a;r.addChild(e),r.addChild(t);var a=_.a.createCylinderGeometry(.1,.1,1.3*1.1,32,1,!0,!0),s=new n.a,o=new n.a,h=new n.a;s._nbAxis=0,o._nbAxis=1,h._nbAxis=2,c.c.fromRotation(s.getMatrix(),.5*Math.PI,c.f.fromValues(0,1,0)),c.c.fromRotation(o.getMatrix(),.5*-Math.PI,c.f.fromValues(1,0,0));var l=new n.a;l.setCullCallback(new m),c.c.fromTranslation(l.getMatrix(),c.f.fromValues(0,0,1.215)),l.addChild(a),r.setNodeMask(x.NO_PICK),s.setNodeMask(x.PICK_ARROW_X),o.setNodeMask(x.PICK_ARROW_Y),h.setNodeMask(x.PICK_ARROW_Z),s.addChild(r),o.addChild(r),h.addChild(r),s.addChild(l),o.addChild(l),h.addChild(l),s.getOrCreateStateSet().addUniform(u.a.createFloat4(c.g.fromValues(1,0,0,1),"uColor")),o.getOrCreateStateSet().addUniform(u.a.createFloat4(c.g.fromValues(0,1,0,1),"uColor")),h.getOrCreateStateSet().addUniform(u.a.createFloat4(c.g.fromValues(0,0,1,1),"uColor"));var d=this._translateNode;return d.setNodeMask(x.PICK_ARROW),d.addChild(s),d.addChild(o),d.addChild(h),d},initNodeTranslatePlane:function(){var t=new n.a;c.c.fromTranslation(t.getMatrix(),c.f.fromValues(.5,.5,0)),c.c.mul(t.getMatrix(),c.c.fromScaling(c.c.create(),c.f.fromValues(.5,.5,1)),t.getMatrix()),t.addChild(_.a.createPlaneGeometry());var e=new n.a,r=new n.a,i=new n.a;e._nbAxis=0,r._nbAxis=1,i._nbAxis=2,c.c.fromRotation(e.getMatrix(),.5*-Math.PI,c.f.fromValues(0,1,0)),c.c.fromRotation(r.getMatrix(),.5*Math.PI,c.f.fromValues(1,0,0)),e.setNodeMask(x.PICK_PLANE_X),r.setNodeMask(x.PICK_PLANE_Y),i.setNodeMask(x.PICK_PLANE_Z),e.addChild(t),r.addChild(t),i.addChild(t),e.getOrCreateStateSet().addUniform(u.a.createFloat4(c.g.fromValues(1,0,0,.3),"uColor")),r.getOrCreateStateSet().addUniform(u.a.createFloat4(c.g.fromValues(0,1,0,.3),"uColor")),i.getOrCreateStateSet().addUniform(u.a.createFloat4(c.g.fromValues(0,0,1,.3),"uColor"));var a=this._planeNode;return a.setNodeMask(x.PICK_PLANE),a.getOrCreateStateSet().setAttributeAndModes(v),a.addChild(e),a.addChild(r),a.addChild(i),a},updateArcRotation:function(){var t=c.d.create(),e=c.d.setAxisAngle(c.d.create(),[0,1,0],.5*-Math.PI),r=c.d.setAxisAngle(c.d.create(),[1,0,0],.5*-Math.PI);return function(i){var a=this._rotateNode,n=a.getChildren();t[0]=-i[1],t[1]=i[0],t[2]=0,t[3]=1+i[2],c.d.normalize(t,t),c.c.fromQuat(n[0].getMatrix(),t),c.d.setAxisAngle(t,[1,0,0],Math.atan2(i[2],i[1])),c.d.mul(t,t,e),c.c.fromQuat(n[1].getMatrix(),t),c.d.setAxisAngle(t,[0,1,0],Math.atan2(-i[0],-i[2])),c.d.mul(t,t,r),c.c.fromQuat(n[2].getMatrix(),t),c.d.setAxisAngle(t,[0,0,1],Math.atan2(-i[0],i[1])),c.c.fromQuat(n[3].getMatrix(),t),n[1].dirtyBound(),n[2].dirtyBound(),n[3].dirtyBound()}}(),getTransformType:function(t){for(var e=t;e.getParents().length>0;){var r=e.referenceFrame;if(void 0!==r&&r===f.a.ABSOLUTE_RF)return f.a.ABSOLUTE_RF;e=e.getParents()[0]}return f.a.RELATIVE_RF},getAttachedNodeWorldMatrix:function(){var t=this._attachedNode.getWorldMatrix(void 0,b);return c.c.translate(t,t,this._pivotOffset)},update:function(){var t=c.f.create(),e=c.f.create(),r=c.f.create(),i=c.c.create();return function(){if(this._attachedNode){var a=this.getTransformType(this._attachedNode);this.setReferenceFrame(a),this.setCullingActive(a===f.a.RELATIVE_RF);var n=this.getAttachedNodeWorldMatrix();c.c.getTranslation(e,n);var s=3;if(a===f.a.ABSOLUTE_RF)t[0]=t[1]=t[2]=0;else{var o=this._viewer.getCamera().getProjectionMatrix(),h=.023*this._canvas.clientWidth*o[0];this._viewer.getManipulator().getEyePosition(t),this._lastDistToEye=this._isEditing?this._lastDistToEye:c.f.distance(e,t),s*=this._lastDistToEye/h}var u=this.getMatrix();if(c.c.fromTranslation(u,e),c.f.set(r,s,s,s),c.c.mul(u,u,c.c.fromScaling(i,r)),c.f.sub(t,t,e),c.f.normalize(t,t),this._rotateInLocal||this._translateInLocal){c.c.getScale(r,n);var l=c.c.fromScaling(i,r);c.c.invert(l,l);var d=c.c.mul(n,n,l);d[12]=d[13]=d[14]=0,this._translateInLocal&&(c.c.copy(this._translateNode.getMatrix(),d),c.c.copy(this._planeNode.getMatrix(),d)),this._rotateInLocal&&(c.c.copy(this._rotateNode.getMatrix(),d),c.c.invert(d,d),c.f.transformMat4(t,t,d))}else c.c.identity(this._rotateNode.getMatrix());this.updateArcRotation(t),this._rotateNode.dirtyBound(),this._translateNode.dirtyBound(),this._planeNode.dirtyBound(),this._isEditing&&c.c.copy(this._showAngle.getMatrix(),this._hoverNode.getMatrix())}}}(),computeNearestIntersection:function(){var t=function(t,e){return t._ratio-e._ratio};return function(e,r){var i=this._viewer,a=this._canvas,n=e.canvasX*(i._canvasWidth/a.clientWidth),s=(a.clientHeight-e.canvasY)*(i._canvasHeight/a.clientHeight),o=this._viewer.computeIntersections(n,s,r);if(0!==o.length)return o.sort(t),o[0]}}(),setOnlyGizmoPicking:function(){this._viewer.getCamera().addChild(this),this._viewer.getSceneData().setNodeMask(0),this.setNodeMask(-1)},setOnlyScenePicking:function(){this._viewer.getCamera().removeChild(this),this._viewer.getSceneData().setNodeMask(-1),this.setNodeMask(x.NO_PICK)},pickGizmo:function(t,e){this.setOnlyGizmoPicking();var r=this.computeNearestIntersection(t,e);return this.setOnlyScenePicking(),r},getCanvasPositionFromWorldPoint:function(){var t=c.c.create();return function(e,r){var i=this._viewer.getCamera(),a=r;i.getViewport()?i.getViewport().computeWindowMatrix(t):c.c.identity(t),c.c.mul(t,t,i.getProjectionMatrix()),this.getReferenceFrame()===f.a.RELATIVE_RF&&c.c.mul(t,t,i.getViewMatrix()),c.f.transformMat4(a,e,t);var n=this._viewer,s=this._canvas;return a[0]=a[0]/(n._canvasWidth/s.clientWidth),a[1]=s.clientHeight-a[1]/(n._canvasHeight/s.clientHeight),a}}(),onMouseDown:function(t){if(c.e.set(this._downCanvasCoord,t.canvasX,t.canvasY),this._hoverNode&&this._attachedNode){this._viewer.setEnableManipulator(!1),this.saveEditMatrices();var e=this._hoverNode.getParents()[0].getNodeMask();this._isEditing=!0,e&x.PICK_ARC?(this._translateNode.setNodeMask(0),this._planeNode.setNodeMask(0),this.startRotateEdit(t)):e&x.PICK_ARROW?(this._rotateNode.setNodeMask(0),this._planeNode.setNodeMask(0),this.startTranslateEdit(t)):e&x.PICK_PLANE&&(this._rotateNode.setNodeMask(0),this._translateNode.setNodeMask(0),this.startPlaneEdit(t))}},saveEditMatrices:function(){c.c.copy(this._editLocal,this._attachedNode.getMatrix());var t=this.getAttachedNodeWorldMatrix();c.c.fromTranslation(this._editWorldTrans,c.f.fromValues(t[12],t[13],t[14])),c.c.copy(this._editWorldScaleRot,t),this._editWorldScaleRot[12]=this._editWorldScaleRot[13]=this._editWorldScaleRot[14]=0,c.c.invert(this._editInvWorldScaleRot,this._editWorldScaleRot)},startRotateEdit:function(t){var e=this._rotateNode.getWorldMatrix(void 0,b),r=c.f.create();c.f.transformMat4(r,r,e),this.getCanvasPositionFromWorldPoint(r,r);var i=this.pickGizmo(t,this._hoverNode.getNodeMask()|x.PICK_ARC);if(i){var a=0===this._hoverNode._nbAxis?-1:1,n=c.f.create();n[0]=a*i._localIntersectionPoint[1],n[1]=-a*i._localIntersectionPoint[0],n[2]=i._localIntersectionPoint[2];var s=c.f.create();c.f.transformMat4(s,n,this._hoverNode.getMatrix()),c.f.transformMat4(s,s,e),this.getCanvasPositionFromWorldPoint(s,s);var o=this._editLineDirection;c.e.sub(o,s,r),c.e.normalize(o,o),this._showAngle.setNodeMask(x.NO_PICK),i._localIntersectionPoint[2]=0;var h=this._showAngle.getStateSet();h.getUniform("uAngle").setFloat(0),h.getUniform("uBase").setVec3(c.f.normalize(i._localIntersectionPoint,i._localIntersectionPoint)),this._editLineOrigin[0]=t.canvasX,this._editLineOrigin[1]=t.canvasY}},startTranslateEdit:function(t){var e=this._editLineOrigin,r=this._editLineDirection,i=this._translateNode.getWorldMatrix(void 0,b);c.c.getTranslation(e,i),c.f.init(r),r[this._hoverNode._nbAxis]=1,this._translateInLocal&&(c.f.transformMat4(r,r,this._editWorldScaleRot),c.f.normalize(r,r)),c.f.add(r,e,r),this.getCanvasPositionFromWorldPoint(e,e),this.getCanvasPositionFromWorldPoint(r,r),c.e.sub(r,r,e),c.e.normalize(r,r);var a=this._editOffset;c.e.set(a,t.canvasX,t.canvasY),c.e.sub(a,a,e)},startPlaneEdit:function(t){var e=this._editLineOrigin,r=this._planeNode.getWorldMatrix(void 0,b);c.c.getTranslation(e,r),this.getCanvasPositionFromWorldPoint(e,e);var i=this._editOffset;c.e.set(i,t.canvasX,t.canvasY),c.e.sub(i,i,e)},drawLineCanvasDebug:function(t,e,r,i){this._debugNode.setNodeMask(x.NO_PICK);var a=this._debugNode.getChildren()[0].getAttributes().Vertex;a.getElements()[0]=t/this._canvas.clientWidth*2-1,a.getElements()[1]=(this._canvas.clientHeight-e)/this._canvas.clientHeight*2-1,a.getElements()[2]=r/this._canvas.clientWidth*2-1,a.getElements()[3]=(this._canvas.clientHeight-i)/this._canvas.clientHeight*2-1,a.dirty()},pickAndSelect:function(t){this.setNodeMask(0);var e=this.computeNearestIntersection(t,this._tmask);this.attachToNodePath(e?e._nodePath:e)},onMouseUp:function(t){this._viewer.setEnableManipulator(!0),this._debugNode&&this._debugNode.setNodeMask(0);var e=c.e.fromValues(t.canvasX,t.canvasY);0===c.e.distance(e,this._downCanvasCoord)&&this.pickAndSelect(t),this._showAngle.setNodeMask(0),this._isEditing=!1,this._hoverNode&&this.updateGizmoMask()},onMouseMove:function(t){if(this._attachedNode){var e;if(!1===this._isEditing)return e=this.pickGizmo(t,x.PICK_GIZMO),void this.onNodeHovered(e);if(this._hoverNode){var r=this._hoverNode.getParents()[0];r===this._rotateNode?this.updateRotateEdit(t):r===this._translateNode?this.updateTranslateEdit(t):r===this._planeNode&&this.updatePlaneEdit(t)}}},updateRotateEdit:function(){var t=c.c.create(),e=c.e.create(),r=c.f.fromValues(1,0,0),i=c.f.fromValues(0,1,0),a=c.f.fromValues(0,0,1),n=c.f.create();return function(s){var o=this._editLineOrigin,h=this._editLineDirection;c.e.set(e,s.canvasX,s.canvasY),c.e.sub(e,e,o);var u=c.e.dot(e,h);if(this._debugNode){var l=o[0],d=o[1];this.drawLineCanvasDebug(l,d,l+h[0]*u,d+h[1]*u)}var _=Math.min(this._canvas.clientWidth,this._canvas.clientHeight),f=7*u/_;f%=2*Math.PI;var g=this._hoverNode._nbAxis;0===g?c.c.fromRotation(t,-f,r):1===g?c.c.fromRotation(t,-f,i):2===g&&c.c.fromRotation(t,-f,a),this._showAngle.getOrCreateStateSet().getUniform("uAngle").setFloat(0===g?-f:f),this._rotateInLocal||(c.c.mul(t,this._editInvWorldScaleRot,t),c.c.mul(t,t,this._editWorldScaleRot));var p=this._attachedNode.getMatrix();c.c.translate(p,this._editLocal,this._pivotOffset),c.c.mul(p,p,t),c.c.translate(p,p,c.f.negate(n,this._pivotOffset)),this._attachedNode.dirtyBound()}}(),updateTranslateEdit:function(){var t=c.e.create(),e=c.f.create();return function(r){var i=this._editLineOrigin,a=this._editLineDirection;c.e.set(t,r.canvasX,r.canvasY),c.e.sub(t,t,i),c.e.sub(t,t,this._editOffset);var n=c.e.dot(t,a);t[0]=i[0]+a[0]*n,t[1]=i[1]+a[1]*n,this._debugNode&&this.drawLineCanvasDebug(i[0],i[1],t[0],t[1]);var s=this._viewer,o=this._canvas,h=t[0]*(s._canvasWidth/o.clientWidth),u=(o.clientHeight-t[1])*(s._canvasHeight/o.clientHeight);if(this._lsi.reset(),this._lsi.setTestPlane(!1),this._lsi.set(c.f.set(this._origIntersect,h,u,0),c.f.set(this._dstIntersect,h,u,1)),this._iv.reset(),this._iv.setTraversalMask(this._hoverNode.getNodeMask()),c.c.copy(this.getMatrix(),this._editWorldTrans),this.setOnlyGizmoPicking(),this._viewer._camera.accept(this._iv),this.setOnlyScenePicking(),this._translateInLocal){c.c.getScale(e,this._editInvWorldScaleRot);var l=this._lsi.getTranslateDistance();c.f.mul(e,e,l)}else c.f.transformMat4(e,this._lsi.getTranslateDistance(),this._editInvWorldScaleRot);c.c.translate(this._attachedNode.getMatrix(),this._editLocal,e),this._attachedNode.dirtyBound()}}(),updatePlaneEdit:function(){var t=c.e.create(),e=c.f.create();return function(r){c.e.set(t,r.canvasX,r.canvasY),c.e.sub(t,t,this._editOffset);var i=this._viewer,a=this._canvas,n=t[0]*(i._canvasWidth/a.clientWidth),s=(a.clientHeight-t[1])*(i._canvasHeight/a.clientHeight);if(this._lsi.reset(),this._lsi.setTestPlane(!0),this._lsi.set(c.f.set(this._origIntersect,n,s,0),c.f.set(this._dstIntersect,n,s,1)),this._iv.reset(),this._iv.setTraversalMask(this._hoverNode.getNodeMask()),c.c.copy(this.getMatrix(),this._editWorldTrans),this.setOnlyGizmoPicking(),this._viewer._camera.accept(this._iv),this.setOnlyScenePicking(),this._translateInLocal){c.c.getScale(e,this._editInvWorldScaleRot);var o=this._lsi.getTranslateDistance();c.f.mul(e,e,o)}else c.f.transformMat4(e,this._lsi.getTranslateDistance(),this._editInvWorldScaleRot);c.c.translate(this._attachedNode.getMatrix(),this._editLocal,e),this._attachedNode.dirtyBound()}}()}),"osgUtil","NodeGizmo"),e.a=x},function(t,e,r){"use strict";var i=r(0),a=r(1),n=r(74),s=r(237),o=function(){n.a.call(this),this._center=a.f.create(),this._iCenter=a.f.create(),this._radius=1,this._iRadius=1};i.a.createPrototypeObject(o,i.a.objectInherit(n.a.prototype,{set:function(t,e){a.f.copy(this._center,t),a.f.copy(this._iCenter,t),this._radius=this._iRadius=e,this.reset()},setCenter:function(t){a.f.copy(this._center,t),a.f.copy(this._iCenter,t)},setRadius:function(t){this._radius=this._iRadius=t},intersectNode:function(t){return this.intersectBoundingSphere(t.getBoundingSphere())},intersectBoundingSphere:function(t){if(!t.valid())return!1;var e=this._iRadius+t.radius();return a.f.sqrDist(t.center(),this._iCenter)<=e*e},intersect:function(){var t=new s.a;return function(e,r){t.setGeometry(r),t.setIntersectionVisitor(e),t.setIntersector(this),t.set(this._iCenter,this._iRadius);var i=r.getShape();i?i.intersect(t,i.getNodes()[0]):(r.computeTransformedVertices&&t.setVertices(r.computeTransformedVertices()),t.apply(r)),t.reset()}}(),setCurrentTransformation:function(){var t=a.f.create();return function(e){a.c.invert(e,e),a.f.transformMat4(this._iCenter,this._center,e),a.c.getScale(t,e);var r=t[0],i=t[1],n=t[2],s=r>i?r>n?r:n:i>n?i:n;this._iRadius=this._radius*s}}()}),"osgUtil","SphereIntersector"),e.a=o},function(t,e,r){"use strict";var i=r(0),a=r(1),n=r(76),s=function(){n.a.Intersection.call(this),this._localIntersectionNormal=a.f.clone(a.f.ONE),this._i1=-1,this._i2=-1,this._i3=-1,this._r1=0,this._r2=0,this._r3=0},o=function(){n.a.apply(this),this._center=void 0,this._radius=0};i.a.createPrototypeObject(o,i.a.objectInherit(n.a.prototype,{set:function(t,e){this._center=t,this._radius=e},enter:function(t){for(var e=this._radius*this._radius,r=0,i=t.getMin(),a=t.getMax(),n=0,s=0;s<3;s++)this._center[s]<i[s]?(n=this._center[s]-i[s],r+=n*n):this._center[s]>a[s]&&(n=this._center[s]-a[s],r+=n*n);return r<=e},intersectPoint:function(t,e){var r=a.f.sqrDist(t,this._center);if(!(r>this._radius*this._radius)){var i=this.initIntersection(new s);i._i1=e,i._r1=1,a.f.copy(i._localIntersectionPoint,t),i._ratio=Math.sqrt(r)/this._radius}},intersectLine:function(){var t=a.f.create(),e=a.f.create();return function(r,i,n,o){a.f.sub(t,this._center,r),a.f.sub(e,i,r);var h=a.f.dot(t,e)/a.f.sqrLen(e),u=1;if(!((u=h<0?a.f.sqrLen(t):h>1?a.f.sqrDist(this._center,i):a.f.sqrLen(a.f.scaleAndAdd(t,t,e,-h)))>this._radius*this._radius)){var c=this.initIntersection(new s);c._i1=n,c._i2=o,c._r1=1-h,c._r2=h,a.f.scaleAndAdd(c._localIntersectionPoint,r,e,h),c._ratio=Math.sqrt(u)/this._radius}}}(),intersectTriangle:function(){var t=a.f.create(),e=a.f.create(),r=a.f.create();return function(i,n,o,h,u,c){if(!this._limitOneIntersection||!this._hit){a.f.sub(t,n,i),a.f.sub(e,o,i);var l=a.f.sqrLen(t),d=a.f.dot(t,e),_=a.f.sqrLen(e);a.f.sub(r,i,this._center);var f=a.f.dot(r,t),g=a.f.dot(r,e),p=a.f.sqrLen(r),m=Math.abs(l*_-d*d);if(!(m<1e-10)){var v,S=d*g-_*f,b=d*f-l*g,x=4;if(S+b<=m)if(S<0)b<0?(x=4,f<0?(b=0,-f>=l?(S=1,v=l+2*f+p):(S=-f/l,v=f*S+p)):(S=0,g>=0?(b=0,v=p):-g>=_?(b=1,v=_+2*g+p):(b=-g/_,v=g*b+p))):(x=3,S=0,g>=0?(b=0,v=p):-g>=_?(b=1,v=_+2*g+p):(b=-g/_,v=g*b+p));else if(b<0)x=5,b=0,f>=0?(S=0,v=p):-f>=l?(S=1,v=l+2*f+p):(S=-f/l,v=f*S+p);else{x=0;var y=1/m;S*=y,b*=y,v=S*(l*S+d*b+2*f)+b*(d*S+_*b+2*g)+p}else{var M,T,A,C;S<0?(x=2,M=d+f,T=_+g,T>M?(A=T-M,C=l-2*d+_,A>=C?(S=1,b=0,v=l+2*f+p):(S=A/C,b=1-S,v=S*(l*S+d*b+2*f)+b*(d*S+_*b+2*g)+p)):(S=0,T<=0?(b=1,v=_+2*g+p):g>=0?(b=0,v=p):(b=-g/_,v=g*b+p))):b<0?(x=6,M=d+g,T=l+f,T>M?(A=T-M,C=l-2*d+_,A>=C?(b=1,S=0,v=_+2*g+p):(b=A/C,S=1-b,v=S*(l*S+d*b+2*f)+b*(d*S+_*b+2*g)+p)):(b=0,T<=0?(S=1,v=l+2*f+p):f>=0?(S=0,v=p):(S=-f/l,v=f*S+p))):(x=1,A=_+g-d-f,A<=0?(S=0,b=1,v=_+2*g+p):(C=l-2*d+_,A>=C?(S=1,b=0,v=l+2*f+p):(S=A/C,b=1-S,v=S*(l*S+d*b+2*f)+b*(d*S+_*b+2*g)+p)))}if(!(v>this._radius*this._radius)){var I=a.f.create(),w=this.initIntersection(new s);w._i1=h,w._i2=u,w._i3=c,w._r1=1-S-b,w._r2=S,w._r3=b;var E=w._localIntersectionPoint;a.f.scaleAndAdd(E,a.f.scaleAndAdd(E,i,t,S),e,b),a.f.cross(w._localIntersectionNormal,t,e),a.f.normalize(I,w._localIntersectionNormal),w._ratio=Math.sqrt(v)/this._radius,w._zone=x}}}}}()}),"osgUtil","SphereIntersectFunctor"),e.a=o},function(t,e,r){"use strict";var i=r(0),a=r(13),n=r(11),s=r(3),o=r(9),h=r(1),u=function(){s.a.call(this),this._T=void 0,this._B=void 0,this._N=void 0,this._texCoordUnit=0};i.a.createPrototypeObject(u,i.a.objectInherit(s.a.prototype,{apply:function(t){t.getTypeID()===n.a.getTypeID()?this.generate(t,this._texCoordUnit):this.traverse(t)},setTexCoordUnit:function(t){this._texCoordUnit=t},computePrimitiveSet:function(t,e){if(e.getIndices){var r,i=e.getNumIndices(),a=t.getAttributes().Vertex,n=t.getAttributes().Normal,s=t.getAttributes()["TexCoord"+this._texCoordUnit];if(e.getMode()===o.a.TRIANGLES)for(r=0;r<i;r+=3)this.compute(e,a,n,s,r,r+1,r+2);else if(e.getMode()===o.a.TRIANGLE_STRIP)for(r=0;r<i-2;++r)r%2==0?this.compute(e,a,n,s,r,r+1,r+2):this.compute(e,a,n,s,r+1,r,r+2)}},generate:function(t,e){if(this._texCoordUnit=e,void 0===this._texCoordUnit&&(this._texCoordUnit=0),t.getAttributes()["TexCoord"+this._texCoordUnit]){var r=t.getAttributes().Vertex.getElements().length;this._T=new i.a.Float32Array(r),this._B=new i.a.Float32Array(r),this._N=new i.a.Float32Array(r),t.getPrimitiveSetList().forEach(function(e){this.computePrimitiveSet(t,e)},this);for(var n=r/3,s=new i.a.Float32Array(4*n),o=h.f.create(),u=h.f.create(),c=h.f.create(),l=0;l<n;l++){var d=this._T.subarray(3*l,3*l+3),_=this._N.subarray(3*l,3*l+3),f=this._B.subarray(3*l,3*l+3);h.f.normalize(_,_);var g=h.f.dot(_,d);h.f.scale(u,_,g),h.f.sub(o,d,u),h.f.normalize(c,o),h.f.cross(o,_,d);var p=h.f.dot(o,f);p=p<0?-1:0,s[4*l]=c[0],s[4*l+1]=c[1],s[4*l+2]=c[2],s[4*l+3]=p}t.getAttributes().Normal.setElements(this._N),t.getAttributes().Tangent=new a.a("ARRAY_BUFFER",s,4)}},compute:function(t,e,r,i,a,n,s){var o,u,c=t.index(a),l=t.index(n),d=t.index(s),_=e.getElements().subarray(3*c,3*c+3),f=e.getElements().subarray(3*l,3*l+3),g=e.getElements().subarray(3*d,3*d+3),p=r.getElements().subarray(3*c,3*c+3),m=r.getElements().subarray(3*l,3*l+3),v=r.getElements().subarray(3*d,3*d+3),S=i.getElements().subarray(2*c,2*c+2),b=i.getElements().subarray(2*l,2*l+2),x=i.getElements().subarray(2*d,2*d+2),y=h.f.create(),M=h.f.create(),T=h.f.create(),A=h.f.create(),C=h.f.create(),I=h.f.create(),w=h.f.create(),E=h.f.create(),N=h.f.create();h.f.set(E,f[0]-_[0],b[0]-S[0],b[1]-S[1]),h.f.set(N,g[0]-_[0],x[0]-S[0],x[1]-S[1]),h.f.cross(y,E,N),0!==y[0]&&(h.f.normalize(y,y),u=-y[1]/y[0],o=-y[2]/y[0],C[0]+=u,M[0]+=o,I[0]+=u,T[0]+=o,w[0]+=u,A[0]+=o),h.f.set(E,f[1]-_[1],b[0]-S[0],b[1]-S[1]),h.f.set(N,g[1]-_[1],x[0]-S[0],x[1]-S[1]),h.f.cross(y,E,N),0!==y[0]&&(h.f.normalize(y,y),u=-y[1]/y[0],o=-y[2]/y[0],C[1]+=u,M[1]+=o,I[1]+=u,T[1]+=o,w[1]+=u,A[1]+=o),h.f.set(E,f[2]-_[2],b[0]-S[0],b[1]-S[1]),h.f.set(N,g[2]-_[2],x[0]-S[0],x[1]-S[1]),h.f.cross(y,E,N),0!==y[0]&&(h.f.normalize(y,y),u=-y[1]/y[0],o=-y[2]/y[0],C[2]+=u,M[2]+=o,I[2]+=u,T[2]+=o,w[2]+=u,A[2]+=o);var R,O,F,P=h.f.create(),L=h.f.create();h.f.cross(P,p,C),h.f.cross(L,P,p),R=this._T.subarray(3*c,3*c+3),h.f.add(R,L,R),h.f.cross(P,M,p),h.f.cross(L,p,P),O=this._B.subarray(3*c,3*c+3),h.f.add(O,L,O),h.f.cross(P,m,I),h.f.cross(L,P,m),R=this._T.subarray(3*l,3*l+3),h.f.add(R,L,R),h.f.cross(P,T,m),h.f.cross(L,m,P),O=this._B.subarray(3*l,3*l+3),h.f.add(O,L,O),h.f.cross(P,v,w),h.f.cross(L,P,v),R=this._T.subarray(3*d,3*d+3),h.f.add(R,L,R),h.f.cross(P,A,v),h.f.cross(L,v,P),O=this._B.subarray(3*d,3*d+3),h.f.add(O,L,O),F=this._N.subarray(3*c,3*c+3),h.f.add(F,p,F),F=this._N.subarray(3*l,3*l+3),h.f.add(F,m,F),F=this._N.subarray(3*d,3*d+3),h.f.add(F,v,F)}}),"osgUtil","TangentSpaceGenerator"),e.a=u},function(t,e,r){"use strict";var i=r(15),a=r(30),n=r(1),s=r(8),o=r(21),h=r(26),u=r(35),c=r(7),l=r(23),d=r(6),_=r(37),f={},g=function(t,e,r,i,a){this._viewer=t,this._rttScene=e,this._hmdConfig=r,this._root=i,this._canvas=a,this._width=a.width,this._height=a.height};g.prototype={update:function(){var t=this._canvas,e=t.width,r=t.height;if(e!==this._width||r!==this._height){this._root.removeChildren();var i=this._hmdConfig;i&&i.isCardboard&&(i.hResolution=e,i.vResolution=r),this._width=e,this._height=r,f.createScene(this._viewer,this._rttScene,i,this._root)}return!0}};var p=function(t,e){this._rootView=t,this._offsetView=e};p.prototype={update:function(t){var e=t.getViewMatrix();return n.c.mul(e,this._offsetView,this._rootView),!0}};var m=function(t,e,r,i){var a=e.hResolution/(2*e.vResolution),s=-1-4*(.25*e.hScreenSize-.5*e.lensSeparationDistance)/e.hScreenSize,o=e.distortionK[0]+e.distortionK[1]*Math.pow(s,2)+e.distortionK[2]*Math.pow(s,4)+e.distortionK[3]*Math.pow(s,6),h=180/Math.PI*2*Math.atan2(e.vScreenSize*o,2*e.eyeToScreenDistance),u=n.c.perspective(n.c.create(),Math.PI/180*h,a,.3,1e4),c=4*(.25*e.hScreenSize-.5*e.interpupillaryDistance)/e.hScreenSize,l=4*(.25*e.hScreenSize-.5*e.lensSeparationDistance)/e.hScreenSize,d=n.c.create(),_=n.c.create();i.projectionLeft=n.c.mul(d,n.c.fromTranslation(d,n.f.fromValues(c,0,0)),u),i.projectionRight=n.c.mul(_,n.c.fromTranslation(_,n.f.fromValues(-c,0,0)),u),i.viewLeft=n.c.fromTranslation(n.c.create(),n.f.fromValues(t*e.interpupillaryDistance*.5,0,0)),i.viewRight=n.c.fromTranslation(n.c.create(),n.f.fromValues(-t*e.interpupillaryDistance*.5,0,0)),r.lensCenterLeft=n.e.fromValues(l,0),r.lensCenterRight=n.e.fromValues(-l,0),r.hmdWarpParam=e.distortionK,r.chromAbParam=e.chromaAbParameter,r.scaleIn=n.e.fromValues(1,1/a),r.scale=n.e.fromValues(1/o,1*a/o)},v=function(){var t=["","#ifdef GL_ES","precision highp float;","#endif","uniform vec2 uScale;","uniform vec2 uScaleIn;","uniform vec2 uLensCenter;","uniform vec4 uHmdWarpParam;","uniform vec4 uChromAbParam;","uniform sampler2D Texture0;","varying vec2 vTexCoord0;","void main(void) {","  vec2 uv = (vTexCoord0 * 2.0) - 1.0;","  vec2 theta = (uv - uLensCenter) * uScaleIn;","  float rSq = theta.x * theta.x + theta.y * theta.y;","  vec2 rvector = theta * (uHmdWarpParam.x + uHmdWarpParam.y * rSq + uHmdWarpParam.z * rSq * rSq + uHmdWarpParam.w * rSq * rSq * rSq);","  vec2 rBlue = rvector * (uChromAbParam.z + uChromAbParam.w * rSq);","  vec2 tcBlue = (uLensCenter + uScale * rBlue);","  tcBlue = (tcBlue + 1.0) * 0.5;","  if (any(bvec2(clamp(tcBlue, vec2(0.0, 0.0), vec2(1.0, 1.0)) - tcBlue))) {","    gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","    return;","  }","  vec2 tcGreen = uLensCenter + uScale * rvector;","  tcGreen = (tcGreen + 1.0) * 0.5;","  vec2 rRed = rvector * (uChromAbParam.x + uChromAbParam.y * rSq);","  vec2 tcRed = uLensCenter + uScale * rRed;","  tcRed = (tcRed + 1.0) * 0.5;","  gl_FragColor = vec4(texture2D(Texture0, tcRed).r, texture2D(Texture0, tcGreen).g, texture2D(Texture0, tcBlue).b, 1);","}",""].join("\n");return new o.a(new h.a(h.a.VERTEX_SHADER,["attribute vec3 Vertex;","varying vec2 vTexCoord0;","void main(void) {","  gl_Position = vec4(Vertex * 2.0 - 1.0, 1.0);","  vTexCoord0 = Vertex.xy;","}","","#define SHADER_NAME VRpostProcessing",""].join("\n")),new h.a(h.a.FRAGMENT_SHADER,t))},S=function(t){var e=new c.default;return e.setTextureSize(t[0],t[1]),e.setMinFilter("LINEAR"),e.setMagFilter("LINEAR"),e},b=function(t,e,r,a,s,o){var h=new i.a,u=e[0],c=e[1],f=r[0],g=r[1];!0===a?t?h.setViewport(new _.a(0,0,f/2,g)):h.setViewport(new _.a(f/2,0,f/2,g)):t?h.setViewport(new _.a(.5*f-u,.5*(g-c),u,c)):h.setViewport(new _.a(.5*f,.5*(g-c),u,c)),n.c.ortho(h.getProjectionMatrix(),-.5,.5,-.5,.5,-5,5),h.setRenderOrder(i.a.NESTED_RENDER,0),h.setReferenceFrame(l.a.ABSOLUTE_RF);var p=h.getOrCreateStateSet();return p.setTextureAttributeAndModes(0,s),p.setAttributeAndModes(v()),p.addUniform(d.a.createFloat2(o.scale,"uScale")),p.addUniform(d.a.createFloat2(o.scaleIn,"uScaleIn")),p.addUniform(d.a.createFloat2(t?o.lensCenterLeft:o.lensCenterRight,"uLensCenter")),p.addUniform(d.a.createFloat4(o.hmdWarpParam,"uHmdWarpParam")),p.addUniform(d.a.createFloat4(o.chromAbParam,"uChromAbParam")),h},x=function(t,e){var r=new i.a;return r.setName("rtt camera"),r.setViewport(new _.a(0,0,t.getWidth(),t.getHeight())),r.setProjectionMatrix(e),r.setClearColor(n.g.fromValues(.3,.3,.3,0)),r.setRenderOrder(i.a.POST_RENDER,0),r.attachTexture(a.a.COLOR_ATTACHMENT0,t),r.attachRenderBuffer(a.a.DEPTH_ATTACHMENT,a.a.DEPTH_COMPONENT16),r.setReferenceFrame(l.a.ABSOLUTE_RF),r};f.createScene=function(t,e,r,i,a){var o=f.getDefaultConfig(r),h=n.e.fromValues(.5*o.hResolution,o.vResolution),c=n.e.fromValues(.5*o.hResolution,o.vResolution),l=t.getCamera().getViewport(),d=n.e.fromValues(l.width(),l.height()),_=t.getGraphicContext().canvas;o.isCardboard&&(d[0]=_.width,d[1]=_.height);var v=void 0!==a?a:1,y={},M={};m(v,o,y,M);var T=t.getCamera().getViewMatrix(),A=i||new s.a;A.addUpdateCallback(new g(t,e,r,A,_));var C=S(h),I=x(C,M.projectionLeft),w=b(!0,c,d,o.isCardboard,C,y);I.addUpdateCallback(new p(T,M.viewLeft));var E=S(h),N=x(E,M.projectionRight),R=b(!1,c,d,o.isCardboard,E,y);return N.addUpdateCallback(new p(T,M.viewRight)),I.addChild(e),N.addChild(e),w.addChild(u.a.createTexturedFullScreenFakeQuadGeometry()),R.addChild(u.a.createTexturedFullScreenFakeQuadGeometry()),A.addChild(I),A.addChild(N),A.addChild(w),A.addChild(R),A},f.getDefaultConfig=function(t){var e={hResolution:1920,vResolution:1080,hScreenSize:.1296,vScreenSize:.0729,interpupillaryDistance:.064,lensSeparationDistance:.0635,eyeToScreenDistance:.04,distortionK:n.g.fromValues(1,.22,.13,.02),chromaAbParameter:n.g.fromValues(.996,-.004,1.014,0),isCardboard:!1};return 2===t||void 0===t?e:1===t?(e.hResolution=1280,e.vResolution=800,e.hScreenSize=.14976,e.vScreenSize=.0936,e.lensSeparationDistance=.064,e.eyeToScreenDistance=.041,e.distortionK=n.g.fromValues(1,.22,.24,0),e):(void 0!==t.hResolution&&(e.hResolution=t.hResolution),void 0!==t.vResolution&&(e.vResolution=t.vResolution),void 0!==t.hScreenSize&&(e.hScreenSize=t.hScreenSize),void 0!==t.vScreenSize&&(e.vScreenSize=t.vScreenSize),void 0!==t.interpupillaryDistance&&(e.interpupillaryDistance=t.interpupillaryDistance),void 0!==t.lensSeparationDistance&&(e.lensSeparationDistance=t.lensSeparationDistance),void 0!==t.eyeToScreenDistance&&(e.eyeToScreenDistance=t.eyeToScreenDistance),void 0!==t.distortionK&&(e.distortionK=t.distortionK),void 0!==t.chromaAbParameter&&(e.chromaAbParameter=t.chromaAbParameter),void 0!==t.isCardboard&&(e.isCardboard=t.isCardboard),e)},e.a=f},function(t,e,r){"use strict";var i=r(15),a=r(30),n=r(1),s=r(8),o=r(21),h=r(26),u=r(35),c=r(7),l=r(23),d=r(6),_=r(37),f=function(t,e){this._rootView=t,this._offsetView=e};f.prototype={update:function(t){var e=t.getViewMatrix();return n.c.mul(e,this._offsetView,this._rootView),!0}};var g=function(t){var e=new c.default;return e.setTextureSize(t.width,t.height),e.setMinFilter("LINEAR"),e.setMagFilter("LINEAR"),e},p=function(){var t=["#ifdef GL_ES","   precision highp float;","#endif","varying vec2 vTexCoord0;","uniform sampler2D TextureLeft;","uniform sampler2D TextureRight;","void main() {","   if (vTexCoord0.x < 0.5)","       gl_FragColor = texture2D(TextureLeft, vec2(vTexCoord0.x * 2.0, vTexCoord0.y));","   else","       gl_FragColor = texture2D(TextureRight, vec2(vTexCoord0.x * 2.0 - 1.0, vTexCoord0.y));","}"].join("\n");return new o.a(new h.a(h.a.VERTEX_SHADER,["attribute vec3 Vertex;","varying vec2 vTexCoord0;","void main(void) {","  gl_Position = vec4(Vertex * 2.0 - 1.0, 1.0);","  vTexCoord0 = Vertex.xy;","}","","#define SHADER_NAME VRpostProcessing",""].join("\n")),new h.a(h.a.FRAGMENT_SHADER,t))},m=function(t,e,r){var a=new i.a;a.setViewport(r),a.setRenderOrder(i.a.NESTED_RENDER,0),a.setReferenceFrame(l.a.ABSOLUTE_RF),n.c.ortho(a.getProjectionMatrix(),0,1,0,1,-5,5);var s=a.getOrCreateStateSet();return s.addUniform(d.a.createInt(0,"TextureLeft")),s.addUniform(d.a.createInt(1,"TextureRight")),s.setTextureAttributeAndModes(0,t),s.setTextureAttributeAndModes(1,e),s.setAttributeAndModes(p()),a.addChild(u.a.createTexturedFullScreenFakeQuadGeometry()),a},v=function(t,e){var r=new i.a;return r.setName("rtt camera"),r.setViewport(new _.a(0,0,t.getWidth(),t.getHeight())),r.setProjectionMatrix(e),r.setClearColor(n.g.fromValues(.3,.3,.3,0)),r.setRenderOrder(i.a.POST_RENDER,0),r.attachTexture(a.a.COLOR_ATTACHMENT0,t),r.attachRenderBuffer(a.a.DEPTH_ATTACHMENT,a.a.DEPTH_COMPONENT16),r.setReferenceFrame(l.a.ABSOLUTE_RF),r},S={};S.createScene=function(t,e,r,i,a){var o=i||new s.a;return r.requestAnimationFrame(function(){var i=void 0!==a?a:1,s=r.getEyeParameters("left"),h=r.getEyeParameters("right"),u=new window.VRFrameData;r.getFrameData(u);var c=n.c.fromTranslation(n.c.create(),n.f.fromValues(-i*s.offset[0],s.offset[1],s.offset[2])),l=n.c.fromTranslation(n.c.create(),n.f.fromValues(-i*h.offset[0],h.offset[1],h.offset[2])),d={width:Math.max(s.renderWidth,h.renderWidth),height:Math.max(s.renderHeight,h.renderHeight)},_=g(d),p=g(d),S=v(_,u.leftProjectionMatrix),b=v(p,u.rightProjectionMatrix),x=t.getCamera().getViewMatrix();S.addUpdateCallback(new f(x,c)),b.addUpdateCallback(new f(x,l));var y=m(_,p,t.getCamera().getViewport());S.addChild(e),b.addChild(e),o.addChild(S),o.addChild(b),o.addChild(y)}),o},e.a=S},function(t,e,r){"use strict";var i=r(96),a=r(97),n=r(242),s=r(160),o=r(10),h={};h.Renderer=i.default,h.View=a.default,h.Viewer=n.a,h.Scene=s.a,h.InputGroups=o.a,e.a=h},function(t,e,r){"use strict";var i=r(2),a=r(1),n=r(61),s=r(14),o=r.n(s),h=r(22),u=r(124),c=r(123),l=r(0),d=r(33),_=r(30),f=r(13),g=r(62),p=r(26),m=r(21),v=r(7),S=r(149),b=r(97),x=r(107),y=r(243),M=r(162),T=r(166),A=r(167),C=r(168),I=r(244),w=r(245),E=r(246),N=r(247),R=r(248),O=r(249),F=r(250),P=r(51),L=r(65),D=r(64),V=function(t,e,r){b.default.call(this),this._startTick=h.a.instance().tick(),this._stats=void 0,this._done=!1,this._canvas=t;var i=this.initOptions(e),a=this.initWebGLContext(t,i,r);if(!a)throw"No WebGL implementation found";this._updateVisitor=new c.a,this.setUpView(a.canvas,i),this.initInputManager(i,t),this.initStats(i,t),this._hmd=null,this._requestAnimationFrame=window.requestAnimationFrame.bind(window),this._options=i,this._contextLost=!1,this._forceRestoreContext=!0,this.renderBinded=this.render.bind(this)};l.a.createPrototypeObject(V,l.a.objectInherit(b.default.prototype,{initInputManager:function(t,e){var r=new I.a;this._inputManager=r,this._initInputSource(w.a,"Mouse",e,t),this._initInputSource(E.a,"Keyboard",document,t),"ontouchstart"in window&&this._initInputSource(F.a,"TouchScreen",e,t),this._initInputSource(N.a,"WebVR",void 0,t),this._initInputSource(O.a,"DeviceOrientation",void 0,t),navigator.getGamepads&&this._initInputSource(R.a,"GamePad",void 0,t),r.addMappings({"viewer.internals:hmdConnect":"vrdisplayconnected"},function(t){this.setVRDisplay(t.vrDisplay)}.bind(this)),r.setParam("pixelRatio",[this._devicePixelRatio,this._devicePixelRatio])},_initInputSource:function(t,e,r,i){var a=i.InputSources?i.InputSources[e]:void 0;if(a){if(!1!==a.enable){var n=a.sourceElement||r;this._inputManager.registerInputSource(new t(n,a))}}else this._inputManager.registerInputSource(new t(r))},getInputManager:function(){return this._inputManager},initOptions:function(t){var e=new n.a;return t&&e.extend(t),e.extendWithOptionsURL(),!0===e.getBoolean("traceLogCall")&&(i.a.traceLogCall=!0),!0===e.getBoolean("enableFrustumCulling")&&this.getCamera().getRenderer().getCullVisitor().setEnableFrustumCulling(!0),e},initWebGLContext:function(t,e,r){e.get("SimulateWebGLLostContext")&&(t=y.a.makeLostContextSimulatingCanvas(t),t.loseContextInNCalls(e.get("SimulateWebGLLostContext")),this._canvas=t);var a=x.a.setupWebGL(t,e,r);return t.addEventListener("webglcontextlost",function(t){this.contextLost(),!1!==this._forceRestoreContext&&t.preventDefault()}.bind(this),!1),t.addEventListener("webglcontextrestored",function(){this.contextRestored()}.bind(this),!1),(i.a.reportWebGLError||e.get("reportWebGLError"))&&(a=y.a.makeDebugContext(a)),this.initWebGLCaps(a),this.setGraphicContext(a),a},setContextLostCallback:function(t){this._contextLostCallback=t,this._contextLost&&(this._forceRestoreContext=t())},setContextRestoreCallback:function(t){this._contextRestoreCallback=t},contextLost:function(){i.a.log("webgl context lost"),this._contextLostCallback&&(this._forceRestoreContext=this._contextLostCallback()),this._contextLost=!0,window.cancelAnimationFrame(this._requestID)},contextRestored:function(){if(!1===this._forceRestoreContext)return void i.a.log("webgl context restore not supported - please reload the page - ");this.restoreContext(),i.a.log("webgl context restored")},restoreContext:function(){var t=this.getGraphicContext();p.a.onLostContext(t),m.a.onLostContext(t),f.a.onLostContext(t),g.a.onLostContext(t),_.a.onLostContext(t),v.default.getTextureManager(t).onLostContext(t),d.a.onLostContext(t),this.getCamera().getRenderer().getState().resetCaches(),this.initWebGLCaps(t,!0),this.setGraphicContext(t),u.a.instance(this.getGraphicContext(),!0),this._stats&&this._stats.reset(),this._contextLost=!1,this._requestRedraw=!0,this._contextRestoreCallback&&this._contextRestoreCallback(t),this._runImplementation()},init:function(){},getUpdateVisitor:function(){return this._updateVisitor},getState:function(){return this.getCamera().getRenderer().getState()},initStats:function(t){var e=u.a.instance(this.getGraphicContext());if(!t.getBoolean("stats"))return void e.disable();this._stats=new M.a(this,t),this._stats.addConfig(T.a),this._stats.addConfig(A.a),this._stats.addConfig(C.a),this.getCamera().addChild(this._stats.getNode()),e.setCallback(this.callbackTimerGPU.bind(this))},callbackTimerGPU:function(t,e){this._stats&&this._stats.getCounter(e).set(t/1e6)},getViewerStats:function(){return this._stats},renderingTraversal:function(){if(this.getState()._frameStamp=this._frameStamp,this.getScene().getSceneData()&&this.getScene().getSceneData().getBound(),this.getCamera()){var t=this._stats,e=u.a.instance(this.getGraphicContext()),r=this.getCamera().getRenderer();if(t&&t.getCounter("cull").start(),r.cull(),t&&t.getCounter("cull").end(),e.pollQueries(),e.start("glframe"),t&&t.getCounter("render").start(),r.draw(),t&&t.getCounter("render").end(),e.end("glframe"),t){var i=r.getCullVisitor();t.getCounter("cullcamera").set(i._numCamera),t.getCounter("cullmatrixtransform").set(i._numMatrixTransform),t.getCounter("cullprojection").set(i._numProjection),t.getCounter("cullnode").set(i._numNode),t.getCounter("culllightsource").set(i._numLightSource),t.getCounter("cullgeometry").set(i._numGeometry),t.getCounter("pushstateset").set(r.getState()._numPushStateSet),t.getCounter("applyStateSet").set(r.getState()._numApply)}}},updateTraversal:function(){var t=this._stats;t&&t.getCounter("update").start(),this._updateVisitor.resetStats(),this.getScene().updateSceneGraph(this._updateVisitor),t&&t.getCounter("updatecallback").set(this._updateVisitor._numUpdateCallback),this.getDatabasePager().releaseGLExpiredSubgraphs(.005),this.flushDeletedGLObjects(.005),t&&t.getCounter("update").end()},advance:function(t){var e=t;void 0===e&&(e=Number.MAX_VALUE);var r=this._frameStamp,i=r.getFrameNumber();r.setFrameNumber(i+1);var a=h.a.instance().deltaS(this._startTick,h.a.instance().tick());r.setReferenceTime(a);var n=r.getSimulationTime();r.setSimulationTime(e===Number.MAX_VALUE?a:e),r.setDeltaTime(r.getSimulationTime()-n)},beginFrame:function(){var t=this._stats;t&&(t.getCounter("frame").start(),t.getCounter("raf").tick(),t.getCounter("fps").frame())},endFrame:function(){var t=this.getFrameStamp().getFrameNumber();this._stats&&(v.default.getTextureManager(this.getGraphicContext()).updateStats(t,this._stats),this._stats.getCounter("stats").start(),this._stats.update(),this._stats.getCounter("stats").end(),this._stats.getCounter("frame").end())},checkNeedToDoFrame:function(){return this._requestContinousUpdate||this._requestRedraw},frame:function(){if(!this._contextLost){this.beginFrame(),this.advance();var t=this.updateViewport();this._inputManager.update(),this._updateVisitor.setFrameStamp(this.getFrameStamp()),this.getManipulator()&&(this.getManipulator().update(this._updateVisitor),a.c.copy(this.getCamera().getViewMatrix(),this.getManipulator().getInverseMatrix())),(this.checkNeedToDoFrame()||t)&&(this._requestRedraw=!1,this.updateTraversal(),this.renderingTraversal()),this.endFrame(),this._hmd&&this._hmd.isPresenting&&this._hmd.submitFrame()}},setDone:function(t){this._done=t},done:function(){return this._done},render:function(){this.done()||(this._requestID=this._requestAnimationFrame(this.renderBinded,this._canvas),this.frame())},_runImplementation:function(){this.render()},run:function(){this._runImplementation()},setVRDisplay:function(t){this._hmd=t},getVRDisplay:function(){return this._hmd},setPresentVR:function(t){if(!this._hmd)return i.a.warn("no hmd device provided to the viewer!"),o.a.reject();if(!this._hmd.capabilities.canPresent)return o.a.reject();if(t){this._requestAnimationFrame=this._hmd.requestAnimationFrame.bind(this._hmd);var e=[{source:this.getGraphicContext().canvas}];return this._hmd.requestPresent(e)}return this._requestAnimationFrame=window.requestAnimationFrame.bind(window),this._hmd.exitPresent()},setupManipulator:function(t){void 0===t&&(t=new S.a({inputManager:this._inputManager})),void 0!==t.setNode?t.setNode(this.getSceneData()):t.view=this,t.setCamera(this.getCamera()),this.setManipulator(t)},updateViewport:function(){var t=this.getGraphicContext(),e=t.canvas;if(!this.computeCanvasSize(e))return!1;var r=this.getCamera(),i=r.getViewport(),n=i.width(),s=i.height(),o=e.width/n,h=e.height/s,u=o/h;return i.setViewport(Math.round(i.x()*o),Math.round(i.y()*h),Math.round(i.width()*o),Math.round(i.height()*h)),1!==u&&a.c.mul(r.getProjectionMatrix(),r.getProjectionMatrix(),a.c.fromScaling(a.c.create(),[1/u,1,1])),!0},setManipulator:function(t){this.setEnableManipulator(!1),t.getCamera()||t.setCamera(this.getCamera()),t.setEnable(!0),b.default.prototype.setManipulator.call(this,t)},setEnableManipulator:function(t){this._manipulator&&this._manipulator.setEnable(t)},dispose:function(){P.a.clean(),L.a.clean(),D.a.pooledStateGraph.clean()}}),"osgViewer","Viewer"),e.a=V},function(t,e,r){"use strict";var i=function(){function t(t){if(null==_){_={},f={};for(var e in t)"number"==typeof t[e]&&(_[t[e]]=e,f[e]=t[e])}}function e(){if(null==_)throw"WebGLDebugUtils.init(ctx) not called"}function r(t){return e(),void 0!==_[t]}function i(t){e();var r=_[t];return void 0!==r?"gl."+r:"/*UNKNOWN WebGL ENUM*/ 0x"+t.toString(16)}function a(t,e,r,a){var n=d[t];if(void 0!==n){var n=n[e];if(void 0!==n&&n[r]){if("object"==typeof n[r]&&void 0!==n[r].enumBitwiseOr){for(var s=n[r].enumBitwiseOr,o=0,h=[],u=0;u<s.length;++u){var c=f[s[u]];0!=(a&c)&&(o|=c,h.push(i(c)))}return o===a?h.join(" | "):i(a)}return i(a)}}return null===a?"null":void 0===a?"undefined":a.toString()}function n(t,e){for(var r="",i=e.length,n=0;n<i;++n)r+=(0==n?"":", ")+a(t,i,n,e[n]);return r}function s(t,e,r){t.__defineGetter__(r,function(){return e[r]}),t.__defineSetter__(r,function(t){e[r]=t})}function o(e,r,n,h){function u(t,e){return function(){n&&n(e,arguments);var i=t[e].apply(t,arguments),a=h.getError();return 0!=a&&(c[a]=!0,r(a,e,arguments)),i}}h=h||e,t(e),r=r||function(t,e,r){for(var n="",s=r.length,o=0;o<s;++o)n+=(0==o?"":", ")+a(e,s,o,r[o]);l("WebGL error "+i(t)+" in "+e+"("+n+")")};var c={},d={};for(var _ in e)if("function"==typeof e[_])if("getExtension"!=_)d[_]=u(e,_);else{var f=u(e,_);d[_]=function(){var t=f.apply(e,arguments);return t?o(t,r,n,h):null}}else s(d,e,_);return d.getError=function(){for(var t in c)if(c.hasOwnProperty(t)&&c[t])return c[t]=!1,t;return e.NO_ERROR},d}function h(t){var e=!!t.createTransformFeedback;e&&t.bindVertexArray(null);var r=t.getParameter(t.MAX_VERTEX_ATTRIBS),i=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,i);for(var a=0;a<r;++a)t.disableVertexAttribArray(a),t.vertexAttribPointer(a,4,t.FLOAT,!1,0,0),t.vertexAttrib1f(a,0),e&&t.vertexAttribDivisor(a,0);t.deleteBuffer(i);for(var n=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),a=0;a<n;++a)t.activeTexture(t.TEXTURE0+a),t.bindTexture(t.TEXTURE_CUBE_MAP,null),t.bindTexture(t.TEXTURE_2D,null),e&&(t.bindTexture(t.TEXTURE_2D_ARRAY,null),t.bindTexture(t.TEXTURE_3D,null),t.bindSampler(a,null));if(t.activeTexture(t.TEXTURE0),t.useProgram(null),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindRenderbuffer(t.RENDERBUFFER,null),t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.DITHER),t.disable(t.SCISSOR_TEST),t.blendColor(0,0,0,0),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.clearColor(0,0,0,0),t.clearDepth(1),t.clearStencil(-1),t.colorMask(!0,!0,!0,!0),t.cullFace(t.BACK),t.depthFunc(t.LESS),t.depthMask(!0),t.depthRange(0,1),t.frontFace(t.CCW),t.hint(t.GENERATE_MIPMAP_HINT,t.DONT_CARE),t.lineWidth(1),t.pixelStorei(t.PACK_ALIGNMENT,4),t.pixelStorei(t.UNPACK_ALIGNMENT,4),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.UNPACK_COLORSPACE_CONVERSION_WEBGL&&t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.BROWSER_DEFAULT_WEBGL),t.polygonOffset(0,0),t.sampleCoverage(1,!1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilMask(4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.viewport(0,0,t.canvas.width,t.canvas.height),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT),e){t.drawBuffers([t.BACK]),t.readBuffer(t.BACK),t.bindBuffer(t.COPY_READ_BUFFER,null),t.bindBuffer(t.COPY_WRITE_BUFFER,null),t.bindBuffer(t.PIXEL_PACK_BUFFER,null),t.bindBuffer(t.PIXEL_UNPACK_BUFFER,null);for(var s=t.getParameter(t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS),a=0;a<s;++a)t.bindBufferBase(t.TRANSFORM_FEEDBACK_BUFFER,a,null);for(var o=t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS),a=0;a<o;++a)t.bindBufferBase(t.UNIFORM_BUFFER,a,null);t.disable(t.RASTERIZER_DISCARD),t.pixelStorei(t.UNPACK_IMAGE_HEIGHT,0),t.pixelStorei(t.UNPACK_SKIP_IMAGES,0),t.pixelStorei(t.UNPACK_ROW_LENGTH,0),t.pixelStorei(t.UNPACK_SKIP_ROWS,0),t.pixelStorei(t.UNPACK_SKIP_PIXELS,0),t.pixelStorei(t.PACK_ROW_LENGTH,0),t.pixelStorei(t.PACK_SKIP_ROWS,0),t.pixelStorei(t.PACK_SKIP_PIXELS,0),t.hint(t.FRAGMENT_SHADER_DERIVATIVE_HINT,t.DONT_CARE)}for(;t.getError(););}function u(t){function e(t){return"function"==typeof t?t:function(e){t.handleEvent(e)}}function r(){for(var t=Object.keys(y),e=0;e<t.length;++e)delete y[t[e]]}function i(){++S,p||v==S&&t.loseContext()}function a(t,e){var r=t[e];return function(){if(i(),!p){return r.apply(t,arguments)}}}function n(){for(var t=0;t<m.length;++t){var e=m[t];e instanceof WebGLBuffer?c.deleteBuffer(e):e instanceof WebGLFramebuffer?c.deleteFramebuffer(e):e instanceof WebGLProgram?c.deleteProgram(e):e instanceof WebGLRenderbuffer?c.deleteRenderbuffer(e):e instanceof WebGLShader?c.deleteShader(e):e instanceof WebGLTexture?c.deleteTexture(e):d&&(e instanceof WebGLQuery?c.deleteQuery(e):e instanceof WebGLSampler?c.deleteSampler(e):e instanceof WebGLSync?c.deleteSync(e):e instanceof WebGLTransformFeedback?c.deleteTransformFeedback(e):e instanceof WebGLVertexArrayObject&&c.deleteVertexArray(e))}}function o(t){return{statusMessage:t,preventDefault:function(){b=!0}}}function u(t){for(var e in t)"function"==typeof t[e]?l[e]=a(t,e):s(l,t,e);l.getError=function(){if(i(),!p)for(var t;t=c.getError();)y[t]=!0;for(var t in y)if(y[t])return delete y[t],t;return l.NO_ERROR};var r=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"];d&&r.push("createQuery","createSampler","fenceSync","createTransformFeedback","createVertexArray");for(var n=0;n<r.length;++n){var o=r[n];l[o]=function(e){return function(){if(i(),p)return null;var r=e.apply(t,arguments);return r.__webglDebugContextLostId__=g,m.push(r),r}}(t[o])}var h=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];d&&h.push("getInternalformatParameter","getQuery","getQueryParameter","getSamplerParameter","getSyncParameter","getTransformFeedbackVarying","getIndexedParameter","getUniformIndices","getActiveUniforms","getActiveUniformBlockParameter","getActiveUniformBlockName");for(var n=0;n<h.length;++n){var o=h[n];l[o]=function(e){return function(){return i(),p?null:e.apply(t,arguments)}}(l[o])}var u=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];d&&u.push("isQuery","isSampler","isSync","isTransformFeedback","isVertexArray");for(var n=0;n<u.length;++n){var o=u[n];l[o]=function(e){return function(){return i(),!p&&e.apply(t,arguments)}}(l[o])}return l.checkFramebufferStatus=function(e){return function(){return i(),p?l.FRAMEBUFFER_UNSUPPORTED:e.apply(t,arguments)}}(l.checkFramebufferStatus),l.getAttribLocation=function(e){return function(){return i(),p?-1:e.apply(t,arguments)}}(l.getAttribLocation),l.getVertexAttribOffset=function(e){return function(){return i(),p?0:e.apply(t,arguments)}}(l.getVertexAttribOffset),l.isContextLost=function(){return p},d&&(l.getFragDataLocation=function(e){return function(){return i(),p?-1:e.apply(t,arguments)}}(l.getFragDataLocation),l.clientWaitSync=function(e){return function(){return i(),p?l.WAIT_FAILED:e.apply(t,arguments)}}(l.clientWaitSync),l.getUniformBlockIndex=function(e){return function(){return i(),p?l.INVALID_INDEX:e.apply(t,arguments)}}(l.getUniformBlockIndex)),l}var c,l,d,_=[],f=[],l={},g=1,p=!1,m=[],v=0,S=0,b=!1,x=0,y={};t.getContext=function(e){return function(){var r=e.apply(t,arguments);if(r instanceof WebGLRenderingContext||window.WebGL2RenderingContext&&r instanceof WebGL2RenderingContext){if(r!=c){if(c)throw"got different context";d=window.WebGL2RenderingContext&&r instanceof WebGL2RenderingContext,c=r,l=u(c)}return l}return r}}(t.getContext);var M=function(t){_.push(e(t))},T=function(t){f.push(e(t))};return function(t){var e=t.addEventListener;t.addEventListener=function(r,i,a){switch(r){case"webglcontextlost":M(i);break;case"webglcontextrestored":T(i);break;default:e.apply(t,arguments)}}}(t),t.loseContext=function(){if(!p){for(p=!0,v=0,++g;c.getError(););r(),y[c.CONTEXT_LOST_WEBGL]=!0;var e=o("context lost"),i=_.slice();setTimeout(function(){for(var r=0;r<i.length;++r)i[r](e);x>=0&&setTimeout(function(){t.restoreContext()},x)},0)}},t.restoreContext=function(){p&&f.length&&setTimeout(function(){if(!b)throw"can not restore. webglcontestlost listener did not call event.preventDefault";n(),h(c),p=!1,S=0,b=!1;for(var t=f.slice(),e=o("context restored"),r=0;r<t.length;++r)t[r](e)},0)},t.loseContextInNCalls=function(t){if(p)throw"You can not ask a lost contet to be lost";v=S+t},t.getNumCalls=function(){return S},t.setRestoreTimeout=function(t){x=t},t}var c=function(t){window.console&&window.console.log&&window.console.log(t)},l=function(t){window.console&&window.console.error?window.console.error(t):c(t)},d={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},bindBuffer:{2:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}},bufferData:{3:{0:!0,2:!0},4:{0:!0,2:!0},5:{0:!0,2:!0}},bufferSubData:{3:{0:!0},4:{0:!0},5:{0:!0}},copyBufferSubData:{5:{0:!0,1:!0}},getBufferSubData:{3:{0:!0},4:{0:!0},5:{0:!0}},blitFramebuffer:{10:{8:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]},9:!0}},framebufferTextureLayer:{5:{0:!0,1:!0}},invalidateFramebuffer:{2:{0:!0}},invalidateSubFramebuffer:{6:{0:!0}},readBuffer:{1:{0:!0}},getInternalformatParameter:{3:{0:!0,1:!0,2:!0}},renderbufferStorageMultisample:{5:{0:!0,2:!0}},texStorage2D:{5:{0:!0,2:!0}},texStorage3D:{6:{0:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0},10:{0:!0,2:!0,6:!0,7:!0}},texImage3D:{10:{0:!0,2:!0,7:!0,8:!0},11:{0:!0,2:!0,7:!0,8:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0},10:{0:!0,6:!0,7:!0}},texSubImage3D:{11:{0:!0,8:!0,9:!0},12:{0:!0,8:!0,9:!0}},copyTexSubImage3D:{9:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0},8:{0:!0,2:!0},9:{0:!0,2:!0}},compressedTexImage3D:{8:{0:!0,2:!0},9:{0:!0,2:!0},10:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0},9:{0:!0,6:!0},10:{0:!0,6:!0}},compressedTexSubImage3D:{10:{0:!0,8:!0},11:{0:!0,8:!0},12:{0:!0,8:!0}},vertexAttribIPointer:{5:{2:!0}},drawArraysInstanced:{4:{0:!0}},drawElementsInstanced:{5:{0:!0,2:!0}},drawRangeElements:{6:{0:!0,4:!0}},readPixels:{7:{4:!0,5:!0},8:{4:!0,5:!0}},clearBufferfv:{3:{0:!0},4:{0:!0}},clearBufferiv:{3:{0:!0},4:{0:!0}},clearBufferuiv:{3:{0:!0},4:{0:!0}},clearBufferfi:{4:{0:!0}},beginQuery:{2:{0:!0}},endQuery:{1:{0:!0}},getQuery:{2:{0:!0,1:!0}},getQueryParameter:{2:{1:!0}},samplerParameteri:{3:{1:!0,2:!0}},samplerParameterf:{3:{1:!0}},getSamplerParameter:{2:{1:!0}},fenceSync:{2:{0:!0,1:{enumBitwiseOr:[]}}},clientWaitSync:{3:{1:{enumBitwiseOr:["SYNC_FLUSH_COMMANDS_BIT"]}}},waitSync:{3:{1:{enumBitwiseOr:[]}}},getSyncParameter:{2:{1:!0}},bindTransformFeedback:{2:{0:!0}},beginTransformFeedback:{1:{0:!0}},transformFeedbackVaryings:{3:{2:!0}},bindBufferBase:{3:{0:!0}},bindBufferRange:{5:{0:!0}},getIndexedParameter:{2:{0:!0}},getActiveUniforms:{3:{2:!0}},getActiveUniformBlockParameter:{3:{2:!0}}},_=null,f=null;return{init:t,mightBeEnum:r,glEnumToString:i,glFunctionArgToString:a,glFunctionArgsToString:n,makeDebugContext:o,makeLostContextSimulatingCanvas:u,resetToInitialState:h}}();e.a=i},function(t,e,r){"use strict";var i=r(2),a=["shift","alt","ctrl","meta"],n=function(t,e){this._enabled=!0,this._name=e,this._mask=[],this._events={},this._mappings={},this._inputManager=t,this._boundCallback=this._collectNativeEvents.bind(this),this._priority=10,this._hasSources=!1};n.prototype={addMappings:function(t,e){for(var r in t)t[this._name+":"+r]=t[r],delete t[r];this._inputManager.addMappings(t,e)},_collectNativeEvents:function(t){if(this._enabled&&!this._mask.length){var e=this._mappings[t.type];if(e)for(var r=0;r<e.length;r++){var i=e[r];if(!i._source.isEventRegistered||i._source.isEventRegistered(t,i._parsedEvent)){if(i._source.populateEvent(t,i),i._nativeEvents||(i._nativeEvents=[]),!i._nativeEvents.length){var a=this._inputManager._queues[i._priority];a||(a=[],this._inputManager._queues[i._priority]=a),a.push(i)}i._nativeEvents.push(t)}}}},_addEvent:function(t,e){var r,i=this._name+":"+e,a=!1,n=this._mappings[t.name];n?r=this._findEvent(n,i,t.raw):(n=[],this._mappings[t.name]=n,a=!0);var s=this._events[e];s||(s=[],this._events[e]=s),r||(r=new Event(i),n.push(r),s.push(r)),r._parsedEvent=t,r._priority=10;var o=this._inputManager._getSource(t.name);o&&(this._enabled&&a&&o.setEnable(t.name,this._boundCallback,!0),this._hasSources=!0,r._source=o)},_findEvent:function(t,e,r){for(var i=0;i<t.length;i++){var a=t[i];if(a.type===e&&a._parsedEvent.raw===r)return a}},_setEnable:function(t){this._enabled=t;for(var e in this._mappings){var r=this._mappings[e],i=r[0];i._source&&i._source.setEnable(e,this._boundCallback,t)}}};var s=function(){this._groups={},this._sources=[],this._queues=[],this._queues[10]=[],this._callbacks={},this._params={},this._maskedGroups=[],window.dumpInputGroups=this._dumpInputGroups.bind(this),window.dumpEventSequence=this._dumpEventSequence.bind(this)};s.prototype={registerInputSource:function(t){if(!t.setEnable||!t.supportsEvent||!t.getName)throw"Invalid input target "+JSON.stringify(t);this._sources.push(t),t.setInputManager(this)},getInputSource:function(t){for(var e=0;e<this._sources.length;e++){var r=this._sources[e];if(r.getName()===t)return r}},addMappings:function(t,e){for(var r in t){var i=t[r],a=r.split(":");if(2!==a.length)throw"Mapping should be of the form 'group:methodName': ['nativeevent1’, 'nativeevent2',...] ";var n,s=this._getOrCreateGroup(a[0]),o=a[1];if(e)if("object"==typeof e){if(!(n=e[o])||"function"!=typeof n)throw"Cannot find method "+o+" on "+e;n=n.bind(e)}else{if("function"!=typeof e)throw"Invalid listener "+e;n=e}var h;if("string"==typeof i)h=this._parseNativeEvent(i),s._addEvent(h,o);else for(var u=0;u<i.length;u++){var c=i[u];h=this._parseNativeEvent(c),s._addEvent(h,o)}this._callbacks[s._name+":"+o]=n}},group:function(t){return this._getOrCreateGroup(t)},setEnable:function(t,e){var r=this._groups[t];r&&r._setEnable(e);var i;for(var a in this._groups)r=this._groups[a],e?(i=r._mask.indexOf(t))>=0&&(r._mask.splice(i,1),this._maskedGroups.splice(this._maskedGroups.indexOf(t),1)):0===(i=r._name.indexOf(t))&&"."===r._name[i+t.length]&&(r._mask.push(t),this._maskedGroups.push(t));if(!e)for(var n=0;n<this._queues.length;n++){var s=this._queues[n];if(s)for(var o=s.length-1;o>=0;o--){var h=s[o];h.type.indexOf(t)>=0&&(s.splice(o,1),h._nativeEvents.length=0)}}},setPriority:function(t,e){var r=t.split(":");if(e<0)throw"priority must be a positive number";var i,a,n,s=this._groups[r[0]];if(s&&r[1]){for(a=s._events[r[1]],n=0;n<a.length;n++)i=a[n],i._priority=e;s._priority>e&&(s._priority=e)}else for(var o in this._groups)if(s=this._groups[o],s._name.indexOf(t)>=0)for(var h in s._events)for(a=s._events[h],n=0;n<a.length;n++)i=a[n],i._priority=e},getHigherPriority:function(t){var e=10;for(var r in this._groups){var i=this._groups[r];i._name.indexOf(t)>=0&&i._priority<e&&(e=i._priority)}return e>0?e-1:0},getParam:function(t){return this._params[t]},setParam:function(t,e){this._params[t]=e},cleanup:function(){for(var t in this._groups){this._groups[t]._setEnable(!1)}},_parseNativeEvent:function(t){var e=t.split(" "),r={};r.name=e[0];var i;for(i=1;i<e.length;i++){var n=e[i],s=!0;0===n.indexOf("!")&&(s=!1,n=n.substring(1,n.length)),a.indexOf(n)>=0?r[n]=s:r.action=n.toLowerCase()}if(r.action)for(i=0;i<a.length;i++){var o=a[i];0===r.action.indexOf(o)&&(r[o]=!0)}return 0===r.name.indexOf("key")&&!r.action&&e.length>1&&(r.action=e[e.length-1]),r.raw=t,r},_getOrCreateGroup:function(t){var e=this._groups[t];if(!e){e=new n(this,t),this._groups[t]=e;for(var r=0;r<this._maskedGroups.length;r++){var i=this._maskedGroups[r];0===t.indexOf(i)&&e._mask.push(i)}}return e},update:function(){var t;for(t=0;t<this._sources.length;t++){var e=this._sources[t];e.poll&&e.poll()}for(t=0;t<this._queues.length;t++){var r=this._queues[t];if(r){for(var i=0;i<r.length;i++){var a=r[i];this._callbacks[a.type](a),a._nativeEvents.length=0}r.length=0}}},_getSource:function(t){for(var e=0;e<this._sources.length;e++){var r=this._sources[e];if(r.supportsEvent(t))return r}},_dumpInputGroups:function(t,e){!0===t&&(e=t,t=void 0);for(var r in this._groups)if(!(t&&r.indexOf(t)<0)){var a=this._groups[r],n=a._enabled&&!a._mask.length&&a._hasSources;if(!e||n){i.a.groupCollapsed("%c"+r+(n?" (enabled)":" (disabled)"),n?"":"color: #888888"),i.a.log("enabled:",a._enabled),i.a.log("masks:",a._mask),i.a.log("input sources:",a._hasSources),i.a.group("events");for(var s in a._events){i.a.groupCollapsed(s);for(var o=a._events[s],h=0;h<o.length;h++){var u=o[h],c="%c"+u._parsedEvent.raw+" ("+(u._source?u._source.getName():"unknown source")+")",l=u._source?"":"color: #888888";i.a.log(c,l)}i.a.groupCollapsed("function"),i.a.log(this._callbacks[a._name+":"+s]),i.a.groupEnd(),i.a.groupEnd()}i.a.groupEnd(),i.a.groupEnd()}}},_dumpEventSequence:function(t,e){var r=[];!0===t&&(e=t,t=void 0);var a;for(var n in this._groups){var s=this._groups[n];if(a=s._enabled&&!s._mask.length&&s._hasSources,!e||a)for(var o in s._events){var h=s._events[o],u=r[h[0]._priority];u||(u=[],r[h[0]._priority]=u);for(var c=0;c<h.length;c++){var l=h[c];(!t||t&&l._parsedEvent.raw.indexOf(t)>=0)&&u.push({name:l.type,group:s._name,on:l._parsedEvent.raw,enabled:s._enabled&&!s._mask.length&&!!l._source,source:l._source?"("+l._source.getName()+")":"(unknown source)"})}}}for(var d=0;d<r.length;d++){var _=r[d];if(_){i.a.group("priority "+d);for(var f,g=0;g<_.length;g++){var p=_[g];if(0!==g&&f!==p.name&&i.a.groupEnd(),f!==p.name){var m=this._groups[p.group];a=m._enabled&&!m._mask.length&&m._hasSources,i.a.groupCollapsed("%c"+p.name,a?"":"color:#888888")}f=p.name,i.a.groupCollapsed("%c"+p.on+" "+p.source,p.enabled?"":"color:#888888"),i.a.log(this._callbacks[p.name]),i.a.groupEnd()}i.a.groupEnd(),i.a.groupEnd()}}}},e.a=s},function(t,e,r){"use strict";var i=r(0),a=r(47),n=r(1),s=0===navigator.platform.indexOf("Mac")?-1:-3,o=function(t,e){a.a.call(this,t),this._defaultRatio=n.e.fromValues(1,1),this._supportedEvents=["click","contextmenu","dblclick","mousedown","mouseenter","mouseleave","mousemove","mouseover","mouseout","mouseup"],e&&!1===e.scrollwheel||this._supportedEvents.push("wheel")};i.a.createPrototypeObject(o,i.a.objectInherit(a.a.prototype,{getName:function(){return"Mouse"},setEnable:function(t,e,r){r?this._target.addEventListener(t,e):this._target.removeEventListener(t,e)},populateEvent:function(t,e){e.canvasX=void 0===t.offsetX?t.layerX:t.offsetX,e.canvasY=void 0===t.offsetY?t.layerY:t.offsetY;var r=this._inputManager.getParam("pixelRatio");r||(r=this._defaultRatio),e.glX=e.canvasX*r[0],e.glY=(this._target.clientHeight-e.canvasY)*r[1],e.clientX=t.clientX,e.clientY=t.clientY,e.screenX=t.screenX,e.screenX=t.screenX,e.pageX=t.pageX,e.pageY=t.pageY,e.ctrlKey=t.ctrlKey,e.shiftKey=t.shiftKey,e.altKey=t.altKey,e.metaKey=t.metaKey,e.button=t.button,e.buttons=t.buttons,"wheel"===t.type&&(void 0!==t.wheelDelta?e.deltaY=t.wheelDelta/120:1===t.deltaMode?e.deltaY=t.deltaY/s:e.deltaY=t.deltaY/(10*s),e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaZ=t.deltaZ)},isEventRegistered:function(t,e){return t.preventDefault(),(!e.action||t.button===parseInt(e.action))&&((void 0===e.ctrl||t.ctrlKey===e.ctrl)&&((void 0===e.shift||t.shiftKey===e.shift)&&((void 0===e.alt||t.altKey===e.alt)&&(void 0===e.meta||t.metaKey===e.meta))))}}),"osgViewer","InputSourceMouse"),e.a=o},function(t,e,r){"use strict";var i=r(0),a=r(47),n=function(t){a.a.call(this,t),this._supportedEvents=["keydown","keyup","keypress"]};i.a.createPrototypeObject(n,i.a.objectInherit(a.a.prototype,{getName:function(){return"Keyboard"},setEnable:function(t,e,r){r?this._target.addEventListener(t,e):this._target.removeEventListener(t,e)},populateEvent:function(t,e){e.key=t.key,e.keyCode=t.keyCode,e.code=t.code,e.location=t.location,e.repeat=t.repeat,e.ctrlKey=t.ctrlKey,e.shiftKey=t.shiftKey,e.altKey=t.altKey,e.metaKey=t.metaKey},isEventRegistered:function(t,e){return!e.action||(!t.key||t.key.toLowerCase()===e.action||t.code.toLowerCase()===e.action)&&((void 0===e.ctrl||t.ctrlKey===e.ctrl)&&((void 0===e.shift||t.shiftKey===e.shift)&&((void 0===e.alt||t.altKey===e.alt)&&(void 0===e.meta||t.metaKey===e.meta))))}}),"osgViewer","InputSourceKeyboard"),e.a=n},function(t,e,r){"use strict";var i=r(0),a=r(47),n=r(2),s=function(t,e){a.a.call(this),this._supportedEvents=["vrdisplayposechanged","vrdisplayconnected","vrdisplaynotfound","vrdisplaydisconnected"],this._callbacks={},this._events={};for(var r=0;r<this._supportedEvents.length;r++){var i=this._supportedEvents[r],n=new Event(i);this._events[i]=n}this._nbCallbacks=0,this._pollInterval=e&&void 0!==e.pollInterval?e.pollInterval:3e3};i.a.createPrototypeObject(s,i.a.objectInherit(a.a.prototype,{getName:function(){return"WebVR"},setEnable:function(t,e,r){var i=this._callbacks[t];i||(i=[],this._callbacks[t]=i);var a=i.indexOf(e);r?a<0&&(i.push(e),this._nbCallbacks++,this._schedulePolling()):a>=0&&(i.splice(a,1),--this._nbCallbacks||this._cancelPolling())},populateEvent:function(t,e){if(t.vrDisplay)return void(e.vrDisplay=t.vrDisplay);e.pose=t.pose,e.sitToStandMatrix=t.sitToStandMatrix,e.worldFactor=this._inputManager.getParam("worldFactor"),e.worldFactor||(e.worldFactor=1)},_schedulePolling:function(){this._pollInterval>0&&void 0===this._pollingTimeout&&(this._pollingTimeout=setInterval(this.pollHeadset.bind(this),this._pollInterval))},_cancelPolling:function(){void 0!==this._pollingTimeout&&clearInterval(this._pollingTimeout)},pollHeadset:function(){if(!navigator.getVRDisplays)return this._hmd=void 0,this._frameData=void 0,void this.triggerNotFoundEvent();var t=this;navigator.getVRDisplays().then(function(e){if(0===e.length)return void this.triggerNotFoundEvent();if(t._hmd!==e[0]){n.a.log("Found a VR display");var r=t._events.vrdisplaydisconnected;r.vrDisplay=t._hmd,this._dispatchEvent(r,t._callbacks.vrdisplaydisconnected),r=t._events.vrdisplayconnected,r.vrDisplay=e[0],this._dispatchEvent(r,t._callbacks.vrdisplayconnected),t._hmd=e[0],t._frameData=new window.VRFrameData}}.bind(this)).catch(function(t){this._hmd=void 0,this._frameData=void 0,this.triggerNotFoundEvent(),n.a.warn(t.message)})},triggerNotFoundEvent:function(){if(!(this._pollInterval>0)){var t=this._events.vrdisplaynotfound;this._dispatchEvent(t,this._callbacks.vrdisplaynotfound)}},setPollInterval:function(t){this._pollInterval=t},_dispatchEvent:function(t,e){if(e)for(var r=0;r<e.length;r++){var i=e[r];i(t)}},poll:function(){if(this._hmd){var t=this._callbacks.vrdisplayposechanged;if(t&&t.length){this._hmd.getFrameData(this._frameData);var e=this._frameData.pose;if(e){var r=this._hmd.stageParameters&&this._hmd.stageParameters.sittingToStandingTransform,i=this._events.vrdisplayposechanged;i.pose=e,i.sitToStandMatrix=r,this._dispatchEvent(i,t)}}}}}),"osgViewer","InputSourceWebVR"),e.a=s},function(t,e,r){"use strict";var i=r(0),a=r(47),n=function(){a.a.call(this),this._target=window,this._supportedEvents=["buttondown","buttonup","buttonvalue","axis","gamepadconnected","gamepaddisconnected"],this._callbacks={},this._nbCallbacks=0,this._gamePadState=[],this._valueThreshold=.05,window.addEventListener("gamepadconnected",function(t){this._newGamePad(t.gamepad),this._onConnectionStateChange(t,"gamepadconnected")}.bind(this)),window.addEventListener("gamepaddisconnected",function(t){this._previousState[t.gamepad.index]=void 0,this._onConnectionStateChange(t,"gamepaddisconnected")}.bind(this))};i.a.createPrototypeObject(n,i.a.objectInherit(a.a.prototype,{getName:function(){return"GamePad"},setEnable:function(t,e,r){var i=this._callbacks[t];i||(i=[],this._callbacks[t]=i);var a=i.indexOf(e);r?a<0&&(i.push(e),this._nbCallbacks++):a>=0&&(i.splice(a,1),this._nbCallbacks--)},_onConnectionStateChange:function(t,e){var r=this._callbacks[e];r&&r(t)},_newGamePad:function(t){var e={buttons:[]};e._buttonEvents=[],e._axisEvents=[];var r;for(r=0;r<t.buttons.length;r++)e._buttonEvents[r]={buttondown:this._initEvent("buttondown",r,t.index,"button"),buttonup:this._initEvent("buttonup",r,t.index,"button"),buttonvalue:this._initEvent("buttonvalue",r,t.index,"button")};for(r=0;r<t.axes.length;r++)e._axisEvents[r]={axis:this._initEvent("axis",r,t.index,"axis")};this._gamePadState[t.index]=e},setValueThreshold:function(t){this._valueThreshold=t},_initEvent:function(t,e,r,i){var a=new Event(t);return a[i]=e,a.gamepadIndex=r,a},populateEvent:function(t,e){e.gamepadIndex=t.gamepadIndex,void 0!==t.button&&(e.button=t.button,e.value=t.value),void 0!==t.axis&&(e.axis=t.axis,e.value=t.value)},isEventRegistered:function(t,e){if(!e.action)return!0;var r=parseInt(e.action);return(void 0===t.button||t.button===r)&&(void 0===t.axis||t.axis===r)},_fireCallbacks:function(t,e){for(var r=0;r<t.length;r++)t[r](e)},poll:function(){if(this._nbCallbacks){var t=navigator.getGamepads();if(t)for(var e=0;e<t.length;e++){var r=t[e];if(r){var i=this._gamePadState[e];if(i){var a=this._callbacks.buttondown,n=this._callbacks.buttonup,s=this._callbacks.buttonvalue;if(a||n||s)for(var o=0;o<r.buttons.length;o++){var h=r.buttons[o],u=i._buttonEvents[o].buttondown;u.value=h.value;var c=i._buttonEvents[o].buttonup;if(c.value=h.value,h.pressed&&!i.buttons[o]&&(a&&a.length&&this._fireCallbacks(a,u),i.buttons[o]=h.pressed),!h.pressed&&i.buttons[o]&&(n&&n.length&&this._fireCallbacks(n,c),i.buttons[o]=!1),h.pressed&&s&&s.length){var l=i._buttonEvents[o].buttonvalue;l.value=h.value,Math.abs(h.value)>=this._valueThreshold&&this._fireCallbacks(s,l)}}var d=this._callbacks.axis;if(d)for(o=0;o<r.axes.length;o++){var _=r.axes[o],f=i._axisEvents[o].axis;f.value=_,Math.abs(_)>=this._valueThreshold&&this._fireCallbacks(d,f)}}}}}}}),"osgViewer","InputSourceGamePad"),e.a=n},function(t,e,r){"use strict";var i=r(0),a=r(47),n=function(){a.a.call(this),this._target=window,this._callbacks=[],this._nbCallbacks=0,this._event=new Event("deviceorientation"),this._supportedEvents=["deviceorientation","orientationchange"],this._update=this.onDeviceOrientation.bind(this)};i.a.createPrototypeObject(n,i.a.objectInherit(a.a.prototype,{getName:function(){return"DeviceOrientation"},setEnable:function(t,e,r){if("orientationchange"===t)return void(r?this._target.addEventListener(t,e):this._target.removeEventListener(t,e));var i=this._callbacks,a=i.indexOf(e);r?a<0&&(i.push(e),this._nbCallbacks++):a>=0&&(i.splice(a,1),this._nbCallbacks--),1===this._nbCallbacks&&window.addEventListener(t,this._update),0===this._nbCallbacks&&window.removeEventListener(t,this._update)},onDeviceOrientation:function(t){this.populateEvent(t,this._event)},populateEvent:function(t,e){e.absolute=t.absolute,e.alpha=t.alpha,e.beta=t.beta,e.gamma=t.gamma,e.screenOrientation=window.orientation},isEventRegistered:function(t){if("deviceorientation"===t.type){if(null===t.alpha||void 0===t.alpha)return!1}else if(null===window.orientation||void 0===window.orientation)return!1;return!0},poll:function(){if(this._nbCallbacks)for(var t=0;t<this._callbacks.length;t++)this._callbacks[t](this._event)}}),"osgViewer","InputSourceDeviceOrientation"),e.a=n},function(t,e,r){"use strict";var i=r(0),a=r(47),n=r(139),s=r.n(n),o=r(1),h=function(t){a.a.call(this,t),this._defaultRatio=o.e.fromValues(1,1),this._hammerEvents=["pan","pinch","press","rotate","swipe","doubletap","doubletap2fingers","singletap"],this._supportedEvents=["touchstart","touchend","touchcancel","touchmove"],this._hammer=new s.a.Manager(t),this._hammer.add(new s.a.Pan),this._hammer.add(new s.a.Pinch),this._hammer.get("pan").set({threshold:0,pointers:0});var e=this._hammer.get("pinch");e.set({threshold:.1,enable:!1}),e.recognizeWith(this._hammer.get("pan")),this._hammer.add(new s.a.Tap({event:"doubletap",pointers:1,taps:2,time:250,interval:450,threshold:5,posThreshold:50})),this._hammer.add(new s.a.Tap({event:"doubletap2fingers",pointers:2,taps:2,time:250,interval:450,threshold:5,posThreshold:50})),this._hammer.add(new s.a.Tap({event:"singletap",pointers:1,taps:1,time:250,interval:450,threshold:5,posThreshold:20}))};i.a.createPrototypeObject(h,i.a.objectInherit(a.a.prototype,{getName:function(){return"TouchScreen"},setEnable:function(t,e,r){this._isNativeEvent(t)?r?this._target.addEventListener(t,e):this._target.removeEventListener(t,e):(t.indexOf("pinch")>=0&&r&&this._hammer.get("pinch").set({enable:!0}),r?this._hammer.on(t,e):this._hammer.off(t,e))},populateEvent:function(t,e){if(this._isNativeEvent(t.type)){e.canvasX=e.canvasY=0;for(var r=t.touches.length?t.touches:t.changedTouches,i=r.length,a=0;a<i;++a)e.canvasX+=r[a].clientX/i,e.canvasY+=r[a].clientY/i;e.ctrlKey=t.ctrlKey,e.shiftKey=t.shiftKey,e.altKey=t.altKey,e.metaKey=t.metaKey,e.pointers=t.touches}else e.canvasX=t.center.x,e.canvasY=t.center.y,e.scale=t.scale,e.rotation=t.rotation,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaTime=t.deltaTime,e.direction=t.direction,e.offsetDirection=t.offsetDirection,e.pointers=t.pointers,e.velocity=t.velocity;var n=this._target.getBoundingClientRect();e.canvasX+=-n.left,e.canvasY+=-n.top;var s=this._inputManager.getParam("pixelRatio");s||(s=this._defaultRatio),e.glX=e.canvasX*s[0],e.glY=(this._target.clientHeight-e.canvasY)*s[1]},_isNativeEvent:function(t){return this._supportedEvents.indexOf(t)>=0},isEventRegistered:function(t,e){if(t.preventDefault(),t.pointerType&&"touch"!==t.pointerType)return!1;if(!e.action)return!0;if(isNaN(e.action))throw"touch action should be a number representing the number of touches";var r=t.pointers;r||(r=t.touches);var i=parseInt(e.action);if("touchend"===t.type||"touchcancel"===t.type){if(r.length>=i)return!1}else if(r.length!==i)return!1;return!0},supportsEvent:function(t){var e=a.a.prototype.supportsEvent.call(this,t);if(e)return e;for(var r=0;r<this._hammerEvents.length;r++){var i=this._hammerEvents[r];if(0===t.indexOf(i))return!0}return!1},getHammer:function(){return this._hammer}}),"osgViewer","InputSourceTouchScreen"),e.a=h},function(t,e,r){"use strict";var i=r(169),a=r(157),n=r(156),s=r(170),o=r(252),h=r(171),u=r(253),c=r(172),l=r(254),d=r(99),_=r(100),f=r(173),g=r(255),p={};p.ShadowCastAttribute=i.a,p.ShadowCastCompiler=a.a,p.ShadowReceiveAttribute=c.a,p.ShadowCasterVisitor=s.a,p.ShadowFrustumIntersection=o.a,p.ShadowMap=h.a,p.ShadowMapAtlas=u.a,p.ShadowedScene=g.a,p.ShadowSettings=l.a,p.ShadowCastShaderGenerator=n.a,p.ShadowTechnique=d.a,p.ShadowTexture=_.a,p.ShadowTextureAtlas=f.a,e.a=p},function(t,e,r){"use strict";var i=r(24),a=r(40),n=r(15),s=r(11),o=r(54),h=r(1),u=r(25),c=r(19),l=r(16),d=r(3),_=r(43),f=r(0),g=function(){d.a.call(this,d.a.TRAVERSE_ALL_CHILDREN),this._pooledMatrix=new u.a(h.c.create),this._matrixStack=new c.a,this._matrixStack.push(h.c.IDENTITY),this._bb=new i.a,this._bs=new a.a};f.a.createPrototypeObject(g,f.a.objectInherit(d.a.prototype,{reset:function(t,e,r,i,a){this.setTraversalMask(t),this._cameraFrustum=r,this._lightFrustum=a,this.getCameraPlaneMaskForLightNear(e,r,i?6:4),this._pooledMatrix.reset(),this._matrixStack.reset(),this._matrixStack.push(h.c.IDENTITY),this._bb.init()},getBoundingBox:function(){return this._bb},getCameraPlaneMaskForLightNear:function(t,e,r){var i,a=1,n=15;for(i=0;i<r;++i)n=n<<1|1;var s=e.getPlanes();for(i=0;i<r;++i)_.a.distanceToPlane(s[i],t)<0&&(n^=a),a<<=1;return this._cameraPlaneMaskedByLightNear=n,e.setResultMask(n),e.pushCurrentMask(n),n},applyTransform:function(t){var e=this._pooledMatrix.getOrCreateObject();h.c.copy(e,this._matrixStack.back()),t.computeLocalToWorldMatrix(e,this);var r=this._bs;t.getBound().transformMat4(this._bs,e),(0===this._cameraFrustum.getCurrentMask()||this._cameraFrustum.containsBoundingSphere(r))&&(0===this._lightFrustum.getCurrentMask()||this._lightFrustum.containsBoundingSphere(r))&&(this._cameraFrustum.pushCurrentMask(),this._lightFrustum.pushCurrentMask(),this.pushMatrix(e),this.traverse(t),this._cameraFrustum.popCurrentMask(),this._lightFrustum.popCurrentMask(),this.popMatrix())},applyBoundingBox:function(){var t=new i.a;return function(e){var r=this._matrixStack.back();h.c.exactEquals(r,h.c.IDENTITY)?this._bb.expandByBoundingBox(e):e.valid()&&(e.transformMat4(t,r),this._bb.expandByBoundingBox(t))}}(),apply:function(t){var e=t.getTypeID();if(t instanceof l.a)return void this.applyTransform(t);if(e===s.a.getTypeID()){var r=this._bs;if(t.getBound().transformMat4(r,this._matrixStack.back()),0!==this._cameraFrustum.getCurrentMask()&&!this._cameraFrustum.containsBoundingSphere(r))return;if(0!==this._lightFrustum.getCurrentMask()&&!this._lightFrustum.containsBoundingSphere(r))return;return void this.applyBoundingBox(t.getBoundingBox())}e===n.a.getTypeID()||o.a.getTypeID(),this.traverse(t)},pushMatrix:function(t){this._matrixStack.push(t)},popMatrix:function(){this._matrixStack.pop()}}),"osgShadow","ComputeMultiFrustumBoundsVisitor"),e.a=g},function(t,e,r){"use strict";var i=r(2),a=r(1),n=r(15),s=r(0),o=r(99),h=r(173),u=r(171),c=r(7),l=r(30),d=r(6),_=r(37),f=function(t){this._lights=[],this._shadowMaps=[],this._viewportDimension=[],o.a.apply(this,arguments),this._shadowSettings=t,this._texture=new h.a,this._textureUnitBase=4,this._textureUnit=this._textureUnitBase,this._textureMagFilter=void 0,this._textureMinFilter=void 0,this._textureSize=1024,this._shadowMapSize=256,this._receivingStateset=void 0,this._shaderProcessor=void 0,t&&(this.setShadowSettings(t),t.atlasSize&&(this._textureSize=t.atlasSize),t.textureSize&&(this._shadowMapSize=t.textureSize)),this._texelSizeUniform=d.a.createFloat1(1/this._textureSize,"texelSize");var e=d.a.createFloat2("RenderSize");this._renderSize=e.getInternalArray(),this._renderSize[0]=this._renderSize[1]=this._textureSize,this._numShadowWidth=this._textureSize/this._shadowMapSize,this._numShadowHeight=this._textureSize/this._shadowMapSize,this._cameraClear=new n.a,this._cameraClear.setName("shadowAtlasCameraClear"),this._cameraClear.setRenderOrder(n.a.PRE_RENDER,0),this._cameraClear.setClearColor(a.g.fromValues(1,1,1,1)),this._cameraClear.setFrameBufferObject(new l.a),this._cameraClear.setClearMask(0)};s.a.createPrototypeObject(f,s.a.objectInherit(o.a.prototype,{getTexture:function(){return this._texture},isDirty:function(t){if(void 0!==t)return this._shadowMaps[t].isDirty();for(var e=0,r=this._shadowMaps.length;e<r;e++)if(this._shadowMaps[e].isDirty())return!0;return!1},setTextureUnitBase:function(t){this._textureUnitBase=t,this._textureUnit=t;for(var e=0,r=this._shadowMaps.length;e<r;e++)this._shadowMaps[e].setTextureUnitBase(t)},setShadowSettings:function(t){if(t){this._shadowSettings=t;for(var e=0,r=this._shadowMaps.length;e<r;e++)this._shadowMaps[e].setShadowSettings(t);this.setTextureSize(t.textureSize),this.setTexturePrecision(t.textureType)}},setCastsShadowDrawTraversalMask:function(t){for(var e=0,r=this._shadowMaps.length;e<r;e++)this._shadowMaps[e].setCastsShadowDrawTraversalMask(t)},getCastsShadowDrawTraversalMask:function(t){return void 0!==t?this._shadowMaps[t].getCastsShadowDrawTraversalMask():0!==this._shadowMaps.length?this._shadowMaps[0].getCastsShadowDrawTraversalMask():void 0},setCastsShadowBoundsTraversalMask:function(t){for(var e=0,r=this._shadowMaps.length;e<r;e++)this._shadowMaps[e].setCastsShadowBoundsTraversalMask(t)},getCastsShadowBoundsTraversalMask:function(t){return void 0!==t?this._shadowMaps[t].getCastsShadowDrawTraversalMask():0!==this._shadowMaps.length?this._shadowMaps[0].getCastsShadowDrawTraversalMask():void 0},getNormalBias:function(t){return void 0!==t?this._shadowMaps[t].getNormalBias():0!==this._shadowMaps.length?this._shadowMaps[0].getNormalBias():void 0},setNormalBias:function(t){for(var e=0,r=this._shadowMaps.length;e<r;e++)this._shadowMaps[e].setNormalBias(t)},getBias:function(t){return void 0!==t?this._shadowMaps[t].getBias():0!==this._shadowMaps.length?this._shadowMaps[0].getBias():void 0},setBias:function(t){for(var e=0,r=this._shadowMaps.length;e<r;e++)this._shadowMaps[e].setBias(t)},getKernelSizePCF:function(t){return void 0!==t?this._shadowMaps[t].getKernelSizePCF():1!==this._shadowMaps.length?this._shadowMaps[0].getKernelSizePCF():void 0},setKernelSizePCF:function(t){for(var e=0,r=this._shadowMaps.length;e<r;e++)this._shadowMaps[e].setKernelSizePCF(t)},setShadowedScene:function(t){o.a.prototype.setShadowedScene.call(this,t),this._receivingStateset=this._shadowedScene.getReceivingStateSet();for(var e=0,r=this._shadowMaps.length;e<r;e++)this._shadowMaps[e].setShadowedScene(t)},setTexturePrecision:function(t){for(var e=0,r=this._shadowMaps.length;e<r;e++)this._shadowMaps[e].setTexturePrecision(t)},getTexturePrecision:function(t){return void 0!==t?this._shadowMaps[t].getTexturePrecision():1!==this._shadowMaps.length?this._shadowMaps[0].getTexturePrecision():void 0},setTextureSize:function(t){t!==this._textureSize&&(this._shadowMapSize=t,this._numShadowWidth=this._textureSize/this._shadowMapSize,this._numShadowHeight=this._textureSize/this._shadowMapSize,this.dirty())},getShadowMap:function(t){return this._shadowMaps[t]},addLight:function(t){if(!t||-1!==this._lights.indexOf(t))return i.a.warn("no light or light already added"),-1;if(this._lights.length===this._numShadowWidth*this._numShadowHeight)return void i.a.warn("can't allocate shadow for light "+t.getLightNumber()+" ShadowAtlas already full ");this._lights.push(t),this._shadowSettings.setLight(t);var e=new u.a(this._shadowSettings,this._texture);return this._shadowMaps.push(e),this._shadowedScene&&e.setShadowedScene(this._shadowedScene),this.recomputeViewports(),e},init:function(){if(this._shadowedScene){this.initTexture();for(var t=[],e=0;e<this._lights.length;e++)t.push(this._lights[e].getLightNumber());this._texture.setLightNumberArray(t),this._textureUnit=this._textureUnitBase,this._texture.setName("ShadowTexture"+this._textureUnit);var r=d.a.createFloat2("RenderSize");this._texelSizeUniform=d.a.createFloat1(1/this._textureSize,"texelSize"),this._renderSize=r.getInternalArray(),this._renderSize[0]=this._renderSize[1]=this._textureSize,this.recomputeViewports();for(var i=0,a=this._shadowMaps.length;i<a;i++){var n=this._shadowMaps[i];this._shadowedScene||(this._shadowedScene=n.getShadowedScene(this._shadowedScene)),this._shadowedScene&&n.setShadowedScene(this._shadowedScene),n.init(this._texture,i,this._textureUnitBase)}}},recomputeViewports:function(){for(var t=this._shadowMaps.length,e=t>2?Math.sqrt(2*Math.ceil(t/2)):t,r=e,i=this._textureSize/r,n=this._textureSize/e,s=this._textureSize/i,o=this._textureSize/n,h=0;h<t;h++){var u=this._shadowMaps[h],c=i*(h%s),l=n*Math.floor(h/o);this._viewportDimension.length<=h?this._viewportDimension.push(a.g.fromValues(c,l,i,n)):a.g.set(this._viewportDimension[h],c,l,i,n),this._texture.setLightShadowMapSize(this._lights[h].getLightNumber(),this._viewportDimension[h]),u.dirty()}},valid:function(){return!0},updateCameraClear:function(){var t=this._cameraClear,e=this._texture;if(t&&e){var r=t.getViewport();r||(r=new _.a,t.setViewport(r)),r.width()===e.getWidth()&&r.height()===e.getHeight()||(t.detachAll(),t.attachTexture(l.a.COLOR_ATTACHMENT0,e),t.attachRenderBuffer(l.a.DEPTH_ATTACHMENT,l.a.DEPTH_COMPONENT16),t.getViewport().setViewport(0,0,e.getWidth(),e.getHeight()))}},updateShadowTechnique:function(t){this.updateCameraClear();for(var e=this._cameraClear.getFrameBufferObject(),r=0,i=this._shadowMaps.length;r<i;r++)this._shadowMaps[r].updateShadowTechnique(t,this._viewportDimension[r],e)},initTexture:function(){if(this._dirty){this._texture||(this._texture=new h.a,this._textureUnit=this._textureUnitBase),this._texture.setTextureSize(this._textureSize,this._textureSize),this._texelSizeUniform.setFloat(1/this._textureSize),this._renderSize[0]=this._textureSize,this._renderSize[1]=this._textureSize;var t;t=c.default.RGBA,u.a.prototype.setTextureFiltering.call(this),this._texture.setInternalFormat(t),this._texture.setWrapS(c.default.CLAMP_TO_EDGE),this._texture.setWrapT(c.default.CLAMP_TO_EDGE),this._texture.dirty()}},cullShadowCasting:function(t,e){this._cameraClear.accept(t);for(var r=0,i=this._shadowMaps.length;r<i;r++){var a=this._shadowMaps[r];(a.isContinuousUpdate()||a.needRedraw())&&a.cullShadowCasting(t,e)}},isContinuousUpdate:function(){for(var t=0,e=this._shadowMaps.length;t<e;t++)if(this._shadowMaps[t].isContinuousUpdate())return!0;return!1},needRedraw:function(){for(var t=0,e=this._shadowMaps.length;t<e;t++)if(this._shadowMaps[t].needRedraw())return!0;return!1},removeShadowMap:function(t){if(this._shadowMaps.length>0){var e=this._shadowMaps.indexOf(t);if(-1!==e){this._shadowMaps[e].valid()&&this._shadowMaps[e].cleanSceneGraph(!0),this._shadowMaps.splice(e,1);var r=this._texture.getLightNumberArray();e=r.indexOf(t.getLightNumber()),-1!==e&&r.splice(e,1);var i=t.getLight();e=this._lights.indexOf(i),-1!==e&&this._lights.splice(e,1),this._viewportDimension.length>e&&this._viewportDimension.splice(e,1),this.recomputeViewports()}}},addShadowMap:function(t){if(!(this._shadowMaps.length>0&&-1!==this._shadowMaps.indexOf(t))){this._shadowMaps.push(t);var e=t.getLight();-1===this._lights.indexOf(e)&&this._lights.push(e),this._shadowedScene&&t.setShadowedScene(this._shadowedScene);var r=this._texture.getLightNumberArray();-1===r.indexOf(t.getLightNumber())&&r.push(e.getLightNumber()),this.recomputeViewports()}},cleanReceivingStateSet:function(){if(this._receivingStateset){this._texture&&this._receivingStateset.getTextureAttribute(this._textureUnit,this._texture.getTypeMember())===this._texture&&this._receivingStateset.removeTextureAttribute(this._textureUnit,this._texture.getTypeMember());for(var t=0,e=this._shadowMaps.length;t<e;t++)this._shadowMaps[t].cleanReceivingStateSet()}},cleanSceneGraph:function(){this._texture=void 0,this._shadowedScene=void 0},setDebug:function(t,e){if(e)this._shadowMaps[e].setDebug(t);else for(var r=0,i=this._shadowMaps.length;r<i;r++)this._shadowMaps[r].setDebug(t)},markSceneAsNoShadow:function(){for(var t=0,e=this._shadowMaps.length;t<e;t++)this._shadowMaps[t].markSceneAsNoShadow()}}),"osgShadow","ShadowMapAtlas"),e.a=f},function(t,e,r){"use strict";var i=r(0),a=r(7),n=["1Tap(4texFetch)","4Tap(16texFetch)","9Tap(36texFetch)","16Tap(64texFetch)"],s=function(t){this.castsShadowDrawTraversalMask=4294967295,this.castsShadowBoundsTraversalMask=4294967295,this.textureSize=1024,this.textureType="UNSIGNED_BYTE",this.textureFormat=a.default.RGBA,this.shadowProjection="fov",this.fov=50,this.kernelSizePCF="4Tap(4texFetch)",this.bias=.005,this.normalBias=void 0,this.shadowCastShaderGeneratorName="ShadowCast",i.a.objectMix(this,t)};s.kernelSizeList=n,s.prototype={setCastsShadowDrawTraversalMask:function(t){this.castsShadowDrawTraversalMask=t},getCastsShadowDrawTraversalMask:function(){return this.castsDrawShadowTraversalMask},setCastsShadowBoundsTraversalMask:function(t){this.castsShadowBoundsTraversalMask=t},getCastsShadowBoundsTraversalMask:function(){return this.castsShadowBoundsTraversalMask},setLight:function(t){this.light=t},getLight:function(){return this.light},setTextureSize:function(t){this.textureSize=t},getTextureSize:function(){return this.textureSize},setTextureType:function(t){this.textureType=t},getTextureType:function(){return this.textureType},setTextureFormat:function(t){this.textureFormat=t},getTextureFormat:function(){return this.textureFormat},setShadowCastShaderGeneratorName:function(t){this.shadowCastShaderGeneratorName=t},getShadowCastShaderGeneratorName:function(){return this.shadowCastShaderGeneratorName}},e.a=s},function(t,e,r){"use strict";var i=r(50),a=r(1),n=r(8),s=r(3),o=r(17),h=r(0),u=r(60),c=r(170),l=function(t){n.a.call(this),this._shadowTechniques=[],this._optimizedFrustum=!1,this._frustumReceivers=[a.g.create(),a.g.create(),a.g.create(),a.g.create(),a.g.create(),a.g.create()],this._tmpMat=a.c.create(),this._receivingStateset=new o.a,this._computeBoundsVisitor=new u.default,this._castsShadowDrawTraversalMask=4294967295,this._castsShadowBoundsTraversalMask=4294967295,t&&this.setShadowSettings(t)};h.a.createPrototypeNode(l,h.a.objectInherit(n.a.prototype,{getReceivingStateSet:function(){return this._receivingStateset},getShadowTechniques:function(){return this._shadowTechniques},addShadowTechnique:function(t){this._shadowTechniques.length>0&&-1!==this._shadowTechniques.indexOf(t)||(this._shadowTechniques.push(t),t.valid()&&(t.setShadowedScene(this),t.dirty()))},removeShadowTechnique:function(t){if(this._shadowTechniques.length>0){var e=this._shadowTechniques.indexOf(t);-1!==e&&(this._shadowTechniques[e].valid()&&this._shadowTechniques[e].cleanSceneGraph(),this._shadowTechniques.splice(e,1))}},cleanSceneGraph:function(){for(var t=0,e=this._shadowTechniques.length;t<e;t++)this._shadowTechniques[t]&&this._shadowTechniques[t].valid()&&this._shadowTechniques[t].cleanSceneGraph()},dirty:function(){for(var t=0;t<this._shadowTechniques.length;t++)this._shadowTechniques[t].dirty()},nodeTraverse:function(t){n.a.prototype.traverse.call(this,t)},setShadowSettings:function(t){this._settings=t,this.setCastsShadowDrawTraversalMask(t.castsShadowDrawTraversalMask),this.setCastsShadowBoundsTraversalMask(t.castsShadowBoundsTraversalMask),!1!==t.userShadowCasterVisitor&&(this._removeNodesNeverCastingVisitor=t.userShadowCasterVisitor||new c.a(this._castsShadowTraversalMask))},setCastsShadowDrawTraversalMask:function(t){this._castsShadowDrawTraversalMask=t},getCastsShadowDrawTraversalMask:function(){return this._castsDrawShadowTraversalMask},setCastsShadowBoundsTraversalMask:function(t){this._castsShadowBoundsTraversalMask=t},getCastsShadowBoundsTraversalMask:function(){return this._castsShadowBoundsTraversalMask},computeShadowedSceneBounds:function(){return this._removeNodesNeverCastingVisitor&&(this._removeNodesNeverCastingVisitor.setNoCastMask(~(this._castsShadowBoundsTraversalMask|this._castsShadowDrawTraversalMask)),this._removeNodesNeverCastingVisitor.reset(),this.accept(this._removeNodesNeverCastingVisitor)),this._computeBoundsVisitor.setTraversalMask(this._castsShadowBoundsTraversalMask),this._computeBoundsVisitor.reset(),this.accept(this._computeBoundsVisitor),!!this._computeBoundsVisitor.getBoundingBox().valid()||(this._removeNodesNeverCastingVisitor&&this._removeNodesNeverCastingVisitor.restore(),!1)},traverse:function(t){if(t.getVisitorType()===s.a.CULL_VISITOR){var e,r,i=this._shadowTechniques.length;i&&t.pushStateSet(this._receivingStateset),this.nodeTraverse(t),i&&t.popStateSet();var a=!1;for(e=0;e<i;e++)(r=this._shadowTechniques[e])&&r.valid()&&(r.isDirty()&&(a=!0,r.init()),(r.isContinuousUpdate()||r.needRedraw())&&(a=!0));if(!a)return;if(!this.computeShadowedSceneBounds(t)){for(e=0;e<i;e++)r=this._shadowTechniques[e],r.markSceneAsNoShadow();return}var n=this._computeBoundsVisitor.getBoundingBox(),o=t.getCurrentModelMatrix();for(n.transformMat4(n,o),e=0;e<i;e++)r=this._shadowTechniques[e],(r.isContinuousUpdate()||r.needRedraw())&&(r.updateShadowTechnique(t),r.cullShadowCasting(t,n));this._removeNodesNeverCastingVisitor&&this._removeNodesNeverCastingVisitor.restore()}else this.nodeTraverse(t)}}),"osgShadow","ShadowedScene"),i.a.registerApplyFunction(l.nodeTypeID,i.a.getApplyFunction(n.a.nodeTypeID)),e.a=l},function(t,e,r){"use strict";var i=r(162),a=r(163),n=r(98),s=r(165),o=r(164),h=r(166),u=r(168),c=r(167),l={Stats:i.a,BufferStats:a.a,Graph:n.a,TextGenerator:s.a,Counter:o.a,defaultStats:h.a,browserStats:u.a,glStats:c.a};e.a=l},function(t,e,r){"use strict";var i=r(138),a={};a.Text=i.a,e.a=a},function(t,e,r){"use strict";var i=r(72),a=r(136),n=r(137),s={};s.osg=i.a,s.osgAnimation=a.a,s.osgText=n.a,e.a=s},function(t,e,r){"use strict";var i=r(260),a=r(261),n={};n.ReaderWriterGLTF=i.a,n.ReaderWriterZIP=a.a,e.a=n},function(t,e,r){"use strict";function i(t){for(var e=window.atob(t),r=e.length,i=new Uint8Array(r),a=0;a<r;a++)i[a]=e.charCodeAt(a);return i.buffer}var a=r(14),n=r.n(a),s=r(24),o=r(17),h=r(90),u=r(55),c=r(126),l=r(66),d=r(44),_=r(131),f=r(130),g=r(89),p=r(45),m=r(34),v=r(46),S=r(69),b=r(2),x=r(8),y=r(11),M=r(7),T=r(16),A=r(29),C=r(42),I=r(41),w=r(18),E=r(9),N=r(13),R=r(67),O=r(70),F=r(52),P=r(71),L=r(6),D=r(1),V=v.a.createQuatChannel,B=v.a.createVec3Channel,U=v.a.createFloatChannel,k=function(){this._filesMap=void 0,this._loadedFiles=void 0,this._bufferViewCache=void 0,this._basicAnimationManager=void 0,this._visitedNodes=void 0,this._animatedNodes=void 0,this._bones=void 0,this._skeletonToInfluenceMap=void 0,this._inputImgReader=void 0,this._localPath="",this._extensions=[],this._nodeAnimationTypes=void 0,this.init()};k.WEBGL_COMPONENT_TYPES={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},k.TYPE_TABLE={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},k.ATTRIBUTE_OSGJS_TABLE={POSITION:"Vertex",NORMAL:"Normal",TANGENT:"Tangent",TEXCOORD_0:"TexCoord0",TEXCOORD_1:"TexCoord1",TEXCOORD_2:"TexCoord2",TEXCOORD_3:"TexCoord3",TEXCOORD_4:"TexCoord4",TEXCOORD_5:"TexCoord5",TEXCOORD_6:"TexCoord6",TEXCOORD_7:"TexCoord7",TEXCOORD_8:"TexCoord8",TEXCOORD_9:"TexCoord9",TEXCOORD_10:"TexCoord10",TEXCOORD_11:"TexCoord11",TEXCOORD_12:"TexCoord12",TEXCOORD_13:"TexCoord13",TEXCOORD_14:"TexCoord14",TEXCOORD_15:"TexCoord15",COLOR_0:"Color",JOINTS_0:"Bones",WEIGHTS_0:"Weights"},k.TEXTURE_FORMAT={6406:M.default.ALPHA,6407:M.default.RGB,6408:M.default.RGBA,6409:M.default.LUMINANCE,6410:M.default.LUMINANCE_ALPHA},k.TYPE_CHANNEL_PATH={translation:{VEC3:B},scale:{VEC3:B},rotation:{VEC4:V},weights:{SCALAR:U}},k.TYPE_STACKED_TRANSFORMS={translation:_.a,scale:g.a,rotation:f.a},k.PBR_SPEC_EXT="KHR_materials_pbrSpecularGlossiness",k.PBR_SPEC_MODE="PBR_specular_glossiness",k.PBR_METAL_MODE="PBR_metal_roughness",k.ALBEDO_TEXTURE_UNIT=2,k.DIFFUSE_TEXTURE_UNIT=2,k.SPECULAR_GLOSSINESS_TEXTURE_UNIT=3,k.METALLIC_ROUGHNESS_TEXTURE_UNIT=3,k.SPECULAR_TEXTURE_UNIT=4,k.NORMAL_TEXTURE_UNIT=5,k.AO_TEXTURE_UNIT=6,k.EMISSIVE_TEXTURE_UNIT=7,k.ALBEDO_UNIFORM="albedoMap",k.METALLIC_ROUGHNESS_UNIFORM="metallicRoughnessMap",k.SPECULAR_UNIFORM="specularMap",k.NORMAL_UNIFORM="normalMap",k.AO_UNIFORM="aoMap",k.EMISSIVE_UNIFORM="emissiveMap",k.prototype={init:function(){this._glTFJSON=void 0,this._nodeAnimationTypes=[],this._bufferViewCache={},this._basicAnimationManager=void 0,this._localPath="",this._visitedNodes={},this._animatedNodes={},this._bones={},this._skeletonToInfluenceMap={},this._stateSetMap={},this._filesMap={},this._inputReader=new h.default,this._rootStateSet=new o.a,this._defaultBlendFunc=new A.a,this._transparentBlendFunc=new A.a("SRC_ALPHA","ONE_MINUS_SRC_ALPHA"),this._defaultCullFace=new C.a,this._doubleSideCullFace=new C.a(C.a.DISABLE)},_preProcessNodes:function(){for(var t,e=this._gltfJSON.nodes,r=this._gltfJSON.meshes,i=0;i<e.length;i++){var a=e[i];t=a.name||"",t+="_"+i.toString(),a.osgjsNodeName=t;var n=a.children;if(n)for(var s=0;s<n.length;s++){var o=n[s];e[o].parent=i}}for(var h=0;h<r.length;h++){var u=r[h];t=u.name||"",t+="_"+h.toString(),u.osgjsNodeName=t}},loadBuffers:n.a.method(function(){for(var t=[],e=this._gltfJSON.buffers,r=0;r<e.length;r++){var i=e[r];t.push(this.loadURI(i.uri,{responseType:"arraybuffer"}).then(function(t){i.data=t}))}return n.a.all(t)}),loadBufferViews:function(){for(var t=this._gltfJSON.buffers,e=this._gltfJSON.bufferViews,r=0;r<e.length;r++){var i=e[r],a=i.buffer,n=t[a],s=i.byteLength||0,o=i.byteOffset||0;i.data=n.data.slice(o,o+s)}},loadAccessors:function(){for(var t=this._gltfJSON.bufferViews,e=this._gltfJSON.accessors,r=0;r<e.length;r++){var i,a=e[r],n=a.bufferView,s=t[n],o=k.TYPE_TABLE[a.type],h=k.WEBGL_COMPONENT_TYPES[a.componentType],u=h.BYTES_PER_ELEMENT,c=u*o,l=s.byteStride,d=!0===a.normalized;if(l&&l!==c)b.a.warn("GLTF interleaved accessors not supported");else{var _=new h(s.data,a.byteOffset,a.count*o);i=new N.a(void 0,_,o),i.setNormalize(d)}a.data=i}},_computeNodeMatrix:function(t){var e;if(t.matrix)e=D.c.clone(t.matrix);else if(t.translation||t.rotation||t.scale){var r=D.c.IDENTITY,i=D.c.IDENTITY,a=D.c.IDENTITY;t.translation&&(r=D.c.fromTranslation(D.c.create(),t.translation)),t.rotation&&(i=D.c.fromQuat(D.c.create(),t.rotation)),t.scale&&(a=D.c.fromScaling(D.c.create(),t.scale)),e=D.c.create(),D.c.multiply(e,i,a),D.c.multiply(e,r,e)}return e},loadNodes:function(){for(var t=this._gltfJSON.nodes,e=this._gltfJSON.skins,r=this._gltfJSON.meshes,i=0;i<t.length;i++){var a=t[i];if(!a.usedAsBone){if(void 0!==a.skin){var n=e[a.skin],s=n.osgjsNode;n.osgjsNodeAttached||(a.osgjsNode=s,n.osgjsNodeAttached=i);var o=r[a.mesh];o.osgjsGeometry.setBoneNameID(n.osgjsBoneMapID),s.addChild(o.osgjsGeometry)}else(a.matrix||a.translation||a.rotation||a.scale)&&(a.osgjsNode=this._createMatrixTransform(i)),void 0!==a.mesh&&(a.osgjsNode?a.osgjsNode.addChild(r[a.mesh].osgjsGeometry):a.osgjsNode=r[a.mesh].osgjsGeometry),a.osgjsNode||(a.osgjsNode=new x.a);a.name&&a.osgjsNode.setName(a.name)}}},_linkNodes:function(t){var e=this._gltfJSON.nodes,r=t.children;if(r)for(var i=0;i<r.length;i++){var a=e[r[i]];if(!a.usedAsBone){var n=a.osgjsNode;n&&!t.osgjsNode.hasChild(n)&&(t.osgjsNode.addChild(n),this._linkNodes(a))}}},loadSkins:function(){var t=this._gltfJSON.skins;if(t)for(var e=0;e<t.length;e++)this._processSkin(e)},loadScenes:function(){var t=this._gltfJSON.nodes,e=this._gltfJSON.scenes;this._osgjsScene=[];for(var r=0;r<e.length;r++){for(var i=e[r],a=i.nodes,n=[],s=0;s<a.length;s++){var o=t[a[s]];this._linkNodes(o),n.push(o.osgjsNode)}var h=n[0];if(n.length>1){h=new x.a;for(var u=0;u<n.length;u++)h.addChild(n[u])}this._osgjsScene.push(h)}},_assignGeometryAttributes:function(t,e,r){var i=this._gltfJSON.accessors;for(var a in e){var n=e[a],s=i[n],o=k.ATTRIBUTE_OSGJS_TABLE[a];void 0!==r&&(o+="_"+r.toString()),t.getVertexAttributeList()[o]=s.data,s.data._target=N.a.ARRAY_BUFFER}},_assignGeometryPrimitives:function(t,e){var r=this._gltfJSON.accessors,i=r[e.indices];i.data._target=N.a.ELEMENT_ARRAY_BUFFER;var a=void 0!==e.mode?e.mode:E.a.TRIANGLES,n=new w.a(a,i.data);t.getPrimitiveSetList().push(n)},_getMorphTargetName:function(t,e){return t.osgjsNodeName+"_target_"+e.toString()},_computeAbsoluteMorphData:function(t,e){var r=this._gltfJSON.accessors;for(var i in e){var a=e[i],n=r[a];if(!n.morphAbsoluteComputed){n.morphAbsoluteComputed=!0;for(var s=t[i],o=r[s],h=o.data.getElements(),u=n.data.getElements(),c=h.length,l=0;l<c;l++)u[l]+=h[l]}}},_processMorphGeometry:function(t,e){var r=t.primitives[e],i=new m.a,a=new O.a;a.setName(t.osgjsNodeName),i.setName(t.osgjsNodeName);for(var n=0;n<r.targets.length;n++){this._computeAbsoluteMorphData(r.attributes,r.targets[n]);var s=this._getMorphTargetName(t,n),o=new y.a;o.setName(s),a.addTarget(s,n),this._assignGeometryAttributes(o,r.targets[n]),i.getMorphTargets().push(o)}this._assignGeometryAttributes(i,r.attributes),this._assignGeometryPrimitives(i,r),i.mergeChildrenVertexAttributeList(),t.osgjsMorphGeometry=i,t.osgjsUpdateMorph=a},loadMeshes:function(){for(var t=this._gltfJSON.meshes,e=this._gltfJSON.materials,r=0;r<t.length;r++){for(var i=t[r],a=i.name,n=[],o=0;o<i.primitives.length;o++){var h=void 0,u=i.primitives[o],c=void 0;if(u.targets&&u.targets.length&&(this._processMorphGeometry(i,o),h=i.osgjsMorphGeometry,c=i.osgjsUpdateMorph),u.attributes.JOINTS_0){var l=new p.a;h||(h=new y.a,this._assignGeometryAttributes(h,u.attributes),this._assignGeometryPrimitives(h,u));var d=new s.a;h.computeBoundingBox(d),l.setBound(d),l.setSourceGeometry(h),l.mergeChildrenData(),h=l}h||(h=new y.a,this._assignGeometryAttributes(h,u.attributes),this._assignGeometryPrimitives(h,u)),a&&h.setName(a),c&&h.addUpdateCallback(c);var _=e[u.material].osgjsStateSet;h.setStateSet(_),h.setUserData(_.getUserData()),n.push(h)}if(n.length>1){for(var f=new x.a,g=0;g<n.length;g++)f.addChild(n[g]);h=f}i.osgjsGeometry=h}},loadImages:function(){var t=this._gltfJSON.images;if(!t)return n.a.resolve();for(var e=[],r=0;r<t.length;r++){var i=t[r],a=window.decodeURI(i.uri),s=this.loadURI(a).then(function(t){var e=new I.a;e.setImage(t),this.osgjsImage=e}.bind(i));e.push(s)}return n.a.all(e)},_texture:function(t){var e=this._gltfJSON.textures,r=this._gltfJSON.images,i=e[t.index],a=r[i.source];if(i.osgjsTexture)return i.osgjsTexture;var n=new M.default;if(i.osgjsTexture=n,n.setFlipY(!1),n.setWrapS("REPEAT"),n.setWrapT("REPEAT"),a.osgjsImage){var s=k.TEXTURE_FORMAT[i.format];n.setImage(a.osgjsImage,s)}return n},_pbrMetallicRoughnessTextureUniforms:function(){var t=this._rootStateSet;if(!t.getUniformList()[k.ALBEDO_UNIFORM]){var e=L.a.createInt(k.ALBEDO_TEXTURE_UNIT,k.ALBEDO_UNIFORM),r=L.a.createInt(k.METALLIC_ROUGHNESS_TEXTURE_UNIT,k.METALLIC_ROUGHNESS_UNIFORM);t.addUniform(e),t.addUniform(r)}},_pbrMetallicRoughness:function(t,e){e.setUserData({pbrWorklow:k.PBR_METAL_MODE}),this._pbrMetallicRoughnessTextureUniforms();var r;if(t.baseColorTexture)r=this._texture(t.baseColorTexture),e.setTextureAttributeAndModes(k.ALBEDO_TEXTURE_UNIT,r);else if(t.baseColorFactor){var i=L.a.createFloat4(t.baseColorFactor,"uBaseColorFactor");e.addUniform(i)}if(void 0!==t.metallicFactor){var a=L.a.createFloat1(t.metallicFactor,"uMetallicFactor");e.addUniform(a)}if(void 0!==t.roughnessFactor){var n=L.a.createFloat1(t.roughnessFactor,"uRoughnessFactor");e.addUniform(n)}t.metallicRoughnessTexture&&(r=this._texture(t.metallicRoughnessTexture),e.setTextureAttributeAndModes(k.METALLIC_ROUGHNESS_TEXTURE_UNIT,r))},_KHR_materials_pbrSpecularGlossinessTextureUniforms:function(){if(!this._extensions.KHR_materials_pbrSpecularGlossinessTextureUniforms){this._extensions.KHR_materials_pbrSpecularGlossinessTextureUniforms=!0;var t=this._rootStateSet,e=L.a.createInt(k.DIFFUSE_TEXTURE_UNIT,k.ALBEDO_UNIFORM),r=L.a.createInt(k.SPECULAR_GLOSSINESS_TEXTURE_UNIT,k.METALLIC_ROUGHNESS_UNIFORM),i=L.a.createInt(k.SPECULAR_TEXTURE_UNIT,k.SPECULAR_UNIFORM);t.addUniform(e),t.addUniform(r),t.addUniform(i)}},_KHR_materials_pbrSpecularGlossiness:function(t,e){e.setUserData({pbrWorklow:k.PBR_SPEC_MODE}),this._KHR_materials_pbrSpecularGlossinessTextureUniforms();var r,i;if(t.diffuseTexture?(r=this._texture(t.diffuseTexture),e.setTextureAttributeAndModes(k.DIFFUSE_TEXTURE_UNIT,r)):t.diffuseFactor&&(i=L.a.createFloat4(t.diffuseFactor,"uBaseColorFactor"),e.addUniform(i)),t.specularFactor&&(i=L.a.createFloat3(t.specularFactor,"uSpecularFactor"),e.addUniform(i)),void 0!==t.glossinessFactor){var a=L.a.createFloat(t.glossinessFactor,"uGlossinessFactor");e.addUniform(a)}t.specularGlossinessTexture&&(r=this._texture(t.specularGlossinessTexture),e.setTextureAttributeAndModes(k.SPECULAR_GLOSSINESS_TEXTURE_UNIT,r))},loadMaterials:function(){var t=this._gltfJSON.materials,e=!1,r=!1,i=this._rootStateSet;i.addUniform(L.a.createInt(k.EMISSIVE_TEXTURE_UNIT,k.EMISSIVE_UNIFORM)),i.addUniform(L.a.createInt(k.AO_TEXTURE_UNIT,k.AO_UNIFORM)),i.addUniform(L.a.createInt(k.NORMAL_TEXTURE_UNIT,k.NORMAL_UNIFORM)),i.addUniform(L.a.createFloat3(D.f.ZERO,"uEmissiveFactor"));for(var a=0;a<t.length;a++){var n,s=t[a],h=new o.a;s.osgjsStateSet=h,s.pbrMetallicRoughness?this._pbrMetallicRoughness(s.pbrMetallicRoughness,h):s.extensions.KHR_materials_pbrSpecularGlossiness&&this._KHR_materials_pbrSpecularGlossiness(s.extensions.KHR_materials_pbrSpecularGlossiness,h),s.normalTexture&&(n=this._texture(s.normalTexture),h.setTextureAttributeAndModes(k.NORMAL_TEXTURE_UNIT,n)),s.occlusionTexture&&(n=this._texture(s.occlusionTexture),h.setTextureAttributeAndModes(k.AO_TEXTURE_UNIT,n)),s.emissiveTexture&&(n=this._texture(s.emissiveTexture),h.setTextureAttributeAndModes(k.EMISSIVE_TEXTURE_UNIT,n)),s.emissiveFactor&&h.addUniform(L.a.createFloat3(s.emissiveFactor,"uEmissiveFactor")),"BLEND"===s.alphaMode&&(e=!0,h.setAttributeAndModes(this._transparentBlendFunc),h.setRenderingHint("TRANSPARENT_BIN")),s.doubleSided&&(r=!0,h.setAttributeAndModes(this._doubleSideCullFace))}e&&i.setAttributeAndModes(this._defaultBlendFunc),r&&i.setAttributeAndModes(this._defaultCullFace)},_createBone:function(t){var e=this._gltfJSON.nodes,r=e[t];r.usedAsBone=!0;var i=this._nodeAnimationTypes,a=new d.a,n=r.osgjsNodeName;a.setName(n);var s=this._computeNodeMatrix(r)||D.c.IDENTITY;a.setMatrix(s);var o=new R.a;if(o.setName(a.getName()),a.addUpdateCallback(o),i[t]){var h=o.getStackedTransforms();for(var u in i[t]){var c=k.TYPE_STACKED_TRANSFORMS[u],l=new c(u);h.push(l)}}return o.setMatrix(s),a},_createMatrixTransform:function(t){var e=this._gltfJSON.nodes,r=e[t],i=this._nodeAnimationTypes,a=new T.a,n=r.osgjsNodeName;a.setName(n);var s=this._computeNodeMatrix(r)||D.c.IDENTITY;if(a.setMatrix(s),i[t]){var o=new F.a;o.setName(a.getName()),a.addUpdateCallback(o),o.setMatrix(s);var h=o.getStackedTransforms();for(var u in i[t]){var c=k.TYPE_STACKED_TRANSFORMS[u],l=new c(u);h.push(l)}}return a},_processSkin:function(t){var e,r,i=this._gltfJSON.skins,a=this._gltfJSON.nodes,n=i[t],s=n.joints;void 0!==n.inverseBindMatrices&&(e=this._gltfJSON.accessors[n.inverseBindMatrices].data,r=e.getElements().buffer);var o=new l.a;n.osgjsNode=o,o.setName("skin ID "+t);for(var h,u,c,d={},_={},f=0;f<s.length;f++){if(h=s[f],c=this._createBone(h),void 0!==n.inverseBindMatrices){var g=new Float32Array(r,16*f*4,16);c.setInvBindMatrixInSkeletonSpace(g)}d[h]=c,_[c.getName()]=f}n.osgjsBoneMapID=_;for(var p in d){u=a[p];var m=u.parent;if(c=d[p],void 0===m||-1===s.indexOf(m))o.addChild(c);else{d[m].addChild(c)}}},loadAnimations:function(){var t=this._gltfJSON.animations;if(t){for(var e=this._gltfJSON.accessors,r=this._nodeAnimationTypes,i=this._gltfJSON.nodes,a=this._gltfJSON.meshes,n=[],s=0;s<t.length;s++){for(var o=t[s].channels,h=t[s].samplers,u=[],l=0;l<o.length;l++){var d=o[l],_=h[d.sampler],f=e[_.input].data.getElements(),g=e[_.output],p=g.data.getElements(),m=d.target,v=k.TYPE_CHANNEL_PATH[m.path][g.type],b=void 0!==m.node?m.node:m.id,x=i[b],y=m.path,M=i[b].osgjsNodeName;if("weights"===y)for(var T=a[x.mesh],A=T.primitives[0].targets.length,C=f.length,I=0;I<A;I++){for(var w=new Float32Array(C),E=0;E<C;E++)w[E]=p[E*A+I];M=this._getMorphTargetName(T,I),u.push(v(w,f,M,I))}else u.push(v(p,f,M,y));r[b]||(r[b]={}),r[b][y]=!0}var N="animation-"+s.toString();n.push(S.a.createAnimation(u,N))}var R=new c.a;R.init(n),this._animationManager=R}},loadURI:n.a.method(function(t,e){if("data:"===t.substr(0,5))return i(t);var r=this._filesMap[t];return void 0!==r?r:P.a.requestURI(t,e)}),readNodeURL:function(t,e){var r=this;if(this.init(),e&&void 0!==e.filesMap&&Object.keys(e.filesMap).length>0){this._filesMap=e.filesMap;var i=this._filesMap[t];return this.readJSON(i,t)}var a=t.lastIndexOf("/");return this._localPath=-1===a?"":t.substr(0,a+1),P.a.requestURI(t).then(function(t){return r.readJSON(t)})},readJSON:n.a.method(function(t,e){return this._gltfJSON=t,n.a.all([this.loadBuffers(),this.loadImages()]).then(function(){this.loadBufferViews(),this.loadAccessors(),this._preProcessNodes(),this.loadMaterials(),this.loadMeshes(),this.loadAnimations(),this.loadSkins(),this.loadNodes(),this.loadScenes();var t=new T.a;return t.addChild(this._osgjsScene[0]),t.setName(e),this._animationManager&&t.addUpdateCallback(this._animationManager),t.setStateSet(this._rootStateSet),t}.bind(this))})},u.a.instance().addReaderWriter("gltf",new k),e.a=k},function(t,e,r){"use strict";var i=r(14),a=r.n(i),n=r(2),s=r(71),o=r(55),h=r(38),u=window.JSZip,c=function(){this._options=void 0,this._filesMap={},this._fileName=""};c.prototype={readNodeURL:function(t,e){if(void 0===u)return n.a.error("You need to add JSZip as a dependency"),a.a.reject(this);n.a.log("starting to read: "+t);var r=this;if(e&&void 0!==e.filesMap&&void 0!==e.filesMap[t]){var i=e.filesMap[t];return this.readZipFile(i).then(function(){return r._fileName?h.default.readNodeURL(r._fileName,{filesMap:r._filesMap}):a.a.reject(r)})}return s.a.requestURI(t,{responseType:"blob"}).then(function(t){r.readZipFile(t).then(function(){return h.default.readNodeURL(r._fileName,{filesMap:r._filesMap})})})},readZipFile:function(t){s.a.unzip(t).then(function(t){for(var e in t){var r=s.a.getExtension(e);if(void 0!==o.a.instance().getReaderWriterForExtension(r)||"osgjs"===r){this._fileName=e;break}}}.bind(this))}},o.a.instance().addReaderWriter("zip",new c),e.a=c}])});