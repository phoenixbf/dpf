/*!
 * OSGJS
 * Cedric Pinson <trigrou@trigrou.com> (http://cedricpinson.com)
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("bluebird"),require("zlib"),require("hammerjs"),function(){try{return require("jquery")}catch(t){}}()):"function"==typeof define&&define.amd?define(["bluebird","zlib","hammer","jquery"],e):"object"==typeof exports?exports.OSG=e(require("bluebird"),require("zlib"),require("hammerjs"),function(){try{return require("jquery")}catch(t){}}()):t.OSG=e(t.P,t.Zlib,t.Hammer,t.$)}(this,function(__WEBPACK_EXTERNAL_MODULE_95__,__WEBPACK_EXTERNAL_MODULE_152__,__WEBPACK_EXTERNAL_MODULE_162__,__WEBPACK_EXTERNAL_MODULE_210__){return function(t){function e(i){if(r[i])return r[i].exports;var n=r[i]={exports:{},id:i,loaded:!1};return t[i].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}([function(t,e,r){t.exports=r(1)},function(t,e,r){"use strict";r(2);var i=r(3),n=r(5),a=r(132),s=r(147),o=r(161),h=r(189),u=r(221),c=r(199),l=r(239),d=r(251),_=r(252),f=r(253),g=r(254),p=i;p.osg=n,p.osgAnimation=a,p.osgDB=s,p.osgGA=o,p.osgUtil=h,p.osgViewer=u,p.osgShader=c,p.osgShadow=l,p.osgStats=d,p.osgText=_,p.osgWrappers=f,p.osgPlugins=g;var m=["osg","osgAnimation","osgDB","osgGA","osgUtil","osgViewer","osgShader","osgShadow","osgStats","osgText","osgWrappers","osgPlugins"];p.globalify=function(){m.forEach(function(t){window[t]=p[t]})},t.exports=p},function(t,e){"use strict";if(Math.sign||(Math.sign=function(t){return t>0?1:t<0?-1:0}),Math.log2||(Math.log2=function(t){return Math.log(t)*Math.LOG2E}),Math.log10||(Math.log10=function(t){return Math.log(t)*Math.LOG10E}),String.prototype.endsWith||(String.prototype.endsWith=function(t){return this.slice(-t.length)===t}),String.prototype.startsWith||(String.prototype.startsWith=function(t){return this.slice(0,t.length)===t}),!Float32Array.prototype.slice){var r=function(t,e){return new this.constructor(this.subarray(t,e))};Int8Array.prototype.slice=r,Uint8Array.prototype.slice=r,Uint8ClampedArray.prototype.slice=r,Int16Array.prototype.slice=r,Uint16Array.prototype.slice=r,Int32Array.prototype.slice=r,Uint32Array.prototype.slice=r,Float32Array.prototype.slice=r,Float64Array.prototype.slice=r}!function(){var t=new window.Set(["test"]),e=t.has("test");if(!e){var r=window.Set;window.Set=function(t){var e=new r;if(t)for(var i=0;i<t.length;++i)e.add(t[i]);return e}}}()},function(t,e,r){"use strict";var i=r(4);t.exports={name:i.name,version:i.version,author:i.author}},function(t,e){t.exports={devDependencies:{chai:"^3.5.0",eslint:"^4.7.2","eslint-config-google":"^0.8.0","eslint-config-prettier":"2.3.0","eslint-config-standard":"^10.2.1","eslint-plugin-import":"^2.6.0","eslint-plugin-node":"^5.1.0","eslint-plugin-prettier":"2.1.2","eslint-plugin-private-variables":"*","eslint-plugin-promise":"^3.5.0","eslint-plugin-standard":"^3.0.1","grunt-contrib-connect":"~0.9","grunt-documentation":"*","grunt-execute":"^0.2.2","grunt-plato":"~0.2.1","grunt-release":"^0.10.0","grunt-update-submodules":"^0.4.1",jsdom:"11.0.0","jsdom-global":"3.0.2",mocha:"^2.5.3",prettier:"1.5.2","webpack-strip-block":"0.0.1"},peerDependencies:{grunt:">=0.4.0"},dependencies:{bluebird:"^3.0.5",d3:"^4.9.1",dagre:"^0.7.4","dat.gui":"github:dataarts/dat.gui#v0.6.5",extend:"*","gl-matrix":"2.3.2",glob:"*",grunt:"> 1.0.0","grunt-contrib-clean":"*","grunt-contrib-copy":"*","grunt-contrib-uglify":"*","grunt-eslint":"*","grunt-git":"^1.0.7","grunt-shell":"*","grunt-webpack":"^1.0.8",hammerjs:"^2.0.8",jquery:"^2.2.4","json-loader":"^0.5.4",path:"^0.11.14",prettier:"1.5.2","raw-loader":"^0.5.1",webpack:"^1.7.3","webpack-dev-server":"^1.7.0",zlibjs:"^0.3.1"},contributors:["Paul Cheyrou-Lagr√®ze <tuan.kuranes@gmail.com>","Jordi Torres <jtorresfabra@gmail.com>","Matt Fontaine <tehqin@gmail.com>","Stephane Ginier <stephane.ginier@gmail.com>"],version:"0.2.7",author:"Cedric Pinson <trigrou@trigrou.com> (http://cedricpinson.com)",license:"MIT",description:"OpenSceneGraph implementation in javascript",repository:{url:"git@github.com:cedricpinson/osgjs.git",type:"git"},name:"OpenSceneGraph"}},function(t,e,r){"use strict";var i=r(6),n=r(51),a=r(52),s=r(53),o=r(14),h=r(28),u=r(48),c=r(54),l=r(56),d=r(35),_=r(33),f=r(57),g=r(58),p=r(55),m=r(61),v=r(63),S=r(89),x=r(90),b=r(91),y=r(45),M=r(92),T=r(71),A=r(93),C=r(36),I=r(43),w=r(42),E=r(94),N=r(96),R=r(98),F=r(99),P=r(66),L=r(100),O=r(72),D=r(101),V=r(16),B=r(64),k=r(32),U=r(50),G=r(62),j=r(12),z=r(31),W=r(9),H=r(13),q=r(39),X=r(74),Y=r(59),K=r(102),Q=r(60),Z=r(103),J=r(97),$=r(46),tt=r(104),et=r(65),rt=r(69),it=r(67),nt=r(70),at=r(122),st=r(123),ot=r(124),ht=r(125),ut=r(30),ct=r(68),lt=r(29),dt=r(73),_t=r(40),ft=r(126),gt=r(11),pt=r(127),mt=r(41),vt=r(128),St=r(7),xt=r(129),bt=r(130),yt=r(34),Mt=r(8),Tt=r(131),At=r(49),Ct=r(37),It={};It.AutoTransform=i,It.BillboardAttribute=n,It.BlendColor=a,It.BlendFunc=s,It.BoundingBox=o,It.BoundingSphere=h,It.BufferArray=u,It.ColorMask=l,It.Camera=c,It.ColorMask=l,It.ComputeBoundsVisitor=d,St.objectMix(It,_),It.CullFace=f,It.CullingSet=g,It.CullSettings=p,It.CullStack=m,It.CullVisitor=v,It.Depth=S,It.DrawArrayLengths=x,It.DrawArrays=b,It.DrawElements=y,It.EllipsoidModel=M,It.WGS_84_RADIUS_EQUATOR=M.WGS_84_RADIUS_EQUATOR,It.WGS_84_RADIUS_POLAR=M.WGS_84_RADIUS_POLAR,It.FrameBufferObject=T,It.FrameStamp=A,It.Geometry=C,It.GLObject=I,It.Image=w,It.ImageStream=E,It.KdTree=N,It.KdTreeBuilder=R,It.Light=F,It.LightSource=P,It.LineWidth=L,It.Lod=O,It.Material=D,St.objectMix(It,V),It.MatrixTransform=B,It.PooledResource=k,It.PooledArray=U,It.PooledMap=G,It.Node=j,It.NodeVisitor=z,St.objectMix(It,W),It.Object=H,It.Options=q,It.PagedLOD=X,It.Plane=Q,It.PointSizeAttribute=K,It.Polytope=Y,It.primitiveSet=$,It.primitiveFunctor=Z,It.primitiveIndexFunctor=J,It.Program=tt,It.Projection=et,It.RenderBin=rt,It.RenderLeaf=it,It.RenderStage=nt,It.Shader=at,St.objectMix(It,st),It.StackObjectPairPool=ot,It.State=ht,It.StateAttribute=ut,It.StateGraph=ct,It.StateSet=lt,It.Scissor=bt,It.Switch=dt,It.Texture=_t,It.TextureCubeMap=ft,It.Transform=gt,It.TriangleIndexFunctor=pt,It.Uniform=mt,It.UpdateVisitor=vt,St.objectMix(It,St),It.Viewport=xt,It.VertexArrayObject=At;var wt=r(15);It.vec2=wt.vec2,It.vec3=wt.vec3,It.vec4=wt.vec4,It.quat=wt.quat,It.mat3=wt.mat3,It.mat4=wt.mat4,It.Transform.RELATIVE_RF=yt.RELATIVE_RF,It.Transform.ABSOLUTE_RF=yt.ABSOLUTE_RF,It.Timer=Mt,It.TimerGPU=Tt,It.WebGLCaps=Ct,t.exports=It},function(t,e,r){"use strict";var i=r(7),n=r(11),a=r(15).vec3,s=r(15).vec4,o=r(15).quat,h=r(15).mat4,u=r(31),c=r(34),l=r(12),d=function(){n.call(this),this._matrix=h.create(),this._position=a.create(),this._matrixDirty=!0,this._scale=a.fromValues(1,1,1),this._minimumScale=0,this._maximumScale=Number.MAX_VALUE,this._rotation=o.create(),this._pivotPoint=a.create(),this._autoScaleToScreen=!1,this._autoRotateToScreen=!1,this._cachedMatrix=h.create(),this._firstTimeToInitEyePoint=!0,this._autoScaleTransitionWidthRatio=.25,this._billboardAttribute=void 0,this._previousWidth=0,this._previousHeight=0,this._previousProjection=h.create(),this._previousModelView=h.create(),this._previousPosition=a.create()};i.createPrototypeNode(d,i.objectInherit(n.prototype,{getMatrix:function(){return this._matrix},setMatrix:function(t){this._matrix=t,this.dirtyBound()},setPosition:function(t){this._position=t,this._matrixDirty=!0,this.dirtyBound()},getPosition:function(){return this._position},setRotation:function(t){this._rotation=t,this._matrixDirty=!0,this.dirtyBound()},getRotation:function(){return this._rotation},setScale:function(t){this.setScaleFromvec3(a.fromValues(t,t,t))},setScaleFromvec3:function(t){this._scale=t,this._matrixDirty=!0,this.dirtyBound()},getScale:function(){return this._scale},setMinimumScale:function(t){this._minimumScale=t},getMinimumScale:function(){return this._minimumScale},setMaximumScale:function(t){this._maximumScale=t},getMaximumScale:function(){return this._maximumScale},setAutoScaleToScreen:function(t){this._autoScaleToScreen=t,this._matrixDirty=!0},getAutoScaleToScreen:function(){return this._autoScaleToScreen},setAutoRotateToScreen:function(t){this._autoRotateToScreen=t},getAutoRotateToScreen:function(){return this._autoRotateToScreen},setAutoScaleTransitionWidthRatio:function(t){this._autoScaleTransitionWidthRatio=t},getAutoScaleTransitionWidthRatio:function(){return this._autoScaleTransitionWidthRatio},computeLocalToWorldMatrix:function(t){this._matrixDirty&&this.computeMatrix(),this.referenceFrame===c.RELATIVE_RF?h.mul(t,t,this._matrix):h.copy(t,this._matrix)},computeMatrix:function(){var t=a.create(),e=h.create();return function(){this._matrixDirty&&(h.fromQuat(this._matrix,this._rotation),h.fromTranslation(e,this._position),h.mul(this._matrix,e,this._matrix),h.scale(this._matrix,this._matrix,this._scale),h.translate(this._matrix,this._matrix,a.neg(t,this._pivotPoint)),this._matrixDirty=!1)}}(),computeWorldToLocalMatrix:function(){var t=a.create(),e=o.create(),r=a.create(),i=h.create();return function(n){return(0!==this.scale[0]||0!==this.scale[1]||0!==this.scale[2])&&(r[0]=1/this._scale[0],r[1]=1/this._scale[1],r[2]=1/this._scale[2],this.referenceFrame===c.RELATIVE_RF?(h.fromTranslation(i,a.neg(t,this._position)),h.mul(n,i,n),o.zeroRotation(this._rotation)||(h.fromQuat(i,o.invert(e,this._rotation)),h.mul(n,i,n)),h.fromScaling(i,r),h.mul(n,i,n),h.fromTranslation(i,this._pivotPoint),h.mul(n,i,n)):(h.fromQuat(this._matrix,o.invert(e,this._rotation)),h.translate(n,n,a.neg(t,this._position)),h.fromScaling(i,r),h.mul(n,i,n),h.fromTranslation(i,this._pivotPoint),h.mul(n,i,n)),!0)}}(),computeBound:function(){var t=h.create();return function(e){return this._autoScaleToScreen&&this._firstTimeToInitEyePoint?e:(l.prototype.computeBound.call(this,e),e.valid()?(h.identity(t),this.computeLocalToWorldMatrix(t),e.transformMat4(e,t),e):e)}}(),accept:function(){return function(t){if(t.getVisitorType()===u.CULL_VISITOR){var e=t.getViewport().width(),r=t.getViewport().height(),i=t.getCurrentProjectionMatrix(),n=t.getCurrentModelViewMatrix(),c=this._position,d=this._firstTimeToInitEyePoint;if(this._firstTimeToInitEyePoint||(e!==this._previousWidth||r!==this._previousHeight?d=!0:h.exactEquals(i,this._previousProjection)&&h.exactEquals(n,this._previousModelView)?a.exactEquals(c,this._previousPosition)||(d=!0):d=!0),this._firstTimeToInitEyePoint=!1,d){if(this._autoScaleToScreen){var _=t.getViewport(),f=this.computePixelSizeVector(_,i,n),g=s.fromValues(this._position[0],this._position[1],this._position[2],1),p=s.dot(g,f);p=.48/p;var m=1/p;if(this._autoScaleTransitionWidthRatio>0){var v,S,x;if(this._minimumScale>0){var b=this._minimumScale,y=this._maximumScale<Number.MAX_VALUE?this._minimumScale+(this._maximumScale-this._minimumScale)*this._autoScaleTransitionWidthRatio:this._minimumScale*(1+this._autoScaleTransitionWidthRatio);v=1/(4*(y-b)),S=1-2*v*y,x=b+S*S/(4*v);var M=-S/(2*v);m<M?m=this._minimumScale:m<y&&(m=x+S*m+v*(m*m))}if(this._maximumScale<Number.MAX_VALUE){var T=this._maximumScale,A=this._minimumScale>0?this._maximumScale+(this._minimumScale-this._maximumScale)*this._autoScaleTransitionWidthRatio:this._maximumScale*(1-this._autoScaleTransitionWidthRatio);v=1/(4*(A-T)),S=1-2*v*A,x=T+S*S/(4*v);var C=-S/(2*v);m>C?m=this._maximumScale:m>A&&(m=x+S*m+v*(m*m))}}this.setScale(m)}if(this._autoRotateToScreen){var I=o.create();h.getRotation(I,n),this.setRotation(o.invert(I,I))}this._previousWidth=e,this._previousHeight=r,a.copy(this._previousPosition,c),h.copy(this._previousProjection,i),h.copy(this._previousModelView,n)}}l.prototype.accept.call(this,t)}}(),computePixelSizeVector:function(){var t=a.create(),e=a.create();return function(r,i,n){var o=i[0]*r.width()*.5,h=i[8]*r.width()*.5+i[11]*r.width()*.5;a.set(t,n[0]*o+n[2]*h,n[4]*o+n[6]*h,n[8]*o+n[10]*h);var u=i[5]*r.height()*.5,c=i[9]*r.height()*.5+i[11]*r.height()*.5;a.set(e,n[1]*u+n[2]*c,n[5]*u+n[6]*c,n[9]*u+n[10]*c);var l=i[11],d=i[15],_=s.fromValues(n[2]*l,n[6]*l,n[10]*l,n[14]*l+n[15]*d),f=.7071067811/Math.sqrt(a.sqrLen(t)+a.sqrLen(e));return s.scale(_,_,f),_}}()}),"osg","AutoTransform"),t.exports=d},function(t,e,r){"use strict";var i=r(8),n=r(9),a={};a.extend=function(){var t,e,r,i,n=window.Object.prototype.toString,s=window.Object.prototype.hasOwnProperty,o=function(t){return"[object Function]"===n.call(t)},h=a.isArray,u=function(t){if(!t||"[object Object]"!==n.call(t)||t.nodeType||t.setInterval)return!1;if(t.constructor&&!s.call(t,"constructor")&&!s.call(t.constructor.prototype,"isPrototypeOf"))return!1;var e;for(e in t);return void 0===e||s.call(t,e)},c=arguments[0]||{},l=1,d=arguments.length,_=!1;for("boolean"==typeof c&&(_=c,c=arguments[1]||{},l=2),"object"==typeof c||o(c)||(c={}),d===l&&(c=this,--l);l<d;l++)if(null!==(t=arguments[l]))for(e in t)if(r=c[e],i=t[e],c!==i)if(_&&i&&(u(i)||h(i))){var f=r&&(u(r)||h(r))?r:h(i)?[]:{};c[e]=a.extend(_,f,i)}else void 0!==i&&(c[e]=i);return c},a.objectInherit=function(t){function e(){}e.prototype=t;for(var r=new e,i=1;i<arguments.length;i++)a.objectMix(r,arguments[i],!1);return r},a.objectMix=function(t,e,r){for(var i in e)r&&t[i]||(t[i]=e[i]);return t},a.objectType={},a.objectType.type=0,a.objectLibraryClass=function(t,e,r){t.className=function(){return r},t.libraryName=function(){return e};var i=e+"::"+r;return t.libraryClassName=function(){return i},t},a.setTypeID=function(t){var e=t.prototype.libraryClassName(),r=a.generateId(a.objectType,e),i=function(){return r};t.typeID=t.prototype.typeID=r,t.getTypeID=t.prototype.getTypeID=i},a.createPrototypeObject=function(t,e,r,i){e.hasOwnProperty("getTypeID")&&(e=a.objectInherit(e,{})),t.prototype=e,e.constructor=t,r&&i&&(a.objectLibraryClass(e,r,i),a.setTypeID(t))},a.generateId=function(t,e){if(void 0!==t[e])return n.error(e+" is already defined, change class name or library name"),-1;var r=t.type;return t[r]=e,t[e]=r,t.type+=1,r},a.objectNodeType={},a.objectNodeType.type=0,a.setNodeTypeID=function(t){var e=t.prototype.libraryClassName(),r=a.generateId(a.objectNodeType,e),i=function(){return r};t.nodeTypeID=t.prototype.nodeTypeID=r,t.getNodeTypeID=t.prototype.getNodeTypeID=i},a.createPrototypeNode=function(t,e,i,n){var s=r(10),o=e.nodeTypeID;if(a.createPrototypeObject(t,e,i,n),i&&n){a.setNodeTypeID(t);var h=t.nodeTypeID;s.registerApplyFunction(h,s.getApplyFunction(o))}};var s=0,o=0,h={},u={},c=0,l={};a.getStateAttributeTypeNameToTypeId=function(){return l},a.createPrototypeStateAttribute=function(t,e,r,i){a.createPrototypeObject(t,e,r,i);var n=a.getOrCreateStateAttributeTypeId(t);t.prototype.attributeTypeId=n},a.getMaxStateAttributeTypeID=function(){return c},a.getOrCreateStateAttributeTypeId=function(t){var e=t.prototype.getType();if(l[e])return l[e];var r=c++;return l[e]=r,r},a.getOrCreateStateAttributeTypeMemberIndex=function(t){if(void 0!==t._attributeTypeIndex)return t._attributeTypeIndex;var e=t.getTypeMember();return t._attributeTypeIndex=a.getOrCreateStateAttributeTypeMemberIndexFromName(e),t._attributeTypeIndex},a.getOrCreateStateAttributeTypeMemberIndexFromName=function(t){var e=h[t];return void 0!==e?e:(e=s++,h[t]=e,e)},a.getOrCreateTextureStateAttributeTypeMemberIndex=function(t){if(void 0!==t._attributeTypeIndex)return t._attributeTypeIndex;var e=t.getTypeMember();return t._attributeTypeIndex=a.getOrCreateTextureStateAttributeTypeMemberIndexFromName(e),t._attributeTypeIndex},a.getOrCreateTextureStateAttributeTypeMemberIndexFromName=function(t){var e=u[t];return void 0!==e?e:(e=o++,u[t]=e,e)},a.getIdFromTypeMember=function(t){return h[t]},a.getTextureIdFromTypeMember=function(t){return u[t]},a.Float32Array="undefined"!=typeof Float32Array?Float32Array:null,a.Int32Array="undefined"!=typeof Int32Array?Int32Array:null,a.Uint8Array="undefined"!=typeof Uint8Array?Uint8Array:null,a.Uint16Array="undefined"!=typeof Uint16Array?Uint16Array:null,a.Uint32Array="undefined"!=typeof Uint32Array?Uint32Array:null;var d={},_={};a.logTime=(n.console.time||function(t){d[t]=i.instance().tick()}).bind(n.console),a.logTimeEnd=(n.console.timeEnd||function(t){if(void 0!==d[t]){var e=i.instance().deltaM(d[t],i.instance().tick());n.log(t+": "+e+"ms"),d[t]=void 0}}).bind(n.console),a.time=function(t,e){var r=e;void 0===r&&(r=n.NOTICE),r>n.getNotifyLevel()||(_[t]=1,a.logTime(t))},a.timeEnd=function(t){void 0!==_[t]&&a.logTimeEnd(t)},a.timeStamp=(n.console.timeStamp||n.console.markTimeline||function(){}).bind(n.console),a.profile=(n.console.profile||function(){}).bind(n.console),a.profileEnd=(n.console.profileEnd||function(){}).bind(n.console),a.arrayUniq=function(t){for(var e=t.length,r={},i=[],n=0,a=0;a<e;a++){var s=t[a];1!==r[s]&&(r[s]=1,i[n++]=s)}return i},t.exports=a},function(t,e){(function(e){"use strict";var r=function(){var t=window||e;if(void 0===t.performance)return function(){return Date.now()};var r=t.performance.now||t.performance.mozNow||t.performance.msNow||t.performance.oNow||t.performance.webkitNow||function(){return Date.now()};return function(){return r.apply(t.performance,arguments)}}(),i=function(){};i.instance=function(){return i._instance||(i._instance=new i),i._instance},i.prototype={deltaS:function(t,e){return(e-t)/1e3},deltaM:function(t,e){return e-t},tick:function(){return r()}},t.exports=i}).call(e,function(){return this}())},function(t,e){"use strict";function r(t,e,r){!o.console||t>o.currentNotifyLevel||(o.console[e](r),o.traceLogCall&&t!==o.ERROR&&console.trace())}function i(t,e,r,i){!o.console||t>o.currentNotifyLevel||(o.console.groupCollapsed&&o.console.groupCollapsed(r),o.console[e](i),o.traceLogCall&&t!==o.ERROR&&console.trace(),o.console.groupEnd&&o.console.groupEnd())}function n(t,e){return e?[t.slice(0,4),t.slice(4,8),t.slice(8,12),t.slice(12,16)]:[[t[0],t[4],t[8],t[12]],[t[1],t[5],t[9],t[13]],[t[2],t[6],t[10],t[14]],[t[3],t[7],t[11],t[15]]]}function a(t,e,i){t>o.currentNotifyLevel||o.console.table&&r("table",n(e,i))}function s(t,e,r,a){t>o.currentNotifyLevel||o.console.table&&i("table",e,n(r,a))}var o={};o.ALWAYS=0,o.FATAL=o.ERROR=1,o.WARN=2,o.NOTICE=o.LOG=3,o.INFO=4,o.DEBUG=5,o.currentNotifyLevel=o.LOG,o.console=window.console;for(var h=["error","warn","log","info","debug"],u=0;u<h.length;++u){var c=h[u],l=o[c.toUpperCase()];o[c]=r.bind(o,l,c),o[c+"Fold"]=i.bind(o,l,c),o[c+"Matrix"]=a.bind(o,l),o[c+"MatrixFold"]=s.bind(o,l)}o.notice=o.log,o.noticeFold=o.logFold,o.noticeMatrix=o.logMatrix,o.noticeMatrixFold=o.logMatrixFold,o.assert=function(t,e){void 0===this.console||t||this.console.assert(t,e)},o.setNotifyLevel=function(t,e){o.currentNotifyLevel=t,void 0!==e&&(o.traceLogCall=e)},o.getNotifyLevel=function(){return o.currentNotifyLevel},o.reportWebGLError=!1,o.setConsole=function(t){o.console=t},t.exports=o},function(t,e){"use strict";var r=[],i=function(t,e){r[t]=e},n=function(t){return r[t]};t.exports={applyFunctionArray:r,registerApplyFunction:i,getApplyFunction:n}},function(t,e,r){"use strict";var i=r(7),n=r(12),a=r(15).mat4,s=r(34),o=function(){n.call(this),this.referenceFrame=s.RELATIVE_RF};i.createPrototypeNode(o,i.objectInherit(n.prototype,{setReferenceFrame:function(t){this.referenceFrame=t},getReferenceFrame:function(){return this.referenceFrame},computeBoundingSphere:function(){var t=a.create();return function(e){return n.prototype.computeBoundingSphere.call(this,e),e.valid()?(a.identity(t),this.computeLocalToWorldMatrix(t),e.transformMat4(e,t),e):e}}()}),"osg","Transform"),t.exports=o},function(t,e,r){"use strict";var i=r(7),n=r(13),a=r(14),s=r(28),o=r(29),h=r(31),u=r(15).mat4,c=r(32),l=r(33),d=r(34),_=function(){n.call(this),this.children=[],this._parents=[],this.nodeMask=-1,this._boundingSphere=new s,this._boundingSphereComputed=!1,this._boundingBox=new a,this._boundingBoxComputed=!1,this._updateCallbacks=[],this._cullCallback=void 0,this._cullingActive=!0,this._numChildrenWithCullingDisabled=0,this._numChildrenRequiringUpdateTraversal=0,this._tmpBox=new a},f=new c(u.create),g=function(){var t=f.getOrCreateObject();return u.identity(t)};i.createPrototypeNode(_,i.objectInherit(n.prototype,{getOrCreateStateSet:function(){return this.stateset||this.setStateSet(new o),this.stateset},getStateSet:function(){return this.stateset},accept:function(t){t.validNodeMask(this)&&(t.pushOntoNodePath(this),t.apply(this),t.popFromNodePath())},dirtyBound:function(){if(this._boundingSphereComputed===!0||this._boundingBoxComputed===!0){this._boundingSphereComputed=!1,this._boundingBoxComputed=!1;for(var t=this._parents,e=0,r=t.length;e<r;e++)t[e].dirtyBound()}},setNodeMask:function(t){this.nodeMask=t},getNodeMask:function(){return this.nodeMask},setStateSet:function(t){if(this.stateset!==t){var e=0;this.stateset&&(this.stateset.requiresUpdateTraversal()&&e--,this.stateset.removeParent(this)),t&&(t.addParent(this),t.requiresUpdateTraversal()&&++e),0!==e&&this.setNumChildrenRequiringUpdateTraversal(this.getNumChildrenRequiringUpdateTraversal()+e),this.stateset=t}},_updateNumChildrenRequeringUpdateTraversal:function(t){if(0===this._numChildrenRequiringUpdateTraversal&&this._parents.length)for(var e=0,r=this._parents.length;e<r;e++){var i=this._parents[e],n=i.getNumChildrenRequiringUpdateTraversal();i.setNumChildrenRequiringUpdateTraversal(n+t)}},setNumChildrenRequiringUpdateTraversal:function(t){if(this._numChildrenRequiringUpdateTraversal!==t){if(!this._updateCallbacks.length&&this._parents.length){var e=0;if(this._numChildrenRequiringUpdateTraversal>0&&--e,t>0&&++e,0!==e)for(var r=this._parents,i=0,n=r.length;i<n;i++){var a=r[i],s=a.getNumChildrenRequiringUpdateTraversal();a.setNumChildrenRequiringUpdateTraversal(s+e)}}this._numChildrenRequiringUpdateTraversal=t}},getNumChildrenRequiringUpdateTraversal:function(){return this._numChildrenRequiringUpdateTraversal},getUpdateCallback:function(){return this._updateCallbacks[0]},addUpdateCallback:function(t){var e=Boolean(this._updateCallbacks.length);this._updateCallbacks.push(t),e||this._updateNumChildrenRequeringUpdateTraversal(1)},removeUpdateCallback:function(t){var e=this._updateCallbacks.indexOf(t);e!==-1&&(this._updateCallbacks.splice(e,1),this._updateCallbacks.length||this._updateNumChildrenRequeringUpdateTraversal(-1))},getUpdateCallbackList:function(){return this._updateCallbacks},setCullCallback:function(t){this._cullCallback=t},getCullCallback:function(){return this._cullCallback},hasChild:function(t){for(var e=0,r=this.children.length;e<r;e++)if(this.children[e]===t)return!0;return!1},addChild:function(t){if(this.children.indexOf(t)===-1)return this.children.push(t),t.addParent(this),this.dirtyBound(),(t.getNumChildrenRequiringUpdateTraversal()>0||t.getUpdateCallbackList().length)&&this.setNumChildrenRequiringUpdateTraversal(this.getNumChildrenRequiringUpdateTraversal()+1),(t.getNumChildrenWithCullingDisabled()>0||t.getCullingActive()===!1)&&this.setNumChildrenWithCullingDisabled(this.getNumChildrenWithCullingDisabled()+1),t},getChildren:function(){return this.children},getNumChildren:function(){return this.children.length},getChild:function(t){return this.children[t]},getParents:function(){return this._parents},addParent:function(t){this._parents.push(t)},removeParent:function(t){var e=this._parents.indexOf(t);e!==-1&&this._parents.splice(e,1)},removeChildren:function(){var t=this.children,e=t.length;if(e){for(var r=0,i=0;i<e;i++){var n=t[i];n.removeParent(this),(n.getNumChildrenRequiringUpdateTraversal()>0||n.getUpdateCallbackList().length)&&++r}t.length=0,r&&this.setNumChildrenRequiringUpdateTraversal(this.getNumChildrenRequiringUpdateTraversal()-r),this.dirtyBound()}},removeChild:function(t){var e=this.children,r=e.indexOf(t);r!==-1&&(t.removeParent(this),e.splice(r,1),this.dirtyBound(),(t.getNumChildrenRequiringUpdateTraversal()>0||t.getUpdateCallbackList().length)&&this.setNumChildrenRequiringUpdateTraversal(this.getNumChildrenRequiringUpdateTraversal()-1))},traverse:function(t){for(var e=this.children,r=0,i=e.length;r<i;r++){var n=e[r];n.accept(t)}},ascend:function(t){for(var e=this._parents,r=0,i=e.length;r<i;r++){var n=e[r];n.accept(t)}},getBoundingBox:function(){return this._boundingBoxComputed||(this.computeBoundingBox(this._boundingBox),this._boundingBoxComputed=!0),this._boundingBox},computeBoundingBox:function(t){var e=r(35),i=e.instance=e.instance||new e;return i.setNodeMaskOverride(-1),i.reset(),i.apply(this),t.copy(i.getBoundingBox()),t},getBoundingSphere:function(){return this.getBound()},getBound:function(){return this._boundingSphereComputed||(this.computeBoundingSphere(this._boundingSphere),this._boundingSphereComputed=!0),this._boundingSphere},computeBoundingSphere:function(t){var e=this.children,r=e.length;if(t.init(),0===r)return t;var i,n,a=this._tmpBox;for(a.init(),n=0;n<r;n++)i=e[n],i.referenceFrame!==d.ABSOLUTE_RF&&a.expandByBoundingSphere(i.getBound());if(!a.valid())return t;for(t.set(a.center(t.center()),0),n=0;n<r;n++)i=e[n],i.referenceFrame!==d.ABSOLUTE_RF&&t.expandRadiusBySphere(i.getBound());return t},getWorldMatrices:function(){var t=function(){this.nodePaths=[],this.halt=void 0,h.call(this,h.TRAVERSE_PARENTS)};t.prototype=i.objectInherit(h.prototype,{reset:function(){this.nodePath.length=0,this.nodePaths.length=0},apply:function(t){0===t._parents.length||t===this.halt||t.referenceFrame===d.ABSOLUTE_RF?this.nodePaths.push(this.nodePath.slice(0)):this.traverse(t)}});var e=new t;return e.setNodeMaskOverride(-1),function(t,r){e.reset(),e.halt=t,this.accept(e);for(var i=[],n=r||u.create,a=0,s=e.nodePaths.length;a<s;a++){var o=e.nodePaths[a],h=n();0!==o.length&&l.computeLocalToWorld(o,!0,h),i.push(h)}return i}}(),getWorldMatrix:function(t,e){var r=this.getWorldMatrices(t,g);return 0===r.length?u.identity(e):u.copy(e,r[0]),f.reset(),e},setCullingActive:function(t){if(this._cullingActive!==t){if(0===this._numChildrenWithCullingDisabled&&this._parents.length>0){var e=0;if(this._cullingActive||--e,t||++e,0!==e)for(var r=0,i=this._parents.length;r<i;r++)this._parents[r].setNumChildrenWithCullingDisabled(this._parents[r].getNumChildrenWithCullingDisabled()+e)}this._cullingActive=t}},getCullingActive:function(){return this._cullingActive},isCullingActive:function(){return 0===this._numChildrenWithCullingDisabled&&this._cullingActive&&this.getBound().valid()},setNumChildrenWithCullingDisabled:function(t){if(this._numChildrenWithCullingDisabled!==t){if(this._cullingActive&&this._parents.length>0){var e=0;if(this._numChildrenWithCullingDisabled>0&&--e,t>0&&++e,0!==e)for(var r=0,i=this._parents.length;r<i;r++)this._parents[r].setNumChildrenWithCullingDisabled(this._parents[r].getNumChildrenWithCullingDisabled()+e)}this._numChildrenWithCullingDisabled=t}},getNumChildrenWithCullingDisabled:function(){return this._numChildrenWithCullingDisabled},releaseGLObjects:function(){void 0!==this.stateset&&this.stateset.releaseGLObjects()}}),"osg","Node"),t.exports=_},function(t,e,r){"use strict";var i=r(7),n=function(){this._name=void 0,this._userdata=void 0,this._instanceID=n.getInstanceID()};i.createPrototypeObject(n,{cloneType:function(){var t=this.constructor;return new t},getInstanceID:function(){return this._instanceID},setName:function(t){this._name=t},getName:function(){return this._name},setUserData:function(t){this._userdata=t},getUserData:function(){return this._userdata}},"osg","Object");var a=0;n.getInstanceID=function(){return a+=1},t.exports=n},function(t,e,r){"use strict";var i=r(7),n=r(15).vec3,a=r(15).mat4,s=function(){this._min=n.create(),this._max=n.create(),this.init()};i.createPrototypeObject(s,{init:function(){n.copy(this._min,n.INFINITY),n.copy(this._max,n.NEGATIVE_INFINITY)},copy:function(t){var e=this._min,r=t._min;e[0]=r[0],e[1]=r[1],e[2]=r[2];var i=this._max,n=t._max;i[0]=n[0],i[1]=n[1],i[2]=n[2]},valid:function(){return this._max[0]>=this._min[0]&&this._max[1]>=this._min[1]&&this._max[2]>=this._min[2]},expandByBoundingSphere:function(t){if(t.valid()){var e=this._max,r=this._min,i=t._radius,n=t._center[0],a=t._center[1],s=t._center[2];r[0]=Math.min(r[0],n-i),r[1]=Math.min(r[1],a-i),r[2]=Math.min(r[2],s-i),e[0]=Math.max(e[0],n+i),e[1]=Math.max(e[1],a+i),e[2]=Math.max(e[2],s+i)}},expandByvec3:function(t){var e=this._min,r=this._max;e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),r[0]=Math.max(r[0],t[0]),r[1]=Math.max(r[1],t[1]),r[2]=Math.max(r[2],t[2])},expandByBoundingBox:function(t){if(t.valid()){var e=this._min,r=this._max,i=t._min,n=t._max;i[0]<e[0]&&(e[0]=i[0]),n[0]>r[0]&&(r[0]=n[0]),i[1]<e[1]&&(e[1]=i[1]),n[1]>r[1]&&(r[1]=n[1]),i[2]<e[2]&&(e[2]=i[2]),n[2]>r[2]&&(r[2]=n[2])}},center:function(t){var e=this._min,r=this._max;return t[0]=.5*(e[0]+r[0]),t[1]=.5*(e[1]+r[1]),t[2]=.5*(e[2]+r[2]),t},radius:function(){return Math.sqrt(this.radius2())},radius2:function(){var t=this._min,e=this._max,r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return.25*(r*r+i*i+n*n)},getMin:function(){return this._min},getMax:function(){return this._max},setMin:function(t){return n.copy(this._min,t),this},setMax:function(t){return n.copy(this._max,t),this},xMax:function(){return this._max[0]},yMax:function(){return this._max[1]},zMax:function(){return this._max[2]},xMin:function(){return this._min[0]},yMin:function(){return this._min[1]},zMin:function(){return this._min[2]},corner:function(t,e){return 1&t?e[0]=this._max[0]:e[0]=this._min[0],2&t?e[1]=this._max[1]:e[1]=this._min[1],4&t?e[2]=this._max[2]:e[2]=this._min[2],e},transformMat4:function(){var t=n.create(),e=n.create();return function(r,i){var s=this.getMin(),o=this.getMax();a.getTranslation(t,i),n.copy(e,t);for(var h=0;h<3;++h)for(var u=4*h,c=s[h],l=o[h],d=0;d<3;++d){var _=i[u+d],f=_*l,g=_*c;f<g?(t[d]+=f,e[d]+=g):(t[d]+=g,e[d]+=f)}var p=r.getMax(),m=r.getMin();return p[0]=e[0],p[1]=e[1],p[2]=e[2],m[0]=t[0],m[1]=t[1],m[2]=t[2],r}}()},"osg","BoundingBox"),t.exports=s},function(t,e,r){"use strict";var i=r(16),n=r(17),a=r(27);n.glMatrix.setMatrixArrayType(a.ArrayType),n.glMatrix.EPSILON=1e-9;var s=n.vec2,o=n.vec3,h=n.vec4,u=n.mat4,c=n.mat3,l=n.quat;o.create32=function(){return new Float32Array(3)},o.create64=function(){return new Float64Array(3)},o.fromValues32=function(t,e,r){var i=new Float32Array(3);return i[0]=t,i[1]=e,i[2]=r,i},o.fromValues64=function(t,e,r){var i=new Float64Array(3);return i[0]=t,i[1]=e,i[2]=r,i},o.init=function(t){return o.set(t,0,0,0)},o.transformMat4Rotate=function(t,e,r){var i=e[0],n=e[1],a=e[2];return t[0]=r[0]*i+r[1]*n+r[2]*a,t[1]=r[4]*i+r[5]*n+r[6]*a,t[2]=r[8]*i+r[9]*n+r[10]*a,t},o.valid=function(t){return!i.isNaN(t[0])&&(!i.isNaN(t[1])&&!i.isNaN(t[2]))},o.neg=o.negate,o.ZERO=o.create(),o.ONE=o.fromValues(1,1,1),o.INFINITY=o.fromValues(1/0,1/0,1/0),o.NEGATIVE_INFINITY=o.fromValues(-(1/0),-(1/0),-(1/0)),s.create32=function(){return new Float32Array(2)},s.create64=function(){return new Float64Array(2)},s.fromValues32=function(t,e){var r=new Float32Array(2);return r[0]=t,r[1]=e,r},s.fromValues64=function(t,e){var r=new Float64Array(2);return r[0]=t,r[1]=e,r},s.init=function(t){return s.set(t,0,0)},s.valid=function(t){return!i.isNaN(t[0])&&!i.isNaN(t[1])},s.ZERO=s.create(),s.ONE=s.fromValues(1,1),s.INFINITY=s.fromValues(1/0,1/0),s.NEGATIVE_INFINITY=s.fromValues(-(1/0),-(1/0)),h.create32=function(){return new Float32Array(4)},h.create64=function(){return new Float64Array(4)},h.fromValues32=function(t,e,r,i){var n=new Float32Array(4);return n[0]=t,n[1]=e,n[2]=r,n[3]=i,n},h.fromValues64=function(t,e,r,i){var n=new Float64Array(4);return n[0]=t,n[1]=e,n[2]=r,n[3]=i,n},h.init=function(t){return h.set(t,0,0,0,0)},h.valid=function(t){return!i.isNaN(t[0])&&(!i.isNaN(t[1])&&(!i.isNaN(t[2])&&!i.isNaN(t[3])))},h.neg=h.negate,h.ZERO=h.create(),h.ONE=h.fromValues(1,1,1,1),h.INFINITY=h.fromValues(1/0,1/0,1/0,1/0),h.NEGATIVE_INFINITY=h.fromValues(-(1/0),-(1/0),-(1/0),-(1/0)),l.IDENTITY=l.create(),l.zeroRotation=function(t){return 0===t[0]&&0===t[1]&&0===t[2]&&1===t[3]},l.create32=function(){var t=new Float32Array(4);return t[3]=1,t},l.create64=function(){var t=new Float64Array(4);return t[3]=1,t},l.fromValues32=h.fromValues32,l.fromValues64=h.fromValues64,l.init=l.identity,l.nlerp=function(t,e,r,i){var n,a,s,o,h=e[0],u=e[1],c=e[2],l=e[3],d=r[0],_=r[1],f=r[2],g=r[3],p=h*d+u*_+c*f+l*g,m=1-i;p<0?(n=h*m-d*i,a=u*m-_*i,s=c*m-f*i,o=l*m-g*i):(n=h*m+d*i,
a=u*m+_*i,s=c*m+f*i,o=l*m+g*i);var v=1/Math.sqrt(n*n+a*a+s*s+o*o);return t[0]=n*v,t[1]=a*v,t[2]=s*v,t[3]=o*v,t},c.IDENTITY=c.create(),c.create32=function(){var t=new Float32Array(9);return t[0]=t[4]=t[8]=1,t},c.create64=function(){var t=new Float64Array(9);return t[0]=t[4]=t[8]=1,t},u.IDENTITY=u.create(),u.create32=function(){var t=new Float32Array(16);return t[0]=t[5]=t[10]=t[15]=1,t},u.create64=function(){var t=new Float64Array(16);return t[0]=t[5]=t[10]=t[15]=1,t},u.setTranslation=function(t,e){return t[12]=e[0],t[13]=e[1],t[14]=e[2],t},u.getFrustum=function(t,e){var r,i,n=0,a=0,s=0,o=0;if(0!==e[3]||0!==e[7]||e[11]!==-1||0!==e[15])return!1;var h=e[14]/(e[10]-1),u=e[14]/(1+e[10]);return a=h*(e[8]-1)/e[0],n=h*(1+e[8])/e[0],s=h*(1+e[9])/e[5],o=h*(e[9]-1)/e[5],r=h,i=u,t.left=a,t.right=n,t.top=s,t.bottom=o,t.zNear=r,t.zFar=i,!0},u.getPerspective=function(){var t={right:0,left:0,top:0,bottom:0,zNear:0,zFar:0};return function(e,r){var i=u.getFrustum(t,r);return i&&(e.fovy=180/Math.PI*(Math.atan(t.top/t.zNear)-Math.atan(t.bottom/t.zNear)),e.aspectRatio=(t.right-t.left)/(t.top-t.bottom)),e.zNear=t.zNear,e.zFar=t.zFar,e}}(),u.getLookAt=function(){var t=u.create(),e=o.create(),r=o.fromValues(0,1,0),i=o.fromValues(0,0,-1);return function(n,a,s,h,c){var l=void 0!==c?c:1;u.invert(t,h),u.getTranslation(n,t),o.transformMat4Rotate(s,r,h),o.transformMat4Rotate(a,i,h),o.normalize(a,a),o.add(a,o.scale(e,a,l),n)}}(),u.getFrustumPlanes=function(){var t=u.create();return function(e,r,i,n){u.mul(t,r,i);var a=!!n,s=e[0];s[0]=t[3]-t[0],s[1]=t[7]-t[4],s[2]=t[11]-t[8],s[3]=t[15]-t[12];var o=e[1];o[0]=t[3]+t[0],o[1]=t[7]+t[4],o[2]=t[11]+t[8],o[3]=t[15]+t[12];var h=e[2];h[0]=t[3]+t[1],h[1]=t[7]+t[5],h[2]=t[11]+t[9],h[3]=t[15]+t[13];var c=e[3];c[0]=t[3]-t[1],c[1]=t[7]-t[5],c[2]=t[11]-t[9],c[3]=t[15]-t[13];var l=4;if(a){l=6;var d=e[4];d[0]=t[3]-t[2],d[1]=t[7]-t[6],d[2]=t[11]-t[10],d[3]=t[15]-t[14];var _=e[5];_[0]=t[3]+t[2],_[1]=t[7]+t[6],_[2]=t[11]+t[10],_[3]=t[15]+t[14]}for(var f=0;f<l;f++){var g=e[f],p=1/Math.sqrt(g[0]*g[0]+g[1]*g[1]+g[2]*g[2]);g[0]*=p,g[1]*=p,g[2]*=p,g[3]*=p}}}(),u.infiniteFrustum=function(t,e,r,i,n,a){var s=2*a/(r-e),o=2*a/(n-i),h=(r+e)/(r-e),u=(n+i)/(n-i),c=-1;return t[0]=s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=h,t[9]=u,t[10]=c,t[11]=-1,t[12]=0,t[13]=0,t[14]=-2*a,t[15]=0,t},u.lookAtDirection=function(){var t=o.create(),e=o.create(),r=o.create();return function(i,n,a,s){var h=a;return o.cross(t,h,s),o.normalize(t,t),o.cross(e,t,h),o.normalize(e,e),i[0]=t[0],i[1]=e[0],i[2]=-h[0],i[3]=0,i[4]=t[1],i[5]=e[1],i[6]=-h[1],i[7]=0,i[8]=t[2],i[9]=e[2],i[10]=-h[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,u.translate(i,i,o.neg(r,n))}}(),u.getScale=function(){var t=o.create(),e=o.create(),r=o.create();return function(i,n){return t[0]=n[0],t[1]=n[4],t[2]=n[8],e[0]=n[1],e[1]=n[5],e[2]=n[9],r[0]=n[2],r[1]=n[6],r[2]=n[10],i[0]=o.length(t),i[1]=o.length(e),i[2]=o.length(r),i}}(),u.getSqrScale=function(){var t=o.create(),e=o.create(),r=o.create();return function(i,n){return t[0]=n[0],t[1]=n[4],t[2]=n[8],e[0]=n[1],e[1]=n[5],e[2]=n[9],r[0]=n[2],r[1]=n[6],r[2]=n[10],i[0]=o.sqrLen(t),i[1]=o.sqrLen(e),i[2]=o.sqrLen(r),i}}();var d=u.rotate;u.rotate=function(t,e,r,i){return d(t,e,r,i)||u.identity(t)};var _=u.fromRotation;u.fromRotation=function(t,e,r){return _(t,e,r)||u.identity(t)},t.exports=n},function(t,e){"use strict";var r=function(t,e,r){return Math.min(r,Math.max(e,t))},i=function(t,e,r){if(r<=t)return 0;if(r>=e)return 1;var i=(r-t)/(e-t);return i*i*(3-2*i)},n=function(t){return t!==t};t.exports={clamp:r,smoothStep:i,isNaN:n}},function(t,e,r){e.glMatrix=r(18),e.mat2=r(19),e.mat2d=r(20),e.mat3=r(21),e.mat4=r(22),e.quat=r(23),e.vec2=r(26),e.vec3=r(24),e.vec4=r(25)},function(t,e){var r={};r.EPSILON=1e-6,r.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,r.RANDOM=Math.random,r.ENABLE_SIMD=!1,r.SIMD_AVAILABLE=r.ARRAY_TYPE===Float32Array&&"SIMD"in this,r.USE_SIMD=r.ENABLE_SIMD&&r.SIMD_AVAILABLE,r.setMatrixArrayType=function(t){r.ARRAY_TYPE=t};var i=Math.PI/180;r.toRadian=function(t){return t*i},r.equals=function(t,e){return Math.abs(t-e)<=r.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))},t.exports=r},function(t,e,r){var i=r(18),n={};n.create=function(){var t=new i.ARRAY_TYPE(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},n.clone=function(t){var e=new i.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},n.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},n.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},n.fromValues=function(t,e,r,n){var a=new i.ARRAY_TYPE(4);return a[0]=t,a[1]=e,a[2]=r,a[3]=n,a},n.set=function(t,e,r,i,n){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t},n.transpose=function(t,e){if(t===e){var r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},n.invert=function(t,e){var r=e[0],i=e[1],n=e[2],a=e[3],s=r*a-n*i;return s?(s=1/s,t[0]=a*s,t[1]=-i*s,t[2]=-n*s,t[3]=r*s,t):null},n.adjoint=function(t,e){var r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t},n.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},n.multiply=function(t,e,r){var i=e[0],n=e[1],a=e[2],s=e[3],o=r[0],h=r[1],u=r[2],c=r[3];return t[0]=i*o+a*h,t[1]=n*o+s*h,t[2]=i*u+a*c,t[3]=n*u+s*c,t},n.mul=n.multiply,n.rotate=function(t,e,r){var i=e[0],n=e[1],a=e[2],s=e[3],o=Math.sin(r),h=Math.cos(r);return t[0]=i*h+a*o,t[1]=n*h+s*o,t[2]=i*-o+a*h,t[3]=n*-o+s*h,t},n.scale=function(t,e,r){var i=e[0],n=e[1],a=e[2],s=e[3],o=r[0],h=r[1];return t[0]=i*o,t[1]=n*o,t[2]=a*h,t[3]=s*h,t},n.fromRotation=function(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=-r,t[3]=i,t},n.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},n.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},n.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2))},n.LDU=function(t,e,r,i){return t[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-t[2]*r[1],[t,e,r]},n.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t},n.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t},n.sub=n.subtract,n.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},n.equals=function(t,e){var r=t[0],n=t[1],a=t[2],s=t[3],o=e[0],h=e[1],u=e[2],c=e[3];return Math.abs(r-o)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-h)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(a-u)<=i.EPSILON*Math.max(1,Math.abs(a),Math.abs(u))&&Math.abs(s-c)<=i.EPSILON*Math.max(1,Math.abs(s),Math.abs(c))},n.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},n.multiplyScalarAndAdd=function(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t},t.exports=n},function(t,e,r){var i=r(18),n={};n.create=function(){var t=new i.ARRAY_TYPE(6);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},n.clone=function(t){var e=new i.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},n.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},n.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},n.fromValues=function(t,e,r,n,a,s){var o=new i.ARRAY_TYPE(6);return o[0]=t,o[1]=e,o[2]=r,o[3]=n,o[4]=a,o[5]=s,o},n.set=function(t,e,r,i,n,a,s){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=a,t[5]=s,t},n.invert=function(t,e){var r=e[0],i=e[1],n=e[2],a=e[3],s=e[4],o=e[5],h=r*a-i*n;return h?(h=1/h,t[0]=a*h,t[1]=-i*h,t[2]=-n*h,t[3]=r*h,t[4]=(n*o-a*s)*h,t[5]=(i*s-r*o)*h,t):null},n.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},n.multiply=function(t,e,r){var i=e[0],n=e[1],a=e[2],s=e[3],o=e[4],h=e[5],u=r[0],c=r[1],l=r[2],d=r[3],_=r[4],f=r[5];return t[0]=i*u+a*c,t[1]=n*u+s*c,t[2]=i*l+a*d,t[3]=n*l+s*d,t[4]=i*_+a*f+o,t[5]=n*_+s*f+h,t},n.mul=n.multiply,n.rotate=function(t,e,r){var i=e[0],n=e[1],a=e[2],s=e[3],o=e[4],h=e[5],u=Math.sin(r),c=Math.cos(r);return t[0]=i*c+a*u,t[1]=n*c+s*u,t[2]=i*-u+a*c,t[3]=n*-u+s*c,t[4]=o,t[5]=h,t},n.scale=function(t,e,r){var i=e[0],n=e[1],a=e[2],s=e[3],o=e[4],h=e[5],u=r[0],c=r[1];return t[0]=i*u,t[1]=n*u,t[2]=a*c,t[3]=s*c,t[4]=o,t[5]=h,t},n.translate=function(t,e,r){var i=e[0],n=e[1],a=e[2],s=e[3],o=e[4],h=e[5],u=r[0],c=r[1];return t[0]=i,t[1]=n,t[2]=a,t[3]=s,t[4]=i*u+a*c+o,t[5]=n*u+s*c+h,t},n.fromRotation=function(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=-r,t[3]=i,t[4]=0,t[5]=0,t},n.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},n.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},n.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},n.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+1)},n.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t},n.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t},n.sub=n.subtract,n.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t},n.multiplyScalarAndAdd=function(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t},n.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},n.equals=function(t,e){var r=t[0],n=t[1],a=t[2],s=t[3],o=t[4],h=t[5],u=e[0],c=e[1],l=e[2],d=e[3],_=e[4],f=e[5];return Math.abs(r-u)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(n-c)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(a-l)<=i.EPSILON*Math.max(1,Math.abs(a),Math.abs(l))&&Math.abs(s-d)<=i.EPSILON*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(o-_)<=i.EPSILON*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(h-f)<=i.EPSILON*Math.max(1,Math.abs(h),Math.abs(f))},t.exports=n},function(t,e,r){var i=r(18),n={};n.create=function(){var t=new i.ARRAY_TYPE(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},n.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},n.clone=function(t){var e=new i.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},n.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},n.fromValues=function(t,e,r,n,a,s,o,h,u){var c=new i.ARRAY_TYPE(9);return c[0]=t,c[1]=e,c[2]=r,c[3]=n,c[4]=a,c[5]=s,c[6]=o,c[7]=h,c[8]=u,c},n.set=function(t,e,r,i,n,a,s,o,h,u){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=a,t[5]=s,t[6]=o,t[7]=h,t[8]=u,t},n.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},n.transpose=function(t,e){if(t===e){var r=e[1],i=e[2],n=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=i,t[7]=n}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},n.invert=function(t,e){var r=e[0],i=e[1],n=e[2],a=e[3],s=e[4],o=e[5],h=e[6],u=e[7],c=e[8],l=c*s-o*u,d=-c*a+o*h,_=u*a-s*h,f=r*l+i*d+n*_;return f?(f=1/f,t[0]=l*f,t[1]=(-c*i+n*u)*f,t[2]=(o*i-n*s)*f,t[3]=d*f,t[4]=(c*r-n*h)*f,t[5]=(-o*r+n*a)*f,t[6]=_*f,t[7]=(-u*r+i*h)*f,t[8]=(s*r-i*a)*f,t):null},n.adjoint=function(t,e){var r=e[0],i=e[1],n=e[2],a=e[3],s=e[4],o=e[5],h=e[6],u=e[7],c=e[8];return t[0]=s*c-o*u,t[1]=n*u-i*c,t[2]=i*o-n*s,t[3]=o*h-a*c,t[4]=r*c-n*h,t[5]=n*a-r*o,t[6]=a*u-s*h,t[7]=i*h-r*u,t[8]=r*s-i*a,t},n.determinant=function(t){var e=t[0],r=t[1],i=t[2],n=t[3],a=t[4],s=t[5],o=t[6],h=t[7],u=t[8];return e*(u*a-s*h)+r*(-u*n+s*o)+i*(h*n-a*o)},n.multiply=function(t,e,r){var i=e[0],n=e[1],a=e[2],s=e[3],o=e[4],h=e[5],u=e[6],c=e[7],l=e[8],d=r[0],_=r[1],f=r[2],g=r[3],p=r[4],m=r[5],v=r[6],S=r[7],x=r[8];return t[0]=d*i+_*s+f*u,t[1]=d*n+_*o+f*c,t[2]=d*a+_*h+f*l,t[3]=g*i+p*s+m*u,t[4]=g*n+p*o+m*c,t[5]=g*a+p*h+m*l,t[6]=v*i+S*s+x*u,t[7]=v*n+S*o+x*c,t[8]=v*a+S*h+x*l,t},n.mul=n.multiply,n.translate=function(t,e,r){var i=e[0],n=e[1],a=e[2],s=e[3],o=e[4],h=e[5],u=e[6],c=e[7],l=e[8],d=r[0],_=r[1];return t[0]=i,t[1]=n,t[2]=a,t[3]=s,t[4]=o,t[5]=h,t[6]=d*i+_*s+u,t[7]=d*n+_*o+c,t[8]=d*a+_*h+l,t},n.rotate=function(t,e,r){var i=e[0],n=e[1],a=e[2],s=e[3],o=e[4],h=e[5],u=e[6],c=e[7],l=e[8],d=Math.sin(r),_=Math.cos(r);return t[0]=_*i+d*s,t[1]=_*n+d*o,t[2]=_*a+d*h,t[3]=_*s-d*i,t[4]=_*o-d*n,t[5]=_*h-d*a,t[6]=u,t[7]=c,t[8]=l,t},n.scale=function(t,e,r){var i=r[0],n=r[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},n.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},n.fromRotation=function(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=-r,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},n.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},n.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},n.fromQuat=function(t,e){var r=e[0],i=e[1],n=e[2],a=e[3],s=r+r,o=i+i,h=n+n,u=r*s,c=i*s,l=i*o,d=n*s,_=n*o,f=n*h,g=a*s,p=a*o,m=a*h;return t[0]=1-l-f,t[3]=c-m,t[6]=d+p,t[1]=c+m,t[4]=1-u-f,t[7]=_-g,t[2]=d-p,t[5]=_+g,t[8]=1-u-l,t},n.normalFromMat4=function(t,e){var r=e[0],i=e[1],n=e[2],a=e[3],s=e[4],o=e[5],h=e[6],u=e[7],c=e[8],l=e[9],d=e[10],_=e[11],f=e[12],g=e[13],p=e[14],m=e[15],v=r*o-i*s,S=r*h-n*s,x=r*u-a*s,b=i*h-n*o,y=i*u-a*o,M=n*u-a*h,T=c*g-l*f,A=c*p-d*f,C=c*m-_*f,I=l*p-d*g,w=l*m-_*g,E=d*m-_*p,N=v*E-S*w+x*I+b*C-y*A+M*T;return N?(N=1/N,t[0]=(o*E-h*w+u*I)*N,t[1]=(h*C-s*E-u*A)*N,t[2]=(s*w-o*C+u*T)*N,t[3]=(n*w-i*E-a*I)*N,t[4]=(r*E-n*C+a*A)*N,t[5]=(i*C-r*w-a*T)*N,t[6]=(g*M-p*y+m*b)*N,t[7]=(p*x-f*M-m*S)*N,t[8]=(f*y-g*x+m*v)*N,t):null},n.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},n.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))},n.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t},n.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t},n.sub=n.subtract,n.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t},n.multiplyScalarAndAdd=function(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t},n.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},n.equals=function(t,e){var r=t[0],n=t[1],a=t[2],s=t[3],o=t[4],h=t[5],u=t[6],c=t[7],l=t[8],d=e[0],_=e[1],f=e[2],g=e[3],p=e[4],m=e[5],v=t[6],S=e[7],x=e[8];return Math.abs(r-d)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(n-_)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(_))&&Math.abs(a-f)<=i.EPSILON*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(s-g)<=i.EPSILON*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(o-p)<=i.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(h-m)<=i.EPSILON*Math.max(1,Math.abs(h),Math.abs(m))&&Math.abs(u-v)<=i.EPSILON*Math.max(1,Math.abs(u),Math.abs(v))&&Math.abs(c-S)<=i.EPSILON*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(l-x)<=i.EPSILON*Math.max(1,Math.abs(l),Math.abs(x))},t.exports=n},function(t,e,r){var i=r(18),n={scalar:{},SIMD:{}};n.create=function(){var t=new i.ARRAY_TYPE(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},n.clone=function(t){var e=new i.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},n.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},n.fromValues=function(t,e,r,n,a,s,o,h,u,c,l,d,_,f,g,p){var m=new i.ARRAY_TYPE(16);return m[0]=t,m[1]=e,m[2]=r,m[3]=n,m[4]=a,m[5]=s,m[6]=o,m[7]=h,m[8]=u,m[9]=c,m[10]=l,m[11]=d,m[12]=_,m[13]=f,m[14]=g,m[15]=p,m},n.set=function(t,e,r,i,n,a,s,o,h,u,c,l,d,_,f,g,p){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=a,t[5]=s,t[6]=o,t[7]=h,t[8]=u,t[9]=c,t[10]=l,t[11]=d,t[12]=_,t[13]=f,t[14]=g,t[15]=p,t},n.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},n.scalar.transpose=function(t,e){if(t===e){var r=e[1],i=e[2],n=e[3],a=e[6],s=e[7],o=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=a,t[11]=e[14],t[12]=n,t[13]=s,t[14]=o}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},n.SIMD.transpose=function(t,e){var r,i,n,a,s,o,h,u,c,l;return r=SIMD.Float32x4.load(e,0),i=SIMD.Float32x4.load(e,4),n=SIMD.Float32x4.load(e,8),a=SIMD.Float32x4.load(e,12),s=SIMD.Float32x4.shuffle(r,i,0,1,4,5),o=SIMD.Float32x4.shuffle(n,a,0,1,4,5),h=SIMD.Float32x4.shuffle(s,o,0,2,4,6),u=SIMD.Float32x4.shuffle(s,o,1,3,5,7),SIMD.Float32x4.store(t,0,h),SIMD.Float32x4.store(t,4,u),s=SIMD.Float32x4.shuffle(r,i,2,3,6,7),o=SIMD.Float32x4.shuffle(n,a,2,3,6,7),c=SIMD.Float32x4.shuffle(s,o,0,2,4,6),l=SIMD.Float32x4.shuffle(s,o,1,3,5,7),SIMD.Float32x4.store(t,8,c),SIMD.Float32x4.store(t,12,l),t},n.transpose=i.USE_SIMD?n.SIMD.transpose:n.scalar.transpose,n.scalar.invert=function(t,e){var r=e[0],i=e[1],n=e[2],a=e[3],s=e[4],o=e[5],h=e[6],u=e[7],c=e[8],l=e[9],d=e[10],_=e[11],f=e[12],g=e[13],p=e[14],m=e[15],v=r*o-i*s,S=r*h-n*s,x=r*u-a*s,b=i*h-n*o,y=i*u-a*o,M=n*u-a*h,T=c*g-l*f,A=c*p-d*f,C=c*m-_*f,I=l*p-d*g,w=l*m-_*g,E=d*m-_*p,N=v*E-S*w+x*I+b*C-y*A+M*T;return N?(N=1/N,t[0]=(o*E-h*w+u*I)*N,t[1]=(n*w-i*E-a*I)*N,t[2]=(g*M-p*y+m*b)*N,t[3]=(d*y-l*M-_*b)*N,t[4]=(h*C-s*E-u*A)*N,t[5]=(r*E-n*C+a*A)*N,t[6]=(p*x-f*M-m*S)*N,t[7]=(c*M-d*x+_*S)*N,t[8]=(s*w-o*C+u*T)*N,t[9]=(i*C-r*w-a*T)*N,t[10]=(f*y-g*x+m*v)*N,t[11]=(l*x-c*y-_*v)*N,t[12]=(o*A-s*I-h*T)*N,t[13]=(r*I-i*A+n*T)*N,t[14]=(g*S-f*b-p*v)*N,t[15]=(c*b-l*S+d*v)*N,t):null},n.SIMD.invert=function(t,e){var r,i,n,a,s,o,h,u,c,l,d=SIMD.Float32x4.load(e,0),_=SIMD.Float32x4.load(e,4),f=SIMD.Float32x4.load(e,8),g=SIMD.Float32x4.load(e,12);return s=SIMD.Float32x4.shuffle(d,_,0,1,4,5),i=SIMD.Float32x4.shuffle(f,g,0,1,4,5),r=SIMD.Float32x4.shuffle(s,i,0,2,4,6),i=SIMD.Float32x4.shuffle(i,s,1,3,5,7),s=SIMD.Float32x4.shuffle(d,_,2,3,6,7),a=SIMD.Float32x4.shuffle(f,g,2,3,6,7),n=SIMD.Float32x4.shuffle(s,a,0,2,4,6),a=SIMD.Float32x4.shuffle(a,s,1,3,5,7),s=SIMD.Float32x4.mul(n,a),s=SIMD.Float32x4.swizzle(s,1,0,3,2),o=SIMD.Float32x4.mul(i,s),h=SIMD.Float32x4.mul(r,s),s=SIMD.Float32x4.swizzle(s,2,3,0,1),o=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,s),o),h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(r,s),h),h=SIMD.Float32x4.swizzle(h,2,3,0,1),s=SIMD.Float32x4.mul(i,n),s=SIMD.Float32x4.swizzle(s,1,0,3,2),o=SIMD.Float32x4.add(SIMD.Float32x4.mul(a,s),o),c=SIMD.Float32x4.mul(r,s),s=SIMD.Float32x4.swizzle(s,2,3,0,1),o=SIMD.Float32x4.sub(o,SIMD.Float32x4.mul(a,s)),c=SIMD.Float32x4.sub(SIMD.Float32x4.mul(r,s),c),c=SIMD.Float32x4.swizzle(c,2,3,0,1),s=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(i,2,3,0,1),a),s=SIMD.Float32x4.swizzle(s,1,0,3,2),n=SIMD.Float32x4.swizzle(n,2,3,0,1),o=SIMD.Float32x4.add(SIMD.Float32x4.mul(n,s),o),u=SIMD.Float32x4.mul(r,s),s=SIMD.Float32x4.swizzle(s,2,3,0,1),o=SIMD.Float32x4.sub(o,SIMD.Float32x4.mul(n,s)),u=SIMD.Float32x4.sub(SIMD.Float32x4.mul(r,s),u),u=SIMD.Float32x4.swizzle(u,2,3,0,1),s=SIMD.Float32x4.mul(r,i),s=SIMD.Float32x4.swizzle(s,1,0,3,2),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(a,s),u),c=SIMD.Float32x4.sub(SIMD.Float32x4.mul(n,s),c),s=SIMD.Float32x4.swizzle(s,2,3,0,1),u=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,s),u),c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(n,s)),s=SIMD.Float32x4.mul(r,a),s=SIMD.Float32x4.swizzle(s,1,0,3,2),h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(n,s)),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(i,s),u),s=SIMD.Float32x4.swizzle(s,2,3,0,1),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(n,s),h),u=SIMD.Float32x4.sub(u,SIMD.Float32x4.mul(i,s)),s=SIMD.Float32x4.mul(r,n),s=SIMD.Float32x4.swizzle(s,1,0,3,2),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(a,s),h),c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(i,s)),s=SIMD.Float32x4.swizzle(s,2,3,0,1),h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(a,s)),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(i,s),c),l=SIMD.Float32x4.mul(r,o),l=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(l,2,3,0,1),l),l=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(l,1,0,3,2),l),s=SIMD.Float32x4.reciprocalApproximation(l),l=SIMD.Float32x4.sub(SIMD.Float32x4.add(s,s),SIMD.Float32x4.mul(l,SIMD.Float32x4.mul(s,s))),(l=SIMD.Float32x4.swizzle(l,0,0,0,0))?(SIMD.Float32x4.store(t,0,SIMD.Float32x4.mul(l,o)),SIMD.Float32x4.store(t,4,SIMD.Float32x4.mul(l,h)),SIMD.Float32x4.store(t,8,SIMD.Float32x4.mul(l,u)),SIMD.Float32x4.store(t,12,SIMD.Float32x4.mul(l,c)),t):null},n.invert=i.USE_SIMD?n.SIMD.invert:n.scalar.invert,n.scalar.adjoint=function(t,e){var r=e[0],i=e[1],n=e[2],a=e[3],s=e[4],o=e[5],h=e[6],u=e[7],c=e[8],l=e[9],d=e[10],_=e[11],f=e[12],g=e[13],p=e[14],m=e[15];return t[0]=o*(d*m-_*p)-l*(h*m-u*p)+g*(h*_-u*d),t[1]=-(i*(d*m-_*p)-l*(n*m-a*p)+g*(n*_-a*d)),t[2]=i*(h*m-u*p)-o*(n*m-a*p)+g*(n*u-a*h),t[3]=-(i*(h*_-u*d)-o*(n*_-a*d)+l*(n*u-a*h)),t[4]=-(s*(d*m-_*p)-c*(h*m-u*p)+f*(h*_-u*d)),t[5]=r*(d*m-_*p)-c*(n*m-a*p)+f*(n*_-a*d),t[6]=-(r*(h*m-u*p)-s*(n*m-a*p)+f*(n*u-a*h)),t[7]=r*(h*_-u*d)-s*(n*_-a*d)+c*(n*u-a*h),t[8]=s*(l*m-_*g)-c*(o*m-u*g)+f*(o*_-u*l),t[9]=-(r*(l*m-_*g)-c*(i*m-a*g)+f*(i*_-a*l)),t[10]=r*(o*m-u*g)-s*(i*m-a*g)+f*(i*u-a*o),t[11]=-(r*(o*_-u*l)-s*(i*_-a*l)+c*(i*u-a*o)),t[12]=-(s*(l*p-d*g)-c*(o*p-h*g)+f*(o*d-h*l)),t[13]=r*(l*p-d*g)-c*(i*p-n*g)+f*(i*d-n*l),t[14]=-(r*(o*p-h*g)-s*(i*p-n*g)+f*(i*h-n*o)),t[15]=r*(o*d-h*l)-s*(i*d-n*l)+c*(i*h-n*o),t},n.SIMD.adjoint=function(t,e){var r,i,n,a,s,o,h,u,c,l,d,_,f,r=SIMD.Float32x4.load(e,0),i=SIMD.Float32x4.load(e,4),n=SIMD.Float32x4.load(e,8),a=SIMD.Float32x4.load(e,12);return c=SIMD.Float32x4.shuffle(r,i,0,1,4,5),o=SIMD.Float32x4.shuffle(n,a,0,1,4,5),s=SIMD.Float32x4.shuffle(c,o,0,2,4,6),o=SIMD.Float32x4.shuffle(o,c,1,3,5,7),c=SIMD.Float32x4.shuffle(r,i,2,3,6,7),u=SIMD.Float32x4.shuffle(n,a,2,3,6,7),h=SIMD.Float32x4.shuffle(c,u,0,2,4,6),u=SIMD.Float32x4.shuffle(u,c,1,3,5,7),c=SIMD.Float32x4.mul(h,u),c=SIMD.Float32x4.swizzle(c,1,0,3,2),l=SIMD.Float32x4.mul(o,c),d=SIMD.Float32x4.mul(s,c),c=SIMD.Float32x4.swizzle(c,2,3,0,1),l=SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,c),l),d=SIMD.Float32x4.sub(SIMD.Float32x4.mul(s,c),d),d=SIMD.Float32x4.swizzle(d,2,3,0,1),c=SIMD.Float32x4.mul(o,h),c=SIMD.Float32x4.swizzle(c,1,0,3,2),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(u,c),l),f=SIMD.Float32x4.mul(s,c),c=SIMD.Float32x4.swizzle(c,2,3,0,1),l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(u,c)),f=SIMD.Float32x4.sub(SIMD.Float32x4.mul(s,c),f),f=SIMD.Float32x4.swizzle(f,2,3,0,1),c=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(o,2,3,0,1),u),c=SIMD.Float32x4.swizzle(c,1,0,3,2),h=SIMD.Float32x4.swizzle(h,2,3,0,1),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(h,c),l),_=SIMD.Float32x4.mul(s,c),c=SIMD.Float32x4.swizzle(c,2,3,0,1),l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(h,c)),_=SIMD.Float32x4.sub(SIMD.Float32x4.mul(s,c),_),_=SIMD.Float32x4.swizzle(_,2,3,0,1),c=SIMD.Float32x4.mul(s,o),c=SIMD.Float32x4.swizzle(c,1,0,3,2),_=SIMD.Float32x4.add(SIMD.Float32x4.mul(u,c),_),f=SIMD.Float32x4.sub(SIMD.Float32x4.mul(h,c),f),c=SIMD.Float32x4.swizzle(c,2,3,0,1),_=SIMD.Float32x4.sub(SIMD.Float32x4.mul(u,c),_),f=SIMD.Float32x4.sub(f,SIMD.Float32x4.mul(h,c)),c=SIMD.Float32x4.mul(s,u),c=SIMD.Float32x4.swizzle(c,1,0,3,2),d=SIMD.Float32x4.sub(d,SIMD.Float32x4.mul(h,c)),_=SIMD.Float32x4.add(SIMD.Float32x4.mul(o,c),_),c=SIMD.Float32x4.swizzle(c,2,3,0,1),d=SIMD.Float32x4.add(SIMD.Float32x4.mul(h,c),d),_=SIMD.Float32x4.sub(_,SIMD.Float32x4.mul(o,c)),c=SIMD.Float32x4.mul(s,h),c=SIMD.Float32x4.swizzle(c,1,0,3,2),d=SIMD.Float32x4.add(SIMD.Float32x4.mul(u,c),d),f=SIMD.Float32x4.sub(f,SIMD.Float32x4.mul(o,c)),c=SIMD.Float32x4.swizzle(c,2,3,0,1),d=SIMD.Float32x4.sub(d,SIMD.Float32x4.mul(u,c)),f=SIMD.Float32x4.add(SIMD.Float32x4.mul(o,c),f),SIMD.Float32x4.store(t,0,l),SIMD.Float32x4.store(t,4,d),SIMD.Float32x4.store(t,8,_),SIMD.Float32x4.store(t,12,f),t},n.adjoint=i.USE_SIMD?n.SIMD.adjoint:n.scalar.adjoint,n.determinant=function(t){var e=t[0],r=t[1],i=t[2],n=t[3],a=t[4],s=t[5],o=t[6],h=t[7],u=t[8],c=t[9],l=t[10],d=t[11],_=t[12],f=t[13],g=t[14],p=t[15],m=e*s-r*a,v=e*o-i*a,S=e*h-n*a,x=r*o-i*s,b=r*h-n*s,y=i*h-n*o,M=u*f-c*_,T=u*g-l*_,A=u*p-d*_,C=c*g-l*f,I=c*p-d*f,w=l*p-d*g;return m*w-v*I+S*C+x*A-b*T+y*M},n.SIMD.multiply=function(t,e,r){var i=SIMD.Float32x4.load(e,0),n=SIMD.Float32x4.load(e,4),a=SIMD.Float32x4.load(e,8),s=SIMD.Float32x4.load(e,12),o=SIMD.Float32x4.load(r,0),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(o,0,0,0,0),i),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(o,1,1,1,1),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(o,2,2,2,2),a),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(o,3,3,3,3),s))));SIMD.Float32x4.store(t,0,h);var u=SIMD.Float32x4.load(r,4),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,0,0,0,0),i),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,1,1,1,1),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,2,2,2,2),a),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,3,3,3,3),s))));SIMD.Float32x4.store(t,4,c);var l=SIMD.Float32x4.load(r,8),d=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,0,0,0,0),i),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,1,1,1,1),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,2,2,2,2),a),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,3,3,3,3),s))));SIMD.Float32x4.store(t,8,d);var _=SIMD.Float32x4.load(r,12),f=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(_,0,0,0,0),i),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(_,1,1,1,1),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(_,2,2,2,2),a),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(_,3,3,3,3),s))));return SIMD.Float32x4.store(t,12,f),t},n.scalar.multiply=function(t,e,r){var i=e[0],n=e[1],a=e[2],s=e[3],o=e[4],h=e[5],u=e[6],c=e[7],l=e[8],d=e[9],_=e[10],f=e[11],g=e[12],p=e[13],m=e[14],v=e[15],S=r[0],x=r[1],b=r[2],y=r[3];return t[0]=S*i+x*o+b*l+y*g,t[1]=S*n+x*h+b*d+y*p,t[2]=S*a+x*u+b*_+y*m,t[3]=S*s+x*c+b*f+y*v,S=r[4],x=r[5],b=r[6],y=r[7],t[4]=S*i+x*o+b*l+y*g,t[5]=S*n+x*h+b*d+y*p,t[6]=S*a+x*u+b*_+y*m,t[7]=S*s+x*c+b*f+y*v,S=r[8],x=r[9],b=r[10],y=r[11],t[8]=S*i+x*o+b*l+y*g,t[9]=S*n+x*h+b*d+y*p,t[10]=S*a+x*u+b*_+y*m,t[11]=S*s+x*c+b*f+y*v,S=r[12],x=r[13],b=r[14],y=r[15],t[12]=S*i+x*o+b*l+y*g,t[13]=S*n+x*h+b*d+y*p,t[14]=S*a+x*u+b*_+y*m,t[15]=S*s+x*c+b*f+y*v,t},n.multiply=i.USE_SIMD?n.SIMD.multiply:n.scalar.multiply,n.mul=n.multiply,n.scalar.translate=function(t,e,r){var i,n,a,s,o,h,u,c,l,d,_,f,g=r[0],p=r[1],m=r[2];return e===t?(t[12]=e[0]*g+e[4]*p+e[8]*m+e[12],t[13]=e[1]*g+e[5]*p+e[9]*m+e[13],t[14]=e[2]*g+e[6]*p+e[10]*m+e[14],t[15]=e[3]*g+e[7]*p+e[11]*m+e[15]):(i=e[0],n=e[1],a=e[2],s=e[3],o=e[4],h=e[5],u=e[6],c=e[7],l=e[8],d=e[9],_=e[10],f=e[11],t[0]=i,t[1]=n,t[2]=a,t[3]=s,t[4]=o,t[5]=h,t[6]=u,t[7]=c,t[8]=l,t[9]=d,t[10]=_,t[11]=f,t[12]=i*g+o*p+l*m+e[12],t[13]=n*g+h*p+d*m+e[13],t[14]=a*g+u*p+_*m+e[14],t[15]=s*g+c*p+f*m+e[15]),t},n.SIMD.translate=function(t,e,r){var i=SIMD.Float32x4.load(e,0),n=SIMD.Float32x4.load(e,4),a=SIMD.Float32x4.load(e,8),s=SIMD.Float32x4.load(e,12),o=SIMD.Float32x4(r[0],r[1],r[2],0);e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11]),i=SIMD.Float32x4.mul(i,SIMD.Float32x4.swizzle(o,0,0,0,0)),n=SIMD.Float32x4.mul(n,SIMD.Float32x4.swizzle(o,1,1,1,1)),a=SIMD.Float32x4.mul(a,SIMD.Float32x4.swizzle(o,2,2,2,2));var h=SIMD.Float32x4.add(i,SIMD.Float32x4.add(n,SIMD.Float32x4.add(a,s)));return SIMD.Float32x4.store(t,12,h),t},n.translate=i.USE_SIMD?n.SIMD.translate:n.scalar.translate,n.scalar.scale=function(t,e,r){var i=r[0],n=r[1],a=r[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},n.SIMD.scale=function(t,e,r){var i,n,a,s=SIMD.Float32x4(r[0],r[1],r[2],0);return i=SIMD.Float32x4.load(e,0),SIMD.Float32x4.store(t,0,SIMD.Float32x4.mul(i,SIMD.Float32x4.swizzle(s,0,0,0,0))),n=SIMD.Float32x4.load(e,4),SIMD.Float32x4.store(t,4,SIMD.Float32x4.mul(n,SIMD.Float32x4.swizzle(s,1,1,1,1))),a=SIMD.Float32x4.load(e,8),SIMD.Float32x4.store(t,8,SIMD.Float32x4.mul(a,SIMD.Float32x4.swizzle(s,2,2,2,2))),t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},n.scale=i.USE_SIMD?n.SIMD.scale:n.scalar.scale,n.rotate=function(t,e,r,n){var a,s,o,h,u,c,l,d,_,f,g,p,m,v,S,x,b,y,M,T,A,C,I,w,E=n[0],N=n[1],R=n[2],F=Math.sqrt(E*E+N*N+R*R);return Math.abs(F)<i.EPSILON?null:(F=1/F,E*=F,N*=F,R*=F,a=Math.sin(r),s=Math.cos(r),o=1-s,h=e[0],u=e[1],c=e[2],l=e[3],d=e[4],_=e[5],f=e[6],g=e[7],p=e[8],m=e[9],v=e[10],S=e[11],x=E*E*o+s,b=N*E*o+R*a,y=R*E*o-N*a,M=E*N*o-R*a,T=N*N*o+s,A=R*N*o+E*a,C=E*R*o+N*a,I=N*R*o-E*a,w=R*R*o+s,t[0]=h*x+d*b+p*y,t[1]=u*x+_*b+m*y,t[2]=c*x+f*b+v*y,t[3]=l*x+g*b+S*y,t[4]=h*M+d*T+p*A,t[5]=u*M+_*T+m*A,t[6]=c*M+f*T+v*A,t[7]=l*M+g*T+S*A,t[8]=h*C+d*I+p*w,t[9]=u*C+_*I+m*w,t[10]=c*C+f*I+v*w,t[11]=l*C+g*I+S*w,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},n.scalar.rotateX=function(t,e,r){var i=Math.sin(r),n=Math.cos(r),a=e[4],s=e[5],o=e[6],h=e[7],u=e[8],c=e[9],l=e[10],d=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*n+u*i,t[5]=s*n+c*i,t[6]=o*n+l*i,t[7]=h*n+d*i,t[8]=u*n-a*i,t[9]=c*n-s*i,t[10]=l*n-o*i,t[11]=d*n-h*i,t},n.SIMD.rotateX=function(t,e,r){var i=SIMD.Float32x4.splat(Math.sin(r)),n=SIMD.Float32x4.splat(Math.cos(r));e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var a=SIMD.Float32x4.load(e,4),s=SIMD.Float32x4.load(e,8);return SIMD.Float32x4.store(t,4,SIMD.Float32x4.add(SIMD.Float32x4.mul(a,n),SIMD.Float32x4.mul(s,i))),SIMD.Float32x4.store(t,8,SIMD.Float32x4.sub(SIMD.Float32x4.mul(s,n),SIMD.Float32x4.mul(a,i))),t},n.rotateX=i.USE_SIMD?n.SIMD.rotateX:n.scalar.rotateX,n.scalar.rotateY=function(t,e,r){var i=Math.sin(r),n=Math.cos(r),a=e[0],s=e[1],o=e[2],h=e[3],u=e[8],c=e[9],l=e[10],d=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*n-u*i,t[1]=s*n-c*i,t[2]=o*n-l*i,t[3]=h*n-d*i,t[8]=a*i+u*n,t[9]=s*i+c*n,t[10]=o*i+l*n,t[11]=h*i+d*n,t},n.SIMD.rotateY=function(t,e,r){var i=SIMD.Float32x4.splat(Math.sin(r)),n=SIMD.Float32x4.splat(Math.cos(r));e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var a=SIMD.Float32x4.load(e,0),s=SIMD.Float32x4.load(e,8);return SIMD.Float32x4.store(t,0,SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,n),SIMD.Float32x4.mul(s,i))),SIMD.Float32x4.store(t,8,SIMD.Float32x4.add(SIMD.Float32x4.mul(a,i),SIMD.Float32x4.mul(s,n))),t},n.rotateY=i.USE_SIMD?n.SIMD.rotateY:n.scalar.rotateY,n.scalar.rotateZ=function(t,e,r){var i=Math.sin(r),n=Math.cos(r),a=e[0],s=e[1],o=e[2],h=e[3],u=e[4],c=e[5],l=e[6],d=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*n+u*i,t[1]=s*n+c*i,t[2]=o*n+l*i,
t[3]=h*n+d*i,t[4]=u*n-a*i,t[5]=c*n-s*i,t[6]=l*n-o*i,t[7]=d*n-h*i,t},n.SIMD.rotateZ=function(t,e,r){var i=SIMD.Float32x4.splat(Math.sin(r)),n=SIMD.Float32x4.splat(Math.cos(r));e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var a=SIMD.Float32x4.load(e,0),s=SIMD.Float32x4.load(e,4);return SIMD.Float32x4.store(t,0,SIMD.Float32x4.add(SIMD.Float32x4.mul(a,n),SIMD.Float32x4.mul(s,i))),SIMD.Float32x4.store(t,4,SIMD.Float32x4.sub(SIMD.Float32x4.mul(s,n),SIMD.Float32x4.mul(a,i))),t},n.rotateZ=i.USE_SIMD?n.SIMD.rotateZ:n.scalar.rotateZ,n.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},n.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},n.fromRotation=function(t,e,r){var n,a,s,o=r[0],h=r[1],u=r[2],c=Math.sqrt(o*o+h*h+u*u);return Math.abs(c)<i.EPSILON?null:(c=1/c,o*=c,h*=c,u*=c,n=Math.sin(e),a=Math.cos(e),s=1-a,t[0]=o*o*s+a,t[1]=h*o*s+u*n,t[2]=u*o*s-h*n,t[3]=0,t[4]=o*h*s-u*n,t[5]=h*h*s+a,t[6]=u*h*s+o*n,t[7]=0,t[8]=o*u*s+h*n,t[9]=h*u*s-o*n,t[10]=u*u*s+a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},n.fromXRotation=function(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},n.fromYRotation=function(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},n.fromZRotation=function(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},n.fromRotationTranslation=function(t,e,r){var i=e[0],n=e[1],a=e[2],s=e[3],o=i+i,h=n+n,u=a+a,c=i*o,l=i*h,d=i*u,_=n*h,f=n*u,g=a*u,p=s*o,m=s*h,v=s*u;return t[0]=1-(_+g),t[1]=l+v,t[2]=d-m,t[3]=0,t[4]=l-v,t[5]=1-(c+g),t[6]=f+p,t[7]=0,t[8]=d+m,t[9]=f-p,t[10]=1-(c+_),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t},n.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},n.getRotation=function(t,e){var r=e[0]+e[5]+e[10],i=0;return r>0?(i=2*Math.sqrt(r+1),t[3]=.25*i,t[0]=(e[6]-e[9])/i,t[1]=(e[8]-e[2])/i,t[2]=(e[1]-e[4])/i):e[0]>e[5]&e[0]>e[10]?(i=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/i,t[0]=.25*i,t[1]=(e[1]+e[4])/i,t[2]=(e[8]+e[2])/i):e[5]>e[10]?(i=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/i,t[0]=(e[1]+e[4])/i,t[1]=.25*i,t[2]=(e[6]+e[9])/i):(i=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/i,t[0]=(e[8]+e[2])/i,t[1]=(e[6]+e[9])/i,t[2]=.25*i),t},n.fromRotationTranslationScale=function(t,e,r,i){var n=e[0],a=e[1],s=e[2],o=e[3],h=n+n,u=a+a,c=s+s,l=n*h,d=n*u,_=n*c,f=a*u,g=a*c,p=s*c,m=o*h,v=o*u,S=o*c,x=i[0],b=i[1],y=i[2];return t[0]=(1-(f+p))*x,t[1]=(d+S)*x,t[2]=(_-v)*x,t[3]=0,t[4]=(d-S)*b,t[5]=(1-(l+p))*b,t[6]=(g+m)*b,t[7]=0,t[8]=(_+v)*y,t[9]=(g-m)*y,t[10]=(1-(l+f))*y,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t},n.fromRotationTranslationScaleOrigin=function(t,e,r,i,n){var a=e[0],s=e[1],o=e[2],h=e[3],u=a+a,c=s+s,l=o+o,d=a*u,_=a*c,f=a*l,g=s*c,p=s*l,m=o*l,v=h*u,S=h*c,x=h*l,b=i[0],y=i[1],M=i[2],T=n[0],A=n[1],C=n[2];return t[0]=(1-(g+m))*b,t[1]=(_+x)*b,t[2]=(f-S)*b,t[3]=0,t[4]=(_-x)*y,t[5]=(1-(d+m))*y,t[6]=(p+v)*y,t[7]=0,t[8]=(f+S)*M,t[9]=(p-v)*M,t[10]=(1-(d+g))*M,t[11]=0,t[12]=r[0]+T-(t[0]*T+t[4]*A+t[8]*C),t[13]=r[1]+A-(t[1]*T+t[5]*A+t[9]*C),t[14]=r[2]+C-(t[2]*T+t[6]*A+t[10]*C),t[15]=1,t},n.fromQuat=function(t,e){var r=e[0],i=e[1],n=e[2],a=e[3],s=r+r,o=i+i,h=n+n,u=r*s,c=i*s,l=i*o,d=n*s,_=n*o,f=n*h,g=a*s,p=a*o,m=a*h;return t[0]=1-l-f,t[1]=c+m,t[2]=d-p,t[3]=0,t[4]=c-m,t[5]=1-u-f,t[6]=_+g,t[7]=0,t[8]=d+p,t[9]=_-g,t[10]=1-u-l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},n.frustum=function(t,e,r,i,n,a,s){var o=1/(r-e),h=1/(n-i),u=1/(a-s);return t[0]=2*a*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*a*h,t[6]=0,t[7]=0,t[8]=(r+e)*o,t[9]=(n+i)*h,t[10]=(s+a)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=s*a*2*u,t[15]=0,t},n.perspective=function(t,e,r,i,n){var a=1/Math.tan(e/2),s=1/(i-n);return t[0]=a/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(n+i)*s,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*n*i*s,t[15]=0,t},n.perspectiveFromFieldOfView=function(t,e,r,i){var n=Math.tan(e.upDegrees*Math.PI/180),a=Math.tan(e.downDegrees*Math.PI/180),s=Math.tan(e.leftDegrees*Math.PI/180),o=Math.tan(e.rightDegrees*Math.PI/180),h=2/(s+o),u=2/(n+a);return t[0]=h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=-((s-o)*h*.5),t[9]=(n-a)*u*.5,t[10]=i/(r-i),t[11]=-1,t[12]=0,t[13]=0,t[14]=i*r/(r-i),t[15]=0,t},n.ortho=function(t,e,r,i,n,a,s){var o=1/(e-r),h=1/(i-n),u=1/(a-s);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+r)*o,t[13]=(n+i)*h,t[14]=(s+a)*u,t[15]=1,t},n.lookAt=function(t,e,r,a){var s,o,h,u,c,l,d,_,f,g,p=e[0],m=e[1],v=e[2],S=a[0],x=a[1],b=a[2],y=r[0],M=r[1],T=r[2];return Math.abs(p-y)<i.EPSILON&&Math.abs(m-M)<i.EPSILON&&Math.abs(v-T)<i.EPSILON?n.identity(t):(d=p-y,_=m-M,f=v-T,g=1/Math.sqrt(d*d+_*_+f*f),d*=g,_*=g,f*=g,s=x*f-b*_,o=b*d-S*f,h=S*_-x*d,g=Math.sqrt(s*s+o*o+h*h),g?(g=1/g,s*=g,o*=g,h*=g):(s=0,o=0,h=0),u=_*h-f*o,c=f*s-d*h,l=d*o-_*s,g=Math.sqrt(u*u+c*c+l*l),g?(g=1/g,u*=g,c*=g,l*=g):(u=0,c=0,l=0),t[0]=s,t[1]=u,t[2]=d,t[3]=0,t[4]=o,t[5]=c,t[6]=_,t[7]=0,t[8]=h,t[9]=l,t[10]=f,t[11]=0,t[12]=-(s*p+o*m+h*v),t[13]=-(u*p+c*m+l*v),t[14]=-(d*p+_*m+f*v),t[15]=1,t)},n.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},n.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))},n.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t},n.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t},n.sub=n.subtract,n.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t},n.multiplyScalarAndAdd=function(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t[9]=e[9]+r[9]*i,t[10]=e[10]+r[10]*i,t[11]=e[11]+r[11]*i,t[12]=e[12]+r[12]*i,t[13]=e[13]+r[13]*i,t[14]=e[14]+r[14]*i,t[15]=e[15]+r[15]*i,t},n.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},n.equals=function(t,e){var r=t[0],n=t[1],a=t[2],s=t[3],o=t[4],h=t[5],u=t[6],c=t[7],l=t[8],d=t[9],_=t[10],f=t[11],g=t[12],p=t[13],m=t[14],v=t[15],S=e[0],x=e[1],b=e[2],y=e[3],M=e[4],T=e[5],A=e[6],C=e[7],I=e[8],w=e[9],E=e[10],N=e[11],R=e[12],F=e[13],P=e[14],L=e[15];return Math.abs(r-S)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(S))&&Math.abs(n-x)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(x))&&Math.abs(a-b)<=i.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(s-y)<=i.EPSILON*Math.max(1,Math.abs(s),Math.abs(y))&&Math.abs(o-M)<=i.EPSILON*Math.max(1,Math.abs(o),Math.abs(M))&&Math.abs(h-T)<=i.EPSILON*Math.max(1,Math.abs(h),Math.abs(T))&&Math.abs(u-A)<=i.EPSILON*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(c-C)<=i.EPSILON*Math.max(1,Math.abs(c),Math.abs(C))&&Math.abs(l-I)<=i.EPSILON*Math.max(1,Math.abs(l),Math.abs(I))&&Math.abs(d-w)<=i.EPSILON*Math.max(1,Math.abs(d),Math.abs(w))&&Math.abs(_-E)<=i.EPSILON*Math.max(1,Math.abs(_),Math.abs(E))&&Math.abs(f-N)<=i.EPSILON*Math.max(1,Math.abs(f),Math.abs(N))&&Math.abs(g-R)<=i.EPSILON*Math.max(1,Math.abs(g),Math.abs(R))&&Math.abs(p-F)<=i.EPSILON*Math.max(1,Math.abs(p),Math.abs(F))&&Math.abs(m-P)<=i.EPSILON*Math.max(1,Math.abs(m),Math.abs(P))&&Math.abs(v-L)<=i.EPSILON*Math.max(1,Math.abs(v),Math.abs(L))},t.exports=n},function(t,e,r){var i=r(18),n=r(21),a=r(24),s=r(25),o={};o.create=function(){var t=new i.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},o.rotationTo=function(){var t=a.create(),e=a.fromValues(1,0,0),r=a.fromValues(0,1,0);return function(i,n,s){var h=a.dot(n,s);return h<-.999999?(a.cross(t,e,n),a.length(t)<1e-6&&a.cross(t,r,n),a.normalize(t,t),o.setAxisAngle(i,t,Math.PI),i):h>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(a.cross(t,n,s),i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=1+h,o.normalize(i,i))}}(),o.setAxes=function(){var t=n.create();return function(e,r,i,n){return t[0]=i[0],t[3]=i[1],t[6]=i[2],t[1]=n[0],t[4]=n[1],t[7]=n[2],t[2]=-r[0],t[5]=-r[1],t[8]=-r[2],o.normalize(e,o.fromMat3(e,t))}}(),o.clone=s.clone,o.fromValues=s.fromValues,o.copy=s.copy,o.set=s.set,o.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},o.setAxisAngle=function(t,e,r){r*=.5;var i=Math.sin(r);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(r),t},o.getAxisAngle=function(t,e){var r=2*Math.acos(e[3]),i=Math.sin(r/2);return 0!=i?(t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i):(t[0]=1,t[1]=0,t[2]=0),r},o.add=s.add,o.multiply=function(t,e,r){var i=e[0],n=e[1],a=e[2],s=e[3],o=r[0],h=r[1],u=r[2],c=r[3];return t[0]=i*c+s*o+n*u-a*h,t[1]=n*c+s*h+a*o-i*u,t[2]=a*c+s*u+i*h-n*o,t[3]=s*c-i*o-n*h-a*u,t},o.mul=o.multiply,o.scale=s.scale,o.rotateX=function(t,e,r){r*=.5;var i=e[0],n=e[1],a=e[2],s=e[3],o=Math.sin(r),h=Math.cos(r);return t[0]=i*h+s*o,t[1]=n*h+a*o,t[2]=a*h-n*o,t[3]=s*h-i*o,t},o.rotateY=function(t,e,r){r*=.5;var i=e[0],n=e[1],a=e[2],s=e[3],o=Math.sin(r),h=Math.cos(r);return t[0]=i*h-a*o,t[1]=n*h+s*o,t[2]=a*h+i*o,t[3]=s*h-n*o,t},o.rotateZ=function(t,e,r){r*=.5;var i=e[0],n=e[1],a=e[2],s=e[3],o=Math.sin(r),h=Math.cos(r);return t[0]=i*h+n*o,t[1]=n*h-i*o,t[2]=a*h+s*o,t[3]=s*h-a*o,t},o.calculateW=function(t,e){var r=e[0],i=e[1],n=e[2];return t[0]=r,t[1]=i,t[2]=n,t[3]=Math.sqrt(Math.abs(1-r*r-i*i-n*n)),t},o.dot=s.dot,o.lerp=s.lerp,o.slerp=function(t,e,r,i){var n,a,s,o,h,u=e[0],c=e[1],l=e[2],d=e[3],_=r[0],f=r[1],g=r[2],p=r[3];return a=u*_+c*f+l*g+d*p,a<0&&(a=-a,_=-_,f=-f,g=-g,p=-p),1-a>1e-6?(n=Math.acos(a),s=Math.sin(n),o=Math.sin((1-i)*n)/s,h=Math.sin(i*n)/s):(o=1-i,h=i),t[0]=o*u+h*_,t[1]=o*c+h*f,t[2]=o*l+h*g,t[3]=o*d+h*p,t},o.sqlerp=function(){var t=o.create(),e=o.create();return function(r,i,n,a,s,h){return o.slerp(t,i,s,h),o.slerp(e,n,a,h),o.slerp(r,t,e,2*h*(1-h)),r}}(),o.invert=function(t,e){var r=e[0],i=e[1],n=e[2],a=e[3],s=r*r+i*i+n*n+a*a,o=s?1/s:0;return t[0]=-r*o,t[1]=-i*o,t[2]=-n*o,t[3]=a*o,t},o.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},o.length=s.length,o.len=o.length,o.squaredLength=s.squaredLength,o.sqrLen=o.squaredLength,o.normalize=s.normalize,o.fromMat3=function(t,e){var r,i=e[0]+e[4]+e[8];if(i>0)r=Math.sqrt(i+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var n=0;e[4]>e[0]&&(n=1),e[8]>e[3*n+n]&&(n=2);var a=(n+1)%3,s=(n+2)%3;r=Math.sqrt(e[3*n+n]-e[3*a+a]-e[3*s+s]+1),t[n]=.5*r,r=.5/r,t[3]=(e[3*a+s]-e[3*s+a])*r,t[a]=(e[3*a+n]+e[3*n+a])*r,t[s]=(e[3*s+n]+e[3*n+s])*r}return t},o.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},o.exactEquals=s.exactEquals,o.equals=s.equals,t.exports=o},function(t,e,r){var i=r(18),n={};n.create=function(){var t=new i.ARRAY_TYPE(3);return t[0]=0,t[1]=0,t[2]=0,t},n.clone=function(t){var e=new i.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},n.fromValues=function(t,e,r){var n=new i.ARRAY_TYPE(3);return n[0]=t,n[1]=e,n[2]=r,n},n.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},n.set=function(t,e,r,i){return t[0]=e,t[1]=r,t[2]=i,t},n.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t},n.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t},n.sub=n.subtract,n.multiply=function(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t},n.mul=n.multiply,n.divide=function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t},n.div=n.divide,n.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},n.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},n.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t},n.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t},n.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},n.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t},n.scaleAndAdd=function(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t},n.distance=function(t,e){var r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(r*r+i*i+n*n)},n.dist=n.distance,n.squaredDistance=function(t,e){var r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return r*r+i*i+n*n},n.sqrDist=n.squaredDistance,n.length=function(t){var e=t[0],r=t[1],i=t[2];return Math.sqrt(e*e+r*r+i*i)},n.len=n.length,n.squaredLength=function(t){var e=t[0],r=t[1],i=t[2];return e*e+r*r+i*i},n.sqrLen=n.squaredLength,n.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},n.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},n.normalize=function(t,e){var r=e[0],i=e[1],n=e[2],a=r*r+i*i+n*n;return a>0&&(a=1/Math.sqrt(a),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a),t},n.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},n.cross=function(t,e,r){var i=e[0],n=e[1],a=e[2],s=r[0],o=r[1],h=r[2];return t[0]=n*h-a*o,t[1]=a*s-i*h,t[2]=i*o-n*s,t},n.lerp=function(t,e,r,i){var n=e[0],a=e[1],s=e[2];return t[0]=n+i*(r[0]-n),t[1]=a+i*(r[1]-a),t[2]=s+i*(r[2]-s),t},n.hermite=function(t,e,r,i,n,a){var s=a*a,o=s*(2*a-3)+1,h=s*(a-2)+a,u=s*(a-1),c=s*(3-2*a);return t[0]=e[0]*o+r[0]*h+i[0]*u+n[0]*c,t[1]=e[1]*o+r[1]*h+i[1]*u+n[1]*c,t[2]=e[2]*o+r[2]*h+i[2]*u+n[2]*c,t},n.bezier=function(t,e,r,i,n,a){var s=1-a,o=s*s,h=a*a,u=o*s,c=3*a*o,l=3*h*s,d=h*a;return t[0]=e[0]*u+r[0]*c+i[0]*l+n[0]*d,t[1]=e[1]*u+r[1]*c+i[1]*l+n[1]*d,t[2]=e[2]*u+r[2]*c+i[2]*l+n[2]*d,t},n.random=function(t,e){e=e||1;var r=2*i.RANDOM()*Math.PI,n=2*i.RANDOM()-1,a=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(r)*a,t[1]=Math.sin(r)*a,t[2]=n*e,t},n.transformMat4=function(t,e,r){var i=e[0],n=e[1],a=e[2],s=r[3]*i+r[7]*n+r[11]*a+r[15];return s=s||1,t[0]=(r[0]*i+r[4]*n+r[8]*a+r[12])/s,t[1]=(r[1]*i+r[5]*n+r[9]*a+r[13])/s,t[2]=(r[2]*i+r[6]*n+r[10]*a+r[14])/s,t},n.transformMat3=function(t,e,r){var i=e[0],n=e[1],a=e[2];return t[0]=i*r[0]+n*r[3]+a*r[6],t[1]=i*r[1]+n*r[4]+a*r[7],t[2]=i*r[2]+n*r[5]+a*r[8],t},n.transformQuat=function(t,e,r){var i=e[0],n=e[1],a=e[2],s=r[0],o=r[1],h=r[2],u=r[3],c=u*i+o*a-h*n,l=u*n+h*i-s*a,d=u*a+s*n-o*i,_=-s*i-o*n-h*a;return t[0]=c*u+_*-s+l*-h-d*-o,t[1]=l*u+_*-o+d*-s-c*-h,t[2]=d*u+_*-h+c*-o-l*-s,t},n.rotateX=function(t,e,r,i){var n=[],a=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],a[0]=n[0],a[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),a[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2],t},n.rotateY=function(t,e,r,i){var n=[],a=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],a[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),a[1]=n[1],a[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2],t},n.rotateZ=function(t,e,r,i){var n=[],a=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],a[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),a[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),a[2]=n[2],t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2],t},n.forEach=function(){var t=n.create();return function(e,r,i,n,a,s){var o,h;for(r||(r=3),i||(i=0),h=n?Math.min(n*r+i,e.length):e.length,o=i;o<h;o+=r)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],a(t,t,s),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2];return e}}(),n.angle=function(t,e){var r=n.fromValues(t[0],t[1],t[2]),i=n.fromValues(e[0],e[1],e[2]);n.normalize(r,r),n.normalize(i,i);var a=n.dot(r,i);return a>1?0:Math.acos(a)},n.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},n.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},n.equals=function(t,e){var r=t[0],n=t[1],a=t[2],s=e[0],o=e[1],h=e[2];return Math.abs(r-s)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-o)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(a-h)<=i.EPSILON*Math.max(1,Math.abs(a),Math.abs(h))},t.exports=n},function(t,e,r){var i=r(18),n={};n.create=function(){var t=new i.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},n.clone=function(t){var e=new i.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},n.fromValues=function(t,e,r,n){var a=new i.ARRAY_TYPE(4);return a[0]=t,a[1]=e,a[2]=r,a[3]=n,a},n.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},n.set=function(t,e,r,i,n){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t},n.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t},n.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t},n.sub=n.subtract,n.multiply=function(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t},n.mul=n.multiply,n.divide=function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t},n.div=n.divide,n.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},n.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},n.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t},n.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t},n.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},n.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},n.scaleAndAdd=function(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t},n.distance=function(t,e){var r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2],a=e[3]-t[3];return Math.sqrt(r*r+i*i+n*n+a*a)},n.dist=n.distance,n.squaredDistance=function(t,e){var r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2],a=e[3]-t[3];return r*r+i*i+n*n+a*a},n.sqrDist=n.squaredDistance,n.length=function(t){var e=t[0],r=t[1],i=t[2],n=t[3];return Math.sqrt(e*e+r*r+i*i+n*n)},n.len=n.length,n.squaredLength=function(t){var e=t[0],r=t[1],i=t[2],n=t[3];return e*e+r*r+i*i+n*n},n.sqrLen=n.squaredLength,n.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},n.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},n.normalize=function(t,e){var r=e[0],i=e[1],n=e[2],a=e[3],s=r*r+i*i+n*n+a*a;return s>0&&(s=1/Math.sqrt(s),t[0]=r*s,t[1]=i*s,t[2]=n*s,t[3]=a*s),t},n.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},n.lerp=function(t,e,r,i){var n=e[0],a=e[1],s=e[2],o=e[3];return t[0]=n+i*(r[0]-n),t[1]=a+i*(r[1]-a),t[2]=s+i*(r[2]-s),t[3]=o+i*(r[3]-o),t},n.random=function(t,e){return e=e||1,t[0]=i.RANDOM(),t[1]=i.RANDOM(),t[2]=i.RANDOM(),t[3]=i.RANDOM(),n.normalize(t,t),n.scale(t,t,e),t},n.transformMat4=function(t,e,r){var i=e[0],n=e[1],a=e[2],s=e[3];return t[0]=r[0]*i+r[4]*n+r[8]*a+r[12]*s,t[1]=r[1]*i+r[5]*n+r[9]*a+r[13]*s,t[2]=r[2]*i+r[6]*n+r[10]*a+r[14]*s,t[3]=r[3]*i+r[7]*n+r[11]*a+r[15]*s,t},n.transformQuat=function(t,e,r){var i=e[0],n=e[1],a=e[2],s=r[0],o=r[1],h=r[2],u=r[3],c=u*i+o*a-h*n,l=u*n+h*i-s*a,d=u*a+s*n-o*i,_=-s*i-o*n-h*a;return t[0]=c*u+_*-s+l*-h-d*-o,t[1]=l*u+_*-o+d*-s-c*-h,t[2]=d*u+_*-h+c*-o-l*-s,t[3]=e[3],t},n.forEach=function(){var t=n.create();return function(e,r,i,n,a,s){var o,h;for(r||(r=4),i||(i=0),h=n?Math.min(n*r+i,e.length):e.length,o=i;o<h;o+=r)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],t[3]=e[o+3],a(t,t,s),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2],e[o+3]=t[3];return e}}(),n.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},n.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},n.equals=function(t,e){var r=t[0],n=t[1],a=t[2],s=t[3],o=e[0],h=e[1],u=e[2],c=e[3];return Math.abs(r-o)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-h)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(a-u)<=i.EPSILON*Math.max(1,Math.abs(a),Math.abs(u))&&Math.abs(s-c)<=i.EPSILON*Math.max(1,Math.abs(s),Math.abs(c))},t.exports=n},function(t,e,r){var i=r(18),n={};n.create=function(){var t=new i.ARRAY_TYPE(2);return t[0]=0,t[1]=0,t},n.clone=function(t){var e=new i.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},n.fromValues=function(t,e){var r=new i.ARRAY_TYPE(2);return r[0]=t,r[1]=e,r},n.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},n.set=function(t,e,r){return t[0]=e,t[1]=r,t},n.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t},n.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t},n.sub=n.subtract,n.multiply=function(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t},n.mul=n.multiply,n.divide=function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t},n.div=n.divide,n.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},n.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},n.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t},n.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t},n.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},n.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t},n.scaleAndAdd=function(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t},n.distance=function(t,e){var r=e[0]-t[0],i=e[1]-t[1];return Math.sqrt(r*r+i*i)},n.dist=n.distance,n.squaredDistance=function(t,e){var r=e[0]-t[0],i=e[1]-t[1];return r*r+i*i},n.sqrDist=n.squaredDistance,n.length=function(t){var e=t[0],r=t[1];return Math.sqrt(e*e+r*r)},n.len=n.length,n.squaredLength=function(t){var e=t[0],r=t[1];return e*e+r*r},n.sqrLen=n.squaredLength,n.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},n.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},n.normalize=function(t,e){var r=e[0],i=e[1],n=r*r+i*i;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n),t},n.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},n.cross=function(t,e,r){var i=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=i,t},n.lerp=function(t,e,r,i){var n=e[0],a=e[1];return t[0]=n+i*(r[0]-n),t[1]=a+i*(r[1]-a),t},n.random=function(t,e){e=e||1;var r=2*i.RANDOM()*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t},n.transformMat2=function(t,e,r){var i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n,t[1]=r[1]*i+r[3]*n,t},n.transformMat2d=function(t,e,r){var i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n+r[4],t[1]=r[1]*i+r[3]*n+r[5],t},n.transformMat3=function(t,e,r){var i=e[0],n=e[1];return t[0]=r[0]*i+r[3]*n+r[6],t[1]=r[1]*i+r[4]*n+r[7],t},n.transformMat4=function(t,e,r){var i=e[0],n=e[1];return t[0]=r[0]*i+r[4]*n+r[12],t[1]=r[1]*i+r[5]*n+r[13],t},n.forEach=function(){var t=n.create();return function(e,r,i,n,a,s){var o,h;for(r||(r=2),i||(i=0),h=n?Math.min(n*r+i,e.length):e.length,o=i;o<h;o+=r)t[0]=e[o],t[1]=e[o+1],a(t,t,s),e[o]=t[0],e[o+1]=t[1];return e}}(),n.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},n.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},n.equals=function(t,e){var r=t[0],n=t[1],a=e[0],s=e[1];return Math.abs(r-a)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-s)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))},t.exports=n},function(t,e){"use strict";t.exports={ArrayType:Float64Array}},function(t,e,r){"use strict";var i=r(14),n=r(15).vec3,a=r(15).mat4,s=function(){this._center=n.create(),this._radius=-1};s.prototype={init:function(){n.init(this._center),this._radius=-1},valid:function(){return this._radius>=0},set:function(t,e){this._center=t,this._radius=e},center:function(){return this._center},radius:function(){return this._radius},radius2:function(){return this._radius*this._radius},expandByBoundingBox:function(){var t=n.create(),e=new i;return function(r){if(r.valid())if(this.valid()){n.copy(e._min,r._min),n.copy(e._max,r._max);for(var i=0;i<8;i++)n.sub(t,r.corner(i,t),this._center),n.normalize(t,t),n.scaleAndAdd(t,this._center,t,-this._radius),e.expandByvec3(t);e.center(this._center),this._radius=e.radius()}else r.center(this._center),this._radius=r.radius()}}(),expandByvec3:function(){var t=n.create();return function(e){if(this.valid()){n.sub(t,e,this.center(t));var r=n.length(t);if(r>this.radius()){var i=.5*(r-this.radius());this._center[0]+=t[0]*(i/r),this._center[1]+=t[1]*(i/r),this._center[2]+=t[2]*(i/r),this._radius+=i}}else this._center[0]=e[0],this._center[1]=e[1],this._center[2]=e[2],this._radius=0}}(),expandRadiusBySphere:function(t){if(t.valid())if(this.valid()){var e=n.distance(this._center,t._center)+t._radius;e>this._radius&&(this._radius=e)}else n.copy(this._center,t._center),this._radius=t._radius},expandByBoundingSphere:function(t){if(t.valid()){if(!this.valid())return this._center[0]=t._center[0],this._center[1]=t._center[1],this._center[2]=t._center[2],void(this._radius=t.radius());var e=n.distance(t.center(),this.center());if(!(e+t.radius()<=this.radius())){if(e+this.radius()<=t.radius())return this._center[0]=t._center[0],this._center[1]=t._center[1],this._center[2]=t._center[2],void(this._radius=t._radius);var r=.5*(this.radius()+e+t.radius()),i=(r-this.radius())/e;this._center[0]+=(t._center[0]-this._center[0])*i,this._center[1]+=(t._center[1]-this._center[1])*i,this._center[2]+=(t._center[2]-this._center[2])*i,this._radius=r}}},contains:function(t){return!!this.valid()&&n.sqrDist(this.center(),t)<=this.radius2()},intersects:function(t){if(!this.valid()||!t.valid())return!1;var e=this.radius()+t.radius();return n.sqrDist(t.center(),this.center())<=e*e},transformMat4:function(){var t=n.create();return function(e,r){if(!this.valid())return e;e._center!==this._center&&(n.copy(e._center,this._center),e._radius=this._radius);var i=e._center,s=e._radius;a.getSqrScale(t,r);var o=Math.sqrt(Math.max(Math.max(t[0],t[1]),t[2]));return s*=o,e._radius=s,n.transformMat4(i,i,r),e}}()},t.exports=s},function(t,e,r){"use strict";var i=r(13),n=r(30),a=r(7),s=function(){i.call(this),this._parents=[],this._attributeArray=[],this._textureAttributeArrayList=[],this._activeTextureAttributeUnit=[],this._activeAttribute=[],this._activeTextureAttribute=[],this._binName=void 0,this._binNumber=0,this._shaderGeneratorPair=null,this._updateCallbackList=[],this.uniforms={},this._hasUniform=!1,this._drawID=-1};s.AttributePair=function(t,e){this._object=t,this._value=e},s.AttributePair.prototype={getShaderGeneratorName:function(){return this._object},getAttribute:function(){return this._object},getUniform:function(){return this._object},getValue:function(){return this._value}},a.createPrototypeObject(s,a.objectInherit(i.prototype,{setDrawID:function(t){this._drawID=t},getDrawID:function(){return this._drawID},getAttributePair:function(t,e){return new s.AttributePair(t,e)},addUniform:function(t,e){var r=void 0!==e?e:n.ON,i=t.getName();this.uniforms[i]=this.getAttributePair(t,r),this._hasUniform=!0},addParent:function(t){this._parents.push(t)},removeParent:function(t){var e=this._parents.indexOf(t);e!==-1&&this._parents.splice(e,1)},removeUniform:function(t){this.removeUniformByName(t.getName())},removeUniformByName:function(t){delete this.uniforms[t],this._hasUniform=!!i.keys(this.uniforms).length},hasUniform:function(){return this._hasUniform},getUniform:function(t){var e=this.uniforms;if(e[t])return e[t].getAttribute()},getUniformList:function(){return this.uniforms},setTextureAttributeAndModes:function(t,e,r){this._setTextureAttribute(t,this.getAttributePair(e,void 0!==r?r:n.ON))},getNumTextureAttributeLists:function(){return this._textureAttributeArrayList.length},getTextureAttribute:function(t,e){if(void 0!==this._textureAttributeArrayList[t]){var r=a.getTextureIdFromTypeMember(e);if(void 0!==r){var i=this._textureAttributeArrayList[t];return i[r]?i[r].getAttribute():void 0}}},removeTextureAttribute:function(t,e){if(void 0!==this._textureAttributeArrayList[t]){var r=a.getTextureIdFromTypeMember(e);if(void 0!==r){var i=this._textureAttributeArrayList[t];void 0!==i[r]&&(i[r]=void 0,this._computeValidTextureUnit())}}},getAttribute:function(t){var e=a.getIdFromTypeMember(t);if(void 0!==e&&this._attributeArray[e])return this._attributeArray[e].getAttribute()},setAttributeAndModes:function(t,e){this._setAttribute(this.getAttributePair(t,void 0!==e?e:n.ON))},setAttribute:function(t,e){this.setAttributeAndModes(t,e)},removeAttribute:function(t){var e=a.getIdFromTypeMember(t);this._attributeArray[e]=void 0,this._computeValidAttribute()},setRenderingHint:function(t){"OPAQUE_BIN"===t?this.setRenderBinDetails(0,"RenderBin"):"TRANSPARENT_BIN"===t?this.setRenderBinDetails(10,"DepthSortedBin"):this.setRenderBinDetails(0,"")},getUpdateCallbackList:function(){return this._updateCallbackList},removeUpdateCallback:function(t){var e=this._updateCallbackList.indexOf(t);if(e!==-1&&(this._updateCallbackList.splice(e,1),0===this._updateCallbackList.length))for(var r=this._parents,i=0,n=r.length;i<n;i++){var a=r[i];a.setNumChildrenRequiringUpdateTraversal(a.getNumChildrenRequiringUpdateTraversal()-1)}},requiresUpdateTraversal:function(){return!!this._updateCallbackList.length},addUpdateCallback:function(t){var e=Boolean(this._updateCallbackList.length);if(this._updateCallbackList.push(t),!e)for(var r=this._parents,i=0,n=r.length;i<n;i++){var a=r[i];a.setNumChildrenRequiringUpdateTraversal(a.getNumChildrenRequiringUpdateTraversal()+1)}},hasUpdateCallback:function(t){return this._updateCallbackList.indexOf(t)!==-1},setRenderBinDetails:function(t,e){this._binNumber=t,this._binName=e},getAttributeMap:function(){for(var t={},e=0,r=this._attributeArray.length;e<r;e++){var i=this._attributeArray[e];if(i){var n=i.getAttribute();t[n.getTypeMember()]=i}}return t},getBinNumber:function(){return this._binNumber},getBinName:function(){return this._binName},setBinNumber:function(t){this._binNumber=t},setBinName:function(t){this._binName=t},getAttributeList:function(){for(var t=this._attributeArray,e=[],r=0,i=t.length;r<i;r++)t[r]&&e.push(t[r]);return e},setShaderGeneratorName:function(t,e){this._shaderGeneratorPair=this.getAttributePair(t,void 0!==e?e:n.ON)},getShaderGeneratorPair:function(){return this._shaderGeneratorPair},getShaderGeneratorName:function(){return this._shaderGeneratorPair?this._shaderGeneratorPair.getShaderGeneratorName():void 0},releaseGLObjects:function(){for(var t=0,e=this._textureAttributeArrayList.length;t<e;t++){var r=this.getTextureAttribute(t,"Texture");r&&r.releaseGLObjects()}for(var i=this.getAttributeList(),n=0,a=i.length;n<a;n++)i[n]._object.releaseGLObjects&&i[n]._object.releaseGLObjects()},_setTextureAttribute:function(t,e){var r=this._textureAttributeArrayList;void 0===r[t]&&(r[t]=[]);var i=a.getOrCreateTextureStateAttributeTypeMemberIndex(e.getAttribute());r[t][i]=e,this._computeValidTextureUnit()},_computeValidTextureUnit:function(){this._activeTextureAttributeUnit.length=0,this._activeTextureAttribute.length=0;for(var t=this._textureAttributeArrayList,e=0,r=t.length;e<r;e++){var i=t[e];if(i&&i.length){for(var n=!1,a=0,s=i.length;a<s;a++)i[a]&&(n=!0,this._activeTextureAttribute.indexOf(a)===-1&&this._activeTextureAttribute.push(a));n&&this._activeTextureAttributeUnit.push(e);
}}},_computeValidAttribute:function(){this._activeAttribute.length=0;for(var t=this._attributeArray,e=0,r=t.length;e<r;e++)t[e]&&this._activeAttribute.push(e)},_setAttribute:function(t){var e=a.getOrCreateStateAttributeTypeMemberIndex(t.getAttribute());this._attributeArray[e]=t,this._computeValidAttribute()}}),"osg","StateSet"),t.exports=s},function(t,e,r){"use strict";var i=r(7),n=r(13),a=function(){n.call(this)};i.createPrototypeStateAttribute(a,i.objectInherit(n.prototype,{_attributeTypeIndex:void 0,getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},apply:function(){},getHash:function(){return this.getType()}}),"osg","StateAttribute"),a.OFF=0,a.ON=1,a.OVERRIDE=2,a.PROTECTED=4,a.INHERIT=8,t.exports=a},function(t,e){"use strict";var r=function(t){this.traversalMask=-1,this.nodeMaskOverride=0,this.traversalMode=t,void 0===t&&(this.traversalMode=r.TRAVERSE_ALL_CHILDREN),this.nodePath=[],this.visitorType=r.NODE_VISITOR,this._databaseRequestHandler=void 0,this._frameStamp=void 0,this.traverse=r._traversalFunctions[this.traversalMode],this.pushOntoNodePath=r._pushOntoNodePath[this.traversalMode],this.popFromNodePath=r._popFromNodePath[this.traversalMode]};r.TRAVERSE_PARENTS=1,r.TRAVERSE_ALL_CHILDREN=2,r.TRAVERSE_ACTIVE_CHILDREN=3,r.NODE_VISITOR=0,r.UPDATE_VISITOR=1,r.CULL_VISITOR=2;var i=function(t){t.ascend(this)},n=function(t){t.traverse(this)};r._traversalFunctions=[void 0,i,n,n];var a=function(t){this.nodePath.unshift(t)},s=function(t){this.nodePath.push(t)};r._pushOntoNodePath=[void 0,a,s,s];var o=function(){return this.nodePath.shift()},h=function(){this.nodePath.pop()};r._popFromNodePath=[void 0,o,h,h],r.prototype={reset:function(){this.nodePath.length=0},setFrameStamp:function(t){this._frameStamp=t},getFrameStamp:function(){return this._frameStamp},setNodeMaskOverride:function(t){this.nodeMaskOverride=t},getNodeMaskOverride:function(){return this.nodeMaskOverride},setTraversalMask:function(t){this.traversalMask=t},getTraversalMask:function(){return this.traversalMask},getNodePath:function(){return this.nodePath},validNodeMask:function(t){var e=t.getNodeMask();return 0!==(this.traversalMask&(this.nodeMaskOverride|e))},apply:function(t){this.traverse(t)},getVisitorType:function(){return this.visitorType},setDatabaseRequestHandler:function(t){this._databaseRequestHandler=t},getDatabaseRequestHandler:function(){return this._databaseRequestHandler}},t.exports=r},function(t,e){"use strict";var r=function(t){this._createFunction=t,this._pool=[],this._length=0};r.prototype={clean:function(){this._pool.length=0,this._length=0},getLength:function(){return this._length},reset:function(){this._length=0},getOrCreateObject:function(){var t;return this._length===this._pool.length?(t=this._createFunction(),this._pool.push(t)):t=this._pool[this._length],this._length++,t},forEach:function(t){for(var e=0;e<this._length;e++)t(this._pool[e])}},t.exports=r},function(t,e,r){"use strict";var i=r(15).mat4,n=r(34),a=function(t,e,r,a){var s=e,o=void 0!==a?a:t.length;void 0===s&&(s=!0);var h=r||i.create(),u=0;if(s){for(u=o-1;u>=0;u--){var c=t[u];if("Camera"===c.className()&&(c.getReferenceFrame()!==n.RELATIVE_RF||0===c.getParents().length))break}u+=1}for(var l=u,d=o;l<d;l++){var _=t[l];_.computeLocalToWorldMatrix&&_.computeLocalToWorldMatrix(h)}return h};t.exports={computeLocalToWorld:a}},function(t,e){"use strict";t.exports={RELATIVE_RF:0,ABSOLUTE_RF:1}},function(t,e,r){"use strict";var i=r(14),n=r(36),a=r(15).mat4,s=r(11),o=r(31),h=r(7),u=r(50),c=r(32),l=function(t){o.call(this,t),this._pooledMatrix=new c(a.create),this._matrixStack=new u,this._matrixStack.push(a.IDENTITY),this._bb=new i};h.createPrototypeObject(l,h.objectInherit(o.prototype,{reset:function(){this._pooledMatrix.reset(),this._matrixStack.reset(),this._matrixStack.push(a.IDENTITY),this._bb.init()},getBoundingBox:function(){return this._bb},applyTransform:function(t){var e=this._pooledMatrix.getOrCreateObject();a.copy(e,this._matrixStack.back()),t.computeLocalToWorldMatrix(e,this),this.pushMatrix(e),this.traverse(t),this.popMatrix()},apply:function(t){return t instanceof s?void this.applyTransform(t):t instanceof n?void this.applyBoundingBox(t.getBoundingBox()):void this.traverse(t)},pushMatrix:function(t){this._matrixStack.push(t)},popMatrix:function(){this._matrixStack.pop()},applyBoundingBox:function(){var t=new i;return function(e){e.valid()&&(e.transformMat4(t,this._matrixStack.back()),this._bb.expandByBoundingBox(t))}}(),getMatrixStack:function(){return this._matrixStack}}),"osg","ComputeBoundsVisitor"),t.exports=l},function(t,e,r){"use strict";var i=r(7),n=r(12),a=r(37),s=r(45),o=r(47),h=r(49),u=function(){n.call(this),this._attributes={},this._primitives=[],this._cacheDrawCall={},this._useVAO=void 0,this._vao={},this._cacheVertexAttributeBufferList={},this._shape=void 0};u.enableVAO=!0,i.createPrototypeNode(u,i.objectInherit(n.prototype,{releaseGLObjects:function(){void 0!==this.stateset&&this.stateset.releaseGLObjects();for(var t in this._attributes){var e=this._attributes[t];e.releaseGLObjects()}for(var r=0,i=this._primitives.length;r<i;r++){var n=this._primitives[r];void 0!==n.getIndices&&void 0!==n.getIndices()&&null!==n.getIndices()&&n.indices.releaseGLObjects()}this.releaseVAO()},releaseVAO:function(){if(this._useVAO&&this._glContext)for(var t in this._vao)this._vao[t]&&(this._vao[t].releaseGLObjects(),this._vao[t]=void 0)},dirty:function(){this._cacheDrawCall={},this.releaseVAO()},getPrimitives:function(){return this.getPrimitiveSetList()},getAttributes:function(){return this.getVertexAttributeList()},getShape:function(){return this._shape},setShape:function(t){this._shape=t},getVertexAttributeList:function(){return this._attributes},getPrimitiveSetList:function(){return this._primitives},setVertexAttribArray:function(t,e){this._attributes[t]!==e&&(this._attributes[t]=e,this.dirty())},_generateVertexSetup:function(t,e,r){for(var i=["//generated by Geometry::implementation","state.lazyDisablingOfVertexAttributes();","var attr;"],n=0,a=t.length;n<a;n++)i.push("attr = this._attributes['"+t[n]+"'];"),i.push("if ( attr.BufferArrayProxy ) attr = attr.getBufferArray();"),i.push("if ( !attr.isValid() ) return;"),i.push("state.setVertexAttribArray("+e[n]+", attr, attr.getNormalize() );");return i.push("state.applyDisablingOfVertexAttributes();"),r&&i.push("state.setIndexArray( this._primitives[ 0 ].getIndices() );"),i},_generatePrimitive:function(t,e,r){var i=[e?"state.enableVertexColor();":"state.disableVertexColor();"];if(r)return i.concat(["var primitive = this._primitives[ 0 ];","var indexes = primitive.getIndices();","if ( indexes.isDirty() ) {;","  indexes.bind( gl );","  indexes.compile( gl );","};","primitive.drawElements( state );"]);i.push("var primitives = this._primitives;");for(var n=0,a=t.length;n<a;n++)i.push("primitives["+n+"].draw(state);");return i},generateDrawCommand:function(){var t=[],e=[];return function(r,i,n){var a=i._attributesCache,u=this.getVertexAttributeList();e.length=0,t.length=0;var c,l,d,_,f=this._useVAO,g=f?[]:void 0,p=!1;for(var m in a)if(c=a[m],_=u[m],void 0!==_){var v=this._attributes[m];if(v instanceof o&&(v=v.getBufferArray(),f=!1),!v.isValid())return;f&&g.push(v),p||"Color"!==m||(p=!0),e.push(m),t.push(c)}var S,x;if(f){this._cacheVertexAttributeBufferList[n]=g;var b=1===this._primitives.length&&this._primitives[0]instanceof s,y=this._generateVertexSetup(e,t,b);r.clearVertexAttribCache();var M=r.getGraphicContext(),T=new h(M);T.create(M),r.setVertexArrayObject(T),this._vao[n]=T;var A=new Function("state",y.join("\n"));A.call(this,r);var C=["var gl = state.getGraphicContext();","var vao = this._vao[ "+n+" ] ","var hasChanged = state.setVertexArrayObject( vao );","if ( hasChanged ) {","  var vaList = this._cacheVertexAttributeBufferList[ "+n+" ];","  var va;"];for(l=0,d=g.length;l<d;l++)C.push("  va = vaList[ "+l+"];"),C.push("  if ( va.isDirty() ) {;"),C.push("    va.bind( gl );"),C.push("    va.compile( gl );"),C.push("  };");C.push("}"),S=C.concat(this._generatePrimitive(this._primitives,p,b)).join("\n"),x="GeometryDrawImplementationCacheVAO"}else S=this._generateVertexSetup(e,t,!1).concat(this._generatePrimitive(this._primitives,p,!1)).join("\n"),x="GeometryDrawImplementationCache";var I=new Function("state","return function "+x+"( state ) { "+S+"}")();return this._cacheDrawCall[n]=I,I}}(),drawImplementation:function(t){var e=t.getLastProgramApplied(),r=e.getInstanceID(),i=this._cacheDrawCall[r];return this._useVAO&&(this._vao[r]?this._vao[r].isDirty()&&(i=void 0):t.setVertexArrayObject(null)),i?void i.call(this,t):void(this._primitives.length&&(void 0===this._useVAO&&u.enableVAO&&(this._useVAO=a.instance().hasVAO(),this._glContext=t.getGraphicContext()),i=this.generateDrawCommand(t,e,r),i.call(this,t),t.setVertexArrayObject(null)))},setBound:function(t){this._boundingBox=t,this._boundingBoxComputed=!0},computeBoundingBox:function(t){t.init();var e=this.getVertexAttributeList().Vertex;if(e&&e.getElements()&&e.getItemSize()>2){for(var r=e.getElements(),i=e.getItemSize(),n=t.getMin(),a=t.getMax(),s=n[0],o=n[1],h=n[2],u=a[0],c=a[1],l=a[2],d=0,_=r.length;d<_;d+=i){var f=r[d],g=r[d+1],p=r[d+2];f<s&&(s=f),f>u&&(u=f),g<o&&(o=g),g>c&&(c=g),p<h&&(h=p),p>l&&(l=p)}n[0]=s,n[1]=o,n[2]=h,a[0]=u,a[1]=c,a[2]=l}return t},computeBoundingSphere:function(t){t.init();var e=this.getBoundingBox();return t.expandByBoundingBox(e),t}}),"osg","Geometry"),u.appendVertexAttributeToList=function(t,e,r){for(var i in t){var n=i;void 0!==r&&(n+="_"+r),e[n]=t[i]}},t.exports=u},function(t,e,r){"use strict";var i,n=r(9),a=r(38),s=r(39),o=function(){i||(i=r(40)),this._checkRTT={},this._webGLExtensions={},this._webGLParameters={},this._webGLShaderMaxInt="NONE",this._webGLShaderMaxFloat="NONE",this._bugsDB={},this._webGLPlatforms={},this._webGLParameters.MAX_COMBINED_TEXTURE_IMAGE_UNITS=8,this._webGLParameters.MAX_CUBE_MAP_TEXTURE_SIZE=16,this._webGLParameters.MAX_FRAGMENT_UNIFORM_VECTORS=16,this._webGLParameters.MAX_RENDERBUFFER_SIZE=1,this._webGLParameters.MAX_TEXTURE_IMAGE_UNITS=8,this._webGLParameters.MAX_TEXTURE_SIZE=64,this._webGLParameters.MAX_VARYING_VECTORS=8,this._webGLParameters.MAX_VERTEX_ATTRIBS=8,this._webGLParameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS=0,this._webGLParameters.MAX_VERTEX_UNIFORM_VECTORS=128,this._webGLParameters.MAX_VIEWPORT_DIMS=[1,1],this._webGLParameters.NUM_COMPRESSED_TEXTURE_FORMATS=0,this._webGLParameters.MAX_SHADER_PRECISION_FLOAT="none",this._webGLParameters.MAX_SHADER_PRECISION_INT="none",this._gl=void 0};o.instance=function(t,e){if(!o._instance){var r,i=t;if(!i){var h="undefined"!=typeof window&&window.gli;h&&(r=window.gli.host.inspectContext,window.gli.host.inspectContext=!1);var u=document.createElement("canvas");u.width=32,u.height=32;var c=new s;c.extend({antialias:!1}),c.extendWithOptionsURL(),i=a.setupWebGL(u,c,function(){})}o._instance=new o,i?o._instance.init(i):n.warn("no support for webgl context detected."),r&&(window.gli.host.inspectContext=r)}return t&&(e||t!==o._instance.getContext())&&o._instance.initContextDependant(t),o._instance},o.prototype={getContext:function(){return this._gl},initContextDependant:function(t){this._gl=t,this._isGL2="undefined"!=typeof window.WebGL2RenderingContext&&t instanceof window.WebGL2RenderingContext,this.initWebGLExtensions(t),this.hasLinearHalfFloatRTT(t),this.hasLinearFloatRTT(t),this.hasHalfFloatRTT(t),this.hasFloatRTT(t)},init:function(t){if(this.initWebGLParameters(t),this.initPlatformSupport(),this.initBugDB(),this.initContextDependant(t),this._isGL2)for(var e=["OES_element_index_uint","EXT_sRGB","EXT_blend_minmax","EXT_frag_depth","WEBGL_depth_texture","EXT_shader_texture_lod","OES_standard_derivatives","OES_texture_float","OES_texture_half_float","OES_texture_half_float_linear","OES_texture_float_linear","OES_vertex_array_object","WEBGL_draw_buffers","OES_fbo_render_mipmap","ANGLE_instanced_arrays"],r=o._instance.getWebGLExtensions(),i=function(){},n=0,a=e.length;n<a;n++)r[e[n]]=i},isWebGL2:function(){return this._isGL2},initBugDB:function(){var t=this._webGLPlatforms,e=this._webGLParameters;t.Apple&&(e.UNMASKED_VENDOR_WEBGL&&e.UNMASKED_VENDOR_WEBGL.indexOf("Intel")===-1||(this._bugsDB.OES_standard_derivatives=!0))},initPlatformSupport:function(){var t=this._webGLPlatforms;t.Apple=navigator.vendor.indexOf("Apple")!==-1||navigator.vendor.indexOf("OS X")!==-1,t.Mobile=/Mobi/.test(navigator.userAgent)||/ablet/.test(navigator.userAgent)},getWebGLPlatform:function(t){return this._webGLPlatforms[t]},getWebGLPlatforms:function(){return this._webGLPlatforms},getWebGLParameter:function(t){return this._webGLParameters[t]},getWebGLParameters:function(){return this._webGLParameters},getShaderMaxPrecisionFloat:function(){return this._webGLParameters.MAX_SHADER_PRECISION_FLOAT},getShaderMaxPrecisionInt:function(){return this._webGLParameters.MAX_SHADER_PRECISION_INT},checkSupportRTT:function(t,e,r){var i=e+","+r;if(this._isGL2)return!!this._webGLExtensions.EXT_color_buffer_float;if(void 0!==this._checkRTT[i])return this._checkRTT[i];if(!t)return!1;var n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,2,2,0,t.RGBA,e,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,r);var a=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,a),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);var s=this._checkRTT[i]=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.deleteTexture(n),t.deleteFramebuffer(a),t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),s},hasLinearHalfFloatRTT:function(t){return this._webGLExtensions.OES_texture_half_float_linear&&this.checkSupportRTT(t,i.HALF_FLOAT_OES,i.LINEAR)},hasLinearFloatRTT:function(t){return this._webGLExtensions.OES_texture_float_linear&&this.checkSupportRTT(t,i.FLOAT,i.LINEAR)},hasHalfFloatRTT:function(t){return this._webGLExtensions.OES_texture_half_float&&this.checkSupportRTT(t,i.HALF_FLOAT_OES,i.NEAREST)},hasFloatRTT:function(t){return this._webGLExtensions.OES_texture_float&&this.checkSupportRTT(t,i.FLOAT,i.NEAREST)},queryPrecision:function(t,e,r){var i=t.getShaderPrecisionFormat(e,r);return!!i&&0!==i.precision},hasVAO:function(){return!!this._webGLExtensions.OES_vertex_array_object},getDisjointTimerQuery:function(){return this._webGLExtensions.EXT_disjoint_timer_query_webgl2||this._webGLExtensions.EXT_disjoint_timer_query},initWebGLParameters:function(t){if(t){for(var e=["MAX_COMBINED_TEXTURE_IMAGE_UNITS","MAX_CUBE_MAP_TEXTURE_SIZE","MAX_FRAGMENT_UNIFORM_VECTORS","MAX_RENDERBUFFER_SIZE","MAX_TEXTURE_IMAGE_UNITS","MAX_TEXTURE_SIZE","MAX_VARYING_VECTORS","MAX_VERTEX_ATTRIBS","MAX_VERTEX_TEXTURE_IMAGE_UNITS","MAX_VERTEX_UNIFORM_VECTORS","MAX_VIEWPORT_DIMS","SHADING_LANGUAGE_VERSION","VERSION","VENDOR","RENDERER","ALIASED_LINE_WIDTH_RANGE","ALIASED_POINT_SIZE_RANGE","RED_BITS","GREEN_BITS","BLUE_BITS","ALPHA_BITS","DEPTH_BITS","STENCIL_BITS"],r=this._webGLParameters,i=0,n=e.length;i<n;++i){var a=e[i];r[a]=t.getParameter(t[a])}this.queryPrecision(t,t.FRAGMENT_SHADER,t.HIGH_FLOAT)?r.MAX_SHADER_PRECISION_FLOAT="high":this.queryPrecision(t,t.FRAGMENT_SHADER,t.MEDIUM_FLOAT)?r.MAX_SHADER_PRECISION_FLOAT="medium":this.queryPrecision(t,t.FRAGMENT_SHADER,t.LOW_FLOAT)&&(r.MAX_SHADER_PRECISION_FLOAT="low"),this.queryPrecision(t,t.FRAGMENT_SHADER,t.HIGH_INT)?r.MAX_SHADER_PRECISION_INT="high":this.queryPrecision(t,t.FRAGMENT_SHADER,t.MEDIUM_INT)?r.MAX_SHADER_PRECISION_INT="medium":this.queryPrecision(t,t.FRAGMENT_SHADER,t.LOW_INT)&&(r.MAX_SHADER_PRECISION_INT="low");var s=t.getExtension("WEBGL_debug_renderer_info");s&&(r.UNMASKED_RENDERER_WEBGL=t.getParameter(s.UNMASKED_VENDOR_WEBGL),r.UNMASKED_VENDOR_WEBGL=t.getParameter(s.UNMASKED_RENDERER_WEBGL))}},applyExtension:function(t,e){var r=t.getExtension(e),i=e.split("_")[0],n="_"+i,a=new RegExp(i+"$"),s=new RegExp(n);for(var o in r){var h=r[o];if("function"==typeof h){var u=o.replace(a,"");o.substring&&(t[u]=r[o].bind(r))}else{var c=o.replace(s,"");void 0===t[c]&&(t[c]=r[o])}}},getWebGLExtension:function(t){return this._webGLExtensions[t]},getWebGLExtensions:function(){return this._webGLExtensions},initWebGLExtensions:function(t,e){if(t){var r=e;void 0===r&&(r=!0);var n=t.getSupportedExtensions();if(n){for(var a=this._webGLExtensions,s=0,o=n.length;s<o;++s){var h=n[s];r&&this._bugsDB[h]||(a[h]=t.getExtension(h),this._isGL2||this.applyExtension(t,h))}var u=this.getWebGLExtension("EXT_texture_filter_anisotropic");u&&(i.ANISOTROPIC_SUPPORT_EXT=!0,i.ANISOTROPIC_SUPPORT_MAX=t.getParameter(u.MAX_TEXTURE_MAX_ANISOTROPY_EXT))}}}},t.exports=o},function(t,e){"use strict";var r=function(){var t=function(t){return'<div style="margin: auto; width:500px;z-index:10000;margin-top:20em;text-align:center;">'+t+"</div>"},e='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>',r='It doesn\'t appear your computer can support WebGL.<br/><a href="http://get.webgl.org">Click here for more information.</a>',i=!0,n=function(n,a,o){function h(n){if(i){var a=document.getElementsByTagName("body")[0];if(a){var s=window.WebGLRenderingContext?r:e;n&&(s+="<br/><br/>Status: "+n),a.innerHTML=t(s)}}}o=o||h,n.addEventListener&&n.addEventListener("webglcontextcreationerror",function(t){o(t.statusMessage)},!1);var u=s(n,a);return u||o(""),u},a=function(t,e,r){for(var i=null,n=0;n<r.length;++n){try{i=t.getContext(r[n],e)}catch(t){}if(i)break}return i},s=function(t,e){var r;if(e&&e.webgl2){if(i=!1,r=a(t,e,["webgl2","experimental-webgl2"]))return r;i=!0}return a(t,e,["webgl","experimental-webgl","webkit-3d","moz-webgl"])};return{create3DContext:s,setupWebGL:n}}();window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,e){window.setTimeout(t,1e3/60)}}()),window.cancelRequestAnimFrame||(window.cancelAnimationFrame=function(){return window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout}()),Date.now||(Date.now=function(){return(new Date).getTime()}),t.exports=r},function(t,e,r){"use strict";var i,n=r(9),a=r(7),s={antialias:!0,fullscreen:!0,enableFrustumCulling:!1,stats:!1,scrollwheel:!0,webgl2:!1,powerPreference:"high-performance"},o=function(){for(var t in s)this[t]=s[t]};o.getOptionsURL=function(){if(i)return i;if(i={},!window.location.search)return i;for(var t,e=[],r=window.location.search.slice(1).split("&"),a=0;a<r.length;a++){t=r[a].split("=");var s=t[0];e.push(s);var o=t[1];"0"!==o&&"false"!==o&&(void 0===o&&(o="1"),i[s]=o)}if(void 0!==i.log){var h=i.log.toLowerCase();switch(h){case"debug":n.setNotifyLevel(n.DEBUG);break;case"info":n.setNotifyLevel(n.INFO);break;case"notice":n.setNotifyLevel(n.NOTICE);break;case"warn":n.setNotifyLevel(n.WARN);break;case"error":n.setNotifyLevel(n.ERROR);break;case"html":var u=[],c=document.createElement("div"),l=document.createElement("pre");document.addEventListener("DOMContentLoaded",function(){document.body.appendChild(c),c.appendChild(l)});var d=function(t){u.unshift(t),l.innerHTML=u.join("\n")};c.style.overflow="hidden",c.style.position="absolute",c.style.zIndex="10000",c.style.height="100%",c.style.maxWidth="600px",l.style.overflow="scroll",l.style.width="105%",l.style.height="100%",l.style.fontSize="10px",["log","error","warn","info","debug"].forEach(function(t){window.console[t]=d})}}return i},o.prototype={extend:function(t){return a.objectMix(this,t),this},get:function(t){return this[t]},getBoolean:function(t){var e=this.getString(t);if(e)return"false"!==e&&"0"!==e},getNumber:function(t){var e=this[t];if(e)return Number(e)},getString:function(t){var e=this[t];if(void 0!==e)return this[t].toString()},extendWithOptionsURL:function(){this.extend(o.getOptionsURL())}},t.exports=o},function(t,e,r){"use strict";var i=r(9),n=r(7),a=r(30),s=r(41),o=r(42),h=r(43),u=r(44),c=r(37),l=window.ImageBitmap||function(){},d=function(t){return 0!==t&&(t&~t+1)===t},_=function(){a.call(this),h.call(this),this.setDefaultParameters(),this._dirty=!0,this._dirtyMipmap=!0,this._applyTexImage2DCallbacks=[],this._textureObject=void 0,this._textureNull=!0},f=function(t,e){var r=_[t];return void 0===r?(i.warn("bad Texture enum argument "+t+"\nfallback to "+e),e):r};_.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,_.UNPACK_FLIP_Y_WEBGL=37440,_.BROWSER_DEFAULT_WEBGL=37444,_.NONE=0,_.DEPTH_COMPONENT=6402,_.DEPTH_COMPONENT16=33189,_.DEPTH_STENCIL=34041,_.DEPTH24_STENCIL8=35056,_.DEPTH_COMPONENT24=33190,_.DEPTH_COMPONENT32F=36012,_.COMPRESSED_RGB_S3TC_DXT1_EXT=33776,_.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777,_.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778,_.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779,_.COMPRESSED_RGB_ATC_WEBGL=35986,_.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35987,_.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798,_.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840,_.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841,_.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842,_.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843,_.COMPRESSED_RGB_ETC1_WEBGL=36196,_.LINEAR=9729,_.NEAREST=9728,_.NEAREST_MIPMAP_NEAREST=9984,_.LINEAR_MIPMAP_NEAREST=9985,_.NEAREST_MIPMAP_LINEAR=9986,_.LINEAR_MIPMAP_LINEAR=9987,_.TEXTURE_MAX_ANISOTROPY_EXT=34046,_.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047,_.CLAMP_TO_EDGE=33071,_.REPEAT=10497,_.MIRRORED_REPEAT=33648,_.TEXTURE_2D=3553,_.TEXTURE_CUBE_MAP=34067,_.TEXTURE_BINDING_CUBE_MAP=34068,_.TEXTURE_CUBE_MAP_POSITIVE_X=34069,_.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,_.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,_.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,_.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,_.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,_.MAX_CUBE_MAP_TEXTURE_SIZE=34076,_.UNSIGNED_BYTE=5121,_.UNSIGNED_SHORT=5123,_.UNSIGNED_SHORT_4_4_4_4=32819,_.UNSIGNED_SHORT_5_5_5_1=32820,_.UNSIGNED_SHORT_5_6_5=33635,_.FLOAT=5126,_.HALF_FLOAT_OES=36193,_.HALF_FLOAT=5131,_.UNSIGNED_INT_10F_11F_11F_REV=35899,_.UNSIGNED_INT_24_8=34042,_.ALPHA=6406,_.RGB=6407,_.RGBA=6408,_.LUMINANCE=6409,_.LUMINANCE_ALPHA=6410,_.RED_INTEGER=36244,_.RGB_INTEGER=36248,_.RGBA_INTEGER=36249,_.RG_INTEGER=33320,_.RED=6403,_.R8=33321,_.R8UI=33330,_.RG8=33323,_.RG8UI=33336,_.RGB8=36758,_.RGB565=36194,_.RGB9_E5=35901,_.RGB8UI=36221,_.RGBA8=32856,_.RGB5_A1=32855,_.RGBA4=32854,_.RGBA8UI=36220,_.SRGB8_ALPHA8=35907,_.SRGB8=35905,_.R16F=33325,_.RG16F=33327,_.RGB16F=34843,_.RGBA16F=34842,_.R11F_G11F_B10F=35898,_.R32F=33326,_.RG32F=33328,_.RGB32F=34837,_.RGBA32F=34836;var g=function(){var t={};return t[_.R8]=_.LUMINANCE,t[_.R8UI]=_.LUMINANCE,t[_.R16F]=_.LUMINANCE,t[_.R32F]=_.LUMINANCE,t[_.SRGB8]=_.LUMINANCE,t[_.RG8]=_.RGB,t[_.RG8UI]=_.RGB,t[_.RG16F]=_.RGB,t[_.RG32F]=_.RGB,t[_.RGB8]=_.RGB,t[_.RGB565]=_.RGB,t[_.RGB9_E5]=_.RGB,t[_.RGB8UI]=_.RGB,t[_.RGB5_A1]=_.RGB,t[_.RGB16F]=_.RGB,t[_.RGB32F]=_.RGB,t[_.RGBA8]=_.RGBA,t[_.R11F_G11F_B10F]=_.RGBA,t[_.RGBA16F]=_.RGBA,t[_.RGBA32F]=_.RGBA,t[_.SRGB8_ALPHA8]=_.RGBA,t},p=function(){var t={},e={},r={},i={},n={},a={};return t[_.FLOAT]=e,t[_.HALF_FLOAT]=t[_.HALF_FLOAT_OES]=r,t[_.UNSIGNED_SHORT]=i,t[_.UNSIGNED_INT]=n,t[_.UNSIGNED_INT_24_8]=a,r[_.LUMINANCE]=_.R16F,r[_.RGB]=_.RGB16F,r[_.RGBA]=_.RGBA16F,e[_.LUMINANCE]=_.R32F,e[_.RGB]=_.RGB32F,e[_.RGBA]=_.RGBA32F,i[_.DEPTH_COMPONENT]=_.DEPTH_COMPONENT16,n[_.DEPTH_COMPONENT]=_.DEPTH_COMPONENT32F,a[_.DEPTH_STENCIL]=_.DEPTH24_STENCIL8,t},m=g(),v=p();_._sTextureManager=new window.Map,_.getTextureManager=function(t){return _._sTextureManager.has(t)||_._sTextureManager.set(t,new u),_._sTextureManager.get(t)},_.getEnumFromString=function(t){var e=t;return"string"==typeof e&&(e=f(e,t)),e},n.createPrototypeStateAttribute(_,n.objectInherit(h.prototype,n.objectInherit(a.prototype,{attributeType:"Texture",cloneType:function(){return new _},invalidate:function(){this._textureObject=void 0,this.dirty()},dirty:function(){this._dirty=!0},isDirty:function(){return this._dirty},isTextureNull:function(){return this._textureNull},getOrCreateUniforms:function(t){if(void 0===_.uniforms&&(_.uniforms=[]),void 0===_.uniforms[t]){var e=this.getType()+t;_.uniforms[t]={texture:s.createInt1(t,e)}}return _.uniforms[t]},setDefaultParameters:function(){this._image=void 0,this._magFilter=_.LINEAR,this._minFilter=_.LINEAR,this._maxAnisotropy=1,this._wrapS=_.CLAMP_TO_EDGE,this._wrapT=_.CLAMP_TO_EDGE,this._textureWidth=0,this._textureHeight=0,this._unrefImageDataAfterApply=!1,this._internalFormat=void 0,this._dirtyMipmap=!0,this._textureTarget=_.TEXTURE_2D,this.setInternalFormatType(_.UNSIGNED_BYTE),this._isCompressed=!1,this._flipY=!0,this._colorSpaceConversion=_.NONE},setColorSpaceConversion:function(t){this._colorSpaceConversion=t},setFlipY:function(t){this._flipY=t},getTextureTarget:function(){return this._textureTarget},getTextureObject:function(){return this._textureObject},setTextureSize:function(t,e){var r=c.instance().getWebGLParameter("MAX_TEXTURE_SIZE");t===this._textureWidth&&e===this._textureHeight||this.dirty(),void 0!==t&&(t>r?(i.error("width ("+t+') too big for GPU. Max Texture Size is "'+r+'"'),this._textureWidth=r):this._textureWidth=t),void 0!==e&&(e>r?(i.error("height ("+e+') too big for GPU. Max Texture Size is "'+r+'"'),this._textureHeight=r):this._textureHeight=e),this._textureNull=!1},init:function(t){this._gl||this.setGraphicContext(t.getGraphicContext()),this._textureObject||(this._textureObject=_.getTextureManager(this._gl).generateTextureObject(this._gl,this,this._textureTarget,this._internalFormat,this._textureWidth,this._textureHeight),this.dirty(),this._dirtyTextureObject=!1,this._textureNull=!1)},addApplyTexImage2DCallback:function(t){var e=this._applyTexImage2DCallbacks.indexOf(t);e<0&&this._applyTexImage2DCallbacks.push(t)},removeApplyTexImage2DCallback:function(t){var e=this._applyTexImage2DCallbacks.indexOf(t);e>=0&&this._applyTexImage2DCallbacks.splice(e,1)},getWidth:function(){return this._textureWidth},getHeight:function(){return this._textureHeight},releaseGLObjects:function(){void 0!==this._textureObject&&null!==this._textureObject&&void 0!==this._gl&&(_.getTextureManager(this._gl).releaseTextureObject(this._textureObject),h.removeObject(this._gl,this)),this.invalidate()},getWrapT:function(){return this._wrapT},getWrapS:function(){return this._wrapS},setWrapS:function(t){"string"==typeof t?this._wrapS=f(t,_.CLAMP_TO_EDGE):this._wrapS=t,this.dirtyTextureParameters()},setWrapT:function(t){"string"==typeof t?this._wrapT=f(t,_.CLAMP_TO_EDGE):this._wrapT=t,this.dirtyTextureParameters()},dirtyTextureParameters:function(){this.dirty(),this.dirtyMipmap(),this.dirtyTextureObject()},dirtyTextureObject:function(){this._dirtyTextureObject=!0,this.dirtyMipmap(),this.dirty()},getMinFilter:function(){return this._minFilter},getMagFilter:function(){return this._magFilter},setMaxAnisotropy:function(t){this._maxAnisotropy=t,this.dirtyTextureParameters()},getMaxAnisotropy:function(){return this._maxAnisotropy},setMinFilter:function(t){"string"==typeof t?this._minFilter=f(t,_.LINEAR):this._minFilter=t,this.dirtyTextureParameters()},setMagFilter:function(t){"string"==typeof t?this._magFilter=f(t,_.LINEAR):this._magFilter=t,this.dirtyTextureParameters()},setImage:function(t,e){var r=t;(t instanceof window.Image||t instanceof HTMLCanvasElement||t instanceof l||t instanceof Uint8Array||t instanceof Uint16Array||t instanceof Float32Array)&&(r=new o(t)),this._image=r,this.setImageFormat(e),r&&(r.getWidth&&r.getHeight?this.setTextureSize(r.getWidth(),r.getHeight()):r.width&&r.height&&this.setTextureSize(r.width,r.height)),this._textureNull=!1,this.dirty()},getImage:function(){return this._image},setImageFormat:function(t){var e=t;e?("string"==typeof e&&(e=_[e]),this._imageFormat=e):this._imageFormat=_.RGBA},setInternalFormatType:function(t){"string"==typeof t?this._type=_[t]:this._type=t},getInternalFormatType:function(){return this._type},setUnrefImageDataAfterApply:function(t){this._unrefImageDataAfterApply=t},checkIsCompressed:function(t){var e=t||this._internalFormat;switch(e){case _.COMPRESSED_RGB_S3TC_DXT1_EXT:case _.COMPRESSED_RGBA_S3TC_DXT1_EXT:case _.COMPRESSED_RGBA_S3TC_DXT3_EXT:case _.COMPRESSED_RGBA_S3TC_DXT5_EXT:case _.COMPRESSED_RGB_ATC_WEBGL:case _.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:case _.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:case _.COMPRESSED_RGB_PVRTC_4BPPV1_IMG:case _.COMPRESSED_RGB_PVRTC_2BPPV1_IMG:case _.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:case _.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:case _.COMPRESSED_RGB_ETC1_WEBGL:return!0;default:return!1}},setInternalFormat:function(t){var e=t;e?("string"==typeof e&&(e=_[e]),this._isCompressed=this.checkIsCompressed(e)):(this._isCompressed=!1,e=_.RGBA),this._internalFormat=e},getInternalFormat:function(){return this._internalFormat},isDirtyMipmap:function(){return this._dirtyMipmap},dirtyMipmap:function(){this._dirtyMipmap=!0},applyFilterParameter:function(t,e){var r=d(this._textureWidth)&&d(this._textureHeight);if(r||(this._wrapT=_.CLAMP_TO_EDGE,this._wrapS=_.CLAMP_TO_EDGE,this._minFilter!==_.LINEAR_MIPMAP_LINEAR&&this._minFilter!==_.LINEAR_MIPMAP_NEAREST||(this._minFilter=_.LINEAR)),t.texParameteri(e,t.TEXTURE_MAG_FILTER,this._magFilter),t.texParameteri(e,t.TEXTURE_MIN_FILTER,this._minFilter),this._maxAnisotropy>1&&_.ANISOTROPIC_SUPPORT_EXT){var i=this._maxAnisotropy<_.ANISOTROPIC_SUPPORT_MAX?this._maxAnisotropy:_.ANISOTROPIC_SUPPORT_MAX;t.texParameterf(e,_.TEXTURE_MAX_ANISOTROPY_EXT,i)}t.texParameteri(e,t.TEXTURE_WRAP_S,this._wrapS),t.texParameteri(e,t.TEXTURE_WRAP_T,this._wrapT)},generateMipmap:function(t,e){if(this._dirtyMipmap=!1,this.hasMipmapFilter()){var r=this._image;if(r&&r.hasMipmap())for(var i=this._getInternalFormatGL(),n=r.getMipmap(),a=1,s=n.length;a<s;a++){var o=n[a];this._isCompressed?this.applyTexImage2D(t,this._textureTarget,a,i,o.getWidth(),o.getHeight(),0,o.getImage()):this.applyTexImage2D(t,this._textureTarget,a,i,o.getWidth(),o.getHeight(),0,this._internalFormat,this._type,o.getImage())}else t.generateMipmap(e)}},hasMipmapFilter:function(){return this._minFilter===_.NEAREST_MIPMAP_NEAREST||this._minFilter===_.LINEAR_MIPMAP_NEAREST||this._minFilter===_.NEAREST_MIPMAP_LINEAR||this._minFilter===_.LINEAR_MIPMAP_LINEAR},applyTexImage2D:function(t){var e=Array.prototype.slice.call(arguments,1);n.timeStamp("osgjs.metrics:Texture.texImage2d"),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,this._flipY),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._colorSpaceConversion),this._isCompressed?t.compressedTexImage2D.apply(t,e):t.texImage2D.apply(t,e);var r=this._applyTexImage2DCallbacks.length;if(r>0)for(var i=0,a=r;i<a;i++)this._applyTexImage2DCallbacks[i].call(this)},computeTextureFormat:function(){this._internalFormat?this._imageFormat=this._internalFormat:(this._internalFormat=this._imageFormat||_.RGBA,this._imageFormat=this._internalFormat)},applyImage:function(t){var e=this._getInternalFormatGL(),r=this._image||null,i=r&&this._image.getImage(),n=this._getTypeGL();this._isCompressed?this.applyTexImage2D(t,this._textureTarget,0,e,this._textureWidth,this._textureHeight,0,i):!i||r.isTypedArray()?this.applyTexImage2D(t,this._textureTarget,0,e,this._textureWidth,this._textureHeight,0,this._internalFormat,n,i):this.applyTexImage2D(t,this._textureTarget,0,e,this._internalFormat,n,i),r&&r.setDirty(!1)},apply:function(t){var e=t.getGraphicContext();if(this._dirtyTextureObject&&(this.releaseGLObjects(),this._dirtyTextureObject=!1,this.setGraphicContext(e)),void 0===this._textureObject||this.isDirty())if(this._textureNull)e.bindTexture(this._textureTarget,null);else{var r=this._image;if(void 0!==r)if(r.isReady()){this.computeTextureFormat();var i=r.getWidth()||this._textureWidth,n=r.getHeight()||this._textureHeight;this.setTextureSize(i,n),this._textureObject||this.init(t),this._textureObject.bind(e),this.applyImage(e),this.applyFilterParameter(e,this._textureTarget),this.generateMipmap(e,this._textureTarget),this._unrefImageDataAfterApply&&(this._image=void 0),
this._dirty=!1}else e.bindTexture(this._textureTarget,null);else 0!==this._textureHeight&&0!==this._textureWidth&&(this.computeTextureFormat(),this._textureObject||this.init(t),this._textureObject.bind(e),this.applyImage(e),this.applyFilterParameter(e,this._textureTarget),this.generateMipmap(e,this._textureTarget),this._dirty=!1)}else this._textureObject.bind(e),this.isDirtyMipmap()&&this.generateMipmap(e,this._textureTarget),void 0!==this._image&&this._image.isDirty()&&this.applyImage(e)},_getInternalFormatGL:function(){var t=this._internalFormat;if(!c.instance().isWebGL2())return m[t]||t;var e=v[this._type];return e&&e[t]||t},_getTypeGL:function(){return this._type!==_.HALF_FLOAT||c.instance().isWebGL2()?this._type:_.HALF_FLOAT_OES}})),"osg","Texture"),_.textureNull=new _,_.createFromImage=function(t,e){var r=new _;return r.setImage(t,e),r},_.createFromCanvas=function(t,e){return _.createFromImage(t,e)},t.exports=_},function(t,e,r){"use strict";var i=r(9),n=function(t){this._data=void 0,this._transpose=!1,this._glCall="",this._cache=void 0,this._name=t,this._type=void 0,this._isMatrix=!1};n.isUniform=function(t){return"object"==typeof t&&window.Object.getPrototypeOf(t)===n.prototype},n.prototype={getName:function(){return this._name},getType:function(){return this._type},apply:function(t,e){this._cache||(this._cache=t[this._glCall]),this._isMatrix?this._cache.call(t,e,this._transpose,this._data):this._cache.call(t,e,this._data)},setInternalArray:function(t){i.warn("setInternalArray deprecated, please use getInternalArray instead: "+t.length),this._data=t},getInternalArray:function(){return this._data},setFloat:function(t){this._data[0]=t},setFloat1:function(t){this._data[0]=t[0]},setFloat2:function(t){this._data[0]=t[0],this._data[1]=t[1]},setFloat3:function(t){this._data[0]=t[0],this._data[1]=t[1],this._data[2]=t[2]},setFloat4:function(t){this._data[0]=t[0],this._data[1]=t[1],this._data[2]=t[2],this._data[3]=t[3]},setFloat9:function(t){this._data[0]=t[0],this._data[1]=t[1],this._data[2]=t[2],this._data[3]=t[3],this._data[4]=t[4],this._data[5]=t[5],this._data[6]=t[6],this._data[7]=t[7],this._data[8]=t[8]},setFloat16:function(t){this._data[0]=t[0],this._data[1]=t[1],this._data[2]=t[2],this._data[3]=t[3],this._data[4]=t[4],this._data[5]=t[5],this._data[6]=t[6],this._data[7]=t[7],this._data[8]=t[8],this._data[9]=t[9],this._data[10]=t[10],this._data[11]=t[11],this._data[12]=t[12],this._data[13]=t[13],this._data[14]=t[14],this._data[15]=t[15]}},n.prototype.setVec2=n.prototype.setFloat2,n.prototype.setVec3=n.prototype.setFloat3,n.prototype.setVec4=n.prototype.setFloat4,n.prototype.setMatrix4=n.prototype.setFloat16,n.prototype.setMatrix3=n.prototype.setFloat9,n.prototype.setInt=n.prototype.setFloat,n.prototype.setInt1=n.prototype.setFloat1,n.prototype.setInt2=n.prototype.setFloat2,n.prototype.setInt3=n.prototype.setFloat3,n.prototype.setInt4=n.prototype.setFloat4;var a=function(t,e,r,i,a,s){var o=e&&e.length?t:void 0,h=new n(void 0!==o?e:t);if(h._data=r,void 0!==o)if(o.length)for(var u=0,c=o.length;u<c;++u)h._data[u]=o[u];else h._data[0]=o;return h._glCall=i,h._type=a,h._isMatrix=!!s,h},s=function(t){for(var e=new Float32Array(4*t),r=0;r<e.length;r+=4)e[r]=e[r+3]=1;return e},o=function(t){for(var e=new Float32Array(9*t),r=0;r<e.length;r+=9)e[r]=e[r+4]=e[r+8]=1;return e},h=function(t){for(var e=new Float32Array(16*t),r=0;r<e.length;r+=16)e[r]=e[r+5]=e[r+10]=e[r+15]=1;return e},u=function(t,e,r){return r&&!r.length?r:"string"!=typeof e?(e.length||1)/t:1};n.createFloat1=function(t,e){return a(t,e,new Float32Array(1*u(1,t,e)),"uniform1fv","float")},n.createFloat2=function(t,e){return a(t,e,new Float32Array(2*u(2,t,e)),"uniform2fv","vec2")},n.createFloat3=function(t,e){return a(t,e,new Float32Array(3*u(3,t,e)),"uniform3fv","vec3")},n.createFloat4=function(t,e){return a(t,e,new Float32Array(4*u(4,t,e)),"uniform4fv","vec4")},n.createInt1=function(t,e){return a(t,e,new Int32Array(1*u(1,t,e)),"uniform1iv","int")},n.createInt2=function(t,e){return a(t,e,new Int32Array(2*u(2,t,e)),"uniform2iv","vec2i")},n.createInt3=function(t,e){return a(t,e,new Int32Array(3*u(3,t,e)),"uniform3iv","vec3i")},n.createInt4=function(t,e){return a(t,e,new Int32Array(4*u(4,t,e)),"uniform4iv","vec4i")},n.createMatrix2=function(t,e){return a(t,e,s(u(4,t,e)),"uniformMatrix2fv","mat2",!0)},n.createMatrix3=function(t,e){return a(t,e,o(u(9,t,e)),"uniformMatrix3fv","mat3",!0)},n.createMatrix4=function(t,e){return a(t,e,h(u(16,t,e)),"uniformMatrix4fv","mat4",!0)},n.float=n.createFloatArray=n.createFloat=n.createFloat1,n.vec2=n.createFloat2Array=n.createFloat2,n.vec3=n.createFloat3Array=n.createFloat3,n.vec4=n.createFloat4Array=n.createFloat4,n.int=n.createIntArray=n.createInt=n.createInt1,n.vec2i=n.createInt2Array=n.createInt2,n.vec3i=n.createInt3Array=n.createInt3,n.vec4i=n.createInt4Array=n.createInt4,n.mat2=n.createMat2Array=n.createMat2=n.createMatrix2,n.mat3=n.createMat3Array=n.createMat3=n.createMatrix3,n.mat4=n.createMat4Array=n.createMat4=n.createMatrix4,t.exports=n},function(t,e,r){"use strict";var i=r(9),n=r(7),a=r(13),s=window.ImageBitmap||function(){},o=function(t){a.call(this),this._imageObject=void 0,this._url=void 0,this._width=void 0,this._height=void 0,this._dirty=!0,this._mipmap=[],t&&this.setImage(t),this._isGreyscale=void 0};n.createPrototypeObject(o,n.objectInherit(a.prototype,{dirty:function(){this._isGreyscale=void 0,this._dirty=!0},isDirty:function(){return this._dirty},setDirty:function(t){this._dirty=t},getImage:function(){return this._imageObject instanceof o?this._imageObject.getImage():this._imageObject},getURL:function(){return this._url},setURL:function(t){this._url=t},useOrCreateImage:function(t){return t instanceof o==!1?new o(t):t},setImage:function(t){if(!this._url&&t&&(t.src||t.currentSrc)&&(this._url=t.src||t.currentSrc),this._mipmap.length=0,Array.isArray(t)){for(var e=0,r=t.length;e<r;e++)this._mipmap.push(this.useOrCreateImage(t[e]));this.setWidth(this._mipmap[0].getWidth()),this.setHeight(this._mipmap[0].getHeight())}else this._mipmap.push(t);this._imageObject=this._mipmap[0],this.dirty()},isCanvas:function(){return this.getImage()instanceof window.HTMLCanvasElement},isBitmap:function(){return this.getImage()instanceof s},isVideo:function(){return this.getImage()instanceof window.HTMLVideoElement},isImage:function(){return this.getImage()instanceof window.Image},isTypedArray:function(){var t=this.getImage();return t instanceof Uint8Array||t instanceof Float32Array||t instanceof Uint16Array},setWidth:function(t){this._width=t},setHeight:function(t){this._height=t},getWidth:function(){var t=this.getImage();return this.isImage()?t.naturalWidth:this.isVideo()?t.videoWidth:this.isCanvas()||this.isBitmap()?t.width:this._width},getHeight:function(){var t=this.getImage();return this.isImage()?t.naturalHeight:this.isVideo()?t.videoHeight:this.isCanvas()||this.isBitmap()?t.height:this._height},isGreyscale:function(t){if(void 0!==this._isGreyscale)return this._isGreyscale;if(void 0!==this._imageObject&&this.isReady()&&void 0===this._isGreyscale){var e=this._imageObject;this.isCanvas()||(e=document.createElement("canvas"));var r=e.getContext("2d");e.width=this._imageObject.width,e.height=this._imageObject.height,r.drawImage(this._imageObject,0,0);var i,n;t||(i=e.width,n=e.height),t>0&&(t=Math.min(Math.min(e.width,e.height),t),i=n=t);for(var a=!0,s=e.width/i,o=e.height/n,h=0;h<i;h++)for(var u=0;u<n;u++){var c=Math.floor(s*(h+.5)),l=Math.floor(o*(u+.5)),d=r.getImageData(c,l,1,1).data;if(d[0]!==d[1]||d[0]!==d[2]){a=!1;break}}this._isGreyscale=a}return this._isGreyscale},isReady:function(){if(this._imageObject&&this._imageObject instanceof o)return this._imageObject.isReady();if(this.isCanvas()||this.isTypedArray()||this.isBitmap())return!0;if(this.isImage()){var t=this.getImage();if(t.complete)return void 0===t.naturalWidth||0!==t.naturalWidth}if(this.isVideo()&&0!==this.getWidth())return!0;var e=this.getImage();return e.complete?void 0===e.naturalWidth||0!==e.naturalWidth:(i.warn("Warning can't detect image object "),!1)},getMipmap:function(){return this._mipmap},hasMipmap:function(){return this._mipmap.length>1},release:function(){this._mipmap.length=0,this._imageObject=void 0}}),"osg","Image"),t.exports=o},function(t,e,r){"use strict";var i=r(9),n=function(){this._gl=void 0,this._onLostContextCallback=void 0};n.prototype={setGraphicContext:function(t){this._gl=t,n.addObject(this._gl,this)},getGraphicContext:function(){return this._gl},setLostContextCallback:function(t){this._onLostContextCallback=t},onLostContext:function(){this.invalidate&&"function"==typeof this.invalidate&&this.invalidate(),this.invalidate&&"function"==typeof this.invalidate||i.error("GLObject needs Dirty mechanism for webgl restore"),this._onLostContextCallback&&this._onLostContextCallback()}},n._sResourcesArrayCache=new window.Map,n.addObject=function(t,e){n._sResourcesArrayCache.has(t)||n._sResourcesArrayCache.set(t,[]);var r=n._sResourcesArrayCache.get(t);r.indexOf(e)===-1&&r.push(e)},n.removeObject=function(t,e){if(n._sResourcesArrayCache.has(t)){var r=n._sResourcesArrayCache.get(t),i=r.indexOf(e);i!==-1&&r.splice(i,1)}},n.onLostContext=function(t){if(n._sResourcesArrayCache.has(t))for(var e=n._sResourcesArrayCache.get(t),r=0,i=e.length;r<i;r++)e[r].onLostContext()},t.exports=n},function(t,e,r){"use strict";var i=r(9),n=r(8),a=function(t,e,r,i){this._target=t,this._internalFormat=e,this._width=r,this._height=i,this._size=0,this.computeSize()};a.prototype={match:function(t){return t._target===this._target&&t._internalFormat===this._internalFormat&&t._width===this._width&&t._height===this._height},computeSize:function(){var t=r(40),e=0;switch(this._internalFormat){case 1:e=8;break;case t.ALPHA:e=8;break;case t.LUMINANCE:e=8;break;case t.LUMINANCE_ALPHA:e=16;break;case 2:e=16;break;case t.RGB:e=24;break;case 3:e=24;break;case t.RGBA:e=32;break;case 4:e=32}var i=Math.ceil(this._width*this._height*e)/8;this._target===t.TEXTURE_CUBE_MAP&&(i*=6),i+=i/3,this._size=i},getSize:function(){return this._size}},a.getHash=function(){var t=Array.prototype.slice.call(arguments),e="";return t.forEach(function(t){e+=t}),e};var s=function(t,e,r){this._texture=t,this._id=e,this._textureSet=r};s.prototype={target:function(){return this._textureSet._profile._target},id:function(){return this._id},getTextureSet:function(){return this._textureSet},reset:function(){this._textureObject=null,this._texture=void 0},bind:function(t){t.bindTexture(this.target(),this._id)}};var o=function(t){this._profile=t,this._usedTextureObjects=[],this._orphanedTextureObjects=[]};o.prototype={getProfile:function(){return this._profile},getUsedTextureObjects:function(){return this._usedTextureObjects},getOrphanedTextureObjects:function(){return this._orphanedTextureObjects},takeOrGenerate:function(t,e){var r;if(this._orphanedTextureObjects.length>0)return r=this.takeFromOrphans(),r._texture=e,this._usedTextureObjects.push(r),r;var i=t.createTexture();return r=new s(e,i,this),this._usedTextureObjects.push(r),r},takeFromOrphans:function(){if(this._orphanedTextureObjects.length)return this._orphanedTextureObjects.pop()},orphan:function(t){var e=this._usedTextureObjects.indexOf(t);e!==-1&&(this._orphanedTextureObjects.push(this._usedTextureObjects[e]),this._usedTextureObjects.splice(e,1))},flushDeletedTextureObjects:function(t,e){if(e<=0)return e;var r,i=this._orphanedTextureObjects.length,a=0,s=n.instance().tick();for(r=0;r<i&&a<e;r++)t.deleteTexture(this._orphanedTextureObjects[r].id()),this._orphanedTextureObjects[r].reset(),a=n.instance().deltaS(s,n.instance().tick());return this._orphanedTextureObjects.splice(0,r),e-a},flushAllDeletedTextureObjects:function(t){for(var e=this._orphanedTextureObjects.length,r=this.getProfile().getSize(),n=0,a=e;n<a;++n)t.deleteTexture(this._orphanedTextureObjects[n].id()),this._orphanedTextureObjects[n].reset();this._orphanedTextureObjects.length=0,i.info("TextureManager: released "+e+" with "+e*r/1048576+" MB")},onLostContext:function(){var t,e;for(e=this._orphanedTextureObjects.length,t=0;t<e;++t)this._orphanedTextureObjects[t].reset();for(this._orphanedTextureObjects.length=0,e=this._usedTextureObjects.length,t=0;t<e;++t)this._usedTextureObjects[t].reset();this._usedTextureObjects.length=0}};var h=function(){this._textureSetMap={}};h.prototype={generateTextureObject:function(t,e,r,i,n,s){var h=a.getHash(r,i,n,s);void 0===this._textureSetMap[h]&&(this._textureSetMap[h]=new o(new a(r,i,n,s)));var u=this._textureSetMap[h],c=u.takeOrGenerate(t,e);return c},updateStats:function(t,e){var r=0,i=0;for(var n in this._textureSetMap){var a=this._textureSetMap[n].getProfile(),s=a.getSize(),o=this._textureSetMap[n].getUsedTextureObjects().length,h=this._textureSetMap[n].getOrphanedTextureObjects().length;r+=o*s,i+=h*s}var u=1048576;e.getCounter("textureused").set(r/u),e.getCounter("texturereserved").set(i/u),e.getCounter("texturetotal").set((r+i)/u)},reportStats:function(){var t=0;for(var e in this._textureSetMap){var r=this._textureSetMap[e].getProfile(),n=r.getSize()/1048576,a=this._textureSetMap[e].getUsedTextureObjects().length;n*=a,t+=n,i.notice(String(n)+" MB with "+a+" texture of "+r._width+"x"+r._height+" "+r._internalFormat)}i.notice(String(t)+" MB in total")},flushAllDeletedTextureObjects:function(t){for(var e in this._textureSetMap)this._textureSetMap[e].flushAllDeletedTextureObjects(t)},onLostContext:function(t){for(var e in this._textureSetMap)this._textureSetMap[e].onLostContext(t)},flushDeletedTextureObjects:function(t,e){var r=e;for(var i in this._textureSetMap)if(r=this._textureSetMap[i].flushDeletedTextureObjects(t,r),r<=0)break;return r},releaseTextureObject:function(t){if(t){var e=t.getTextureSet();e.orphan(t)}}},t.exports=h},function(t,e,r){"use strict";var i=r(46),n=function(t,e){this.mode=i.POINTS,void 0!==t&&("string"==typeof t&&(t=i[t]),this.mode=t),this.count=0,this.offset=0,this.indices=e,this.uType=n.UNSIGNED_SHORT,void 0!==e&&this.setIndices(e)};n.UNSIGNED_BYTE=5121,n.UNSIGNED_SHORT=5123,n.UNSIGNED_INT=5125,n.prototype={getMode:function(){return this.mode},draw:function(t){0!==this.count&&(t.setIndexArray(this.indices),this.drawElements(t))},drawElements:function(t){var e=t.getGraphicContext();e.drawElements(this.mode,this.count,this.uType,this.offset)},setIndices:function(t){this.indices=t;var e=t.getElements();this.count=e.length;var r=e.BYTES_PER_ELEMENT;1===r?this.uType=n.UNSIGNED_BYTE:2===r?this.uType=n.UNSIGNED_SHORT:4===r&&(this.uType=n.UNSIGNED_INT)},getIndices:function(){return this.indices},setFirst:function(t){this.offset=t},getFirst:function(){return this.offset},setCount:function(t){this.count=t},getCount:function(){return this.count},getNumIndices:function(){return this.indices.getElements().length},index:function(t){return this.indices.getElements()[t]}},t.exports=n},function(t,e){"use strict";var r={};r.POINTS=0,r.LINES=1,r.LINE_LOOP=2,r.LINE_STRIP=3,r.TRIANGLES=4,r.TRIANGLE_STRIP=5,r.TRIANGLE_FAN=6,t.exports=r},function(t,e,r){"use strict";var i=r(48),n=function(t){this._initialBufferArray=void 0,this._bufferArray=void 0,t&&(this.setBufferArray(t),this.setInitialBufferArray(t))},a={setInitialBufferArray:function(t){this._initialBufferArray=t},getInitialBufferArray:function(){return this._initialBufferArray},setBufferArray:function(t){this._bufferArray=t.getBufferArray?t.getBufferArray():t},getBufferArray:function(){return this._bufferArray}},s=function(t){return function(){return t.apply(this._bufferArray,arguments)}};for(var o in i.prototype)a[o]=s(i.prototype[o]);n.prototype=a,t.exports=n},function(t,e,r){"use strict";var i=r(7),n=r(13),a=r(43),s=r(8),o=function(t){var e;return t instanceof i.Float32Array&&(e=5126),t instanceof i.Uint32Array&&(e=5125),t instanceof i.Uint16Array&&(e=5123),t instanceof i.Uint8Array&&(e=5121),e},h=function(t,e,r,s){if(a.call(this),this._instanceID=n.getInstanceID(),this.dirty(),this._itemSize=r,this._target="string"==typeof t?h[t]:t,this._type=void 0,this._normalize=!1,void 0!==e){var o=e;s||(o=this._target===h.ELEMENT_ARRAY_BUFFER?e instanceof i.Uint16Array?e:new i.Uint16Array(e):e instanceof i.Float32Array?e:new i.Float32Array(e)),this.setElements(o)}this._usage=h.STATIC_DRAW};h.ELEMENT_ARRAY_BUFFER=34963,h.ARRAY_BUFFER=34962,h.STATIC_DRAW=35044,h.DYNAMIC_DRAW=35048,h.STREAM_DRAW=35040,h._sDeletedGLBufferArrayCache=new window.Map,h.deleteGLBufferArray=function(t,e){h._sDeletedGLBufferArrayCache.has(t)||h._sDeletedGLBufferArrayCache.set(t,[]),h._sDeletedGLBufferArrayCache.get(t).push(e)},h.flushDeletedGLBufferArrays=function(t,e){if(e<=0)return e;if(!h._sDeletedGLBufferArrayCache.has(t))return e;for(var r=0,i=s.instance().tick(),n=h._sDeletedGLBufferArrayCache.get(t),a=n.length,o=a-1;o>=0&&r<e;o--)t.deleteBuffer(n[o]),n.splice(o,1),r=s.instance().deltaS(i,s.instance().tick());return e-r},h.flushAllDeletedGLBufferArrays=function(t){if(h._sDeletedGLBufferArrayCache.has(t))for(var e=h._sDeletedGLBufferArrayCache.get(t),r=e.length,i=r-1;i>=0;i--)t.deleteBuffer(e[i]),e.splice(i,1)},h.onLostContext=function(t){if(h._sDeletedGLBufferArrayCache.has(t)){var e=h._sDeletedGLBufferArrayCache.get(t);e.length=0}},i.createPrototypeObject(h,i.objectInherit(a.prototype,{setUsage:function(t){this._usage=t},getUsage:function(){return this._usage},getInstanceID:function(){return this._instanceID},setItemSize:function(t){this._itemSize=t},isValid:function(){return void 0!==this._buffer||void 0!==this._elements},invalidate:function(){this._buffer=void 0,this.dirty()},releaseGLObjects:function(){void 0!==this._buffer&&null!==this._buffer&&void 0!==this._gl&&(h.deleteGLBufferArray(this._gl,this._buffer),a.removeObject(this._gl,this)),this.invalidate()},setNormalize:function(t){this._normalize=t},getNormalize:function(){return this._normalize},bind:function(t){this._gl||this.setGraphicContext(t);var e=this._target,r=this._buffer;return r?void t.bindBuffer(e,r):void(!r&&this._elements.length>0&&(this._buffer=t.createBuffer(),this._numItems=this._elements.length/this._itemSize,t.bindBuffer(e,this._buffer)))},getItemSize:function(){return this._itemSize},dirty:function(){this._dirty=!0},isDirty:function(){return this._dirty},compile:function(t){this._dirty&&(i.timeStamp("osgjs.metrics:bufferData"),t.bufferData(this._target,this._elements,this._usage),this._dirty=!1)},getElements:function(){return this._elements},setElements:function(t){this._elements=t,this._type=o(t),this._dirty=!0},getType:function(){return this._type}}),"osg","BufferArray"),t.exports=h},function(t,e,r){"use strict";var i=r(7),n=r(13),a=r(43),s=r(8),o=function(){a.call(this),this._instanceID=n.getInstanceID(),this._vaoObject=void 0,this.dirty()};o._sDeletedGLVertexArrayObjectCache=new window.Map,o.deleteGLVertexArrayObject=function(t,e){o._sDeletedGLVertexArrayObjectCache.has(t)||o._sDeletedGLVertexArrayObjectCache.set(t,[]),o._sDeletedGLVertexArrayObjectCache.get(t).push(e)},o.flushDeletedGLVertexArrayObjects=function(t,e){if(e<=0)return e;if(!o._sDeletedGLVertexArrayObjectCache.has(t))return e;for(var r=0,i=s.instance().tick(),n=o._sDeletedGLVertexArrayObjectCache.get(t),a=n.length,h=a-1;h>=0&&r<e;h--)t.deleteVertexArray(n[h]),n.splice(h,1),r=s.instance().deltaS(i,s.instance().tick());return e-r},o.flushAllDeletedGLVertexArrayObjects=function(t){if(o._sDeletedGLVertexArrayObjectCache.has(t))for(var e=o._sDeletedGLVertexArrayObjectCache.get(t),r=e.length,i=r-1;i>=0;i--)t.deleteVertexArray(e[i]),e.splice(i,1)},o.onLostContext=function(t){if(o._sDeletedGLVertexArrayObjectCache.has(t)){var e=o._sDeletedGLVertexArrayObjectCache.get(t);e.length=0}},i.createPrototypeObject(o,i.objectInherit(a.prototype,{getInstanceID:function(){return this._instanceID},invalidate:function(){this._vaoObject=void 0,this.dirty()},releaseGLObjects:function(){void 0!==this._vaoObject&&void 0!==this._gl&&(o.deleteGLVertexArrayObject(this._gl,this._vaoObject),a.removeObject(this._gl,this)),this.invalidate()},create:function(t){this._vaoObject=t.createVertexArray(),this._dirty=!1},bind:function(t){this._gl||this.setGraphicContext(t);var e=this._vaoObject;e&&t.bindVertexArray(this._vaoObject)},dirty:function(){this._dirty=!0},isDirty:function(){return this._dirty}}),"osg","VertexArrayObject"),t.exports=o},function(t,e){"use strict";var r=function(){this._pool=[],this._length=0};r.prototype={clean:function(){this._length=0,this._pool.length=0},reset:function(){this._length=0},getLength:function(){return this._length},getArray:function(){return this._pool},back:function(){return this._pool[this._length-1]},pop:function(){return this._length--,this._pool[this._length]},push:function(t){this._length===this._pool.length?this._pool.push(t):this._pool[this._length]=t,this._length++},forEach:function(t){for(var e=0;e<this._length;e++)t(this._pool[e])}},t.exports=r},function(t,e,r){"use strict";var i=r(7),n=r(30),a=function(){n.call(this),this._attributeEnable=!1};i.createPrototypeStateAttribute(a,i.objectInherit(n.prototype,{attributeType:"Billboard",cloneType:function(){return new a},setEnabled:function(t){this._attributeEnable=t},isEnabled:function(){return this._attributeEnable},apply:function(){}}),"osg","Billboard"),t.exports=a},function(t,e,r){"use strict";var i=r(7),n=r(30),a=r(15).vec4,s=function(t){n.call(this),this._constantColor=a.create(),a.set(this._constantColor,1,1,1,1),void 0!==t&&this.setConstantColor(t)};i.createPrototypeStateAttribute(s,i.objectInherit(n.prototype,{attributeType:"BlendColor",cloneType:function(){return new s},setConstantColor:function(t){a.copy(this._constantColor,t)},getConstantColor:function(){return this._constantColor},apply:function(t){var e=t.getGraphicContext();e.blendColor(this._constantColor[0],this._constantColor[1],this._constantColor[2],this._constantColor[3])}}),"osg","BlendColor"),t.exports=s},function(t,e,r){"use strict";var i=r(7),n=r(30),a=function(t,e,r,i){n.call(this),this._sourceFactor=a.DISABLE,this._destinationFactor=a.DISABLE,this._sourceFactorAlpha=this._sourceFactor,this._destinationFactorAlpha=this._destinationFactor,this._separate=!1,void 0!==t&&this.setSource(t),void 0!==e&&this.setDestination(e),void 0!==r&&this.setSourceAlpha(r),void 0!==i&&this.setDestinationAlpha(i)};a.DISABLE=-1,a.ZERO=0,a.ONE=1,a.SRC_COLOR=768,a.ONE_MINUS_SRC_COLOR=769,a.SRC_ALPHA=770,a.ONE_MINUS_SRC_ALPHA=771,a.DST_ALPHA=772,a.ONE_MINUS_DST_ALPHA=773,a.DST_COLOR=774,a.ONE_MINUS_DST_COLOR=775,a.SRC_ALPHA_SATURATE=776,a.BLEND_DST_RGB=32968,a.BLEND_SRC_RGB=32969,a.BLEND_DST_ALPHA=32970,a.BLEND_SRC_ALPHA=32971,a.CONSTANT_COLOR=32769,a.ONE_MINUS_CONSTANT_COLOR=32770,a.CONSTANT_ALPHA=32771,a.ONE_MINUS_CONSTANT_ALPHA=32772,a.BLEND_COLOR=32773,i.createPrototypeStateAttribute(a,i.objectInherit(n.prototype,{attributeType:"BlendFunc",cloneType:function(){return new a},setSource:function(t){this.setSourceRGB(t),this.setSourceAlpha(t)},getSource:function(){return this._sourceFactor},setDestination:function(t){this.setDestinationRGB(t),this.setDestinationAlpha(t)},getDestination:function(){return this._destinationFactor},getSeparate:function(){return this._separate},checkSeparate:function(){return this._sourceFactor!==this._sourceFactorAlpha||this._destinationFactor!==this._destinationFactorAlpha},setSourceRGB:function(t){"string"==typeof t?this._sourceFactor=a[t]:this._sourceFactor=t,this._separate=this.checkSeparate()},getSourceRGB:function(){return this._sourceFactor},setSourceAlpha:function(t){"string"==typeof t?this._sourceFactorAlpha=a[t]:this._sourceFactorAlpha=t,this._separate=this.checkSeparate()},getSourceAlpha:function(){return this._sourceFactorAlpha},setDestinationRGB:function(t){"string"==typeof t?this._destinationFactor=a[t]:this._destinationFactor=t,this._separate=this.checkSeparate()},getDestinationRGB:function(){return this._destinationFactor},setDestinationAlpha:function(t){"string"==typeof t?this._destinationFactorAlpha=a[t]:this._destinationFactorAlpha=t,this._separate=this.checkSeparate()},getDestinationAlpha:function(){return this._destinationFactorAlpha},apply:function(t){var e=t.getGraphicContext();this._sourceFactor===a.DISABLE||this._destinationFactor===a.DISABLE?e.disable(e.BLEND):(e.enable(e.BLEND),this._separate?e.blendFuncSeparate(this._sourceFactor,this._destinationFactor,this._sourceFactorAlpha,this._destinationFactorAlpha):e.blendFunc(this._sourceFactor,this._destinationFactor))}}),"osg","BlendFunc"),t.exports=a},function(t,e,r){"use strict";var i=r(7),n=r(11),a=r(55),s=r(15).mat4,o=r(40),h=r(34),u=r(15).vec4,c=function(){n.call(this),a.call(this),this.viewport=void 0,this._graphicContext=void 0,this.setClearColor(u.fromValues(0,0,0,1)),this.setClearDepth(1),this.setClearMask(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT),this.setViewMatrix(s.create()),this.setProjectionMatrix(s.create()),this.renderOrder=c.NESTED_RENDER,this.renderOrderNum=0,this._view=void 0,this._renderer=void 0,this._attachments={}};c.PRE_RENDER=0,c.NESTED_RENDER=1,c.POST_RENDER=2,c.COLOR_BUFFER_BIT=16384,c.DEPTH_BUFFER_BIT=256,c.STENCIL_BUFFER_BIT=1024,i.createPrototypeNode(c,i.objectInherit(a.prototype,i.objectInherit(n.prototype,{getView:function(){return this._view},setView:function(t){this._view=t},getRenderer:function(){return this._renderer},setRenderer:function(t){this._renderer=t},setFinalDrawCallback:function(t){this._finalDrawCallback=t},getFinalDrawCallback:function(){return this._finalDrawCallback},setInitialDrawCallback:function(t){this._initialDrawCallback=t},getInitialDrawCallback:function(){return this._initialDrawCallback},getAttachments:function(){return this._attachments},setGraphicContext:function(t){this._graphicContext=t},getGraphicContext:function(){return this._graphicContext},setClearDepth:function(t){this.clearDepth=t},getClearDepth:function(){return this.clearDepth},setClearMask:function(t){this.clearMask=t},getClearMask:function(){return this.clearMask},setClearColor:function(t){this.clearColor=t},getClearColor:function(){return this.clearColor},setViewport:function(t){this.viewport=t,this.getOrCreateStateSet().setAttributeAndModes(t)},getViewport:function(){return this.viewport},setViewMatrix:function(t){this.modelviewMatrix=t},setViewMatrixAsLookAt:function(t,e,r){s.lookAt(this.getViewMatrix(),t,e,r)},setProjectionMatrix:function(t){this.projectionMatrix=t},setProjectionMatrixAsOrtho:function(t,e,r,i,n,a){s.ortho(this.getProjectionMatrix(),t,e,r,i,n,a)},isRenderToTextureCamera:function(){return window.Object.keys(this._attachments).length>0},getViewMatrix:function(){return this.modelviewMatrix},getProjectionMatrix:function(){return this.projectionMatrix},getRenderOrder:function(){return this.renderOrder},setRenderOrder:function(t,e){this.renderOrder=t,this.renderOrderNum=e},getFrameBufferObject:function(){return this.frameBufferObject},setFrameBufferObject:function(t){this.frameBufferObject=t},detachAll:function(){this._attachments={},this.frameBufferObject&&this.frameBufferObject.dirty()},resetAttachments:function(){this.frameBufferObject&&(this.frameBufferObject.reset(),this.frameBufferObject=0),this._attachments={}},attachTexture:function(t,e,r){this.frameBufferObject&&this.frameBufferObject.dirty(),r||(r=o.TEXTURE_2D),this._attachments[t]={attachment:t,texture:e,textureTarget:r}},attachRenderBuffer:function(t,e){this.frameBufferObject&&this.frameBufferObject.dirty(),this._attachments[t]={format:e,attachment:t}},computeLocalToWorldMatrix:function(t){return this.referenceFrame===h.RELATIVE_RF?s.mul(t,t,this.modelviewMatrix):s.copy(t,this.modelviewMatrix),!0},computeWorldToLocalMatrix:function(){var t=s.create();return function(e){return s.invert(t,this.modelviewMatrix),this.referenceFrame===h.RELATIVE_RF?s.mul(e,t,e):s.copy(e,t),!0}}()})),"osg","Camera"),t.exports=c},function(t,e){"use strict";var r=function(){r.prototype.reset.call(this)};r.prototype={reset:function(){this._computeNearFar=!0,this._nearFarRatio=.005,this.bbCornerFar=3,this.bbCornerNear=4,this._enableFrustumCulling=!1,this._settingsSourceOverrider=this,this._LODScale=1,this._clampProjectionMatrixCallback=void 0},setCullSettings:function(t){this._computeNearFar=t._computeNearFar,this._nearFarRatio=t._nearFarRatio,this._enableFrustumCulling=t._enableFrustumCulling,this._settingsSourceOverrider=t._settingsSourceOverrider,this._clampProjectionMatrixCallback=t._clampProjectionMatrixCallback},setNearFarRatio:function(t){this._nearFarRatio=t},getNearFarRatio:function(){return this._nearFarRatio},setComputeNearFar:function(t){this._computeNearFar=t},getComputeNearFar:function(){return this._computeNearFar},setEnableFrustumCulling:function(t){this._enableFrustumCulling=t},getEnableFrustumCulling:function(){return this._enableFrustumCulling},getSettingSourceOverrider:function(){return this._settingsSourceOverrider},setClampProjectionMatrixCallback:function(t){this._clampProjectionMatrixCallback=t},getClampProjectionMatrixCallback:function(){return this._clampProjectionMatrixCallback},setLODScale:function(t){this._LODScale=t},getLODScale:function(){return this._LODScale}},t.exports=r},function(t,e,r){"use strict";var i=r(7),n=r(30),a=function(t,e,r,i){n.call(this),this._colorMask=[!0,!0,!0,!0],this.setMask(t,e,r,i)};i.createPrototypeStateAttribute(a,i.objectInherit(n.prototype,{attributeType:"ColorMask",cloneType:function(){return new a},setMask:function(t,e,r,i){void 0!==t&&void 0!==e&&void 0!==r&&void 0!==i&&(this._colorMask[0]=t,this._colorMask[1]=e,this._colorMask[2]=r,this._colorMask[3]=i)},apply:function(t){var e=t.getGraphicContext(),r=this._colorMask;e.colorMask(r[0],r[1],r[2],r[3])}}),"osg","ColorMask"),t.exports=a},function(t,e,r){"use strict";var i=r(7),n=r(30),a=function(t){n.call(this),this.setMode(void 0!==t?t:a.BACK)};a.DISABLE=0,a.FRONT=1028,a.BACK=1029,a.FRONT_AND_BACK=1032,i.createPrototypeStateAttribute(a,i.objectInherit(n.prototype,{attributeType:"CullFace",cloneType:function(){return new a},setMode:function(t){var e=t;"string"==typeof e&&(e=a[e]),this._mode=e},getMode:function(){return this._mode},apply:function(t){var e=t.getGraphicContext();this._mode===a.DISABLE?e.disable(e.CULL_FACE):(e.enable(e.CULL_FACE),e.cullFace(this._mode))}}),"osg","CullFace"),t.exports=a},function(t,e,r){"use strict";var i=r(59),n=function(){this._mask=n.DEFAULT_CULLING,this._frustum=new i};n.prototype={reset:function(){this._mask=n.DEFAULT_CULLING,this._frustum.clear()},setCullingMask:function(t){this._mask=t},getCullingMask:function(){return this._mask},setFrustum:function(t){this._frustum=t},getFrustum:function(){return this._frustum},getCurrentResultMask:function(){return this._frustum.getCurrentMask()},pushCurrentMask:function(){this._frustum.pushCurrentMask()},popCurrentMask:function(){this._frustum.popCurrentMask()},resetCullingMask:function(){this._frustum.setResultMask(this._frustum.getCurrentMask())},isBoundingBoxCulled:function(t){return!(!(this._mask&n.VIEW_FRUSTUM_CULLING)||this._frustum.containsBoundingBox(t))},isBoundingSphereCulled:function(t){return!(!(this._mask&n.VIEW_FRUSTUM_CULLING)||this._frustum.containsBoundingSphere(t))},isVerticesCulled:function(t){return!(!(this._mask&n.VIEW_FRUSTUM_CULLING)||this._frustum.containsVertices(t))}},n.NO_CULLING=0,n.VIEW_FRUSTUM_LEFT_CULLING=1,n.VIEW_FRUSTUM_RIGHT_CULLING=2,n.VIEW_FRUSTUM_TOP_CULLING=3,n.VIEW_FRUSTUM_BOTTOM_CULLING=4,n.NEAR_PLANE_CULLING=5,n.FAR_PLANE_CULLING=6,n.VIEW_FRUSTUM_SIDES_CULLING=n.VIEW_FRUSTUM_LEFT_CULLING|n.VIEW_FRUSTUM_RIGHT_CULLING|n.VIEW_FRUSTUM_BOTTOM_CULLING|n.VIEW_FRUSTUM_TOP_CULLING,n.VIEW_FRUSTUM_CULLING=n.VIEW_FRUSTUM_SIDES_CULLING|n.NEAR_PLANE_CULLING|n.FAR_PLANE_CULLING,n.DEFAULT_CULLING=n.VIEW_FRUSTUM_SIDES_CULLING,n.ENABLE_ALL_CULLING=n.VIEW_FRUSTUM_CULLING,t.exports=n},function(t,e,r){"use strict";var i=r(13),n=r(60),a=r(7),s=r(15).vec4,o=r(50),h=function(){this._clippingMask=0,this._planeList=[n.create(),n.create(),n.create(),n.create(),n.create(),n.create()],this._vertexList=[],this._maskStack=new o,this._resultMask=0,this._maskStack.push(this._resultMask)};a.createPrototypeObject(h,a.objectInherit(i.prototype,{getPlanes:function(){return this._planeList},setPlanes:function(t){
this._planeList=t,this.setupMask()},clear:function(){if(this._clippingMask=0,this._planeList)for(var t=0,e=this._planeList.length;t<e;++t)n.init(this._planeList[t]);this._vertexList=[],this.setupMask()},setToUnitFrustum:function(t,e){void 0===t&&(t=!0),void 0===e&&(e=!0),this._planeList.length=0,this._planeList.push(s.set(n.create(),1,0,0,1)),this._planeList.push(s.set(n.create(),-1,0,0,1)),this._planeList.push(s.set(n.create(),0,1,0,1)),this._planeList.push(s.set(n.create(),0,-1,0,1)),t&&this._planeList.push(s.set(n.create(),0,0,1,1)),e&&this._planeList.push(s.set(n.create(),0,0,-1,1)),this.setupMask()},setToBoundingBox:function(t){this._planeList.length=0,this._planeList.push(s.set(n.create(),1,0,0,-t.getMin()[0])),this._planeList.push(s.set(n.create(),-1,0,0,t.getMax()[0])),this._planeList.push(s.set(n.create(),0,1,0,-t.getMin()[1])),this._planeList.push(s.set(n.create(),0,-1,0,t.getMax()[1])),this._planeList.push(s.set(n.create(),0,0,1,-t.getMin()[2])),this._planeList.push(s.set(n.create(),0,0,-1,t.getMax()[2])),this.setupMask()},setAndTransformProvidingInverse:function(t,e){this._referenceVertexList=t._referenceVertexList;var r=this._maskStack.getLength()-1,i=t._maskStack[r];if(0===i)return this._maskStack.getArray()[r]=0,this._resultMask=0,void(this._planeList.length=0);var a,s=1,o=0;for(a=0;a!==t._planeList.length;++a)i&s&&++o,s<<=1;this._planeList.length=o,this._resultMask=0,s=1;var h=0;for(a=0;a!==t._planeList.length;++a)i&s&&(this._planeList[h]=t._planeList[a],n.transformProvidingInverse(this._planeList[h++],e),this._resultMask=this._resultMask<<1|1),s<<=1;this._maskStack.getArray()[r]=this._resultMask},voidset:function(t){this._planeList=t,this.setupMask()},add:function(t){this._planeList.push(t),this.setupMask()},empty:function(){return 0===this._planeList.length},setReferenceVertexList:function(t){this._referenceVertexList=t},getReferenceVertexList:function(){return this._referenceVertexList},setupMask:function(t){this._resultMask=0;for(var e=void 0!==t?t:this._planeList.length,r=0;r<e;++r)this._resultMask=this._resultMask<<1|1;this._maskStack.reset(),this._maskStack.push(this._resultMask)},getCurrentMask:function(){return this._maskStack.back()},setResultMask:function(t){this._resultMask=t},getResultMask:function(){return this._resultMask},getMaskStack:function(){return this._maskStack},pushCurrentMask:function(){this._maskStack.push(this._resultMask)},popCurrentMask:function(){return this._maskStack.pop()},containsVertex:function(t){var e=this._maskStack.back();if(!e)return!0;for(var r=1,i=0;i<this._planeList.length;++i){if(e&r&&n.distanceToPlane(this._planeList[i],t)<0)return!1;r<<=1}return!0},containsVertices:function(t){var e=this._maskStack.back();if(!e)return!0;this._resultMask=e;for(var r=0;r<t.length;++r){for(var i=t[r],a=!1,s=1,o=0;!a&&o<this._planeList.length;++o)e&s&&n.distanceToPlane(this._planeList[o],i)<0&&(a=!0),s<<=1;if(!a)return!0}return!1},containsBoundingSphere:function(t){var e=this._maskStack.back();if(!e||!t.valid())return!0;this._resultMask=e;for(var r=1,i=0;i<this._planeList.length;++i){if(this._resultMask&r){var a=n.intersectsOrContainsBoundingSphere(this._planeList[i],t);if(n.OUTSIDE===a)return!1;n.INSIDE===a&&(this._resultMask^=r)}r<<=1}return!0},containsBoundingBox:function(t){var e=this._maskStack.back();if(!e)return!0;this._resultMask=e;for(var r=1,i=0;i<this._planeList.length;++i){if(this._resultMask&r){var a=n.intersectsOrContainsBoundingBox(this._planeList[i],t);if(n.OUTSIDE===a)return!1;n.INSIDE===a&&(this._resultMask^=r)}r<<=1}return!0},containsAllOfVertices:function(t){var e=this._maskStack.back();if(!e)return!1;this._resultMask=e;for(var r=1,i=0;i<this._planeList.length;++i){if(this._resultMask&r){var a=n.intersectsOrContainsVertices(this._planeList[i],t);if(a<1)return!1;this._resultMask^=r}r<<=1}return!0},containsAllOfBoundingSphere:function(t){var e=this._maskStack.back();if(!e)return!1;this._resultMask=e;for(var r=1,i=0;i<this._planeList.length;++i){if(this._resultMask&r){var a=n.intersectsOrContainsBoundingSphere(this._planeList[i],t);if(a<1)return!1;this._resultMask^=r}r<<=1}return!0},containsAllOfBoundingBox:function(t){var e=this._maskStack.back();if(!e)return!1;this._resultMask=e;for(var r=1,i=0;i<this._planeList.length;++i){if(this._resultMask&r){var a=n.intersectsOrContainsBoundingBox(this._planeList[i],t);if(a<1)return!1;this._resultMask^=r}r<<=1}return!0},transformProvidingInverse:function(t){var e=this._maskStack.back();if(e){this._resultMask=e;for(var r=1,i=0;i<this._planeList.length;++i)e&r&&n.transformProvidingInverse(this._planeList[i],t),r<<=1}}}),"osg","Polytope"),t.exports=h},function(t,e,r){"use strict";var i=r(7),n=r(15).vec4,a=r(15).vec3,s=i.objectInherit(n,{INSIDE:1,INTERSECT:2,OUTSIDE:3,transformProvidingInverse:function(){var t=s.create();return function(e,r){var i=e[0],n=e[1],a=e[2],o=e[3];return t[0]=r[0]*i+r[1]*n+r[2]*a+r[3]*o,t[1]=r[4]*i+r[5]*n+r[6]*a+r[7]*o,t[2]=r[8]*i+r[9]*n+r[10]*a+r[11]*o,t[3]=r[12]*i+r[13]*n+r[14]*a+r[15]*o,s.normalizeEquation(t),s.copy(t,e),e}},normalizeEquation:function(t){var e=1/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]*=e,t[1]*=e,t[2]*=e,t[3]*=e},getNormal:function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},setNormal:function(t,e){t[0]=e[0],t[1]=e[1],t[2]=e[2]},getDistance:function(t){return t[3]},setDistance:function(t,e){t[3]=e},distanceToPlane:function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]},intersectsOrContainsBoundingSphere:function(t,e){if(!e.valid())return s.OUTSIDE;var r=e.center(),i=e.radius(),n=this.distanceToPlane(t,r);return n<-i?s.OUTSIDE:n<=i?s.INTERSECT:s.INSIDE},instersectsBoundingSphere:function(t,e){return this.intersectsOrContainsBoundingSphere(t,e)===s.INTERSECT},intersectsOrContainsBoundingBox:function(){var t=a.create();return function(e,r){var i=(e[0]>=0?1:0)|(e[1]>=0?2:0)|(e[2]>=0?4:0),n=7&~i;return this.distanceToPlane(e,r.corner(n,t))>0?s.INSIDE:this.distanceToPlane(e,r.corner(i,t))<0?s.OUTSIDE:s.INTERSECT}}(),intersectsBoundingBox:function(t,e,r){return this.intersectsOrContainsBoundingBox(t,e,r)===s.INTERSECT},intersectOrContainsVertices:function(t,e){for(var r=-1,i=0;i<e.length;i++){var n=this.distanceToPlane(t,e[i]);if(n<0){if(1===r)return s.INTERSECT;r=2}else{if(!(n>0))return s.INTERSECT;if(2===r)return s.INTERSECT;r=1}}return r>0?s.INSIDE:s.OUTSIDE},intersectVertices:function(t,e){return this.intersectOrContainsVertices(t,e)===s.INTERSECT}});t.exports=s},function(t,e,r){"use strict";var i=r(7),n=r(28),a=r(54),s=r(33),o=r(55),h=r(58),u=r(15).mat4,c=r(60),l=r(11),d=r(34),_=r(15).vec3,f=r(50),g=r(32),p=r(62),m=function(){return new h},v=function(){this._modelViewMatrixStack=new f,this._projectionMatrixStack=new f,this._viewportStack=new f,this._cullingSetStack=new f,this._frustumVolume=-1,this._bbCornerFar=0,this._bbCornerNear=0,this._pooledMatrix=new g(u.create),this._pooledCullingSet=new g(m),this._cameraIndexStack=new f,this._cameraModelViewIndexStack=new f,this._cameraMatrixInverse=new p,this._cameraMatrixInverseRoot=void 0};i.createPrototypeObject(v,i.objectInherit(o.prototype,{reset:function(){this._modelViewMatrixStack.reset(),this._projectionMatrixStack.reset(),this._cullingSetStack.reset(),this._pooledMatrix.reset(),this._pooledCullingSet.reset(),this._cameraModelViewIndexStack.reset(),this._cameraIndexStack.reset(),this._cameraMatrixInverse.reset(),this._cameraMatrixInverseRoot=void 0},getProjectionMatrixStack:function(){return this._projectionMatrixStack},getCurrentProjectionMatrix:function(){return this._projectionMatrixStack.back()},getCurrentModelViewMatrix:function(){return this._modelViewMatrixStack.back()},getCameraInverseMatrix:function(){if(!this._cameraIndexStack.getLength())return this._cameraMatrixInverseRoot;var t=this._cameraIndexStack.back(),e=this.getNodePath()[t],r=e.getInstanceID(),i=this._cameraMatrixInverse.getMap(),n=i[r];if(void 0===n){var a=this._cameraModelViewIndexStack.back(),s=this._modelViewMatrixStack.getArray()[a];n=this._pooledMatrix.getOrCreateObject(),u.invert(n,s),this._cameraMatrixInverse.set(r,n)}return n},getCurrentModelMatrix:function(){var t=this.getCameraInverseMatrix(),e=this._pooledMatrix.getOrCreateObject(),r=u.mul(e,t,this.getCurrentModelViewMatrix());return r},getCurrentViewMatrix:function(){var t=this._modelViewMatrixStack.getArray();return this._cameraIndexStack.getLength()?t[this._cameraModelViewIndexStack.back()]:t[0]},getViewport:function(){if(0!==this._viewportStack.getLength())return this._viewportStack.back()},getLookVectorLocal:function(t){var e=this.getCurrentModelViewMatrix();return _.set(t,-e[2],-e[6],-e[10])},pushViewport:function(t){this._viewportStack.push(t)},popViewport:function(){this._viewportStack.pop()},getFrustumPlanes:function(){var t=u.create();return function(e,r,i,n){u.mul(t,r,i);var a=!!n,s=e[0];s[0]=t[3]-t[0],s[1]=t[7]-t[4],s[2]=t[11]-t[8],s[3]=t[15]-t[12];var o=e[1];o[0]=t[3]+t[0],o[1]=t[7]+t[4],o[2]=t[11]+t[8],o[3]=t[15]+t[12];var h=e[2];h[0]=t[3]+t[1],h[1]=t[7]+t[5],h[2]=t[11]+t[9],h[3]=t[15]+t[13];var l=e[3];if(l[0]=t[3]-t[1],l[1]=t[7]-t[5],l[2]=t[11]-t[9],l[3]=t[15]-t[13],a){var d=e[4];d[0]=t[3]-t[2],d[1]=t[7]-t[6],d[2]=t[11]-t[10],d[3]=t[15]-t[14];var _=e[5];_[0]=t[3]+t[2],_[1]=t[7]+t[6],_[2]=t[11]+t[10],_[3]=t[15]+t[14]}for(var f=n?6:4,g=0;g<f;g++)c.normalizeEquation(e[g])}}(),pushCullingSet:function(){var t=this._pooledCullingSet.getOrCreateObject();this._enableFrustumCulling&&(u.getFrustumPlanes(t.getFrustum().getPlanes(),this.getCurrentProjectionMatrix(),this.getCurrentModelViewMatrix(),!1),t.getFrustum().setupMask(4)),this._cullingSetStack.push(t)},popCullingSet:function(){return this._cullingSetStack.pop()},getCurrentCullingSet:function(){return this._cullingSetStack.back()},pushCurrentMask:function(){var t=this.getCurrentCullingSet();t&&t.pushCurrentMask()},popCurrentMask:function(){var t=this.getCurrentCullingSet();t&&t.popCurrentMask()},isVerticesCulled:function(t){return!!this._enableFrustumCulling&&this.getCurrentCullingSet().isVerticesCulled(t)},isBoundingBoxCulled:function(t){return!!this._enableFrustumCulling&&(t.valid()&&this.getCurrentCullingSet().isBoundingBoxCulled(t))},isBoundingSphereCulled:function(t){return!!this._enableFrustumCulling&&(t.valid()&&this.getCurrentCullingSet().isBoundingSphereCulled(t))},isCulled:function(){var t=new n;return function(e,r){if(!this._enableFrustumCulling)return!1;if(e.isCullingActive()){if(0===this.getCurrentCullingSet().getCurrentResultMask())return!1;var i=this._pooledMatrix.getOrCreateObject();u.identity(i);var n=r.length;return e instanceof l&&n--,s.computeLocalToWorld(r,!0,i,n),e.getBound().transformMat4(t,i),this.getCurrentCullingSet().isBoundingSphereCulled(t)}return this.getCurrentCullingSet().resetCullingMask(),!1}}(),pushModelViewMatrix:function(){var t=_.create();return function(e){var r=this.getNodePath(),i=r.length;if(i){var n=i-1;r[n].getTypeID()===a.getTypeID()&&r[n].getReferenceFrame()===d.ABSOLUTE_RF&&(this._cameraIndexStack.push(n),this._cameraModelViewIndexStack.push(this._modelViewMatrixStack.getLength()))}else{var s=this._pooledMatrix.getOrCreateObject();u.invert(s,e),this._cameraMatrixInverseRoot=s}this._modelViewMatrixStack.push(e),this.getLookVectorLocal(t),this._bbCornerFar=(t[0]>=0?1:0)|(t[1]>=0?2:0)|(t[2]>=0?4:0),this._bbCornerNear=7&~this._bbCornerFar}}(),popModelViewMatrix:function(){var t=_.create();return function(){var e=this.getNodePath(),r=e.length-1;this._cameraIndexStack.getLength()&&r===this._cameraIndexStack.back()&&(this._cameraIndexStack.pop(),this._cameraModelViewIndexStack.pop()),this._modelViewMatrixStack.pop(),this._modelViewMatrixStack.getLength()?this.getLookVectorLocal(t):_.set(t,0,0,-1),this._bbCornerFar=(t[0]>=0?1:0)|(t[1]>=0?2:0)|(t[2]>=0?4:0),this._bbCornerNear=7&~this._bbCornerFar}}(),pushProjectionMatrix:function(t){this._projectionMatrixStack.push(t),this._frustumVolume=-1,this.pushCullingSet()},popProjectionMatrix:function(){this._projectionMatrixStack.pop(),this._frustumVolume=-1,this.popCullingSet()}}),"osg","CullStack"),t.exports=v},function(t,e,r){"use strict";var i=r(50),n=function(){this._keys=new i,this._map={}};n.prototype={reset:function(){for(var t=this._keys.getArray(),e=this._keys.getLength(),r=0;r<e;r++){var i=t[r];this._map[i]=void 0}this._keys.reset()},set:function(t,e){this._keys.push(t),this._map[t]=e},hasKey:function(t){return void 0!==this._map[t]},getMap:function(){return this._map},getKeys:function(){return this._keys},forEach:function(t){for(var e=this._keys.getArray(),r=this._keys.getLength(),i=0;i<r;i++){var n=e[i];t(n,this._map[n])}}},t.exports=n},function(t,e,r){"use strict";var i=r(9),n=r(7),a=r(16),s=r(31),o=r(55),h=r(61),u=r(15).mat4,c=r(64),l=r(6),d=r(65),_=r(66),f=r(10),g=r(36),p=r(67),m=r(69),v=r(70),S=r(12),x=r(72),b=r(73),y=r(74),M=r(54),T=r(34),A=r(15).vec3,C=r(75),I=r(81),w=r(77),E=r(82),N=r(50),R=r(32),F=function(){return new p},P=function(){return new o},L=function(){s.call(this,s.TRAVERSE_ACTIVE_CHILDREN),o.call(this),h.call(this),this._rootStateGraph=void 0,this._currentStateGraph=void 0,this._currentRenderBin=void 0,this._currentRenderStage=void 0,this._rootRenderStage=void 0,this._computedNear=Number.POSITIVE_INFINITY,this._computedFar=Number.NEGATIVE_INFINITY;var t=A.fromValues(0,0,-1);this._camera=void 0,this._bbCornerFar=(t[0]>=0?1:0)|(t[1]>=0?2:0)|(t[2]>=0?4:0),this._bbCornerNear=7&~this._bbCornerFar,this._pooledLeaf=new R(F),this._pooledRenderStages={},this._pooledCullSettings=new R(P),this._renderBinStack=new N,this.visitorType=s.CULL_VISITOR,this._identityMatrix=u.create(),this._renderer=void 0,this._renderStageType=v,this._numCamera=0,this._numMatrixTransform=0,this._numProjection=0,this._numNode=0,this._numLightSource=0,this._numGeometry=0};L.registerApplyFunction=f.registerApplyFunction,L.getApplyFunction=f.getApplyFunction,n.createPrototypeObject(L,n.objectInherit(h.prototype,n.objectInherit(s.prototype,{applyFunctionArray:f.applyFunctionArray,distance:function(t,e){return-(t[0]*e[2]+t[1]*e[6]+t[2]*e[10]+e[14])},getComputedNear:function(){return this._computedNear},getComputedFar:function(){return this._computedFar},resetStats:function(){this._numCamera=0,this._numMatrixTransform=0,this._numProjection=0,this._numNode=0,this._numLightSource=0,this._numGeometry=0},handleCullCallbacksAndTraverse:function(t){var e=t.getCullCallback();e&&!e.cull(t,this)||this.traverse(t)},getCurrentCamera:function(){return this._currentRenderBin.getStage().getCamera()},updateCalculatedNearFar:function(){var t=A.create(),e=A.create();return function(r,i){var n,a,s=i.getBoundingBox();if(n=this.distance(s.corner(this._bbCornerNear,t),r),a=this.distance(s.corner(this._bbCornerFar,e),r),n>a){var o=n;n=a,a=o}return!(a<0)&&(n<this._computedNear&&(this._computedNear=n),a>this._computedFar&&(this._computedFar=a),!0)}}(),setStateGraph:function(t){this._rootStateGraph=t,this._currentStateGraph=t},setRenderStage:function(t){this._rootRenderStage=t,this._currentRenderBin=t},setRenderer:function(t){this._renderer=t},getRenderer:function(){return this._renderer},reset:function(){h.prototype.reset.call(this),this._pooledLeaf.reset(),this._pooledCullSettings.reset();for(var t in this._pooledRenderStages)this._pooledRenderStages[t].reset();m.reset(),this._computedNear=Number.POSITIVE_INFINITY,this._computedFar=Number.NEGATIVE_INFINITY},getCurrentRenderBin:function(){return this._currentRenderBin},setCurrentRenderBin:function(t){this._currentRenderBin=t},addPositionedAttribute:function(t,e){var r=t?t:this._identityMatrix;this._currentRenderBin.getStage().addPositionAttribute(r,e)},pushStateSet:function(t){if(this._currentStateGraph=this._currentStateGraph.findOrInsert(t),void 0!==t.getBinName()){var e=this._renderBinStack,r=this._currentRenderBin;e.push(r),this._currentRenderBin=r.getStage().findOrInsert(t.getBinNumber(),t.getBinName())}},popStateSet:function(){var t=this._currentStateGraph,e=t.getStateSet();if(this._currentStateGraph=t.getParent(),void 0!==e.getBinName()){var r=this._renderBinStack;0===r.getLength()?this._currentRenderBin=this._currentRenderBin.getStage():this._currentRenderBin=r.pop()}},popProjectionMatrix:function(){if(this._computeNearFar===!0&&this._computedFar>=this._computedNear){var t=this.getCurrentProjectionMatrix();void 0!==this._clampProjectionMatrixCallback?this._clampProjectionMatrixCallback(t,this._computedNear,this._computedFar,this._nearFarRatio):this.clampProjectionMatrix(t,this._computedNear,this._computedFar,this._nearFarRatio)}h.prototype.popProjectionMatrix.call(this)},clampProjectionMatrix:function(t,e,r,n,a){var s=1e-6;if(r<e-s)return i.log("clampProjectionMatrix not applied, invalid depth range, znear = "+e+"  zfar = "+r,!1,!0),!1;var o,h;if(r<e+s){var u=.5*(e+r);e=u-s,r=u+s}if(Math.abs(t[3])<s&&Math.abs(t[7])<s&&Math.abs(t[11])<s){var c=.02*(r-e);c<1&&(c=1),o=e-c,h=r+c,e=o,r=h,t[10]=-2/(h-o),t[14]=-(h+o)/(h-o)}else{var l=1.02,d=.98;o=e*d,h=r*l;var _=r*n;o<_&&(o=_),e=o,r=h;var f=t[10],g=t[14],p=t[11],m=t[15],v=(-o*f+g)/(-o*p+m),S=(-h*f+g)/(-h*p+m),x=Math.abs(2/(v-S)),b=-(v+S)/2,y=b*x;t[2]=t[2]*x+t[3]*y,t[6]=t[6]*x+t[7]*y,t[10]=f*x+p*y,t[14]=g*x+m*y}return void 0!==a&&(a[0]=e,a[1]=r),!0},popCameraModelViewProjectionMatrix:function(){this.popModelViewMatrix(),this.popProjectionMatrix()},pushCameraModelViewProjectionMatrix:function(t,e,r){this.pushModelViewMatrix(e),this.pushProjectionMatrix(r)},apply:function(t){this.applyFunctionArray[t.nodeTypeID].call(this,t)},createOrReuseRenderLeaf:function(){return this._pooledLeaf.getOrCreateObject()},createOrReuseRenderStage:function(t){var e=t?t.className():"RenderStage";if(!this._pooledRenderStages[e]){var r=t?t.constructor:v,i=function(){return new r};this._pooledRenderStages[e]=new R(i)}return this._pooledRenderStages[e].getOrCreateObject().init()},postPushGeometry:function(t,e){var r,i;e instanceof I?(i=e.getStateSetAnimation(),i&&t.pushStateSet(i),r=e.getSourceGeometry(),r instanceof E&&(i=r.getStateSetAnimation(),i&&t.pushStateSet(i))):e instanceof E&&(i=e.getStateSetAnimation(),i&&t.pushStateSet(i))},prePopGeometry:function(t,e){if(e instanceof I){var r=e.getSourceGeometry();r instanceof E&&r.getStateSetAnimation()&&t.popStateSet(),e.getStateSetAnimation()&&t.popStateSet()}else e instanceof E&&e.getStateSetAnimation()&&t.popStateSet()},pushLeaf:function(t,e){var r=this._currentStateGraph.getLeafs();r.getLength()||this._currentRenderBin.addStateGraph(this._currentStateGraph);var i=this.createOrReuseRenderLeaf();i.init(this._currentStateGraph,t,this.getCurrentProjectionMatrix(),this.getCurrentViewMatrix(),this.getCurrentModelViewMatrix(),this.getCurrentModelMatrix(),e),r.push(i)}})),"osg","CullVisitor");var O=function(t){this._numCamera++;var e=t.getStateSet();e&&this.pushStateSet(e);var r=this._pooledMatrix.getOrCreateObject(),i=this._pooledMatrix.getOrCreateObject();if(t.getReferenceFrame()===T.RELATIVE_RF){var n=this.getCurrentProjectionMatrix();u.mul(i,n,t.getProjectionMatrix());var a=this.getCurrentModelViewMatrix();u.mul(r,a,t.getViewMatrix())}else u.copy(r,t.getViewMatrix()),u.copy(i,t.getProjectionMatrix());var s=this._computedNear,o=this._computedFar,h=this._pooledCullSettings.getOrCreateObject();if(h.reset(),h.setCullSettings(this),this._computedNear=Number.POSITIVE_INFINITY,this._computedFar=Number.NEGATIVE_INFINITY,this.setCullSettings(t),h.getSettingSourceOverrider()===this&&h.getEnableFrustumCulling()&&this.setEnableFrustumCulling(!0),this.pushCameraModelViewProjectionMatrix(t,r,i),t.getViewport()&&this.pushViewport(t.getViewport()),t.getRenderOrder()===M.NESTED_RENDER)this.handleCullCallbacksAndTraverse(t);else{var c=this.getCurrentRenderBin(),l=c.getStage(),d=this.createOrReuseRenderStage(this._rootRenderStage);d.setCamera(t),d.setClearDepth(t.getClearDepth()),d.setClearColor(t.getClearColor()),d.setClearMask(t.getClearMask());var _;_=void 0===t.getViewport()?l.getViewport():t.getViewport(),d.setViewport(_),this.setCurrentRenderBin(d),this.handleCullCallbacksAndTraverse(t),this.setCurrentRenderBin(c),t.getRenderOrder()===M.PRE_RENDER?this.getCurrentRenderBin().getStage().addPreRenderStage(d,t.renderOrderNum):this.getCurrentRenderBin().getStage().addPostRenderStage(d,t.renderOrderNum)}this.popCameraModelViewProjectionMatrix(t),t.getViewport()&&this.popViewport(),this.setCullSettings(h),this._computedNear=s,this._computedFar=o,e&&this.popStateSet()},D=function(t){if(this._numMatrixTransform++,!this.isCulled(t,this.nodePath)){this.pushCurrentMask();var e=this._pooledMatrix.getOrCreateObject(),r=this.getCurrentModelViewMatrix();u.copy(e,r),t.computeLocalToWorldMatrix(e),this.pushModelViewMatrix(e);var i=t.getStateSet();i&&this.pushStateSet(i),this.handleCullCallbacksAndTraverse(t),i&&this.popStateSet(),this.popModelViewMatrix(),this.popCurrentMask()}},V=function(t){this._numProjection++;var e=this.getCurrentProjectionMatrix(),r=this._pooledMatrix.getOrCreateObject();u.mul(r,e,t.getProjectionMatrix()),this.pushProjectionMatrix(r);var i=t.getStateSet();i&&this.pushStateSet(i),this.handleCullCallbacksAndTraverse(t),i&&this.popStateSet(),this.popProjectionMatrix()},B=function(t){if(this._numNode++,!this.isCulled(t,this.nodePath)){this.pushCurrentMask();var e=t.getStateSet();e&&this.pushStateSet(e),this.handleCullCallbacksAndTraverse(t),e&&this.popStateSet(),this.popCurrentMask()}},k=function(t){this._numLightSource++;var e=t.getStateSet();e&&this.pushStateSet(e);var r=t.getLight();r&&(t.getReferenceFrame()===T.RELATIVE_RF?this.addPositionedAttribute(this.getCurrentModelViewMatrix(),r):this.addPositionedAttribute(null,r)),this.handleCullCallbacksAndTraverse(t),e&&this.popStateSet()},U=A.create(),G=!1,j=function(t){this._numGeometry++;var e=this.getCurrentModelViewMatrix(),r=t.getBoundingBox();if(!this._computeNearFar||!r.valid()||this.updateCalculatedNearFar(e,t)){var n=t.getCullCallback();if(!n||n.cull(t,this)){var s=t.getStateSet();s&&this.pushStateSet(s),this.postPushGeometry(this,t);var o=0;r.valid()&&(o=this.distance(r.center(U),e)),a.isNaN(o)?G||(i.warn("warning geometry has a NaN depth, "+e+" center "+U),G=!0):this.pushLeaf(t,o),this.prePopGeometry(this,t),s&&this.popStateSet()}}};f.registerApplyFunction(S.nodeTypeID,B),f.registerApplyFunction(b.nodeTypeID,B),f.registerApplyFunction(y.nodeTypeID,B),f.registerApplyFunction(M.nodeTypeID,O),f.registerApplyFunction(c.nodeTypeID,D),f.registerApplyFunction(d.nodeTypeID,V),f.registerApplyFunction(g.nodeTypeID,j),f.registerApplyFunction(C.nodeTypeID,D),f.registerApplyFunction(w.nodeTypeID,D),f.registerApplyFunction(l.nodeTypeID,D),f.registerApplyFunction(x.nodeTypeID,B),f.registerApplyFunction(_.nodeTypeID,k),f.registerApplyFunction(I.nodeTypeID,j),f.registerApplyFunction(E.nodeTypeID,j),t.exports=L},function(t,e,r){"use strict";var i=r(7),n=r(15).mat4,a=r(11),s=r(34),o=function(){a.call(this),this.matrix=n.create()};i.createPrototypeNode(o,i.objectInherit(a.prototype,{getMatrix:function(){return this.matrix},setMatrix:function(t){this.matrix=t,this.dirtyBound()},computeLocalToWorldMatrix:function(t){return this.referenceFrame===s.RELATIVE_RF?n.mul(t,t,this.matrix):n.copy(t,this.matrix),!0},computeWorldToLocalMatrix:function(){var t=n.create();return function(e){return n.invert(t,this.matrix),this.referenceFrame===s.RELATIVE_RF?n.mul(e,t,e):n.copy(e,t),!0}}()}),"osg","MatrixTransform"),t.exports=o},function(t,e,r){"use strict";var i=r(7),n=r(12),a=r(15).mat4,s=function(){n.call(this),this.projection=a.create()};i.createPrototypeNode(s,i.objectInherit(n.prototype,{getProjectionMatrix:function(){return this.projection},setProjectionMatrix:function(t){this.projection=t}}),"osg","Projection"),t.exports=s},function(t,e,r){"use strict";var i=r(7),n=r(12),a=r(34),s=r(15).vec3,o=function(){n.call(this),this.setCullingActive(!1),this._light=void 0,this._referenceFrame=a.RELATIVE_RF};i.createPrototypeNode(o,i.objectInherit(n.prototype,{getLight:function(){return this._light},setLight:function(t){this._light=t},setReferenceFrame:function(t){this._referenceFrame=t},getReferenceFrame:function(){return this._referenceFrame},computeBoundingSphere:function(){var t=s.create();return function(e){if(n.prototype.computeBoundingSphere.call(this,e),void 0!==this._light&&this._referenceFrame===a.RELATIVE_RF){var r=this._light.getPosition();0!==r[3]&&e.expandByvec3(s.scale(t,r,1/r[3]))}return e}}()}),"osg","LightSource"),t.exports=o},function(t,e,r){"use strict";var i=r(68),n=[function(t,e,r,i,n){t.applyModelViewMatrix(e,r),t.applyProjectionMatrix(n)},function(t,e,r,i,n){var a=t.getGraphicContext(),s=t.applyModelViewMatrix(e,r);if(t.applyProjectionMatrix(n),s){var o=t._modelMatrix;o.setMatrix4(r),o.apply(a,this.modelUniform)}},function(t,e,r,i,n){var a=t.getGraphicContext(),s=t.applyModelViewMatrix(e,r);if(t.applyProjectionMatrix(n),s){var o=t._viewMatrix;o.setMatrix4(i),o.apply(a,this.viewUniform)}},function(t,e,r,i,n){var a=t.getGraphicContext(),s=t.applyModelViewMatrix(e,r);if(t.applyProjectionMatrix(n),s){var o=t._modelMatrix;o.setMatrix4(r),o.apply(a,this.modelUniform);var h=t._viewMatrix;h.setMatrix4(i),h.apply(a,this.viewUniform)}}],a=function(t,e){this.modelUniform=e._uniformsCache[t._modelMatrix.getName()],this.viewUniform=e._uniformsCache[t._viewMatrix.getName()];var r=0;this.modelUniform&&(r=1),this.viewUniform&&(r|=2),this.apply=n[r]},s=function(){this._parent=void 0,this._geometry=void 0,this._depth=0,this._projection=void 0,this._view=void 0,this._model=void 0,this._modelView=void 0};s.prototype={reset:function(){this._parent=void 0,this._geometry=void 0,this._depth=0,this._projection=void 0,this._view=void 0,this._model=void 0,this._modelView=void 0},init:function(t,e,r,i,n,a,s){this._parent=t,this._geometry=e,this._depth=s,this._projection=r,this._view=i,this._model=a,this._modelView=n},drawGeometry:function(){return function(t){var e=t.getLastProgramApplied(),r=e.getInstanceID(),i=t.getCacheUniformsApplyRenderLeaf(),n=i[r];n||(n=new a(t,e),i[r]=n),n.apply(t,this._modelView,this._model,this._view,this._projection),this._geometry.drawImplementation(t)}}(),render:function(){var t=0,e=-1;return function(r,n){var a,s,o=this._parent,h=o._parent,u=o._stateset;void 0!==n?(a=n._parent,s=a._parent,s!==h?(i.moveStateGraph(r,s,h),r.applyStateSet(u)):o!==a?r.applyStateSet(u):r._stateSetStackChanged(t,e)&&r.applyStateSet(u)):(i.moveStateGraph(r,void 0,h),r.applyStateSet(u)),r._setStateSetsDrawID(++t),e=r.getStateSetStackSize(),this.drawGeometry(r)}}()},t.exports=s},function(t,e,r){"use strict";var i=r(7),n=r(50),a=r(62),s=r(32),o=function(){this._depth=0,this._children=new a,this._leafs=new n,this._stateset=void 0,this._parent=void 0},h=function(){return new o};o.pooledStateGraph=new s(h),o.statsNbMoveStateGraph=0,o.reset=function(){o.pooledStateGraph.reset(),o.statsNbMoveStateGraph=0},i.createPrototypeObject(o,{clean:function(){this._leafs.reset(),this._children.reset(),this._depth=0,this._stateset=void 0,this._parent=void 0},getStateSet:function(){return this._stateset},getLeafs:function(){return this._leafs},getParent:function(){return this._parent},findOrInsert:function(t){var e=t.getInstanceID(),r=this._children.getMap(),i=r[e];return i||(i=o.pooledStateGraph.getOrCreateObject(),i.clean(),i._parent=this,i._depth=this._depth+1,i._stateset=t,this._children.set(e,i)),i}},"osg","StateGraph"),o.moveStateGraph=function(){var t=new n,e=t.getArray();return function(r,i,n){o.statsNbMoveStateGraph++,t.reset();var a,s,h=n,u=i;if(h!==u&&void 0!==h)if(void 0!==u){if(u._parent===h._parent)return void 0!==u._stateset&&r.popStateSet(),void(void 0!==h._stateset&&r.pushStateSet(h._stateset));for(;u._depth>h._depth;)void 0!==u._stateset&&r.popStateSet(),u=u._parent;for(t.reset();h._depth>u._depth;)void 0!==h._stateset&&t.push(h._stateset),h=h._parent;for(;u!==h;)void 0!==u._stateset&&r.popStateSet(),u=u._parent,void 0!==h._stateset&&t.push(h._stateset),h=h._parent;for(a=t._length-1,s=0;a>=s;--a)r.pushStateSet(e[a])}else{do void 0!==h._stateset&&t.push(h._stateset),h=h._parent;while(h);for(a=t._length-1,s=0;a>=s;--a)r.pushStateSet(e[a])}}}(),t.exports=o},function(t,e,r){"use strict";var i=r(7),n=r(9),a=r(13),s=r(16),o=r(32),h=r(50),u=r(62),c=function(){return new Array(2)},l=function(t){a.call(this),this._renderStage=void 0,this._parent=void 0,this._binNum=0,this._sorted=!1,this._sortMode=void 0!==t?t:l.defaultSortMode,this._drawCallback=void 0,this._leafs=[],this._pooledPositionedAttribute=new o(c),this._positionedAttribute=new h,this._stateGraphList=new h,this._bins=new u,l.prototype.init.call(this,t)};l.SORT_BY_STATE=0,l.SORT_BACK_TO_FRONT=1,l.SORT_FRONT_TO_BACK=2,l.defaultSortMode=l.SORT_BY_STATE;var d=function(){return new l},_=new o(d);l.BinPrototypes={RenderBin:function(){return _.getOrCreateObject().init()},DepthSortedBin:function(){return _.getOrCreateObject().init(l.SORT_BACK_TO_FRONT)}};var f=function(t,e){return e._depth-t._depth},g=function(t,e){return t._depth-e._depth},p=function(t,e){return t._binNum-e._binNum};i.createPrototypeObject(l,i.objectInherit(a.prototype,{init:function(t){return this._renderStage=void 0,this._parent=void 0,this._binNum=0,this._sortMode=void 0!==t?t:l.defaultSortMode,this._drawCallback=void 0,l.prototype._initInternal.call(this),this},_initInternal:function(){this._bins.reset(),this._stateGraphList.reset(),this._positionedAttribute.reset(),this._pooledPositionedAttribute.reset(),this._leafs.length=0,this._sorted=!1},_createRenderBin:function(t){var e=l.BinPrototypes.RenderBin;return t&&l.BinPrototypes[t]&&(e=l.BinPrototypes[t]),e()},addPositionAttribute:function(t,e){var r=this._pooledPositionedAttribute.getOrCreateObject();r[0]=t,r[1]=e,this._positionedAttribute.push(r)},getStateGraphList:function(){return this._stateGraphList},getPositionedAttribute:function(){return this._positionedAttribute},copyLeavesFromStateGraphListToRenderLeafList:function(){this._leafs.length=0;for(var t=!1,e=this._stateGraphList.getArray(),r=this._stateGraphList.getLength(),i=0;i<r;i++)for(var a=e[i]._leafs,o=a.getArray(),h=a.getLength(),u=0;u<h;u++){var c=o[u];s.isNaN(c._depth)?t=!0:this._leafs.push(c)}t&&n.debug("warning: RenderBin::copyLeavesFromStateGraphListToRenderLeafList() detected NaN depth values, database may be corrupted."),this._stateGraphList.reset()},getSortMode:function(){return this._sortMode},sortBackToFront:function(){this.copyLeavesFromStateGraphListToRenderLeafList(),this._leafs.sort(f)},sortFrontToBack:function(){this.copyLeavesFromStateGraphListToRenderLeafList(),this._leafs.sort(g)},sortImplementation:function(){var t=l;switch(this._sortMode){case t.SORT_BACK_TO_FRONT:this.sortBackToFront();break;case t.SORT_FRONT_TO_BACK:this.sortFrontToBack();break;case t.SORT_BY_STATE:}},sort:function(){if(!this._sorted){for(var t=this._bins.getKeys(),e=this._bins.getMap(),r=t.getArray(),i=t.getLength(),n=0;n<i;n++){var a=r[n];e[a].sort()}this.sortImplementation(),this._sorted=!0}},setParent:function(t){this._parent=t},getParent:function(){return this._parent},getBinNumber:function(){return this._binNum},findOrInsert:function(t,e){var r=this._bins.getMap(),i=r[t];return i||(i=this._createRenderBin(e),i._parent=this,i._binNum=t,i._renderStage=this._renderStage,this._bins.set(t,i)),i},getStage:function(){return this._renderStage},addStateGraph:function(t){this._stateGraphList.push(t)},reset:function(){l.prototype._initInternal.call(this)},draw:function(t,e){var r=e;return r=this._drawCallback&&this._drawCallback.drawImplementation?this._drawCallback.drawImplementation(this,t,r):this.drawImplementation(t,r)},applyPositionedAttribute:function(t,e){for(var r=e.getArray(),i=e.getLength(),n=0,a=i;n<a;n++){var s=r[n],o=s[1],h=s[0];t.setGlobalDefaultAttribute(o),o.apply(t),o.applyPositionedUniform(h,t),t.haveAppliedAttribute(o)}},drawImplementation:function(t,e){for(var r=e,i=[],n=this._bins.getMap(),a=this._bins.getKeys(),s=a.getLength(),o=a.getArray(),h=0;h<s;h++){var u=o[h];i.push(n[u])}i.sort(p);for(var c,l=0,d=i.length;l<d&&(c=i[l],!(c.getBinNumber()>0));l++)r=c.draw(t,r);for(r=this.drawLeafs(t,r);l<d;l++)c=i[l],r=c.draw(t,r);return r},drawLeafs:function(t,e){for(var r,i=this._stateGraphList.getArray(),n=this._stateGraphList.getLength(),a=this._leafs,s=e,o=0,h=a.length;o<h;o++)r=a[o],
r.render(t,s),s=r;for(var u=0,c=n;u<c;u++)for(var l=i[u],d=l._leafs.getArray(),_=l._leafs.getLength(),f=0;f<_;f++)r=d[f],r.render(t,s),s=r;return s}}),"osg","RenderBin"),l.reset=function(){_.reset()},t.exports=l},function(t,e,r){"use strict";var i=r(7),n=r(54),a=r(71),s=r(9),o=r(69),h=r(15).vec4,u=r(32),c=function(){o.call(this),this._clearColor=h.create(),this._clearDepth=void 0,this._clearMask=void 0,this._camera=void 0,this._viewport=void 0,this._preRenderList=[],this._postRenderList=[],c.prototype.init.call(this)},l=function(){return{renderStage:null,order:null}},d=new u(l);i.createPrototypeObject(c,i.objectInherit(o.prototype,{init:function(){return o.prototype.init.call(this),this._clearDepth=1,h.set(this._clearColor,0,0,0,1),this._clearMask=n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT,this._camera=void 0,this._viewport=void 0,this._renderStage=this,c.prototype._initInternal.call(this),this},_initInternal:function(){this._preRenderList.length=0,this._postRenderList.length=0},reset:function(){d.reset(),o.prototype.reset.call(this),c.prototype._initInternal.call(this)},setClearDepth:function(t){this._clearDepth=t},getClearDepth:function(){return this._clearDepth},setClearColor:function(t){h.copy(this._clearColor,t)},getClearColor:function(){return this._clearColor},setClearMask:function(t){this._clearMask=t},getClearMask:function(){return this._clearMask},setViewport:function(t){this._viewport=t},getViewport:function(){return this._viewport},setCamera:function(t){this._camera=t},getCamera:function(){return this._camera},getPreRenderStageList:function(){return this._preRenderList},getPostRenderStageList:function(){return this._postRenderList},addPreRenderStage:function(t,e){for(var r=0,i=this._preRenderList.length;r<i;r++){var n=this._preRenderList[r];if(e<n.order)break}var a=d.getOrCreateObject();a.order=e,a.renderStage=t,r<this._preRenderList.length?this._preRenderList=this._preRenderList.splice(r,0,a):this._preRenderList.push(a)},addPostRenderStage:function(t,e){for(var r=0,i=this._postRenderList.length;r<i;r++){var n=this._postRenderList[r];if(e<n.order)break}var a=d.getOrCreateObject();a.order=e,a.renderStage=t,r<this._postRenderList.length?this._postRenderList=this._postRenderList.splice(r,0,a):this._postRenderList.push(a)},drawPreRenderStages:function(t,e){for(var r=e,i=0,n=this._preRenderList.length;i<n;++i){var a=this._preRenderList[i].renderStage;r=a.draw(t,r)}return r},draw:function(t,e){this._camera&&this._camera.getInitialDrawCallback()&&this._camera.getInitialDrawCallback()(t);var r=this.drawPreRenderStages(t,e);return r=this.drawImplementation(t,r),r=this.drawPostRenderStages(t,r),this._camera&&this._camera.getFinalDrawCallback()&&this._camera.getFinalDrawCallback()(t),r},sort:function(){for(var t=0,e=this._preRenderList.length;t<e;++t)this._preRenderList[t].renderStage.sort();o.prototype.sort.call(this);for(var r=0,i=this._postRenderList.length;r<i;++r)this._postRenderList[r].renderStage.sort()},drawPostRenderStages:function(t,e){for(var r=e,i=0,n=this._postRenderList.length;i<n;++i){var a=this._postRenderList[i].renderStage;r=a.draw(t,r)}return r},applyCamera:function(t){var e=t.getGraphicContext();if(void 0===this._camera)return void e.bindFramebuffer(e.FRAMEBUFFER,null);var r=this._camera.getViewport(),i=this._camera.frameBufferObject;if(i||(i=new a,this._camera.frameBufferObject=i),i.isDirty()){var n,s,o=this._camera.getAttachments(),h=o[a.COLOR_ATTACHMENT0];h&&h.texture&&(n=h.texture.getWidth(),s=h.texture.getHeight());for(var u in o){h=o[u];var c={};c.attachment=h.attachment,void 0===h.texture?(c.format=h.format,c.width=void 0!==n?n:r.width(),c.height=void 0!==s?s:r.height()):(c.texture=h.texture,c.textureTarget=h.textureTarget,h.format&&(c.format=h.format)),i.setAttachment(c)}}i.apply(t)},drawImplementation:function(t,e){var r=t.getGraphicContext();this.applyCamera(t),void 0===this._viewport&&s.log("RenderStage does not have a valid viewport"),t.applyAttribute(this._viewport),0!==this._clearMask&&(this._clearMask&r.COLOR_BUFFER_BIT&&r.clearColor(this._clearColor[0],this._clearColor[1],this._clearColor[2],this._clearColor[3]),this._clearMask&r.DEPTH_BUFFER_BIT&&(r.depthMask(!0),r.clearDepth(this._clearDepth)),r.clear(this._clearMask)),0!==this._positionedAttribute.getLength()&&this.applyPositionedAttribute(t,this._positionedAttribute);var i=o.prototype.drawImplementation.call(this,t,e);return i}}),"osg","RenderStage"),t.exports=c},function(t,e,r){"use strict";var i=r(9),n=r(7),a=r(43),s=r(30),o=r(8),h=r(37),u=function(){a.call(this),s.call(this),this._fbo=void 0,this._rbo=void 0,this._attachments=[],this._buffers=[],this._dirty=!0,this._hasMRT=h.instance().getWebGLExtension("WEBGL_draw_buffers")};u.COLOR_ATTACHMENT0=36064,u.DEPTH_ATTACHMENT=36096,u.DEPTH_COMPONENT16=33189,u._sDeletedGLFrameBufferCache=new window.Map,u.deleteGLFrameBuffer=function(t,e){u._sDeletedGLFrameBufferCache.has(t)||u._sDeletedGLFrameBufferCache.set(t,[]),u._sDeletedGLFrameBufferCache.get(t).push(e)},u.flushDeletedGLFrameBuffers=function(t,e){if(e<=0)return e;if(!u._sDeletedGLFrameBufferCache.has(t))return e;var r=u._sDeletedGLFrameBufferCache.get(t);if(0===r.length)return e;for(var i=0,n=o.instance().tick(),a=r.length,s=a-1;s>=0&&i<e;s--)t.deleteFramebuffer(r[s]),r.splice(s,1),i=o.instance().deltaS(n,o.instance().tick());return e-i},u.flushAllDeletedGLFrameBuffers=function(t){if(u._sDeletedGLFrameBufferCache.has(t)){var e=u._sDeletedGLFrameBufferCache.get(t);if(0!==e.length)for(var r=e.length,i=r-1;i>=0;i--)t.deleteFramebuffer(e[i]),e.splice(i,1)}},u._sDeletedGLRenderBufferCache=new window.Map,u.deleteGLRenderBuffer=function(t,e){u._sDeletedGLRenderBufferCache.has(t)||u._sDeletedGLRenderBufferCache.set(t,[]),u._sDeletedGLRenderBufferCache.get(t).push(e)},u.flushDeletedGLRenderBuffers=function(t,e){if(e<=0)return e;if(!u._sDeletedGLRenderBufferCache.has(t))return e;for(var r=0,i=o.instance().tick(),n=u._sDeletedGLRenderBufferCache.get(t),a=n.length,s=a-1;s>=0&&r<e;s--)t.deleteRenderbuffer(n[s]),n.splice(s,1),r=o.instance().deltaS(i,o.instance().tick());return e-r},u.flushAllDeletedGLRenderBuffers=function(t){if(u._sDeletedGLRenderBufferCache.has(t))for(var e=u._sDeletedGLRenderBufferCache.get(t),r=e.length,i=r-1;i>=0;i--)t.deleteRenderbuffer(e[i]),e.splice(i,1)},u.onLostContext=function(t){if(u._sDeletedGLFrameBufferCache.has(t)){var e=u._sDeletedGLFrameBufferCache.get(t);e.length=0,u._sDeletedGLRenderBufferCache.has(t)&&(e=u._sDeletedGLRenderBufferCache.get(t),e.length=0)}},n.createPrototypeStateAttribute(u,n.objectInherit(a.prototype,n.objectInherit(s.prototype,{attributeType:"FrameBufferObject",cloneType:function(){return new u},invalidate:function(){if(this._rbo&&this._attachments){for(var t=0,e=this._attachments.length;t<e;++t){var r=this._attachments[t];r.texture||(r.renderBufferObject=void 0)}this._rbo=void 0}this._fbo=void 0,this._buffers.length=0,this._dirty=!0},dirty:function(){this._buffers.length=0,this._dirty=!0},isDirty:function(){return this._dirty},setAttachment:function(t){this._attachments.push(t)},getAttachment:function(t){if(this._attachments)for(var e=0,r=this._attachments.length;e<r;++e){var i=this._attachments[e];if(i.attachment===t)return i}},releaseGLObjects:function(){void 0!==this._fbo&&void 0!==this._gl&&u.deleteGLFrameBuffer(this._gl,this._fbo),this._fbo=void 0,void 0!==this._rbo&&void 0!==this._gl&&u.deleteGLRenderBuffer(this._gl,this._rbo),this.invalidate()},_reportFrameBufferError:function(t){switch(t){case 36054:i.debug("FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case 36055:i.debug("FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case 36057:i.debug("FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case 36061:i.debug("FRAMEBUFFER_UNSUPPORTED");break;default:i.debug("FRAMEBUFFER unknown error "+t.toString(16))}},reset:function(){this.releaseGLObjects(),this._attachments=[]},getFrameBufferObject:function(){return this._fbo},getRenderBufferObject:function(){return this._rbo},createFrameBufferObject:function(t){this.setGraphicContext(t.getGraphicContext()),this._fbo=this._gl.createFramebuffer()},createRenderBuffer:function(t,e,r){var i=this._gl,n=i.createRenderbuffer();return i.bindRenderbuffer(i.RENDERBUFFER,n),i.renderbufferStorage(i.RENDERBUFFER,t,e,r),n},framebufferRenderBuffer:function(t,e){var r=this._gl;r.bindRenderbuffer(r.RENDERBUFFER,e),r.framebufferRenderbuffer(r.FRAMEBUFFER,t,r.RENDERBUFFER,e),void 0!==r.rawgl&&i.log("FBO: renderBuffer: "+this._fbo.trackedObject.defaultName)},framebufferTexture2D:function(t,e,r,n){var a=this._gl;if(t.applyTextureAttribute(1,n),n.isDirty()||!n.getTextureObject())return!1;var s=a.DRAW_FRAMEBUFFER||a.FRAMEBUFFER;return a.framebufferTexture2D(s,e,r,n.getTextureObject().id(),0),void 0!==a.rawgl&&i.log("FBO: texture: "+n.getName()+" : "+n.getTextureObject().id().trackedObject.defaultName+" fbo: "+this._fbo.trackedObject.defaultName),!0},bindFrameBufferObject:function(){var t=this._gl;t.bindFramebuffer(t.FRAMEBUFFER,this._fbo)},checkStatus:function(){var t=this._gl,e=t.checkFramebufferStatus(t.FRAMEBUFFER);e!==t.FRAMEBUFFER_COMPLETE&&this._reportFrameBufferError(e)},_checkAllowedSize:function(t,e){var r=h.instance().getWebGLParameter("MAX_RENDERBUFFER_SIZE");return!(0===t||0===e||e>r||t>r)||(i.error("width ("+t+") or height ("+t+') makes frame buffer not bindable. Max RenderBuffer is "'+r+'"'),!1)},apply:function(t){this._gl||this.setGraphicContext(t.getGraphicContext());var e=this._gl,r=this._attachments;if(0===r.length&&!this._fbo)return void e.bindFramebuffer(e.FRAMEBUFFER,null);if(!this.isDirty())return e.bindFramebuffer(e.FRAMEBUFFER,this._fbo),void(i.reportWebGLError===!0&&this.checkStatus());this._fbo||this.createFrameBufferObject(t),this.bindFrameBufferObject();for(var n=this._hasMRT?this._buffers:void 0,a=!1,s=0,o=r.length;s<o;++s){var h=r[s];if(h.texture){var u=h.texture;if(!this._checkAllowedSize(u.getWidth(),u.getHeight()))return void this.releaseGLObjects();if(this._hasMRT&&h.attachment>=e.COLOR_ATTACHMENT0&&h.attachment<=e.COLOR_ATTACHMENT15&&n.indexOf(h.attachment)===-1&&n.push(h.attachment),!this.framebufferTexture2D(t,h.attachment,h.textureTarget,u))return void this.releaseGLObjects()}else{if(!this._checkAllowedSize(h.width,h.height))return void this.releaseGLObjects();h.renderBufferObject?this._rbo=h.renderBufferObject:(this._rbo=this.createRenderBuffer(h.format,h.width,h.height),h.renderBufferObject=this._rbo),this.framebufferRenderBuffer(h.attachment,this._rbo),a=!0}}n&&n.length>0&&e.drawBuffers(n),this.checkStatus(),a&&e.bindRenderbuffer(e.RENDERBUFFER,null),this._dirty=!1}})),"osg","FrameBufferObject"),t.exports=u},function(t,e,r){"use strict";var i=r(7),n=r(12),a=r(31),s=r(15).mat4,o=r(15).vec2,h=r(15).vec3,u=r(28),c=function(){n.call(this),this._radius=-1,this._range=[],this._rangeMode=c.DISTANCE_FROM_EYE_POINT,this._userDefinedCenter=[],this._centerMode=c.USE_BOUNDING_SPHERE_CENTER};c.DISTANCE_FROM_EYE_POINT=0,c.PIXEL_SIZE_ON_SCREEN=1,c.USE_BOUNDING_SPHERE_CENTER=0,c.USER_DEFINED_CENTER=1,c.UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED=2,i.createPrototypeNode(c,i.objectInherit(n.prototype,{getRadius:function(){return this._radius},setRadius:function(t){this._radius=t},setCenter:function(t){this._centerMode!==c.UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED&&(this._centerMode=c.USER_DEFINED_CENTER),this._userDefinedCenter=t},getCenter:function(){return this._centerMode===c.USER_DEFINED_CENTER||this._centerMode===c.UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED?this._userDefinedCenter:this.getBound().center()},setCenterMode:function(t){this._centerMode=t},computeBoundingSphere:function(t){if(this._centerMode===c.USER_DEFINED_CENTER&&this._radius>=0)return t.set(this._userDefinedCenter,this._radius),t;if(this._centerMode===c.UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED&&this._radius>=0){t.set(this._userDefinedCenter,this._radius);var e=new u;return t.expandByBoundingSphere(n.prototype.computeBoundingSphere.call(this,e)),t}return n.prototype.computeBoundingSphere.call(this,t),t},projectBoundingSphere:function(){var t=h.create();return function(e,r,i){h.transformMat4(t,e.center(),r);var n=e.radius2(),a=t[2]*t[2],s=h.sqrLen(t),o=-Math.PI*i*i*n*Math.sqrt(Math.abs((s-n)/(n-a)))/(n-a);return o}}(),setRangeMode:function(t){this._rangeMode=t},addChildNode:function(t){if(n.prototype.addChild.call(this,t),this.children.length>this._range.length){var e=[],r=0;this._range.lenght>0&&(r=this._range[this._range.length-1][1]),e.push(o.fromValues(r,r)),this._range.push(e)}return!0},addChild:function(t,e,r){if(n.prototype.addChild.call(this,t),this.children.length>this._range.length){var i=[];i.push(o.fromValues(e,e)),this._range.push(i)}return this._range[this.children.length-1][0]=e,this._range[this.children.length-1][1]=r,!0},traverse:function(){var t=h.create(),e=h.create(),r=s.create();return function(i){var n=i.traversalMode;switch(n){case a.TRAVERSE_ALL_CHILDREN:for(var o=0;o<this.children.length;o++)this.children[o].accept(i);break;case a.TRAVERSE_ACTIVE_CHILDREN:var u=0,l=i.getCurrentModelViewMatrix();if(s.invert(r,l),this._rangeMode===c.DISTANCE_FROM_EYE_POINT){h.transformMat4(e,t,r);var d=h.distance(this.getBound().center(),e);u=d*i.getLODScale()}else{var _=i.getCurrentProjectionMatrix();u=this.projectBoundingSphere(this.getBound(),l,_[0]),u=u*i.getViewport().width()*i.getViewport().width()*.25/i.getLODScale()}var f=this.children.length;this._range.length<f&&(f=this._range.length);for(var g=0;g<f;++g)this._range[g][0]<=u&&u<this._range[g][1]&&this.children[g].accept(i)}}}()}),"osg","Lod"),t.exports=c},function(t,e,r){"use strict";var i=r(7),n=r(12),a=r(31),s=function(){n.call(this),this._values=[]};i.createPrototypeNode(s,i.objectInherit(n.prototype,{addChild:function(t,e){return n.prototype.addChild.call(this,t),void 0===e&&(e=!0),this.children.length>this._values.length?this._values.push(e):this._values[this.children.length-1]=e,!0},setValue:function(t,e){t<this._values.length&&(this._values[t]=e)},getValue:function(t){if(t<this._values.length)return this._values[t]},setAllChildrenOff:function(){for(var t=0;t<this._values.length;++t)this._values[t]=!1},setAllChildrenOn:function(){for(var t=0;t<this._values.length;++t)this._values[t]=!0},traverse:function(){return function(t){var e=t.traversalMode;switch(e){case a.TRAVERSE_ALL_CHILDREN:for(var r=0;r<this.children.length;++r)this.children[r].accept(t);break;case a.TRAVERSE_ACTIVE_CHILDREN:var i=this.children.length;for(this._values.length<i&&(i=this._values.length),r=0;r<i;++r)this._values[r]===!0&&this.children[r].accept(t)}}}()}),"osg","Switch"),t.exports=s},function(t,e,r){"use strict";var i=r(7),n=r(72),a=r(31),s=r(15).mat4,o=r(15).vec3,h=function(){n.call(this),this._perRangeDataList=[],this._loading=!1,this._expiryTime=0,this._expiryFrame=0,this._centerMode=n.USER_DEFINED_CENTER,this._frameNumberOfLastTraversal=0,this._databasePath="",this._numChildrenThatCannotBeExpired=0},u=function(){this.filename="",this.function=void 0,this.loaded=!1,this.timeStamp=0,this.frameNumber=0,this.frameNumberOfLastTraversal=0,this.dbrequest=void 0};i.createPrototypeNode(h,i.objectInherit(n.prototype,{setRange:function(t,e,r){if(t>=this._range.length){var i=[];i.push([e,e]),this._range.push(i)}this._range[t][0]=e,this._range[t][1]=r},setExpiryTime:function(t){this._expiryTime=t},setDatabasePath:function(t){this._databasePath=t},getDatabasePath:function(){return this._databasePath},setFileName:function(t,e){if(t>=this._perRangeDataList.length){var r=new u;r.filename=e,this._perRangeDataList.push(r)}else this._perRangeDataList[t].filename=e},setFunction:function(t,e){if(t>=this._perRangeDataList.length){var r=new u;r.function=e,this._perRangeDataList.push(r)}else this._perRangeDataList[t].function=e},addChild:function(t,e,r){n.prototype.addChild.call(this,t,e,r),this._perRangeDataList.push(new u)},addChildNode:function(t){n.prototype.addChildNode.call(this,t)},setFrameNumberOfLastTraversal:function(t){this._frameNumberOfLastTraversal=t},getFrameNumberOfLastTraversal:function(){return this._frameNumberOfLastTraversal},setTimeStamp:function(t,e){this._perRangeDataList[t].timeStamp=e},setFrameNumber:function(t,e){this._perRangeDataList[t].frameNumber=e},setNumChildrenThatCannotBeExpired:function(t){this._numChildrenThatCannotBeExpired=t},getNumChildrenThatCannotBeExpired:function(){return this._numChildrenThatCannotBeExpired},getDatabaseRequest:function(t){return this._perRangeDataList[t].dbrequest},removeExpiredChildren:function(t,e,r){if(!(this.children.length<=this._numChildrenThatCannotBeExpired)){var i,n,a=this.children.length-1;i=this._perRangeDataList[a].timeStamp+this._expiryTime,n=this._perRangeDataList[a].frameNumber+this._expiryFrame,i<t&&n<e&&(this._perRangeDataList[a].filename.length>0||void 0!==this._perRangeDataList[a].function)&&(r.push(this.children[a]),this.removeChild(this.children[a]),this._perRangeDataList[a].loaded=!1,void 0!==this._perRangeDataList[a].dbrequest&&(this._perRangeDataList[a].dbrequest._groupExpired=!0))}},traverse:function(){var t=o.create(),e=o.create(),r=s.create();return function(i){var h=i.traversalMode,u=!1;switch(i.getVisitorType()===a.CULL_VISITOR&&(this._frameNumberOfLastTraversal=i.getFrameStamp().getFrameNumber(),u=!0),h){case a.TRAVERSE_ALL_CHILDREN:for(var c=0;c<this.children.length;c++)this.children[c].accept(i);break;case a.TRAVERSE_ACTIVE_CHILDREN:var l=0,d=i.getCurrentModelViewMatrix();if(s.invert(r,d),this._rangeMode===n.DISTANCE_FROM_EYE_POINT){o.transformMat4(e,t,r);var _=o.distance(this.getBound().center(),e);l=_*i.getLODScale()}else{var f=i.getCurrentProjectionMatrix();l=this.projectBoundingSphere(this.getBound(),d,f[0]),l=l*i.getViewport().width()*i.getViewport().width()*.25/i.getLODScale(),l<0&&(l=this._range[this._range.length-1][0])}for(var g=!1,p=-1,m=0;m<this._range.length;++m)this._range[m][0]<=l&&l<this._range[m][1]&&(m<this.children.length?(u&&(this._perRangeDataList[m].timeStamp=i.getFrameStamp().getSimulationTime(),this._perRangeDataList[m].frameNumber=i.getFrameStamp().getFrameNumber()),this.children[m].accept(i),p=m):g=!0);if(g){var v=this.children.length;if(v>0&&v-1!==p&&(u&&(this._perRangeDataList[v-1].timeStamp=i.getFrameStamp().getSimulationTime(),this._perRangeDataList[v-1].frameNumber=i.getFrameStamp().getFrameNumber()),this.children[v-1].accept(i)),v<this._perRangeDataList.length){var S=(this._range[v][0]-l)/(this._range[v][1]-this._range[v][0]);this._rangeMode===n.PIXEL_SIZE_ON_SCREEN&&(S=-S);var x=i.nodePath[i.nodePath.length-1];if(this._perRangeDataList[v].loaded===!1){this._perRangeDataList[v].loaded=!0;var b=i.getDatabaseRequestHandler();this._perRangeDataList[v].dbrequest=b.requestNodeFile(this._perRangeDataList[v].function,this._databasePath+this._perRangeDataList[v].filename,x,i.getFrameStamp().getSimulationTime(),S)}else void 0!==this._perRangeDataList[v].dbrequest?(this._perRangeDataList[v].dbrequest._timeStamp=i.getFrameStamp().getSimulationTime(),this._perRangeDataList[v].dbrequest._priority=S):this._perRangeDataList[v].loaded=!1}}}}}()}),"osg","PagedLOD"),t.exports=h},function(t,e,r){"use strict";var i=r(7),n=r(64),a=r(76),s=r(31),o=r(79),h=r(77),u=function(){s.call(this,s.TRAVERSE_ALL_CHILDREN)};i.createPrototypeObject(u,i.objectInherit(s.prototype,{apply:function(t){if(t.getTypeID()===h.getTypeID()){var e=t.getUpdateCallback();if(e instanceof o){for(var r=e._stackedTransforms,i=0,n=r.length;i<n;i++){var a=r[i];a.resetToDefaultValue()}e.computeChannels()}}this.traverse(t)}}),"osgAnimation","ResetRestPoseVisitor");var c=new u,l=function(){n.call(this)};i.createPrototypeNode(l,i.objectInherit(n.prototype,{setDefaultUpdateCallback:function(){this.addUpdateCallback(new a)},setRestPose:function(){this.accept(c)}}),"osgAnimation","Skeleton"),t.exports=l},function(t,e,r){"use strict";var i=r(7),n=r(77),a=r(31),s=r(9),o=r(13),h=function(){a.call(this)};i.createPrototypeObject(h,i.objectInherit(a.prototype,{apply:function(t){if(t.getTypeID()===n.getTypeID()){for(var e=!1,r=t.getChildren(),i=0,a=t.getChildren().length;i<a;i++){var o=r[i];if(o.getTypeID()===n.getTypeID()){if(e)return void s.warn("Warning: a Bone was found after a non-Bone child within a Skeleton. Children of a Bone must be ordered with all child Bones first for correct update order.")}else e=!0}this.traverse(t)}}}),"osgAnimation","ValidateSkeletonVisitor");var u=function(t,e){var r=t instanceof n?0:1,i=e instanceof n?0:1;return r-i},c=function(){this._needValidate=!0};i.createPrototypeObject(c,i.objectInherit(o.prototype,{needToValidate:function(){return this._needValidate},update:function(t,e){if(this._needValidate&&e.getVisitorType()===a.UPDATE_VISITOR&&t.className&&"Skeleton"===t.className()){for(var r=new h,i=t.getChildren(),n=0,s=i.length;n<s;n++){var o=i[n];o.accept(r)}i.sort(u),this._needValidate=!1}return!0}}),"osgAnimation","UpdateSkeleton"),t.exports=c},function(t,e,r){"use strict";var i=r(7),n=r(15).vec3,a=r(14),s=r(15).mat4,o=r(64),h=r(78),u=function(t){void 0!==t&&this.setName(t),o.call(this),this._invBindInSkeletonSpace=s.create(),this._boneInSkeletonSpace=s.create(),this._boneBoundingBox=new a};i.createPrototypeNode(u,i.objectInherit(o.prototype,{getOrCreateDebugColor:function(){return this._boneColor?this._boneColor:(this._boneColor=n.fromValues(Math.random(),Math.random(),Math.random()),this._boneColor)},getBoneBoundingBox:function(){return this._boneBoundingBox},setBoneBoundingBox:function(t){this._boneBoundingBox=t},getMatrixInSkeletonSpace:function(){return this._boneInSkeletonSpace},getInvBindMatrixInSkeletonSpace:function(){return this._invBindInSkeletonSpace},setMatrixInSkeletonSpace:function(t){s.copy(this._boneInSkeletonSpace,t)},setInvBindMatrixInSkeletonSpace:function(t){s.copy(this._invBindInSkeletonSpace,t)},getBoneParent:function(){for(var t=this.getParents(),e=0,r=t.length;e<r;e++){var i=t[e].getTypeID();if(i===u.getTypeID())return t[e]}},setDefaultUpdateCallback:function(t){this.addUpdateCallback(new h(void 0!==t?t:this.getName()))}}),"osgAnimation","Bone"),t.exports=u},function(t,e,r){"use strict";var i=r(7),n=r(9),a=r(79),s=r(15).mat4,o=r(31),h=function(){a.call(this)};i.createPrototypeObject(h,i.objectInherit(a.prototype,{update:function(t,e){if(e.getVisitorType()===o.UPDATE_VISITOR){if(t.className&&"Bone"!==t.className())return n.warn("Warning: UpdateBone set on non-Bone object."),!1;var r=t;a.prototype.update.call(this,t),r.setMatrix(r.getMatrix());var i=r.getMatrix(),h=r.getBoneParent();h?s.mul(r.getMatrixInSkeletonSpace(),h.getMatrixInSkeletonSpace(),i):r.setMatrixInSkeletonSpace(i)}return!0}}),"osgAnimation","UpdateBone"),t.exports=h},function(t,e,r){"use strict";var i=r(7),n=r(15).mat4,a=r(80),s=function(){a.call(this),this._stackedTransforms=[],this._matrix=n.create(),this._dirty=!1};i.createPrototypeObject(s,i.objectInherit(a.prototype,{getStackedTransforms:function(){return this._stackedTransforms},computeChannels:function(){this._dirty=!0;var t=this._matrix;n.identity(t);for(var e=this._stackedTransforms,r=0,i=e.length;r<i;r++){var a=e[r];a.applyToMatrix(t)}},update:function(t){return n.copy(t.getMatrix(),this._matrix),this._dirty&&(t.dirtyBound(),this._dirty=!1),!0}}),"osgAnimation","UpdateMatrixTransform"),t.exports=s},function(t,e,r){"use strict";var i=r(9),n=r(7),a=r(13),s=r(64),o=function(){a.call(this)};o.checkPathIsAnimated=function(t){for(var e=0,r=t.length;e<r;++e){var i=t[e];if(i instanceof s)for(var n=i.getUpdateCallbackList(),a=0,h=n.length;a<h;++a)if(n[a]instanceof o)return!0}return!1},n.createPrototypeObject(o,n.objectInherit(a.prototype,{linkChannel:function(){},linkAnimation:function(t){var e=this.getName();if(0===e.length)return i.log("no name on an update callback, discard"),0;for(var r=0,n=t.getChannels(),a=0,s=n.length;a<s;a++){var o=n[a];o.getTargetName()===e&&(this.linkChannel(o),r++)}return r}}),"osgAnimation","AnimationUpdateCallback"),t.exports=o},function(t,e,r){"use strict";var i=r(7),n=r(15).vec3,a=r(36),s=r(9),o=r(15).mat4,h=r(29),u=r(82),c=r(84),l=r(86),d=r(80),_=r(33),f=function(){a.call(this),this._shape=null,this.addUpdateCallback(new c),this._root=void 0,this._pathToRoot=void 0,this._isAnimatedPath=!1,this._boneNameID={},this._matrixFromSkeletonToGeometry=o.create(),this._invMatrixFromSkeletonToGeometry=o.create(),this._rigTransformImplementation=new l,this._stateSetAnimation=new h,this._needToComputeMatrix=!0};i.createPrototypeNode(f,i.objectInherit(a.prototype,{getStateSetAnimation:function(){return this._stateSetAnimation},getSkeleton:function(){return this._root},setSkeleton:function(t){this._root=t},setPathToSkeleton:function(t){this._pathToRoot=t,this._isAnimatedPath=d.checkPathIsAnimated(t)},setNeedToComputeMatrix:function(t){this._needToComputeMatrix=t},getNeedToComputeMatrix:function(){return this._needToComputeMatrix},computeBoundingBox:function(t){t.init();var e=this.getVertexAttributeList().Vertex,r=this.getVertexAttributeList().Weights;if(e&&r&&e.getElements()&&e.getItemSize()>2){for(var i=r.getElements(),n=e.getElements(),a=e.getItemSize(),s=t.getMin(),o=t.getMax(),h=s[0],u=s[1],c=s[2],l=o[0],d=o[1],_=o[2],f=0,g=0,p=n.length;f<p;f+=a,g+=4)if(0===i[f]&&0===i[f+1]&&0===i[f+2]&&0===i[f+3]){var m=n[f],v=n[f+1],S=n[f+2];m<h&&(h=m),m>l&&(l=m),v<u&&(u=v),v>d&&(d=v),S<c&&(c=S),S>_&&(_=S)}s[0]=h,s[1]=u,s[2]=c,o[0]=l,o[1]=d,o[2]=_}return t},computeMatrixFromRootSkeleton:function(){return this._root?(o.identity(this._matrixFromSkeletonToGeometry),_.computeLocalToWorld(this._pathToRoot,!0,this._matrixFromSkeletonToGeometry),o.invert(this._invMatrixFromSkeletonToGeometry,this._matrixFromSkeletonToGeometry),void(this._isAnimatedPath||(this._needToComputeMatrix=!1))):void s.warn("Warning "+this.className()+".computeMatrixFromRootSkeleton if you have this message it means you miss to call buildTransformer( root ), or your RigGeometry ("+this.getName()+") is not attached to a Skeleton subgraph")},getMatrixFromSkeletonToGeometry:function(){return this._matrixFromSkeletonToGeometry},getInvMatrixFromSkeletonToGeometry:function(){return this._invMatrixFromSkeletonToGeometry},getSourceGeometry:function(){return this._geometry},setSourceGeometry:function(t){this._geometry=t},getBoneNameID:function(){return this._boneNameID},setBoneNameID:function(t){this._boneNameID=t},mergeChildrenVertexAttributeList:function(){this._geometry instanceof u&&this._geometry.mergeChildrenVertexAttributeList();var t=this._geometry.getVertexAttributeList();a.appendVertexAttributeToList(t,this.getVertexAttributeList())},mergeChildrenData:function(){this.mergeChildrenVertexAttributeList();var t=this._geometry.getPrimitiveSetList();this.getPrimitiveSetList().length=0;for(var e=0,r=t.length;e<r;e++)this.getPrimitiveSetList()[e]=t[e];this.getStateSet()&&console.error("A stateset in the rig is already present : "+this.getStateSet()),this.setStateSet(this._geometry.getStateSet())},update:function(){this._rigTransformImplementation.update(this)},computeTransformedVertex:function(t,e){e=e||n.create();var r=this.getVertexAttributeList(),i=r.Weights.getElements(),a=r.Bones.getElements(),s=0,o=0,h=0;if(this._geometry.computeTransformedVertex)this._geometry.computeTransformedVertex(t,e),s=e[0],o=e[1],h=e[2];else{var u=r.Vertex.getElements();s=u[3*t],o=u[3*t+1],h=u[3*t+2]}for(var c=4*t,l=this._rigTransformImplementation._skinningAttribute.getMatrixPalette(),d=0,_=0,f=0,g=0,p=0,m=0,v=0,S=0,x=0,b=0,y=0,M=0,T=0,A=!1,C=0;C<4;++C){var I=i[c+C];if(0!==I){var w=12*a[c+C];d+=l[w+0]*I,g+=l[w+1]*I,v+=l[w+2]*I,b+=l[w+3]*I,_+=l[w+4]*I,p+=l[w+5]*I,S+=l[w+6]*I,y+=l[w+7]*I,f+=l[w+8]*I,m+=l[w+9]*I,x+=l[w+10]*I,M+=l[w+11]*I,T+=I,A=!0}}A||(e[0]=s,e[1]=o,e[2]=h);var E=1/T;return e[0]=(d*s+g*o+v*h+b)*E,e[1]=(_*s+p*o+S*h+y)*E,e[2]=(f*s+m*o+x*h+M)*E,e},computeTransformedVertices:function(){for(var t=this.getVertexAttributeList(),e=this._geometry.computeTransformedVertices?this._geometry.computeTransformedVertices():t.Vertex.getElements(),r=t.Weights.getElements(),i=t.Bones.getElements(),n=this._riggedVerts||new Float32Array(e.length),a=this._rigTransformImplementation._skinningAttribute.getMatrixPalette(),s=0,o=0,h=e.length;s<h;s+=3,o+=4){var u,c=0,l=0,d=0,_=0,f=0,g=0,p=0,m=0,v=0,S=0,x=0,b=0,y=0,M=!1,T=r[o];0!==T&&(u=12*i[o],c+=a[u+0]*T,_+=a[u+1]*T,p+=a[u+2]*T,S+=a[u+3]*T,l+=a[u+4]*T,f+=a[u+5]*T,m+=a[u+6]*T,x+=a[u+7]*T,d+=a[u+8]*T,g+=a[u+9]*T,v+=a[u+10]*T,b+=a[u+11]*T,y+=T,M=!0),T=r[o+1],0!==T&&(u=12*i[o+1],c+=a[u+0]*T,_+=a[u+1]*T,p+=a[u+2]*T,S+=a[u+3]*T,l+=a[u+4]*T,f+=a[u+5]*T,m+=a[u+6]*T,x+=a[u+7]*T,d+=a[u+8]*T,g+=a[u+9]*T,v+=a[u+10]*T,b+=a[u+11]*T,y+=T,M=!0),T=r[o+2],0!==T&&(u=12*i[o+2],c+=a[u+0]*T,_+=a[u+1]*T,p+=a[u+2]*T,S+=a[u+3]*T,l+=a[u+4]*T,f+=a[u+5]*T,m+=a[u+6]*T,x+=a[u+7]*T,d+=a[u+8]*T,g+=a[u+9]*T,v+=a[u+10]*T,b+=a[u+11]*T,y+=T,M=!0),T=r[o+3],0!==T&&(u=12*i[o+3],c+=a[u+0]*T,_+=a[u+1]*T,p+=a[u+2]*T,S+=a[u+3]*T,l+=a[u+4]*T,f+=a[u+5]*T,m+=a[u+6]*T,x+=a[u+7]*T,d+=a[u+8]*T,g+=a[u+9]*T,v+=a[u+10]*T,b+=a[u+11]*T,y+=T,M=!0);var A=e[s],C=e[s+1],I=e[s+2];if(M){var w=1/y;n[s]=(c*A+_*C+p*I+S)*w,n[s+1]=(l*A+f*C+m*I+x)*w,n[s+2]=(d*A+g*C+v*I+b)*w}else n[s]=A,n[s+1]=C,n[s+2]=I}return n}}),"osgAnimation","RigGeometry"),t.exports=f},function(t,e,r){"use strict";var i=r(7),n=r(47),a=r(9),s=r(15).vec3,o=r(36),h=r(29),u=r(83),c=r(30),l=r(14),d=function(){o.call(this),this._shape=null,this._targets=[],this._stateSetAnimation=new h,this._targetWeights=new Float32Array(d.MAX_MORPH_GPU),this._morphAttribute=void 0,this._morphTargetNames=void 0,this._maxMorphGPU=d.MAX_MORPH_GPU,this._isInitialized=!1},_=d.EFFECTIVE_EPS=.05;d.MAX_MORPH_GPU=4,i.createPrototypeNode(d,i.objectInherit(o.prototype,{init:function(){return this._morphAttribute?(this._isInitialized=!0,!1):(this._morphAttribute=new u(Math.min(this._maxMorphGPU,this.getMorphTargets().length)),this.getStateSetAnimation().setAttributeAndModes(this._morphAttribute,c.ON),this._morphAttribute.setTargetWeights(this.getTargetsWeight()),this._targets[0]?(this._morphTargetNames=window.Object.keys(this._targets[0].getVertexAttributeList()),this._morphAttribute.copyTargetNames(this._morphTargetNames)):(this._morphTargetNames=[],a.error("No Targets in the MorphGeometry !")),this._isInitialized=!0,!0)},getMaximumPossibleMorphGPU:function(){return this._maxMorphGPU},setMaximumPossibleMorphGPU:function(t){this._maxMorphGPU=t,this._isInitialized=!1,this._morphAttribute&&this._morphAttribute.setNumTargets(t)},getMorphTargetNames:function(){return this._morphTargetNames},getStateSetAnimation:function(){return this._stateSetAnimation},getMorphTargets:function(){return this._targets},isInitialized:function(){return this._isInitialized},getTargetsWeight:function(){return this._targetWeights},computeBoundingBox:function(){var t=new l;return function(e){o.prototype.computeBoundingBox.call(this,e);for(var r=0,i=this._targets.length;r<i;r++)e.expandByBoundingBox(this._targets[r].computeBoundingBox(t));return e}}(),mergeChildrenVertexAttributeList:function(){for(var t=0,e=this._targets.length;t<e;t++){var r=this._targets[t],i=r.getVertexAttributeList();for(var a in i){var s=i[a];s&&!s.getBufferArray&&(i[a]=new n(s))}o.appendVertexAttributeToList(r.getVertexAttributeList(),this.getVertexAttributeList(),t)}},_computeEffectiveSumWeights:function(){for(var t=0,e=this._targetWeights,r=0,i=e.length;r<i;++r){var n=e[r];Math.abs(n)<_||(t+=n)}var a=1e-5;return Math.abs(t)>a?t:t<0?-a:a},computeTransformedVertex:function(t,e){e=e||s.create();var r=3*t,i=this._targetWeights,n=this.getVertexAttributeList(),a=n.Vertex.getElements(),o=1-this._computeEffectiveSumWeights();e[0]=o*a[r],e[1]=o*a[r+1],e[2]=o*a[r+2];for(var h=0,u=i.length;h<u;++h){var c=i[h];if(!(Math.abs(c)<_)){var l=n["Vertex_"+h].getElements();e[0]+=c*l[r],e[1]+=c*l[r+1],e[2]+=c*l[r+2]}}return e},computeTransformedVertices:function(){for(var t=this._targetWeights,e=this.getVertexAttributeList(),r=e.Vertex.getElements(),i=r.length,n=this._morphedVerts=this._morphedVerts||new Float32Array(i),a=1-this._computeEffectiveSumWeights(),s=0;s<i;++s)n[s]=a*r[s];for(var o=0,h=t.length;o<h;++o){var u=t[o];if(!(Math.abs(u)<_))for(var c=e["Vertex_"+o].getElements(),l=0;l<i;++l)n[l]+=u*c[l]}return n;
}}),"osgAnimation","MorphGeometry"),t.exports=d},function(t,e,r){"use strict";var i=r(7),n=r(30),a=r(41),s=function(t,e){n.call(this),this._nbTarget=t,this._enable=!e,this._targetNames={},this._hashNames="",this._hash="",this._dirtyHash=!0};s.uniforms={},i.createPrototypeStateAttribute(s,i.objectInherit(n.prototype,{attributeType:"Morph",cloneType:function(){return new s(void 0,!0)},hasTarget:function(t){return!!this._targetNames[t]},copyTargetNames:function(t){for(var e=this._targetNames,r="",i=e.length=t.length,n=0;n<i;++n){var a=t[n];e[a]=!0,r+=a}this._hashNames=r,this._dirtyHash=!0},getOrCreateUniforms:function(){var t=s,e=this.getNumTargets();return t.uniforms[e]?t.uniforms[e]:(t.uniforms[e]={uTargetWeights:a.createFloat4("uTargetWeights")},t.uniforms[e])},setNumTargets:function(t){this._nbTarget=t,this._dirtyHash=!0},getNumTargets:function(){return this._nbTarget},setTargetWeights:function(t){this._targetWeights=t},getTargetWeights:function(){return this._targetWeights},isEnabled:function(){return this._enable},getHash:function(){return this._dirtyHash?(this._hash=this._computeInternalHash(),this._dirtyHash=!1,this._hash):this._hash},_computeInternalHash:function(){return this.getTypeMember()+this._hashNames+this.getNumTargets()+this.isEnabled()},apply:function(){if(this._enable){var t=this.getOrCreateUniforms();t.uTargetWeights.setFloat4(this._targetWeights)}}}),"osgAnimation","MorphAttribute"),t.exports=s},function(t,e,r){"use strict";var i=r(7),n=r(9),a=r(13),s=r(85),o=function(){a.call(this)};i.createPrototypeObject(o,i.objectInherit(a.prototype,{init:function(t){var e=new s;return t.getParents().length>1&&n.warn("A RigGeometry should not have multi parent ( "+t.getName()+" )"),t.getParents()[0].accept(e),e._root?(t.setSkeleton(e._root),void t.setPathToSkeleton(e._pathToRoot)):void n.warn("A RigGeometry did not find a parent skeleton for RigGeometry ( "+t.getName()+" )")},update:function(t){if(t&&"RigGeometry"!==t.className())return!0;var e=t;return e.getSkeleton()||0===e.getParents().length||this.init(e),!e.getSkeleton()||(e.getNeedToComputeMatrix()&&e.computeMatrixFromRootSkeleton(),e.update(),!0)}}),"osgAnimation","UpdateRigGeometry"),t.exports=o},function(t,e,r){"use strict";var i=r(7),n=r(31),a=r(75),s=function(){n.call(this,n.TRAVERSE_PARENTS),this._root=void 0,this._pathToRoot=void 0};i.createPrototypeObject(s,i.objectInherit(n.prototype,{apply:function(t){if(!this._root)return t.typeID===a.typeID?(this._root=t,void(this._pathToRoot=this.nodePath.slice(1))):void this.traverse(t)}}),"osgAnimation","FindNearestParentSkeleton"),t.exports=s},function(t,e,r){"use strict";var i=r(15).mat4,n=r(30),a=r(87),s=r(88),o=function(){this._isInitialized=!1,this._bones=[]};o.prototype={computeBonePalette:function(t,e){var r=this._bones;for(var i in t){var n=e[i],a=t[i];void 0!==n&&(r[n]=a)}return r},init:function(t){var e=new s;t.getSkeleton().accept(e);var r=e.getBoneMap();this.computeBonePalette(r,t._boneNameID);var i=3*this._bones.length,o=this._skinningAttribute=new a;return o.setMatrixPalette(new Float32Array(4*i)),t.getStateSetAnimation().setAttributeAndModes(o,n.ON),this._isInitialized=!0,!0},computeMatrixPalette:function(){var t=i.create();return function(e,r){for(var n=this._bones,a=this._skinningAttribute.getMatrixPalette(),s=0,o=0,h=n.length;o<h;o++){var u=n[o],c=u.getInvBindMatrixInSkeletonSpace(),l=u.getMatrixInSkeletonSpace();i.mul(t,l,c),i.mul(t,r,t),i.mul(t,t,e),a[s++]=t[0],a[s++]=t[4],a[s++]=t[8],a[s++]=t[12],a[s++]=t[1],a[s++]=t[5],a[s++]=t[9],a[s++]=t[13],a[s++]=t[2],a[s++]=t[6],a[s++]=t[10],a[s++]=t[14]}}}(),update:function(t){this._isInitialized||this.init(t),this.computeMatrixPalette(t.getMatrixFromSkeletonToGeometry(),t.getInvMatrixFromSkeletonToGeometry())}},t.exports=o},function(t,e,r){"use strict";var i=r(7),n=r(30),a=r(41),s=function(t,e){n.call(this),this._enable=!t,this._boneUniformSize=e,this._dirtyHash=!0,this._hash=""};s.uniforms={},s.maxBoneUniformSize=1,s.maxBoneUniformAllowed=1/0,i.createPrototypeStateAttribute(s,i.objectInherit(n.prototype,{attributeType:"Skinning",cloneType:function(){return new s(!0)},getBoneUniformSize:function(){return void 0!==this._boneUniformSize?this._boneUniformSize:s.maxBoneUniformSize},getOrCreateUniforms:function(){var t=s,e=this.getBoneUniformSize();return t.uniforms[e]?t.uniforms[e]:(t.uniforms[e]={uBones:a.createFloat4Array("uBones",e)},t.uniforms[e])},setMatrixPalette:function(t){this._matrixPalette=t,void 0===this._boneUniformSize&&(s.maxBoneUniformSize=Math.max(s.maxBoneUniformSize,t.length/4),s.maxBoneUniformSize=Math.min(s.maxBoneUniformAllowed,s.maxBoneUniformSize))},getMatrixPalette:function(){return this._matrixPalette},isEnabled:function(){return this._enable},getHash:function(){return this._dirtyHash?(this._hash=this._computeInternalHash(),this._dirtyHash=!0,this._hash):this._hash},_computeInternalHash:function(){return this.getTypeMember()+this.getBoneUniformSize()+this.isEnabled()},apply:function(){this._enable&&this.getOrCreateUniforms().uBones.getInternalArray().set(this._matrixPalette)}}),"osgAnimation","SkinningAttribute"),t.exports=s},function(t,e,r){"use strict";var i=r(7),n=r(31),a=r(9),s=r(77),o=function(){n.call(this,n.TRAVERSE_ALL_CHILDREN),this._boneMap={}};i.createPrototypeObject(o,i.objectInherit(n.prototype,{apply:function(t){if(t.typeID===s.typeID){var e=t.getName();e?this._boneMap[e]=t:a.warn("found Bone without name")}this.traverse(t)},getBoneMap:function(){return this._boneMap}}),"osgAnimation","CollectBoneVisitor"),t.exports=o},function(t,e,r){"use strict";var i=r(7),n=r(30),a=function(t,e,r,i){n.call(this),this._func=a.LESS,this._near=0,this._far=1,this._writeMask=!0,void 0!==t&&("string"==typeof t?this._func=a[t]:this._func=t),void 0!==e&&(this._near=e),void 0!==r&&(this._far=r),void 0!==i&&(this._writeMask=i)};a.DISABLE=0,a.NEVER=512,a.LESS=513,a.EQUAL=514,a.LEQUAL=515,a.GREATER=516,a.NOTEQUAL=517,a.GEQUAL=518,a.ALWAYS=519,i.createPrototypeStateAttribute(a,i.objectInherit(n.prototype,{attributeType:"Depth",cloneType:function(){return new a},setRange:function(t,e){this._near=t,this._far=e},setWriteMask:function(t){this._writeMask=t},getWriteMask:function(){return this._writeMask},getFunc:function(){return this._func},apply:function(t){var e=t.getGraphicContext();0===this._func?e.disable(e.DEPTH_TEST):(e.enable(e.DEPTH_TEST),e.depthFunc(this._func),e.depthMask(this._writeMask),e.depthRange(this._near,this._far))}}),"osg","Depth"),t.exports=a},function(t,e){"use strict";var r=function(t,e,r){this._mode=t,this._first=e,this._arrayLengths=r.slice(0)};r.prototype={draw:function(t){for(var e=t.getGraphicContext(),r=this._mode,i=this._first,n=this._arrayLengths,a=0,s=n.length;a<s;a++){var o=n[a];e.drawArrays(r,i,o),i+=o}},getMode:function(){return this._mode},getNumIndices:function(){for(var t=0,e=this._arrayLengths,r=0,i=e.length;r<i;r++)t+=e[r];return t},getCount:function(){return this.getNumIndices()},getArrayLengths:function(){return this._arrayLengths},getFirst:function(){return this._first},setFirst:function(t){this._first=t}},t.exports=r},function(t,e,r){"use strict";var i=r(46),n=function(t,e,r){this.mode=t,void 0!==t&&("string"==typeof t&&(t=i[t]),this.mode=t),this.first=e,this.count=r};n.prototype={draw:function(t){if(0!==this.count){var e=t.getGraphicContext();e.drawArrays(this.mode,this.first,this.count)}},getMode:function(){return this.mode},setCount:function(t){this.count=t},getCount:function(){return this.count},setFirst:function(t){this.first=t},getFirst:function(){return this.first},getNumIndices:function(){return this.count},index:function(t){return this.first+t}},t.exports=n},function(t,e,r){"use strict";var i=r(15).mat4,n=r(15).vec3,a=function(){this._radiusEquator=a.WGS_84_RADIUS_EQUATOR,this._radiusPolar=a.WGS_84_RADIUS_POLAR,this.computeCoefficients()};a.WGS_84_RADIUS_EQUATOR=6378137,a.WGS_84_RADIUS_POLAR=6356752.3142,a.prototype={setRadiusEquator:function(t){this._radiusEquator=t,this.computeCoefficients()},getRadiusEquator:function(){return this._radiusEquator},setRadiusPolar:function(t){this._radiusPolar=t,this.computeCoefficients()},getRadiusPolar:function(){return this._radiusPolar},convertLatLongHeightToXYZ:function(t,e,r,i){var n=Math.sin(t),a=Math.cos(t),s=this._radiusEquator/Math.sqrt(1-this._eccentricitySquared*n*n),o=(s+r)*a*Math.cos(e),h=(s+r)*a*Math.sin(e),u=(s*(1-this._eccentricitySquared)+r)*n;return i[0]=o,i[1]=h,i[2]=u,i},convertXYZToLatLongHeight:function(t,e,r,i){var n=Math.sqrt(t*t+e*e),a=Math.atan2(r*this._radiusEquator,n*this._radiusPolar),s=(this._radiusEquator*this._radiusEquator-this._radiusPolar*this._radiusPolar)/(this._radiusPolar*this._radiusPolar),o=Math.sin(a),h=Math.cos(a),u=Math.atan((r+s*this._radiusPolar*o*o*o)/(n-this._eccentricitySquared*this._radiusEquator*h*h*h)),c=Math.atan2(e,t),l=Math.sin(u),d=this._radiusEquator/Math.sqrt(1-this._eccentricitySquared*l*l),_=Math.cos(u);0===_&&(_=1);var f=n/_-d;return i[0]=u,i[1]=c,i[2]=f,i},computeLocalUpVector:function(t,e,r){var i,a,s=this.convertXYZToLatLongHeight(t,e,r,n.create());return i=s[0],a=s[1],[Math.cos(a)*Math.cos(i),Math.sin(a)*Math.cos(i),Math.sin(i)]},isWGS84:function(){return this._radiusEquator===a.WGS_84_RADIUS_EQUATOR&&this._radiusPolar===a.WGS_84_RADIUS_POLAR},computeCoefficients:function(){var t=(this._radiusEquator-this._radiusPolar)/this._radiusEquator;this._eccentricitySquared=2*t-t*t},computeLocalToWorldTransformFromLatLongHeight:function(t,e,r,n){var a=this.convertLatLongHeightToXYZ(t,e,r,n);return i.fromTranslation(n,a),this.computeCoordinateFrame(t,e,n),n},computeLocalToWorldTransformFromXYZ:function(t,e,r){var a=this.convertXYZToLatLongHeight(t,e,r,n.create()),s=i.fromTranslation(i.create(),n.fromValues(t,e,r));return this.computeCoordinateFrame(a[0],a[1],s),s},computeCoordinateFrame:function(){var t=n.create(),e=n.create(),r=n.create();return function(a,s,o){t[0]=Math.cos(s)*Math.cos(a),t[1]=Math.sin(s)*Math.cos(a),t[2]=Math.sin(a),e[0]=-Math.sin(s),e[1]=-Math.cos(s),n.cross(r,t,e),i.set(o,e[0],e[1],e[2],0,r[0],r[1],r[2],0,t[0],t[1],t[2],0,0,0,0,1)}}()},t.exports=a},function(t,e){"use strict";var r=function(){this._frame=0,this._startSimulation=0,this._currentSimulation=0,this._deltaTime=0};r.prototype={setReferenceTime:function(t){this._startSimulation=t},getReferenceTime:function(){return this._startSimulation},setSimulationTime:function(t){this._currentSimulation=t},getSimulationTime:function(){return this._currentSimulation},setDeltaTime:function(t){this._deltaTime=t},getDeltaTime:function(){return this._deltaTime},setFrameNumber:function(t){this._frame=t},getFrameNumber:function(){return this._frame}},t.exports=r},function(t,e,r){"use strict";var i=r(95),n=r(7),a=r(42),s=function(t){a.call(this,t),this._canPlayDefered=void 0};s.PAUSE=0,s.PLAYING=1,n.createPrototypeObject(s,n.objectInherit(a.prototype,{isDirty:function(){return this._status===s.PLAYING},setImage:function(t){a.prototype.setImage.call(this,t),this._status=s.STOP,t.addEventListener("ended",function(){this._imageObject.loop||this.stop()}.bind(this),!0),this.dirty()},setLooping:function(t){this._imageObject.loop=t},play:function(){this._imageObject.play(),this._status=s.PLAYING},stop:function(){this._imageObject.pause(),this._status=s.PAUSE},whenReady:function(){if(!this._imageObject)return i.reject();var t=this;return new i(function(e){t._canPlayDefered||(t._canPlayDefered=e,t._imageObject.readyState>3?t._canPlayDefered(t):t._imageObject.addEventListener("canplaythrough",t._canPlayDefered.bind(t._canPlayDefered,t),!0))})}}),"osg","ImageStream"),t.exports=s},function(t,e){t.exports=__WEBPACK_EXTERNAL_MODULE_95__},function(t,e,r){"use strict";var i=r(7),n=r(15).vec3,a=r(14),s=r(97),o=r(46),h=r(9),u=function(t,e){this._bb=new a,this._first=t,this._second=e,this._nodeRayStart=n.create(),this._nodeRayEnd=n.create()},c=function(){this._numVertexIndices=0};c.prototype={apply:function(t){t.getAttributes().Vertex&&s(t,this)},operatorPoint:function(){this._numVertexIndices+=2},operatorLine:function(){this._numVertexIndices+=3},operatorTriangle:function(){this._numVertexIndices+=4}};var l=function(t){this._buildKdTree=t,this._numIndices=0};l.prototype={apply:function(t){t.getAttributes().Vertex&&s(t,this)},operatorPoint:function(t){var e=this._buildKdTree._kdTree.getVertices(),r=3*t;this._buildKdTree._kdTree.addPoint(t),this._buildKdTree._primitiveIndices[this._numIndices]=this._numIndices;var i=this._buildKdTree._centers,n=3*this._numIndices;i[n]=e[r],i[n+1]=e[r+1],i[n+2]=e[r+2],this._numIndices++},operatorLine:function(t,e){if(t!==e){var r=this._buildKdTree._kdTree.getVertices(),i=3*t,n=3*e;this._buildKdTree._kdTree.addLine(t,e);var a=this._numIndices;this._buildKdTree._primitiveIndices[a]=a;var s=3*a,o=r[i],h=r[i+1],u=r[i+2],c=r[n],l=r[n+1],d=r[n+2],_=o<c?o:c,f=h<l?h:l,g=u<d?u:d,p=o>c?o:c,m=h>l?h:l,v=u>d?u:d,S=this._buildKdTree._centers;S[s]=.5*(_+p),S[s+1]=.5*(f+m),S[s+2]=.5*(g+v),this._numIndices++}},operatorTriangle:function(t,e,r){if(t!==e&&t!==r&&e!==r){var i=this._buildKdTree._kdTree.getVertices(),n=3*t,a=3*e,s=3*r;this._buildKdTree._kdTree.addTriangle(t,e,r);var o=this._numIndices;this._buildKdTree._primitiveIndices[o]=o;var h=3*o,u=i[n],c=i[n+1],l=i[n+2],d=i[a],_=i[a+1],f=i[a+2],g=i[s],p=i[s+1],m=i[s+2],v=u<d?u<g?u:g:d<g?d:g,S=c<_?c<p?c:p:_<p?_:p,x=l<f?l<m?l:m:f<m?f:m,b=u>d?u>g?u:g:d>g?d:g,y=c>_?c>p?c:p:_>p?_:p,M=l>f?l>m?l:m:f>m?f:m,T=this._buildKdTree._centers;T[h]=.5*(v+b),T[h+1]=.5*(S+y),T[h+2]=.5*(x+M),this._numIndices++}}};var d=function(t){this._kdTree=t,this._bb=new a,this._primitiveIndices=void 0,this._centers=void 0,this._axisOrder=n.create(),this._stackLength=0};d.prototype={build:function(t,e){var r=t._targetNumTrianglesPerLeaf,i=e.getVertexAttributeList().Vertex;if(!i)return!1;var n=i.getElements();if(!n)return!1;var s=n.length/3;if(s<r)return!1;this._bb.copy(e.getBoundingBox()),this._kdTree.setVertices(n),this.computeDivisions(t),t._numVerticesProcessed+=s;for(var h=0,d=e.getPrimitiveSetList(),_=d.length,f=0;f<_;f++){var g=d[f],p=g.getMode();h+=p===o.TRIANGLE_STRIP||p===o.TRIANGLE_FAN?3*Math.abs(g.getCount()-2):3*g.getCount()}var m=new c(this);m.apply(e);var v=m._numVertexIndices;this._primitiveIndices=new Uint32Array(h/3),this._centers=new Float32Array(h),this._kdTree.setPrimitiveIndices(new Uint32Array(h));var S=s>65535?new Uint32Array(v):new Uint16Array(v);this._kdTree.setVertexIndices(S);var x=new l(this);x.apply(e);var b=this._kdTree.getPrimitiveIndices().slice(0,this._kdTree.getNumPrimitiveIndices());this._kdTree.setPrimitiveIndices(b);var y=this._kdTree.getVertexIndices().slice(0,this._kdTree.getNumVertexIndices());this._kdTree.setVertexIndices(y),this._primitiveIndices=this._primitiveIndices.slice(0,x._numIndices),this._centers=this._centers.slice(0,3*x._numIndices);var M=new u(-1,this._primitiveIndices.length);M._bb.copy(this._bb);var T=this._kdTree.addNode(M),A=new a;A.copy(this._bb),this.divide(t,A,T,0);var C=this._kdTree.getPrimitiveIndices();for(_=this._primitiveIndices.length,f=0;f<_;++f)this._primitiveIndices[f]=C[this._primitiveIndices[f]];return this._kdTree.setPrimitiveIndices(this._primitiveIndices),this._kdTree.getNodes().length>0},computeDivisions:function(t){this._stackLength=t._maxNumLevels;var e=this._bb._max,r=this._bb._min,i=e[0]-r[0],n=e[1]-r[1],a=e[2]-r[2],s=this._axisOrder;s[0]=i>=n&&i>=a?0:n>=a?1:2,s[2]=i<n&&i<a?0:n<a?1:2;var o=s[0]+s[2];s[1]=3===o?0:2===o?1:2},divide:function(t,e,r,i){var n=this._kdTree,a=this._primitiveIndices,s=n.getNodes(),o=s[r],h=o._first,c=o._second,l=i<this._stackLength&&h<0&&c>t._targetNumTrianglesPerLeaf,d=-h-1,_=d+c-1;if(!l)return h<0&&this.computeNodeBox(o,d,_),r;if(h>=0)return r;for(var f=this._axisOrder[i%3],g=e._min[f],p=e._max[f],m=.5*(g+p),v=0,S=0,x=!1,b=d,y=_,M=this._centers;b<y;){for(;b<y&&M[3*a[b]+f]<=m;)++b;for(;b<y&&M[3*a[y]+f]>m;)--y;if(b<y){var T=a[b];a[b]=a[y],a[y]=T,++b,--y}}b===y&&(M[3*a[b]+f]<=m?++b:--y),y-d<=-1?(v=0,S=r,x=!0):_-b<=-1?(v=r,S=0,x=!0):(v=n.addNode(new u(-d-1,y-d+1)),S=n.addNode(new u(-b-1,_-b+1)));var A=e._max[f];e._max[f]=m;var C=0!==v?this.divide(t,e,v,i+1):0;e._max[f]=A,A=e._min[f],e._min[f]=m;var I=0!==S?this.divide(t,e,S,i+1):0;if(e._min[f]=A,!x){o._first=C,o._second=I,x=!0;var w=o._bb;w.init(),0!==C&&w.expandByBoundingBox(s[C]._bb),0!==I&&w.expandByBoundingBox(s[I]._bb)}return r},computeNodeBox:function(t,e,r){for(var i=1/0,n=1/0,a=1/0,s=-(1/0),o=-(1/0),h=-(1/0),u=this._kdTree.getVertexIndices(),c=this._kdTree.getPrimitiveIndices(),l=this._kdTree.getVertices(),d=e;d<=r;++d)for(var _=c[this._primitiveIndices[d]],f=u[_++],g=0;g<f;++g){var p=3*u[_++],m=l[p],v=l[p+1],S=l[p+2];m<i&&(i=m),v<n&&(n=v),S<a&&(a=S),m>s&&(s=m),v>o&&(o=v),S>h&&(h=S)}var x=1e-6,b=t._bb,y=b._min,M=b._max;y[0]=i-x,y[1]=n-x,y[2]=a-x,M[0]=s+x,M[1]=o+x,M[2]=h+x}};var _=function(){this._vertices=null,this._kdNodes=[],this._primitiveIndices=void 0,this._vertexIndices=void 0,this._numVertexIndices=0,this._numPrimitiveIndices=0};i.createPrototypeObject(_,{getVertices:function(){return this._vertices},setVertices:function(t){this._vertices=t},getNumPrimitiveIndices:function(){return this._numPrimitiveIndices},getNumVertexIndices:function(){return this._numVertexIndices},setPrimitiveIndices:function(t){this._primitiveIndices=t},getPrimitiveIndices:function(){return this._primitiveIndices},setVertexIndices:function(t){this._vertexIndices=t},getVertexIndices:function(){return this._vertexIndices},getNodes:function(){return this._kdNodes},addPoint:function(t){var e=this._numVertexIndices;this._primitiveIndices[this._numPrimitiveIndices++]=e,this._vertexIndices[this._numVertexIndices++]=1,this._vertexIndices[this._numVertexIndices++]=t},addLine:function(t,e){var r=this._numVertexIndices;this._primitiveIndices[this._numPrimitiveIndices++]=r,this._vertexIndices[this._numVertexIndices++]=2,this._vertexIndices[this._numVertexIndices++]=t,this._vertexIndices[this._numVertexIndices++]=e},addTriangle:function(t,e,r){var i=this._numVertexIndices;this._primitiveIndices[this._numPrimitiveIndices++]=i,this._vertexIndices[this._numVertexIndices++]=3,this._vertexIndices[this._numVertexIndices++]=t,this._vertexIndices[this._numVertexIndices++]=e,this._vertexIndices[this._numVertexIndices++]=r},addNode:function(t){return this._kdNodes.push(t),this._kdNodes.length-1},build:function(t,e){var r=new d(this);return r.build(t,e)},_intersectFunctor:function(t,e){var r=-e._first-1,i=r+e._second,n=this._vertexIndices;t.setVertices(this._vertices),t.setPrimitiveIndex(r);for(var a=r;a<i;++a){var s=this._primitiveIndices[a],o=n[s++];3===o?t.operatorTriangle(n[s],n[s+1],n[s+2]):2===o?t.operatorLine(n[s],n[s+1]):1===o?t.operatorPoint(n[s]):h.error("KdTree::intersect() unsupported vertices count :"+o)}},intersect:function(t,e){return e._first<0?void this._intersectFunctor(t,e):void(t.enter(e._bb)&&(e._first>0&&this.intersect(t,this._kdNodes[e._first]),e._second>0&&this.intersect(t,this._kdNodes[e._second]),t.leave()))},intersectLineSegment:function(t,e,r,i){if(e._first<0)return void this._intersectFunctor(t,e);var a=e._nodeRayStart,s=e._nodeRayEnd;n.copy(a,r),n.copy(s,i);var o,h=this._kdNodes;e._first>0&&(o=h[e._first],t.enter(o._bb,a,s)&&this.intersectLineSegment(t,o,a,s)),e._second>0&&(n.copy(a,r),n.copy(s,i),o=h[e._second],t.enter(o._bb,a,s)&&this.intersectLineSegment(t,o,a,s))}},"osg","KdTree"),t.exports=_},function(t,e,r){"use strict";var i=r(46),n=r(45),a=r(91),s=[],o=[];s[i.TRIANGLES]=function(t,e,r,i){for(var n=t+e,a=t;a<n;a+=3)i.operatorTriangle(r[a],r[a+1],r[a+2])},s[i.TRIANGLE_STRIP]=function(t,e,r,i){for(var n=2,a=t;n<e;++n,++a)n%2?i.operatorTriangle(r[a],r[a+2],r[a+1]):i.operatorTriangle(r[a],r[a+1],r[a+2])},s[i.TRIANGLE_FAN]=function(t,e,r,i){for(var n=r[t],a=2,s=t+1;a<e;++a,++s)i.operatorTriangle(n,r[s],r[s+1])},s[i.POINTS]=function(t,e,r,i){for(var n=t+e,a=t;a<n;++a)i.operatorPoint(r[a])},s[i.LINES]=function(t,e,r,i){for(var n=t+e,a=t;a<n;a+=2)i.operatorLine(r[a],r[a+1])},s[i.LINE_STRIP]=function(t,e,r,i){for(var n=t+e,a=t;a<n;++a)i.operatorLine(r[a],r[a+1])},s[i.LINE_LOOP]=function(t,e,r,i){for(var n=t+e,a=t;a<n;++a)i.operatorLine(r[a],r[a+1]);i.operatorLine(r[r.length-1],r[0])},o[i.TRIANGLES]=function(t,e,r){for(var i=2,n=t;i<e;i+=3,n+=3)r.operatorTriangle(n,n+1,n+2)},o[i.TRIANGLE_STRIP]=function(t,e,r){for(var i=2,n=t;i<e;++i,++n)i%2?r.operatorTriangle(n,n+2,n+1):r.operatorTriangle(n,n+1,n+2)},o[i.TRIANGLE_FAN]=function(t,e,r){for(var i=2,n=t+1;i<e;++i,++n)r.operatorTriangle(t,n,n+1)},o[i.POINTS]=function(t,e,r){for(var i=0,n=t;i<e;++i,++n)r.operatorPoint(n)},o[i.LINES]=function(t,e,r){for(var i=1,n=t;i<e;i+=2,n+=2)r.operatorLine(n,n+1)},o[i.LINE_STRIP]=function(t,e,r){for(var i=1,n=t;i<e;++i,++n)r.operatorLine(n,n+1)},o[i.LINE_LOOP]=function(t,e,r){for(var i=1,n=t;i<e;++i,++n)r.operatorLine(n,n+1);r.operatorLine(t+e-1,t)};var h=function(t,e){var r=t.getPrimitiveSetList();if(r)for(var i,h=r.length,u=0;u<h;u++){var c=r[u];if(c instanceof n){if(i=s[c.getMode()]){var l=c.indices.getElements();i(c.getFirst()/l.BYTES_PER_ELEMENT,c.getCount(),l,e)}}else c instanceof a&&(i=o[c.getMode()],i&&i(c.getFirst(),c.getCount(),e))}};t.exports=h},function(t,e,r){"use strict";var i=r(7),n=r(31),a=r(96),s=function(t){if(n.call(this),this._buildOptions={_numVerticesProcessed:0,_targetNumTrianglesPerLeaf:50,_maxNumLevels:20},t){var e=t._targetNumTrianglesPerLeaf,r=t._maxNumLevels;void 0!==e&&(this._buildOptions._targetNumTrianglesPerLeaf=e),void 0!==r&&(this._buildOptions._maxNumLevels=r)}};i.createPrototypeObject(s,i.objectInherit(n.prototype,{apply:function(t){if(t.getShape){var e=t.getShape();if(void 0===e){var r=new a;r.build(this._buildOptions,t)&&t.setShape(r)}}this.traverse(t)}}),"osg","KdTreeBuilder"),t.exports=s},function(t,e,r){"use strict";var i=r(7),n=r(30),a=r(41),s=r(15).mat3,o=r(15).mat4,h=r(15).vec3,u=r(15).vec4,c=function(t,e){n.call(this);var r=void 0!==t?t:0;this._ambient=u.fromValues(.2,.2,.2,1),this._diffuse=u.fromValues(.8,.8,.8,1),this._specular=u.fromValues(.2,.2,.2,1),this._position=u.fromValues(0,0,1,0),this._direction=h.fromValues(0,0,-1),this._ground=u.fromValues(.2,.2,.2,-1),this._spotCutoff=180,this._spotBlend=.01,this._attenuation=u.fromValues(1,0,0,0),this._lightNumber=r,this._enable=!e,this._dirtyHash=!0,this._hash=""};c.DIRECTION="DIRECTION",c.SPOT="SPOT",c.POINT="POINT",c.HEMI="HEMI",c.uniforms={},i.createPrototypeStateAttribute(c,i.objectInherit(n.prototype,{attributeType:"Light",cloneType:function(){return new c(this._lightNumber,!0)},getTypeMember:function(){return this.attributeType+this._lightNumber},getUniformName:function(t){return"u"+this.getTypeMember()+"_"+t},getHash:function(){return this._dirtyHash?(this._hash=this._computeInternalHash(),this._dirtyHash=!1,this._hash):this._hash},_computeInternalHash:function(){return this.getTypeMember()+this.getLightType()+this.isEnabled().toString()},getOrCreateUniforms:function(){var t=c,e=this.getTypeMember();return t.uniforms[e]?t.uniforms[e]:(t.uniforms[e]={viewPosition:a.createFloat4(this.getUniformName("viewPosition")),viewDirection:a.createFloat3(this.getUniformName("viewDirection")),modelViewMatrix:a.createMatrix4(this.getUniformName("modelViewMatrix")),modelViewNormalMatrix:a.createMatrix3(this.getUniformName("modelViewNormalMatrix")),ambient:a.createFloat4(this.getUniformName("ambient")),diffuse:a.createFloat4(this.getUniformName("diffuse")),specular:a.createFloat4(this.getUniformName("specular")),attenuation:a.createFloat4(this.getUniformName("attenuation")),spotCutOff:a.createFloat1(this.getUniformName("spotCutOff")),spotBlend:a.createFloat1(this.getUniformName("spotBlend")),ground:a.createFloat4(this.getUniformName("ground"))},t.uniforms[e])},isEnabled:function(){return this._enable},setEnabled:function(t){this._enable=t,this._dirtyHash=!0},setAmbient:function(t){u.copy(this._ambient,t)},getAmbient:function(){return this._ambient},setDiffuse:function(t){u.copy(this._diffuse,t)},getDiffuse:function(){return this._diffuse},setSpecular:function(t){u.copy(this._specular,t)},getSpecular:function(){return this._specular},setPosition:function(t){u.copy(this._position,t)},getPosition:function(){return this._position},setDirection:function(t){h.copy(this._direction,t)},getDirection:function(){return this._direction},setSpotCutoff:function(t){this._spotCutoff=t},getSpotCutoff:function(){return this._spotCutoff},setSpotBlend:function(t){this._spotBlend=t},getSpotBlend:function(){return this._spotBlend},setGround:function(t){h.copy(this._ground,t)},getGround:function(){return this._ground},setConstantAttenuation:function(t){this._attenuation[0]=t},getConstantAttenuation:function(){return this._attenuation[0]},setLinearAttenuation:function(t){this._attenuation[1]=t},getLinearAttenuation:function(){return this._attenuation[1]},setQuadraticAttenuation:function(t){this._attenuation[2]=t},getQuadraticAttenuation:function(){return this._attenuation[2]},setLightType:function(t){return t===c.DIRECTION?this.setLightAsDirection():t===c.SPOT?this.setLightAsSpot():t===c.HEMI?this.setLightAsHemi():this.setLightAsPoint()},getLightType:function(){return this.isDirectionLight()?c.DIRECTION:this.isSpotLight()?c.SPOT:this.isHemiLight()?c.HEMI:c.POINT},setLightAsSpot:function(){u.set(this._position,0,0,0,1),h.set(this._direction,0,0,-1),this._ground[3]=-1,this._spotCutoff=90,this._dirtyHash=!0},setLightAsPoint:function(){u.set(this._position,0,0,0,1),h.set(this._direction,0,0,-1),this._ground[3]=-1,this._dirtyHash=!0},setLightAsDirection:function(){u.set(this._position,0,0,1,0),this._spotCutoff=180,this._ground[3]=-1,this._dirtyHash=!0},setLightAsHemi:function(){u.set(this._position,0,0,1,0),this._spotCutoff=180,this._ground[3]=1,this._dirtyHash=!0},setLightNumber:function(t){this._lightNumber=t,this._dirtyHash=!0},getLightNumber:function(){return this._lightNumber},isSpotLight:function(){return this._spotCutoff<180},isDirectionLight:function(){return 0===this._position[3]&&this._ground[3]===-1},isHemiLight:function(){return 1===this._ground[3]},applyPositionedUniform:function(t){var e=this.getOrCreateUniforms(),r=e.modelViewMatrix.getInternalArray(),i=e.modelViewNormalMatrix.getInternalArray(),n=e.viewPosition.getInternalArray(),a=e.viewDirection.getInternalArray();o.copy(r,t),s.normalFromMat4(i,t),u.transformMat4(n,this._position,r),h.transformMat3(a,this._direction,i)},apply:function(){if(this._enable){var t=this.getOrCreateUniforms();if(this.isSpotLight()){var e=Math.cos(this._spotCutoff*Math.PI/180);t.spotCutOff.setFloat(e),t.spotBlend.setFloat((1-e)*this._spotBlend)}this.isHemiLight()&&t.ground.setFloat4(this._ground),t.attenuation.setFloat4(this._attenuation),t.diffuse.setFloat4(this._diffuse),t.specular.setFloat4(this._specular),t.ambient.setFloat4(this._ambient)}}}),"osg","Light"),t.exports=c},function(t,e,r){"use strict";var i=r(7),n=r(30),a=function(t){n.call(this),this.lineWidth=1,void 0!==t&&(this.lineWidth=t)};i.createPrototypeStateAttribute(a,i.objectInherit(n.prototype,{attributeType:"LineWidth",cloneType:function(){return new a},apply:function(t){t.getGraphicContext().lineWidth(this.lineWidth)}}),"osg","LineWidth"),t.exports=a},function(t,e,r){"use strict";var i=r(7),n=r(30),a=r(15).vec4,s=r(41),o=function(){n.call(this),this._ambient=a.fromValues(.2,.2,.2,1),this._diffuse=a.fromValues(.8,.8,.8,1),this._specular=a.fromValues(0,0,0,1),this._emission=a.fromValues(0,0,0,1),this._shininess=12.5};i.createPrototypeStateAttribute(o,i.objectInherit(n.prototype,{attributeType:"Material",cloneType:function(){return new o},getParameterName:function(t){return"u"+this.getType()+"_"+t},getOrCreateUniforms:function(){var t=o;return t.uniforms?t.uniforms:(t.uniforms={ambient:s.createFloat4("uMaterialAmbient"),diffuse:s.createFloat4("uMaterialDiffuse"),specular:s.createFloat4("uMaterialSpecular"),emission:s.createFloat4("uMaterialEmission"),shininess:s.createFloat1("uMaterialShininess")},t.uniforms)},setEmission:function(t){a.copy(this._emission,t)},getEmission:function(){return this._emission},setAmbient:function(t){a.copy(this._ambient,t)},getAmbient:function(){return this._ambient},setSpecular:function(t){a.copy(this._specular,t)},getSpecular:function(){return this._specular},setDiffuse:function(t){a.copy(this._diffuse,t)},getDiffuse:function(){return this._diffuse},setShininess:function(t){this._shininess=t},getShininess:function(){return this._shininess},setTransparency:function(t){this._diffuse[3]=1-t},getTransparency:function(){return this._diffuse[3]},apply:function(){var t=this.getOrCreateUniforms();t.ambient.setFloat4(this._ambient),t.diffuse.setFloat4(this._diffuse),t.specular.setFloat4(this._specular),t.emission.setFloat4(this._emission),t.shininess.setFloat(this._shininess)}}),"osg","Material"),t.exports=o},function(t,e,r){"use strict";var i=r(7),n=r(30),a=r(41),s=function(t){n.call(this),this._enable=!t,this._pointSize=1,this._circleShape=!1,this._dirtyHash=!0,this._hash=""};i.createPrototypeStateAttribute(s,i.objectInherit(n.prototype,{attributeType:"PointSize",cloneType:function(){return new s(!0)},setCircleShape:function(t){this._circleShape=t,this._dirtyHash=!0},isCircleShape:function(){return this._circleShape},setEnabled:function(t){this._enable=t,this._dirtyHash=!0},isEnabled:function(){return this._enable},setPointSize:function(t){this._pointSize=t},getOrCreateUniforms:function(){var t=s;return t.uniforms?t.uniforms:(t.uniforms={pointSize:a.createFloat(1,"uPointSize")},t.uniforms)},getHash:function(){return this._dirtyHash?(this._hash=this._computeInternalHash(),this._dirtyHash=!1,this._hash):this._hash},_computeInternalHash:function(){return this.getTypeMember()+(this.isEnabled()?"1":"0")+(this._circleShape?"1":"0")},apply:function(){if(this._enable){var t=this.getOrCreateUniforms();t.pointSize.setFloat(this._pointSize)}}}),"osg","PointSizeAttribute"),t.exports=s},function(t,e,r){"use strict";var i=r(15).vec3,n=r(46),a=r(45),s=r(91),o=[],h=[];o[n.POINTS]=function(){var t=i.create();return function(e,r,i,n,a){for(var s=e+r,o=e;o<s;++o){var h=3*i[o];t[0]=a[h],t[1]=a[h+1],t[2]=a[h+2],n.operatorPoint(t)}}}(),o[n.LINES]=function(){var t=i.create(),e=i.create();return function(r,i,n,a,s){for(var o=r+i,h=r;h<o-1;h+=2){var u=3*n[h];t[0]=s[u],t[1]=s[u+1],t[2]=s[u+2],u=3*n[h+1],e[0]=s[u],e[1]=s[u+1],e[2]=s[u+2],a.operatorLine(t,e)}}}(),o[n.LINE_STRIP]=function(){var t=i.create(),e=i.create();return function(r,i,n,a,s){for(var o=r+i,h=r;h<o-1;++h){var u=3*n[h];t[0]=s[u],t[1]=s[u+1],t[2]=s[u+2],u=3*n[h+1],e[0]=s[u],e[1]=s[u+1],e[2]=s[u+2],a.operatorLine(t,e)}}}(),o[n.LINE_LOOP]=function(){var t=i.create(),e=i.create();return function(r,i,n,a,s){for(var o=r+i-1,h=r;h<o;++h){var u=3*n[h];t[0]=s[u],t[1]=s[u+1],t[2]=s[u+2],u=3*n[h+1],e[0]=s[u],e[1]=s[u+1],e[2]=s[u+2],a.operatorLine(t,e)}o=3*n[o],t[0]=s[o],t[1]=s[o+1],t[2]=s[o+2];var c=3*n[0];e[0]=s[c],e[1]=s[c+1],e[2]=s[c+2],a.operatorLine(t,e)}}(),o[n.TRIANGLES]=function(){var t=i.create(),e=i.create(),r=i.create();return function(i,n,a,s,o){for(var h=i+n,u=i;u<h;u+=3){var c=3*a[u];t[0]=o[c],t[1]=o[c+1],t[2]=o[c+2],c=3*a[u+1],e[0]=o[c],e[1]=o[c+1],e[2]=o[c+2],c=3*a[u+2],r[0]=o[c],r[1]=o[c+1],r[2]=o[c+2],s.operatorTriangle(t,e,r)}}}(),o[n.TRIANGLE_STRIP]=function(){var t=i.create(),e=i.create(),r=i.create();return function(i,n,a,s,o){for(var h=2,u=i;h<n;++h,++u){var c=3*a[u];t[0]=o[c],t[1]=o[c+1],t[2]=o[c+2],c=3*a[u+1],e[0]=o[c],e[1]=o[c+1],e[2]=o[c+2],c=3*a[u+2],r[0]=o[c],r[1]=o[c+1],r[2]=o[c+2],h%2?s.operatorTriangle(t,r,e):s.operatorTriangle(t,e,r)}}}(),o[n.TRIANGLE_FAN]=function(){var t=i.create(),e=i.create(),r=i.create();return function(i,n,a,s,o){for(var h=a[i],u=2,c=i+1;u<n;++u,++c){t[0]=o[h],t[1]=o[h+1],t[2]=o[h+2];var l=3*a[c];e[0]=o[l],e[1]=o[l+1],e[2]=o[l+2],l=3*a[c+1],r[0]=o[l],r[1]=o[l+1],r[2]=o[l+2],s.operatorTriangle(t,e,r)}}}(),h[n.POINTS]=function(){var t=i.create();return function(e,r,i,n){for(var a=e;a<e+r;++a){var s=3*a;t[0]=n[s],t[1]=n[s+1],t[2]=n[s+2],i.operatorPoint(t)}}}(),h[n.LINES]=function(){var t=i.create(),e=i.create();return function(r,i,n,a){for(var s=r;s<r+i-1;s+=2){var o=3*s;t[0]=a[o],t[1]=a[o+1],t[2]=a[o+2],
o=3*(s+1),e[0]=a[o],e[1]=a[o+1],e[2]=a[o+2],n.operatorLine(t,e)}}}(),h[n.LINE_STRIP]=function(){var t=i.create(),e=i.create();return function(r,i,n,a){for(var s=r;s<r+i-1;++s){var o=3*s;t[0]=a[o],t[1]=a[o+1],t[2]=a[o+2],o=3*(s+1),e[0]=a[o],e[1]=a[o+1],e[2]=a[o+2],n.operatorLine(t,e)}}}(),h[n.LINE_LOOP]=function(){var t=i.create(),e=i.create();return function(r,i,n,a){for(var s=r+i-1,o=r;o<s;++o){var h=3*o;t[0]=a[h],t[1]=a[h+1],t[2]=a[h+2],h=3*(o+1),e[0]=a[h],e[1]=a[h+1],e[2]=a[h+2],n.operatorLine(t,e)}s*=3,t[0]=a[s],t[1]=a[s+1],t[2]=a[s+2],r*=3,e[0]=a[r],e[1]=a[r+1],e[2]=a[r+2],n.operatorLine(t,e)}}(),h[n.TRIANGLES]=function(){var t=i.create(),e=i.create(),r=i.create();return function(i,n,a,s){for(var o=i;o<i+n;o+=3){var h=3*o;t[0]=s[h],t[1]=s[h+1],t[2]=s[h+2],h=3*(o+1),e[0]=s[h],e[1]=s[h+1],e[2]=s[h+2],h=3*(o+2),r[0]=s[h],r[1]=s[h+1],r[2]=s[h+2],a.operatorTriangle(t,e,r)}}}(),h[n.TRIANGLE_STRIP]=function(){var t=i.create(),e=i.create(),r=i.create();return function(i,n,a,s){for(var o=2,h=i;o<n;++o,++h){var u=3*h;t[0]=s[u],t[1]=s[u+1],t[2]=s[u+2],u=3*(h+1),e[0]=s[u],e[1]=s[u+1],e[2]=s[u+2],u=3*(h+2),r[0]=s[u],r[1]=s[u+1],r[2]=s[u+2],o%2?a.operatorTriangle(t,r,e):a.operatorTriangle(t,e,r)}}}(),h[n.TRIANGLE_FAN]=function(){var t=i.create(),e=i.create(),r=i.create();return function(i,n,a,s){for(var o=2,h=i+1;o<n;++o,++h){t[0]=s[i],t[1]=s[i+1],t[2]=s[i+2];var u=3*h;e[0]=s[u],e[1]=s[u+1],e[2]=s[u+2],u=3*(h+1),r[0]=s[u],r[1]=s[u+1],r[2]=s[u+2],a.operatorTriangle(t,e,r)}}}();var u=function(t,e,r){var i=t.getPrimitiveSetList();if(i)for(var n,u=i.length,c=0;c<u;c++){var l=i[c];if(l instanceof a){if(n=o[l.getMode()]){var d=l.indices.getElements();n(l.getFirst()/d.BYTES_PER_ELEMENT,l.getCount(),d,e,r)}}else l instanceof s&&(n=h[l.getMode()],n&&n(l.getFirst(),l.getCount(),e,r))}};t.exports=u},function(t,e,r){"use strict";var i=r(7),n=r(9),a=r(43),s=r(30),o=r(105),h=r(8),u=new o,c=function(t,e){a.call(this),s.call(this),this._program=null,this._nullProgram=!0,this._vertex=void 0,this._fragment=void 0,this._uniformsCache=void 0,this._attributesCache=void 0,this._activeUniforms=void 0,this._foreignUniforms=void 0,this._trackAttributes=void 0,t&&this.setVertexShader(t),e&&this.setFragmentShader(e),this._dirty=!0},l=function(t){var e,r,i,n={},a=t.match(/attribute\s+\w+\s+\w+/g);if(null!==a)for(e=0,r=a.length;e<r;e++)i=a[e].match(/attribute\s+\w+\s+(\w+)/)[1],n[i]=!0;else for(a=t.match(/in\s+\w+\s+\w+\s*;/g),e=0,r=a.length;e<r;e++)i=a[e].match(/in\s+\w+\s+(\w+)\s*;/)[1],n[i]=!0;return n};c._sDeletedGLProgramCache=new window.Map,c.deleteGLProgram=function(t,e){c._sDeletedGLProgramCache.has(t)||c._sDeletedGLProgramCache.set(t,[]),c._sDeletedGLProgramCache.get(t).push(e)},c.flushDeletedGLPrograms=function(t,e){if(e<=0)return e;if(!c._sDeletedGLProgramCache.has(t))return e;for(var r=0,i=h.instance().tick(),n=c._sDeletedGLProgramCache.get(t),a=n.length,s=a-1;s>=0&&r<e;s--)t.deleteProgram(n[s]),n.splice(s,1),r=h.instance().deltaS(i,h.instance().tick());return e-r},c.flushAllDeletedGLPrograms=function(t){if(c._sDeletedGLProgramCache.has(t))for(var e=c._sDeletedGLProgramCache.get(t),r=e.length,i=r-1;i>=0;i--)t.deleteProgram(e[i]),e.splice(i,1)},c.onLostContext=function(t){if(c._sDeletedGLProgramCache.has(t)){var e=c._sDeletedGLProgramCache.get(t);e.length=0}},i.createPrototypeStateAttribute(c,i.objectInherit(a.prototype,i.objectInherit(s.prototype,{attributeType:"Program",cloneType:function(){return new c},setVertexShader:function(t){this._vertex=t,this._nullProgram=!1,t.setText(u.processShader(t.getText()))},setFragmentShader:function(t){this._fragment=t,this._nullProgram=!1,t.setText(u.processShader(t.getText()))},getVertexShader:function(){return this._vertex},getFragmentShader:function(){return this._fragment},getProgram:function(){return this._program},setActiveUniforms:function(t){this._activeUniforms=t},getActiveUniforms:function(){return this._activeUniforms},setForeignUniforms:function(t){this._foreignUniforms=t},getForeignUniforms:function(){return this._foreignUniforms},setUniformsCache:function(t){this._uniformsCache=t},getUniformsCache:function(){return this._uniformsCache},setAttributesCache:function(t){this._attributesCache=t},getAttributesCache:function(){return this._attributesCache},setTrackAttributes:function(t){this._trackAttributes=t},getTrackAttributes:function(){return this._trackAttributes},releaseGLObjects:function(){void 0!==this._vertex&&this._vertex.releaseGLObjects(),void 0!==this._fragment&&this._fragment.releaseGLObjects(),null!==this._program&&(void 0!==this._gl&&(c.deleteGLProgram(this._gl,this._program),a.removeObject(this._gl,this)),this.invalidate())},dirty:function(){this._program=void 0},invalidate:function(){this._cacheUniformId=void 0,this._uniformsCache=void 0,this._attributesCache=void 0,this._foreignUniforms=void 0,this._trackAttributes=void 0,this._program=void 0},apply:function(t){if(!this._nullProgram){this._gl||this.setGraphicContext(t.getGraphicContext());var e=this._gl;if(!this._program||this._dirty){var r;this._vertex.shader||(r=this._vertex.compile(e)),this._fragment.shader||(r=this._fragment.compile(e));var a=l(this._vertex.getText());if(r&&(this._program=e.createProgram(),a.Vertex&&e.bindAttribLocation(this._program,0,"Vertex"),e.attachShader(this._program,this._vertex.shader),e.attachShader(this._program,this._fragment.shader),i.timeStamp("osgjs.metrics:linkShader"),e.linkProgram(this._program),!e.getProgramParameter(this._program,e.LINK_STATUS)&&!e.isContextLost())){var s=e.getProgramInfoLog(this._program);n.errorFold(s,"can't link program\nvertex shader:\n"+this._vertex.text+"\n fragment shader:\n"+this._fragment.text);var o=void 0!==e.rawgl?e.rawgl:e;void 0!==o&&void 0!==o.getExtension&&(o=o.getExtension("WEBGL_debug_shaders")),o&&"Failed to create D3D shaders.\n"===s&&(n.error(o.getTranslatedShaderSource(this._vertex.shader)),n.error(o.getTranslatedShaderSource(this._fragment.shader))),r=!1}if(!r){var h=e.createProgram();this._vertex.failSafe(e,this._vertex.getText()),this._fragment.failSafe(e,this._fragment.getText()),e.attachShader(h,this._vertex.shader),e.attachShader(h,this._fragment.shader),e.linkProgram(h),e.validateProgram(h),n.warn("FailSafe shader Activated "),this._program=h}this._uniformsCache={},this._attributesCache={},this.cacheUniformList(e,this._vertex.text),this.cacheUniformList(e,this._fragment.text),this.cacheAttributeList(e,window.Object.keys(a)),this._dirty=!1}t.applyProgram(this._program)}},cacheUniformList:function(t,e){var r=e.match(/uniform\s+\w+\s+\w+((\s)?\[(.*?)\])?/g),i=this._uniformsCache;if(null!==r)for(var n=0,a=r.length;n<a;n++){var s=r[n].match(/uniform\s+\w+\s+(\w+)/)[1],o=r[n].match(/uniform\s+\w+\s+(\w+)(\s?\[.*?\])?/)[1],h=t.getUniformLocation(this._program,s);void 0!==h&&null!==h&&void 0===i[o]&&(i[o]=h)}},cacheAttributeList:function(t,e){for(var r=this._attributesCache,i=0,n=e.length;i<n;i++){var a=e[i],s=t.getAttribLocation(this._program,a);s!==-1&&void 0!==s&&void 0===r[a]&&(r[a]=s)}}})),"osg","Program"),t.exports=c},function(t,e,r){"use strict";var i=r(9),n=r(106),a=r(116),s=r(37),o=function(t){if(!t){if(o.instance)return o.instance;o.instance=this}return this.addShaders(n),this.addShaders(a),this};o.prototype={_shadersText:{},_shadersList:{},_globalDefaultprecision:"#ifdef GL_FRAGMENT_PRECISION_HIGH\n precision highp float;\n #else\n precision mediump float;\n#endif",_debugLines:!1,_includeR:/#pragma include "([^"]+)"/g,_includeCondR:/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,_defineR:/\#define\s+([a-zA-Z_0-9]+)/,_precisionR:/precision\s+(high|low|medium)p\s+float/,addShaders:function(t){for(var e in t)this._shadersList[e]=e,this._shadersText[e]=t[e]},instrumentShaderlines:function(t,e){return"\n#line 0 "+e+"\n"+t},getShaderTextPure:function(t){var e=this._shadersText[t];return e||(i.error("shader file/text: "+t+" not registered"),e=""),e},getShader:function(t,e,r,i){var n=this.getShaderTextPure(t);return this.processShader(n,e,r,i)},preprocess:function(t,e,r,i){var n=this;return t.replace(this._includeCondR,function(t,a){var s=a.split(" "),o=s[0].replace(/"/g,"");if(s.length>1&&i){for(var h=!1,u=i.map(function(t){return n._defineR.test(t)&&t.replace(/\s+/g," ").split(" ")[1]}),c=1;c<s.length&&!h;c++)for(var l=s[c].replace(/"/g,""),d=0;d<u.length&&!h;d++)if(u[d]!==!1&&u[d]===l){h=!0;break}if(!h)return""}if(r.indexOf(o)!==-1)return"";var _=this.getShaderTextPure(o);return r.push(o),this._debugLines&&(_=this.instrumentShaderlines(_,e)),e++,_=this.preprocess(_,e,r,i)}.bind(this))},_getSortedUnique:function(){var t=function(t,e,r){return!e||t!==r[e-1]};return function(e){return e&&e.sort().filter(t)}}(),_convertExtensionsToWebGL2:function(){var t=function(t,e){return"core_"+e},e=function(t,e){return"#define "+e},r="(GL_EXT_shader_texture_lod|GL_OES_standard_derivatives|GL_EXT_draw_buffers|GL_EXT_frag_depth)",i=new RegExp("#\\s*extension\\s+"+r+".*","g"),n=new RegExp(r,"g");return function(r){return r=r.replace(i,e),r=r.replace(n,t)}}(),_convertToWebGL2:function(){var t=[],e=function(e,r){var i="glFragData_"+r;return t[r]="layout(location = "+r+") out vec4 "+i+";",i};return function(r,i){return r?(r=r.replace(/attribute\s+/g,"in "),r=r.replace(/varying\s+/g,i?"in ":"out "),r=r.replace(/(texture2D|textureCube)\s*\(/g,"texture("),r=r.replace(/(textureCubeLodEXT)\s*\(/g,"textureLod("),r=this._convertExtensionsToWebGL2(r),i&&(t.length=0,r=r.replace(/gl_FragData\s*\[\s*(\d+)\s*\]/g,e),t.length||t.push("out vec4 glFragColor_0;"),r=r.replace(/gl_FragColor/g,"glFragColor_0"),r=r.replace(/void\s+main\s*\(/g,t.join("\n")+"\nvoid main(")),r):r}}(),_hasVersion:function(t){var e=t.match(/^#(.*)$/m);return e&&e[0].indexOf("version")!==-1},processShader:function(t,e,r,i){if(this._hasVersion(t))return t;var n=[],a=t,o=0;this._debugLines&&(a=this.instrumentShaderlines(a,o),o++),e=this._getSortedUnique(e),r=this._getSortedUnique(r);var h=this.preprocess(a,o,n,e,i);h=h.replace(/#pragma DECLARE_FUNCTION/g,"//#pragma DECLARE_FUNCTION");var u=h.indexOf("gl_Position")===-1,c=s.instance().isWebGL2(),l=c?"#version 300 es":"#version 100";l+="\n";var d=r?r.join("\n")+"\n":"",_=e?e.join("\n")+"\n":"";c?(d=this._convertExtensionsToWebGL2(d),_=this._convertToWebGL2(_,u),h=this._convertToWebGL2(h,u)):(_=_.replace(/\\\n/g,""),h=h.replace(/\\\n/g,""));var f="";return this._globalDefaultprecision&&!this._precisionR.test(h)&&(f=this._globalDefaultprecision+"\n"),l+d+f+_+h}},t.exports=o},function(t,e,r){"use strict";var i=r(107),n=r(108),a=r(109),s=r(110),o=r(111),h=r(112),u=r(113),c=r(114),l=r(115);t.exports={"common.glsl":i,"functions.glsl":n,"lightCommon.glsl":a,"lights.glsl":s,"skinning.glsl":o,"morphing.glsl":h,"textures.glsl":u,"colorEncode.glsl":c,"billboard.glsl":l}},function(t,e){t.exports="#define PI 3.141593\r\n#define saturate(_x) clamp(_x, 0., 1.)\r\n"},function(t,e){t.exports="// approximation such as http://chilliant.blogspot.fr/2012/08/srgb-approximations-for-hlsl.html\r\n// introduced slightly darker colors and more slight banding in the darks.\r\n\r\n// so we stick with the reference implementation (except we don't check if color >= 0.0):\r\n// https://www.khronos.org/registry/gles/extensions/EXT/EXT_sRGB.txt\r\n#define LIN_SRGB(x) x < 0.0031308 ? x * 12.92 : 1.055 * pow(x, 1.0/2.4) - 0.055\r\n#define SRGB_LIN(x) x < 0.04045 ? x * (1.0 / 12.92) : pow((x + 0.055) * (1.0 / 1.055), 2.4)\r\n\r\n#pragma DECLARE_FUNCTION\r\nfloat linearTosRGB(const in float color) { return LIN_SRGB(color); }\r\n\r\n#pragma DECLARE_FUNCTION\r\nvec3 linearTosRGB(const in vec3 color) { return vec3(LIN_SRGB(color.r), LIN_SRGB(color.g), LIN_SRGB(color.b)); }\r\n\r\n#pragma DECLARE_FUNCTION\r\nvec4 linearTosRGB(const in vec4 color) { return vec4(LIN_SRGB(color.r), LIN_SRGB(color.g), LIN_SRGB(color.b), color.a); }\r\n\r\n#pragma DECLARE_FUNCTION NODE_NAME:sRGBToLinear\r\nfloat sRGBToLinear(const in float color) { return SRGB_LIN(color); }\r\n\r\n#pragma DECLARE_FUNCTION NODE_NAME:sRGBToLinear\r\nvec3 sRGBToLinear(const in vec3 color) { return vec3(SRGB_LIN(color.r), SRGB_LIN(color.g), SRGB_LIN(color.b)); }\r\n\r\n#pragma DECLARE_FUNCTION NODE_NAME:sRGBToLinear\r\nvec4 sRGBToLinear(const in vec4 color) { return vec4(SRGB_LIN(color.r), SRGB_LIN(color.g), SRGB_LIN(color.b), color.a); }\r\n\r\n//http://graphicrants.blogspot.fr/2009/04/rgbm-color-encoding.html\r\nvec3 RGBMToRGB( const in vec4 rgba ) {\r\n    const float maxRange = 8.0;\r\n    return rgba.rgb * maxRange * rgba.a;\r\n}\r\n\r\nconst mat3 LUVInverse = mat3( 6.0013, -2.700, -1.7995, -1.332, 3.1029, -5.7720, 0.3007, -1.088, 5.6268 );\r\n\r\nvec3 LUVToRGB( const in vec4 vLogLuv ) {\r\n    float Le = vLogLuv.z * 255.0 + vLogLuv.w;\r\n    vec3 Xp_Y_XYZp;\r\n    Xp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\r\n    Xp_Y_XYZp.z = Xp_Y_XYZp.y / vLogLuv.y;\r\n    Xp_Y_XYZp.x = vLogLuv.x * Xp_Y_XYZp.z;\r\n    vec3 vRGB = LUVInverse * Xp_Y_XYZp;\r\n    return max(vRGB, 0.0);\r\n}\r\n\r\n// http://graphicrants.blogspot.fr/2009/04/rgbm-color-encoding.html\r\n#pragma DECLARE_FUNCTION\r\nvec4 encodeRGBM(const in vec3 color, const in float range) {\r\n    if(range <= 0.0) return vec4(color, 1.0);\r\n    vec4 rgbm;\r\n    vec3 col = color / range;\r\n    rgbm.a = clamp( max( max( col.r, col.g ), max( col.b, 1e-6 ) ), 0.0, 1.0 );\r\n    rgbm.a = ceil( rgbm.a * 255.0 ) / 255.0;\r\n    rgbm.rgb = col / rgbm.a;\r\n    return rgbm;\r\n}\r\n\r\n#pragma DECLARE_FUNCTION\r\nvec3 decodeRGBM(const in vec4 color, const in float range) {\r\n    if(range <= 0.0) return color.rgb;\r\n    return range * color.rgb * color.a;\r\n}\r\n\r\n// https://twitter.com/pyalot/status/711956736639418369\r\n// https://github.com/mrdoob/three.js/issues/10331\r\n#pragma DECLARE_FUNCTION NODE_NAME:FrontNormal\r\n#define _frontNormal(normal) gl_FrontFacing ? normal : -normal\r\n\r\n#pragma DECLARE_FUNCTION NODE_NAME:Normalize\r\n#define _normalize(vec) normalize(vec)\r\n\r\n#pragma DECLARE_FUNCTION\r\nvec4 preMultAlpha(const in vec3 color, const in float alpha) { return vec4(color.rgb * alpha, alpha); }\r\n\r\n#pragma DECLARE_FUNCTION\r\nvec4 preMultAlpha(const in vec4 color) { return vec4(color.rgb * color.a, color.a); }\r\n\r\n#pragma DECLARE_FUNCTION\r\nvec4 setAlpha(const in vec3 color, const in float alpha) { return vec4(color, alpha); }\r\n\r\n#pragma DECLARE_FUNCTION\r\nvec4 setAlpha(const in vec3 color, const in vec4 alpha) { return vec4(color, alpha.a); }\r\n"},function(t,e){t.exports="float getLightAttenuation(const in float dist, const in vec4 lightAttenuation) {\r\n    // lightAttenuation(constantEnabled, linearEnabled, quadraticEnabled)\r\n    // TODO find a vector alu instead of 4 scalar\r\n    float constant = lightAttenuation.x;\r\n    float linear = lightAttenuation.y * dist;\r\n    float quadratic = lightAttenuation.z * dist * dist;\r\n    return 1.0 / (constant + linear + quadratic);\r\n}\r\n\r\n#pragma DECLARE_FUNCTION\r\nvoid precomputeSpot(\r\n        const in vec3 normal,\r\n        const in vec3 viewVertex,\r\n                          \r\n        const in vec3 lightViewDirection,\r\n        const in vec4 lightAttenuation,\r\n        const in vec3 lightViewPosition,\r\n        const in float lightSpotCutOff,\r\n        const in float lightSpotBlend,\r\n                          \r\n        out float attenuation,\r\n        out vec3 eyeLightDir,\r\n        out float dotNL) {\r\n\r\n    eyeLightDir = lightViewPosition - viewVertex;\r\n    float dist = length(eyeLightDir);\r\n    eyeLightDir = dist > 0.0 ? eyeLightDir / dist : vec3( 0.0, 1.0, 0.0 );\r\n\r\n    float cosCurAngle = dot(-eyeLightDir, lightViewDirection);\r\n    float spot = cosCurAngle * smoothstep(0.0, 1.0, (cosCurAngle - lightSpotCutOff) / lightSpotBlend);\r\n\r\n    dotNL = dot(eyeLightDir, normal);\r\n    attenuation = spot * getLightAttenuation(dist, lightAttenuation);\r\n}\r\n\r\n#pragma DECLARE_FUNCTION\r\nvoid precomputePoint(\r\n        const in vec3 normal,\r\n        const in vec3 viewVertex,\r\n\r\n        const in vec4 lightAttenuation,\r\n        const in vec3 lightViewPosition,\r\n\r\n        out float attenuation,\r\n        out vec3 eyeLightDir,\r\n        out float dotNL) {\r\n\r\n    eyeLightDir = lightViewPosition - viewVertex;\r\n    float dist = length(eyeLightDir);\r\n\r\n    attenuation = getLightAttenuation(dist, lightAttenuation);\r\n    eyeLightDir = dist > 0.0 ? eyeLightDir / dist :  vec3( 0.0, 1.0, 0.0 );\r\n    dotNL = dot(eyeLightDir, normal);\r\n}\r\n\r\n#pragma DECLARE_FUNCTION\r\nvoid precomputeSun(\r\n        const in vec3 normal,\r\n        const in vec3 lightViewDirection,\r\n  \r\n        out float attenuation,\r\n        out vec3 eyeLightDir,\r\n        out float dotNL) {\r\n\r\n    attenuation = 1.0;\r\n    eyeLightDir = -lightViewDirection;\r\n    dotNL = dot(eyeLightDir, normal);\r\n}"},function(t,e){t.exports='#pragma include "lightCommon.glsl"\r\n\r\n////////////////\r\n// COOK TORRANCE\r\n////////////////\r\nvec3 specularCookTorrance(\r\n        const in vec3 normal,\r\n        const in vec3 lightDir,\r\n        const in vec3 eyeVector,\r\n        const in float materialShininess,\r\n        const in vec3 materialSpecular,\r\n        const in vec3 lightSpecular) {\r\n  \r\n    vec3 h = normalize(eyeVector + lightDir);\r\n    float nh = dot(normal, h);\r\n    float specfac = 0.0;\r\n\r\n    if(nh > 0.0) {\r\n        float nv = max( dot(normal, eyeVector), 0.0 );\r\n        float i = pow(nh, materialShininess);\r\n        i = i / (0.1 + nv);\r\n        specfac = i;\r\n    }\r\n    // ugly way to fake an energy conservation (mainly to avoid super bright stuffs with low glossiness)\r\n    float att = materialShininess > 100.0 ? 1.0 : smoothstep(0.0, 1.0, materialShininess * 0.01);\r\n    return specfac * materialSpecular * lightSpecular * att;\r\n}\r\n\r\nvec3 lambert(const in float dotNL,  const in vec3 materialDiffuse, const in vec3 lightDiffuse) {\r\n    return dotNL * materialDiffuse * lightDiffuse;\r\n}\r\n\r\n#pragma DECLARE_FUNCTION\r\nvoid computeLightLambertCookTorrance(\r\n        const in vec3 normal,\r\n        const in vec3 eyeVector,\r\n        const in float dotNL,\r\n        const in float attenuation,\r\n\r\n        const in vec3 materialDiffuse,\r\n        const in vec3 materialSpecular,\r\n        const in float materialShininess,\r\n\r\n        const in vec3 lightDiffuse,\r\n        const in vec3 lightSpecular,\r\n        const in vec3 eyeLightDir,\r\n\r\n        out vec3 diffuseOut,\r\n        out vec3 specularOut,\r\n        out bool lighted) {\r\n\r\n    lighted = dotNL > 0.0;\r\n    if (lighted == false) {\r\n        specularOut = diffuseOut = vec3(0.0);\r\n        return;\r\n    }\r\n\r\n    specularOut = attenuation * specularCookTorrance(normal, eyeLightDir, eyeVector, materialShininess, materialSpecular, lightSpecular);\r\n    diffuseOut = attenuation * lambert(dotNL, materialDiffuse, lightDiffuse);\r\n}\r\n\r\n///////\r\n// HEMI\r\n///////\r\n#pragma DECLARE_FUNCTION\r\nvoid hemiLight(\r\n        const in vec3 normal,\r\n        const in vec3 eyeVector,\r\n        const in float dotNL,\r\n        const in float eyeLightDir,\r\n\r\n        const in vec3 materialDiffuse,\r\n        const in vec3 materialSpecular,\r\n        const in float materialShininess,\r\n\r\n        const in vec3 lightDiffuse,\r\n        const in vec3 lightGround,\r\n\r\n        out vec3 diffuseOut,\r\n        out vec3 specularOut,\r\n        out bool lighted) {\r\n\r\n    lighted = false;\r\n    float weight = 0.5 * dotNL + 0.5;\r\n    diffuseOut = materialDiffuse * mix(lightGround, lightDiffuse, weight);\r\n\r\n    // same cook-torrance as above for sky/ground\r\n    float skyWeight = 0.5 * dot(normal, normalize(eyeVector + eyeLightDir)) + 0.5;\r\n    float gndWeight = 0.5 * dot(normal, normalize(eyeVector - eyeLightDir)) + 0.5;\r\n    float skySpec = pow(skyWeight, materialShininess);\r\n    float skyGround = pow(gndWeight, materialShininess);\r\n    float divisor = (0.1 + max( dot(normal, eyeVector), 0.0 ));\r\n    float att = materialShininess > 100.0 ? 1.0 : smoothstep(0.0, 1.0, materialShininess * 0.01);\r\n    \r\n    specularOut = lightDiffuse * materialSpecular * weight * att * (skySpec + skyGround) / divisor;\r\n}\r\n'},function(t,e){t.exports="//////////////////////////////\r\n// OPTIMIZED VERSION (NO IF)\r\n//////////////////////////////\r\n#pragma DECLARE_FUNCTION\r\nmat4 skinning( const in vec4 weights, const in vec4 bonesIndex ) {\r\n    mat4 outMat_1;\r\n    mat4 tmpMat_2;\r\n    highp ivec4 tmpvar_3;\r\n    tmpvar_3 = (3 * ivec4(bonesIndex));\r\n    tmpMat_2 = mat4(1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0);\r\n    vec4 tmpvar_4;\r\n    tmpvar_4 = -(abs(weights));\r\n    tmpMat_2[0] = uBones[tmpvar_3.x];\r\n    tmpMat_2[1] = uBones[(tmpvar_3.x + 1)];\r\n    tmpMat_2[2] = uBones[(tmpvar_3.x + 2)];\r\n    outMat_1 = ((float(\r\n    ((tmpvar_4.x + tmpvar_4.y) >= -((tmpvar_4.z + tmpvar_4.w)))\r\n    ) * mat4(1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0)) + (weights.x * tmpMat_2));\r\n    tmpMat_2[0] = uBones[tmpvar_3.y];\r\n    tmpMat_2[1] = uBones[(tmpvar_3.y + 1)];\r\n    tmpMat_2[2] = uBones[(tmpvar_3.y + 2)];\r\n    outMat_1 = (outMat_1 + (weights.y * tmpMat_2));\r\n    tmpMat_2[0] = uBones[tmpvar_3.z];\r\n    tmpMat_2[1] = uBones[(tmpvar_3.z + 1)];\r\n    tmpMat_2[2] = uBones[(tmpvar_3.z + 2)];\r\n    outMat_1 = (outMat_1 + (weights.z * tmpMat_2));\r\n    tmpMat_2[0] = uBones[tmpvar_3.w];\r\n    tmpMat_2[1] = uBones[(tmpvar_3.w + 1)];\r\n    tmpMat_2[2] = uBones[(tmpvar_3.w + 2)];\r\n    outMat_1 = (outMat_1 + (weights.w * tmpMat_2));\r\n\r\n    return outMat_1;\r\n}\r\n\r\n//////////////////////////////\r\n// UN-OPTIMIZED VERSION (WITH IF)\r\n//////////////////////////////\r\n\r\n// //http://http.developer.nvidia.com/GPUGems/gpugems_ch04.html\r\n// mat4 getMat4FromVec4( const int index, inout mat4 myMat ) {\r\n//     // We have to use a global variable because we can't access dynamically\r\n//     // matrix is transpose so we should do vec * matrix\r\n//     myMat[0] = uBones[ index ];\r\n//     myMat[1] = uBones[ index + 1];\r\n//     myMat[2] = uBones[ index + 2];\r\n//     return myMat;\r\n// }\r\n\r\n// mat4 skinning( const in vec4 weights, const in vec4 bonesIndex ) {\r\n//     ivec4 idx =  3 * ivec4(bonesIndex);\r\n//     mat4 tmpMat = mat4(1.0);\r\n//     mat4 outMat = mat4(0.0);\r\n\r\n//     // we handle negative weights\r\n//     if(all(equal(weights, vec4(0.0)))) return tmpMat;\r\n\r\n//     if(weights.x != 0.0) outMat += weights.x * getMat4FromVec4( idx.x, tmpMat );\r\n//     if(weights.y != 0.0) outMat += weights.y * getMat4FromVec4( idx.y, tmpMat );\r\n//     if(weights.z != 0.0) outMat += weights.z * getMat4FromVec4( idx.z, tmpMat );\r\n//     if(weights.w != 0.0) outMat += weights.w * getMat4FromVec4( idx.w, tmpMat );\r\n//     return outMat;\r\n// }\r\n\r\n//////////////////////////////\r\n// UN-OPTIMIZED VERSION (NO IF)\r\n//////////////////////////////\r\n\r\n// mat4 skinning( const in vec4 weights, const in vec4 bonesIndex ) {\r\n//     ivec4 idx =  3 * ivec4(bonesIndex);\r\n//     mat4 tmpMat = mat4(1.0);\r\n\r\n//     // if sum is 0, return identity\r\n//     vec4 absWeights = -abs(weights);\r\n//     mat4 outMat = step(0.0, absWeights.x + absWeights.y + absWeights.z + absWeights.w) * tmpMat;\r\n\r\n//     // we handle negative weights\r\n//     // outMat[3][3] += weights.x + weights.y + weights.z + weights.w;\r\n\r\n//     tmpMat[0] = uBones[ idx.x ];\r\n//     tmpMat[1] = uBones[ idx.x + 1];\r\n//     tmpMat[2] = uBones[ idx.x + 2];\r\n//     outMat += weights.x * tmpMat;\r\n\r\n//     tmpMat[0] = uBones[ idx.y ];\r\n//     tmpMat[1] = uBones[ idx.y + 1];\r\n//     tmpMat[2] = uBones[ idx.y + 2];\r\n//     outMat += weights.y * tmpMat;\r\n\r\n//     tmpMat[0] = uBones[ idx.z ];\r\n//     tmpMat[1] = uBones[ idx.z + 1];\r\n//     tmpMat[2] = uBones[ idx.z + 2];\r\n//     outMat += weights.z * tmpMat;\r\n\r\n//     tmpMat[0] = uBones[ idx.w ];\r\n//     tmpMat[1] = uBones[ idx.w + 1];\r\n//     tmpMat[2] = uBones[ idx.w + 2];\r\n//     outMat += weights.w * tmpMat;\r\n\r\n//     return outMat;\r\n// }\r\n"},function(t,e){t.exports="#pragma DECLARE_FUNCTION\r\nvec3 morphing(\r\n        const in vec4 weights,\r\n        const in vec3 vertex,\r\n        const in vec3 target0) {\r\n\r\n    return mix(vertex, target0, weights[0]);\r\n}\r\n\r\n#pragma DECLARE_FUNCTION\r\nvec3 morphing(\r\n        const in vec4 weights,\r\n        const in vec3 vertex,\r\n        const in vec3 target0,\r\n        const in vec3 target1) {\r\n\r\n    vec3 vecOut = vertex * (1.0 - ( weights[0] + weights[1]));\r\n    vecOut += target0 * weights[0];\r\n    vecOut += target1 * weights[1];\r\n    return vecOut;\r\n}\r\n\r\n#pragma DECLARE_FUNCTION\r\nvec3 morphing(\r\n        const in vec4 weights,\r\n        const in vec3 vertex,\r\n        const in vec3 target0,\r\n        const in vec3 target1,\r\n        const in vec3 target2) {\r\n  \r\n    vec3 vecOut = vertex * (1.0 - ( weights[0] + weights[1] + weights[2]));\r\n    vecOut += target0 * weights[0];\r\n    vecOut += target1 * weights[1];\r\n    vecOut += target2 * weights[2];\r\n    return vecOut;\r\n}\r\n\r\n#pragma DECLARE_FUNCTION\r\nvec3 morphing(\r\n        const in vec4 weights,\r\n        const in vec3 vertex,\r\n        const in vec3 target0,\r\n        const in vec3 target1,\r\n        const in vec3 target2,\r\n        const in vec3 target3) {\r\n\r\n    vec3 vecOut = vertex * (1.0 - ( weights[0] + weights[1] + weights[2] + weights[3]));\r\n    vecOut += target0 * weights[0];\r\n    vecOut += target1 * weights[1];\r\n    vecOut += target2 * weights[2];\r\n    vecOut += target3 * weights[3];\r\n    return vecOut;\r\n}\r\n"},function(t,e){t.exports="#pragma DECLARE_FUNCTION\r\nvec3 textureRGB(const in sampler2D tex, const in vec2 uv) {\r\n    return texture2D(tex, uv.xy).rgb;\r\n}\r\n\r\n#pragma DECLARE_FUNCTION\r\nvec4 textureRGBA(const in sampler2D tex, const in vec2 uv) {\r\n    return texture2D(tex, uv.xy).rgba;\r\n}\r\n\r\n#pragma DECLARE_FUNCTION\r\nfloat textureIntensity(const in sampler2D tex, const in vec2 uv) {\r\n    return texture2D(tex, uv).r;\r\n}\r\n\r\n#pragma DECLARE_FUNCTION\r\nfloat textureAlpha(const in sampler2D tex, const in vec2 uv) {\r\n    return texture2D(tex, uv.xy).a;\r\n}\r\n"},function(t,e){t.exports="\r\nfloat decodeFloatRGBA( vec4 rgba ) {\r\n    return dot( rgba, vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/16581375.0) );\r\n}\r\n\r\nvec4 encodeFloatRGBA( float v ) {\r\n    vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * v;\r\n    enc = fract(enc);\r\n    enc -= enc.yzww * vec4(1.0/255.0,1.0/255.0,1.0/255.0,0.0);\r\n    return enc;\r\n}\r\n\r\nvec2 decodeHalfFloatRGBA( vec4 rgba ) {\r\n    return vec2(rgba.x + (rgba.y / 255.0), rgba.z + (rgba.w / 255.0));\r\n}\r\n\r\nvec4 encodeHalfFloatRGBA( vec2 v ) {\r\n    const vec2 bias = vec2(1.0 / 255.0, 0.0);\r\n    vec4 enc;\r\n    enc.xy = vec2(v.x, fract(v.x * 255.0));\r\n    enc.xy = enc.xy - (enc.yy * bias);\r\n\r\n    enc.zw = vec2(v.y, fract(v.y * 255.0));\r\n    enc.zw = enc.zw - (enc.ww * bias);\r\n    return enc;\r\n}\r\n"},function(t,e){t.exports="vec3 getScale( const in mat4 matrix ) {\r\n      // Only working with positive scales.\r\n      float xs = matrix[0][0] * matrix[0][1] * matrix[0][2] * matrix[0][3] < 0. ? -1. : 1.;\r\n      float ys = matrix[1][0] * matrix[1][1] * matrix[1][2] * matrix[1][3] < 0. ? -1. : 1.;\r\n      float zs = matrix[2][0] * matrix[2][1] * matrix[2][2] * matrix[2][3] < 0. ? -1. : 1.;\r\n      vec3 scale;\r\n      scale.x = xs * sqrt( matrix[0][0] * matrix[0][0] + matrix[0][1] * matrix[0][1] + matrix[0][2] * matrix[0][2]);\r\n      scale.y = ys * sqrt( matrix[1][0] * matrix[1][0] + matrix[1][1] * matrix[1][1] + matrix[1][2] * matrix[1][2]);\r\n      scale.z = zs * sqrt( matrix[2][0] * matrix[2][0] + matrix[2][1] * matrix[2][1] + matrix[2][2] * matrix[2][2]);\r\n      return scale;\r\n}\r\n\r\n#pragma DECLARE_FUNCTION\r\nvec4 billboard( const in vec3 vertex, const in mat4 modelViewMatrix, const in mat4 projectionMatrix ) {\r\n      vec3 scale = getScale( modelViewMatrix );\r\n      return projectionMatrix * ( vec4( scale.x* vertex.x , scale.y * vertex.y, scale.z * vertex.z, 1.0 ) + vec4( modelViewMatrix[ 3 ].xyz, 0.0 ) );\r\n}\r\n"},function(t,e,r){"use strict";var i=r(117),n=r(118),a=r(119),s=r(120),o=r(121);t.exports={"shadowCast.glsl":i,"shadowReceive.glsl":n,"shadowLinearSoft.glsl":a,"floatFromTex.glsl":s,"tapPCF.glsl":o}},function(t,e){t.exports='#pragma include "colorEncode.glsl"\r\n\r\n#pragma DECLARE_FUNCTION\r\nvec4 shadowCast(const in vec4 fragEye, const in vec4 shadowDepthRange){\r\n    // distance to camera (we make sure we are near 0 and in [0,1])\r\n    float depth = (-fragEye.z * fragEye.w - shadowDepthRange.x) * shadowDepthRange.w;\r\n\r\n#ifdef _FLOATTEX \r\n    return vec4(depth, 0.0, 0.0, 1.0);\r\n#else\r\n    return encodeFloatRGBA(depth);\r\n#endif\r\n}\r\n'},function(t,e){t.exports="#pragma include \"tapPCF.glsl\"\r\n\r\n#ifdef _ATLAS_SHADOW\r\n#define OPT_ARG_atlasSize ,const in vec4 atlasSize\r\n#else\r\n#define OPT_ARG_atlasSize\r\n#endif\r\n\r\n#ifdef _NORMAL_OFFSET\r\n#define OPT_ARG_normalBias ,const in float normalBias\r\n#else\r\n#define OPT_ARG_normalBias\r\n#endif\r\n\r\n#pragma DECLARE_FUNCTION DERIVATIVES:enable\r\nfloat shadowReceive(const in bool lighted,\r\n                    const in vec3 normalWorld,\r\n                    const in vec3 vertexWorld,                    \r\n                    const in sampler2D shadowTexture,\r\n                    const in vec4 shadowSize,\r\n                    const in mat4 shadowProjectionMatrix,\r\n                    const in mat4 shadowViewMatrix,\r\n                    const in vec4 shadowDepthRange,\r\n                    const in float shadowBias\r\n                    OPT_ARG_atlasSize\r\n                    OPT_ARG_normalBias\r\n                    OPT_ARG_outDistance) {\r\n\r\n    // 0 for early out\r\n    bool earlyOut = false;\r\n\r\n    // Calculate shadow amount\r\n    float shadow = 1.0;\r\n\r\n    if (!lighted) {\r\n        shadow = 0.0;\r\n#ifndef _OUT_DISTANCE\r\n        earlyOut = true;\r\n#endif // _OUT_DISTANCE\r\n    }\r\n\r\n    if (shadowDepthRange.x == shadowDepthRange.y) {\r\n        earlyOut = true;\r\n    }\r\n\r\n    vec4 shadowVertexEye;\r\n    vec4 shadowNormalEye;\r\n    float shadowReceiverZ = 0.0;\r\n    vec4 shadowVertexProjected;\r\n    vec2 shadowUV;\r\n    float N_Dot_L;\r\n\r\n    if (!earlyOut) {\r\n\r\n        shadowVertexEye =  shadowViewMatrix *  vec4(vertexWorld, 1.0);\r\n\r\n        vec3 shadowLightDir = vec3(0.0, 0.0, 1.0); // in shadow view light is camera\r\n        vec4 normalFront = vec4(normalWorld, 0.0);\r\n        shadowNormalEye =  shadowViewMatrix * normalFront;\r\n        N_Dot_L = dot(shadowNormalEye.xyz, shadowLightDir);\r\n\r\n        if (!earlyOut) {\r\n\r\n#ifdef _NORMAL_OFFSET\r\n            // http://www.dissidentlogic.com/old/images/NormalOffsetShadows/GDC_Poster_NormalOffset.png\r\n            float normalOffsetScale = clamp(1.0  - N_Dot_L, 0.0 , 1.0);\r\n            normalOffsetScale *= abs((shadowVertexEye.z - shadowDepthRange.x) * shadowDepthRange.w);\r\n            normalOffsetScale *= max(shadowProjectionMatrix[0][0], shadowProjectionMatrix[1][1]);\r\n            normalOffsetScale *= normalBias * shadowDepthRange.w;\r\n            shadowNormalEye =  shadowViewMatrix *  (normalFront * normalOffsetScale);\r\n            shadowVertexProjected = shadowProjectionMatrix * (shadowVertexEye + shadowNormalEye);\r\n#else\r\n            shadowVertexProjected = shadowProjectionMatrix * shadowVertexEye;\r\n#endif\r\n\r\n            if (shadowVertexProjected.w < 0.0) {\r\n                earlyOut = true; // notably behind camera\r\n            }\r\n\r\n        }\r\n\r\n        if (!earlyOut) {\r\n\r\n            shadowUV.xy = shadowVertexProjected.xy / shadowVertexProjected.w;\r\n            shadowUV.xy = shadowUV.xy * 0.5 + 0.5;// mad like\r\n\r\n            if (any(bvec4 ( shadowUV.x > 1., shadowUV.x < 0., shadowUV.y > 1., shadowUV.y < 0.))) {\r\n                earlyOut = true;// limits of light frustum\r\n            }\r\n\r\n            // most precision near 0, make sure we are near 0 and in [0,1]\r\n            shadowReceiverZ = - shadowVertexEye.z;\r\n            shadowReceiverZ =  (shadowReceiverZ - shadowDepthRange.x) * shadowDepthRange.w;\r\n\r\n            if(shadowReceiverZ < 0.0) {\r\n                earlyOut = true; // notably behind camera\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    // pcf pbias to add on offset\r\n    vec2 shadowBiasPCF = vec2 (0.);\r\n\r\n#ifdef GL_OES_standard_derivatives\r\n#ifdef _RECEIVERPLANEDEPTHBIAS\r\n    vec2 biasUV;\r\n\r\n    vec3 texCoordDY = dFdx(shadowVertexEye.xyz);\r\n    vec3 texCoordDX = dFdy(shadowVertexEye.xyz);\r\n\r\n    biasUV.x = texCoordDY.y * texCoordDX.z - texCoordDX.y * texCoordDY.z;\r\n    biasUV.y = texCoordDX.x * texCoordDY.z - texCoordDY.x * texCoordDX.z;\r\n    biasUV *= 1.0 / ((texCoordDX.x * texCoordDY.y) - (texCoordDX.y * texCoordDY.x));\r\n\r\n    // Static depth biasing to make up for incorrect fractional sampling on the shadow map grid\r\n    float fractionalSamplingError = dot(vec2(1.0, 1.0) * shadowSize.zw, abs(biasUV));\r\n    float receiverDepthBias = min(fractionalSamplingError, 0.01);\r\n\r\n    shadowBiasPCF.x = biasUV.x;\r\n    shadowBiasPCF.y = biasUV.y;\r\n\r\n    shadowReceiverZ += receiverDepthBias;\r\n\r\n#else // _RECEIVERPLANEDEPTHBIAS\r\n    shadowBiasPCF.x = clamp(dFdx(shadowReceiverZ)* shadowSize.z, -1.0, 1.0 );\r\n    shadowBiasPCF.y = clamp(dFdy(shadowReceiverZ)* shadowSize.w, -1.0, 1.0 );\r\n#endif\r\n\r\n#endif // GL_OES_standard_derivatives\r\n\r\n\r\n    vec4 clampDimension;\r\n\r\n#ifdef _ATLAS_SHADOW\r\n    shadowUV.xy  = ((shadowUV.xy * atlasSize.zw ) + atlasSize.xy) / shadowSize.xy;\r\n\r\n    // clamp uv bias/filters by half pixel to avoid point filter on border\r\n    clampDimension.xy = atlasSize.xy + vec2(0.5);\r\n    clampDimension.zw = (atlasSize.xy + atlasSize.zw) - vec2(0.5);\r\n\r\n    clampDimension = clampDimension / (shadowSize.xyxy);\r\n#else\r\n    clampDimension = vec4(0.0, 0.0, 1.0, 1.0);\r\n#endif // _RECEIVERPLANEDEPTHBIAS\r\n\r\n\r\n    // now that derivatives is done and we don't access any mipmapped/texgrad texture we can early out\r\n    // see http://teknicool.tumblr.com/post/77263472964/glsl-dynamic-branching-and-texture-samplers\r\n    if (earlyOut) {\r\n        // empty statement because of weird gpu intel bug\r\n    } else {\r\n\r\n        // depth bias: fighting shadow acne (depth imprecsion z-fighting)\r\n        // cosTheta is dot( n, l ), clamped between 0 and 1\r\n        // float shadowBias = 0.005*tan(acos(N_Dot_L));\r\n        // same but 4 cycles instead of 15\r\n        float depthBias = 0.05 * sqrt( 1.0 - N_Dot_L * N_Dot_L) / clamp(N_Dot_L, 0.0005, 1.0);\r\n\r\n        // That makes sure that plane perpendicular to light doesn't flicker due to\r\n        // selfshadowing and 1 = dot(Normal, Light) using a min bias\r\n        depthBias = clamp(depthBias, 0.00005, 2.0 * shadowBias);\r\n\r\n        // shadowZ must be clamped to [0,1]\r\n        // otherwise it's not comparable to shadow caster depth map\r\n        // which is clamped to [0,1]\r\n        // Not doing that makes ALL shadowReceiver > 1.0 black\r\n        // because they ALL becomes behind any point in Caster depth map\r\n        shadowReceiverZ = clamp(shadowReceiverZ, 0.0, 1.0 -depthBias) - depthBias;\r\n\r\n        // Now computes Shadow\r\n#ifdef _OUT_DISTANCE\r\n        float res = getShadowPCF(shadowTexture, shadowSize, shadowUV, shadowReceiverZ, shadowBiasPCF, clampDimension, outDistance);\r\n        if (lighted) shadow = res; \r\n        outDistance *= shadowDepthRange.z; // world space distance\r\n#else\r\n        shadow = getShadowPCF(shadowTexture, shadowSize, shadowUV, shadowReceiverZ, shadowBiasPCF, clampDimension);\r\n#endif  // _OUT_DISTANCE\r\n    }\r\n\r\n    return shadow;\r\n\r\n}\r\n";
},function(t,e){t.exports='#pragma include "floatFromTex.glsl"\r\n\r\n\r\n#ifdef _OUT_DISTANCE\r\n#define OPT_ARG_outDistance ,out float outDistance\r\n#else\r\n#define OPT_ARG_outDistance\r\n#endif\r\n\r\n// simulation of texture2Dshadow glsl call on HW\r\n// http://codeflow.org/entries/2013/feb/15/soft-shadow-mapping/\r\nfloat texture2DCompare(const in sampler2D depths, const in vec2 uv, const in float compare, const in vec4 clampDimension){\r\n    float depth = getSingleFloatFromTex(depths, clamp(uv, clampDimension.xy, clampDimension.zw));\r\n    return compare - depth;\r\n}\r\n\r\n// simulates linear fetch like texture2d shadow\r\nfloat texture2DShadowLerp(\r\n    const in sampler2D depths,\r\n    const in vec4 size,\r\n    const in vec2 uv,\r\n    const in float compare,\r\n    const in vec4 clampDimension\r\n    OPT_ARG_outDistance){\r\n\r\n    vec2 f = fract(uv * size.xy + 0.5);\r\n    vec2 centroidUV = floor(uv * size.xy + 0.5) * size.zw;\r\n\r\n    vec4 fetches;\r\n    fetches.x = texture2DCompare(depths, centroidUV + size.zw * vec2(0.0, 0.0), compare, clampDimension);\r\n    fetches.y = texture2DCompare(depths, centroidUV + size.zw * vec2(0.0, 1.0), compare, clampDimension);\r\n    fetches.z = texture2DCompare(depths, centroidUV + size.zw * vec2(1.0, 0.0), compare, clampDimension);\r\n    fetches.w = texture2DCompare(depths, centroidUV + size.zw * vec2(1.0, 1.0), compare, clampDimension);\r\n\r\n#ifdef _OUT_DISTANCE\r\n    float _a = mix(fetches.x, fetches.y, f.y);\r\n    float _b = mix(fetches.z, fetches.w, f.y);\r\n    outDistance = mix(_a, _b, f.x);\r\n#endif\r\n\r\n    vec4 st = step(fetches, vec4(0.0));\r\n\r\n    float a = mix(st.x, st.y, f.y);\r\n    float b = mix(st.z, st.w, f.y);\r\n    return mix(a, b, f.x);\r\n}\r\n'},function(t,e){t.exports='#pragma include "colorEncode.glsl"\r\n\r\n// end Float codec\r\nfloat getSingleFloatFromTex(const in sampler2D depths, const in vec2 uv){\r\n#ifndef _FLOATTEX\r\n    return  decodeFloatRGBA(texture2D(depths, uv));\r\n#else\r\n    return texture2D(depths, uv).x;\r\n#endif\r\n}\r\n\r\nvec2 getDoubleFloatFromTex(const in sampler2D depths, const in vec2 uv){\r\n#ifndef _FLOATTEX\r\n    return decodeHalfFloatRGBA(texture2D(depths, uv));\r\n#else\r\n    return texture2D(depths, uv).xy;\r\n#endif\r\n}\r\n\r\nvec4 getQuadFloatFromTex(const in sampler2D depths, const in vec2 uv){\r\n    return texture2D(depths, uv).xyzw;\r\n}\r\n// end Float codec\r\n'},function(t,e){t.exports='#pragma include "shadowLinearSoft.glsl"\r\n\r\nfloat getShadowPCF(\r\n    const in sampler2D depths,\r\n    const in vec4 size,\r\n    const in vec2 uv,\r\n    const in float compare,\r\n    const in vec2 biasPCF,\r\n    const in vec4 clampDimension\r\n    OPT_ARG_outDistance) {\r\n\r\n     float res = 0.0;\r\n\r\n#ifdef _OUT_DISTANCE     \r\n     res += texture2DShadowLerp(depths, size, uv + biasPCF, compare, clampDimension, outDistance);\r\n#else\r\n     res += texture2DShadowLerp(depths, size, uv + biasPCF, compare, clampDimension);\r\n#endif\r\n\r\n#if defined(_PCFx1)\r\n\r\n#else\r\n\r\n    float dx0 = -size.z;\r\n    float dy0 = -size.w;\r\n    float dx1 = size.z;\r\n    float dy1 = size.w;\r\n\r\n#define TSF(o1,o2) texture2DShadowLerp(depths, size, uv + vec2(o1, o2) + biasPCF, compare, clampDimension)\r\n\r\n    res += TSF(dx0, dx0);\r\n    res += TSF(dx0, .0);\r\n    res += TSF(dx0, dx1);\r\n\r\n#if defined(_PCFx4)\r\n\r\n    res /=4.0;\r\n\r\n#elif defined(_PCFx9)\r\n    res += TSF(.0, dx0);\r\n    res += TSF(.0, dx1);\r\n\r\n    res += TSF(dx1, dx0);\r\n    res += TSF(dx1, .0);\r\n    res += TSF(dx1, dx1);\r\n\r\n\r\n    res /=9.0;\r\n\r\n#elif defined(_PCFx25)\r\n\r\n    float dx02 = -2.0*size.z;\r\n    float dy02 = -2.0*size.w;\r\n    float dx2 = 2.0*size.z;\r\n    float dy2 = 2.0*size.w;\r\n\r\n    // complete row above\r\n    res += TSF(dx0, dx02);\r\n    res += TSF(dx0, dx2);\r\n\r\n    res += TSF(.0, dx02);\r\n    res += TSF(.0, dx2);\r\n\r\n    res += TSF(dx1, dx02);\r\n    res += TSF(dx1, dx2);\r\n\r\n    // two new col\r\n    res += TSF(dx02, dx02);\r\n    res += TSF(dx02, dx0);\r\n    res += TSF(dx02, .0);\r\n    res += TSF(dx02, dx1);\r\n    res += TSF(dx02, dx2);\r\n\r\n    res += TSF(dx2, dx02);\r\n    res += TSF(dx2, dx0);\r\n    res += TSF(dx2, .0);\r\n    res += TSF(dx2, dx1);\r\n    res += TSF(dx2, dx2);\r\n\r\n\r\n    res/=25.0;\r\n\r\n#endif\r\n\r\n#undef TSF\r\n\r\n#endif\r\n    return res;\r\n}\r\n/////// end Tap\r\n'},function(t,e,r){"use strict";var i=r(9),n=r(7),a=r(8),s=r(43),o=function(t,e){s.call(this);var r=t;"string"==typeof t&&(r=o[t]),this.type=r,this.setText(e)};o.VERTEX_SHADER=35633,o.FRAGMENT_SHADER=35632;var h="\n#define SHADER_NAME FailSafe";o.VS_DBG="#define _DEBUG 1\n#ifdef _DEBUG\nattribute vec3 Vertex;uniform mat4 uModelViewMatrix;uniform mat4 uProjectionMatrix;void main(void) {  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex, 1.0);}\n",o.FS_DBG="#define _DEBUG 1\n#ifdef _DEBUG\n precision lowp float; void main(void) { gl_FragColor = vec4(1.0, 0.6, 0.6, 1.0);}\n",o._sDeletedGLShaderCache=new window.Map,o.deleteGLShader=function(t,e){o._sDeletedGLShaderCache.has(t)||o._sDeletedGLShaderCache.set(t,[]),o._sDeletedGLShaderCache.get(t).push(e)},o.flushDeletedGLShaders=function(t,e){if(e<=0)return e;if(!o._sDeletedGLShaderCache.has(t))return e;for(var r=0,i=a.instance().tick(),n=o._sDeletedGLShaderCache.get(t),s=n.length,h=s-1;h>=0&&r<e;h--)t.deleteShader(n[h]),n.splice(h,1),r=a.instance().deltaS(i,a.instance().tick());return e-r},o.flushAllDeletedGLShaders=function(t){if(o._sDeletedGLShaderCache.has(t))for(var e=o._sDeletedGLShaderCache.get(t),r=e.length,i=r-1;i>=0;i--)t.deleteShader(e[i]),e.splice(i,1)},o.onLostContext=function(t){if(o._sDeletedGLShaderCache.has(t)){var e=o._sDeletedGLShaderCache.get(t);e.length=0}},n.createPrototypeObject(o,n.objectInherit(s.prototype,{setText:function(t){this.text=t},getText:function(){return this.text},failSafe:function(t,e){this.shader=t.createShader(this.type);var r=e.match(/#define[\s]+SHADER_NAME[\s]+([\S]+)(\n|$)/);r=r?r[1]:"";var i=this.type===o.VERTEX_SHADER?o.VS_DBG:o.FS_DBG;i+=h+r+"\n#else\n"+e+"\n#endif\n",t.shaderSource(this.shader,i),t.compileShader(this.shader)},processErrors:function(t,e){var r=/ERROR: [\d]+:([\d]+): (.+)/gim,n=e.split("\n"),a=n.length;if(0!==a){var s,o;if(null===r.exec(t)&&(r=/Shader compilation errors\n\((\d+)\, \d+\): (.+)/gim),null===r.exec(t))return void i.error(t);for(r.lastIndex=0;null!==(o=r.exec(t));){o.index===r.lastIndex&&r.lastIndex++;var h=parseInt(o[1],10);if(!(h>a)){i.error("ERROR "+o[2]+" in line "+h);var u=Math.max(0,h-7),c=Math.max(0,h-2);for(s=u;s<=c;s++)i.warn(n[s].replace(/^[ \t]+/g,""));for(c=Math.max(0,h-1),i.error(n[c].replace(/^[ \t]+/g,"")),u=Math.min(a,h),c=Math.min(a,h+5),s=u;s<c;s++)i.warn(n[s].replace(/^[ \t]+/g,""))}}}},compile:function(t){this._gl||this.setGraphicContext(t),this.shader=t.createShader(this.type);var e=this.text;if(o.enableGLSLOptimizer&&o.glslOptimizer){var r=this.type===o.VERTEX_SHADER?"vertex":"fragment";i.infoFold(r+" shader before optimization",e);var a=o.glslOptimizer(e,"2",this.type===o.VERTEX_SHADER);a.indexOf("Error:")!==-1?i.error(a):a.length<=1?i.warnFold("glsl optimizer returned an empty shader, the original will be used",e):(i.infoFold(r+" shader after optimization",a),e=a)}if(t.shaderSource(this.shader,e),n.timeStamp("osgjs.metrics:compileShader"),t.compileShader(this.shader),!t.getShaderParameter(this.shader,t.COMPILE_STATUS)&&!t.isContextLost()){var s=t.getShaderInfoLog(this.shader);this.processErrors(s,e);for(var h=e,u=h.split("\n"),c="\n",l=0,d=u.length;l<d;++l)c+=l+" "+u[l]+"\n";return i.errorFold("can't compile shader",c),!1}return!0},releaseGLObjects:function(){void 0!==this._gl&&(o.deleteGLShader(this._gl,this.shader),s.removeObject(this._gl,this)),this.invalidate()},invalidate:function(){this.shader=void 0}}),"osg","Shader"),t.exports=o},function(t,e,r){"use strict";var i=r(15).vec3,n=r(48),a=r(36),s=r(46),o=r(91),h=r(45),u=r(104),c=r(122),l=r(7),d=function(t,e,r,i,o,u){var c,d,_,f=void 0!==t?t:0,g=void 0!==e?e:0,p=void 0!==r?r:0,m=void 0!==i?i:1,v=void 0!==o?o:1,S=void 0!==u?u:1,x=new a;c=m/2,d=v/2,_=S/2;var b=new l.Float32Array(72),y=new l.Float32Array(48),M=new l.Float32Array(72);b[0]=f-c,b[1]=g-d,b[2]=p+_,M[0]=0,M[1]=-1,M[2]=0,y[0]=0,y[1]=1,b[3]=f-c,b[4]=g-d,b[5]=p-_,M[3]=0,M[4]=-1,M[5]=0,y[2]=0,y[3]=0,b[6]=f+c,b[7]=g-d,b[8]=p-_,M[6]=0,M[7]=-1,M[8]=0,y[4]=1,y[5]=0,b[9]=f+c,b[10]=g-d,b[11]=p+_,M[9]=0,M[10]=-1,M[11]=0,y[6]=1,y[7]=1,b[12]=f+c,b[13]=g+d,b[14]=p+_,M[12]=0,M[13]=1,M[14]=0,y[8]=0,y[9]=1,b[15]=f+c,b[16]=g+d,b[17]=p-_,M[15]=0,M[16]=1,M[17]=0,y[10]=0,y[11]=0,b[18]=f-c,b[19]=g+d,b[20]=p-_,M[18]=0,M[19]=1,M[20]=0,y[12]=1,y[13]=0,b[21]=f-c,b[22]=g+d,b[23]=p+_,M[21]=0,M[22]=1,M[23]=0,y[14]=1,y[15]=1,b[24]=f+c,b[25]=g-d,b[26]=p+_,M[24]=1,M[25]=0,M[26]=0,y[16]=0,y[17]=1,b[27]=f+c,b[28]=g-d,b[29]=p-_,M[27]=1,M[28]=0,M[29]=0,y[18]=0,y[19]=0,b[30]=f+c,b[31]=g+d,b[32]=p-_,M[30]=1,M[31]=0,M[32]=0,y[20]=1,y[21]=0,b[33]=f+c,b[34]=g+d,b[35]=p+_,M[33]=1,M[34]=0,M[35]=0,y[22]=1,y[23]=1,b[36]=f-c,b[37]=g+d,b[38]=p+_,M[36]=-1,M[37]=0,M[38]=0,y[24]=0,y[25]=1,b[39]=f-c,b[40]=g+d,b[41]=p-_,M[39]=-1,M[40]=0,M[41]=0,y[26]=0,y[27]=0,b[42]=f-c,b[43]=g-d,b[44]=p-_,M[42]=-1,M[43]=0,M[44]=0,y[28]=1,y[29]=0,b[45]=f-c,b[46]=g-d,b[47]=p+_,M[45]=-1,M[46]=0,M[47]=0,y[30]=1,y[31]=1,b[48]=f-c,b[49]=g+d,b[50]=p+_,M[48]=0,M[49]=0,M[50]=1,y[32]=0,y[33]=1,b[51]=f-c,b[52]=g-d,b[53]=p+_,M[51]=0,M[52]=0,M[53]=1,y[34]=0,y[35]=0,b[54]=f+c,b[55]=g-d,b[56]=p+_,M[54]=0,M[55]=0,M[56]=1,y[36]=1,y[37]=0,b[57]=f+c,b[58]=g+d,b[59]=p+_,M[57]=0,M[58]=0,M[59]=1,y[38]=1,y[39]=1,b[60]=f+c,b[61]=g+d,b[62]=p-_,M[60]=0,M[61]=0,M[62]=-1,y[40]=0,y[41]=1,b[63]=f+c,b[64]=g-d,b[65]=p-_,M[63]=0,M[64]=0,M[65]=-1,y[42]=0,y[43]=0,b[66]=f-c,b[67]=g-d,b[68]=p-_,M[66]=0,M[67]=0,M[68]=-1,y[44]=1,y[45]=0,b[69]=f-c,b[70]=g+d,b[71]=p-_,M[69]=0,M[70]=0,M[71]=-1,y[46]=1,y[47]=1;var T=new l.Uint16Array(36);T[0]=0,T[1]=1,T[2]=2,T[3]=0,T[4]=2,T[5]=3,T[6]=4,T[7]=5,T[8]=6,T[9]=4,T[10]=6,T[11]=7,T[12]=8,T[13]=9,T[14]=10,T[15]=8,T[16]=10,T[17]=11,T[18]=12,T[19]=13,T[20]=14,T[21]=12,T[22]=14,T[23]=15,T[24]=16,T[25]=17,T[26]=18,T[27]=16,T[28]=18,T[29]=19,T[30]=20,T[31]=21,T[32]=22,T[33]=20,T[34]=22,T[35]=23,x.getAttributes().Vertex=new n(n.ARRAY_BUFFER,b,3),x.getAttributes().Normal=new n(n.ARRAY_BUFFER,M,3),x.getAttributes().TexCoord0=new n(n.ARRAY_BUFFER,y,2);var A=new h(s.TRIANGLES,new n(n.ELEMENT_ARRAY_BUFFER,T,1));return x.getPrimitives().push(A),x},_=function(){var t=new a,e=new l.Float32Array([-1,-1,-1,4,4,-1]),r=new l.Float32Array([-1,-1,-1,4,4,-1]),i=new l.Uint16Array(3);i[0]=2,i[1]=1,i[2]=0,t.getAttributes().Vertex=new n(n.ARRAY_BUFFER,r,2),t.getAttributes().TexCoord0=new n(n.ARRAY_BUFFER,e,2);var o=new h(s.TRIANGLES,new n(n.ELEMENT_ARRAY_BUFFER,i,1));return t.getPrimitives().push(o),function(){return t}}(),f=function(t,e,r,o,u,c,d,_,f,g,p,m,v){void 0===m&&void 0===v&&(m=g,v=p,g=0,p=0);var S=new a,x=new l.Float32Array(12);x[0]=t+d,x[1]=e+_,x[2]=r+f,x[3]=t,x[4]=e,x[5]=r,x[6]=t+o,x[7]=e+u,x[8]=r+c,x[9]=t+o+d,x[10]=e+u+_,x[11]=r+c+f,void 0===m&&(m=1),void 0===v&&(v=1);var b=new l.Float32Array(8);b[0]=g,b[1]=v,b[2]=g,b[3]=p,b[4]=m,b[5]=p,b[6]=m,b[7]=v;var y=i.fromValues(o,u,c);i.cross(y,y,i.fromValues(d,_,f)),i.normalize(y,y);var M=new l.Float32Array(12);M[0]=y[0],M[1]=y[1],M[2]=y[2],M[3]=y[0],M[4]=y[1],M[5]=y[2],M[6]=y[0],M[7]=y[1],M[8]=y[2],M[9]=y[0],M[10]=y[1],M[11]=y[2];var T=new l.Uint16Array(6);T[0]=0,T[1]=1,T[2]=2,T[3]=0,T[4]=2,T[5]=3,S.getAttributes().Vertex=new n(n.ARRAY_BUFFER,x,3),S.getAttributes().Normal=new n(n.ARRAY_BUFFER,M,3),S.getAttributes().TexCoord0=new n(n.ARRAY_BUFFER,b,2);var A=new h(s.TRIANGLES,new n(n.ELEMENT_ARRAY_BUFFER,T,1));return S.getPrimitives().push(A),S},g=function(t){void 0===t&&(t=1),void 0===g.getShader&&(g.getShader=function(){if(void 0===g.getShader.program){var t=["#ifdef GL_ES","precision highp float;","#endif","attribute vec3 Vertex;","attribute vec4 Color;","uniform mat4 uModelViewMatrix;","uniform mat4 uProjectionMatrix;","","varying vec4 vColor;","","void main(void) {","  gl_Position = uProjectionMatrix * (uModelViewMatrix * vec4(Vertex, 1.0));","  vColor = Color;","}"].join("\n"),e=["#ifdef GL_ES","precision highp float;","#endif","varying vec4 vColor;","void main(void) {","gl_FragColor = vColor;","}"].join("\n"),r=new u(new c("VERTEX_SHADER",t),new c("FRAGMENT_SHADER",e));g.getShader.program=r}return g.getShader.program});var e=new a,r=new l.Float32Array(18);r[3]=t,r[10]=t,r[17]=t;var i=new l.Float32Array(24);i[0]=i[3]=1,i[4]=i[7]=1,i[9]=i[11]=1,i[13]=i[15]=1,i[18]=i[19]=1,i[22]=i[23]=1,e.getAttributes().Vertex=new n(n.ARRAY_BUFFER,r,3),e.getAttributes().Color=new n(n.ARRAY_BUFFER,i,4);var h=new o(s.LINES,0,6);return e.getPrimitives().push(h),e.getOrCreateStateSet().setAttributeAndModes(g.getShader()),e},p=function(t,e,r,u,c,d,_){t=t||1,u=void 0!==u?u:0,c=void 0!==c?c:2*Math.PI,d=void 0!==d?d:0,_=void 0!==_?_:Math.PI;for(var f=Math.max(3,Math.floor(e)||8),g=Math.max(2,Math.floor(r)||6),p=f*g/3>=65536,m=p?f*g*6:f*g*4,v=new l.Float32Array(3*m),S=new l.Float32Array(3*m),x=new l.Float32Array(2*m),b=p?void 0:new l.Uint16Array(f*g*6),y=0,M=0,T=new l.Float32Array(3),A=new l.Float32Array(3),C=new l.Float32Array(3),I=new l.Float32Array(3),w=new l.Float32Array(3),E=new l.Float32Array(3),N=new l.Float32Array(3),R=new l.Float32Array(3),F=new l.Float32Array(2),P=new l.Float32Array(2),L=new l.Float32Array(2),O=new l.Float32Array(2),D=function(e,r,n,a,s){n[0]=-t*Math.cos(u+e*c)*Math.sin(d+r*_),n[1]=t*Math.cos(d+r*_),n[2]=t*Math.sin(u+e*c)*Math.sin(d+r*_),i.normalize(a,n),s[0]=e,s[1]=1-r},V=0;V<g;V++)for(var B=0;B<f;B++){D((B+1)/f,V/g,T,w,F),D(B/f,V/g,A,E,P),D(B/f,(V+1)/g,C,N,L),D((B+1)/f,(V+1)/g,I,R,O);var k=3*y;v[k]=T[0],v[k+1]=T[1],v[k+2]=T[2],v[k+3]=A[0],v[k+4]=A[1],v[k+5]=A[2],v[k+6]=C[0],v[k+7]=C[1],v[k+8]=C[2],S[k]=w[0],S[k+1]=w[1],S[k+2]=w[2],S[k+3]=E[0],S[k+4]=E[1],S[k+5]=E[2],S[k+6]=N[0],S[k+7]=N[1],S[k+8]=N[2];var U=2*y;if(x[U]=F[0],x[U+1]=F[1],x[U+2]=P[0],x[U+3]=P[1],x[U+4]=L[0],x[U+5]=L[1],y+=3,p)k=3*y,v[k]=T[0],v[k+1]=T[1],v[k+2]=T[2],v[k+3]=C[0],v[k+4]=C[1],v[k+5]=C[2],v[k+6]=I[0],v[k+7]=I[1],v[k+8]=I[2],S[k]=w[0],S[k+1]=w[1],S[k+2]=w[2],S[k+3]=N[0],S[k+4]=N[1],S[k+5]=N[2],S[k+6]=R[0],S[k+7]=R[1],S[k+8]=R[2],U=2*y,x[U]=F[0],x[U+1]=F[1],x[U+2]=L[0],x[U+3]=L[1],x[U+4]=O[0],x[U+5]=O[1],y+=3;else{k=3*y,v[k]=I[0],v[k+1]=I[1],v[k+2]=I[2],S[k]=R[0],S[k+1]=R[1],S[k+2]=R[2],U=2*y,x[U]=O[0],x[U+1]=O[1];var G=3*M,j=y-3;b[G]=j,b[G+1]=j+1,b[G+2]=j+2,b[G+3]=j,b[G+4]=j+2,b[G+5]=j+3,M+=2,y+=1}}var z=new a;return z.getAttributes().Vertex=new n("ARRAY_BUFFER",v,3),z.getAttributes().Normal=new n("ARRAY_BUFFER",S,3),z.getAttributes().TexCoord0=new n("ARRAY_BUFFER",x,2),p?z.getPrimitives().push(new o(s.TRIANGLES,0,v.length/3)):z.getPrimitives().push(new h(s.TRIANGLES,new n("ELEMENT_ARRAY_BUFFER",b,1))),z},m=function(t,e,r,i,h,u,c,l,d,_,f){t=void 0!==t?t:-.5,e=void 0!==e?e:-.5,r=void 0!==r?r:0,i=void 0!==i?i:1,h=void 0!==h?h:0,u=void 0!==u?u:0,c=void 0!==c?c:0,l=void 0!==l?l:1,d=void 0!==d?d:0,_=void 0!==_?_:5,f=void 0!==f?f:_,_+=2,f+=2;var g=new a,p=new Float32Array(2*(_+f)*3),m=0,v=0,S=i/(_-1),x=h/(_-1),b=u/(_-1),y=t+i+c,M=e+h+l,T=r+u+d;for(m=0;m<_;++m)v=6*m,p[v]=t+S*m,p[v+1]=e+x*m,p[v+2]=r+b*m,p[v+3]=y-S*(_-m-1),p[v+4]=M-x*(_-m-1),p[v+5]=T-b*(_-m-1);for(S=c/(f-1),x=l/(f-1),b=d/(f-1),m=0;m<f;++m)v=6*(_+m),p[v]=t+S*m,p[v+1]=e+x*m,p[v+2]=r+b*m,p[v+3]=y-S*(f-m-1),p[v+4]=M-x*(f-m-1),p[v+5]=T-b*(f-m-1);g.getAttributes().Vertex=new n(n.ARRAY_BUFFER,p,3);var A=new o(s.LINES,0,2*(_+f));return g.getPrimitives().push(A),g},v=function(t){var e=new a,r=new Float32Array([-.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,-.5,.5,-.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5]);e.getAttributes().Vertex=new n(n.ARRAY_BUFFER,r,3),t||(t=[1,0,0,1]);for(var i=new l.Float32Array(32),o=0;o<8;o++)for(var u=0;u<4;u++)i[3*o+u]=t[u];e.getAttributes().Color=new n(n.ARRAY_BUFFER,i,4);var c=new l.Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);return e.getPrimitives().push(new h(s.LINES,new n("ELEMENT_ARRAY_BUFFER",c,1))),e};t.exports={createTexturedBoxGeometry:d,createTexturedQuadGeometry:f,createTexturedSphereGeometry:p,createTexturedFullScreenFakeQuadGeometry:_,createAxisGeometry:g,createTexturedSphere:p,createGridGeometry:m,createBoundingBoxGeometry:v}},function(t,e){"use strict";var r=function(){this._globalDefault=void 0,this._lastApplied=void 0,this._changed=!1,this._values=[],this._back=void 0,this._length=0};r.prototype={getLength:function(){return this._length},push:function(t,e){var r;this._length===this._values.length?(r={object:t,value:e},this._values.push(r)):(r=this._values[this._length],r.object=t,r.value=e),this._back=r,this._length++},pop:function(){if(this._length){var t=this._values;this._length--;var e=t[this._length];return this._back=this._length?t[this._length-1]:void 0,e}}},t.exports=r},function(t,e,r){"use strict";var i=r(15).mat4,n=r(15).mat3,a=r(9),s=r(13),o=r(104),h=r(30),u=r(50),c=r(124),l=r(41),d=r(7),_=r(37),f=[void 0,function(t,e){return t[0]===e[0]||(e[0]=t[0],!1)},function(t,e){return t[0]===e[0]&&t[1]===e[1]||(e[0]=t[0],e[1]=t[1],!1)},function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]||(e[0]=t[0],e[1]=t[1],e[2]=t[2],!1)},function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]||(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],!1)}],g={uProjectionMatrix:!0,uModelMatrix:!0,uViewMatrix:!0,uModelViewMatrix:!0,uModelNormalMatrix:!0,uModelViewNormalMatrix:!0,uArrayColorEnabled:!0},p=function(t){s.call(this),this._graphicContext=void 0,this._shaderGeneratorProxy=t,void 0===t&&console.break(),this._currentVAO=null,this._currentIndexVBO=null,this._stateSets=new u,this._shaderGeneratorNames=new c,this._uniforms={},this._textureAttributeArrayList=[],this._attributeArray=[],this._projectionMatrix=l.createMatrix4(i.create(),"uProjectionMatrix"),this._modelMatrix=l.createMatrix4(i.create(),"uModelMatrix"),this._viewMatrix=l.createMatrix4(i.create(),"uViewMatrix"),this._modelViewMatrix=l.createMatrix4(i.create(),"uModelViewMatrix"),this._modelNormalMatrix=l.createMatrix3(n.create(),"uModelNormalMatrix"),this._modelViewNormalMatrix=l.createMatrix3(n.create(),"uModelViewNormalMatrix");var e=new c;e._globalDefault=l.createFloat1(0,"uArrayColorEnabled"),this._uniforms.ArrayColorEnabled=e,this._previousColorAttribPair={},this._vertexAttribMap={},this._vertexAttribMap._disable=[],this._vertexAttribMap._keys=[],this._frameStamp=void 0,this._programCommonUniformsCache={},this._lastAppliedModelViewMatrix=void 0,this._lastAppliedProjectionMatrix=void 0,this._program=void 0;var r=new o;this.applyAttribute(r),this._programType=d.getOrCreateStateAttributeTypeMemberIndex(r),this._programAttribute=this._attributeArray[this._programType],this._numPushStateSet=0,this._numApply=0,this._programUniformCache=[],this._cacheUniformId=0,this.resetStats()};d.createPrototypeObject(p,d.objectInherit(s.prototype,{resetCaches:function(){this._currentVAO=null,this._currentIndexVBO=null,this._previousColorAttribPair={},this._vertexAttribMap={},this._vertexAttribMap._disable=[],this._vertexAttribMap._keys=[],this._programCommonUniformsCache={}},getCacheUniformsApplyRenderLeaf:function(){return this._programCommonUniformsCache},setGraphicContext:function(t){this._graphicContext=t,this._extVAO=_.instance(t).getWebGLExtension("OES_vertex_array_object")},getGraphicContext:function(){return this._graphicContext},getShaderGeneratorProxy:function(){return this._shaderGeneratorProxy},pushCheckOverride:function(t,e,r){var i=this._evaluateOverrideObjectOnStack(t,e,r);i!==e?t.push(i,t._back.value):t.push(e,r)},_evaluateOverrideObjectOnStack:function(t,e,r){var i=t._back;return 0===t._length?e:i.value&h.OVERRIDE&&!(r&h.PROTECTED)?i.object:e},pushStateSet:function(t){this._numPushStateSet++,this._stateSets.push(t),this.pushAttributeMap(this._attributeArray,t._attributeArray,t._activeAttribute);for(var e=t._textureAttributeArrayList,r=t._activeTextureAttributeUnit,i=t._activeTextureAttribute,n=0,a=r.length;n<a;n++){var s=r[n],o=e[s],h=this.getOrCreateTextureAttributeArray(s);this.pushAttributeMap(h,o,i)}t.hasUniform()&&this.pushUniformsList(this._uniforms,t.getUniformList());var u=t.getShaderGeneratorPair();u&&this.pushCheckOverride(this._shaderGeneratorNames,u.getShaderGeneratorName(),u.getValue())},getStateSetStackSize:function(){return this._stateSets.getLength()},insertStateSet:function(){var t=new u,e=t.getArray();return function(r,i){t.reset();for(var n=this.getStateSetStackSize();n>r;)t.push(this._stateSets.back()),this.popStateSet(),n--;this.pushStateSet(i);for(var a=t._length-1;a>=0;a--)this.pushStateSet(e[a])}}(),removeStateSet:function(){var t=new u,e=t.getArray();return function(r){var i=this.getStateSetStackSize();if(r>=i)return void a.warn("Warning State:removeStateSet "+r+" out of range");for(t.reset();i-1>r;)t.push(this._stateSets.back()),this.popStateSet(),i--;this.popStateSet();for(var n=t._length-1;n>=0;n--)this.pushStateSet(e[n])}}(),resetCacheFrame:function(){this._lastAppliedModelViewMatrix=this._lastAppliedProjectionMatrix=void 0},resetStats:function(){this._numApply=0,this._numPushStateSet=0},applyProgram:function(t){this._program!==t&&(this._program=t,this.getGraphicContext().useProgram(t))},applyModelViewMatrix:function(){var t=n.create();return function(e,r){if(this._lastAppliedModelViewMatrix===e)return!1;var i=this.getLastProgramApplied(),a=i.getUniformsCache(),s=this._modelViewMatrix,o=a.uModelViewMatrix,h=this.getGraphicContext();o&&(s.setMatrix4(e),s.apply(h,o));var u;if(this._lastAppliedModelViewMatrix){for(var c=this._lastAppliedModelViewMatrix,l=0;l<11;l++)if(e[l]!==c[l]){u=!0;break}}else u=!0;return u&&(s=this._modelViewNormalMatrix,o=a.uModelViewNormalMatrix,o&&(n.normalFromMat4(t,e),s.setMatrix3(t),s.apply(h,o)),o=a.uModelNormalMatrix,o&&(n.normalFromMat4(t,r),s.setMatrix3(t),s.apply(h,o))),this._lastAppliedModelViewMatrix=e,!0}}(),applyProjectionMatrix:function(t){if(this._lastAppliedProjectionMatrix!==t){this._lastAppliedProjectionMatrix=t;var e=this.getLastProgramApplied(),r=this._projectionMatrix,i=e.getUniformsCache()[r.getName()];i&&(r.setMatrix4(t),r.apply(this.getGraphicContext(),i))}},getCurrentShaderGeneratorStateSet:function(t){var e=this._programAttribute,r=t._attributeArray[this._programType];if(!(0!==e._length&&e._back.value!==h.OFF||r&&r.getValue()!==h.OFF)){var i,n=t.getShaderGeneratorPair(),a=this._shaderGeneratorNames;if(n){var s=n.getValue(),o=n.getShaderGeneratorName();i=this._evaluateOverrideObjectOnStack(this._shaderGeneratorNames,o,s)}else a._length&&(i=a._back.object);var u=i,c=this._shaderGeneratorProxy.getShaderGenerator(u);return c}},_applyAttributeMapStateSet:function(t,e){for(var r=t.length>e.length?t.length:e.length,i=0,n=r;i<n;i++){var a,s=i,o=t[s],h=e[s],u=void 0!==o,c=u&&o._changed;if(h||c){var l=h?h.getAttribute():void 0;if(u)if(l){var d=h.getValue();a=this._evaluateOverrideObjectOnStack(o,l,d),a!==l?o._changed&&(this._applyAttributeStack(a,o),o._changed=!1):this._applyAttributeStack(a,o)&&(o._changed=!0)}else o._length?(o._changed=!1,this._applyAttributeStack(o._back.object,o)):(o._changed=!1,this._applyAttributeStack(o._globalDefault,o));else o=this._createAttributeStack(t,s,l.cloneType()),o._changed=!0,this._applyAttributeStack(l,o)}}},_applyTextureAttributeMapListStateSet:function(t,e){for(var r,i,n,a=16,s=0,o=a;s<o;s++){var h=s;r=t[h];var u=e[h];if(r||u){i=n=0,r?(n=r.length,u&&(i=u.length)):(r=this.getOrCreateTextureAttributeArray(h),i=u.length);for(var c=n>i?n:i,l=0;l<c;l++){var d,_=l,f=r[_],g=u?u[_]:void 0,p=void 0!==f,m=p&&f._changed;if(g||m){var v=g?g.getAttribute():void 0;if(p)if(v){var S=g.getValue();d=this._evaluateOverrideObjectOnStack(f,v,S),d!==v?f._changed&&(this._applyTextureAttribute(h,d,f),f._changed=!1):this._applyTextureAttribute(h,d,f)&&(f._changed=!0)}else f._length?(f._changed=!1,this._applyTextureAttribute(h,f._back.object,f)):(f._changed=!1,this._applyTextureAttribute(h,f._globalDefault,f));else d=g.getAttribute(),f=this._createAttributeStack(r,_,d.cloneType()),f._changed=!0,this._applyTextureAttribute(h,d,f)}}}}},applyStateSet:function(t){this._numApply++;var e=this.getLastProgramApplied();this._currentShaderGenerator=this.getCurrentShaderGeneratorStateSet(t),this._applyAttributeMapStateSet(this._attributeArray,t._attributeArray),this._applyTextureAttributeMapListStateSet(this._textureAttributeArrayList,t._textureAttributeArrayList);var r;if(this._currentShaderGenerator){var i=this._currentShaderGenerator.getOrCreateProgram(this);this.applyAttribute(i),r=i,this._applyGeneratedProgramUniforms(i,t)}else r=this.getLastProgramApplied(),this._applyCustomProgramUniforms(r,t);e!==r&&(this._lastAppliedModelViewMatrix=void 0,this._lastAppliedProjectionMatrix=void 0)},popAllStateSets:function(){for(;this._stateSets._length;)this.popStateSet()},popStateSet:function(){if(this._stateSets._length){var t=this._stateSets.pop();this.popAttributeMap(this._attributeArray,t._attributeArray,t._activeAttribute);for(var e=t._textureAttributeArrayList,r=t._activeTextureAttributeUnit,i=t._activeTextureAttribute,n=0,a=r.length;n<a;n++){var s=r[n],o=e[s],h=this.getOrCreateTextureAttributeArray(s);this.popAttributeMap(h,o,i)}t.hasUniform()&&this.popUniformsList(this._uniforms,t.getUniformList()),t.getShaderGeneratorPair()&&this._shaderGeneratorNames.pop()}},_createAttributeStack:function(t,e,r){var i=new c;return i._globalDefault=r,t[e]=i,i},haveAppliedAttribute:function(t){if(t){var e=d.getOrCreateStateAttributeTypeMemberIndex(t),r=this._attributeArray[e];r||(r=this._createAttributeStack(this._attributeArray,e,t.cloneType())),r._lastApplied=t,r._changed=!0}},applyAttribute:function(t){var e=d.getOrCreateStateAttributeTypeMemberIndex(t),r=this._attributeArray,i=r[e];i||(i=this._createAttributeStack(r,e,t.cloneType())),i._changed=!0,this._applyAttributeStack(t,i)},_applyAttributeStack:function(t,e){return e._lastApplied!==t&&(t.apply&&t.apply(this),e._lastApplied=t,!0)},_applyTextureAttribute:function(t,e,r){if(r._lastApplied===e)return!1;if(r._lastApplied=e,!e.apply)return!0;var i=this.getGraphicContext();return i.activeTexture(i.TEXTURE0+t),e.apply(this,t),!0},applyTextureAttribute:function(t,e){var r=d.getOrCreateTextureStateAttributeTypeMemberIndex(e),i=this.getOrCreateTextureAttributeArray(t),n=i[r];n||(n=this._createAttributeStack(i,r,e.cloneType())),n._changed=!0,this._applyTextureAttribute(t,e,n)},getLastProgramApplied:function(){return this._programAttribute._lastApplied},applyDefault:function(){this.popAllStateSets(),this._currentShaderGenerator=void 0,this.applyAttributeMap(this._attributeArray),this.applyTextureAttributeMapList(this._textureAttributeArrayList)},applyAttributeMap:function(t){for(var e,r=0,i=t.length;r<i;r++)if(e=t[r]){var n;n=e._length?e._back.object:e._globalDefault,e._changed&&(e._lastApplied!==n&&(n.apply&&n.apply(this),e._lastApplied=n),e._changed=!1)}},pushUniformsList:function(t,e){var r,i;for(var n in e){var a=e[n];i=a.getUniform(),r=i.getName(),t[r]||this._createAttributeStack(t,r,i),this.pushCheckOverride(t[r],i,a.getValue())}},popUniformsList:function(t,e){for(var r in e)t[r].pop()},applyTextureAttributeMapList:function(t){for(var e,r=this._graphicContext,i=0,n=t.length;i<n;i++)if(e=t[i])for(var a=0,s=e.length;a<s;a++){var o=e[a];if(o){var h;h=o._length?o._back.object:o._globalDefault,o._changed&&(o._lastApplied!==h&&(r.activeTexture(r.TEXTURE0+i),h.apply(this,i),o._lastApplied=h),o._changed=!1)}}},setGlobalDefaultAttribute:function(t){var e=this._attributeArray,r=d.getOrCreateStateAttributeTypeMemberIndex(t);void 0===e[r]?this._createAttributeStack(e,r,t):e[r]._globalDefault=t},getGlobalDefaultAttribute:function(t){var e=this._attributeArray,r=d.getIdFromTypeMember(t);if(void 0!==r)return e[r]?e[r]._globalDefault:void 0},setGlobalDefaultTextureAttribute:function(t,e){var r=this.getOrCreateTextureAttributeArray(t),i=d.getOrCreateTextureStateAttributeTypeMemberIndex(e);void 0===r[i]?this._createAttributeStack(r,i,e):r[i]._globalDefault=e},getGlobalDefaultTextureAttribute:function(t,e){var r=this.getOrCreateTextureAttributeArray(t),i=d.getTextureIdFromTypeMember(e);if(void 0!==i)return r[i]?r[i]._globalDefault:void 0},getOrCreateTextureAttributeArray:function(t){return this._textureAttributeArrayList[t]||(this._textureAttributeArrayList[t]=[]),this._textureAttributeArrayList[t]},pushAttributeMap:function(t,e,r){for(var i,n=0,a=r.length;n<a;n++){var s=r[n],o=e[s],h=o.getAttribute();i=t[s],i||(this._createAttributeStack(t,s,h.cloneType()),i=t[s]),this.pushCheckOverride(i,h,o.getValue()),i._changed=!0}},popAttributeMap:function(t,e,r){for(var i=0,n=r.length;i<n;i++){var a=r[i],s=t[a];s.pop(),s._changed=!0}},setIndexArray:function(t){var e=this._graphicContext;this._currentIndexVBO!==t&&(t.bind(e),this._currentIndexVBO=t),t.isDirty()&&t.compile(e)},lazyDisablingOfVertexAttributes:function(){for(var t=this._vertexAttribMap._keys,e=0,r=t.length;e<r;e++){var i=t[e];this._vertexAttribMap[i]&&(this._vertexAttribMap._disable[i]=!0)}},enableVertexColor:function(){var t=this._programAttribute._lastApplied;if(t.getUniformsCache().uArrayColorEnabled&&t.getAttributesCache().Color){var e=this._uniforms.ArrayColorEnabled._globalDefault,r=this._previousColorAttribPair[t.getInstanceID()];r||(e.setFloat(1),e.apply(this.getGraphicContext(),t.getUniformsCache().uArrayColorEnabled),this._previousColorAttribPair[t.getInstanceID()]=!0)}},disableVertexColor:function(){var t=this._programAttribute._lastApplied;if(t.getUniformsCache().uArrayColorEnabled&&t.getAttributesCache().Color){var e=this._uniforms.ArrayColorEnabled._globalDefault,r=this._previousColorAttribPair[t.getInstanceID()];r&&(e.setFloat(0),e.apply(this.getGraphicContext(),t.getUniformsCache().uArrayColorEnabled),this._previousColorAttribPair[t.getInstanceID()]=!1)}},applyDisablingOfVertexAttributes:function(){for(var t=this._vertexAttribMap._keys,e=0,r=t.length;e<r;e++)if(this._vertexAttribMap._disable[t[e]]===!0){var i=t[e];this._graphicContext.disableVertexAttribArray(i),this._vertexAttribMap._disable[i]=!1,this._vertexAttribMap[i]=!1}},clearVertexAttribCache:function(){for(var t=this._vertexAttribMap,e=t._keys,r=0,i=e.length;r<i;r++){var n=e[r];t[n]=void 0,t._disable[n]=!1}this._vertexAttribMap._disable.length=0,this._vertexAttribMap._keys.length=0},setVertexArrayObject:function(t){return this._currentVAO!==t&&(this._currentVAO=t,t?t.bind(this._graphicContext):(this._graphicContext.bindVertexArray(null),this.clearVertexAttribCache()),this._currentIndexVBO=void 0,!0)},setVertexAttribArray:function(t,e,r){var i=this._vertexAttribMap;i._disable[t]=!1;var n=this._graphicContext,a=!1;e.isDirty()&&(e.bind(n),e.compile(n),a=!0);var s=i[t];s!==e&&(a||e.bind(n),s||(n.enableVertexAttribArray(t),void 0===s&&i._keys.push(t)),i[t]=e,n.vertexAttribPointer(t,e.getItemSize(),e.getType(),r,0,0))},_getActiveUniformsFromProgramAttributes:function(t,e){var r=this._attributeArray,i=t.getTrackAttributes().attributeKeys;if(i.length>0)for(var n=0,a=i.length;n<a;n++){var s=i[n],o=this.typeMember[s],h=r[o];if(void 0!==h){var u=h._globalDefault;if(void 0!==u.getOrCreateUniforms){var c=u.getOrCreateUniforms();for(var l in c)e.push(c[l])}}}},_getActiveUniformsFromProgramTextureAttributes:function(t,e){var r=t.getTrackAttributes().textureAttributeKeys;if(void 0!==r)for(var i=0,n=r.length;i<n;i++){var a=r[i];if(void 0!==a){var s=this._textureAttributeArrayList[i];if(void 0!==s)for(var o=0,h=a.length;o<h;o++){var u=a[o],c=s[u];if(void 0!==c){var l=c._globalDefault;if(void 0!==l.getOrCreateUniforms){var d=l.getOrCreateUniforms();for(var _ in d)e.push(d[_])}}}}}},_cacheUniformsForCustomProgram:function(t,e){this._getActiveUniformsFromProgramAttributes(t,e),this._getActiveUniformsFromProgramTextureAttributes(t,e);for(var r=this._graphicContext,i={},n=0,a=e.length;n<a;n++){var s=e[n],o=s.getName(),h=r.getUniformLocation(t._program,o);void 0!==h&&null!==h&&(i[o]=s)}t.trackUniforms=i},_applyCustomProgramUniforms:function(){var t=[];return function(e,r){
t.length=0,void 0!==e.getTrackAttributes()&&void 0===e.trackUniforms&&this._cacheUniformsForCustomProgram(e,t);var i,n=e.getUniformsCache(),a=this._uniforms;e.trackUniforms&&(i=e.trackUniforms);var s;for(var o in n){var h=n[o],u=a[o],c=r&&r.uniforms[o];if(u||c)if(c){var l=r.uniforms[o],d=l.getValue(),_=l.getUniform();s=u?this._evaluateOverrideObjectOnStack(u,_,d):_}else s=u._length?u._back.object:u._globalDefault;else{if(void 0===i){this._checkErrorUniform(o);continue}s=i[o]}s.apply(this._graphicContext,h)}}}(),_checkErrorUniform:function(t){var e=t.substr(7);this._textureAttributeArrayList[e]&&t==="Texture"+e||g[t]||(g[t]=1,a.error("Uniform not in the scene hierarchy : "+t))},_computeForeignUniforms:function(t,e){var r=[];for(var i in t){var n=t[i];void 0!==n&&void 0===e[i]&&(g[i]||r.push(i))}return r},_removeUniformsNotRequiredByProgram:function(t,e){for(var r in t){var i=e[r];void 0!==i&&null!==i||delete t[r]}},_cacheUniformsForGeneratedProgram:function(t){var e=t.getUniformsCache(),r=t.getActiveUniforms(),i=this._computeForeignUniforms(e,r);t.setForeignUniforms(i),this._removeUniformsNotRequiredByProgram(r,e)},_copyUniformEntry:function(t){var e,r=t.getInternalArray();return r.length<16&&(e=new r.constructor(r.length)),e},_initUniformCache:function(t){var e,r,i,n,a,s,o=t.getActiveUniforms(),h=t.getForeignUniforms(),u=this._uniforms,c=[],l=[];if(t._cacheUniformId=this._cacheUniformId++,this._programUniformCache[t._cacheUniformId]={},h.length)for(i=c,e=0,r=h.length;e<r;e++){n=h[e];var d=u[n];d&&(s=d._globalDefault,a=this._copyUniformEntry(s),i.push(a))}for(var _ in o)s=o[_],a=this._copyUniformEntry(s),l.push(a);this._programUniformCache[t._cacheUniformId].foreign=c,this._programUniformCache[t._cacheUniformId].active=l},_checkCacheAndApplyUniform:function(t,e,r,i,n){var a,s=t.getInternalArray(),o=s.length;if(o<=4){var h=e[r];a=f[o](s,h)}else a=!1;if(!a){var u=i[n];t.apply(this._graphicContext,u)}},_applyGeneratedProgramUniforms:function(t,e){var r,i,n,a,s=this._uniforms,o=t.getForeignUniforms();if(!o){if(this._cacheUniformsForGeneratedProgram(t),o=t.getForeignUniforms(),e){var h=e.uniforms;for(a=0;a<o.length;a++)i=o[a],s[i]||h[i]&&(r=h[i].getUniform(),this._createAttributeStack(s,i,r))}this._initUniformCache(t)}var u=t.getUniformsCache(),c=t.getActiveUniforms(),l=this._programUniformCache[t._cacheUniformId].active,d=this._programUniformCache[t._cacheUniformId].foreign,_=0;for(var f in c)r=c[f],this._checkCacheAndApplyUniform(r,l,_,u,f),_++;_=0;var g=o.length;for(a=0;a<g;a++){i=o[a],n=s[i];var p=e&&e.uniforms[i];if(p||n){if(p){var m=e.uniforms[i],v=m.getValue(),S=m.getUniform();r=this._evaluateOverrideObjectOnStack(n,S,v)}else n._length?r=n._back.object:(r=n._globalDefault,this._checkErrorUniform(i));this._checkCacheAndApplyUniform(r,d,_,u,i),_++}else this._checkErrorUniform(i)}},_setStateSetsDrawID:function(t){for(var e=this._stateSets.getArray(),r=0,i=this._stateSets.length;r<i;r++)e[r].setDrawID(t)},_stateSetStackChanged:function(t,e){var r=this._stateSets.getArray(),i=this._stateSets.length;if(e!==i)return!0;for(var n=0;n<i;n++)if(t!==r[n].getDrawID())return!0;return!1}}),"osg","State"),t.exports=p},function(t,e,r){"use strict";var i=r(7),n=r(42),a=r(9),s=r(40),o=function(){s.call(this),this._images={};for(var t=0;t<6;t++)this._images[s.TEXTURE_CUBE_MAP_POSITIVE_X+t]=new n};i.createPrototypeStateAttribute(o,i.objectInherit(s.prototype,{setDefaultParameters:function(){s.prototype.setDefaultParameters.call(this),this._textureTarget=s.TEXTURE_CUBE_MAP,this._flipY=!1},invalidate:function(){s.prototype.invalidate.call(this);for(var t=s.TEXTURE_CUBE_MAP_POSITIVE_X;t<s.TEXTURE_CUBE_MAP_POSITIVE_X+6;t++){var e=this._images[t];this._images[s.TEXTURE_CUBE_MAP_POSITIVE_X].getImage()&&e.dirty()}this.dirty()},cloneType:function(){return new o},setImage:function(t,e,r){var i=t;"string"==typeof i&&(i=s[i]),this._images[i].setImage(e,r),this.setImageFormat(r),this.setTextureSize(this._images[i].getWidth(),this._images[i].getHeight()),this._textureNull=!1,this.dirty()},getImage:function(t){return this._images[t].getImage()},initCubemapContent:function(t){var e=this._internalFormat;return this.applyTexImage2D(t,t.TEXTURE_CUBE_MAP_POSITIVE_X,0,e,this._textureWidth,this._textureHeight,0,e,this._type,null),this.applyTexImage2D(t,t.TEXTURE_CUBE_MAP_NEGATIVE_X,0,e,this._textureWidth,this._textureHeight,0,e,this._type,null),this.applyTexImage2D(t,t.TEXTURE_CUBE_MAP_POSITIVE_Y,0,e,this._textureWidth,this._textureHeight,0,e,this._type,null),this.applyTexImage2D(t,t.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,e,this._textureWidth,this._textureHeight,0,e,this._type,null),this.applyTexImage2D(t,t.TEXTURE_CUBE_MAP_POSITIVE_Z,0,e,this._textureWidth,this._textureHeight,0,e,this._type,null),this.applyTexImage2D(t,t.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,e,this._textureWidth,this._textureHeight,0,e,this._type,null),!0},generateMipmap:function(t,e){if(this.hasMipmapFilter()){if(this._images[s.TEXTURE_CUBE_MAP_POSITIVE_X].hasMipmap())for(var r=0;r<6;r++){var i=this._images[s.TEXTURE_CUBE_MAP_POSITIVE_X+r];i.hasMipmap()||a.error("mipmap not set correctly for TextureCubemap");for(var n=this._internalFormat,o=1;o<i.getMipmap().length;o++){var h=i.getMipmap()[o].getWidth();this.applyTexImage2D(t,t.TEXTURE_CUBE_MAP_POSITIVE_X+r,o,n,h,h,0,n,this._type,i.getMipmap()[o].getImage())}}else t.generateMipmap(e);this._dirtyMipmap=!1}},applyImageTarget:function(t,e,r){var i=this._images[r];return i.getImage()&&i.isReady()?i.isDirty()?(this.setTextureSize(i.getWidth(),i.getHeight()),i.setDirty(!1),i.isTypedArray()?this.applyTexImage2D(t,r,0,e,this._textureWidth,this._textureHeight,0,e,this._type,i.getImage()):this.applyTexImage2D(t,r,0,e,e,this._type,i.getImage()),!this._unrefImageDataAfterApply||this.hasMipmap()&&i.hasMipmap()||i.release(),1):1:0},initCubemapContentImage:function(t){var e=this._internalFormat,r=0;return r+=this.applyImageTarget(t,e,t.TEXTURE_CUBE_MAP_POSITIVE_X),r+=this.applyImageTarget(t,e,t.TEXTURE_CUBE_MAP_NEGATIVE_X),r+=this.applyImageTarget(t,e,t.TEXTURE_CUBE_MAP_POSITIVE_Y),r+=this.applyImageTarget(t,e,t.TEXTURE_CUBE_MAP_NEGATIVE_Y),r+=this.applyImageTarget(t,e,t.TEXTURE_CUBE_MAP_POSITIVE_Z),r+=this.applyImageTarget(t,e,t.TEXTURE_CUBE_MAP_NEGATIVE_Z),6===r},apply:function(t){var e=t.getGraphicContext();if(this._dirtyTextureObject&&(this.releaseGLObjects(),this.setGraphicContext(e)),void 0===this._textureObject||this.isDirty())if(this._textureNull)e.bindTexture(this._textureTarget,null);else{this._textureObject||(this.computeTextureFormat(),this.init(t)),this._textureObject.bind(e);var r;r=this._images[s.TEXTURE_CUBE_MAP_POSITIVE_X].getImage()?this.initCubemapContentImage(e):this.initCubemapContent(e),r&&(this._dirty=!1,this.applyFilterParameter(e,this._textureTarget),this.generateMipmap(e,this._textureTarget))}else this._textureObject.bind(e),this.isDirtyMipmap()&&this.generateMipmap(e,this._textureTarget)}}),"osg","TextureCubeMap"),t.exports=o},function(t,e,r){"use strict";var i=r(46),n=r(45),a=r(91),s=function(){},o=s.functorDrawElements=[],h=s.functorDrawArrays=[];o[i.TRIANGLES]=function(t,e,r,i){for(var n=t+e,a=t;a<n;a+=3)i(r[a],r[a+1],r[a+2])},o[i.TRIANGLE_STRIP]=function(t,e,r,i){for(var n=2,a=t;n<e;++n,++a)n%2?i(r[a],r[a+2],r[a+1]):i(r[a],r[a+1],r[a+2])},o[i.TRIANGLE_FAN]=function(t,e,r,i){for(var n=r[t],a=2,s=t+1;a<e;++a,++s)i(n,r[s],r[s+1])},h[i.TRIANGLES]=function(t,e,r){for(var i=2,n=t;i<e;i+=3,n+=3)r(n,n+1,n+2)},h[i.TRIANGLE_STRIP]=function(t,e,r){for(var i=2,n=t;i<e;++i,++n)i%2?r(n,n+2,n+1):r(n,n+1,n+2)},h[i.TRIANGLE_FAN]=function(t,e,r){for(var i=2,n=t+1;i<e;++i,++n)r(t,n,n+1)},s.prototype={init:function(t,e){this._geom=t,this._cb=e},apply:function(){var t=this._geom,e=t.getPrimitiveSetList();if(e)for(var r,i=this._cb,s=e.length,u=0;u<s;u++){var c=e[u];if(c instanceof n){if(r=o[c.getMode()]){var l=c.indices.getElements();r(c.getFirst()/l.BYTES_PER_ELEMENT,c.getCount(),l,i)}}else c instanceof a&&(r=h[c.getMode()],r&&r(c.getFirst(),c.getCount(),i))}}},t.exports=s},function(t,e,r){"use strict";var i=r(7),n=r(31),a=function(){n.call(this),this.visitorType=n.UPDATE_VISITOR,this._numUpdateCallback=0};i.createPrototypeObject(a,i.objectInherit(n.prototype,{resetStats:function(){this._numUpdateCallback=0},apply:function(t){var e=t.getStateSet();if(e&&e.requiresUpdateTraversal()){var r=e.getUpdateCallbackList(),i=r.length;if(i){this._numUpdateCallback+=i;for(var n=0,a=i;n<a;n++)r[n].update(e,this)}}for(var s=t.getUpdateCallbackList(),o=s.length,h=0;h<o;h++)if(this._numUpdateCallback++,!s[h].update(t,this))return;t.getNumChildrenRequiringUpdateTraversal()>0&&this.traverse(t)}}),"osg","NodeVisitor"),t.exports=a},function(t,e,r){"use strict";var i=r(7),n=r(30),a=r(15).mat4,s=r(15).vec3,o=function(t,e,r,i){n.call(this),this._x=void 0!==t?t:0,this._y=void 0!==e?e:0,this._width=void 0!==r?r:800,this._height=void 0!==i?i:600};i.createPrototypeStateAttribute(o,i.objectInherit(n.prototype,{attributeType:"Viewport",cloneType:function(){return new o},apply:function(t){var e=t.getGraphicContext();e.viewport(this._x,this._y,this._width,this._height)},setViewport:function(t,e,r,i){this._x=t,this._y=e,this._width=r,this._height=i},x:function(){return this._x},y:function(){return this._y},width:function(){return this._width},height:function(){return this._height},computeWindowMatrix:function(){var t=a.create(),e=a.create(),r=s.create();return function(i){a.fromTranslation(t,s.ONE),a.fromScaling(e,[.5*this._width,.5*this._height,.5]);var n=a.fromTranslation(i,s.set(r,this._x,this._y,0));return a.mul(n,n,a.mul(e,e,t))}}()}),"osg","Viewport"),t.exports=o},function(t,e,r){"use strict";var i=r(7),n=r(30),a=function(t,e,r,i){n.call(this),this._x=void 0!==t?t:-1,this._y=void 0!==e?e:-1,this._width=void 0!==r?r:-1,this._height=void 0!==i?i:-1};i.createPrototypeStateAttribute(a,i.objectInherit(n.prototype,{attributeType:"Scissor",cloneType:function(){return new a},apply:function(t){var e=t.getGraphicContext();this._x!==-1?(e.enable(e.SCISSOR_TEST),e.scissor(this._x,this._y,this._width,this._height)):e.disable(e.SCISSOR_TEST)},setScissor:function(t,e,r,i){this._x=t,this._y=e,this._width=r,this._height=i},x:function(){return this._x},y:function(){return this._y},width:function(){return this._width},height:function(){return this._height}}),"osg","Scissor"),t.exports=a},function(t,e,r){"use strict";var i=r(9),n=r(37),a=function(t){this._enabled=!1,this.reset(t)};a.FRAME_COUNT=0,a.instance=function(t,e){return a._instance?t&&(a._instance.getContext()!==t||e)&&(a._instance.setContext(t),a._instance.reset(t)):a._instance=new a(t),a._instance},a.prototype={reset:function(t){if(t){var e=n.instance(t).getDisjointTimerQuery();if(!e)return this;if(t.getQueryParameter||(t.getQueryParameter=e.getQueryObjectEXT.bind(e)),this._hasTimeElapsed=t.getQuery(e.TIME_ELAPSED_EXT,e.QUERY_COUNTER_BITS_EXT)>=30,this._hasTimeStamp=t.getQuery(e.TIMESTAMP_EXT,e.QUERY_COUNTER_BITS_EXT)>=30,!this._hasTimeElapsed&&!this._hasTimeStamp)return this;this._hasTimeStamp||i.debug("Warning: do not use interleaved GPU query"),this._ext=e,this._gl=t,this._enabled=!0}this._frameAverageCount=10,this._glQueries=[],this._queriesByID={},this._userQueries=[],this._queryCount=0,this._nbOpened=0},getContext:function(){return this._gl},setContext:function(t){this._gl=t},setFrameAverageCount:function(t){this._frameAverageCount=t},clearQueries:function(){for(var t=this._glQueries,e=0,r=t.length;e<r;++e){var i=t[e];this._gl.deleteQuery(i._pollingStartQuery),i._pollingEndQuery&&this._gl.deleteQuery(i)}this._userQueries.length=0,this._glQueries.length=0,this._queriesByID={}},supportTimeStamp:function(){return this._hasTimeStamp},enable:function(){this._enabled=!!this._ext},disable:function(){this._enabled=!1},isEnabled:function(){return this._enabled},setCallback:function(t){this._callback=t},createUserQuery:function(t){var e;return e=this._hasTimeStamp?this.createGLQuery():{_startIndex:0,_endIndex:0},e._id=t,e._frame=a.FRAME_COUNT,e._isOpened=!0,e._siblings=[],e},createGLQuery:function(){var t={};return t._isWaiting=!1,t._pollingStartQuery=void 0,t._pollingEndQuery=void 0,t._averageTimer=0,t._resultCount=0,this._hasTimeStamp&&(t._pollingEndQuery=this._gl.createQuery()),t._pollingStartQuery=this._gl.createQuery(),this._glQueries.push(t),t},getOrCreateLastGLQuery:function(){var t=this._glQueries[this._queryCount-1];return t?t:t=this._glQueries[this._queryCount-1]=this.createGLQuery()},beginCurrentQuery:function(){if(0!==this._nbOpened){this._queryCount++;var t=this.getOrCreateLastGLQuery();t._isWaiting||this._gl.beginQuery(this._ext.TIME_ELAPSED_EXT,t._pollingStartQuery)}},endCurrentQuery:function(){0!==this._nbOpened&&(this.getOrCreateLastGLQuery()._isWaiting||this._gl.endQuery(this._ext.TIME_ELAPSED_EXT))},getAvailableQueryByID:function(t){var e=this._queriesByID[t];if(!e)return e=this._queriesByID[t]=this.createUserQuery(t),this._userQueries.push(e),e;if(e._frame===a.FRAME_COUNT){if(e._isOpened)return e;for(var r=e._siblings,i=0,n=r.length;i<n;++i){var s=r[i];if(s._frame!==a.FRAME_COUNT||s._isOpened)return s._frame=a.FRAME_COUNT,s}var o=this.createUserQuery();return r.push(o),o}return e._frame=a.FRAME_COUNT,e},start:function(t){if(this._enabled){var e=this.getAvailableQueryByID(t);e._isOpened=!0,this._hasTimeStamp?e._isWaiting||this._ext.queryCounterEXT(e._pollingStartQuery,this._ext.TIMESTAMP_EXT):(this.endCurrentQuery(),this._nbOpened++,e._startIndex=this._queryCount,this.beginCurrentQuery())}},end:function(t){if(this._enabled){var e=this.getAvailableQueryByID(t);e._isOpened=!1,this._hasTimeStamp?e._isWaiting||this._ext.queryCounterEXT(e._pollingEndQuery,this._ext.TIMESTAMP_EXT):(this.endCurrentQuery(),e._endIndex=this._queryCount,this._nbOpened--,this.beginCurrentQuery())}},computeQueryAverageTime:function(t){for(var e=0,r=this._glQueries,i=t._startIndex;i<t._endIndex;++i){var n=r[i]._averageTimer;if(n<0)return-1;e+=n}return e},computeFullAverageTime:function(t){var e=this.computeQueryAverageTime(t);if(e<0)return-1;for(var r=t._siblings,i=0,n=r.length;i<n;++i){var s=r[i];if(s._frame===a.FRAME_COUNT-1){var o=this.computeQueryAverageTime(s);if(o<0)return-1;e+=o}}return e},pollQueries:function(){if(a.FRAME_COUNT++,this._queryCount=0,this._nbOpened=0,this._enabled&&this._callback){var t,e=this._glQueries,r=e.length,i=this._gl.getParameter(this._ext.GPU_DISJOINT_EXT);if(i)for(t=0;t<r;++t)e[t]._isWaiting=!1;else{for(t=0;t<r;++t)this.pollQuery(e[t]);var n=this._userQueries,s=n.length;for(t=0;t<s;++t){var o=n[t],h=this.computeFullAverageTime(o);h>0&&this._callback(h,o._id)}}}},pollQuery:function(t){t._isWaiting=!1;var e=this._hasTimeStamp?t._pollingEndQuery:t._pollingStartQuery,r=this._gl.getQueryParameter(e,this._gl.QUERY_RESULT_AVAILABLE);if(!r)return t._isWaiting=!0,0;var i;if(this._hasTimeStamp){var n=this._gl.getQueryParameter(t._pollingStartQuery,this._gl.QUERY_RESULT),a=this._gl.getQueryParameter(e,this._gl.QUERY_RESULT);i=a-n}else i=this._gl.getQueryParameter(e,this._gl.QUERY_RESULT);return t._resultCount++,t._resultCount>this._frameAverageCount&&(t._averageTimer=0,t._resultCount=1),t._averageTimer=t._averageTimer+(i-t._averageTimer)/t._resultCount,t._averageTimer}},t.exports=a},function(t,e,r){"use strict";var i=r(7),n=r(133),a=r(87),s=r(80),o=r(137),h=r(77),u=r(134),c=r(139),l=r(141),d=r(138),_=r(83),f=r(82),g=r(81),p=r(75),m=r(142),v=r(143),S=r(144),x=r(145),b=r(146),y=r(78),M=r(79),T=r(140),A=r(76),C={};i.objectMix(C,l),i.objectMix(C,d),C.Animation=n,C.SkinningAttribute=a,C.AnimationUpdateCallback=s,C.BasicAnimationManager=o,C.Bone=h,C.Channel=u,C.CollectAnimationUpdateCallbackVisitor=c,C.MorphAttribute=_,C.MorphGeometry=f,C.RigGeometry=g,C.Skeleton=p,C.StackedMatrix=m,C.StackedQuaternion=v,C.StackedRotateAxis=S,C.StackedScale=x,C.StackedTranslate=b,C.UpdateBone=y,C.UpdateMatrixTransform=M,C.UpdateMorph=T,C.UpdateSkeleton=A,t.exports=C},function(t,e,r){"use strict";var i=r(134),n=0,a=function(t,e){for(var r=1/0,i=-(1/0),a=0;a<t.length;a++)r=Math.min(r,t[a].start),i=Math.max(i,t[a].end);var s=i-r,o=e||"animation"+n.toString();return n++,{channels:t,duration:s,name:o,start:r}},s=function(t){for(var e=[],r=0;r<t.channels.length;r++){var n=i.createInstanceChannel(t.channels[r]);e.push(n)}return{channels:e,duration:t.duration,start:0,name:t.name,firstKeyTime:t.start}},o=function(){};o.createAnimation=a,o.createInstanceAnimation=s,t.exports=o},function(t,e,r){"use strict";var i=r(15).vec3,n=r(15).quat,a=r(135),s=r(136),o={},h=function(t,e,r,i,n,a){var s=r[0],o=r[r.length-1];return a.start=s,a.keys=e,a.end=o,a.times=r,a.type=t,a.duration=o-s,a.target=i,a.name=n,a},u=function(t,e,r,i,n){return h(s.Vec3,t,e,r,i,n||{})},c=function(t,e,r,i,n){return h(s.Float,t,e,r,i,n||{})},l=function(t,e,r,i,n){return h(s.Quat,t,e,r,i,n||{})},d=function(t,e,r,i,n){return h(s.QuatSlerp,t,e,r,i,n||{})},_=function(t,e,r,i,n){return h(s.FloatCubicBezier,t,e,r,i,n||{})},f=function(t,e,r,i,n){return h(s.Vec3CubicBezier,t,e,r,i,n||{})},g={create:function(){return 0}},p={create:function(){return i.create32()}},m={create:function(){return n.create32()}},v=function(t,e){return{channel:e,value:t.create(),targetID:a.InvalidTargetID,weight:1,key:0,start:0,end:0}},S=function(t){return v(p,t)},x=function(t){return v(m,t)},b=function(t){return v(g,t)},y=function(t){return v(g,t)},M=function(t){return v(p,t)},T=function(t){return o[t.type](t)};o.createInstanceChannel=T,o.createInstanceVec3Channel=S,o.createInstanceQuatChannel=x,o.createInstanceQuatSlerpChannel=x,o.createInstanceFloatChannel=b,o.createInstanceFloatCubicBezierChannel=y,o.createInstanceVec3CubicBezierChannel=M,o.createVec3Channel=u,o.createQuatChannel=l,o.createQuatSlerpChannel=d,o.createFloatChannel=c,o.createFloatCubicBezierChannel=_,o.createVec3CubicBezierChannel=f,o[s.Vec3]=S,o[s.Quat]=x,o[s.QuatSlerp]=x,o[s.Float]=b,o[s.FloatCubicBezier]=y,o[s.Vec3CubicBezier]=M,o.ChannelType=s,t.exports=o},function(t,e,r){"use strict";var i=r(15).mat4,n=r(15).quat,a=r(15).vec3,s=r(136),o={};o.InvalidTargetID=-1;var h=function(t,e,r){return{type:t,id:o.InvalidTargetID,channels:[],value:e,defaultValue:r}},u=function(t){return h(s.Quat,n.copy(n.create(),t),n.copy(n.create(),t))},c=function(t){return h(s.Matrix,i.copy(i.create(),t),i.copy(i.create(),t))},l=function(t){return h(s.Vec3,a.copy(a.create(),t),a.copy(a.create(),t))},d=function(t){return h(s.Float,t,t)};o.createQuatTarget=u,o.createVec3Target=l,o.createFloatTarget=d,o.createMatrixTarget=c,t.exports=o},function(t,e){"use strict";t.exports={Vec3:0,Quat:1,Float:2,FloatCubicBezier:3,Vec3CubicBezier:4,QuatSlerp:5,Matrix:6,Count:7}},function(t,e,r){"use strict";var i=r(9),n=r(7),a=r(13),s=r(15).quat,o=r(15).vec3,h=r(15).mat4,u=r(134),c=r(133),l=r(138),d=r(139),_=r(135),f=r(140),g={lerp:function(t,e,r){return t+(e-t)*r},init:function(){return 0},copy:function(t,e){return e},create:function(){return 0}},p=[];p[u.ChannelType.Float]=1,p[u.ChannelType.FloatCubicBezier]=1,p[u.ChannelType.Vec3]=3,p[u.ChannelType.Vec3CubicBezier]=3,p[u.ChannelType.Quat]=4,p[u.ChannelType.QuatSlerp]=4,p[u.ChannelType.Matrix]=16;var m=[];m.length=u.ChannelType.Count,m[u.ChannelType.Vec3]=o,m[u.ChannelType.Quat]=s,m[u.ChannelType.QuatSlerp]=s,m[u.ChannelType.Float]=g,m[u.ChannelType.FloatCubicBezier]=g,m[u.ChannelType.Vec3CubicBezier]=o,m[u.ChannelType.Matrix]=h;var v=function(){a.call(this),this._simulationTime=0,this._pauseTime=0,this._timeFactor=1,this._startTime=0,this._instanceAnimations={},this._startAnimations={},this._targets=[],this._targetsMap={},this._targetsByTypes=[],this._targetsByTypes.length=u.ChannelType.Count;for(var t=0,e=this._targetsByTypes.length;t<e;t++)this._targetsByTypes[t]=[];this._activeAnimations={},this._activeAnimationList=[],this._activeChannelsByTypes=[],this._activeChannelsByTypes.length=u.ChannelType.Count;for(var r=0,i=this._activeChannelsByTypes.length;r<i;r++)this._activeChannelsByTypes[r]=[];this._animationsUpdateCallback={},this._animationsUpdateCallbackArray=[],this._animationsToRegister=[],this._pause=!1,this._dirty=!1,this._seekTime=-1};n.createPrototypeObject(v,n.objectInherit(a.prototype,{init:function(t){this._simulationTime=0,this._pauseTime=0,this._timeFactor=1,this._startTime=0,this._instanceAnimations={},this._startAnimations={},this._resetTargets(),this._activeAnimations={},this._activeAnimationList.length=0;for(var e=0,r=this._activeChannelsByTypes.length;e<r;e++)this._activeChannelsByTypes[e].length=0;this._animationsUpdateCallback={},this._animationsUpdateCallbackArray.length=0,this._pause=!1,this._seekTime=-1,this.addAnimations(t)},addAnimations:function(t){var e=this._addAnimation(t);Array.prototype.push.apply(this._animationsToRegister,e),this._dirty=!0,this._registerAnimations()},update:function(t,e){this._dirty&&(this._findAnimationUpdateCallback(t),this._registerTargetFoundInAnimationCallback(),this._registerAnimations());var r=e.getFrameStamp().getSimulationTime();return this._seekTime!==-1&&(this._pauseTime=-this._seekTime+this._startTime+r),this._seekTime=-1,this._pause?this._pauseTime=r-this._simulationTime+this._startTime:this._simulationTime=this._startTime+(r-this._pauseTime),this.updateManager(this._simulationTime*this._timeFactor),!0},updateManager:function(t){this._processStartAnimation(t);for(var e=u.ChannelType.Count,r=0;r<e;r++){var i=this._activeChannelsByTypes[r];this._updateChannelsType(t,i,l[r])}for(var n=0;n<e;n++){var a=this._targetsByTypes[n];this._updateTargetType(a,m[n])}for(var s=0,o=this._animationsUpdateCallbackArray.length;s<o;s++){var h=this._animationsUpdateCallbackArray[s];h.computeChannels()}this._removeFinishedAnimation(t)},togglePause:function(){this._pause=!this._pause,this._pause||(this._seekTime=this._simulationTime)},getSimulationTime:function(){return this._simulationTime},setSimulationTime:function(t){this._simulationTime=t},setSeekTime:function(t){this._simulationTime=t,this._seekTime=t},stopAnimation:function(t){for(var e=this._activeAnimationList,r=0,i=e.length;r<i;++r)if(e[r].name===t)return this._removeActiveChannels(this._instanceAnimations[t]),this._activeAnimations[t]=void 0,void e.splice(r,1)},stopAllAnimation:function(){for(var t=this._activeAnimationList,e=0,r=t.length;e<r;++e){var i=t[e].name;this._removeActiveChannels(this._instanceAnimations[i]),this._activeAnimations[i]=void 0}t.length=0},setTimeFactor:function(t){var e=t/this._timeFactor;this._startTime+=(this._simulationTime-this._simulationTime*e)/e,this._timeFactor=t,this._pause&&(this._simulationTime+=(this._simulationTime-this._simulationTime*e)/e)},getTimeFactor:function(){return this._timeFactor},isPlaying:function(t){return!!this._activeAnimations[t]},playAnimationObject:function(t){var e=this._instanceAnimations[t.name];return e?void(this.isPlaying(t.name)||(e.priority=void 0===t.priority?0:t.priority,e.weight=void 0===t.weight?1:t.weight,e.loop=void 0===t.loop||t.loop,this._startAnimations[e.name]=e)):void i.info("no animation "+t.name+" found")},playAnimation:function(t,e,r,i){var n;return n="object"==typeof t?t:{name:t,priority:r,weight:i,loop:e},this.playAnimationObject(n)},getAnimations:function(){return this._instanceAnimations},_registerAnimations:function(){if(this._targets.length){for(var t=0,e=this._animationsToRegister.length;t<e;t++){var r=this._animationsToRegister[t];this._registerInstanceAnimation(r)}this._animationsToRegister.length=0,this._dirty=!1}},_registerInstanceAnimation:function(t){for(var e=t.channels,r=0,n=e.length;r<n;r++){var a=e[r],s=a.channel.target,o=a.channel.name,h=s+"."+o;this._targetMap[h]?a.targetID=this._targetMap[h].id:i.warn("registerInstanceAnimation did not find targetName ("+h+") in the scene graph")}return!0},_findAnimationUpdateCallback:function(t){var e=new d;t.accept(e),this._animationsUpdateCallback=e.getAnimationUpdateCallbackMap()},_registerTargetFoundInAnimationCallback:function(){this._resetTargets();var t,e,r,n=0,a=this._targetMap,s=this._targets,o=function(t,e,r){if(a[t])e!==a[t]&&i.warn("detected differents target instance with the same name ("+r+")");else{a[t]=e,e.id=n++,s.push(e);var o=e.type;this._targetsByTypes[o].push(e)}}.bind(this);for(var h in this._animationsUpdateCallback){var u=this._animationsUpdateCallback[h];if(u.getStackedTransforms&&u.getStackedTransforms().length){this._animationsUpdateCallbackArray.push(u);for(var c=u.getStackedTransforms(),l=0,d=c.length;l<d;l++){var _=c[l];t=_.getTarget(),e=_.getName(),r=u.getName()+"."+e,o(r,t,e)}}else if(u instanceof f)for(var g=0,p=u.getNumTarget();g<p;g++)e=u.getTargetName(g),r=e+"."+g,t=u.getTarget(g),o(r,t,e)}},_addAnimation:function(t){for(var e=[],r=0,i=t.length;r<i;r++){var n=t[r],a=n.name;if(!this._instanceAnimations[a]){var s=c.createInstanceAnimation(n);this._instanceAnimations[a]=s,e.push(s)}}return e},_addActiveChannels:function(t,e){for(var r=e.channels,i=0,n=r.length;i<n;i++){var a=r[i],s=a.channel.type;a.t=t,a.instanceAnimation=e;var o=a.targetID;o!==_.InvalidTargetID&&(this._activeChannelsByTypes[s].push(a),this._targets[o].channels.push(a))}},_removeActiveChannels:function(t){for(var e=t.channels,r=0,i=e.length;r<i;r++){var n=e[r],a=n.channel.type,s=n.targetID;if(s!==_.InvalidTargetID){var o=this._targets[s].channels,h=o.indexOf(n);o.splice(h,1);var u=this._activeChannelsByTypes[a],c=u.indexOf(n);u.splice(c,1)}}},_updateTargetType:function(t,e){for(var r=0,i=t.length;r<i;r++){var n=t[r],a=n.channels,s=a.length;if(0===s)n.value=e.copy(n.value,n.defaultValue);else if(1===s)n.value=e.copy(n.value,a[0].value);else{n.value=e.init(n.value);for(var o=0,h=0,u=a.length;h<u;h++){var c=a[h],l=c.weight;if(o+=l,0!==o&&0!==l){var d=l/o;n.value=e.lerp(n.value,n.value,c.value,d)}}}}},_updateChannelsType:function(t,e,r){for(var i=0,n=e.length;i<n;i++){var a=e[i],s=a.instanceAnimation,o=s.loop,h=t-a.t;o&&s.duration>0&&(h%=s.duration),r(h+s.firstKeyTime,a)}},_removeFinishedAnimation:function(t){for(var e=this._activeAnimationList,r=0;r<e.length;){var i=e[r],n=i.name;t>i.end&&i.loop===!1?(this._removeActiveChannels(i),this._activeAnimations[n]=void 0,e.splice(r,1)):r++}},_addActiveAnimation:function(t,e){this._activeAnimations[e.name]=e;var r=this._instanceAnimations[e.name];r.start=t,r.end=t+r.duration,this._addActiveChannels(t,r),this._activeAnimationList.push(r)},_processStartAnimation:function(t){if(this._targets.length){var e;for(e in this._startAnimations){var r=this._startAnimations[e],i=r.name;this.isPlaying(i)||this._addActiveAnimation(t,r)}void 0!==e&&(this._startAnimations={})}},_resetTargets:function(){this._targetMap={},this._targets.length=0;for(var t=0,e=this._targetsByTypes.length;t<e;t++)this._targetsByTypes[t].length=0},resetAllStackedTransforms:function(){for(var t=this._animationsUpdateCallbackArray,e=0,r=t.length;e<r;e++){for(var i=t[e].getStackedTransforms(),n=0,a=i.length;n<a;n++)i[n].resetToDefaultValue();t[e].computeChannels()}},setAnimationLerpEndStart:function(t,e){var r=t.channels;void 0===t.originalDuration&&(t.originalDuration=t.duration),t.duration=t.originalDuration+e;for(var i=t.firstKeyTime,n=t.originalDuration,a=0,s=r.length;a<s;++a){var o=r[a].channel;if(!(Math.abs(o.start-i)>.01||Math.abs(o.duration-n)>.01)){void 0===o.originalEnd&&(o.originalEnd=o.end),o.end=o.originalEnd+e;var h=p[o.type],u=o.times.buffer.byteLength/4;if(0===e)o.keys=new Float32Array(o.keys.buffer,0,(u-1)*h),o.times=new Float32Array(o.times.buffer,0,u-1);else{o.keys=new Float32Array(o.keys.buffer,0,u*h);for(var c=(u-1)*h,l=0;l<h;++l)o.keys[c+l]=o.keys[l];o.times=new Float32Array(o.times.buffer,0,u),o.times[u-1]=o.times[u-2]+e}}}}}),"osgAnimation","BasicAnimationManager"),v.TypeToSize=p,t.exports=v},function(t,e,r){"use strict";var i=r(15).vec3,n=r(15).quat,a=r(134),s=function(t,e,r){r[0]=e[t++],r[1]=e[t++],r[2]=e[t++]},o=function(t,e,r){r[0]=e[t++],r[1]=e[t++],r[2]=e[t++],r[3]=e[t++]},h=function(t,e){var r=e.channel,i=e.value,n=r.keys,a=r.times;if(t>=a[a.length-1])return e.key=0,void s(n.length-3,n,i);if(t<=a[0])return e.key=0,void s(0,n,i);var o=e.key;if(t>a[o])for(;a[o+1]<t;)o++;else if(t<a[o])for(;a[o]>t;)o--;var h=a[o],u=a[o+1],c=3*o,l=n[c++],d=n[c++],_=n[c++],f=n[c++],g=n[c++],p=n[c++],m=(t-h)/(u-h);i[0]=l+(f-l)*m,i[1]=d+(g-d)*m,i[2]=_+(p-_)*m,e.key=o},u=function(){var t=n.create32(),e=n.create32();return function(r,i){var a=i.channel,s=i.value,h=a.keys,u=a.times;if(r>=u[u.length-1])return i.key=0,void o(h.length-4,h,s);if(r<=u[0])return i.key=0,void o(0,h,s);var c=i.key;if(r>u[c])for(;u[c+1]<r;)c++;else if(r<u[c])for(;u[c]>r;)c--;var l=u[c],d=u[c+1],_=4*c;t[0]=h[_++],t[1]=h[_++],t[2]=h[_++],t[3]=h[_++],e[0]=h[_++],e[1]=h[_++],e[2]=h[_++],e[3]=h[_++];var f=(r-l)/(d-l);n.nlerp(s,t,e,f),i.key=c}}(),c=function(){var t=n.create32(),e=n.create32();return function(r,i){var a=i.channel,s=i.value,h=a.keys,u=a.times;if(r>=u[u.length-1])return i.key=0,void o(h.length-4,h,s);if(r<=u[0])return i.key=0,void o(0,h,s);var c=i.key;if(r>u[c])for(;u[c+1]<r;)c++;else if(r<u[c])for(;u[c]>r;)c--;var l=u[c],d=u[c+1],_=4*c;t[0]=h[_++],t[1]=h[_++],t[2]=h[_++],t[3]=h[_++],e[0]=h[_++],e[1]=h[_++],e[2]=h[_++],e[3]=h[_++];var f=(r-l)/(d-l);n.slerp(s,t,e,f),i.key=c}}(),l=function(t,e){var r=e.channel,i=e.value,n=r.keys,a=r.times;if(t>=a[a.length-1])return e.key=0,void(e.value=n[n.length-1]);if(t<=a[0])return e.key=0,void(e.value=n[0]);var s=e.key;if(t>a[s])for(;a[s+1]<t;)s++;else if(t<a[s])for(;a[s]>t;)s--;var o=a[s],h=a[s+1],u=s,c=n[u++],l=n[u++],d=(t-o)/(h-o);i=c+(l-c)*d,e.key=s,e.value=i},d=function(t,e){var r=e.channel,i=e.value,n=r.keys,a=r.times;if(t>=a[a.length-1])return e.key=0,void(e.value=n[n.length-3]);if(t<=a[0])return e.key=0,void(e.value=n[0]);var s=e.key;if(t>a[s])for(;a[s+1]<t;)s++;else if(t<a[s])for(;a[s]>t;)s--;var o=(t-a[s])/(a[s+1]-a[s]),h=1-o,u=h*h,c=u*h,l=o*o,d=3*s,_=n[d]*c,f=n[d+1]*(3*o*u),g=n[d+2]*(3*l*h),p=n[d+3]*(l*o);i=_+f+g+p,e.key=s,e.value=i},_=function(){var t=i.create(),e=i.create(),r=i.create(),n=i.create();return function(a,o){var h=o.channel,u=o.value,c=h.keys,l=h.times;if(a>=l[l.length-1])return o.key=0,void s(c.length-9,c,u);if(a<=l[0])return o.key=0,void s(0,c,u);var d=o.key;if(a>l[d])for(;l[d+1]<a;)d++;else if(a<l[d])for(;l[d]>a;)d--;var _=(a-l[d])/(l[d+1]-l[d]),f=1-_,g=f*f,p=g*f,m=_*_,v=9*d;i.scale(t,i.set(t,c[v++],c[v++],c[v++]),p),i.scale(e,i.set(e,c[v++],c[v++],c[v++]),3*_*g),i.scale(r,i.set(r,c[v++],c[v++],c[v++]),3*m*f),i.scale(n,i.set(n,c[v++],c[v++],c[v++]),m*_),u[0]=t[0]+e[0]+r[0]+n[0],u[1]=t[1]+e[1]+r[1]+n[1],u[2]=t[2]+e[2]+r[2]+n[2],o.key=d}}(),f=a.ChannelType,g={};g[f.Vec3]=h,g[f.Quat]=u,g[f.QuatSlerp]=c,g[f.Float]=l,g[f.FloatCubicBezier]=d,g[f.Vec3CubicBezier]=_,g.Vec3LerpInterpolator=h,g.QuatLerpInterpolator=u,g.QuatSlerpInterpolator=c,g.FloatLerpInterpolator=l,g.FloatCubicBezierInterpolator=d,g.Vec3CubicBezierInterpolator=_,t.exports=g},function(t,e,r){"use strict";var i=r(7),n=r(31),a=r(80),s=function(){n.call(this),this._animationUpdateCallback={}};i.createPrototypeObject(s,i.objectInherit(n.prototype,{getAnimationUpdateCallbackMap:function(){return this._animationUpdateCallback},apply:function(t){for(var e=t.getUpdateCallbackList(),r=0,i=e.length;r<i;r++){var n=e[r];n instanceof a&&(this._animationUpdateCallback[n.getInstanceID()]=n)}this.traverse(t)}}),"osgAnimation","CollectAnimationUpdateCallbackVisitor"),t.exports=s},function(t,e,r){"use strict";var i=r(7),n=r(48),a=r(81),s=r(80),o=r(135),h=r(82),u=function(){s.call(this),this._targets=[],this._targetNames=[],this._morphs=[],this._weights=new Float32Array(h.MAX_MORPH_GPU),this._indexMap=new Uint32Array(h.MAX_MORPH_GPU),this._gpuMorphed=[],this._maxMorphGPU=-1},c=h.EFFECTIVE_EPS,l=function(t,e){return Math.abs(e.value)-Math.abs(t.value)};i.createPrototypeObject(u,i.objectInherit(s.prototype,{init:function(t){this._maxMorphGPU=h.MAX_MORPH_GPU,this._morphs.length=0;for(var e=t.getChildren(),r=0,i=e.length;r<i;r++){var n,s=e[r];s instanceof h?n=s:s instanceof a&&s.getSourceGeometry()instanceof h&&(n=s.getSourceGeometry()),n&&n.getName()===this.getName()&&(n.isInitialized()||n.init(),this._morphs.push(n),this._maxMorphGPU=Math.min(this._maxMorphGPU,n.getMaximumPossibleMorphGPU()))}},isInitialized:function(){
var t=this._morphs,e=t.length;if(!e)return!1;for(var r=0;r<e;++r)if(!t[r].isInitialized())return!1;return!0},getNumTarget:function(){return this._targets.length},getTarget:function(t){return this._targets[t]},getTargetName:function(t){return this._targetNames[t]},addTarget:function(t,e){this._targets[e]=o.createFloatTarget(0),this._targetNames[e]=t},_remapBufferArrays:function(){for(var t=this._indexMap,e=this._morphs,r=0;r<this._maxMorphGPU;++r)for(var i=t[r],n="_"+r,a="_"+i,s=0,o=e.length;s<o;++s)for(var h=e[s],u=h.getVertexAttributeList(),c=h.getMorphTargetNames(),l=0,d=c.length;l<d;++l){var _=c[l];u[_+n].setBufferArray(u[_+a].getInitialBufferArray())}},_mergeExtraMorphTarget:function(t,e,r){var i=0,a=this._gpuMorphed,s=t[e],o=s.getElements().length,h=o/s.getItemSize(),u=s.getItemSize();s._cpuMorph=s._cpuMorph||new n(n.ARRAY_BUFFER,new Float32Array(o),u);var l=s._cpuMorph.getElements();for(i=0;i<o;++i)l[i]=0;for(var d=this._targets,_=0,f=d.length;_<f;++_)if(a[_]!==!0){var g=d[_].value;if(!(Math.abs(g)<c)){g/=r;var p=t[e+"_"+_].getInitialBufferArray().getElements();for(i=0;i<h;++i){var m=i*u;l[m]+=g*p[m],l[m+1]+=g*p[m+1],l[m+2]+=g*p[m+2]}}}t[e+"_"+(this._maxMorphGPU-1)].setBufferArray(s._cpuMorph),s._cpuMorph.dirty()},_computeExtraWeightsSum:function(){for(var t=this._gpuMorphed,e=0,r=this._targets,i=0,n=r.length;i<n;++i)if(t[i]!==!0){var a=r[i].value;Math.abs(a)<c||(e+=a)}var s=1e-5;return Math.abs(e)>s?e:e<0?-s:s},_morphBufferArrayCPU:function(){for(var t=this._weights[this._maxMorphGPU-1]=this._computeExtraWeightsSum(),e={},r=this._morphs,i=0,n=r.length;i<n;++i)for(var a=r[i],s=a.getVertexAttributeList(),o=a.getMorphTargetNames(),h=0,u=o.length;h<u;++h){var c=o[h],l=s[c];l&&!e[l.getInstanceID()]&&(e[l.getInstanceID()]=!0,this._mergeExtraMorphTarget(s,c,t))}},updateWeights:function(){if(0!==this._maxMorphGPU){var t=0,e=this._targets,r=e.length,i=this._weights;if(i[0]=i[1]=i[2]=i[3]=0,r<=this._maxMorphGPU)for(t=0;t<r;++t)i[t]=e[t].value;else{var n=this._indexMap;n[0]=n[1]=n[2]=n[3]=0;var a=this._gpuMorphed;for(a.length=r,t=0;t<r;++t)a[t]=!1;var s=e.slice(0).sort(l);for(t=0;t<this._maxMorphGPU;++t){var o=e.indexOf(s[t]);a[o]=!0,n[t]=o,i[t]=s[t].value}var h=Math.abs(s[this._maxMorphGPU].value)>=c;a[n[this._maxMorphGPU-1]]=!h,this._remapBufferArrays(),h&&this._morphBufferArrayCPU()}}},update:function(t){this.isInitialized()||this.init(t),this.updateWeights();for(var e=this._weights,r=Math.min(this._maxMorphGPU,this._targets.length),i=this._morphs,n=0,a=i.length;n<a;++n)for(var s=i[n].getTargetsWeight(),o=0;o<r;o++)s[o]=e[o];return!0}}),"osgAnimation","UpdateMorph"),t.exports=u},function(t,e){"use strict";var r=function(t){return-(t*(t-2))},i=function(t){return t*t},n=function(t){return t-=1,t*t*t+1},a=function(t){return t*t*t},s=function(t){return t-=1,-(t*t*t*t-1)},o=function(t){return t*t*t*t},h=function(t){return Math.pow(2,-10*t)*Math.sin((t-.075)*(2*Math.PI)/.3)+1},u=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375};t.exports={easeOutQuad:r,easeInQuad:i,easeOutCubic:n,easeInCubic:a,easeOutQuart:s,easeInQuart:o,easeOutElastic:h,easeOutBounce:u,EaseOutQuad:r,EaseInQuad:i,EaseOutCubic:n,EaseInCubic:a,EaseOutQuart:s,EaseInQuart:o,EaseOutElastic:h,EaseOutBounce:u}},function(t,e,r){"use strict";var i=r(7),n=r(13),a=r(15).mat4,s=r(135),o=function(t,e){n.call(this),this._target=s.createMatrixTarget(e||a.IDENTITY),t&&this.setName(t)};i.createPrototypeObject(o,i.objectInherit(n.prototype,{init:function(t){this.setMatrix(t),a.copy(this._target.defaultValue,t)},getTarget:function(){return this._target},getMatrix:function(){return this._target.value},setMatrix:function(t){a.copy(this._target.value,t)},resetToDefaultValue:function(){this.setMatrix(this._target.defaultValue)},applyToMatrix:function(t){a.mul(t,t,this._target.value)}}),"osgAnimation","StackedMatrix"),t.exports=o},function(t,e,r){"use strict";var i=r(7),n=r(13),a=r(15).mat4,s=r(15).quat,o=r(135),h=s.create(),u=function(t,e){n.call(this),this._target=o.createQuatTarget(e||h),t&&this.setName(t)};i.createPrototypeObject(u,i.objectInherit(n.prototype,{init:function(t){this.setQuaternion(t),s.copy(this._target.defaultValue,t)},setQuaternion:function(t){s.copy(this._target.value,t)},getTarget:function(){return this._target},resetToDefaultValue:function(){this.setQuaternion(this._target.defaultValue)},applyToMatrix:function(){var t=a.create();return function(e){var r=t;a.fromQuat(r,this._target.value),a.mul(e,e,r)}}()}),"osgAnimation","StackedQuaternion"),t.exports=u},function(t,e,r){"use strict";var i=r(7),n=r(13),a=r(15).mat4,s=r(15).vec3,o=r(15).quat,h=r(135),u=function(t,e,r){n.call(this),this._axis=s.fromValues(0,0,1),e&&s.copy(this._axis,e),this._target=h.createFloatTarget("number"==typeof r?r:0),t&&this.setName(t)};i.createPrototypeObject(u,i.objectInherit(n.prototype,{init:function(t,e){this.setAxis(t),this.setAngle(e),this._target.defaultValue=e},setAxis:function(t){s.copy(this._axis,t)},setAngle:function(t){this._target.value=t},getTarget:function(){return this._target},resetToDefaultValue:function(){this.setAngle(this._target.defaultValue)},applyToMatrix:function(){var t=a.create(),e=o.create();return function(r){var i=this._axis,n=e,s=t,h=this._target.value;o.setAxisAngle(n,i,h),a.fromQuat(s,n),a.mul(r,r,s)}}()}),"osgAnimation","StackedRotateAxis"),t.exports=u},function(t,e,r){"use strict";var i=r(7),n=r(13),a=r(15).mat4,s=r(15).vec3,o=r(135),h=function(t,e){n.call(this),this._target=o.createVec3Target(e||s.ONE),t&&this.setName(t)};i.createPrototypeObject(h,i.objectInherit(n.prototype,{init:function(t){this.setScale(t),s.copy(this._target.defaultValue,t)},setScale:function(t){s.copy(this._target.value,t)},getTarget:function(){return this._target},resetToDefaultValue:function(){this.setScale(this._target.defaultValue)},applyToMatrix:function(t){var e=this._target.value;a.scale(t,t,e)}}),"osgAnimation","StackedScale"),t.exports=h},function(t,e,r){"use strict";var i=r(7),n=r(13),a=r(15).vec3,s=r(15).mat4,o=r(135),h=function(t,e){n.call(this),this._target=o.createVec3Target(e||a.ZERO),t&&this.setName(t)};i.createPrototypeObject(h,i.objectInherit(n.prototype,{init:function(t){this.setTranslate(t),a.copy(this._target.defaultValue,t)},setTranslate:function(t){a.copy(this._target.value,t)},getTarget:function(){return this._target},resetToDefaultValue:function(){this.setTranslate(this._target.defaultValue)},applyToMatrix:function(t){s.translate(t,t,this._target.value)}}),"osgAnimation","StackedTranslate"),t.exports=h},function(t,e,r){"use strict";var i=r(7),n=r(148),a=r(153),s=r(155),o=r(156),h=r(157),u=r(158),c=r(154),l=r(160),d={};d.Input=n,i.objectMix(d,a),d.DatabasePager=s,d.ObjectWrapper.serializers.osg=o,d.ObjectWrapper.serializers.osgAnimation=h,d.ObjectWrapper.serializers.osgText=u,d.Registry=c,d.FileHelper=l,d.requestFile=r(149);var _=r(151);i.objectMix(d,_),t.exports=d},function(t,e,r){"use strict";var i=r(95),n=r(7),a=r(3),s=r(149),o=r(150),h=r(151),u=r(9),c=r(42),l=r(48),d=r(91),_=r(90),f=r(45),g=r(46),p=function(t,e){this._json=t;var r=e;void 0===r&&(r={}),this._identifierMap=r,this._objectRegistry={},this._cacheReadObject={},this.setOptions(n.objectMix({},o))};p.imageFallback||(p.imageFallback=function(){var t=new window.Image;return t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQIW2P8DwQACgAD/il4QJ8AAAAASUVORK5CYII=",t}()),p.prototype={clone:function(){var t=new p;return t._objectRegistry=this._objectRegistry,t._cacheReadObject=this._cacheReadObject,t},setOptions:function(t){this._defaultOptions=t},getOptions:function(){return this._defaultOptions},setProgressXHRCallback:function(t){this._defaultOptions.progressXHRCallback=t},setReadNodeURLCallback:function(t){this._defaultOptions.readNodeURL=t},registerObject:function(t,e){this._objectRegistry[t]=e},getJSON:function(){return this._json},setJSON:function(t){return this._json=t,this},setPrefixURL:function(t){this._defaultOptions.prefixURL=t},getPrefixURL:function(){return this._defaultOptions.prefixURL},setDatabasePath:function(t){this._defaultOptions.databasePath=t},getDatabasePath:function(){return this._defaultOptions.databasePath},computeURL:function(t){return"string"==typeof this._defaultOptions.prefixURL&&this._defaultOptions.prefixURL.length>0?this._defaultOptions.prefixURL+t:t},requestFile:function(t,e){return s(t,e)},getObjectWrapper:function(t){if(this._objectRegistry[t])return new this._objectRegistry[t];for(var e=a,r=t.split("."),i=0,n=r.length;i<n;i++){var s=e[r[i]];if(void 0===s)return;e=s}return this._objectRegistry[t]=e,new e},fetchImage:function(t,e,r){var n="data:image/",a=e.substring(0,n.length)===n,s=new window.Image;return t.setURL(e),t.setImage(s),s.src=e,new i(function(i){s.onerror=function(){u.warn("warning use white texture as fallback instead of "+e),t.setImage(p.imageFallback),i(t)},!a&&r.imageCrossOrigin&&(s.crossOrigin=r.imageCrossOrigin),s.onload=function(){r.imageOnload&&r.imageOnload.call(t),i(t)}})},readImageURL:function(t,e){if(void 0===e&&(e=this._defaultOptions),e.readImageURL)return e.readImageURL.call(this,t,e);"data:image"!==t.substr(0,10)&&(t=this.computeURL(t));var r=new c;return this.fetchImage(r,t,e)},readNodeURL:function(t,e){var a=e;if(void 0===a&&(a=this._defaultOptions),a.readNodeURL)return a.readNodeURL.call(this,t,a);t=this.computeURL(t);var s=this;return new i(function(e,i){if(a=n.objectMix({},a),!a.prefixURL){var o=s.getPrefixURL(),c=t.lastIndexOf("/");c!==-1&&(o=t.substring(0,c+1)),a.prefixURL=o}var l=r(153),d=function(r){return l.parseSceneGraph(r,a).then(function(r){e(r),u.log("loaded "+t)}).catch(function(){i()})},_=function(t){function e(t){return t.length<2?"0"+t:t}function r(t){for(var r="",i=0,n=t.length;i<n;++i)r+="%"+e(t[i].toString(16));return r=decodeURIComponent(r)}var i=t;h.isGunzipBuffer(t)&&(i=h.gunzip(t));var n=new Uint8Array(i),a=r(n);return a};n.time("osgjs.metric:Input.readNodeURL",u.INFO);var f=s.requestFile(t);f.then(function(e){var r;try{r=JSON.parse(e)}catch(e){u.error("cant parse url "+t+" try to gunzip")}if(r)return d(r);var n=s.requestFile(t,{responseType:"arraybuffer"});return n.then(function(t){var e=_(t);r=JSON.parse(e),d(r)}).catch(function(e){u.error("cant read file "+t+" status "+e),i()}),!0}).catch(function(e){u.error("cant get file "+t+" status "+e),i()}).finally(function(){n.timeEnd("osgjs.metric:Input.readNodeURL")})})},_unzipTypedArray:function(t){var e=new Uint8Array(t);if(31===e[0]&&139===e[1]){var i=r(152);i||u.error("osg failed to use a gunzip.min.js to uncompress a gz file.\n You can add this vendors to enable this feature or adds the good header in your gzip file served by your server");var n=new i.Gunzip(e),a=n.decompress();return a.buffer}return t},readBinaryArrayURL:function(t,e){if(void 0===e&&(e=this._defaultOptions),e.readBinaryArrayURL)return e.readBinaryArrayURL.call(this,t,e);if(t=this.computeURL(t),void 0!==this._identifierMap[t])return this._identifierMap[t];var r=this;return this._identifierMap[t]=new i(function(e){var i=r.requestFile(t,{responseType:"arraybuffer",progress:r._defaultOptions.progressXHRCallback});i.then(function(t){e(r._unzipTypedArray(t))}.bind(r))}),this._identifierMap[t]},initializeBufferArray:function(t,e,r,a){if(void 0===a&&(a=this.getOptions()),a.initializeBufferArray)return a.initializeBufferArray.call(this,t,e,r);var s=t.File;return this.readBinaryArrayURL(s).then(function(i){var a,s;!function(){var t=new Uint8Array([18,52]),e=new Uint16Array(t.buffer);s="1234"===e[0].toString(16)}();var o=0;void 0!==t.Offset&&(o=t.Offset);var h=n[e].BYTES_PER_ELEMENT,c=t.Size,l=r.getItemSize(),d=c*h*l;if(s){u.log("big endian detected");var _=n[e],f=new _(c*l),g=new DataView(i,o,d),p=0,m=f.length;if("Uint16Array"===e)for(;p<m;p++)f[p]=g.getUint16(p*h,!0);else if("Float32Array"===e)for(;p<m;p++)f[p]=g.getFloat32(p*h,!0);a=f,g=null}else a=new n[e](i,o,l*c);return r.setElements(a),r}).catch(function(t){u.warn("Can't read binary array URL: "+t),i.reject()})},readBufferArray:function(t){var e,r=this.getJSON(),a=r.UniqueID;if(void 0!==a&&(e=this._identifierMap[a],void 0!==e))return e;if(void 0===t&&(t=this.getOptions()),t.readBufferArray)return t.readBufferArray.call(this);if(!r.Elements&&!r.Array||!r.ItemSize||!r.Type)return i.reject();var s;if(r.Elements)s=i.resolve(new l(l[r.Type],r.Elements,r.ItemSize));else if(r.Array){var o=new l(l[r.Type]);o.setItemSize(r.ItemSize);var h,c;if(r.Array.Float32Array?(h=r.Array.Float32Array,c="Float32Array"):r.Array.Uint16Array?(h=r.Array.Uint16Array,c="Uint16Array"):r.Array.Uint8Array&&(h=r.Array.Uint8Array,c="Uint8Array"),void 0===h)return u.warn("Typed Array "+window.Object.keys(r.Array)[0]),i.reject();h.File?s=this.initializeBufferArray(h,c,o):h.Elements&&(o.setElements(new n[c](h.Elements)),s=i.resolve(o))}return void 0!==a&&(this._identifierMap[a]=s),s},readUserDataContainer:function(){var t,e=this.getJSON(),r=e.UniqueID;return void 0!==r&&(t=this._identifierMap[r],void 0!==t)?t.Values:(this._identifierMap[r]=e,e.Values)},readPrimitiveSet:function(){var t,e,r=this.getJSON(),n=this,a=new i(function(i){var a,s,o,h,c=r.DrawElementUShort||r.DrawElementUByte||r.DrawElementUInt||r.DrawElementsUShort||r.DrawElementsUByte||r.DrawElementsUInt||void 0;if(c){if(t=c.UniqueID,void 0!==t&&(e=n._identifierMap[t],void 0!==e))return e;var l=c.Indices,p=r;s=c.Mode,s=s?g[s]:g.TRIANGLES,a=new f(s),n.setJSON(l),n.readBufferArray().then(function(t){a.setIndices(t),i(a)}).catch(function(){u.warn("Error buffer array")}),n.setJSON(p)}var m=r.DrawArray||r.DrawArrays;if(m){t=m.UniqueID,void 0!==t&&(e=n._identifierMap[t],void 0!==e&&i(e)),s=m.Mode||m.mode,o=void 0!==m.First?m.First:m.first,h=void 0!==m.Count?m.Count:m.count;var v=new d(g[s],o,h);i(v)}var S=r.DrawArrayLengths||void 0;if(S){if(t=S.UniqueID,void 0!==t&&(e=n._identifierMap[t],void 0!==e))return e;s=S.Mode,o=S.First;var x=S.ArrayLengths,b=new _(g[s],o,x);i(b)}});return void 0!==t&&(this._identifierMap[t]=a),a},readObject:function(){var t=this.getJSON(),e=window.Object.keys(t)[0];if(!e)return u.warn("can't find property for object "+t),i.reject();var n,a=t[e].UniqueID;if(void 0!==a&&(n=this._identifierMap[a],void 0!==n))return n;var s=this.getObjectWrapper(e);if(!s)return u.warn("can't instanciate object "+e),i.reject();var o=r(153),h=o.ObjectWrapper.serializers;if(this._cacheReadObject[e])h=this._cacheReadObject[e];else{for(var c=e.split("."),l=0,d=c.length;l<d;l++){var _=h[c[l]];if(void 0===_)return u.warn("can't find function to read object "+e+" - undefined"),i.reject();h=_}this._cacheReadObject[e]=h}var f=h(this.setJSON(t[e]),s);return void 0!==a&&(this._identifierMap[a]=f,s._uniqueID=a),f}},t.exports=p},function(t,e,r){var i=r(95),n=function(t,e){return new i(function(r,i){var n=new XMLHttpRequest;n.open("GET",t,!0),e&&e.responseType&&(n.responseType=e.responseType),e&&e.progress&&n.addEventListener("progress",e.progress,!1),n.addEventListener("error",i,!1),n.addEventListener("load",function(){r("arraybuffer"===n.responseType||"blob"===n.responseType?n.response:n.responseText)}),n.send(null)})},a=function(t,e){return new i(function(r){var i=new window.FileReader;i.onload=function(t){if("blob"===e.responseType){var i=new window.Image;i.src=t.target.result,r(i)}else r(t.target.result)},e&&e.responseType?"arraybuffer"===e.responseType?i.readAsArrayBuffer(t):"string"===e.responseType?i.readAsText(t):i.readAsDataURL(t):i.readAsText(t)})},s=function(t,e){return"string"==typeof t?n(t,e):a(t,e)};t.exports=s},function(t,e){"use strict";var r={prefixURL:"",databasePath:"",progressXHRCallback:void 0,readNodeURL:void 0,readImageURL:void 0,readBinaryArrayURL:void 0,imageLoadingUsePromise:!0,imageOnload:void 0,imageCrossOrigin:void 0};t.exports=r},function(t,e,r){var i=r(9),n=function(t){var e=new Uint8Array(t);return 31===e[0]&&139===e[1]},a=function(t){var e=new Uint8Array(t),n=r(152);n||i.error("osg failed to use a gunzip.min.js to uncompress a gz file.\n You can add this vendors to enable this feature or get it at https://github.com/imaya/zlib.js/blob/master/bin/gunzip.min.js");var a=new n.Gunzip(e),s=a.decompress();return s.buffer};t.exports={isGunzipBuffer:n,gunzip:a}},function(t,e){t.exports=__WEBPACK_EXTERNAL_MODULE_152__},function(t,e,r){"use strict";var i=r(9),n=r(7),a=r(41),s=r(53),o=r(36),h=r(48),u=r(46),c=r(91),l=r(45),d=r(29),_=r(12),f=r(15).mat4,g=r(64),p=r(65),m=r(154),v={};v.ObjectWrapper={},v.ObjectWrapper.serializers={},v.readImage=function(t,e){return v.registry().readImageURL(t,e)},v.readImageURL=v.readImage,v.readBinaryArrayURL=function(t,e){return v.registry().readBinaryArrayURL(t,e)},v.readNodeURL=function(t,e){var r=t.substr(t.lastIndexOf(".")+1),i=m.instance().getReaderWriterForExtension(r);return void 0!==i?i.readNodeURL(t,e):v.registry().readNodeURL(t,e)},v.registry=function(){var t=r(148);return void 0===v.registry._input&&(v.registry._input=new t),v.registry._input},v.parseSceneGraph=function(t,e){if(!(void 0!==t.Version&&t.Version>0)){n.time("osgjs.metric:ReaderParser.parseSceneGraphDeprecated");var r=v.parseSceneGraphDeprecated(t);return n.timeEnd("osgjs.metric:ReaderParser.parseSceneGraphDeprecated"),r}n.time("osgjs.metric:ReaderParser.parseSceneGraph");var a;for(var s in t)if("Generator"!==s&&"Version"!==s){a=s;break}if(a){var o={};o[a]=t[a];var h=v.registry().clone();h.setJSON(o);var u=n.objectMix(n.objectMix({},v.registry().getOptions()),e||{});h.setOptions(u);var c=h.readObject();return n.timeEnd("osgjs.metric:ReaderParser.parseSceneGraph"),c}i.log("can't parse scenegraph "+t)},v.parseSceneGraphDeprecated=function(t){var e,m=function(t,e){var r=e[t];return void 0===r&&(r=e[t.toLowerCase()]),r},S=function(t,e){var r=m("Name",e);r&&void 0!==t.setName&&t.setName(r)},x=function(t,e){S(t,e),t.setAmbient(m("Ambient",e)),t.setDiffuse(m("Diffuse",e)),t.setEmission(m("Emission",e)),t.setSpecular(m("Specular",e)),t.setShininess(m("Shininess",e))},b=function(t,e){S(t,e),t.setSourceRGB(e.SourceRGB),t.setSourceAlpha(e.SourceAlpha),t.setDestinationRGB(e.DestinationRGB),t.setDestinationAlpha(e.DestinationAlpha)},y=function(t,e){var r=e.MagFilter||e.mag_filter||void 0;r&&t.setMagFilter(r);var n=e.MinFilter||e.min_filter||void 0;n&&t.setMinFilter(n);var a=e.WrapT||e.wrap_t||void 0;a&&t.setWrapT(a);var s=e.WrapS||e.wrap_s||void 0;s&&t.setWrapS(s);var o=m("File",e);v.readImage(o).then(function(e){t.setImage(e)}).catch(function(){i.log("Can't read image")})},M=function(t,e){S(t,e);var n=m("Textures",e)||m("TextureAttributeList",e)||void 0;if(n)for(var o=0,h=n.length;o<h;o++){var u=m("File",n[o]);if(u){var c=r(40),l=new c;y(l,n[o]),t.setTextureAttributeAndModes(o,l),t.addUniform(a.createInt1(o,"Texture"+o))}else i.log("no texture on unit "+o+" skip it")}var d=m("BlendFunc",e);if(d){var _=new s;b(_,d),t.setAttributeAndModes(_)}var f=m("Material",e);if(f){var g=r(101),p=new g;x(p,f),t.setAttributeAndModes(p)}},T=t.children,A=t._primitives||t.primitives||t.Primitives||void 0,C=t._attributes||t.attributes||t.Attributes||void 0;if(A||C){var I=new o;S(I,t),I.stateset=t.stateset,t=I;for(var w=0,E=A.length;w<E;w++){var N=A[w].mode;if(A[w].indices){var R=A[w].indices;R=new h(h[R.type],R.elements,R.itemSize),N=N?u[N]:"TRIANGLES",I.getPrimitiveSetList().push(new l(N,R))}else{N=u[N];var F=A[w].first,P=A[w].count;I.getPrimitiveSetList().push(new c(N,F,P))}}for(var L in C){var O=C[L];I.getVertexAttributeList()[L]=new h(O.type,O.elements,O.itemSize)}}var D=m("StateSet",t);if(D){var V=new d;M(V,D),t.stateset=V}var B=t.matrix||t.Matrix||void 0;B&&(e=new g,S(e,t),n.extend(e,t),f.copy(e.getMatrix(),B),t=e);var k=t.projection||t.Projection||void 0;if(k&&(e=new p,S(e,t),n.extend(e,t),f.copy(e.setProjectionMatrix(),k),t=e),void 0===t.typeID&&(e=new _,S(e,t),n.extend(e,t),t=e),T){t.children=[];for(var U=0,G=T.length;U<G;U++)t.addChild(v.parseSceneGraphDeprecated(T[U]))}return t},t.exports=v},function(t,e,r){"use strict";var i=r(9),n={instance:function(){return n._instance||(n._instance=n,n._instance.plugins=new window.Map),n._instance},addReaderWriter:function(t,e){void 0!==n.instance().plugins.get(t)&&i.warn("the '"+t+"' plugin already exists"),n.instance().plugins.set(t,e)},getReaderWriterForExtension:function(t){return n.instance().plugins.get(t)}};t.exports=n},function(t,e,r){"use strict";var i=r(95),n=r(7),a=r(31),s=r(74),o=r(8),h=function(){a.call(this,a.TRAVERSE_ALL_CHILDREN),this._activePagedLODList=void 0,this._frameNumber=0};n.createPrototypeObject(h,n.objectInherit(a.prototype,{apply:function(t){t.getTypeID()===s.getTypeID()&&(t.setFrameNumberOfLastTraversal(this._frameNumber),this._activePagedLODList.add(t)),this.traverse(t)},set:function(t,e){this._activePagedLODList=t,this._frameNumber=e}}),"osgDB","FindPagedLODsVisitor");var u=function(){a.call(this,a.TRAVERSE_ALL_CHILDREN)};n.createPrototypeObject(u,n.objectInherit(a.prototype,{apply:function(t){t.releaseGLObjects(),this.traverse(t)}}),"osgDB","ReleaseVisitor");var c=function(){a.call(this,a.TRAVERSE_ALL_CHILDREN),this._childrenList=[]};n.createPrototypeObject(c,n.objectInherit(a.prototype,{apply:function(t){t.getTypeID()===s.getTypeID()&&(this._childrenList.push(t),this._markRequestsExpired(t)),this.traverse(t)},removeExpiredChildrenAndFindPagedLODs:function(t,e,r,i){if(!t.children.length)return!1;var n=i.length;t.removeExpiredChildren(e,r,i);for(var a=n;a<i.length;a++)i[a].accept(this);return n!==i.length},_markRequestsExpired:function(t){for(var e,r=t._perRangeDataList.length,i=0;i<r;i++)e=t.getDatabaseRequest(i),void 0!==e&&(e._groupExpired=!0,e._loadedModel=null)},reset:function(){this._childrenList.length=0}}),"osgDB","ExpiredPagedLODVisitor");var l=function(t,e){return e._timeStamp-t._timeStamp},d=function(t,e){var r=t._timeStamp-e._timeStamp;return 0===r&&(r=t._priority-e._priority),r},_=function(){this._pendingRequests=[],this._pendingNodes=[],this._loading=!1,this._progressCallback=void 0,this._lastCB=!0,this._activePagedLODList=new Set,this._childrenToRemoveList=new Set,this._downloadingRequestsNumber=0,this._maxRequestsPerFrame=10,this._acceptNewRequests=!0,this._releaseVisitor=new u,this._expiredPagedLODVisitor=new c,this._findPagedLODsVisitor=new h,this._targetMaximumNumberOfPagedLOD=75,this._elapsedTime=0,this._beginTime=0,this._availableTime=0},f=function(){this._loadedModel=void 0,this._group=void 0,this._url=void 0,this._function=void 0,this._timeStamp=0,this._groupExpired=!1,this._priority=0};n.createPrototypeObject(_,{setTargetMaximumNumberOfPageLOD:function(t){this._targetMaximumNumberOfPagedLOD=t},getTargetMaximumNumberOfPageLOD:function(){return this._targetMaximumNumberOfPagedLOD},setAcceptNewDatabaseRequests:function(t){this._acceptNewRequests=t},getAcceptNewDatabaseRequests:function(){return this._acceptNewRequests},reset:function(){this._pendingRequests=[],this._pendingNodes=[],this._loading=!1,this._lastCB=!0,this._activePagedLODList.clear(),this._childrenToRemoveList.clear(),this._downloadingRequestsNumber=0,this._maxRequestsPerFrame=10,this._acceptNewRequests=!0,this._targetMaximumNumberOfPagedLOD=75},updateSceneGraph:function(t){void 0!==this._progressCallback&&this.executeProgressCallback(),this.removeExpiredSubgraphs(t,.0025),this.takeRequests(),this.addLoadedDataToSceneGraph(t,.005)},executeProgressCallback:function(){this._pendingRequests.length>0||this._pendingNodes.length>0?(this._progressCallback(this._pendingRequests.length+this._downloadingRequestsNumber,this._pendingNodes.length),this._lastCB=!1):this._lastCB||(this._progressCallback(this._pendingRequests.length+this._downloadingRequestsNumber,this._pendingNodes.length),this._lastCB=!0)},setMaxRequestsPerFrame:function(t){this._maxRequestsPerFrame=t},getMaxRequestsPerFrame:function(){return this._maxRequestsPerFrame},getRequestListSize:function(){return this._pendingRequests.length+this._downloadingRequestsNumber},setProgressCallback:function(t){this._progressCallback=t},addLoadedDataToSceneGraph:function(t,e){if(!this._pendingNodes.length||e<=0)return 0;var r=0,i=o.instance().tick();this._pendingNodes.sort(l);for(var n=0;n<this._pendingNodes.length;n++){if(r>e)return 0;var a=this._pendingNodes.shift(),s=t.getFrameNumber(),h=t.getSimulationTime();if(a._groupExpired===!1){var u=a._group;u.setTimeStamp(u.children.length,h),u.setFrameNumber(u.children.length,s),u.addChildNode(a._loadedModel),this._activePagedLODList.has(u)?this.registerPagedLODs(a._loadedModel,s):this.registerPagedLODs(u,s)}else a._loadedModel=void 0,a=void 0;r=o.instance().deltaS(i,o.instance().tick())}return e-=r},isLoading:function(){return this._loading},registerPagedLODs:function(t,e){t&&(this._findPagedLODsVisitor.set(this._activePagedLODList,e),t.accept(this._findPagedLODsVisitor))},requestNodeFile:function(t,e,r,i,n){if(this._acceptNewRequests){var a=new f;return a._group=r,a._function=t,a._url=e,a._timeStamp=i,a._priority=n,this._pendingRequests.push(a),a}},takeRequests:function(){if(this._pendingRequests.length){var t=Math.min(this._maxRequestsPerFrame,this._pendingRequests.length);this._pendingRequests.sort(d);for(var e=0;e<t;e++)this._downloadingRequestsNumber++,this.processRequest(this._pendingRequests.shift())}},processRequest:function(t){this._loading=!0;var e=this;return t._groupExpired?(e._downloadingRequestsNumber--,void(this._loading=!1)):void(void 0!==t._function?this.loadNodeFromFunction(t._function,t._group).then(function(r){e._downloadingRequestsNumber--,t._loadedModel=r,e._pendingNodes.push(t),e._loading=!1}):""!==t._url&&this.loadNodeFromURL(t._url).then(function(r){e._downloadingRequestsNumber--,t._loadedModel=r,e._pendingNodes.push(t),e._loading=!1}))},loadNodeFromFunction:function(t,e){var r=t(e);return r?r&&r.then?r:i.resolve(r):i.reject()},loadNodeFromURL:function(t){var e=r(153);return e.readNodeURL(t)},releaseGLExpiredSubgraphs:function(t){return this._availableTime=t,!this._childrenToRemoveList.size||t<=0?0:(this._elapsedTime=0,this._beginTime=o.instance().tick(),this._childrenToRemoveList.forEach(this._releaseExpiredSubgraphs,this),this._availableTime-=this._elapsedTime,this._availableTime)},_releaseExpiredSubgraphs:function(t){this._elapsedTime>this._availableTime||(this._childrenToRemoveList.delete(t),t.accept(this._releaseVisitor),t.removeChildren(),t=null,this._elapsedTime=o.instance().deltaS(this._beginTime,o.instance().tick()))},removeExpiredSubgraphs:function(t,e){if(0===t.getFrameNumber())return 0;var r=this._activePagedLODList.size-this._targetMaximumNumberOfPagedLOD,i=t.getSimulationTime()-.1,n=t.getFrameNumber()-1;return r>0&&(e=this.removeExpiredChildren(r,i,n,e)),e},removeExpiredChildren:function(t,e,r,i){var n=0,a=o.instance().tick(),s=this,h=[],u=this._expiredPagedLODVisitor;return u.reset(),this._activePagedLODList.forEach(function(c){if(n>i)return 0;if(t<0)return i;if(r<c.getFrameNumberOfLastTraversal())return i;u.removeExpiredChildrenAndFindPagedLODs(c,e,r,h);for(var l=0;l<u._childrenList.length;l++)s._activePagedLODList.delete(u._childrenList[l]),t--;for(l=0;l<h.length;l++)s._childrenToRemoveList.add(h[l]);u._childrenList.length=0,h.length=0,n=o.instance().deltaS(a,o.instance().tick())}),i-=n}},"osgDB","DatabasePager"),t.exports=_},function(t,e,r){"use strict";var i=r(95),n=r(34),a={};a.Object=function(t,e){var r=t.getJSON();if(r.Name&&e.setName(r.Name),r.UserDataContainer){var i=t.setJSON(r.UserDataContainer).readUserDataContainer();void 0!==i&&e.setUserData(i)}return e},a.Node=function(t,e){var r=t.getJSON();a.Object(t,e);var n=[];if(r.UpdateCallbacks)for(var s=e.addUpdateCallback.bind(e),o=0,h=r.UpdateCallbacks.length;o<h;o++){var u=t.setJSON(r.UpdateCallbacks[o]).readObject();n.push(u),u.then(s)}if(r.StateSet){var c=t.setJSON(r.StateSet).readObject();n.push(c),c.then(e.setStateSet.bind(e))}var l=[];if(r.Children)for(var d=0,_=r.Children.length;d<_;d++)l.push(t.setJSON(r.Children[d]).readObject());return i.all(n).then(function(){return i.all(l).then(function(t){for(var r=t.length,i=0;i<r;i++)e.addChild(t[i]);return e})})},a.StateSet=function(t,e){var r=t.getJSON();a.Object(t,e),void 0!==r.RenderingHint&&e.setRenderingHint(r.RenderingHint);var n=[],s=function(r){var i=t.setJSON(r).readObject();i.isRejected()||(n.push(i),i.then(e.setAttributeAndModes.bind(e)))};if(void 0!==r.AttributeList)for(var o=0,h=r.AttributeList.length;o<h;o++)s(r.AttributeList[o]);var u=function(r,i){var a=t.setJSON(i).readObject();a.isRejected()||(n.push(a),a.then(e.setTextureAttributeAndModes.bind(e,r)))};if(r.TextureAttributeList)for(var c=r.TextureAttributeList,l=0,d=c.length;l<d;l++)for(var _=c[l],f=0,g=_.length;f<g;f++)u(l,_[f]);return i.all(n).then(function(){return e})},a.Material=function(t,e){var r=t.getJSON();return r.Diffuse&&r.Emission&&r.Specular&&void 0!==r.Shininess?(a.Object(t,e),e.setAmbient(r.Ambient),e.setDiffuse(r.Diffuse),e.setEmission(r.Emission),e.setSpecular(r.Specular),e.setShininess(r.Shininess),i.resolve(e)):i.reject()},a.BlendFunc=function(t,e){var r=t.getJSON();return r.SourceRGB&&r.SourceAlpha&&r.DestinationRGB&&r.DestinationAlpha?(a.Object(t,e),e.setSourceRGB(r.SourceRGB),e.setSourceAlpha(r.SourceAlpha),e.setDestinationRGB(r.DestinationRGB),e.setDestinationAlpha(r.DestinationAlpha),i.resolve(e)):i.reject()},a.CullFace=function(t,e){var r=t.getJSON();return void 0===r.Mode?i.reject():(a.Object(t,e),e.setMode(r.Mode),i.resolve(e))},a.BlendColor=function(t,e){var r=t.getJSON();return r.ConstantColor?(a.Object(t,e),e.setConstantColor(r.ConstantColor),i.resolve(e)):i.reject()},a.Light=function(t,e){var r=t.getJSON();return r.Ambient&&r.Diffuse&&r.Direction&&r.Position&&r.Specular&&void 0!==r.LightNum&&void 0!==r.SpotCutoff&&void 0!==r.LinearAttenuation&&void 0!==r.ConstantAttenuation&&void 0!==r.QuadraticAttenuation?(a.Object(t,e),e.setAmbient(r.Ambient),e.setConstantAttenuation(r.ConstantAttenuation),e.setDiffuse(r.Diffuse),e.setDirection(r.Direction),e.setLightNumber(r.LightNum),e.setLinearAttenuation(r.LinearAttenuation),e.setPosition(r.Position),e.setQuadraticAttenuation(r.QuadraticAttenuation),e.setSpecular(r.Specular),e.setSpotCutoff(r.SpotCutoff),e.setSpotBlend(.01),void 0!==r.SpotExponent&&e.setSpotBlend(r.SpotExponent/128),i.resolve(e)):i.reject()},a.Texture=function(t,e){var r=t.getJSON();a.Object(t,e),r.MinFilter&&e.setMinFilter(r.MinFilter),r.MagFilter&&e.setMagFilter(r.MagFilter),r.WrapT&&e.setWrapT(r.WrapT),r.WrapS&&e.setWrapS(r.WrapS);var i=r.File;return void 0===i&&(i="no-image-provided"),t.readImageURL(i).then(function(t){return e.setImage(t),e})},a.Projection=function(t,e){var r=t.getJSON();if(!r.Matrix)return i.reject();var n=a.Node(t,e);return e.setMatrix(r.Matrix),n},a.MatrixTransform=function(t,e){var r=t.getJSON();if(!r.Matrix)return i.reject();var n=a.Node(t,e);return e.setMatrix(r.Matrix),n},a.LightSource=function(t,e){var r=t.getJSON();if(!r.Light)return i.reject();var s=a.Node(t,e);return i.all([t.setJSON(r.Light).readObject(),s]).then(function(t){var i=t[0];return e.setLight(i),"ABSOLUTE_RF"===r.ReferenceFrame&&e.setReferenceFrame(n.ABSOLUTE_RF),e})},a.functionSortAttributes=function(t,e){return t.indexOf("TexCoord")!==-1&&e.indexOf("TexCoord")!==-1?parseInt(t.substr(8),10)-parseInt(e.substr(8),10):t<e?-1:t>e?1:0},a.Geometry=function(t,e){var r=t.getJSON();if(!r.VertexAttributeList)return i.reject();r.PrimitiveSetList=r.PrimitiveSetList||[];var n=[];n.push(a.Node(t,e));var s=e.getPrimitives(),o=s.push.bind(s),h=0,u=r.PrimitiveSetList.length;for(h=0;h<u;h++){var c=t.setJSON(r.PrimitiveSetList[h]).readPrimitiveSet();n.push(c),c.then(o)}var l=function(t,e){this.getVertexAttributeList()[t]=e},d=r.VertexAttributeList,_=window.Object.keys(d);for(_.sort(a.functionSortAttributes),u=_.length,h=0;h<u;h++){var f=_[h],g=t.setJSON(d[f]).readBufferArray();n.push(g),g.then(l.bind(e,f))}return i.all(n).then(function(){return e})},a.PagedLOD=function(t,e){var r=t.getJSON();a.Object(t,e),"USE_BOUNDING_SPHERE_CENTER"===r.CenterMode?e.setCenterMode(0):"UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED"===r.CenterMode&&e.setCenterMode(2),e.setCenter([r.UserCenter[0],r.UserCenter[1],r.UserCenter[2]]),
e.setRadius(r.UserCenter[3]),"PIXEL_SIZE_ON_SCREEN"===r.RangeMode&&e.setRangeMode(1);for(var n,s=r.RangeList,o=0;o<window.Object.keys(s).length;o++){n="Range "+o;var h=s[n];e.setRange(o,h[0],h[1])}for(s=r.RangeDataList,o=0;o<window.Object.keys(s).length;o++)n="File "+o,e.setFileName(o,s[n]);e.setDatabasePath(t.getDatabasePath());var u=[];if(r.Children)for(var c=0,l=r.Children.length;c<l;c++)u.push(t.setJSON(r.Children[c]).readObject());return i.all(u).then(function(t){var r=t.length;for(o=0;o<r;o++)e.addChildNode(t[o]);return e})},t.exports=a},function(t,e,r){"use strict";var i=r(95),n=r(9),a=r(156),s=r(134),o=r(133),h=r(153),u=r(142),c=r(145),l=r(82),d=r(36),_={},f=function(){},g=h.registry();g.registerObject("osgAnimation.Vec3LerpChannel",f),g.registerObject("osgAnimation.FloatLerpChannel",f),g.registerObject("osgAnimation.QuatSlerpChannel",f),g.registerObject("osgAnimation.QuatLerpChannel",f),g.registerObject("osgAnimation.FloatCubicBezierChannel",f),g.registerObject("osgAnimation.Vec3CubicBezierChannel",f),g.registerObject("osgAnimation.StackedMatrixElement",u),g.registerObject("osgAnimation.StackedScaleElement",c),_.Animation=function(t){var e=t.getJSON();if(void 0===e.Name||!e.Channels||0===e.Channels.length)return i.reject();for(var r=[],n=0,a=e.Channels.length;n<a;n++){var s=t.setJSON(e.Channels[n]).readObject();r.push(s)}return i.all(r).then(function(t){return o.createAnimation(t,e.Name)})},_.StandardVec3Channel=function(t,e,r){var n=t.getJSON();if(!(void 0!==n.TargetName&&n.KeyFrames&&n.Name&&n.KeyFrames.Time&&n.KeyFrames.Key&&3===n.KeyFrames.Key.length))return i.reject();var a=t.setJSON(n.KeyFrames.Time).readBufferArray(),s=t.setJSON(n.KeyFrames.Key[0]).readBufferArray(),o=t.setJSON(n.KeyFrames.Key[1]).readBufferArray(),h=t.setJSON(n.KeyFrames.Key[2]).readBufferArray();return i.all([a,s,o,h]).then(function(t){for(var i=t[0].getElements(),a=t[1].getElements(),s=t[2].getElements(),o=t[3].getElements(),h=i.length,u=new Float32Array(new ArrayBuffer(4*(h+1)*3),0,3*h),c=new Float32Array(new ArrayBuffer(4*(h+1)),0,h),l=0;l<h;l++){var d=3*l;c[l]=i[l],u[d++]=a[l],u[d++]=s[l],u[d]=o[l]}return r(u,c,n.TargetName,n.Name,e),e})},_.StandardQuatChannel=function(t,e,r){var n=t.getJSON();if(!(void 0!==n.TargetName&&n.KeyFrames&&n.Name&&n.KeyFrames.Time&&n.KeyFrames.Key&&4===n.KeyFrames.Key.length))return i.reject();var a=t.setJSON(n.KeyFrames.Time).readBufferArray(),s=t.setJSON(n.KeyFrames.Key[0]).readBufferArray(),o=t.setJSON(n.KeyFrames.Key[1]).readBufferArray(),h=t.setJSON(n.KeyFrames.Key[2]).readBufferArray(),u=t.setJSON(n.KeyFrames.Key[3]).readBufferArray();return i.all([a,s,o,h,u]).then(function(t){for(var i=t[0].getElements(),a=t[1].getElements(),s=t[2].getElements(),o=t[3].getElements(),h=t[4].getElements(),u=i.length,c=new Float32Array(new ArrayBuffer(4*(u+1)*4),0,4*u),l=new Float32Array(new ArrayBuffer(4*(u+1)),0,u),d=0;d<u;d++){var _=4*d;l[d]=i[d],c[_++]=a[d],c[_++]=s[d],c[_++]=o[d],c[_]=h[d]}return r(c,l,n.TargetName,n.Name,e),e})},_.StandardFloatChannel=function(t,e,r){var n=t.getJSON();if(!(void 0!==n.TargetName&&n.KeyFrames&&n.Name&&n.KeyFrames.Time&&n.KeyFrames.Key))return i.reject();var a=t.setJSON(n.KeyFrames.Time).readBufferArray(),s=t.setJSON(n.KeyFrames.Key).readBufferArray();return i.all([a,s]).then(function(t){for(var i=t[0].getElements(),a=t[1].getElements(),s=i.length,o=new Float32Array(new ArrayBuffer(4*(s+1)),0,s),h=new Float32Array(new ArrayBuffer(4*(s+1)),0,s),u=0;u<s;u++)h[u]=i[u],o[u]=a[u];return r(o,h,n.TargetName,n.Name,e),e})},_.Vec3LerpChannel=function(t,e){return _.StandardVec3Channel(t,e,s.createVec3Channel)},_.QuatLerpChannel=function(t,e){return _.StandardQuatChannel(t,e,s.createQuatChannel)},_.QuatSlerpChannel=function(t,e){return _.StandardQuatChannel(t,e,s.createQuatChannel)},_.FloatLerpChannel=function(t,e){return _.StandardFloatChannel(t,e,s.createFloatChannel)},_.FloatCubicBezierChannel=function(t,e){var r=t.getJSON();if(!(void 0!==r.TargetName&&r.KeyFrames&&r.Name&&r.KeyFrames.Time&&r.KeyFrames.Position&&r.KeyFrames.ControlPointOut&&r.KeyFrames.ControlPointIn))return i.reject();var n,a=[],o=window.Object.keys(r.KeyFrames);for(n=0;n<o.length;n++)a.push(t.setJSON(r.KeyFrames[o[n]]).readBufferArray());return i.all(a).then(function(t){var i=t[0].getElements(),a=t[1].getElements(),o=t[2].getElements(),h=t[3].getElements(),u=h.length,c=new Float32Array(new ArrayBuffer(4*(u+1)*3),0,3*u),l=new Float32Array(new ArrayBuffer(4*(u+1)),0,u);for(n=0;n<u;n++){var d=3*n;l[n]=h[n],c[d++]=o[n],c[d++]=i[n],c[d]=a[n]}return s.createFloatCubicBezierChannel(c,l,r.TargetName,r.Name,e),e})},_.Vec3CubicBezierChannel=function(t,e){var r=t.getJSON();if(!(void 0!==r.TargetName&&r.KeyFrames&&r.Name&&r.KeyFrames.Time&&r.KeyFrames.Position&&r.KeyFrames.ControlPointOut&&r.KeyFrames.ControlPointIn&&3===r.KeyFrames.Position.length&&3===r.KeyFrames.ControlPointIn.length&&3===r.KeyFrames.ControlPointOut.length))return i.reject();var n,a=[],o=window.Object.keys(r.KeyFrames);for(n=0;n<o.length;n++){var h=o[n],u=r.KeyFrames[h];"Time"!==h?(a.push(t.setJSON(u[0]).readBufferArray()),a.push(t.setJSON(u[1]).readBufferArray()),a.push(t.setJSON(u[2]).readBufferArray())):a.push(t.setJSON(u).readBufferArray())}return i.all(a).then(function(t){var i=t[0].getElements(),a=t[1].getElements(),o=t[2].getElements(),h=t[3].getElements(),u=t[4].getElements(),c=t[5].getElements(),l=t[6].getElements(),d=t[7].getElements(),_=t[8].getElements(),f=t[9].getElements(),g=f.length,p=new Float32Array(new ArrayBuffer(4*(g+1)*9),0,9*g),m=new Float32Array(new ArrayBuffer(4*(g+1)),0,g);for(n=0;n<g;n++){var v=9*n;m[n]=f[n],p[v++]=l[n],p[v++]=d[n],p[v++]=_[n],p[v++]=i[n],p[v++]=a[n],p[v++]=o[n],p[v++]=h[n],p[v++]=u[n],p[v]=c[n]}return s.createVec3CubicBezierChannel(p,m,r.TargetName,r.Name,e),e})},_.BasicAnimationManager=function(t,e){var r=t.getJSON();if(!r.Animations)return i.reject();a.Object(t,e);for(var s=[],o=0,h=r.Animations.length;o<h;o++){var u=t.setJSON(r.Animations[o]).readObject();u.isRejected()?n.warn("An Animation failed on the parsing!"):s.push(u)}return i.all(s).then(function(t){return e.init(t),e})},_.UpdateMatrixTransform=function(t,e){var r=t.getJSON();if(/*!jsonObj.Name ||*/!r.StackedTransforms)return i.reject();a.Object(t,e);var s,o,h=[];for(s=0,o=r.StackedTransforms.length;s<o;s++){var u=t.setJSON(r.StackedTransforms[s]).readObject();u.isRejected()?n.warn("A stacked transforms failed on the parsing!"):h.push(u)}return i.all(h).then(function(t){var r=e.getStackedTransforms();for(s=0,o=t.length;s<o;s++)r.push(t[s]);return e.computeChannels(),e})},_.StackedTranslate=function(t,e){var r=t.getJSON();return r.Name&&r.Translate?(a.Object(t,e),e.init(r.Translate),i.resolve(e)):i.reject()},_.StackedQuaternion=function(t,e){var r=t.getJSON();return r.Name&&r.Quaternion?(a.Object(t,e),e.init(r.Quaternion),i.resolve(e)):i.reject()},_.StackedRotateAxis=function(t,e){var r=t.getJSON();return r.Axis&&void 0!==r.Angle?(a.Object(t,e),e.init(r.Axis,r.Angle),i.resolve(e)):i.reject()},_.StackedMatrix=function(t,e){var r=t.getJSON();return r.Name&&r.Matrix?(a.Object(t,e),e.init(r.Matrix),i.resolve(e)):i.reject()},_.StackedScale=function(t,e){var r=t.getJSON();return r.Name&&r.Scale?(a.Object(t,e),e.init(r.Scale),i.resolve(e)):i.reject()},_.Bone=function(t,e){var r=t.getJSON();if(!r.InvBindMatrixInSkeletonSpace)return i.reject();var n=a.MatrixTransform(t,e);if(e.setInvBindMatrixInSkeletonSpace(r.InvBindMatrixInSkeletonSpace),r.BoundingBox){var s=e.getBoneBoundingBox();s.setMax(r.BoundingBox.max),s.setMin(r.BoundingBox.min)}return n},_.UpdateBone=_.UpdateMatrixTransform,_.UpdateSkeleton=function(t,e){return a.Object(t,e),i.resolve(e)},_.Skeleton=a.MatrixTransform,_.RigGeometry=function(t,e){var r=t.getJSON();if(!r.SourceGeometry)return i.reject();r.BoneMap||n.warn("No boneMap found in a RigGeometry !");var s=a.Geometry(t,e);e._boneNameID=r.BoneMap;var o,h=r.SourceGeometry["osg.Geometry"];return h?(t.setJSON(h),e.setSourceGeometry(new d),o=a.Geometry(t,e.getSourceGeometry())):(h=r.SourceGeometry["osgAnimation.MorphGeometry"],h?(t.setJSON(h),e.setSourceGeometry(new l),o=_.MorphGeometry(t,e.getSourceGeometry())):n.warn("SourceGeometry type no recognized")),void 0===e._uniqueID&&(e._uniqueID=h.UniqueID),i.all([s,o]).then(function(){return e.mergeChildrenData(),e})},_.MorphGeometry=function(t,e){var r=t.getJSON();if(!r.MorphTargets)return i.reject();var n=r.MorphTargets,s=[];s.push(a.Geometry(t,e));for(var o=0,h=n.length;o<h;o++)s.push(t.setJSON(n[o]).readObject());return i.all(s).then(function(t){for(var e=t[0],r=e.getMorphTargets(),i=1,n=t.length;i<n;i++)r.push(t[i]);return e.mergeChildrenVertexAttributeList(),e})},_.UpdateMorph=function(t,e){var r=t.getJSON();if(!r.TargetMap)return i.reject();a.Object(t,e);for(var n=window.Object.keys(r.TargetMap),s=0,o=n.length;s<o;s++){var h=n[s];e.addTarget(r.TargetMap[h],parseInt(h,10))}return i.resolve(e)},_.StackedMatrixElement=_.StackedMatrix,_.StackedScaleElement=_.StackedScale,t.exports=_},function(t,e,r){"use strict";var i=r(95),n=r(156),a=r(9),s=r(159),o={};o.Text=function(t,e){var r=t.getJSON();if(!r.Text)return i.reject();var o=n.Node(t,e);if(e.setColor(r.Color),e.setText(r.Text),e.setAutoRotateToScreen(r.AutoRotateToScreen),e.setPosition(r.Position),e.setCharacterSize(r.CharacterSize),"VERTICAL"===r.Layout)return a.error("Vertical Alignment not supported"),i.reject();var h=r.Alignment;return r.Alignment.indexOf("BASE_LINE")>-1&&("LEFT_BASE_LINE"===r.Alignment?h=s.LEFT_CENTER:"CENTER_BASE_LINE"===r.Alignment?h=s.CENTER_CENTER:"RIGHT_BASE_LINE"===r.Alignment?h=s.RIGHT_CENTER:"LEFT_BOTTOM_BASE_LINE"===r.Alignment?h=s.LEFT_BOTTOM:"CENTER_BOTTOM_BASE_LINE"===r.Alignment?h=s.CENTER_BOTTOM:"RIGHT_BOTTOM_BASE_LINE"===r.Alignment&&(h=s.RIGHT_BOTTOM),a.log("Base line alignments not supported, alignment converted")),e.setAlignment(h),e.setLayout(r.Layout),o},t.exports=o},function(t,e,r){"use strict";var i=r(63),n=r(7),a=r(15).vec3,s=r(15).vec4,o=r(15).mat4,h=r(6),u=r(64),c=r(123),l=r(40),d=r(53),_=r(15).quat,f=r(31),g=r(12),p=function(t){h.call(this),this._canvas=document.createElement("canvas"),this._context=this._canvas.getContext("2d"),this._matrixTransform=new u,this.addChild(this._matrixTransform),this._text="",void 0!==t&&(this._text=t),this._font="monospace",this._color=s.fromValues(0,0,0,1),this._fillStyle="rgba( 0, 0, 0, 1 )",this._context.textAlign="center",this._textX=void 0,this._context.baseLine="middle",this._textY=void 0,this._characterSize=1,this._characterSizeMode=p.OBJECT_COORDS,this._fontSize=32,this._geometry=void 0,this._autoRotateToScreen=!1,this._position=a.create(),this._layout=p.LEFT_TO_RIGHT,this._alignment=p.CENTER_CENTER,this._forcePowerOfTwo=!1,this._texture=new l,this.drawText(),this._dirty=!1,this._previousModelView=o.create()};p.OBJECT_COORDS=0,p.SCREEN_COORDS=1,p.OBJECT_COORDS_WITH_MAXIMUM_SCREEN_SIZE_CAPPED_BY_FONT_HEIGHT=2,p.LEFT_TO_RIGHT="ltr",p.RIGHT_TO_LEFT="rtl",p.LEFT_TOP=0,p.LEFT_CENTER=1,p.LEFT_BOTTOM=2,p.CENTER_TOP=3,p.CENTER_CENTER=4,p.CENTER_BOTTOM=5,p.RIGHT_TOP=6,p.RIGHT_CENTER=7,p.RIGHT_BOTTOM=8,n.createPrototypeNode(p,n.objectInherit(h.prototype,{drawText:function(){if(void 0!==this._geometry&&(this._matrixTransform.removeChild(this._geometry),this._geometry.releaseGLObjects()),this._text){this.setTextProperties(),this._canvas.width=this._context.measureText(this._text).width,this._canvas.height=2*this._fontSize,this._forcePowerOfTwo&&(this._canvas.width=this._nextPowerOfTwo(this._canvas.width),this._canvas.height=this._nextPowerOfTwo(this._canvas.height)),this.setTextProperties(),this._context.clearRect(0,0,this._canvas.width,this._canvas.height),this._context.fillText(this._text,this._textX,this._textY);var t=this._canvas.width/this._canvas.height,e=this._characterSize*t;this._geometry=c.createTexturedQuadGeometry(-e/2,-this._characterSize/2,0,e,0,0,0,this._characterSize,0),this._texture.setTextureSize(this._canvas.width,this._canvas.height),this._texture.setMinFilter("LINEAR"),this._texture.setMagFilter("LINEAR"),this._texture.setImage(this._canvas);var r=this._geometry.getOrCreateStateSet();r.setTextureAttributeAndModes(0,this._texture),r.setRenderingHint("TRANSPARENT_BIN"),r.setAttributeAndModes(new d(d.ONE,d.ONE_MINUS_SRC_ALPHA)),this._matrixTransform.addChild(this._geometry),this.dirtyBound()}},setText:function(t){this._text=t,this._dirty=!0},getText:function(){return this._text},setFont:function(t){this._font=t,this._dirty=!0},setColor:function(t){this._color=t,this._fillStyle="rgba("+Math.round(255*t[0])+","+Math.round(255*t[1])+","+Math.round(255*t[2])+","+t[3]+")",this._context.fillStyle=this._fillStyle,this._context.fillText(this._text,this._textX,this._textY)},getColor:function(){return this._color},setCharacterSize:function(t){this._characterSize=t,this._characterSizeMode!==p.OBJECT_COORDS&&(o.fromScaling(this._matrixTransform.getMatrix(),[this._characterSize,this._characterSize,this._characterSize]),this._characterSizeMode===p.OBJECT_COORDS_WITH_MAXIMUM_SCREEN_SIZE_CAPPED_BY_FONT_HEIGHT&&this.setMaximumScale(this._characterSize)),this._dirty=!0},getCharacterSize:function(){return this._characterSize},setCharacterSizeMode:function(t){this._characterSizeMode=t,this._characterSizeMode!==p.OBJECT_COORDS?(o.fromScaling(this._matrixTransform.getMatrix(),[this._characterSize,this._characterSize,this._characterSize]),this.setAutoScaleToScreen(!0),this.setMaximumScale(Number.MAX_VALUE),this._characterSizeMode===p.OBJECT_COORDS_WITH_MAXIMUM_SCREEN_SIZE_CAPPED_BY_FONT_HEIGHT&&this.setMaximumScale(this._characterSize)):(this._matrixTransform.setMatrix(o.create()),this.setAutoScaleToScreen(!1)),this._dirty=!0},getCharacterSizeMode:function(){return this._characterSizeMode},setFontResolution:function(t){this._fontSize=t,this._dirty=!0},getFontResolution:function(){return this._fontSize},setPosition:function(t){this._position=t,o.fromTranslation(this.getMatrix(),t)},getPosition:function(){return this._position},setTextProperties:function(){this._context.fillStyle=this._fillStyle,this._setAlignmentValues(this._alignment),this._context.font=this._fontSize+"px "+this._font,this._context.direction=this._layout},setAutoRotateToScreen:function(t){h.prototype.setAutoRotateToScreen.call(this,t),this._dirty=!0},getAutoRotateToScreen:function(){return this._autoRotateToScreen},setLayout:function(t){"string"==typeof t?this._layout=p[t]:this._layout=t,this._dirty=!0},getLayout:function(){return this._layout},setAlignment:function(t){"string"==typeof t?this._alignment=p[t]:this._alignment=t,this._dirty=!0},getAlignment:function(){return this._alignment},accept:function(){return function(t){if(this._dirty&&(this.drawText(),this._dirty=!1),t.getVisitorType()===f.CULL_VISITOR){var e=t.getViewport().width(),r=t.getViewport().height(),i=t.getCurrentProjectionMatrix(),n=t.getCurrentModelViewMatrix(),h=this._position,u=this._firstTimeToInitEyePoint;if(this._firstTimeToInitEyePoint||(o.exactEquals(n,this._previousModelView)?e!==this._previousWidth||r!==this._previousHeight?u=!0:o.exactEquals(i,this._previousProjection)?a.exactEquals(h,this._previousPosition)||(u=!0):u=!0:u=!0),this._firstTimeToInitEyePoint=!1,u){if(this._autoScaleToScreen){var c=t.getViewport(),l=this.computePixelSizeVector(c,i,n),d=s.fromValues(this._position[0],this._position[1],this._position[2],1),p=s.dot(d,l);p=.48/p;var m=1/p;if(this._autoScaleTransitionWidthRatio>0){var v,S,x;if(this._minimumScale>0){var b=this._minimumScale,y=this._maximumScale<Number.MAX_VALUE?this._minimumScale+(this._maximumScale-this._minimumScale)*this._autoScaleTransitionWidthRatio:this._minimumScale*(1+this._autoScaleTransitionWidthRatio);v=1/(4*(y-b)),S=1-2*v*y,x=b+S*S/(4*v);var M=-S/(2*v);m<M?m=this._minimumScale:m<y&&(m=x+S*m+v*(m*m))}if(this._maximumScale<Number.MAX_VALUE){var T=this._maximumScale,A=this._minimumScale>0?this._maximumScale+(this._minimumScale-this._maximumScale)*this._autoScaleTransitionWidthRatio:this._maximumScale*(1-this._autoScaleTransitionWidthRatio);v=1/(4*(A-T)),S=1-2*v*A,x=T+S*S/(4*v);var C=-S/(2*v);m>C?m=this._maximumScale:m>A&&(m=x+S*m+v*(m*m))}}this.setScale(m)}if(this._autoRotateToScreen){var I=_.create(),w=t.getCurrentModelViewMatrix();o.getRotation(I,w),this.setRotation(_.invert(I,I))}this._previousWidth=e,this._previousHeight=r,a.copy(this._previousPosition,h),o.copy(this._previousProjection,i),o.copy(this._previousModelView,n)}}g.prototype.accept.call(this,t)}}(),_setAlignmentValues:function(t){switch(t){case p.LEFT_TOP:this._context.textAlign="left",this._textX=0,this._context.textBaseline="top",this._textY=0;break;case p.LEFT_CENTER:this._context.textAlign="left",this._textX=0,this._context.textBaseline="middle",this._textY=this._canvas.height/2;break;case p.LEFT_BOTTOM:this._context.textAlign="left",this._textX=0,this._context.textBaseline="bottom",this._textY=this._canvas.height;break;case p.CENTER_TOP:this._context.textAlign="center",this._textX=this._canvas.width/2,this._context.textBaseline="top",this._textY=0;break;case p.CENTER_CENTER:this._context.textAlign="center",this._textX=this._canvas.width/2,this._context.textBaseline="middle",this._textY=this._canvas.height/2;break;case p.CENTER_BOTTOM:this._context.textAlign="center",this._textX=this._canvas.width/2,this._context.textBaseline="bottom",this._textY=this._canvas.height;break;case p.RIGHT_TOP:this._context.textAlign="right",this._textX=this._canvas.width,this._context.textBaseline="top",this._textY=0;break;case p.RIGHT_CENTER:this._context.textAlign="right",this._textX=this._canvas.width,this._context.textBaseline="middle",this._textY=this._canvas.height/2;break;case p.RIGHT_BOTTOM:this._context.textAlign="right",this._textX=this._canvas.width,this._context.textBaseline="bottom",this._textY=this._canvas.height}},setForcePowerOfTwo:function(t){this._forcePowerOfTwo=t},getForcePowerOfTwo:function(){return this._forcePowerOfTwo},_nextPowerOfTwo:function(t){var e=t;return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e++,e}}),"osgText","Text"),i.registerApplyFunction(p.nodeTypeID,i.getApplyFunction(h.nodeTypeID)),t.exports=p},function(t,e,r){"use strict";var i=r(95),n=r(153),a=r(154),s=r(149),o=r(9),h={readFileList:function(t){var e,r,o=new window.Map,u=[];for(r=0;r<t.length;++r){var c=t[r].name.substr(t[r].name.lastIndexOf(".")+1),l=a.instance().getReaderWriterForExtension(c);void 0===l&&"osgjs"!==c||(e=t[r].name);var d=h.getTypeForExtension(c);u.push(s(t[r],{responseType:d}))}return i.all(u).then(function(i){for(r=0;r<i.length;++r)o.set(t[r].name,i[r]);return n.readNodeURL(e,{filesMap:o})})},init:function(){h._typesMap=new window.Map,h._typesMap.set("bin","arraybuffer"),h._typesMap.set("b3dm","arraybuffer"),h._typesMap.set("glb","arraybuffer"),h._typesMap.set("zip","arraybuffer"),h._typesMap.set("png","blob"),h._typesMap.set("jpg","blob"),h._typesMap.set("jpeg","blob"),h._typesMap.set("gif","blob"),h._typesMap.set("json","string"),h._typesMap.set("gltf","string"),h._typesMap.set("osgjs","string")},addTypeForExtension:function(t,e){h._typesMap||h.init(),void 0!==h._typesMap.get(e)&&o.warn("the '"+e+"' already has a type"),h._typesMap.set(e,t)},getTypeForExtension:function(t){return h._typesMap||h.init(),this._typesMap.get(t)}};t.exports=h},function(t,e,r){"use strict";var i=r(162),n=r(163),a=r(173),s=r(183),o=r(184),h=r(176),u=r(185),c=r(187),l=r(186),d=r(164),_=r(174),f=r(175),g=r(177),p=r(178),m=r(179),v=r(181),S=r(188),x=r(180),b={};i.NO_MOUSEEVENTS=!0,b.CADManipulator=n,b.getCADManipulatorStandardMouseKeyboardController=function(){return a},b.getCADManipulatorHammerController=function(){return s},b.FirstPersonManipulator=o,b.getFirstPersonDeviceOrientationController=function(){return h},b.getFirstPersonManipulatorHammerController=function(){return u},b.getFirstPersonStandardMouseKeyboardControllerClass=function(){return c},b.getFirstPersonWebVRControllerClass=function(){return l},b.Manipulator=d,b.OrbitManipulator=_,b.getOrbitManipulatorDeviceOrientationController=function(){return f},b.getOrbitManipulatorGamePadController=function(){return g},b.getOrbitManipulatorHammerController=function(){return p},b.getOrbitManipulatorStandardMouseKeyboardController=function(){return m},b.getOrbitManipulatorWebVRController=function(){return v},b.SwitchManipulator=S,b.OrbitManipulator.Rotate=x.ROTATE,b.OrbitManipulator.Pan=x.PAN,b.OrbitManipulator.Zoom=x.ZOOM,t.exports=b},function(t,e){t.exports=__WEBPACK_EXTERNAL_MODULE_162__},function(t,e,r){"use strict";var i=r(7),n=r(164),a=r(165),s=r(166),o=r(171),h=r(33),u=r(15).mat4,c=r(15).vec2,l=r(15).vec3,d=r(15).quat,_=r(173),f=r(183),g=r(182),p=r(168),m=function(){n.call(this),this._tmpHomePosition=l.create(),this._intersectionVisitor=new a,this._lineSegmentIntersector=new s,this._polytopeIntersector=void 0,this._usePolytopeIntersector=!1,this._primitiveMask=p.ALL_PRIMITIVES,this.init()};m.Interpolator=function(){this._current=c.create(),this._target=c.create(),this._delta=c.create(),this._reset=!1,this.reset(),this._width=void 0,this._height=void 0},m.Interpolator.prototype={setWidth:function(t){this._width=t},setHeight:function(t){this._height=t},reset:function(){for(var t=0,e=this._current.length;t<e;t++)this._current[t]=this._target[t]=0;this._reset=!0},update:function(){var t,e;return t=void 0===this._width?0:(this._target[0]-this._current[0])/this._width,this._delta[0]=t,this._current[0]=this._target[0],e=void 0===this._height?0:(this._target[1]-this._current[1])/this._height,this._delta[1]=e,this._current[1]=this._target[1],this._delta},set:function(){for(var t=0,e=this._current.length;t<e;t++)this._current[t]=this._target[t]=arguments[t];this._reset=!1},isReset:function(){return this._reset},getCurrent:function(){return this._current},setTarget:function(){for(var t=0,e=this._target.length;t<e;t++)this._reset?this._target[t]=this._current[t]=arguments[t]:this._target[t]=arguments[t];this._reset=!1},addTarget:function(){for(var t=0;t<arguments.length;t++)this._target[t]+=arguments[t]},getTarget:function(){return this._target},getDelta:function(){return this._delta}},m.AvailableControllerList=["StandardMouseKeyboard","Hammer"],m.ControllerList=["StandardMouseKeyboard","Hammer"],i.createPrototypeObject(m,i.objectInherit(n.prototype,{init:function(){this._distance=25,this._target=l.create(),this._upz=l.fromValues(0,0,1),this._right=l.fromValues(1,0,0),l.init(this._target);var t=u.fromRotation(u.create(),-Math.PI,this._upz),e=u.fromRotation(u.create(),Math.PI/10,this._right);this._rotation=u.create(),u.mul(this._rotation,t,e),this._time=0,this._rotate=new m.Interpolator,this._pan=new m.Interpolator,this._zoom=new g(1),this._panFactor=1.5,this._rotateFactor=1,this._zoomFactor=1,this._inverseMatrix=u.create(),this._homeEye=void 0,this._homeCenter=void 0,this._homeUp=l.fromValues(0,0,1),this._orientation=d.create(),this._pivotPoint=l.create(),this._eye=void 0,this._zoomDir=l.create();var r=this;m.ControllerList.forEach(function(t){void 0!==m[t]&&(r._controllerList[t]?r._controllerList[t].init():r._controllerList[t]=new m[t](r))})},setViewer:function(t){this._viewer=t},reset:function(){this.init()},setNode:function(t){this._node=t},setPivotPoint:function(t){l.copy(this._pivotPoint,t)},setTarget:function(){var t=l.create();return function(e){l.copy(this._target,e),this.getEyePosition(t),this._distance=l.distance(e,t)}}(),setEyePosition:function(t){l.copy(this._eye,t),this._distance=l.distance(this._target,t)},setHomePosition:function(t,e,r){this._homeEye=t,this._homeCenter=e,this._homeUp=r},computeHomePosition:function(){var t=l.create(),e=l.create(),r=l.create(),i=u.create();return function(n){var a=this.getHomeBound(n);if(a){this.setDistance(this.getHomeDistance(a)),this.setTarget(a.center()),this.setPivotPoint(a.center()),void 0===this._homeEye&&(this._homeEye=l.create(),this.getEyePosition(this._homeEye)),void 0===this._homeCenter&&(this._homeCenter=l.create(),l.copy(this._homeCenter,a.center())),void 0===this._eye&&(this._eye=l.create()),l.copy(this._eye,this._homeEye),l.copy(this._target,this._homeCenter),l.copy(this._upz,this._homeUp),u.copy(i,this._rotation);var s=this._target,o=this._eye;l.sub(t,s,o),l.normalize(t,t),l.cross(e,t,this._upz),l.normalize(e,e),l.cross(r,e,t),l.normalize(r,r),i[0]=e[0],i[1]=r[0],i[2]=-t[0],i[3]=0,i[4]=e[1],i[5]=r[1],i[6]=-t[1],i[7]=0,i[8]=e[2],i[9]=r[2],i[10]=-t[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,u.getRotation(this._orientation,i),d.invert(this._orientation,this._orientation)}}}(),setZoomFactor:function(t){this._zoomFactor=t},setRotateFactor:function(t){this._rotateFactor=t},setPanFactor:function(t){this._panFactor=t},setDistance:function(t){this._distance=t},setUsePolytopeIntersector:function(t){this._usePolytopeIntersector=t},getUsePolytopeIntersector:function(){return this._usePolytopeIntersector},getDistance:function(){return this._distance},zoom:function(t){this._distance=t},getRotateInterpolator:function(){return this._rotate},getPanInterpolator:function(){return this._pan},getZoomInterpolator:function(){return this._zoom},getIntersectionVisitor:function(){return this._intersectionVisitor},getLineSegmentIntersector:function(){return this._lineSegmentIntersector},getOrCreatePolytopeIntersector:function(){return void 0===this._polytopeIntersector&&(this._polytopeIntersector=new o,this._polytopeIntersector.setIntersectionLimit(p.LIMIT_ONE_PER_DRAWABLE),this._polytopeIntersector.setPrimitiveMask(p.POINT_PRIMITIVES|p.LINE_PRIMITIVES)),this._polytopeIntersector},getTarget:function(t){return l.copy(t,this._target),t},getEyePosition:function(t){void 0===this._eye?this.computeEyePosition(this._target,this._distance,t):l.copy(t,this._eye)},computeEyePosition:function(){var t=l.create(),e=u.create();return function(r,i,n){u.invert(e,this._rotation),t[1]=i,l.transformMat4(n,t,e),l.add(n,r,n)}}(),computePan:function(){var t=l.create(),e=l.create(),r=l.create();return function(i,n,a){var s=l.length(l.sub(r,this._eye,this._pivotPoint))/this._panFactor;s<10&&(s=10),t[0]=i*s/2,t[1]=n*s/2,t[2]=0,l.transformMat4(e,t,a),l.add(this._eye,this._eye,e)}}(),computeZoom:function(){var t=l.create(),e=l.create();return function(r){var i=r*this._zoomFactor;l.sub(t,this._pivotPoint,this._eye),l.add(this._eye,this._eye,l.scale(e,t,i))}}(),computeRotation:function(){var t=l.create(),e=l.create(),r=l.create(),i=l.create(),n=d.create(),a=d.create(),s=d.create(),o=l.create(),h=l.create();return function(u,c){l.transformQuat(e,this._right,this._orientation),l.normalize(t,e),l.sub(r,this._eye,this._pivotPoint);var _=l.dot(t,r);l.sub(i,r,l.scale(h,t,_));var f=l.fromValues(-i[0],-i[1],0),g=Math.atan2(-i[2],l.length(f));c=Math.max(-Math.PI/2+.01,Math.min(Math.PI/2-.01,g+c))-g,d.setAxisAngle(n,e,c*this._rotateFactor),d.setAxisAngle(a,this._upz,u*this._rotateFactor),d.mul(s,a,n),l.transformQuat(o,r,s),l.add(this._eye,o,this._pivotPoint),d.mul(this._orientation,a,this._orientation),l.transformQuat(e,this._right,this._orientation),d.setAxisAngle(n,e,c*this._rotateFactor),d.mul(this._orientation,n,this._orientation)}}(),update:function(){var t=u.create(),e=u.create();return function(r){var i=r.getFrameStamp().getDeltaTime(),n=10,a=this._rotate.update();this.computeRotation(-a[0]*n,a[1]*n),u.fromQuat(t,this._orientation);var s=this._pan.update();this.computePan(-s[0]*n,-s[1]*n,t),a=this._zoom.update(i),this.computeZoom(-a[0]/10),u.fromTranslation(e,this._eye),u.mul(this._inverseMatrix,e,t),u.invert(this._inverseMatrix,this._inverseMatrix)}}(),getInverseMatrix:function(){return this._inverseMatrix},computeIntersections:function(){var t=[],e=l.create();return function(r){var i=this._camera.getView(),n=this._camera,a=n.getViewport().width(),s=n.getViewport().height();this._rotate.setWidth(a),this._rotate.setHeight(s),this._pan.setWidth(a),this._pan.setHeight(s);var o,u;if(0!==(this._primitiveMask&p.TRIANGLE_PRIMITIVES)&&(t=i.computeIntersections(r[0],r[1]),t.length>0&&(o=t[0]._localIntersectionPoint,t[0]._nodePath.shift(),u=h.computeLocalToWorld(t[0]._nodePath),l.transformMat4(e,o,u),this.setPivotPoint(e))),0===t.length&&this._usePolytopeIntersector){var c=this.getOrCreatePolytopeIntersector();c.reset(),c.setPolytopeFromWindowCoordinates(r[0]-5,r[1]-5,r[0]+5,r[1]+5);var d=this._intersectionVisitor;d.setIntersector(c),i.getCamera().accept(d),t=c.getIntersections(),t.sort(function(t,e){return t._distance-e._distance}),t.length>0&&(o=t[0]._localIntersectionPoint,t[0]._nodePath.shift(),u=h.computeLocalToWorld(t[0]._nodePath),l.transformMat4(e,o,u),this.setPivotPoint(e))}}}(),getPositionRelativeToCanvas:function(){var t=c.create(),e=c.create();return function(r,i){var n=this._camera._graphicContext.canvas;this.getOffsetRect(n,t);var a=n.width/n.clientWidth,s=n.height/n.clientHeight;return e[0]=(r-t[1])*a,e[1]=(n.clientHeight-(i-t[0]))*s,e}}(),getCanvasCenter:function(){var t=c.create(),e=c.create();return function(){var r=this._camera.getGraphicContext().canvas;this.getOffsetRect(r,t);var i=r.width/r.clientWidth,n=r.height/r.clientHeight;return e[0]=r.clientWidth/2*i,e[1]=r.clientHeight/2*n,e}}(),getOffsetRect:function(t,e){var r=t.getBoundingClientRect(),i=document.body,n=document.documentElement,a=window.pageYOffset||n.scrollTop||i.scrollTop,s=window.pageXOffset||n.scrollLeft||i.scrollLeft,o=n.clientTop||i.clientTop||0,h=n.clientLeft||i.clientLeft||0,u=r.top+a-o,c=r.left+s-h;return e[0]=Math.round(u),e[1]=Math.round(c),e}}),"osgGA","CADManipulator"),m.StandardMouseKeyboard=_,m.Hammer=f,t.exports=m},function(t,e,r){"use strict";var i=r(28),n=r(15).mat4,a=function(t){this._boundStrategy=t,void 0===this._boundStrategy&&(this._boundStrategy=a.COMPUTE_HOME_USING_SPHERE),this._controllerList={},this._inverseMatrix=n.create(),this._camera=void 0,this._node=void 0,this._frustum={},this._computeBoundNodeMaskOverride=-1};a.prototype={setCamera:function(t){this._camera=t},getCamera:function(){return this._camera},setNode:function(t){this._node=t},setComputeBoundNodeMaskOverride:function(t){this._computeBoundNodeMaskOverride=t},getComputeBoundNodeMaskOverride:function(){return this._computeBoundNodeMaskOverride},getHomeBound:function(t){var e=this._node;if(e){var n=void 0!==t?t:this._boundStrategy;if(n&a.COMPUTE_HOME_USING_BBOX){var s=new i,o=null;if(this._computeBoundNodeMaskOverride===-1)o=e.getBoundingBox();else{var h=r(35),u=new h;u.setNodeMaskOverride(this._computeBoundNodeMaskOverride),u.reset(),u.apply(e),o=u.getBoundingBox()}if(o.valid()&&s.expandByBoundingBox(o),n&a.COMPUTE_HOME_USING_SPHERE){var c=e.getBound();if(c.radius()<s.radius())return c}return s}return e.getBound()}},getHomeDistance:function(t){var e=this._frustum,r=t.radius();if(this._camera&&n.getFrustum(e,this._camera.getProjectionMatrix())){var i=Math.abs(e.right-e.left)/e.zNear/2,a=Math.abs(e.top-e.bottom)/e.zNear/2;r/=Math.sin(Math.atan2(a<i?a:i,1))}else r*=1.5;return r},update:function(){},getInverseMatrix:function(){return this._inverseMatrix},getControllerList:function(){return this._controllerList}},a.COMPUTE_HOME_USING_SPHERE=1,a.COMPUTE_HOME_USING_BBOX=2,t.exports=a},function(t,e,r){"use strict";var i=r(7),n=r(31),a=r(15).mat4,s=r(32),o=r(50),h=r(34),u=function(){n.call(this),this._intersector=void 0,this._projectionStack=new o,this._modelStack=new o,this._viewStack=new o,this._windowStack=new o,this._pooledMatrix=new s(a.create),this.reset()};i.createPrototypeObject(u,i.objectInherit(n.prototype,{reset:function(){this._pooledMatrix.reset(),this._viewStack.reset(),this._modelStack.reset(),this._projectionStack.reset(),this._windowStack.reset(),this._viewStack.push(a.IDENTITY),this._modelStack.push(a.IDENTITY),this._projectionStack.push(a.IDENTITY),this._windowStack.push(a.IDENTITY)},setIntersector:function(t){this._intersector=t},getIntersector:function(){return this._intersector},pushModelMatrix:function(t){this._modelStack.push(t)},getModelMatrix:function(){return this._modelStack.back()},popModelMatrix:function(){return this._modelStack.pop()},pushViewMatrix:function(t){this._viewStack.push(t)},getViewMatrix:function(){return this._viewStack.back()},popViewMatrix:function(){return this._viewStack.pop()},pushProjectionMatrix:function(t){
this._projectionStack.push(t)},getProjectionMatrix:function(){return this._projectionStack.back()},popProjectionMatrix:function(){return this._projectionStack.pop()},pushWindowMatrix:function(t){this._windowStack.push(t)},pushWindowMatrixUsingViewport:function(t){this._windowStack.push(t.computeWindowMatrix(this._pooledMatrix.getOrCreateObject()))},getWindowMatrix:function(){return this._windowStack.back()},popWindowMatrix:function(){return this._windowStack.pop()},getTransformation:function(){var t=a.create64();return function(){return a.copy(t,this.getWindowMatrix()),a.mul(t,t,this.getProjectionMatrix()),a.mul(t,t,this.getViewMatrix()),a.mul(t,t,this.getModelMatrix()),t}}(),enter:function(t){return this._intersector.enter(t)},apply:function(t){t.getViewMatrix?this.applyCamera(t):t.getMatrix?this.applyTransform(t):this.applyNode(t)},applyCamera:function(t){var e=t.getViewport();void 0!==e&&this.pushWindowMatrixUsingViewport(e);var r,i,n;t.getReferenceFrame()===h.RELATIVE_RF&&this.getViewMatrix()&&this.getProjectionMatrix()?(r=a.mul(this._pooledMatrix.getOrCreateObject(),this.getProjectionMatrix(),t.getProjectionMatrix()),i=this.getViewMatrix(),n=a.mul(this._pooledMatrix.getOrCreateObject(),this.getModelMatrix(),t.getViewMatrix())):(r=t.getProjectionMatrix(),i=t.getViewMatrix(),n=a.identity(this._pooledMatrix.getOrCreateObject())),this.pushProjectionMatrix(r),this.pushViewMatrix(i),this.pushModelMatrix(n),this._intersector.setCurrentTransformation(this.getTransformation()),this.traverse(t),this.popModelMatrix(),this.popViewMatrix(),this.popProjectionMatrix(),void 0!==e&&this.popWindowMatrix(),this._intersector.setCurrentTransformation(this.getTransformation())},applyNode:function(t){if(this.enter(t))return t.getPrimitiveSetList?void this._intersector.intersect(this,t):void(t.traverse&&this.traverse(t))},applyTransform:function(t){if(this.enter(t)){if(t.getReferenceFrame()===h.ABSOLUTE_RF){var e=this._pooledMatrix.getOrCreateObject();this.pushViewMatrix(a.identity(e)),this.pushModelMatrix(t.getMatrix())}else if(this._modelStack.getLength()>0){var r=a.copy(this._pooledMatrix.getOrCreateObject(),this.getModelMatrix());a.mul(r,r,t.getMatrix()),this.pushModelMatrix(r)}else this.pushModelMatrix(t.getMatrix());this._intersector.setCurrentTransformation(this.getTransformation()),this.traverse(t),this.popModelMatrix(),t.getReferenceFrame()===h.ABSOLUTE_RF&&this.popViewMatrix(),this._intersector.setCurrentTransformation(this.getTransformation())}}}),"osgUtil","IntersectionVisitor"),t.exports=u},function(t,e,r){"use strict";var i=r(7),n=r(15).vec3,a=r(15).mat4,s=r(167),o=r(169),h=function(){s.call(this),this._start=n.create(),this._iStart=n.create(),this._end=n.create(),this._iEnd=n.create(),this._threshold=0,this._iThreshold=0};i.createPrototypeObject(h,i.objectInherit(s.prototype,{set:function(t,e,r){n.copy(this._start,t),n.copy(this._iStart,t),n.copy(this._end,e),n.copy(this._iEnd,e),void 0!==r&&(this._threshold=this._iThreshold=r)},setStart:function(t){n.copy(this._start,t),n.copy(this._iStart,t)},setEnd:function(t){n.copy(this._end,t),n.copy(this._iEnd,t)},intersectNode:function(t){return this.intersectBoundingSphere(t.getBoundingSphere())},intersectBoundingSphere:function(){var t=n.create(),e=n.create();return function(r){if(!r.valid())return!1;n.sub(t,this._iStart,r.center());var i=n.sqrLen(t)-r.radius2();if(i<=0)return!0;n.sub(e,this._iEnd,this._iStart);var a=n.sqrLen(e),s=2*n.dot(t,e),o=s*s-4*a*i;if(o<0)return!1;o=Math.sqrt(o);var h=.5/a,u=(-s-o)*h,c=(-s+o)*h;return!(u<=0&&c<=0)&&!(u>1&&c>1)}}(),intersect:function(){var t=new o;return function(e,r){t.setGeometry(r),t.setIntersectionVisitor(e),t.setIntersector(this),t.set(this._iStart,this._iEnd,this._iThreshold);var i=r.getShape();return i?void i.intersectLineSegment(t,i.getNodes()[0],this._iStart,this._iEnd,this._iThreshold):(r.computeTransformedVertices&&t.setVertices(r.computeTransformedVertices()),t.apply(r),void t.reset())}}(),setCurrentTransformation:function(t){if(a.invert(t,t),this._threshold>0){var e=this._iStart;a.getScale(e,t);var r=e[0],i=e[1],s=e[2];this._iThreshold=this._threshold*(r>i?r>s?r:s:i>s?i:s)}n.transformMat4(this._iStart,this._start,t),n.transformMat4(this._iEnd,this._end,t)}}),"osgUtil","LineSegmentIntersector"),t.exports=h},function(t,e,r){"use strict";var i=r(168),n=function(){this._intersections=[],this._primitiveMask=i.ALL_PRIMITIVES,this._intersectionLimit=i.NO_LIMIT};n.prototype={reset:function(){this._intersections.length=0},enter:function(t){return!this.reachedLimit()&&(!t.isCullingActive()||this.intersectNode(t))},intersectNode:function(t){return this.intersectBoundingSphere(t.getBoundingSphere())||this.intersectBoundingBox(t.getBoundingBox())},intersectBoundingSphere:function(){return!1},intersectBoundingBox:function(){return!1},getIntersections:function(){return this._intersections},setIntersectionLimit:function(t){this._intersectionLimit=t},getIntersectionLimit:function(){return this._intersectionLimit},setPrimitiveMask:function(t){this._primitiveMask=t},getPrimitiveMask:function(){return this._primitiveMask},reachedLimit:function(){return this._intersectionLimit===i.LIMIT_ONE&&this._intersections.length>0},setCurrentTransformation:function(){},intersect:function(){}},t.exports=n},function(t,e){"use strict";t.exports={NO_LIMIT:0,LIMIT_ONE_PER_DRAWABLE:1,LIMIT_ONE:2,POINT_PRIMITIVES:1,LINE_PRIMITIVES:2,TRIANGLE_PRIMITIVES:4,ALL_PRIMITIVES:7}},function(t,e,r){"use strict";var i=r(7),n=r(15).vec3,a=r(15).mat4,s=r(170),o=function(){s.Intersection.call(this),this._localIntersectionNormal=n.clone(n.ONE),this._i1=-1,this._i2=-1,this._i3=-1,this._r1=0,this._r2=0,this._r3=0},h=function(){s.call(this),this._threshold=0,this._d=n.create(),this._length=0,this._invLength=0,this._start=n.create(),this._end=n.create(),this._dInvX=n.create(),this._dInvY=n.create(),this._dInvZ=n.create(),this._hit=!1};i.createPrototypeObject(h,i.objectInherit(s.prototype,{set:function(t,e,r){this._start=t,this._end=e,n.sub(this._d,e,t),this._length=n.length(this._d),this._invLength=0!==this._length?1/this._length:0,n.scale(this._d,this._d,this._invLength),0!==this._d[0]&&n.scale(this._dInvX,this._d,1/this._d[0]),0!==this._d[1]&&n.scale(this._dInvY,this._d,1/this._d[1]),0!==this._d[2]&&n.scale(this._dInvZ,this._d,1/this._d[2]),void 0!==r&&(this._threshold=r)},enter:function(t,e,r){var i=t._min,a=i[0],s=i[1],o=i[2],h=t._max,u=h[0],c=h[1],l=h[2],d=this._dInvX,_=this._dInvY,f=this._dInvZ;if(e[0]<=r[0]){if(r[0]<a)return!1;if(e[0]>u)return!1;e[0]<a&&n.scaleAndAdd(e,e,d,a-e[0]),r[0]>u&&n.scaleAndAdd(r,e,d,u-e[0])}else{if(e[0]<a)return!1;if(r[0]>u)return!1;r[0]<a&&n.scaleAndAdd(r,e,d,a-e[0]),e[0]>u&&n.scaleAndAdd(e,e,d,u-e[0])}if(e[1]<=r[1]){if(r[1]<s)return!1;if(e[1]>c)return!1;e[1]<s&&n.scaleAndAdd(e,e,_,s-e[1]),r[1]>c&&n.scaleAndAdd(r,e,_,c-e[1])}else{if(e[1]<s)return!1;if(r[1]>c)return!1;r[1]<s&&n.scaleAndAdd(r,e,_,s-e[1]),e[1]>c&&n.scaleAndAdd(e,e,_,c-e[1])}if(e[2]<=r[2]){if(r[2]<o)return!1;if(e[2]>l)return!1;e[2]<o&&n.scaleAndAdd(e,e,f,o-e[2]),r[2]>l&&n.scaleAndAdd(r,e,f,l-e[2])}else{if(e[2]<o)return!1;if(r[2]>l)return!1;r[2]<o&&n.scaleAndAdd(r,e,f,o-e[2]),e[2]>l&&n.scaleAndAdd(e,e,f,l-e[2])}return!0},intersectPoint:function(){var t=n.create(),e=n.create();return function(r,i){var a=this._start;n.sub(t,r,a),n.sub(e,this._end,a);var s=n.dot(t,e)*this._invLength*this._invLength,h=1;if(h=s<0?n.sqrLen(t):s>1?n.sqrDist(r,this._end):n.sqrLen(n.scaleAndAdd(t,t,e,-s)),!(h>this._threshold*this._threshold)){var u=this.initIntersection(new o);u._i1=i,u._r1=1,n.scaleAndAdd(u._localIntersectionPoint,a,e,s),u._ratio=s}}}(),intersectLine:function(){var t=n.create(),e=n.create(),r=n.create(),i=n.create(),a=n.create();return function(s,h,u,c){var l=1e-8;n.sub(t,h,s),n.sub(e,this._end,this._start),n.sub(r,s,this._start);var d,_,f=n.dot(t,t),g=n.dot(t,e),p=n.dot(e,e),m=n.dot(t,r),v=n.dot(e,r),S=f*p-g*g,x=S,b=S;S<l?(d=0,x=1,_=v,b=p):(d=g*v-p*m,_=f*v-g*m,d<0?(d=0,_=v,b=p):d>x&&(d=x,_=v+g,b=p)),_<0?(_=0,-m<0?d=0:-m>f?d=x:(d=-m,x=f)):_>b&&(_=b,-m+g<0?d=0:-m+g>f?d=x:(d=-m+g,x=f));var y=Math.abs(d)<l?0:d/x,M=Math.abs(_)<l?0:_/b;n.scaleAndAdd(i,s,t,y),n.scaleAndAdd(a,this._start,e,M);var T=n.sqrDist(i,a);if(!(T>this._threshold*this._threshold)){var A=this.initIntersection(new o);A._i1=u,A._i2=c,A._r1=1-M,A._r2=M,n.copy(A._localIntersectionPoint,a),A._ratio=M}}}(),intersectTriangle:function(){var t=n.create(),e=n.create(),r=n.create(),i=n.create(),s=n.create(),h=n.create(),u=1e-20;return function(c,l,d,_,f,g){var p=this._d;n.sub(e,d,c),n.sub(r,l,c),n.cross(s,p,e);var m=n.dot(s,r);if(!(m>-u&&m<u)){var v=1/m;n.sub(i,this._start,c);var S=n.dot(s,i)*v;if(!(S<0||S>1)){n.cross(h,i,r);var x=n.dot(h,p)*v;if(!(x<0||S+x>1)){var b=n.dot(h,e)*v;if(!(b<u||b>this._length)){var y=1-S-x,M=S,T=x,A=b*this._invLength,C=c[0]*y+l[0]*M+d[0]*T,I=c[1]*y+l[1]*M+d[1]*T,w=c[2]*y+l[2]*M+d[2]*T;n.cross(t,r,e),n.normalize(t,t);var E=this.initIntersection(new o);E._i1=_,E._i2=f,E._i3=g,E._r1=y,E._r2=M,E._r3=T,n.set(E._localIntersectionPoint,C,I,w),n.copy(E._localIntersectionNormal,t),E._ratio=A,E._backface=a.determinant(E._matrix)*m<0}}}}}}(),operatorPoint:function(t){this._threshold<=0||s.prototype.operatorPoint.call(this,t)},operatorLine:function(t,e){this._threshold<=0||s.prototype.operatorLine.call(this,t,e)}}),"osgUtil","LineSegmentIntersectFunctor"),t.exports=h},function(t,e,r){"use strict";var i=r(15).vec3,n=r(15).mat4,a=r(97),s=r(168),o=function(){this._hit=!1,this._primitiveIndex=0,this._vertices=void 0,this._geometry=void 0,this._intersectionVisitor=void 0,this._intersector=void 0,this._limitOneIntersection=!1,this._primitiveMask=s.ALL_PRIMITIVES};o.Intersection=function(){this._nodePath=void 0,this._drawable=void 0,this._matrix=void 0,this._primitiveIndex=void 0,this._ratio=0,this._backface=!1,this._localIntersectionPoint=i.create()},o.prototype={reset:function(){this._hit=!1,this._vertices=void 0,this._primitiveIndex=0},setPrimitiveIndex:function(t){this._primitiveIndex=t},setGeometry:function(t){this._geometry=t,this._primitiveIndex=0,this._vertices=t.getAttributes().Vertex.getElements()},setVertices:function(t){this._vertices=t},setIntersectionVisitor:function(t){this._intersectionVisitor=t},setIntersector:function(t){this._intersector=t,this._primitiveMask=t.getPrimitiveMask();var e=t.getIntersectionLimit();this._limitOneIntersection=e===s.LIMIT_ONE_PER_DRAWABLE||e===s.LIMIT_ONE},setLimitOneIntersection:function(t){this._limitOneIntersection=t},leave:function(){},enter:function(){},initIntersection:function(t){return t._matrix=n.clone(this._intersectionVisitor.getModelMatrix()),t._nodePath=this._intersectionVisitor.getNodePath().slice(),t._primitiveIndex=this._primitiveIndex,t._drawable=this._geometry,this._intersector.getIntersections().push(t),this._hit=!0,t},intersectPoint:function(){},intersectLine:function(){},intersectTriangle:function(){},operatorPoint:function(){var t=i.create();return function(e){if(!(this._limitOneIntersection&&this._hit||0===(this._primitiveMask&s.POINT_PRIMITIVES))){var r=this._vertices;i.set(t,r[3*e],r[3*e+1],r[3*e+2]),this.intersectPoint(t,e),this._primitiveIndex++}}}(),operatorLine:function(){var t=i.create(),e=i.create();return function(r,n){if(!(this._limitOneIntersection&&this._hit||0===(this._primitiveMask&s.LINE_PRIMITIVES))){var a=this._vertices;i.set(t,a[3*r],a[3*r+1],a[3*r+2]),i.set(e,a[3*n],a[3*n+1],a[3*n+2]),this.intersectLine(t,e,r,n),this._primitiveIndex++}}}(),operatorTriangle:function(){var t=i.create(),e=i.create(),r=i.create();return function(n,a,o){if(!(this._limitOneIntersection&&this._hit||0===(this._primitiveMask&s.TRIANGLE_PRIMITIVES))){var h=this._vertices;i.set(t,h[3*n],h[3*n+1],h[3*n+2]),i.set(e,h[3*a],h[3*a+1],h[3*a+2]),i.set(r,h[3*o],h[3*o+1],h[3*o+2]),this.intersectTriangle(t,e,r,n,a,o),this._primitiveIndex++}}}(),apply:function(t){t.getAttributes().Vertex&&a(t,this)}},t.exports=o},function(t,e,r){"use strict";var i=r(7),n=r(15).vec4,a=r(15).vec3,s=r(59),o=r(60),h=r(167),u=r(172),c=function(){h.call(this),this._index=0,this._polytope=new s,this._iPolytope=new s,this._referencePlane=n.create(),this._iReferencePlane=n.create()},l=function(t,e,r){var i=e[0],n=e[1],a=e[2],s=e[3];t[0]=r[0]*i+r[1]*n+r[2]*a+r[3]*s,t[1]=r[4]*i+r[5]*n+r[6]*a+r[7]*s,t[2]=r[8]*i+r[9]*n+r[10]*a+r[11]*s,t[3]=r[12]*i+r[13]*n+r[14]*a+r[15]*s};i.createPrototypeObject(c,i.objectInherit(h.prototype,{setPolytope:function(t){this._polytope.setPlanes(t);for(var e=[],r=0;r<t.length;++r){var i=t[r];e[r]=n.copy(this._iPolytope.getPlanes()[r]||o.create(),i)}this._iPolytope.setPlanes(e),n.copy(this._referencePlane,t[t.length-1]),n.copy(this._iReferencePlane,this._referencePlane)},getPolytope:function(){return this._iPolytope},setPolytopeFromWindowCoordinates:function(t,e,r,i){this.setPolytope([n.fromValues(1,0,0,-t),n.fromValues(-1,0,0,r),n.fromValues(0,1,0,-e),n.fromValues(0,-1,0,i),n.fromValues(0,0,1,0)])},intersectBoundingBox:function(t){return this._iPolytope.containsBoundingBox(t)},intersectBoundingSphere:function(t){return this._iPolytope.containsBoundingSphere(t)},intersect:function(){var t=new u;return function(e,r){t.setGeometry(r),t.setIntersectionVisitor(e),t.setIntersector(this);var i=r.getShape();i?i.intersect(t,i.getNodes()[0]):(r.computeTransformedVertices&&t.setVertices(r.computeTransformedVertices()),t.apply(r)),t.reset()}}(),setCurrentTransformation:function(t){for(var e=this._polytope.getPlanes(),r=this._iPolytope.getPlanes(),i=0,s=e.length;i<s;i++){var o=r[i]=r[i]||n.create();l(o,e[i],t),n.scale(o,o,1/a.len(o))}l(this._iReferencePlane,this._referencePlane,t),n.scale(this._iReferencePlane,this._iReferencePlane,1/a.len(this._iReferencePlane))}}),"osgUtil","PolytopeIntersector"),t.exports=c},function(t,e,r){"use strict";var i=r(7),n=r(15).vec3,a=r(60),s=r(170),o=function(){s.Intersection.call(this),this._intersectionPoints=[],this._distance=0,this._maxDistance=0,this._numIntersectionPoints=0},h=function(){s.call(this),this._src=[],this._dest=[],this._maxNumIntersectionsPoints=6};i.createPrototypeObject(h,i.objectInherit(s.prototype,{reset:function(){s.prototype.reset.call(this),this._src=[],this._dest=[]},enter:function(t){return!!this._intersector.getPolytope().containsBoundingBox(t)&&(this._intersector.getPolytope().pushCurrentMask(),!0)},leave:function(){this._intersector.getPolytope().popCurrentMask()},addIntersection:function(){this._src=i.arrayUniq(this._src);for(var t=this._src,e=n.create(),r=-Number.MAX_VALUE,s=this._intersector._iReferencePlane,h=0;h<t.length;++h){n.add(e,e,t[h]);var u=a.distanceToPlane(s,t[h]);u>r&&(r=u)}n.scale(e,e,1/t.length);var c=this.initIntersection(new o);c._distance=a.distanceToPlane(s,e),c._maxDistance=r,n.copy(c._localIntersectionPoint,e);var l=this._maxNumIntersectionsPoints;for(c._numIntersectionPoints=t.length<l?t.length:l,h=0;h<c._numIntersectionPoints;++h)c._intersectionPoints.push(n.clone(this._src[h]))},contains:function(){var t=this._intersector.getPolytope(),e=t.getPlanes(),r=t.getCurrentMask();if(!r)return!0;for(var i=1,s=0;s<e.length;++s)if(r&0===i)i<<=1;else{this._dest=[];for(var o=e[s],h=this._src[1],u=a.distanceToPlane(o,h),c=0;c<this._src.length;++c){var l=this._src[c],d=a.distanceToPlane(o,l);if(u>=0&&this._dest.push(n.clone(h)),u*d<0){var _=u-d,f=u/_,g=n.add(n.create(),n.scale(n.create(),h,1-f),n.scale(n.create(),l,f));this._dest.push(g)}u=d,h=l}if(u>=0&&this._dest.push(n.clone(h)),this._dest.length<=1)return!1;var p=this._src.slice();this._src=this._dest.slice(),this._dest=p}return!0},containsPoint:function(t){return!!this._intersector.getPolytope().containsVertex(t)&&(this._src=[],this._src[0]=t,!0)},containsLine:function(t,e){return this._src=[],this._src[0]=t,this._src[1]=e,this.contains()},containsTriangle:function(t,e,r){return this._src=[],this._src[0]=t,this._src[1]=e,this._src[2]=r,this.contains()},intersectPoint:function(t){this.containsPoint(t)&&this.addIntersection()},intersectLine:function(t,e){this.containsLine(t,e)&&this.addIntersection()},intersectTriangle:function(t,e,r){this.containsTriangle(t,e,r)&&this.addIntersection()}}),"osgUtil","PolytopeIntersectFunctor"),t.exports=h},function(t,e,r){"use strict";var i=r(174),n=function(t){this._manipulator=t,this._timer=!1,this.init()};n.prototype={init:function(){this.releaseButton(),this._rotateKey=65,this._zoomKey=83,this._panKey=68,this._mode=void 0},getMode:function(){return this._mode},setMode:function(t){this._mode=t},setEventProxy:function(t){this._eventProxy=t},setManipulator:function(t){this._manipulator=t},mousemove:function(t){if(this._buttonup!==!0){var e=this._manipulator,r=e.getPositionRelativeToCanvas(t.clientX,t.clientY);if(isNaN(r[0])===!1&&isNaN(r[1])===!1){var n=this.getMode();if(n===i.Rotate)e.getRotateInterpolator().setTarget(r[0],r[1]);else if(n===i.Pan)e.getPanInterpolator().setTarget(r[0],r[1]);else if(n===i.Zoom){var a=e.getZoomInterpolator();e.computeIntersections(r),a.isReset()&&(a.setStart(r[1]),a.set(0));var s=r[1]-a.getStart();a.setStart(r[1]);var o=a.getTarget()[0];a.setTarget(o-s/20)}}t.preventDefault()}},mousedown:function(t){var e=this._manipulator,r=this.getMode();void 0===r&&(0===t.button?t.shiftKey?this.setMode(i.Pan):t.ctrlKey?this.setMode(i.Zoom):this.setMode(i.Rotate):this.setMode(i.Pan)),this.pushButton();var n=e.getPositionRelativeToCanvas(t.clientX,t.clientY);e.computeIntersections(n),r=this.getMode(),r===i.Rotate?(e.getRotateInterpolator().reset(),e.getRotateInterpolator().set(n[0],n[1])):r===i.Pan?(e.getPanInterpolator().reset(),e.getPanInterpolator().set(n[0],n[1])):r===i.Zoom&&(e.getZoomInterpolator().setStart(n[1]),e.getZoomInterpolator().set(0))},mouseup:function(){this.releaseButton(),this.setMode(void 0)},mousewheel:function(t,e){var r=this._manipulator,i=r.getZoomInterpolator().getTarget()[0]-e;r.getZoomInterpolator().setTarget(i);var n;if(this._timer===!1){this._timer=!0;var a=this;clearTimeout(n),n=setTimeout(function(){a._timer=!1},200);var s=r.getPositionRelativeToCanvas(t.clientX,t.clientY);r.computeIntersections(s)}},dblclick:function(t){var e=this._manipulator;t.preventDefault(),e.getZoomInterpolator().set(0);var r=e.getZoomInterpolator().getTarget()[0]-10;e.getZoomInterpolator().setTarget(r);var i=e.getPositionRelativeToCanvas(t.clientX,t.clientY);e.computeIntersections(i)},pushButton:function(){this._buttonup=!1},releaseButton:function(){this._buttonup=!0},keydown:function(t){32===t.keyCode?(this._manipulator.computeHomePosition(),t.preventDefault()):t.keyCode===this._panKey&&this.getMode()!==i.Pan?(this.setMode(i.Pan),this._manipulator.getPanInterpolator().reset(),this.pushButton(),t.preventDefault()):t.keyCode===this._zoomKey&&this.getMode()!==i.Zoom?(this.setMode(i.Zoom),this._manipulator.getZoomInterpolator().reset(),this.pushButton(),t.preventDefault()):t.keyCode===this._rotateKey&&this.getMode()!==i.Rotate&&(this.setMode(i.Rotate),this._manipulator.getRotateInterpolator().reset(),this.pushButton(),t.preventDefault())},keyup:function(t){t.keyCode===this._panKey?this.mouseup(t):t.keyCode===this._rotateKey?this.mouseup(t):t.keyCode===this._rotateKey&&this.mouseup(t),this.setMode(void 0)}},t.exports=n},function(t,e,r){"use strict";var i=r(7),n=r(15).vec3,a=r(15).mat4,s=r(164),o=r(175),h=r(177),u=r(178),c=r(179),l=r(181),d=r(182),_=function(t){s.call(this,t),this._homePosition=n.create(),this._frustum={},this.init()};_.AvailableControllerList=["StandardMouseKeyboard","GamePad","Hammer","DeviceOrientation","WebVR"],_.ControllerList=["StandardMouseKeyboard","GamePad","Hammer","DeviceOrientation","WebVR"];var f=2*Math.PI,g=function(t,e){return t<e+1e-5};i.createPrototypeObject(_,i.objectInherit(s.prototype,{init:function(){this._distance=25,this._target=n.create(),this._upz=n.fromValues(0,0,1),n.init(this._target);var t=a.fromRotation(a.create(),-Math.PI,this._upz),e=a.fromRotation(a.create(),Math.PI/10,n.fromValues(1,0,0));this._rotation=a.create(),a.mul(this._rotation,t,e),this._time=0,this._vrMatrix=a.create(),this._rotate=new d(2),this._pan=new d(2),this._zoom=new d(1),this._minSpeed=1e-4,this._scaleMouseMotion=1,this._inverseMatrix=a.create(),this._autoPushTarget=!0,this._limitPitchUp=.5*Math.PI*.9,this._limitPitchDown=-this._limitPitchUp,this._limitYawLeft=-Math.PI,this._limitYawRight=-this._limitYawLeft,this._limitZoomIn=1e-4,this._limitZoomOut=1/0;var r=this;_.ControllerList.forEach(function(t){void 0!==_[t]&&(r._controllerList[t]?r._controllerList[t].init():r._controllerList[t]=new _[t](r))})},setLimitPitchUp:function(t){this._limitPitchUp=t},setLimitPitchDown:function(t){this._limitPitchDown=t},setLimitYawLeft:function(t){this._limitYawLeft=t},setLimitYawRight:function(t){this._limitYawRight=t},setLimitZoomOut:function(t){this._limitZoomOut=t},setLimitZoomIn:function(t){this._limitZoomIn=t},setDelay:function(t){this._rotate.setDelay(t),this._pan.setDelay(t),this._zoom.setDelay(t)},reset:function(){this.init()},setTarget:function(t){n.copy(this._target,t);var e=n.create();this.getEyePosition(e),this._distance=n.distance(t,e)},setEyePosition:function(){var t=n.create(),e=n.create(),r=n.create();return function(i){var a=this._rotation,s=this._target;n.sub(t,i,s),n.normalize(t,t),n.cross(e,t,this._upz),n.normalize(e,e),n.cross(r,e,t),n.normalize(r,r),a[0]=e[0],a[1]=t[0],a[2]=r[0],a[3]=0,a[4]=e[1],a[5]=t[1],a[6]=r[1],a[7]=0,a[8]=e[2],a[9]=t[2],a[10]=r[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,this._distance=n.distance(s,i)}}(),computeHomePosition:function(t){var e=this.getHomeBound(t);e&&e.valid()&&(this.setDistance(this.getHomeDistance(e)),this.setTarget(e.center()))},getHomePosition:function(){if(void 0!==this._node){var t=this._target,e=this.getDistance();this.computeEyePosition(t,e,this._homePosition)}return this._homePosition},setMinSpeed:function(t){this._minSpeed=t},getMinSpeed:function(){return this._minSpeed},setDistance:function(t){this._distance=t},getDistance:function(){return this._distance},getSpeedFactor:function(){return Math.max(this._distance,this._minSpeed)},computePan:function(){var t=a.create(),e=n.create(),r=n.create();return function(i,s){var o=this._camera.getProjectionMatrix(),h=1===o[15]?1:2/o[5],u=this.getSpeedFactor()*h;s*=u,i*=u,a.invert(t,this._rotation),e[0]=t[0],e[1]=t[1],e[2]=t[2],n.normalize(e,e),r[0]=t[8],r[1]=t[9],r[2]=t[10],n.normalize(r,r),n.scale(e,e,-i),n.scale(r,r,s),n.add(this._target,this._target,e),n.add(this._target,this._target,r)}}(),computeRotation:function(){var t=n.fromValues(1,0,0);return function(e,r){var i=Math.atan(-this._rotation[6]/this._rotation[5])+r/10;i=Math.min(Math.max(i,this._limitPitchDown),this._limitPitchUp);var n=e/10,s=Math.atan2(this._rotation[4],this._rotation[0]),o=this._computeYaw(s,n,this._limitYawLeft,this._limitYawRight);a.fromRotation(this._rotation,-i,t),a.rotate(this._rotation,this._rotation,-o,this._upz)}}(),_computeYaw:function(t,e,r,i){var n=t+e;if(i!==Math.PI||r!==-Math.PI){if(i<r&&(n>Math.PI&&(t-=f,n-=f),n<-Math.PI&&(t+=f,n+=f)),0===e){var a=!1;a=r>i?n<r&&n>i:n<r||n>i,a&&(n=Math.abs(n-r)>Math.abs(n-i)?i:r)}e>0&&g(t,i)&&n>i?n=i:e<0&&g(r,t)&&n<r&&(n=r)}return n},computeZoom:function(t){this.zoom(t)},setAutoPushTarget:function(t){this._autoPushTarget=t},zoom:function(){var t=n.create();return function(e){var r=this._distance+this.getSpeedFactor()*(e-1);this._autoPushTarget&&r<this._limitZoomIn&&(n.sub(t,this._target,this.getEyePosition(t)),n.normalize(t,t),n.scale(t,t,this._limitZoomIn-r),n.add(this._target,this._target,t)),this._distance=Math.max(this._limitZoomIn,Math.min(this._limitZoomOut,r))}}(),getRotateInterpolator:function(){return this._rotate},getPanInterpolator:function(){return this._pan},getZoomInterpolator:function(){return this._zoom},getTarget:function(t){return n.copy(t,this._target)},getEyePosition:function(t){return this.computeEyePosition(this._target,this._distance,t),t},computeEyePosition:function(){var t=n.create(),e=a.create();return function(r,i,s){a.invert(e,this._rotation),t[1]=i,n.transformMat4(s,t,e),n.add(s,r,s)}}(),update:function(){var t=n.create();return function(e){var r,i=e.getFrameStamp().getDeltaTime(),s=.1;r=this._rotate.update(i),this.computeRotation(-r[0]*s*this._scaleMouseMotion,-r[1]*s*this._scaleMouseMotion);var o=.002;r=this._pan.update(i),this.computePan(-r[0]*o,-r[1]*o),r=this._zoom.update(i),this.computeZoom(1+r[0]/10);var h=this._target,u=this._distance;a.invert(this._inverseMatrix,this._rotation),a.mul(this._inverseMatrix,this._vrMatrix,this._inverseMatrix),n.set(t,0,u,0),n.transformMat4(t,t,this._inverseMatrix),a.lookAt(this._inverseMatrix,n.add(t,h,t),h,this._upz)}}(),setPoseVR:function(t){a.fromQuat(this._vrMatrix,t)}}),"osgGA","OrbitManipulator"),_.DeviceOrientation=o,_.GamePad=h,_.Hammer=u,_.WebVR=l,_.StandardMouseKeyboard=c,t.exports=_},function(t,e,r){"use strict";var i=r(15).quat,n=r(15).vec3,a=r(176),s=function(t){this._manipulator=t,this.init()};s.prototype={init:function(){this._stepFactor=1,this._quat=i.create(),this._pos=n.create()},update:function(t,e){a.computeQuaternion(this._quat,t,e),this._manipulator.setPoseVR(this._quat,this._pos)}},t.exports=s},function(t,e,r){"use strict";var i=r(15).quat,n=r(15).vec3,a=Math.PI/180,s=function(t,e,r,i,n){var a=Math.cos(e/2),s=Math.cos(r/2),o=Math.cos(i/2),h=Math.sin(e/2),u=Math.sin(r/2),c=Math.sin(i/2);return"XYZ"===n?(t[0]=h*s*o+a*u*c,t[1]=a*u*o-h*s*c,t[2]=a*s*c+h*u*o,t[3]=a*s*o-h*u*c):"YXZ"===n?(t[0]=h*s*o+a*u*c,t[1]=a*u*o-h*s*c,t[2]=a*s*c-h*u*o,t[3]=a*s*o+h*u*c):"ZXY"===n?(t[0]=h*s*o-a*u*c,t[1]=a*u*o+h*s*c,t[2]=a*s*c+h*u*o,t[3]=a*s*o-h*u*c):"ZYX"===n?(t[0]=h*s*o-a*u*c,t[1]=a*u*o+h*s*c,t[2]=a*s*c-h*u*o,t[3]=a*s*o+h*u*c):"YZX"===n?(t[0]=h*s*o+a*u*c,t[1]=a*u*o+h*s*c,t[2]=a*s*c-h*u*o,t[3]=a*s*o-h*u*c):"XZY"===n&&(t[0]=h*s*o-a*u*c,t[1]=a*u*o-h*s*c,t[2]=a*s*c+h*u*o,t[3]=a*s*o+h*u*c),t},o=function(t){this._manipulator=t,this.init()};o.computeQuaternion=function(){var t=i.create(),e=i.fromValues(-Math.sqrt(.5),0,0,Math.sqrt(.5));return function(r,n,o){var h=n.alpha*a,u=n.beta*a,c=n.gamma*a,l=o*a;s(r,u,h,-c,"YXZ");var d=-l/2;t[1]=Math.sin(d),t[3]=Math.cos(d),i.mul(r,r,t),i.mul(r,r,e);var _=r[1];return r[1]=-r[2],r[2]=_,r}}(),o.prototype={init:function(){this._stepFactor=1,this._quat=i.create(),this._pos=n.create()},update:function(t,e){o.computeQuaternion(this._quat,t,e),this._manipulator.setPoseVR(this._quat,this._pos)}},t.exports=o},function(t,e,r){"use strict";var i=r(15).vec2,n=function(t){this._manipulator=t,this.init()};n.prototype={init:function(){this._delay=.15,this._threshold=.08,this._mode=0,this._padFactor=10,this._zoomFactor=.5,this._rotateFactor=5},addPan:function(t,e,r){t.setDelay(this._delay),t.addTarget(e*this._padFactor,r*this._padFactor)},addZoom:function(t,e){t.setDelay(this._delay),t.addTarget(e*this._zoomFactor)},addRotate:function(t,e,r){t.setDelay(this._delay),t.addTarget(e*this._rotateFactor,r*this._rotateFactor)},gamepadaxes:function(t){var e=.005,r=this._manipulator.getRotateInterpolator(),i=this._manipulator.getZoomInterpolator(),n=this._manipulator.getPanInterpolator();4===t.length?((Math.abs(t[0])>e||Math.abs(t[1])>e)&&this.addRotate(r,-t[0],t[1]),Math.abs(t[3])>e&&this.addZoom(i,-t[3])):t.length>=5&&((Math.abs(t[0])>e||Math.abs(t[1])>e)&&this.addPan(n,-t[0],t[1]),Math.abs(t[2])>e&&this.addZoom(i,-t[2]),(Math.abs(t[3])>e||Math.abs(t[4])>e)&&this.addRotate(r,t[4],t[3]))},gamepadbuttondown:function(t){if(t.button>=12&&t.button<=15){var e=this._manipulator.getPanInterpolator(),r=e.getTarget(),n={12:i.fromValues(0,-1),13:i.fromValues(0,1),14:i.fromValues(-1,0),15:i.fromValues(1,0)}[t.button];e.setDelay(this._delay),e.setTarget(r[0]-10*n[0],r[1]+10*n[1])}},update:function(t){if(t){var e=t.axes,r=t.buttons;this.gamepadaxes(e);for(var i=function(){},n=0;n<r.length;n++)r[n]&&this.gamepadbuttondown({preventDefault:i,gamepad:t,button:n},!!r[n])}}},t.exports=n},function(t,e,r){"use strict";var i=r(16),n=function(t){this._manipulator=t,this.init()};n.prototype={init:function(){this._panFactorX=1,this._panFactorY=-this._panFactorX,this._rotateFactorX=.6,this._rotateFactorY=-this._rotateFactorX,this._zoomFactor=5,this._lastScale=0,this._nbPointerLast=0,this._delay=.15,this._transformStarted=!1,this._dragStarted=!1,this._cbPanStart=this.panStart.bind(this),this._cbPanMove=this.panMove.bind(this),this._cbPanEnd=this.panEnd.bind(this),this._cbPinchStart=this.pinchStart.bind(this),this._cbPinchEnd=this.pinchEnd.bind(this),this._cbPinchInOut=this.pinchInOut.bind(this),this._isValid=!0},setValid:function(t){t!==this._isValid&&(this._isValid=t,this._transformStarted=!1,this._dragStarterd=!1)},getPanStartBind:function(){return this._cbPanStart},getPanMoveBind:function(){return this._cbPanMove},getPanEndBind:function(){return this._cbPanEnd},getPinchEndBind:function(){return this._cbPinchEnd},_setListeners:function(){var t=this._eventProxy;t.get("pinch").set({threshold:.1}),t.get("pan").set({threshold:0,pointers:0}),t.get("pinch").recognizeWith(t.get("pan")),t.on("panstart ",this._cbPanStart),t.on("panmove",this._cbPanMove),t.on("panend",this._cbPanEnd),t.on("pinchend",this._cbPinchEnd),t.on("pinchstart",this._cbPinchStart),t.on("pinchin pinchout",this._cbPinchInOut),this._transformStarted=!1,this._dragStarterd=!1},setEventProxy:function(t){t&&t!==this._eventProxy&&(this._eventProxy=t,this._manipulator&&this._setListeners())},_computeTouches:function(t){return void 0!==t.pointers?t.pointers.length:1},panStart:function(t){if(this._isValid&&!this._transformStarted&&"mouse"!==t.pointerType){this._dragStarted=!0;var e=this._manipulator;if(this._nbPointerLast=this._computeTouches(t),2===this._nbPointerLast){var r=e.getPanInterpolator();r.reset();var i=t.center.x*this._panFactorX,n=t.center.y*this._panFactorY;r.set(i,n)}else{var a=e.getRotateInterpolator();a.reset();var s=t.center.x*this._rotateFactorX,o=t.center.y*this._rotateFactorY;a.set(s,o)}}},panMove:function(t){if(this._isValid&&this._dragStarted&&"mouse"!==t.pointerType){var e=this._manipulator,r=this._computeTouches(t);if(this._nbPointerLast!==r&&(2===r?e.getPanInterpolator().reset():e.getRotateInterpolator().reset(),this._nbPointerLast=r),2===r){var i=e.getPanInterpolator(),n=t.center.x*this._panFactorX,a=t.center.y*this._panFactorY;i.setTarget(n,a)}else{var s=e.getRotateInterpolator();s.setDelay(this._delay);var o=t.center.x*this._rotateFactorX,h=t.center.y*this._rotateFactorY;s.setTarget(o,h)}}},panEnd:function(t){this._isValid&&this._dragStarted&&"mouse"!==t.pointerType&&(this._dragStarted=!1)},pinchStart:function(t){if(this._isValid&&"mouse"!==t.pointerType){this._transformStarted=!0,this._lastScale=t.scale;var e=this._manipulator.getZoomInterpolator();e.reset(),e.set(this._lastScale),t.preventDefault()}},pinchEnd:function(t){this._isValid&&"mouse"!==t.pointerType&&(this._transformStarted=!1)},pinchInOut:function(t){if(this._isValid&&this._transformStarted&&"mouse"!==t.pointerType){var e=t.scale>this._lastScale?this._zoomFactor:3*this._zoomFactor,r=0,n=.5,a=-Math.abs(t.velocity)+(r+n);e*=i.smoothStep(r,n,a);var s=(t.scale-this._lastScale)*e;this._lastScale=t.scale;var o=this._manipulator.getZoomInterpolator();o.setTarget(o.getTarget()[0]-s)}},removeEventProxy:function(t){var e=t||this._eventProxy;e&&(e.off("panstart ",this._cbPanStart),e.off("panmove",this._cbPanMove),e.off("panend",this._cbPanEnd),e.off("pinchstart",this._cbPinchStart),e.off("pinchend",this._cbPinchEnd),e.off("pinchin pinchout",this._cbPinchInOut))},setManipulator:function(t){this._manipulator=t,this._eventProxy&&this._setListeners()}},t.exports=n},function(t,e,r){"use strict";var i=r(16),n=r(180),a=function(t){this._manipulator=t,this.init()};a.prototype={init:function(){this.releaseButton(),this._rotateKey=65,this._zoomKey=83,this._panKey=68,this._mode=void 0,this._delay=.15},getMode:function(){return this._mode},setMode:function(t){this._mode=t},setEventProxy:function(t){this._eventProxy=t},setManipulator:function(t){this._manipulator=t},mousemove:function(t){if(this._buttonup!==!0){var e=this._eventProxy.getPositionRelativeToCanvas(t),r=this._manipulator;if(i.isNaN(e[0])===!1&&i.isNaN(e[1])===!1){var a=this.getMode();if(a===n.ROTATE)r.getRotateInterpolator().setDelay(this._delay),
r.getRotateInterpolator().setTarget(e[0],e[1]);else if(a===n.PAN)r.getPanInterpolator().setTarget(e[0],e[1]);else if(a===n.ZOOM){var s=r.getZoomInterpolator();s.isReset()&&(s.setStart(e[1]),s.set(0));var o=e[1]-s.getStart();s.setStart(e[1]);var h=s.getTarget()[0];s.setTarget(h-o/20)}}t.preventDefault()}},mousedown:function(t){var e=this._manipulator,r=this.getMode();void 0===r&&(0===t.button?t.shiftKey?this.setMode(n.PAN):t.ctrlKey?this.setMode(n.ZOOM):this.setMode(n.ROTATE):2===t.button&&t.ctrlKey?this.setMode(n.ZOOM):this.setMode(n.PAN)),this.pushButton();var i=this._eventProxy.getPositionRelativeToCanvas(t);r=this.getMode(),r===n.ROTATE?(e.getRotateInterpolator().reset(),e.getRotateInterpolator().set(i[0],i[1])):r===n.PAN?(e.getPanInterpolator().reset(),e.getPanInterpolator().set(i[0],i[1])):r===n.ZOOM&&(e.getZoomInterpolator().setStart(i[1]),e.getZoomInterpolator().set(0))},mouseup:function(){this.releaseButton(),this.setMode(void 0)},mouseout:function(){this.releaseButton(),this.setMode(void 0)},mousewheel:function(t,e){var r=this._manipulator,i=r.getZoomInterpolator().getTarget()[0]-e;r.getZoomInterpolator().setTarget(i)},pushButton:function(){this._buttonup=!1},releaseButton:function(){this._buttonup=!0},keydown:function(t){32===t.keyCode?(this._manipulator.computeHomePosition(),t.preventDefault()):t.keyCode===this._panKey&&this.getMode()!==n.PAN?(this.setMode(n.PAN),this._manipulator.getPanInterpolator().reset(),this.pushButton(),t.preventDefault()):t.keyCode===this._zoomKey&&this.getMode()!==n.ZOOM?(this.setMode(n.ZOOM),this._manipulator.getZoomInterpolator().reset(),this.pushButton(),t.preventDefault()):t.keyCode===this._rotateKey&&this.getMode()!==n.ROTATE&&(this.setMode(n.ROTATE),this._manipulator.getRotateInterpolator().reset(),this.pushButton(),t.preventDefault())},keyup:function(t){t.keyCode===this._panKey?this.mouseup(t):t.keyCode===this._rotateKey?this.mouseup(t):t.keyCode===this._rotateKey&&this.mouseup(t),this.setMode(void 0)}},t.exports=a},function(t,e){"use strict";t.exports={ROTATE:0,PAN:1,ZOOM:2}},function(t,e){"use strict";var r=function(t){this._manipulator=t,this.init()};r.prototype={init:function(){},update:function(t,e){this._manipulator.setPoseVR(t,e)}},t.exports=r},function(t,e){var r=function(t,e){this._current=new Float32Array(t),this._target=new Float32Array(t),this._delta=new Float32Array(t),this._delay=void 0!==e?e:.15,this._reset=!1,this._start=0,this.reset()};r.prototype={setDelay:function(t){this._delay=t},reset:function(){for(var t=0,e=this._current.length;t<e;t++)this._current[t]=this._target[t]=0;this._reset=!0},update:function(t){for(var e=Math.min(1,this._delay*t*60),r=0,i=this._current.length;r<i;r++){var n=(this._target[r]-this._current[r])*e;this._delta[r]=n,this._current[r]+=n}return this._delta},set:function(){for(var t=0,e=this._current.length;t<e;t++)this._current[t]=this._target[t]=arguments[t];this._reset=!1},isReset:function(){return this._reset},getCurrent:function(){return this._current},setTarget:function(){for(var t=0,e=this._target.length;t<e;t++)this._reset?this._target[t]=this._current[t]=arguments[t]:this._target[t]=arguments[t];this._reset=!1},addTarget:function(){for(var t=0;t<arguments.length;t++)this._target[t]+=arguments[t]},getTarget:function(){return this._target},getDelta:function(){return this._delta},getStart:function(){return this._start},setStart:function(t){this._start=t}},t.exports=r},function(t,e){"use strict";var r=function(t){this._manipulator=t,this._timer=!1,this.init()};r.prototype={init:function(){this._panFactorX=1,this._panFactorY=-this._panFactorX,this._rotateFactorX=.6,this._rotateFactorY=-this._rotateFactorX,this._zoomFactor=5,this._lastScale=0,this._nbPointerLast=0,this._lastPos=void 0,this._isValid=!1},setValid:function(t){this._isValid=t},setEventProxy:function(t){t&&t!==this._eventProxy&&(this._eventProxy=t,t.get("pinch").set({threshold:.1}),t.get("pan").set({threshold:0,pointers:0}),t.get("pinch").recognizeWith(t.get("pan")),t.get("tap").set({taps:2,posThreshold:300}),this._cbPanStart=this.panStart.bind(this),this._cbPanMove=this.panMove.bind(this),this._cbPanEnd=this.panEnd.bind(this),this._cbPinchStart=this.pinchStart.bind(this),this._cbPinchEnd=this.pinchEnd.bind(this),this._cbPinchInOut=this.pinchInOut.bind(this),this._cbDoubleTap=this.doubleTap.bind(this),t.on("panstart ",this._cbPanStart),t.on("panmove",this._cbPanMove),t.on("panend",this._cbPanEnd),t.on("pinchstart",this._cbPinchStart),t.on("pinchend",this._cbPinchEnd),t.on("pinchin pinchout",this._cbPinchInOut),t.on("tap",this._cbDoubleTap))},_computeTouches:function(t){return void 0!==t.pointers?t.pointers.length:1},panStart:function(t){if(this._isValid){var e=this._manipulator;if(e&&!this._transformStarted&&"mouse"!==t.pointerType){this._dragStarted=!0,this._nbPointerLast=this._computeTouches(t);var r;if(2===this._nbPointerLast?(r=e.getPositionRelativeToCanvas(t.center.x,t.center.y),this._lastPos=r):r=void 0===this._lastPos?e.getCanvasCenter():this._lastPos,e.computeIntersections(r),2===this._nbPointerLast){var i=e.getPanInterpolator();e.getPanInterpolator().reset();var n=t.center.x*this._panFactorX,a=t.center.y*this._panFactorY;i.set(n,a)}else e.getRotateInterpolator().reset()}}},panMove:function(t){if(this._isValid){var e=this._manipulator;if(e&&this._dragStarted&&"mouse"!==t.pointerType){var r=this._computeTouches(t);if(this._nbPointerLast!==r&&(2===r?e.getPanInterpolator().reset():e.getRotateInterpolator().reset(),this._nbPointerLast=r),2===r){var i=e.getPanInterpolator(),n=t.center.x*this._panFactorX,a=t.center.y*this._panFactorY;i.setTarget(n,a)}else{var s=e.getRotateInterpolator(),o=t.center.x*this._rotateFactorX,h=t.center.y*this._rotateFactorY;s.setTarget(o,h)}}}},panEnd:function(t){if(this._isValid){var e=this._manipulator;e&&this._dragStarted&&"mouse"!==t.pointerType&&(this._dragStarted=!1)}},pinchStart:function(t){if(this._isValid){var e=this._manipulator;e&&"mouse"!==t.pointerType&&(this._transformStarted=!0,this._lastScale=t.scale,e.getZoomInterpolator().reset(),e.getZoomInterpolator().set(this._lastScale),t.preventDefault())}},pinchEnd:function(t){this._isValid&&"mouse"!==t.pointerType&&(this._transformStarted=!1)},pinchInOut:function(t){if(this._isValid){var e=this._manipulator;if(e&&this._transformStarted&&"mouse"!==t.pointerType){var r=t.scale>this._lastScale,i=r?this._zoomFactor:4*this._zoomFactor,n=(t.scale-this._lastScale)*i;this._lastScale=t.scale;var a=e.getZoomInterpolator();a.setTarget(a.getTarget()[0]-n)}}},doubleTap:function(t){if(this._isValid){var e=this._manipulator;if(e&&"mouse"!==t.pointerType){var r=e.getPositionRelativeToCanvas(t.center.x,t.center.y);this._lastPos=r,e.getZoomInterpolator().set(0);var i=e.getZoomInterpolator();i.setTarget(i.getTarget()[0]-10)}}},removeEventProxy:function(t){t&&this._eventProxy&&(t.off("panstart ",this._cbPanStart),t.off("panmove",this._cbPanMove),t.off("panend",this._cbPanEnd),t.off("pinchstart",this._cbPinchStart),t.off("pinchend",this._cbPinchEnd),t.off("pinchin pinchout",this._cbPinchInOut),t.off("tap",this._cbDoubleTap))},setManipulator:function(t){this._manipulator=t}},t.exports=r},function(t,e,r){"use strict";var i=r(7),n=r(164),a=r(15).mat4,s=r(15).vec2,o=r(15).vec3,h=r(15).quat,u=r(176),c=r(185),l=r(186),d=r(187),_=r(182),f=function(t){n.call(this,t),this.init()};f.AvailableControllerList=["StandardMouseKeyboard","WebVR","DeviceOrientation","Hammer"],f.ControllerList=["StandardMouseKeyboard","WebVR","DeviceOrientation","Hammer"],i.createPrototypeObject(f,i.objectInherit(n.prototype,{computeHomePosition:function(t){var e=this.getHomeBound(t);if(e&&e.valid()){this._distance=this.getHomeDistance(e);var r=e.center();o.scale(this._eye,this._direction,-this._distance),o.add(this._eye,r,this._eye),this.setTarget(r)}},init:function(){this._direction=o.fromValues(0,1,0),this._eye=o.fromValues(0,25,10),this._up=o.fromValues(0,0,1),this._distance=1,this._forward=new _(1),this._side=new _(1),this._lookPosition=new _(2),this._pan=new _(2),this._zoom=new _(1),this._stepFactor=1,this._angleVertical=0,this._angleHorizontal=0,this._tmpGetTargetDir=o.create(),this._vrEnable=!1,this._vrRot=h.create(),this._vrPos=o.create(),this._vrTrans=o.create();var t=this;this._controllerList={},f.ControllerList.forEach(function(e){void 0!==f[e]&&(t._controllerList[e]?t._controllerList[e].init():t._controllerList[e]=new f[e](t))})},setDelay:function(t){this._forward.setDelay(t),this._side.setDelay(t),this._lookPosition.setDelay(t),this._pan.setDelay(t),this._zoom.setDelay(t)},getEyePosition:function(t){return t[0]=this._eye[0],t[1]=this._eye[1],t[2]=this._eye[2],t},setEyePosition:function(t){return this._eye[0]=t[0],this._eye[1]=t[1],this._eye[2]=t[2],this},getTarget:function(t){var e=o.scale(this._tmpGetTargetDir,this._direction,this._distance);return o.add(t,this._eye,e),t},setTarget:function(t){var e=this._tmpGetTargetDir;o.sub(e,t,this._eye),e[2]=0,o.normalize(e,e),this._angleHorizontal=Math.acos(e[1]),e[0]<0&&(this._angleHorizontal=-this._angleHorizontal),o.sub(e,t,this._eye),o.normalize(e,e),this._angleVertical=-Math.asin(e[2]),o.copy(this._direction,e)},getLookPositionInterpolator:function(){return this._lookPosition},getSideInterpolator:function(){return this._side},getForwardInterpolator:function(){return this._forward},getPanInterpolator:function(){return this._pan},getZoomInterpolator:function(){return this._zoom},getRotateInterpolator:function(){return this._lookPosition},computeRotation:function(){var t=a.create(),e=a.create(),r=o.fromValues(1,0,0),i=o.fromValues(0,1,0),n=o.fromValues(0,0,1),s=.5*Math.PI;return function(h,u){this._angleVertical+=.01*u,this._angleHorizontal-=.01*h,this._angleVertical>s?this._angleVertical=s:this._angleVertical<-s&&(this._angleVertical=-s),this._vrEnable?(o.transformQuat(this._direction,i,this._vrRot),o.normalize(this._direction,this._direction),o.transformQuat(this._up,n,this._vrRot)):(a.fromRotation(t,-this._angleVertical,r),a.fromRotation(e,-this._angleHorizontal,n),a.mul(e,e,t),o.transformMat4(this._direction,i,e),o.normalize(this._direction,this._direction),o.transformMat4(this._up,n,e))}}(),reset:function(){this.init()},setDistance:function(t){this._distance=t},getDistance:function(){return this._distance},setStepFactor:function(t){this._stepFactor=t},computePosition:function(){var t=s.create();return function(e){this._forward.update(e),this._side.update(e);var r=this._distance<.001?.001:this._distance,i=this._camera.getProjectionMatrix(),n=1===i[15]?1:2/i[5];t[0]=this._forward.getCurrent()[0],t[1]=this._side.getCurrent()[0];var a=s.sqrLen(t);a>1&&s.scale(t,t,1/Math.sqrt(a));var h=this._pan.update(e),u=this._zoom.update(e),c=this._stepFactor*r*n*e,l=this._stepFactor*r*n*.005;this.moveForward(t[0]*c-u[0]*l*20),this.strafe(t[1]*c-h[0]*l),this.strafeVertical(-h[1]*l),this._vrEnable&&(o.add(this._eye,this._eye,this._vrTrans),o.init(this._vrTrans))}}(),update:function(){var t=o.create();return function(e){var r=e.getFrameStamp().getDeltaTime(),i=this._lookPosition.update(r);this.computeRotation(.5*-i[0],.5*-i[1]),this.computePosition(r),o.add(t,this._eye,this._direction),a.lookAt(this._inverseMatrix,this._eye,t,this._up),this._vrEnable=!1}}(),setPoseVR:function(t,e){this._vrEnable=!0,h.copy(this._vrRot,t),o.sub(this._vrTrans,e,this._vrPos),o.copy(this._vrPos,e)},moveForward:function(){var t=o.create();return function(e){o.normalize(t,this._direction),o.scale(t,t,e),o.add(this._eye,this._eye,t)}}(),strafe:function(){var t=o.create();return function(e){o.cross(t,this._direction,this._up),o.normalize(t,t),o.scale(t,t,e),o.add(this._eye,this._eye,t)}}(),strafeVertical:function(){var t=o.create();return function(e){o.normalize(t,this._up),o.scale(t,t,e),o.add(this._eye,this._eye,t)}}()}),"osgGA","FirstPersonManipulator"),f.DeviceOrientation=u,f.Hammer=c,f.WebVR=l,f.StandardMouseKeyboard=d,t.exports=f},function(t,e,r){"use strict";var i=r(178);t.exports=i},function(t,e){"use strict";var r=function(t){this._manipulator=t,this.init()};r.prototype={init:function(){},update:function(t,e){this._manipulator.setPoseVR(t,e)}},t.exports=r},function(t,e){"use strict";var r=function(t){this._manipulator=t,this.init()};r.prototype={init:function(){this.releaseButton(),this._delay=.15,this._stepFactor=1},setEventProxy:function(t){this._eventProxy=t},setManipulator:function(t){this._manipulator=t,this._manipulator.setStepFactor(this._stepFactor)},pushButton:function(){this._buttonup=!1},releaseButton:function(){this._buttonup=!0},mousedown:function(t){var e=this._eventProxy.getPositionRelativeToCanvas(t),r=this._manipulator;r.getLookPositionInterpolator().set(e[0],e[1]),this.pushButton()},mouseup:function(){this.releaseButton()},mouseout:function(){this.releaseButton()},mousemove:function(t){if(this._buttonup!==!0){var e=this._eventProxy.getPositionRelativeToCanvas(t);this._manipulator.getLookPositionInterpolator().setDelay(this._delay),this._manipulator.getLookPositionInterpolator().setTarget(e[0],e[1]),t.preventDefault()}},mousewheel:function(t,e){this._stepFactor=Math.min(Math.max(.001,this._stepFactor+.01*e),4),this._manipulator.setStepFactor(this._stepFactor)},keydown:function(t){var e=this._manipulator;if(32===t.keyCode)e.computeHomePosition(),t.preventDefault();else{if(87===t.keyCode||90===t.keyCode||38===t.keyCode)return e.getForwardInterpolator().setDelay(this._delay),e.getForwardInterpolator().setTarget(1),t.preventDefault(),!1;if(83===t.keyCode||40===t.keyCode)return e.getForwardInterpolator().setDelay(this._delay),e.getForwardInterpolator().setTarget(-1),t.preventDefault(),!1;if(68===t.keyCode||39===t.keyCode)return e.getSideInterpolator().setDelay(this._delay),e.getSideInterpolator().setTarget(1),t.preventDefault(),!1;if(65===t.keyCode||81===t.keyCode||37===t.keyCode)return e.getSideInterpolator().setDelay(this._delay),e.getSideInterpolator().setTarget(-1),t.preventDefault(),!1}},keyup:function(t){var e=this._manipulator;return 87===t.keyCode||90===t.keyCode||38===t.keyCode||83===t.keyCode||40===t.keyCode?(e.getForwardInterpolator().setDelay(this._delay),e.getForwardInterpolator().setTarget(0),!1):68===t.keyCode||39===t.keyCode||65===t.keyCode||81===t.keyCode||37===t.keyCode?(e.getSideInterpolator().setDelay(this._delay),e.getSideInterpolator().setTarget(0),!1):void 0}},t.exports=r},function(t,e){"use strict";var r=function(){this._manipulatorList=[],this._currentManipulator=void 0};r.prototype={getCamera:function(){return this.getCurrentManipulator().getCamera()},setCamera:function(t){for(var e=this.getManipulatorList(),r=0,i=e.length;r<i;++r)e[r].setCamera(t)},update:function(t){var e=this.getCurrentManipulator();if(void 0!==e)return e.update(t)},getNode:function(){return this.getCurrentManipulator()._node},setNode:function(t){for(var e=this.getManipulatorList(),r=0,i=e.length;r<i;++r)e[r].setNode(t)},getControllerList:function(){return this.getCurrentManipulator().getControllerList()},getNumManipulator:function(){return this._manipulatorList.length},addManipulator:function(t){this._manipulatorList.push(t),void 0===this._currentManipulator&&this.setManipulatorIndex(0)},getManipulatorList:function(){return this._manipulatorList},setManipulatorIndex:function(t){this._currentManipulator=t},getCurrentManipulatorIndex:function(){return this._currentManipulator},getCurrentManipulator:function(){return this._manipulatorList[this._currentManipulator]},reset:function(){this.getCurrentManipulator().reset()},computeHomePosition:function(t){var e=this.getCurrentManipulator();void 0!==e&&e.computeHomePosition(t)},getInverseMatrix:function(){var t=this.getCurrentManipulator();if(void 0!==t)return t.getInverseMatrix()},getHomeBound:function(t){return this.getCurrentManipulator().getHomeBound(t)},getHomeDistance:function(t){return this.getCurrentManipulator().getHomeDistance(t)}},t.exports=r},function(t,e,r){"use strict";var i=r(190),n=r(191),a=r(182),s=r(192),o=r(203),h=r(207),u=r(170),c=r(167),l=r(165),d=r(166),_=r(169),f=r(7),g=r(214),p=r(215),m=r(171),v=r(172),S=r(216),x=r(218),b=r(219),y=r(220),M=r(168),T={};T.ComposerPostProcess=i,f.objectMix(T,n),T.DelayInterpolator=a,T.DisplayNormalVisitor=s,T.DisplayGeometryVisitor=o,T.DisplayGraph=h,T.IntersectFunctor=u,T.Intersector=c,T.IntersectionVisitor=l,T.LineSegmentIntersector=d,T.LineSegmentIntersectFunctor=_,T.NodeGizmo=g,T.GizmoGeometry=p,T.WebVRCustom=b,T.PolytopeIntersector=m,T.PolytopeIntersectFunctor=v,T.SphereIntersector=S,T.TangentSpaceGenerator=x,T.WebVR=y,T.NO_LIMIT=M.NO_LIMIT,T.LIMIT_ONE_PER_DRAWABLE=M.LIMIT_ONE_PER_DRAWABLE,T.LIMIT_ONE=M.LIMIT_ONE,T.POINT_PRIMITIVES=M.POINT_PRIMITIVES,T.LINE_PRIMITIVES=M.LINE_PRIMITIVES,T.TRIANGLE_PRIMITIVES=M.TRIANGLE_PRIMITIVES,T.ALL_PRIMITIVES=M.ALL_PRIMITIVES,t.exports=T},function(t,e,r){"use strict";var i=r(7),n=r(12),a=r(57),s=r(89),o=r(40),h=r(41),u=r(29),c=r(54),l=r(71),d=r(129),_=r(104),f=r(122),g=r(123),p=r(34),m=r(105),v=function(){n.call(this),this._feedbackSwapped=!1,this._syncFeedbackUniforms=!1,this._syncOnNextFrame=!1,this._lastXratio=1,this._lastYratio=1,this._xViewportRatio=1,this._yViewportRatio=1,this._xTextureRatio=1,this._yTextureRatio=1,this._finalPassUpScaleToScreen=!0,this._screenWidth=this._screenHeight=0,this._shaderProcessor=m(),this._feedbackData={},this._cameras=[],this._stateSets=[],this._textureUniforms=[],this._programs={},this._externalTextures={},this._internalPasses=[],this._textures={},this._userTextures={},this._currentPoolIndex=0,this._texturePool={},this._firstTexture="";var t=this.getOrCreateStateSet();t.setAttributeAndModes(new s(s.DISABLE)),t.setAttributeAndModes(new a(a.BACK)),this.setCullCallback(this)};v.VertexShader=["attribute vec3 Vertex;","void main(void) {","  gl_Position = vec4(Vertex * 2.0 - 1.0, 1.0);","}","","#define SHADER_NAME %name%",""].join("\n"),v.FragmentShader=["#ifdef GL_FRAGMENT_PRECISION_HIGH\n precision highp float;\n#else\n precision mediump float;\n#endif","uniform float uRGBMRange;","vec2 gTexCoord;","%uniforms%","",'#pragma include "functions.glsl"',"","%header%","","%texturesColorSpace%","","%functionBodies%","","void main() {","\tgTexCoord = gl_FragCoord.xy / uTextureOutputSize.xy;","\tvec4 color = %firstFunc%(%firstArg%);","%optionalFuncs%","%colorSpaces%","\tgl_FragColor = color;","}","","#define SHADER_NAME %name%",""].join("\n"),i.createPrototypeObject(v,i.objectInherit(n.prototype,{clear:function(){this._textures={},this._internalPasses.length=0,this._firstTexture="";for(var t in this._texturePool)this._texturePool[t].usage=-1;this._feedbackData={},this._cameras.length=0,this._stateSets.length=0,this._textureUniforms.length=0,this.removeChildren()},clearShaderCache:function(){this._programs={}},getGlobalXRatio:function(){return this._xViewportRatio*this._xTextureRatio},getGlobalYRatio:function(){return this._yViewportRatio*this._yTextureRatio},setFinalPassUpScaleToScreen:function(t){this._finalPassUpScaleToScreen=t},_enforceFromInputParameter:function(t,e){var r=e.name,i=this._textures[r],n=this._textures[r+"FeedbackTexture"],a=e[t];void 0!==a&&(void 0!==i[t]&&i[t]!==a&&console.error("Mismatch on parameter "+t+" : "+r),i[t]=a,n&&(n[t]=a))},_updatePassInfoFromInputs:function(t,e,r){var i=this._textures[e],n=r.srgb;r.srgb=void 0;for(var a=0;a<t.textures.length;a++){var s=t.textures[a];this._renameTextureAlias(s,e,r.name);var o=s.name;if(!this._externalTextures[o]){this._usages[o]=(this._usages[o]||0)+1;var h=s.srgb;this._enforceFromInputParameter("filter",s),this._enforceFromInputParameter("rgbm",s),this._enforceFromInputParameter("srgb",s);var u=this._textures[o];if(!u){var c=o.substring(0,o.indexOf("FeedbackTexture"));u=this._textures[c]}void 0!==n&&void 0!==h&&n!==h&&(u.encodeSRGB=!0),this._setInferredParameter("rgbmInferred","rgbm",i,u),this._setInferredParameter("srgbInferred","srgb",i,u)}}void 0===r.srgb&&(r.srgb=void 0===i.srgb?i.srgbInferred:i.srgb)},_setInferredParameter:function(t,e,r,i){void 0===r[t]&&(r[t]=void 0===i[e]?i[t]:i[e])},_createTextureOut:function(t,e,r){var i={srgb:t.out.srgb,rgbm:t.out.rgbm,filter:t.out.filter,type:t.out.type},n=t.out.type!==o.UNSIGNED_BYTE;return void 0===i.rgbm&&(r||n)&&(i.rgbm=!1),void 0===i.srgb&&(r?i.srgb=!0:(i.rgbm||n)&&(i.srgb=!1)),i},_processUserPasses:function(t){t=this._internalPasses.concat(t);for(var e=this._preprocessUserPasses(t),r=e.length,i=[],n={name:this._firstTexture,srgb:void 0},a={},s=0;s<r;s++){var o=e[s],h=s===r-1;if(h||!this._collapsePasses(o,e[s+1])){var u=o.out.name,c="%next"===u;c&&(u=o.funcs.join("_"),a[u]?u+=a[u]++:a[u]=1);var l=this._createTextureOut(o,u,h);this._textures[u]=l,this._updatePassInfoFromInputs(o,u,n),o.feedbackLoop&&(this._textures[u+"FeedbackTexture"]={srgb:l.srgb,rgbm:l.rgbm,srgbInferred:l.srgbInferred,rgbmInferred:l.rgbmInferred,filter:l.filter}),c&&(n.name=u,o.out.name=u),i.push(o)}else e.splice(s+1,1),r--,s--}return i},_hasFreeTexture:function(t,e,r){if(r.immuable)return void 0!==this._texturePool[t]?t:"";for(var i in this._texturePool){var n=this._texturePool[i];if(n.reusable&&n.usage<=0&&n.texture.divisor===r.divisor&&n.texture.getInternalFormatType()===r.type){if(n.usage===-1)return n.texture.getMinFilter()!==e&&(n.texture.setMinFilter(e),n.texture.setMagFilter(e)),i;if(n.texture.getMinFilter()===e)return i}}return""},_setOrCreateTextureKey:function(t,e,r){var i="linear"===this._textures[e].filter,n=i?o.LINEAR:o.NEAREST,a=this._hasFreeTexture(e,n,r);""===a?(a=r.immuable?e:"key"+this._currentPoolIndex++,this._texturePool[a]={usage:t,texture:this._createTexture(e,r.divisor,r.type,n),immuable:r.immuable,reusable:r.reusable},r.divisor===-1&&(this._texturePool[a].width=r.width,this._texturePool[a].height=r.height)):this._texturePool[a].usage=t,this._textures[e].key=a},_addStateSet:function(t,e){for(var r=0;r<t.funcs.length;r++){var i=t.funcs[r].name;this._stateSets[i]=e}},_addTextureToStateSet:function(t,e,r,i,n){e.addUniform(h.createInt1(r,t.uniformName));var a,s=t.name;if(void 0!==this._textures[s]){var o=this._textures[s].key;a=this._texturePool[o].texture}else a=this._externalTextures[s];return this._addTextureUniforms(t.uniformName,a,e,i,n),"TexturePrevious"===t.uniformName?r:void e.setTextureAttributeAndModes(r,a)},_getUniformName:function(t){return"u"+t[0].toUpperCase()+t.slice(1)},_addTextureUniforms:function(t,e,r,i,n){var a=this._getUniformName(t),s=h.createFloat2(a+"Size"),o=h.createFloat2(a+"Ratio");r.addUniform(s),r.addUniform(o),i.push(s),i.push(o),this._textureUniforms.push({size:s,ratio:o,texture:e,isFeedback:!!n})},_checkInferredParameters:function(){for(var t in this._textures){var e=this._textures[t];void 0===e.srgb&&(e.srgb=e.srgbInferred),void 0===e.rgbm&&(e.rgbm=e.rgbmInferred)}},build:function(t){this._usages={};var e=this._usages,r=this._processUserPasses(t);this._checkInferredParameters();for(var i=0;i<r.length;i++){var n=r[i],a=n.out.name;this._setOrCreateTextureKey(e[a],a,n.out);var s=n.out.name+"FeedbackTexture";if(n.feedbackLoop&&this._setOrCreateTextureKey(e[s],s,n.out),n.funcs.length){var o=new u;this._addStateSet(n,o);var h;for(h=0;h<n.uniforms.length;h++)o.addUniform(n.uniforms[h]);var c=[],l=void 0;for(h=0;h<n.textures.length;h++){var d=n.textures[h],_=d.name===s;if(!_&&!this._externalTextures[d.name]){var f=this._textures[d.name].key;this._texturePool[f].usage--}var g=this._addTextureToStateSet(d,o,h,c,_);if(void 0!==g&&(l=g),void 0!==this._feedbackData[d.name]){var p={stateSet:o,textureUnit:h};this._feedbackData[d.name].nextPasses.push(p)}}var m=void 0;if(i!==r.length-1){var v=this._textures[a].key;m=this._texturePool[v].texture}this._addTextureUniforms("TextureOutput",m,o,c),o.setAttributeAndModes(this._createProgram(n,c)),n.feedbackLoop?this._feedbackData[a]=this._createFeedbackLoopCameras(a,o,m,l):this.addChild(this._createCamera(a,o,m))}else{var S=this._textures[a].key;this._userTextures[a]=this._texturePool[S].texture}}this.resize(this._screenWidth,this._screenHeight)},_createFeedbackLoopCameras:function(t,e,r,i){var a=this._textures[t+"FeedbackTexture"].key,s=this._texturePool[a].texture,o=new n;o.setStateSet(e);var h=this._createFeedbackLoopCamera(t,r,s,i),u=this._createFeedbackLoopCamera(t+"FeedbackTexture",s,r,i);u.setNodeMask(0),o.addChild(h),o.addChild(u),this.addChild(o);var c={};return c.camera1=h,c.camera2=u,c.texture1=r,c.texture2=s,c.nextPasses=[],c},_createFeedbackLoopCamera:function(t,e,r,i){var n=new u;n.setTextureAttributeAndModes(i,r);var a=this._createCamera(t,n,e);return a.setStateSet(n),a},_createCamera:function(t,e,r){var i=new c;i.setName(t),i.setStateSet(e),i.setClearMask(0),i.setReferenceFrame(p.ABSOLUTE_RF),r&&(i.setRenderOrder(c.PRE_RENDER,0),i.attachTexture(l.COLOR_ATTACHMENT0,r)),i.setViewport(new d);var n=g.createTexturedFullScreenFakeQuadGeometry();return n.setName("composer layer"),i.addChild(n),this._cameras.push(i),i},swapFeedbackLoopTextures:function(t){for(var e in this._feedbackData){var r=this._feedbackData[e];r.camera1.setNodeMask(t?-1:0),r.camera2.setNodeMask(t?0:-1);for(var i=t?r.texture1:r.texture2,n=0;n<r.nextPasses.length;n++){var a=r.nextPasses[n];a.stateSet.setTextureAttributeAndModes(a.textureUnit,i)}}this._feedbackSwapped=!0},_createFuncFromUserData:function(t){var e="string"==typeof t?{name:t,file:t+".glsl"}:t;return e.toString=function(){return this.name},e},_createTextureInfoFromUserData:function(t){var e={name:"",uniformName:"",rgbm:void 0,srgb:void 0,filter:void 0};return"string"==typeof t?e.name=t:(e.name=t.name,t.uniformName&&(e.uniformName=t.uniformName),void 0!==t.rgbm&&(e.rgbm=t.rgbm),void 0!==t.srgb&&(e.srgb=t.srgb),void 0!==t.filter&&(e.filter=t.filter)),e},_preprocessUserPasses:function(t){for(var e=[],r=0;r<t.length;r++){var i=t[r],n={};if(n.funcs=[],i.func&&n.funcs.push(this._createFuncFromUserData(i.func)),n.textures=[],n.feedbackLoop=!1,void 0!==i.textures){Array.isArray(i.textures)||(i.textures=[i.textures]);for(var a=0;a<i.textures.length;a++){var s=this._createTextureInfoFromUserData(i.textures[a]);"%previous"===s.name&&(n.feedbackLoop=!0),n.textures.push(s)}}"string"==typeof i.header?n.header=[i.header]:n.header=i.header||[],void 0!==i.uniforms?Array.isArray(i.uniforms)?n.uniforms=i.uniforms:n.uniforms=[i.uniforms]:n.uniforms=[],n.out=i.out,n.out.divisor=n.out.divisor||1,n.out.type=n.out.type||o.UNSIGNED_BYTE,n.out.immuable=n.out.immuable||!1,n.out.reusable=n.out.reusable||!0,(n.feedbackLoop||n.out.divisor===-1)&&(n.out.immuable=!0,n.out.reusable=!1),n.collapsible=i.collapsible||!1,e.push(n)}return e},_canBeCollapsed:function(t,e){return t.funcs.length&&e.collapsible&&"%next"===t.out.name&&t.out.divisor===e.out.divisor&&t.out.width===t.out.width&&t.out.height===t.out.height},_collapsePasses:function(t,e){return!!this._canBeCollapsed(t,e)&&(t.funcs=t.funcs.concat(e.funcs),t.header=t.header.concat(e.header),t.textures=this._mergeWithoutDuplicates(t.textures,e.textures,function(t,e){return t.name===e.name}),t.uniforms=this._mergeWithoutDuplicates(t.uniforms,e.uniforms,function(t,e){return t.getName()===e.getName()}),!0)},_renameTextureAlias:function(t,e,r){"%last"===t.name?(t.name=r,t.uniformName=t.uniformName||"TextureInput"):"%previous"===t.name?(t.name=e+"FeedbackTexture",t.uniformName=t.uniformName||"TexturePrevious"):t.uniformName||(t.uniformName=t.name)},_createTexture:function(t,e,r,i){var n=new o;return n.setTextureSize(1,1),n.setInternalFormatType(r),n.setInternalFormat(o.RGBA),n.setMinFilter(i),n.setMagFilter(i),n.divisor=e,n.setName(t),n},_computeHashFromPass:function(t){for(var e="",r=0;r<t.funcs.length;r++)e+=t.funcs[r].name+"_"+t.funcs[r].file+"_";for(t.header&&(e+=t.header.join("_")),r=0;r<t.textures.length;r++)e+=!!t.textures[r].rgbm+"_"+!!t.textures[r].srgb+"_";return e+=!!t.out.encodeSRGB+"_",e+=!!this._textures[t.out.name].rgbm+"_"},_writeDeclarations:function(t,e,r,i){var n,a="uniform sampler2D TextureInput;\n";for(n=0;n<r.length;n++){var s=r[n].uniformName||r[n].name;a+="uniform sampler2D "+s+";\n"}for(n=0;n<e.length;n++){var o=e[n];a+="uniform "+o.getType()+" "+o.getName()+";\n"}return t=t.replace("%uniforms%",a),i&&(t=t.replace("%header%",i.join("\n"))),t},_extractTextures:function(t){var e={TEXTURE_2D:{signature:"TEXTURE_2D_%tex(uv)",body:"texture2D(%tex, (uv) * %ratio)"},TEXTURE_2D_NEAREST:{signature:"TEXTURE_2D_NEAREST_%tex(uv)",body:"texture2D(%tex, (floor((uv) * %size) + 0.5) * %ratio / %size, -99999.0)"},TEXTURE_2D_BIAS:{signature:"TEXTURE_2D_BIAS_%tex(uv, bias)",body:"texture2D(%tex, (uv) * %ratio, bias)"}},r=t.match(/TEXTURE_2D(?:_BIAS|_NEAREST)?_\w+\(/g);if(!r)return{};for(var i={},n=0;n<r.length;n++){var a=r[n].match(/((TEXTURE_2D(?:_BIAS|_NEAREST)?)_(\w+))\(/),s=e[a[2]];i[a[1]]={name:a[3],signature:s.signature,body:s.body}}return i},_writeFunctionBodies:function(t,e,r,i){for(var n=[],a="",s={},o=0;o<e.length;o++){var h=this._shaderProcessor.getShaderTextPure(e[o].file),u=this._extractTextures(h);i&&(u.TEXTURE_2D_TextureInput={name:"TextureInput",signature:"TEXTURE_2D_%tex(uv)",body:"texture2D(%tex, (uv) * %ratio)"});for(var c in u)if(!s[c]){s[c]=!0;for(var l=u[c],d=l.name,_=!1,f=0;f<r.length;f++){var g=r[f];if(g.uniformName===d){var p=g&&this._textures[g.name];p&&(_=p.rgbm)}}var m=l.body;_&&(m="vec4(decodeRGBM("+m+", uRGBMRange), 1.0)"),m="#define "+l.signature+" "+m;var v=this._getUniformName(d);m=m.replace(/%size/g,v+"Size"),m=m.replace(/%ratio/g,v+"Ratio"),m=m.replace(/%tex/g,d),n.push(m)}a+=h+"\n"}return t=t.replace("%texturesColorSpace%",n.join("\n")),t.replace("%functionBodies%",a.replace(/\\\n/g,""))},_writeMainFunction:function(t,e,r,i){t=t.replace("%firstFunc%",e[0].name);var n=r?"TEXTURE_2D_TextureInput(gTexCoord)":"";t=t.replace("%firstArg%",n);for(var a="",s=1;s<e.length;s++)a+="\tcolor = "+e[s].name+"(color);\n";if(t=t.replace("%optionalFuncs%",a),this._textures[i].encodeSRGB===!0){var o=this._textures[i].srgb?"linearTosRGB":"sRGBToLinear";a="\tcolor.rgb = "+o+"(color.rgb);\n"}else a="";return a+=this._textures[i].rgbm?"\tcolor = encodeRGBM(color.rgb, uRGBMRange);":"",t.replace("%colorSpaces%",a)},_removeDuplicatedUniforms:function(t){for(var e=t.split("\n"),r={},i=e.length,n=0;n<i;n++){var a=e[n].match(/uniform(?:\s+){1,}\w+(?:\s+){1,}(\w+)/);if(null!==a){var s=a[1];void 0!==r[s]?(e.splice(n,1),i--,n--):r[s]=!0}}return e.join("\n")},_createProgram:function(t,e){var r=this._computeHashFromPass(t);if(void 0!==this._programs[r])return this._programs[r];var i=this._writeDeclarations(v.FragmentShader,e,t.textures,t.header);i=this._writeFunctionBodies(i,t.funcs,t.textures,t.collapsible),i=this._writeMainFunction(i,t.funcs,t.collapsible,t.out.name),i=i.replace("%name%",t.out.name),i=this._removeDuplicatedUniforms(i);var n=new _(new f(f.VERTEX_SHADER,v.VertexShader.replace("%name%",t.out.name)),new f(f.FRAGMENT_SHADER,i));return this._programs[r]=n,n},resize:function(t,e){this.setScreenSize(t,e);for(var r in this._texturePool){var i=this._texturePool[r].texture;void 0===this._texturePool[r].width?i.setTextureSize(this._getTextureSize(t,i.divisor),this._getTextureSize(e,i.divisor)):i.setTextureSize(this._texturePool[r].width,this._texturePool[r].height)}this.resizeRatio()},resizeRatio:function(t,e,r,i){void 0!==t&&(this._xViewportRatio=t),void 0!==e&&(this._yViewportRatio=e),void 0!==r&&(this._xTextureRatio=r),void 0!==i&&(this._yTextureRatio=i),this._resizeViewports(),this._resizeTextureUniforms()},_resizeViewports:function(){for(var t=this.getGlobalXRatio(),e=this.getGlobalYRatio(),r=this._cameras,i=0;i<r.length;++i){var n=r[i],a=n.isRenderToTextureCamera(),s=1;if(a){var o=n.getAttachments()[l.COLOR_ATTACHMENT0];s=o.texture.divisor}if(i===r.length-1&&this._finalPassUpScaleToScreen&&(t=this._xViewportRatio,e=this._yViewportRatio),s!==-1){var h=this._getTextureSize(this._screenWidth,s/t),u=this._getTextureSize(this._screenHeight,s/e);n.getViewport().setViewport(0,0,h,u)}}},_resizeTextureUniforms:function(){var t=this.getGlobalXRatio(),e=this.getGlobalYRatio(),r=this._finalPassUpScaleToScreen?this._xViewportRatio:t,i=this._finalPassUpScaleToScreen?this._yViewportRatio:e;this._syncFeedbackUniforms=!0;for(var n=this._textureUniforms,a=0;a<n.length;++a){var s=n[a],o=s.size.getInternalArray(),h=s.ratio.getInternalArray();
if(!s.isFeedback||!o[0]){h[0]=t,h[1]=e;var u=s.texture;u?!u.divisor||u.divisor<0?(o[0]=u.getWidth(),o[1]=u.getHeight(),h[0]=h[1]=1):(o[0]=t*u.getWidth(),o[1]=e*u.getHeight()):(o[0]=this._screenWidth*r,o[1]=this._screenHeight*i)}}},_resizeFeedbackTextureUniforms:function(){for(var t=this._lastXratio,e=this._lastYratio,r=this._textureUniforms,i=0;i<r.length;++i){var n=r[i];if(n.isFeedback){var a=n.size.getInternalArray(),s=n.ratio.getInternalArray(),o=n.texture;s[0]=t,s[1]=e,a[0]=t*o.getWidth(),a[1]=e*o.getHeight()}}},cull:function(){return this._syncOnNextFrame&&(this._resizeFeedbackTextureUniforms(),this._syncOnNextFrame=!1),this._syncFeedbackUniforms&&this._feedbackSwapped&&(this._syncFeedbackUniforms=!1,this._syncOnNextFrame=!0,this._lastXratio=this.getGlobalXRatio(),this._lastYratio=this.getGlobalYRatio()),this._feedbackSwapped=!1,!0},_mergeWithoutDuplicates:function(t,e,r){for(var i=0;i<e.length;i++){for(var n=e[i],a=!0,s=0;s<t.length;s++)if(r(t[s],n)){a=!1;break}a&&t.push(n)}return t},_getTextureSize:function(t,e){return Math.max(1,Math.round(t/e))},setScreenSize:function(t,e){this._screenWidth=t,this._screenHeight=e},setShaderProcessor:function(t){this._shaderProcessor=t},addInternalTexture:function(t){this._internalPasses.push({out:{name:t.name,divisor:t.divisor,type:t.type,filter:t.filter,srgb:t.srgb,rgbm:t.rgbm,immuable:t.immuable,reusable:t.reusable}})},addExternalTexture:function(t,e){this._externalTextures[t]=e},setInputTexture:function(t){this._firstTexture=t},getCameras:function(){return this._cameras},getStateSetPass:function(t){return this._stateSets[t]},getInternalTexture:function(t){return this._userTextures[t]}}),"osgUtil","ComposerPostProcess"),t.exports=v},function(t,e,r){"use strict";var i=r(123),n=function(t,e){var r,i;e?(r=e[0],i=e[1]):(r=t[14]/(t[10]-1),i=t[14]/(1+t[10]));var n=r*(t[8]-1)/t[0],a=r*(1+t[8])/t[0],s=r*(1+t[9])/t[5],o=r*(t[9]-1)/t[5],h=i*(t[8]-1)/t[0],u=i*(1+t[8])/t[0],c=i*(1+t[9])/t[5],l=i*(t[9]-1)/t[5],d=this.getAttributes().Vertex,_=d.getElements();_[0]=n,_[1]=o,_[2]=-r,_[3]=a,_[4]=o,_[5]=-r,_[6]=a,_[7]=s,_[8]=-r,_[9]=n,_[10]=s,_[11]=-r,_[12]=h,_[13]=l,_[14]=-i,_[15]=u,_[16]=l,_[17]=-i,_[18]=u,_[19]=c,_[20]=-i,_[21]=h,_[22]=c,_[23]=-i,d.dirty()},a=function(){var t=i.createBoundingBoxGeometry();return t.updateGeometry=n,t};t.exports={createDebugFrustumGeometry:a}},function(t,e,r){"use strict";var i=r(7),n=r(31),a=r(36),s=r(48),o=r(91),h=r(46),u=r(29),c=r(41),l=r(89),d=r(15).vec3,_=r(193),f=r(194),g=r(81),p=r(82),m=r(140),v=function(){f.apply(this,arguments)},S=f.cloneStateAttributeConfig(f);S.textureAttribute=[],f.setStateAttributeConfig(v,S),i.createPrototypeObject(v,i.objectInherit(f.prototype,{getCompilerName:function(){return"CompilerOffsetNormal"},initTextureAttributes:function(){},createFragmentShaderGraph:function(){var t=this.getNode("glFragColor");return this.getNode("SetAlpha").inputs({color:this.getOrCreateUniform("vec3","uColorDebug"),alpha:this.createVariable("float").setValue("1.0")}).outputs({result:t}),[t]},getOffsetDirection:function(){return this.getOrCreateModelNormal()},getOrCreateModelVertex:function(){var t=this.getVariable("vertexOffset");if(t)return t;t=this.createVariable("vec3","vertexOffset");var e="%out = %offset == 1.0 ? %vertex + normalize(%direction.xyz) * %scale: %vertex;";return this.getNode("InlineCode").code(e).inputs({offset:this.getOrCreateAttribute("float","Offset"),direction:this.getOffsetDirection(),vertex:f.prototype.getOrCreateModelVertex.call(this),scale:this.getOrCreateUniform("float","uScale")}).outputs({out:t}),t},getOrCreateViewVertex:function(){var t=this._variables.FragEyeVector;return t&&!t.isEmpty()?t:(t=this._varyings.FragEyeVector||this.createVariable("vec4","FragEyeVector"),this.getNode("MatrixMultPosition").inputs({matrix:this.getOrCreateUniform("mat4","uViewMatrix"),vec:this.getOrCreateModelVertex()}).outputs({vec:t}),t)}}),"osgUtil","CompilerOffsetNormal");var x=function(){_.apply(this,arguments),this.setShaderCompiler(v)};i.createPrototypeObject(x,i.objectInherit(_.prototype,{}),"osgUtil","ShaderGeneratorCompilerOffsetNormal");var b=function(){v.apply(this,arguments)},y=S;f.setStateAttributeConfig(b,y),i.createPrototypeObject(b,i.objectInherit(v.prototype,{getCompilerName:function(){return"CompilerOffsetTangent"},getOffsetDirection:function(){return this.getOrCreateModelTangent()}}),"osgUtil","CompilerOffsetTangent");var M=function(){_.apply(this,arguments),this.setShaderCompiler(b)};i.createPrototypeObject(M,i.objectInherit(_.prototype,{}),"osgUtil","ShaderGeneratorCompilerOffsetTangent");var T=function(){n.call(this),this._unifScale=c.createFloat(1,"uScale");var t=this._normalStateSet=new u;t.addUniform(c.createFloat3(d.fromValues(1,0,0),"uColorDebug")),t.addUniform(this._unifScale),t.setAttributeAndModes(new l(l.NEVER)),t.setShaderGeneratorName("debugNormal");var e=this._tangentStateSet=new u;e.addUniform(c.createFloat3(d.fromValues(0,1,0),"uColorDebug")),e.addUniform(this._unifScale),e.setAttributeAndModes(new l(l.NEVER)),e.setShaderGeneratorName("debugTangent")};T.CompilerOffsetNormal=v,T.CompilerOffsetTangent=b,T.ShaderGeneratorCompilerOffsetNormal=x,T.ShaderGeneratorCompilerOffsetTangent=M,i.createPrototypeObject(T,i.objectInherit(n.prototype,{setScale:function(t){this._unifScale.setFloat(t)},setTangentVisibility:function(t){this._tangentStateSet.setAttributeAndModes(new l(t?l.LESS:l.NEVER))},setNormalVisibility:function(t){this._normalStateSet.setAttributeAndModes(new l(t?l.LESS:l.NEVER))},apply:function(t){for(var e=t.getUpdateCallbackList(),r=0,i=e.length;r<i;++r)e[r]instanceof m&&(e[r]._isInitialized=!1);if(!t._isVisitedNormalDebug){if(t._isVisitedNormalDebug=!0,t instanceof a==!1)return this.traverse(t);this._createDebugGeom(t,"Normal",this._normalStateSet),this._createDebugGeom(t,"Tangent",this._tangentStateSet)}},_createDoubleOffsetArray:function(t){for(var e=new Float32Array(2*t),r=0;r<t;++r)e[2*r]=1;return new s(s.ARRAY_BUFFER,e,1)},_createDoubledBufferArray:function(t){t.getInitialBufferArray&&(t=t.getInitialBufferArray());for(var e=t.getItemSize(),r=t.getElements(),i=r.length/e,n=r.constructor,a=new n(2*r.length),o=0;o<i;++o)for(var h=o*e,u=2*h,c=0;c<e;++c)a[u+c]=a[u+c+e]=r[h+c];return new s(s.ARRAY_BUFFER,a,e)},_addMorphTargets:function(t,e,r){var i=e.getMorphTargets();e.setName(t.getName());for(var n=t.getMorphTargets(),s=0,o=n.length;s<o;++s){var h=n[s],u=h.getVertexAttributeList(),c=new a;c.setName(h.getName());var l=c.getVertexAttributeList();l.Vertex=this._createDoubledBufferArray(u.Vertex),u[r]&&(l[r]=this._createDoubledBufferArray(u[r])),i.push(c)}return e.mergeChildrenVertexAttributeList(),e},_createDebugGeom:function(t,e,r){var i=t.getAttributes(),n=i[e];if(n){var s=i.Vertex;if(s){var u;t instanceof p?u=t:t.getSourceGeometry&&t.getSourceGeometry()instanceof p&&(u=t.getSourceGeometry());var c=s.getElements().length/s.getItemSize(),l=u?new p:new a;l.getAttributes().Vertex=this._createDoubledBufferArray(s),l.getAttributes().Offset=this._createDoubleOffsetArray(c),l.getAttributes()[e]=this._createDoubledBufferArray(n),l.getPrimitives().push(new o(h.LINES,0,2*c)),u&&this._addMorphTargets(u,l,e);var d;if(t instanceof g){var _=new g;_.setSourceGeometry(l),_.getVertexAttributeList().Bones=this._createDoubledBufferArray(i.Bones),_.getVertexAttributeList().Weights=this._createDoubledBufferArray(i.Weights),_._rigTransformImplementation=t._rigTransformImplementation,_._stateSetAnimation=t._stateSetAnimation,_.mergeChildrenData(),d=_}else d=l;var f=t.getParents(),m=f.length;d._isVisitedNormalDebug=!0,d._isNormalDebug=!0,d.setStateSet(r);for(var v=0;v<m;++v)f[v].addChild(d);return d}}}}),"osgUtil","DisplayNormalVisitor"),t.exports=T},function(t,e,r){"use strict";var i=r(7),n=r(9),a=r(104),s=r(122),o=r(194),h=r(105),u=function(){this._cache={},this._shaderProcessor=new h,this._ShaderCompiler=void 0,this.setShaderCompiler(o)};u.prototype={setShaderCompiler:function(t){this._ShaderCompiler=t,t._validAttributeTypeMemberCache||this._computeStateAttributeCache(t)},getShaderCompiler:function(){return this._ShaderCompiler},getShaderProcessor:function(){return this._shaderProcessor},setShaderProcessor:function(t){this._shaderProcessor=t},filterAttributeTypes:function(t){return!(!t.isEnabled||t.isEnabled())},getActiveAttributeList:function(t,e){for(var r="",i=t._attributeArray,n=this._ShaderCompiler._validAttributeTypeMemberCache,a=0,s=n.length;a<s;a++){var o=n[a],h=i[o];if(h){var u=h._lastApplied;u&&!this.filterAttributeTypes(u)&&(r+=u.getHash(),e.push(u))}}return r},getActiveAttributeListCache:function(t){for(var e="",r=this._ShaderCompiler._validAttributeTypeMemberCache,i=0,n=r.length;i<n;i++){var a=r[i],s=t._attributeArray[a];if(s){var o=s._lastApplied;if(!o||this.filterAttributeTypes(o))continue;e+=s._lastApplied.getHash()}}return e},getActiveTextureAttributeListCache:function(t){for(var e="",r=this._ShaderCompiler._validTextureAttributeTypeMemberCache,i=t._textureAttributeArrayList,n=0;n<i.length;n++){var a=i[n];if(a)for(var s=0;s<r.length;s++){var o=r[s],h=a[o];if(h){var u=h._lastApplied;if(!u||this.filterAttributeTypes(u)||u.isTextureNull())continue;e+=u.getHash()}}}return e},getActiveTextureAttributeList:function(t,e){var r,i,n="",a=t._textureAttributeArrayList,s=this._ShaderCompiler._validTextureAttributeTypeMemberCache;for(r=0,i=a.length;r<i;r++){var o=a[r];if(o){e[r]=[];for(var h=0,u=s.length;h<u;h++){var c=s[h],l=o[c];if(l){var d=l._lastApplied;!d||this.filterAttributeTypes(d)||d.isTextureNull()||(n+=d.getHash(),e[r].push(d))}}}}return n},getActiveUniforms:function(t,e,r){for(var i={},n=0,a=e.length;n<a;n++){var s=e[n];if(s.getOrCreateUniforms){var o=s.getOrCreateUniforms();if(void 0!==o)for(var h in o){var u=o[h];i[u.getName()]=u}}}for(var c=0,l=r.length;c<l;c++){var d=r[c];if(d)for(var _=0,f=d.length;_<f;_++){var g=d[_],p=g.getOrCreateUniforms(c);for(var m in p){var v=p[m];i[v.getName()]=v}}}return i},_computeStateAttributeCache:function(t){var e,r,a,s,o,h=t.stateAttributeConfig.attribute||[],u=[];for(r=0,a=h.length;r<a;r++)e=h[r],o=i.getIdFromTypeMember(e),void 0!==o&&(u.indexOf(o)!==-1?n.warn("Compiler "+t.name+" contains duplicate attribute entry "+e+", check the Compiler configuration"):u.push(o));for(s=new Uint8Array(u),t._validAttributeTypeMemberCache=s,h=t.stateAttributeConfig.textureAttribute||[],u=[],r=0,a=h.length;r<a;r++)e=h[r],o=i.getTextureIdFromTypeMember(e),u.indexOf(o)!==-1?n.warn("Compiler "+t.name+" contains duplicate texture attribute entry "+e+", check the Compiler configuration"):u.push(o);s=new Uint8Array(u),t._validTextureAttributeTypeMemberCache=s},getOrCreateProgram:function(){var t=[],e=[];return function(r){var i=this._ShaderCompiler,o=this.getActiveAttributeListCache(r)+this.getActiveTextureAttributeListCache(r),h=this._cache[o];if(void 0!==h)return h;e.length=0,t.length=0,this.getActiveAttributeList(r,e),this.getActiveTextureAttributeList(r,t);var u=new i(e,t,this._shaderProcessor);n.debug("New Compilation ",!1,!0),n.debug({Attributes:e,Texture:t,Hash:o,Compiler:u.getFragmentShaderName()},!1,!0);var c=u.createFragmentShader(),l=u.createVertexShader(),d=new a(new s(s.VERTEX_SHADER,l),new s(s.FRAGMENT_SHADER,c));return d.hash=o,d.setActiveUniforms(this.getActiveUniforms(r,e,t)),d.generated=!0,this._cache[o]=d,d}}()},t.exports=u},function(t,e,r){"use strict";var i=r(9),n=r(41),a=r(195),s=r(7),o=r(205),h=r(206),u=function(t,e,r){this._attributes=t,this._textureAttributes=e,this._fragmentShaderMode=!1,this._activeNodeList={},this._compiledNodeList={},this._traversedNodeList={},this._variables={},this._varyings={},this._vertexShader=[],this._fragmentShader=[],this._shaderProcessor=r,this._texturesByName={},this._shadowsTextures=[],this._lights=[],this._shadows=[],this._textures=[],this._material=null,this._invariantPosition=!1,this._isBillboard=!1,this._customVertexShader=!1,this._customFragmentShader=!1,this.initAttributes(),this.initTextureAttributes()};u.cloneStateAttributeConfig=function(t){return JSON.parse(JSON.stringify(t.stateAttributeConfig))},u.setStateAttributeConfig=function(t,e){t.stateAttributeConfig=e,e.attribute.forEach(s.getOrCreateStateAttributeTypeMemberIndexFromName),e.textureAttribute.forEach(s.getOrCreateTextureStateAttributeTypeMemberIndexFromName),t.validAttributeTypeMember=e.attribute,t.validTextureAttributeTypeMember=e.textureAttribute},u.setStateAttributeConfig(u,{attribute:["Light0","ShadowReceive0","Light1","ShadowReceive1","Light2","ShadowReceive2","Light3","ShadowReceive3","Light4","Light5","Light6","Light7","Material","PointSize","Billboard","Morph","Skinning"],textureAttribute:["Texture"]}),u.prototype=s.extend({},o,h,{constructor:u,createFragmentShader:function(){return this._fragmentShaderMode=!0,this._createFragmentShader()},createVertexShader:function(){return this._fragmentShaderMode=!1,this._createVertexShader()},getOrCreateProjectionMatrix:function(){return this.getOrCreateUniform("mat4","uProjectionMatrix")},getCompilerName:function(){return this._material?"CompilerOSGJS":"NoMaterialCompilerOSGJS"},getFragmentShaderName:function(){var t=this.getCompilerName(),e=this._material&&this._material.getName();return e&&(e=e.replace(/[^a-zA-Z0-9]+/g,"_").slice(0,20),t+="("+e+")"),t},getVertexShaderName:function(){return this.getFragmentShaderName()},getDebugIdentifier:function(){var t=this.getVertexShaderName(),e=this.getFragmentShaderName();return t===e?e:t+"|"+e},logError:function(t){i.error(this.getDebugIdentifier()+" : "+t)},logWarn:function(t){i.warn(this.getDebugIdentifier()+" : "+t)},getOrCreateConstantOne:function(t){return this.getOrCreateConstant(t,t+"White").setValue(t+"(1.0)")},getOrCreateConstantZero:function(t){return this.getOrCreateConstant(t,t+"Black").setValue(t+"(0.0)")},initAttributes:function(){for(var t=this._attributes,e=this._lights,r=this._shadows,i=0,n=t.length;i<n;i++){var a=t[i].className();"Light"===a?e.push(t[i]):"Material"===a?this._material=t[i]:"ShadowReceiveAttribute"===a?r.push(t[i]):"Billboard"===a?this._isBillboard=!!t[i]:"SkinningAttribute"===a?this._skinningAttribute=t[i]:"MorphAttribute"===a?this._morphAttribute=t[i]:"PointSizeAttribute"===a&&(this._pointSizeAttribute=t[i])}},initTextureAttributes:function(){var t=this._textureAttributes,e=t.length;this._textures.length=this._shadowsTextures.length=e;for(var r=0;r<e;r++){var i=t[r];if(void 0!==i)for(var n=0,a=i.length;n<a;n++)this.registerTextureAttributes(i[n],r)}},registerTextureAttributes:function(t,e){var r=t.className();return"Texture"===r?this.registerTexture(t,e):r.indexOf("ShadowTexture")!==-1?this.registerTextureShadow(t,e):void 0},registerTexture:function(t,e){var r=t.getName();r||(r="Texture"+e,t.setName(r)),this._textures[e]=t,this._texturesByName[r]={texture:t,variable:void 0,textureUnit:e}},registerTextureShadow:function(t,e){var r=t.getName();r||(r="Texture"+e,t.setName(r)),this._shadowsTextures[e]=t,this._texturesByName[r]={texture:t,variable:void 0,textureUnit:e,shadow:!0}},getTextureByName:function(t){var e=this._texturesByName[t];if(!e||e.variable)return e;var r,i=e.texture,n=e.textureUnit,a=i.className(),s="Texture"+n;if("Texture"===a)r=this.getOrCreateSampler("sampler2D",s);else{if("TextureCubeMap"!==a)return;r=this.getOrCreateSampler("samplerCube",s)}var o=this._fragmentShaderMode?this.getOrCreateVarying("vec2","vTexCoord"+n):this.getOrCreateAttribute("vec2","TexCoord"+n);return e.variable=this.createTextureRGBA(i,r,o),e},createShaderFromGraphs:function(t){this._compiledNodeList={};var e=[];for(var r in this._variables){var i=this._variables[r],n=i.declare();n&&e.push(n)}var a=this.evaluateExtensions(t),s=this.evaluateDefines(t),o=[];o.push("\n"),o.push(this.evaluateGlobalVariableDeclaration(t)),this._invariantPosition&&!this._fragmentShaderMode&&o.push("\ninvariant gl_Position;"),o.push("\n"),o.push(this.evaluateGlobalFunctionDeclaration(t)),o.push("void main() {"),0!==e.length&&(o.push("// vars\n"),o.push(e.join(" ")),o.push("\n// end vars\n")),0===t.length&&this.logError("shader without any final Node output (need at least one)"),o.push(this.evaluate(t)),o.push("}");var h=o.join("\n"),u=this._shaderProcessor.processShader(h,s,a,this._fragmentShaderMode?"fragment":"vertex"),c=window.Object.keys(this._compiledNodeList),l=window.Object.keys(this._activeNodeList);return l.filter(function(t){var e=c.indexOf(t)!==-1;if(!e){var r=this._activeNodeList[t],i=r.getName();"Variable"===i&&(i+=" "+r.getVariable()+" ("+r.getType()+")"),this.logWarn("Nodes requested, but not compiled: "+t+" "+i+" "+r.toString())}return e},this),u},getNode:function(){var t=a.getNode.apply(a,arguments);t||i.error("Unknown Node type : "+arguments[0]);var e=t.getID();return this._activeNodeList[e]=t,t},getVariable:function(t){return this._variables[t]},getAttributeType:function(t){for(var e=0;e<this._attributes.length;e++)if(this._attributes[e].getType()===t)return this._attributes[e]},createVariable:function(t,e,r){var i=e;if(void 0===i){var n=window.Object.keys(this._variables).length;i="tmp_"+n}else if(this._variables[i]){if(i+=r,void 0===r)return this.createVariable(t,e,1);if(this._variables[i])return r++,this.createVariable(t,e,r)}var a=this.getNode("Variable",t,i);return this._variables[i]=a,a},getOrCreateUniform:function(t,e,r){var i=e;if(t instanceof n){var a=t;t=a.getType(),i=a.getName()}else void 0===i&&this.logError("Cannot create unamed Uniform");var s=this._variables[i];if(s){if(s.getType()===t)return s;"sampler2D"===s.getType()&&"sampler2D"!==t&&this.logError("Same uniform, but different type ("+t+", "+s.getType()+", "+s.getVariable()+")")}var o=this.getNode("Uniform",t,i,r);return this._variables[i]=o,o},getOrCreateSampler:function(t,e){void 0===e&&this.logError("No name given for sampler type : "+t);var r=this._variables[e];if(r)return r;var i=this.getNode("Sampler",t,e);return this._variables[e]=i,i},getOrCreateAttribute:function(t,e){this._fragmentShaderMode&&this.logError("No Vertex Attribute in Fragment Shader");var r=this._variables[e];if(r)return r.getType()!==t&&this.logError("Same attribute, but different type"),r;var i=this.getNode("Attribute",t,e);return this._variables[e]=i,i},getOrCreateConstant:function(t,e){var r=e;if(void 0===r){var i=window.Object.keys(this._variables).length;r="tmp_"+i}else{var n=this._variables[r];if(n)return n.getType()!==t&&this.logError("Same constant name, but different type"),n}var a=this.getNode("Constant",t,r);return this._variables[r]=a,a},getOrCreateVarying:function(t,e){void 0===e&&this.logError("Error: Mandatory to name varying (as you need to retrieve them)");var r=this._variables[e];return r?(this._varyings[e]||this.logError("Error: requesting a varying not declared with getOrCreateVarying previously"),r.getType()!==t&&this.logError("Error: Same varying, but different type"),r):(this._fragmentShaderMode||this._customFragmentShader||this.logError("Error: requesting a varying not declared in Fragment Shader Graph (for Custom Vertex Shader, add this._customFragmentShader to the processor): "+e+" "+t),r=this._variables[e]=this._varyings[e]=this.getNode("Varying",t,e))},markNodeAsVisited:function(t){var e=t.getID();this._activeNodeList[e]===t?this._compiledNodeList[e]=t:this.logWarn("Node not requested by using Compiler getNode and/or not registered in nodeFactory "+t.toString())},checkOrMarkNodeAsTraversed:function(t){var e=t.getID();return!!this._traversedNodeList[e]||(this._traversedNodeList[e]=t,!1)},traverse:function(t,e){if(!this.checkOrMarkNodeAsTraversed(e)){var r=e.getInputs();if(!Array.isArray(r)){var i=[];for(var n in r)i.push(r[n]);r=i}for(var a=0,s=r.length;a<s;a++){e.checkInputsOutputs();var o=r[a];o&&o!==e&&this.traverse(t,o)}t.call(t,e),this.markNodeAsVisited(e)}},_getAndInitFunctor:function(t){this._traversedNodeList={};var e={},r=[];return t=t.bind(this,e,r),t._map=e,t._text=r,t},_functorEvaluateAndGatherField:function(t,e,r,i){var n=i.getType();void 0!==n&&""!==n||this.logError("Your node "+i+" has no type"),i[t]&&!e[n]&&(e[n]=!0,Array.prototype.push.apply(r,i[t]()))},evaluateAndGatherField:function(t,e){for(var r=this._getAndInitFunctor(this._functorEvaluateAndGatherField.bind(this,e)),i=0,n=t.length;i<n;i++)this.traverse(r,t[i]);return r._text},_functorEvaluateGlobalFunctionDeclaration:function(t,e,r){var i=r.getType();if(void 0!==i&&""!==i||this.logError("Your node "+r+" has no type"),r.globalFunctionDeclaration&&!t[i]){t[i]=!0;var n=r.globalFunctionDeclaration();n&&e.push(n)}},evaluateGlobalFunctionDeclaration:function(t){for(var e=this._getAndInitFunctor(this._functorEvaluateGlobalFunctionDeclaration),r=0,i=t.length;r<i;r++)this.traverse(e,t[r]);return e._text.join("\n")},_functorEvaluateGlobalVariableDeclaration:function(t,e,r){var i=r.getID();if(r.globalDeclaration&&!t[i]){t[i]=!0;var n=r.globalDeclaration();n&&e.push(n)}},evaluateGlobalVariableDeclaration:function(t){var e=this._getAndInitFunctor(this._functorEvaluateGlobalVariableDeclaration),r=0,i=t.length;for(r=0;r<i;r++)this.traverse(e,t[r]);var n=e._text,a=n.length;if(a>0){this.sortDeclarations(n);var s=n[0][0];for(r=0;r<a;++r){var o=n[r][0];o!==s&&(s=o,n[r-1]+="\n")}}return n.join("\n")},sortDeclarations:function(t){if(t.sort(),!this._fragmentShaderMode)for(var e=0,r=t.length;e<r;++e){var i=t[e];if("a"!==i[0])break;if(i.indexOf("Vertex")!==-1){t.splice(e,1),t.unshift(i);break}}},_functorEvaluate:function(t,e,r){var i=r.getID();if(!t[i]){t[i]=!0;var n=r.computeShader();if(n){var a=r.getComment&&r.getComment();a&&e.push(a),e.push(n)}}},evaluate:function(t){for(var e=this._getAndInitFunctor(this._functorEvaluate),r=0,i=t.length;r<i;r++)this.traverse(e,t[r]);return e._text.join("\n")},evaluateDefines:function(t){return this.evaluateAndGatherField(t,"getDefines")},evaluateExtensions:function(t){return this.evaluateAndGatherField(t,"getExtensions")}}),t.exports=u},function(t,e,r){"use strict";var i=r(9),n=r(196),a=r(204),s=r(197),o=r(106),h=r(116),u=function(){this._nodes=new window.Map,this.extractFunctions(o,"lights.glsl"),this.extractFunctions(o,"lightCommon.glsl"),this.extractFunctions(o,"skinning.glsl"),this.extractFunctions(o,"morphing.glsl"),this.extractFunctions(o,"billboard.glsl"),this.extractFunctions(o,"functions.glsl"),this.extractFunctions(o,"textures.glsl"),this.extractFunctions(h,"shadowCast.glsl"),this.extractFunctions(h,"shadowReceive.glsl"),this.registerNodes(n),this.registerNodes(a)};u.prototype={registerNodes:function(t){for(var e in t)this.registerNode(e,t[e])},registerNode:function(t,e){this._nodes.has(t)&&i.warn("Node "+t+" already registered"),this._nodes.set(t,e)},extractFunctions:function(t,e){this.registerNodes(s.extractFunctions(t,e))},getNode:function(t){var e=this._nodes.get(t);if(!e)return void i.warn("Node "+t+" does not exist");var r=window.Object.create(e.prototype);return e.apply(r,Array.prototype.slice.call(arguments,1)),r}};var c=new u;t.exports=c},function(t,e,r){"use strict";var i=r(7),n=r(197),a=r(198),s=n.sprintf,o=function(t,e){a.call(this),this._name="Variable",this._prefix=e,this._type=t,this._value=void 0};i.createPrototypeObject(o,i.objectInherit(a.prototype,{getType:function(){return this._type},getVariable:function(){return this._prefix},setValue:function(t){return this._value=t,this},toString:function(){var t="prefix : "+this._prefix;return t+=", name : "+this._prefix,this.type&&(t+=" ("+this.type+")"),t},declare:function(){return void 0!==this._value?s("%s %s = %s;",[this._type,this.getVariable(),this._value]):s("%s %s;",[this._type,this.getVariable()])},isEmpty:function(){return void 0===this._value&&0===this._inputs.length},reset:function(){this._inputs=[],this._outputs=null,this._value=void 0,this._text=void 0}}),"osgShader","Variable");var h=function(t,e){o.call(this,t,e)};i.createPrototypeObject(h,i.objectInherit(o.prototype,{declare:function(){return s("const %s %s = %s;",[this._type,this.getVariable(),this._value])}}),"osgShader","Constant");var u=function(t,e,r){o.call(this,t,e),this._size=r};i.createPrototypeObject(u,i.objectInherit(o.prototype,{declare:function(){},globalDeclaration:function(){return this._size?s("uniform %s %s[%s];",[this._type,this.getVariable(),this._size]):s("uniform %s %s;",[this._type,this.getVariable()])}}),"osgShader","Uniform");var c=function(t,e){o.call(this,t,e)};i.createPrototypeObject(c,i.objectInherit(o.prototype,{declare:function(){},globalDeclaration:function(){return s("attribute %s %s;",[this._type,this.getVariable()])}}),"osgShader","Attribute");var l=function(t,e){o.call(this,t,e)};i.createPrototypeObject(l,i.objectInherit(o.prototype,{declare:function(){},globalDeclaration:function(){return s("varying %s %s;",[this._type,this.getVariable()])}}),"osgShader","Varying");var d=function(t,e){o.call(this,t,e)};i.createPrototypeObject(d,i.objectInherit(o.prototype,{declare:function(){},globalDeclaration:function(){return s("uniform %s %s;",[this._type,this.getVariable()])}}),"osgShader","Sampler");var _=function(t,e){o.call(this,t,e)};i.createPrototypeObject(_,i.objectInherit(o.prototype,{_unique:!0,isUnique:function(){return this._unique},outputs:function(){return this},getVariable:function(){return this._prefix}}),"osgShader","Output");var f=function(){_.call(this,"vec4","gl_FragColor"),this._name="glFragColor"};i.createPrototypeObject(f,i.objectInherit(_.prototype,{}),"osgShader","glFragColor");var g=function(){_.call(this,"vec4","gl_Position"),this._name="glPosition"};i.createPrototypeObject(g,i.objectInherit(_.prototype,{}),"osgShader","glPosition");var p=function(){_.call(this,"float","gl_PointSize"),this._name="glPointSize"};i.createPrototypeObject(p,i.objectInherit(_.prototype,{}),"osgShader","glPointSize");var m=function(t){a.call(this),this._defineName=t,this._defineValue=""};i.createPrototypeObject(m,i.objectInherit(a.prototype,{type:"Define",setValue:function(t){return this._defineValue=t,this},getDefines:function(){return["#define "+this._defineName+" "+this._defineValue]}}),"osgShader","Define"),t.exports={Output:_,glPointSize:p,glPosition:g,glFragColor:f,Sampler:d,Variable:o,Constant:h,Attribute:c,Varying:l,Uniform:u,Define:m}},function(t,e,r){"use strict";var i=r(7),n=r(9),a=r(198),s=function(t,e){if(!t||!e)return"";var r;for(var i in e)r=e[i],void 0!==r&&(r.getVariable&&(r=r.getVariable()),t=t.replace("%s",r));return t},o=function(t,e){var r=t,i=[],n=e;void 0===e&&(n="");for(var a=0,s=r.length;a<s;a++){var o,h=r[a];o=void 0===h?"undefined":"string"==typeof h?h:h.getType?h.getType()+" "+h.getVariable():h.getVariable(),i.push(n+o)}return i},h=function(t,e,i){var n=r(199),a=[],s="";if(n.debugShaderNode&&(a.push("\n// output"),Array.prototype.push.apply(a,o([e],"// "))),e&&(s=(e.getVariable?e.getVariable():e)+" = "),s=s+t+"( ",i&&i.length>0){n.debugShaderNode&&(a.push("// inputs"),Array.prototype.push.apply(a,o(i,"// ")));for(var h=0,u=i.length;h<u;h++)s+=i[h].getVariable?i[h].getVariable():i[h],h!==u-1&&(s+=", ")}return s+=" );\n",n.debugShaderNode?a.join("\n")+"\n"+s:s},u=function(t){var e=t.match(/([^\s]+):([^\s]+)/g),r={};if(!e)return r;for(var i=0;i<e.length;++i){var n=e[i].split(":");r[n[0]]=n[1]}return r},c=function(t,e){var r=e.indexOf("("),i=e.indexOf(")"),n=e.substring(0,r);n=n.replace(/[\r\n|\r|\n]/g,"").trim().replace(/\s+/g," ");var a=n.split(/\s/),s=a[0],o=a[1],h=u(t),c=h.result||"result",l=h.NODE_NAME;l||(l=o[0].toUpperCase()+o.substring(1));var d=[];h.DERIVATIVES&&d.push("#extension GL_OES_standard_derivatives : "+h.DERIVATIVES);var _,f=[],g="#define"===s;"void"!==s&&(_={name:c,type:!g&&s},f.push(_));var p=e.substring(r+1,i);p=p.replace(/[\r\n|\r|\n]/g,"");for(var m=p.split(/OPT_ARG_|,/),v=p.indexOf("OPT_ARG_")!==-1,S=[],x=[],b=0;b<m.length;++b){var y=m[b];if(y){var M=y.trim().replace(/\s+/g," ").split("[")[0],T=M.split(/\s/),A=T.length,C=A>=3&&T[A-3].indexOf("out")!==-1,I=T[A-1],w={isOutput:C,type:T[A-2],name:h[I]||I,optional:v&&p.indexOf("OPT_ARG_"+I)!==-1};x.push(w),w.optional||(C?f.push(w):S.push(w))}}return{nodeName:l,functionName:o,signature:{returnVariable:_,orderedArgs:x,outputs:f,inputs:S,extensions:d}}},l=function(t,e){var r=function(){a.call(this),this._defines=[],this._extensions=[],this._missingArgs=!1},s='#pragma include "'+e+'"';return i.createPrototypeObject(r,i.objectInherit(a.prototype,{type:t.nodeName,signatures:[t.signature],checkInputsOutputs:function(){},globalFunctionDeclaration:function(){return s},addExtensions:function(t){return this._extensions.push.apply(this._extensions,t),this},getExtensions:function(){return this.getOrCreateSignature(),this._extensions},addDefines:function(t){return this._defines.push.apply(this._defines,t),this},getDefines:function(){return this._defines},_validateSameVariables:function(t,e){for(var r=t.length,i=0;i<r;++i)if(!e[t[i].name])return!1;return t.length===Object.keys(e).length},_validateSameType:function(t,e){for(var r=t.length,i=0;i<r;++i){var n=e[t[i].name];if(n.getType()!==t[i].type)return!1}return!0},_getSignatureBestMatch:function(){if(1===this.signatures.length)return this.signatures[0];for(var t=[],e=[],r=[],i=this.signatures.length,n=0;n<i;++n){var a=this.signatures[n];this._validateSameVariables(a.outputs,this._outputs)&&this._validateSameVariables(a.inputs,this._inputs)&&(t.push(a),this._validateSameType(a.outputs,this._outputs)&&(e.push(a),this._validateSameType(a.inputs,this._inputs)&&r.push(a)))}return t.length?1!==t.length&&e.length?1!==e.length&&r.length?r[0]:e[0]:t[0]:this.signatures[0]},getOrCreateSignature:function(){return this._signature||(this._signature=this._getSignatureBestMatch(),this.addExtensions(this._signature.extensions)),this._signature},_typeDownCast:function(e){var r;if(e.optional){if(r=this._inputs[e.name]||this._outputs[e.name],!r)return}else r=e.isOutput?this._outputs[e.name]:this._inputs[e.name];if(!r){var i=e.isOutput?"output":"input";return n.error("missing "+i+" "+e.name+" on NodeCustom "+t.nodeName),void(this._missingArgs=!0)}var a=r.getType(),s=e.type;return s&&s!==a?"vec3"===s?r.getVariable()+".rgb":"vec2"===s?r.getVariable()+".rg":"float"===s?r.getVariable()+".r":r:r},computeShader:function(){var e=this.getOrCreateSignature(),r=e.returnVariable&&e.returnVariable.name,i=r?this._outputs[r]:void 0;r&&!i&&(n.error("missing output "+r+" on NodeCustom "+t.nodeName),this._missingArgs=!0);for(var a=[],s=0;s<e.orderedArgs.length;++s){var o=this._typeDownCast(e.orderedArgs[s]);o&&a.push(o)}return this._missingArgs?"":h(t.functionName,i,a)}}),"osgShader",t.nodeName),r},d=function(t,e){for(var r={},i=t[e].split(/#pragma DECLARE_FUNCTION(.*)[\r\n|\r|\n]/),n=(i.length-1)/2,a=0;a<n;++a){var s=c(i[2*a+1],i[2*a+2]),o=r[s.nodeName];o?o.prototype.signatures.push(s.signature):r[s.nodeName]=l(s,e)}return r};t.exports={callFunction:h,checkVariableType:o,sprintf:s,extractFunctions:d}},function(t,e,r){"use strict";var i=r(9),n=0,a=function(){this._name="AbstractNode",this._inputs=[],this._outputs=null,this._id=n++,this._text=void 0};a.prototype={getID:function(){return this._id},getName:function(){return this._name},getType:function(){return this.type},toString:function(){var t="name : "+this._name;return this.type&&(t+=" ("+this.type+")"),t},getInputs:function(){return this._inputs},getOutputs:function(){return this._outputs},checkInputsOutputs:function(){var t,e;if(this.validInputs)for(t=0;t<this.validInputs.length;t++)if(e=this.validInputs[t],!this._inputs[e])return i.error("Shader node "+this.type+" validation error input "+e+" is missing"),!1;if(this.validOutputs)for(t=0;t<this.validOutputs.length;t++)if(e=this.validOutputs[t],!this._outputs[e])return i.error("Shader node "+this.type+" validation error output "+e+" is missing"),!1;return!0},inputs:function(){for(var t=0,e=arguments.length;t<e;t++){var r=arguments[t];if(!r){i.error("Shader node "+this.type+" input number "+e+" is undefined ");break}if(Array.isArray(r))return this.inputs.apply(this,r),this;if("object"==typeof r&&null!==r&&r instanceof a==!1)return this._inputs=r,this;this._inputs.push(r)}return this},outputs:function(t){if(this._outputs=t,this._outputs instanceof a==!0)this.autoLink(this._outputs);else for(var e in this._outputs)this.autoLink(this._outputs[e]);
return this},autoLink:function(t){return void 0===t?this:(t.inputs(this),this)},computeShader:function(){return this._text},comment:function(t){this._comment="//"+t},getComment:function(){return this._comment}},t.exports=a},function(t,e,r){"use strict";var i=r(194),n=r(193),a=r(200),s=r(105),o=r(195),h=r(198),u=r(197),c={};c.Compiler=i,c.ShaderGenerator=n,c.ShaderGeneratorProxy=a,c.ShaderProcessor=s,c.nodeFactory=o,c.utils=u,c.node={},c.node.Node=h,o._nodes.forEach(function(t,e){c.node[e]=t}),c.debugShaderNode=!1,c.debugShaderNode=!0,t.exports=c},function(t,e,r){"use strict";var i=r(9),n=r(193),a=r(201),s=r(192),o=r(203),h=function(){return this._generators={},this.addShaderGenerator("default",new n),this.addShaderGenerator("ShadowCast",new a),this.addShaderGenerator("debugNormal",new s.ShaderGeneratorCompilerOffsetNormal),this.addShaderGenerator("debugTangent",new s.ShaderGeneratorCompilerOffsetTangent),this.addShaderGenerator("debugGeometry",new o.ShaderGeneratorCompilerColorGeometry),this.addShaderGenerator("debugSkinning",new o.ShaderGeneratorCompilerColorSkinning),this};h.prototype={getShaderGenerator:function(t){if(!t)return this._generators.default;var e=this._generators[t];return e?e:(i.error("ShaderGenerator "+t+" does not exist in ShaderGeneratorProxy"),this._generators.default)},addShaderGenerator:function(t,e){this._generators[t]=e}},t.exports=h},function(t,e,r){"use strict";var i=r(193),n=r(202),a=function(){i.apply(this,arguments),this.setShaderCompiler(n)};a.prototype=i.prototype,t.exports=a},function(t,e,r){"use strict";var i=r(7),n=r(194),a=function(){n.apply(this,arguments)},s=n.cloneStateAttributeConfig(n);s.attribute=["ShadowCast","Morph","Skinning","PointSize"],n.setStateAttributeConfig(a,s),i.createPrototypeObject(a,i.objectInherit(n.prototype,{getCompilerName:function(){return"ShadowCast"},initAttributes:function(){for(var t=this._attributes,e=0,r=t.length;e<r;e++){var i=t[e].className();"ShadowCastAttribute"===i?this._shadowCastAttribute=t[e]:"Billboard"===i?this._isBillboard=!!t[e]:"SkinningAttribute"===i?this._skinningAttribute=t[e]:"MorphAttribute"===i?this._morphAttribute=t[e]:"PointSizeAttribute"===i&&(this._pointSizeAttribute=t[e])}},registerTextureAttributes:function(){},createShadowCastDepth:function(t){var e=this._shadowCastAttribute.getDefines();return this.getNode("ShadowCast").inputs({shadowDepthRange:this.getOrCreateUniform("vec4","uShadowDepthRange"),fragEye:this.getOrCreateVarying("vec4","vViewVertex")}).outputs({result:t}).getDefines=function(){return e},t},createFragmentShaderGraph:function(){var t=this.getNode("glFragColor");return[this.createShadowCastDepth(t)]}}),"osgShader","CompilerShadowCast"),t.exports=a},function(t,e,r){"use strict";var i=r(7),n=r(31),a=r(36),s=r(81),o=r(41),h=r(29),u=r(15).vec3,c=r(193),l=r(194),d=r(48),_=r(91),f=r(46),g=r(64),p=r(89),m=function(){l.apply(this,arguments)},v=l.cloneStateAttributeConfig(l);v.textureAttribute=[],v.attribute=[],l.setStateAttributeConfig(m,v),i.createPrototypeObject(m,i.objectInherit(l.prototype,{getCompilerName:function(){return"CompilerDebugGeometry"},initTextureAttributes:function(){},createFragmentShaderGraph:function(){var t=this.getNode("glFragColor");return this.getNode("SetAlpha").inputs({color:this.getOrCreateUniform("vec3","uColorDebug"),alpha:this.createVariable("float").setValue("1.0")}).outputs({result:t}),[t]}}),"osgUtil","CompilerColorGeometry");var S=function(){c.apply(this,arguments),this.setShaderCompiler(m)};i.createPrototypeObject(S,i.objectInherit(c.prototype,{}),"osgUtil","ShaderGeneratorCompilerColorGeometry");var x=function(){l.apply(this,arguments)},b=l.cloneStateAttributeConfig(l);b.textureAttribute=[],l.setStateAttributeConfig(x,b),i.createPrototypeObject(x,i.objectInherit(l.prototype,{getCompilerName:function(){return"CompilerDebugSkinning"},initTextureAttributes:function(){},createFragmentShaderGraph:function(){var t=this.getNode("glFragColor");return this.getNode("SetAlpha").inputs({color:this.getOrCreateVarying("vec3","vBonesColor"),alpha:this.createVariable("float").setValue("1.0")}).outputs({result:t}),[t]},declareVertexVaryings:function(t){var e=this.getOrCreateVarying("vec3","vBonesColor");return this.getNode("SetFromNode").inputs(this.getOrCreateAttribute("vec3","BonesColor")).outputs(e),l.prototype.declareVertexVaryings.call(this,t)}}),"osgUtil","CompilerColorSkinning");var y=function(){c.apply(this,arguments),this.setShaderCompiler(x)};i.createPrototypeObject(y,i.objectInherit(c.prototype,{}),"osgUtil","ShaderGeneratorCompilerColorSkinning");var M=function(){n.call(this),this._debugColor=!0,this._debugSkinning=!1,this._stCenter=new h,this._stCenter.setShaderGeneratorName("debugGeometry")};M.CompilerColorGeometry=m,M.ShaderGeneratorCompilerColorGeometry=S,M.CompilerSkinningGeometry=x,M.ShaderGeneratorCompilerColorSkinning=y,i.createPrototypeObject(M,i.objectInherit(n.prototype,{setGeometryDebug:function(t){this._stCenter.setAttributeAndModes(new p(p.ALWAYS)),this._debugColor=!0,this._debugSkinning=!1,this.apply(t)},setSkinningDebug:function(t){this._stCenter.setAttributeAndModes(new p(p.NEVER)),this._debugColor=!1,this._debugSkinning=!0,this.apply(t)},disableDebug:function(t){this._stCenter.setAttributeAndModes(new p(p.NEVER)),this._debugColor=!1,this._debugSkinning=!1,this.apply(t)},apply:function(t){if(!t._isNormalDebug&&!t._isCenterDebug){if(t instanceof a)if(this._debugColor||this._debugSkinning&&t instanceof s){void 0===t._originalStateSet&&(t._originalStateSet=t.getStateSet()||null);var e=new h;if(t.setStateSet(e),this._debugSkinning){e.setShaderGeneratorName("debugSkinning");var r=t.getVertexAttributeList();if(!r.BonesColor){for(var i=r.Bones.getElements(),n=r.Weights.getElements(),c=t._rigTransformImplementation._bones,l=i.length/4,p=new Float32Array(3*l),m=0;m<l;++m){var v=4*m,S=c[i[v]].getOrCreateDebugColor(),x=c[i[v+1]].getOrCreateDebugColor(),b=c[i[v+2]].getOrCreateDebugColor(),y=c[i[v+3]].getOrCreateDebugColor(),M=n[v],T=n[v+1],A=n[v+2],C=n[v+3],I=3*m;p[I]=M*S[0]+T*x[0]+A*b[0]+C*y[0],p[I+1]=M*S[1]+T*x[1]+A*b[1]+C*y[1],p[I+2]=M*S[2]+T*x[2]+A*b[2]+C*y[2]}r.BonesColor=new d(d.ARRAY_BUFFER,p,3)}}else{var w=u.fromValues(Math.random(),Math.random(),Math.random());e.addUniform(o.createFloat3(w,"uColorDebug")),e.setShaderGeneratorName("debugGeometry");var E=t.getBound(),N=new Float32Array(18),R=.1*E.radius();N[0]=R,N[3]=-R,N[7]=R,N[10]=-R,N[14]=R,N[17]=-R;var F=new a;F.getAttributes().Vertex=new d(d.ARRAY_BUFFER,N,3);var P=new _(f.LINES,0,6);F.getPrimitives().push(P);var L=new g,O=E.center();L.getMatrix()[12]=O[0],L.getMatrix()[13]=O[1],L.getMatrix()[14]=O[2],L.addChild(F),this.nodePath[this.nodePath.length-2].addChild(L),w=u.fromValues(.8*w[0],.8*w[1],.8*w[2]),F.getOrCreateStateSet().addUniform(o.createFloat3(w,"uColorDebug")),L.setStateSet(this._stCenter),L._isCenterDebug=!0}}else void 0!==t._originalStateSet&&t.setStateSet(t._originalStateSet||void 0);this.traverse(t)}}}),"osgUtil","GeometryColorDebugVisitor"),t.exports=M},function(t,e,r){"use strict";var i=r(9),n=r(7),a=r(198),s=function(){a.call(this)};s.prototype=a.prototype;var o=function(){s.call(this)};n.createPrototypeObject(o,n.objectInherit(s.prototype,{type:"Add",operator:"+",_getFirstVariableCast:function(){var t=this._inputs[0].getVariable(),e=this._inputs[0].getType(),r=this._outputs.getType();return r===e?t:"float"===e?r+"("+t+")":"vec3"===r?t+".rgb":"vec2"===r?t+".rg":"float"===r?t+".r":(i.error("Mismatch type : "+r+" with "+e+", "+t),t)},computeShader:function(){var t=this._outputs.getType(),e="";"vec4"===t?e=".rgba":"vec3"===t?e=".rgb":"vec2"===t&&(e=".rg");for(var r=this._getFirstVariableCast(),i=this._outputs.getVariable()+" = "+r,n=1,a=this._inputs.length;n<a;n++){var s=this._inputs[n];i+=this.operator+s.getVariable();var o=s.getType();"float"!==o&&o!==t&&(i+=e)}return i+=";"}}),"osgShader","Add");var h=function(){o.call(this)};n.createPrototypeObject(h,n.objectInherit(o.prototype,{type:"Mult",operator:"*"}),"osgShader","Mult");var u=function(){o.call(this)};n.createPrototypeObject(u,n.objectInherit(o.prototype,{type:"SetFromNode"}),"osgShader","SetFromNode");var c=function(){o.call(this),this._overwriteW=!0,this._forceComplement=!0,this._inverseOp=!1};n.createPrototypeObject(c,n.objectInherit(o.prototype,{type:"MatrixMultDirection",operator:"*",validInputs:["vec","matrix"],validOutputs:["vec"],complement:"0.",setInverse:function(t){return this._inverseOp=t,this},setForceComplement:function(t){return this._forceComplement=t,this},setOverwriteW:function(t){return this._overwriteW=t,this},computeShader:function(){var t=this._inputs.vec.getVariable(),e=this._inputs.matrix.getVariable(),r=this._outputs.vec.getVariable(),i=this._inputs.vec.getType(),n=this._outputs.vec.getType(),a=this._inputs.matrix.getType(),s=r;if("mat4"===a){s+=" = ","vec4"!==n&&(s+=n+"(");var o=t;(this._forceComplement||"vec4"!==i)&&(o="vec4("+t+".xyz, "+this.complement+")"),s+=this._inverseOp?o+this.operator+e:e+this.operator+o,"vec4"!==n&&(s+=")"),s+=";",this._overwriteW||"vec4"!==i||(s+="\n"+r+".a = "+t+".a;")}else{"vec4"===n&&(s+=".xyz"),s+=" = ";var h=t+".xyz";s+=(this._inverseOp?h+this.operator+e:e+this.operator+h)+";",this._overwriteW||"vec4"!==n||"vec4"!==i||(s+="\n"+r+".a = "+t+".a;")}return s}}),"osgShader","MatrixMultDirection");var l=function(){c.call(this),this._forceComplement=!1};n.createPrototypeObject(l,n.objectInherit(c.prototype,{type:"MatrixMultPosition",complement:"1."}),"osgShader","MatrixMultPosition");var d=function(){s.apply(this),this._mode="MIX"};n.createPrototypeObject(d,n.objectInherit(s.prototype,{type:"Blend",mode:function(t){return this._mode=t,this},computeShader:function(){return this[void 0===this._mode?"MIX":this._mode]()},ADD:function(){return this._outputs.getVariable()+" = "+this._inputs[0].getVariable()+" + ("+this._inputs[1].getVariable()+" * "+this._inputs[2].getVariable()+");"},MIX:function(){return this._outputs.getVariable()+" = mix("+this._inputs[0].getVariable()+", "+this._inputs[1].getVariable()+", "+this._inputs[2].getVariable()+");"},MULTIPLY:function(){return this._outputs.getVariable()+" = "+this._inputs[0].getVariable()+" * mix( "+this._inputs[0].getType()+"(1.0), "+this._inputs[1].getVariable()+", "+this._inputs[2].getVariable()+");"}}));var _=function(){a.call(this)};n.createPrototypeObject(_,n.objectInherit(a.prototype,{type:"InlineCode",code:function(t){return this._text=t,this},computeShader:function(){var t=n.objectMix({},this._inputs);t=n.objectMix(t,this._outputs);for(var e=new RegExp("%[A-Za-z0-9_]+","gm"),r=this._text,a=this._text.match(e),s=new Set,o=0;o<a.length;o++){var h=a[o].substr(1);if(!s.has(h)){t[h]||(i.error("error with inline code\n"+this._text),i.error("input "+h+" not provided for "+a[o]));var u=new RegExp(a[o].toString(),"gm");r=r.replace(u,t[h].getVariable()),s.add(h)}}return r}}),"osgShader","InlineCode"),t.exports={BaseOperator:s,Mult:h,MatrixMultPosition:l,MatrixMultDirection:c,Add:o,Blend:d,InlineCode:_,SetFromNode:u}},function(t,e,r){"use strict";var i=r(9),n={_createVertexShader:function(){var t=this.declareVertexMain(),e=this.getVertexShaderName();e&&t.push(this.getNode("Define","SHADER_NAME").setValue(e));var r=this.createShaderFromGraphs(t);return i.debug(this.getDebugIdentifier()),i.debug(r),r},declareVertexMain:function(){var t=[this.declarePointSize(),this.declareVertexPosition()];return this.declareVertexVaryings(t),t},declarePointSize:function(){var t=this.getNode("glPointSize");return this._pointSizeAttribute&&this._pointSizeAttribute.isEnabled()?(this.getNode("InlineCode").code("%pointSize = min(64.0, max(1.0, -%size / %position.z));").inputs({position:this.getOrCreateViewVertex(),size:this.getOrCreateUniform("float","uPointSize")}).outputs({pointSize:t}),t):(this.getNode("SetFromNode").inputs(this.getOrCreateConstantOne("float")).outputs(t),t)},declareVertexVaryings:function(t){var e=this._varyings;e.vModelVertex&&this.getNode("SetFromNode").inputs(this.getOrCreateModelVertex()).outputs(e.vModelVertex),e.vModelNormal&&this.getNode("SetFromNode").inputs(this.getOrCreateModelNormal()).outputs(e.vModelNormal),e.vModelTangent&&this.getNode("SetFromNode").inputs(this.getOrCreateModelTangent()).outputs(e.vModelTangent),e.vViewVertex&&this.getNode("SetFromNode").inputs(this.getOrCreateViewVertex()).outputs(e.vViewVertex),e.vViewNormal&&this.getNode("SetFromNode").inputs(this.getOrCreateViewNormal()).outputs(e.vViewNormal),e.vViewTangent&&this.getNode("SetFromNode").inputs(this.getOrCreateViewTangent()).outputs(e.vViewTangent),e.vVertexColor&&this.getNode("InlineCode").code("%vcolor = %venabled == 1.0 ? %acolor : vec4(1.0, 1.0, 1.0, 1.0);").inputs({venabled:this.getOrCreateUniform("float","uArrayColorEnabled"),acolor:this.getOrCreateAttribute("vec4","Color")}).outputs({vcolor:this.getOrCreateVarying("vec4","vVertexColor")});for(var r in e){var i=e[r];t.push(i);var n=i.getVariable();n.indexOf("vTexCoord")!==-1&&this.getNode("SetFromNode").inputs(this.getOrCreateAttribute("vec2",n.substring(1))).outputs(i)}},declareVertexPosition:function(){var t=this.getNode("glPosition");return this._isBillboard?this.declareVertexTransformBillboard(t):this.declareScreenVertex(t),t},getOrCreateModelVertex:function(){var t=this._variables.modelVertex;return t?t:(t=this.createVariable("vec3","modelVertex"),this.getNode("MatrixMultPosition").inputs({matrix:this.getOrCreateUniform("mat4","uModelMatrix"),vec:this.getOrCreateLocalVertex()}).outputs({vec:t}),t)},getOrCreateModelNormal:function(){var t=this._variables.modelNormal;return t?t:(t=this.createVariable("vec3","modelNormal"),this.getNode("MatrixMultDirection").inputs({matrix:this.getOrCreateUniform("mat3","uModelNormalMatrix"),vec:this.getOrCreateLocalNormal()}).outputs({vec:t}),t)},getOrCreateModelTangent:function(){var t=this._variables.modelTangent;return t?t:(t=this.createVariable("vec4","modelTangent"),this.getNode("MatrixMultDirection").setOverwriteW(!1).inputs({matrix:this.getOrCreateUniform("mat3","uModelNormalMatrix"),vec:this.getOrCreateLocalTangent()}).outputs({vec:t}),t)},getOrCreateViewVertex:function(){var t=this._variables.viewVertex;return t?t:(t=this.createVariable("vec4","viewVertex"),this.getNode("MatrixMultPosition").inputs({matrix:this.getOrCreateUniform("mat4","uModelViewMatrix"),vec:this.getOrCreateLocalVertex()}).outputs({vec:t}),t)},getOrCreateViewNormal:function(){var t=this._variables.viewNormal;return t?t:(t=this.createVariable("vec3","viewNormal"),this.getNode("MatrixMultDirection").inputs({matrix:this.getOrCreateUniform("mat3","uModelViewNormalMatrix"),vec:this.getOrCreateLocalNormal()}).outputs({vec:t}),t)},getOrCreateViewTangent:function(){var t=this._variables.viewTangent;return t?t:(t=this.createVariable("vec4","viewTangent"),this.getNode("MatrixMultDirection").setOverwriteW(!1).inputs({matrix:this.getOrCreateUniform("mat3","uModelViewNormalMatrix"),vec:this.getOrCreateLocalTangent()}).outputs({vec:t}),t)},declareScreenVertex:function(t){this.getNode("MatrixMultPosition").inputs({matrix:this.getOrCreateProjectionMatrix(),vec:this.getOrCreateViewVertex()}).outputs({vec:t})},declareVertexTransformBillboard:function(t){this.getNode("Billboard").inputs({Vertex:this.getOrCreateAttribute("vec3","Vertex"),ModelViewMatrix:this.getOrCreateUniform("mat4","uModelViewMatrix"),ProjectionMatrix:this.getOrCreateUniform("mat4","uProjectionMatrix")}).outputs({result:t})},getOrCreateBoneMatrix:function(){var t=this._variables.boneMatrix;if(t)return t;t=this.createVariable("mat4","boneMatrix");var e=this.getOrCreateAttribute("vec4","Weights"),r=this.getOrCreateAttribute("vec4","Bones"),i=this.getOrCreateUniform("vec4","uBones",this._skinningAttribute.getBoneUniformSize());return this.getNode("Skinning").inputs({weights:e,bonesIndex:r,matrixPalette:i}).outputs({result:t}),t},getTarget:function(t,e){var r=t.indexOf("Tangent")!==-1?"vec4":"vec3";return this.getOrCreateAttribute(r,t+"_"+e)},morphTangentApproximation:function(t,e){var r=this.getOrCreateLocalNormal();return this._skinningAttribute&&(r=this.createVariable("vec3"),this.getNode("Normalize").inputs({vec:this.getOrCreateMorphNormal()}).outputs({result:r})),this.getNode("InlineCode").code("%out = %tangent.rgb - dot(%tangent.rgb, %normal) * %normal;").inputs({tangent:t,normal:r}).outputs({out:e}),e},morphTransformVec3:function(t,e){for(var r={vertex:t,weights:this.getOrCreateUniform("vec4","uTargetWeights")},i=this._morphAttribute.getNumTargets(),n=0;n<i;n++)r["target"+n]=this.getTarget(t.getVariable(),n);return this.getNode("Morphing").inputs(r).outputs({result:e}),e},skinTransformVertex:function(t,e){return this.getNode("MatrixMultPosition").setInverse(!0).inputs({matrix:this.getOrCreateBoneMatrix(),vec:t}).outputs({vec:e}),e},skinTransformNormal:function(t,e){return this.getNode("MatrixMultDirection").setInverse(!0).inputs({matrix:this.getOrCreateBoneMatrix(),vec:t}).outputs({vec:e}),e},getOrCreateMorphVertex:function(){var t=this.getVariable("morphVertex");if(t)return t;var e=this.getOrCreateAttribute("vec3","Vertex");return this._morphAttribute&&this._morphAttribute.hasTarget("Vertex")?this.morphTransformVec3(e,this.createVariable("vec3","morphVertex")):e},getOrCreateMorphNormal:function(){var t=this.getVariable("morphNormal");if(t)return t;var e=this.getOrCreateAttribute("vec3","Normal");return this._morphAttribute&&this._morphAttribute.hasTarget("Normal")?this.morphTransformVec3(e,this.createVariable("vec3","morphNormal")):e},getOrCreateMorphTangent:function(){var t=this.getVariable("morphTangent");if(t)return t;var e=this.getOrCreateAttribute("vec4","Tangent"),r=this._morphAttribute&&this._morphAttribute.hasTarget("Tangent");return r?this.morphTransformVec3(e,this.createVariable("vec3","morphTangent")):e},getOrCreateSkinVertex:function(){var t=this.getVariable("skinVertex");if(t)return t;var e=this.getOrCreateMorphVertex();return this._skinningAttribute?this.skinTransformVertex(e,this.createVariable("vec3","skinVertex")):e},getOrCreateSkinNormal:function(){var t=this.getVariable("skinNormal");if(t)return t;var e=this.getOrCreateMorphNormal();return this._skinningAttribute?this.skinTransformNormal(e,this.createVariable("vec3","skinNormal")):e},getOrCreateSkinTangent:function(){var t=this.getVariable("skinTangent");if(t)return t;var e=this.getOrCreateMorphTangent();return this._skinningAttribute?this.skinTransformNormal(e,this.createVariable("vec3","skinTangent")):e},getOrCreateLocalVertex:function(){return this.getOrCreateSkinVertex()},getOrCreateLocalNormal:function(){var t=this.getVariable("localNormal");if(t)return t;var e=this.getOrCreateSkinNormal();return e===this.getOrCreateAttribute("vec3","Normal")?e:(t=this.createVariable("vec3","localNormal"),this.getNode("Normalize").inputs({vec:e}).outputs({result:t}),t)},getOrCreateLocalTangent:function(){var t=this.getVariable("localTangent");if(t)return t;var e=this.getOrCreateAttribute("vec4","Tangent"),r=this.getOrCreateSkinTangent();return r===e?r:this.normalizeAndSetAlpha(r,e,this.createVariable("vec4","localTangent"))},normalizeAndSetAlpha:function(t,e,r){var i=this.createVariable("vec3");return this.getNode("Normalize").inputs({vec:t}).outputs({result:i}),this.getNode("SetAlpha").inputs({color:i,alpha:e}).outputs({result:r}),r}},a=function(t,e){return function(){return this._fragmentShaderMode&&this.logError("This function should not be called from fragment shader : "+e),t.apply(this,arguments)}};for(var s in n)n[s]=a(n[s],s);t.exports=n},function(t,e,r){"use strict";var i=r(99),n=r(9),a={_createFragmentShader:function(){var t=this.createFragmentShaderGraph(),e=this.getFragmentShaderName();e&&t.push(this.getNode("Define","SHADER_NAME").setValue(e));var r=this.createShaderFromGraphs(t);return n.debug(this.getDebugIdentifier()),n.debug(r),this.cleanAfterFragment(),r},applyPointSizeCircle:function(t){return this._pointSizeAttribute&&this._pointSizeAttribute.isEnabled()&&this._pointSizeAttribute.isCircleShape()?(this.getNode("InlineCode").code("if (length(2.0 * gl_PointCoord - 1.0) > %radius) discard;").inputs({radius:this.getOrCreateConstantOne("float")}).outputs({output:t}),t):t},cleanAfterFragment:function(){this._variables={},this._activeNodeList={};for(var t in this._texturesByName)this._texturesByName[t].variable=void 0;for(var e in this._varyings){var r=this._varyings[e];r.reset(),this._activeNodeList[r.getID()]=r,this._variables[e]=r}},createDefaultFragmentShaderGraph:function(){var t=this.getOrCreateConstant("vec4","fofd").setValue("vec4(1.0, 0.0, 1.0, 0.7)"),e=this.getNode("glFragColor");return this.getNode("SetFromNode").inputs(t).outputs(e),e},createFragmentShaderGraph:function(){var t=[];if(!this._material)return t.push(this.createDefaultFragmentShaderGraph()),t;var e=this._lights.length>0?this.getLighting():this.getOrCreateMaterialDiffuseColor(),r=this.getOrCreateMaterialEmission();if(r){var i=this.createVariable("vec3");this.getNode("Add").inputs(e,r).outputs(i),e=i}var n=this.getDiffuseColorFromTextures();if(n){var a=this.createVariable("vec3");this.getNode("Mult").inputs(e,n).outputs(a),e=a}var s=this.getAlpha();e=this.getPremultAlpha(e,s);var o=this.getNode("glFragColor");return this.applyPointSizeCircle(o),this.getNode("SetAlpha").inputs({color:e,alpha:s}).outputs({result:o}),t.push(o),t},getAlpha:function(){var t=this.createVariable("float"),e=this.getFirstValidTexture(),r={color:this.getOrCreateMaterialDiffuseColor()};e&&(r.texelAlpha=e);var i=e?"%alpha = %color.a * %texelAlpha.a;":"%alpha = %color.a;";return this._isBillboard&&(i+="if ( %alpha == 0.0) discard;"),this.getNode("InlineCode").code(i).inputs(r).outputs({alpha:t}),t},getOrCreateFrontViewTangent:function(){var t=this._variables.frontViewTangent;return t?t:(t=this.createVariable("vec4","frontViewTangent"),this.getNode("FrontNormal").inputs({normal:this.getOrCreateVarying("vec4","vViewTangent")}).outputs({result:t}),t)},getOrCreateFrontViewNormal:function(){var t=this._variables.frontViewNormal;return t?t:(t=this.createVariable("vec3","frontViewNormal"),this.getNode("FrontNormal").inputs({normal:this.getOrCreateVarying("vec3","vViewNormal")}).outputs({result:t}),t)},getOrCreateNormalizedViewEyeDirection:function(){var t=this._variables.eyeVector;return t?t:(t=this.createVariable("vec3","eyeVector"),this.getNode("SetFromNode").inputs(this.getOrCreateVarying("vec4","vViewVertex")).outputs(t),this.getNode("Normalize").inputs({vec:t}).outputs({result:t}),this.getNode("Mult").inputs(t,this.createVariable("float").setValue("-1.0")).outputs(t),t)},getOrCreateNormalizedFrontViewNormal:function(){var t=this._variables.nFrontViewNormal;return t?t:(t=this.createVariable("vec3","nFrontViewNormal"),this.getNode("Normalize").inputs({vec:this.getOrCreateFrontViewNormal()}).outputs({result:t}),t)},getOrCreateFrontModelNormal:function(){var t=this._variables.frontModelNormal;return t?t:(t=this.createVariable("vec3","frontModelNormal"),this.getNode("FrontNormal").inputs({normal:this.getOrCreateVarying("vec3","vModelNormal")}).outputs({result:t}),t)},getOrCreateNormalizedFrontModelNormal:function(){var t=this._variables.nFrontModelNormal;return t?t:(t=this.createVariable("vec3","nFrontModelNormal"),this.getNode("Normalize").inputs({vec:this.getOrCreateFrontModelNormal()}).outputs({result:t}),t)},getPremultAlpha:function(t,e){if(void 0===e)return t;var r=this.createVariable("vec4");return this.getNode("PreMultAlpha").inputs({color:t,alpha:e}).outputs({result:r}),r},getColorsRGB:function(t){var e=this.createVariable("vec3");return this.getNode("LinearTosRGB").inputs({color:t}).outputs({color:e}),e},multiplyDiffuseWithVertexColor:function(t){var e=this.getOrCreateVarying("vec4","vVertexColor"),r=this.getOrCreateUniform("float","uArrayColorEnabled"),i=this.createVariable("vec4"),n=["","%color = %diffuse;","if ( %hasVertexColor == 1.0)","  %color *= %vertexColor;"].join("\n");return this.getNode("InlineCode").code(n).inputs({diffuse:t,hasVertexColor:r,vertexColor:e}).outputs({color:i}).comment("diffuse color = diffuse color * vertex color"),i},getDiffuseColorFromTextures:function(){var t=[],e=this._texturesByName;for(var r in e){var i=e[r];i.shadow||t.push(this.getTextureByName(r).variable)}if(t.length>1){var n=this.createVariable("vec3","texDiffuseAccum");return this.getNode("Mult").inputs(t).outputs(n),n}if(1===t.length)return t[0]},getFirstValidTexture:function(){for(var t=this._textures,e=0,r=t.length;e<r;++e){var i=t[e];if(i)return this.getTextureByName(i.getName()).variable}},_getShadowReceiveAttributeFromLightNum:function(t,e){for(var r=0;r<t.length;r++){var i=t[r];if(i&&i.getLightNumber()===e)return i}},_getShadowTextureFromLightNum:function(t,e){for(var r=0;r<t.length;r++){var i=t[r];if(i&&i.hasLightNumber(e))return i}},getInputsFromShadow:function(t,e,r,i){var n=t.getOrCreateUniforms(),a=this._shadowsTextures.indexOf(e),s=e.getOrCreateUniforms(a),o=t.getAtlas()?"_"+i:"",h={lighted:r,normalWorld:this.getOrCreateNormalizedFrontModelNormal(),vertexWorld:this.getOrCreateVarying("vec3","vModelVertex"),shadowTexture:this.getOrCreateSampler("sampler2D","Texture"+a),shadowSize:this.getOrCreateUniform(s.RenderSize),shadowProjectionMatrix:this.getOrCreateUniform(s["ProjectionMatrix"+o]),shadowViewMatrix:this.getOrCreateUniform(s["ViewMatrix"+o]),shadowDepthRange:this.getOrCreateUniform(s["DepthRange"+o]),shadowBias:this.getOrCreateUniform(n.bias)};return t.getAtlas()&&(h.atlasSize=this.getOrCreateUniform(s["MapSize"+o])),t.getNormalBias()&&(h.normalBias=this.getOrCreateUniform(n.normalBias)),h},getOrCreateDistanceShadow:function(t){if(this._computeShadowOutDistance){var e="shadowDistance"+t,r=this.getVariable(e);return r||(r=this.createVariable("float",e).setValue("0.0")),r}},hasLightShadow:function(t){var e=this._getShadowTextureFromLightNum(this._shadowsTextures,t),r=this._getShadowReceiveAttributeFromLightNum(this._shadows,t);return!!e&&!!r},createShadowingLight:function(t,e){var r=t.getLightNumber(),i=this._getShadowTextureFromLightNum(this._shadowsTextures,r),n=this._getShadowReceiveAttributeFromLightNum(this._shadows,r);if(i&&n){var a=this.getInputsFromShadow(n,i,e,r),s=this.createVariable("float"),o={result:s},h=n.getDefines(),u=this.getOrCreateDistanceShadow(r);return u&&(o.outDistance=u,h.push("#define _OUT_DISTANCE")),this.getNode("ShadowReceive").inputs(a).outputs(o).addDefines(h),s}},getOrCreateMaterialNormal:function(){return this.getOrCreateNormalizedFrontViewNormal()},getOrCreateMaterialDiffuseColor:function(){var t=this.getVariable("materialDiffuseColor");if(t)return t;t=this.createVariable("vec4","materialDiffuseColor");var e=this.getOrCreateUniform(this._material.getOrCreateUniforms().diffuse);return this.getNode("Mult").inputs(this.multiplyDiffuseWithVertexColor(e)).outputs(t),t},getOrCreateMaterialEmission:function(){return this.getOrCreateUniform(this._material.getOrCreateUniforms().emission)},getOrCreateMaterialSpecularColor:function(){return this.getOrCreateUniform(this._material.getOrCreateUniforms().specular)},getOrCreateMaterialSpecularHardness:function(){return this.getOrCreateUniform(this._material.getOrCreateUniforms().shininess)},getOrCreateMaterialAmbient:function(){return this.getOrCreateUniform(this._material.getOrCreateUniforms().ambient)},getLighting:function(){if(0!==this._lights.length){var t=this.getLightingSeparate(),e=this.createVariable("vec3");return this.getNode("Add").inputs(t.diffuse,t.specular).outputs(e),e}},getLightingSeparate:function(){if(0!==this._lights.length){for(var t=[],e=[],r=0;r<this._lights.length;r++){var i=this._lights[r],n=this.getLightSeparate(i);t.push(n.diffuseOut),e.push(n.specularOut)}var a,s;return 1===this._lights.length?(a=t[0],s=e[0]):(a=this.createVariable("vec3"),this.getNode("Add").inputs(t).outputs(a),s=this.createVariable("vec3"),this.getNode("Add").inputs(e).outputs(s)),{diffuse:a,specular:s}}},getLightSeparate:function(t){var e=this.getPrecomputeLight(t),r=this.getLightWithPrecompute(t,e),i=this.createShadowingLight(t,r.lighted);i&&(this.getNode("Mult").inputs(r.diffuseOut,i).outputs(r.diffuseOut),this.getNode("Mult").inputs(r.specularOut,i).outputs(r.specularOut));var n=this.getAmbientLight(t);return n&&this.getNode("Add").inputs(r.diffuseOut,n).outputs(r.diffuseOut),{diffuseOut:r.diffuseOut,specularOut:r.specularOut,lighted:r.lighted,attenuation:e.attenuation,eyeLightDir:e.eyeLightDir,dotNL:e.dotNL}},getPrecomputeLight:function(t){var e,r=t.getOrCreateUniforms(),n={attenuation:this.createVariable("float"),eyeLightDir:this.createVariable("vec3"),dotNL:this.createVariable("float")},a={normal:this.getOrCreateMaterialNormal()},s=t.getLightType();return s===i.POINT?(e="PrecomputePoint",a.viewVertex=this.getOrCreateVarying("vec4","vViewVertex"),a.lightAttenuation=this.getOrCreateUniform(r.attenuation),a.lightViewPosition=this.getOrCreateUniform(r.viewPosition)):s===i.SPOT?(e="PrecomputeSpot",a.viewVertex=this.getOrCreateVarying("vec4","vViewVertex"),a.lightViewDirection=this.getOrCreateUniform(r.viewDirection),a.lightAttenuation=this.getOrCreateUniform(r.attenuation),a.lightSpotCutOff=this.getOrCreateUniform(r.spotCutOff),a.lightSpotBlend=this.getOrCreateUniform(r.spotBlend),a.lightViewPosition=this.getOrCreateUniform(r.viewPosition)):(e="PrecomputeSun",a.lightViewDirection=this.getOrCreateUniform(r.viewDirection)),this.getNode(e).inputs(a).outputs(n),n},getLightWithPrecompute:function(t,e){var r=t.getOrCreateUniforms(),n={normal:this.getOrCreateMaterialNormal(),eyeVector:this.getOrCreateNormalizedViewEyeDirection(),dotNL:e.dotNL,attenuation:e.attenuation,materialDiffuse:this.getOrCreateMaterialDiffuseColor(),materialSpecular:this.getOrCreateMaterialSpecularColor(),materialShininess:this.getOrCreateMaterialSpecularHardness(),lightDiffuse:this.getOrCreateUniform(r.diffuse),lightSpecular:this.getOrCreateUniform(r.specular),eyeLightDir:e.eyeLightDir},a="ComputeLightLambertCookTorrance";t.getLightType()===i.HEMI&&(n.lightGround=this.getOrCreateUniform(r.ground),a="HemiLight");var s=this.getOutputsFromLight();return this.getNode(a).inputs(n).outputs(s),s},getAmbientLight:function(t){var e=this.createVariable("vec3"),r=this.getOrCreateUniform(t.getOrCreateUniforms().ambient),i=this.getOrCreateMaterialAmbient();return this.getNode("Mult").inputs(i,r).outputs(e),e},getOutputsFromLight:function(){var t={diffuseOut:this.createVariable("vec3"),specularOut:this.createVariable("vec3"),lighted:this.createVariable("bool")};return t},createTextureRGBA:function(t,e,r){var i=this.createVariable("vec4");return this.getNode("TextureRGBA").inputs({tex:e,uv:r}).outputs({result:i}),i}},s=function(t,e){return function(){return this._fragmentShaderMode||this.logError("This function should not be called from vertex shader : "+e),t.apply(this,arguments)}};for(var o in a)a[o]=s(a[o],o);t.exports=a},function(t,e,r){"use strict";var i,n=r(208),a=r(209),s=r(9),o=function(){try{i=r(210)}catch(t){s.warn("You will not be able to use osgUtil.DisplayGraph until you add jQuery in your page")}},h=function(t){this.options=t;var e=document.createElement("style");e.type="text/css",e.innerHTML=[".osgDebugSimpleTooltip {","display: none;","position: absolute;","margin-left: 10px;","border-radius: 4px;","padding: 10px;","background: rgba(0,0,0,.9);","color: #ffffff;","}",".osgDebugSimpleTooltip:before {","content: ",";","position: absolute;","left: -10px;","top: 8px;","border: 10px solid transparent;","border-width: 10px 10px 10px 0;","border-right-color: rgba(0,0,0,.9);","}"].join("\n"),document.getElementsByTagName("head")[0].appendChild(e),this.el=document.createElement("div"),this.el.className="osgDebugSimpleTooltip",document.body.appendChild(this.el);for(var r=document.querySelectorAll(this.options.selector),i=0;i<r.length;i++)r[i].addEventListener("mouseover",this.showTooltip.bind(this),!1),r[i].addEventListener("mouseout",this.hideTooltip.bind(this),!1)};h.prototype={showTooltip:function(t){if(i){var e=t.currentTarget;this.el.innerHTML=e.getAttribute("title"),this.el.style.display="block",this.el.style.left=i(e).position().left+i(e).get(0).getBoundingClientRect().width+"px",
this.el.style.top=i(e).position().top+"px"}},hideTooltip:function(){this.el.style.display="none"}};var u=function(){o(),i&&(this._selectables=new window.Map,this._graphNode=new a(this._selectables),this._graphRender=new n(this._selectables),this._displayNode=!0,this._displayRenderer=!1,this._cbSelect=void 0,this._focusedElement="graph",this._idToDomElement=new window.Map,this._$svg=i("<svg width=100% height=100%></svg>"),i("body").append(this._$svg),this._css=".node {text-align: center;cursor: pointer;}.node rect {stroke: #FFF;}.edgePath path {stroke: #FFF;fill: none;}table {text-align: right;}svg {position: absolute;left: 0px;top: 0px;}.osgDebugButton {position: absolute;left: 15px;top: 15px;z-index: 5;border: 0;background: #65a9d7;background: -webkit-gradient(linear, left top, left bottom, from(#3e779d), to(#65a9d7));background: -webkit-linear-gradient(top, #3e779d, #65a9d7);background: -moz-linear-gradient(top, #3e779d, #65a9d7);background: -ms-linear-gradient(top, #3e779d, #65a9d7);background: -o-linear-gradient(top, #3e779d, #65a9d7);padding: 5px 10px;-webkit-border-radius: 7px;-moz-border-radius: 7px;border-radius: 7px;-webkit-box-shadow: rgba(0,0,0,1) 0 1px 0;-moz-box-shadow: rgba(0,0,0,1) 0 1px 0;box-shadow: rgba(0,0,0,1) 0 1px 0;text-shadow: rgba(0,0,0,.4) 0 1px 0;color: white;font-size: 15px;font-family: Helvetica, Arial, Sans-Serif;text-decoration: none;vertical-align: middle;}.osgDebugButton:hover {border-top-color: #28597a;background: #28597a;color: #ccc;}.osgDebugButton:active {border-top-color: #1b435e;background: #1b435e;}.osgDebugSimpleTooltip .osgDebugName {font-weight: bold;color: #60b1fc;margin: 0;}.osgDebugSimpleTooltip .osgDebugDescription {margin: 0;}")};u.instance=function(){return u._instance||(u._instance=new u),u._instance},u.prototype={getColorFromClassName:a.prototype.getColorFromClassName,setCallbackSelect:function(t){this._cbSelect=t},reset:function(){i&&(this._selectables.clear(),this._$svg.empty(),this._focusedElement="scene",i(".osgDebugButton").hide())},setDisplayGraphRenderer:function(t){this._displayRenderer=t},createRenderGraph:function(t){this._graphRender.createGraph(t),this.displayGraph()},createGraph:function(t){i&&(this.reset(),this._displayNode=!!t,t&&this._graphNode.createGraph(t),this._displayRenderer?r(211).debugGraph=!0:this.displayGraph())},displayGraph:function(){if(i){if(window.d3&&window.dagreD3)return void this._createGraphApply();var t="//cdnjs.cloudflare.com/ajax/libs/d3/3.4.13/d3.min.js",e="//cdn.jsdelivr.net/dagre-d3/0.2.9/dagre-d3.min.js",r=this._createGraphApply.bind(this);i.getScript(t).done(function(){i.getScript(e).done(r)})}},_createGraphApply:function(){var t=new window.dagreD3.Digraph;this._displayNode&&this._graphNode.generateNodeAndLink(t),this._displayRenderer&&this._graphRender.generateNodeAndLink(t),this.injectStyleElement(),i(".osgDebugButton").show();var e=this.renderer=new window.dagreD3.Renderer,r=window.d3.select(this._$svg.get(0)),n=r.append("g"),a=.75,s=e.zoom();e.zoom(function(t,e){var r=s(t,e);return r.scale(a).event(e),r});var o=function(t,e){return'<p class="osgDebugName">'+t+'</p><pre class="osgDebugDescription">'+e+"</pre>"},u=this._idToDomElement,c=e.drawNodes();e.drawNodes(function(t,e){var r=c(t,e);return r.attr("title",function(e){return u.set(e,this),o(e,t.node(e).description||"")}),r}),e.run(t,n),this.tooltip=new h({selector:".node"}),i(".node").click(this.onNodeSelect.bind(this)),this.focusOnGraph()},selectNode:function(t){var e=t.getInstanceID(),r=this._idToDomElement.get(e);r&&i(r).click()},onNodeSelect:function(t){var e=t.currentTarget,r=i(e.getAttribute("title"))[0].innerHTML,n=this._selectables;this.lastNode&&(this.lastNode.style.fill=this.lastColor);var a=n.get(r);a&&(this.lastNode=e.childNodes[0],this.lastColor=this.lastNode.style.fill,e.childNodes[0].style.fill="#f00",window.activeNode=a,s.info("window.activeNode is set with the node below !"),s.log(window.activeNode),s.log("\n"),this._cbSelect&&this._cbSelect(a))},focusOnScene:function(){i(".osgDebugButton").text("Access to the graph"),this._$svg.css("zIndex","-2"),this._focusedElement="scene"},focusOnGraph:function(){i(".osgDebugButton").text("Access to the scene"),this._$svg.css("zIndex","2"),i(".osgDebugSimpleTooltip").css("zIndex","3"),this._focusedElement="graph"},injectStyleElement:function(){if(!this._cssInjected){this._cssInjected=!0,i("body").append('<button class="osgDebugButton">Access to the scene</button>'),i(".osgDebugButton").click(function(){"scene"===this._focusedElement?this.focusOnGraph():this.focusOnScene()}.bind(this));var t=document.createElement("style");t.type="text/css",t.innerHTML=this._css,document.getElementsByTagName("head")[0].appendChild(t)}}},t.exports=u},function(t,e,r){"use strict";var i=r(209),n=r(69),a=function(t){this._selectables=t,this._nodeList=[],this._linkList=[],this._renderBinMap=new window.Map,this._renderBinStack=[],this._generatorID=0,this._refID=0,this._uniqueEdges=new window.Set};a.prototype={getColorFromClassName:i.prototype.getColorFromClassName,createGraph:function(t){this.reset(),this.apply(t)},reset:function(){this._renderBinMap.clear(),this._renderBinStack.length=0,this._generatorID=0,this._refID++,this._nodeList.length=0,this._linkList.length=0,this._uniqueEdges.clear()},apply:function(t){var e=t.getInstanceID();if(this._renderBinMap.has(e)||this._renderBinMap.set(e,t),this._renderBinStack.push(t),t.getPreRenderStageList)for(var r=t.getPreRenderStageList(),i=0,n=r.length;i<n;++i)this.apply(r[i].renderStage);if(this.registerNode(t),t.getPostRenderStageList)for(var a=t.getPostRenderStageList(),s=0,o=a.length;s<o;++s)this.apply(a[s].renderStage);this._renderBinStack.pop()},registerNode:function(t){var e=t.getInstanceID();this._nodeList.push(t);var r=t._bins;if(r.forEach(function(t,e){this.apply(e)}.bind(this)),t._leafs.length)for(var i=0,n=t._leafs.length;i<n;i++)this.createNodeAndSetID(e,t._leafs[i]);var a=this,s={},o=function(t){a.createNodeAndSetID(this.stateGraphID,t)}.bind(s),h=function(t){a.createNodeAndSetID(e,t);var r=t._instanceID,i=t.getLeafs();s.stateGraphID=r,i.forEach(o)},u=t.getStateGraphList();if(u.forEach(h),!(this._renderBinStack.length<2)){var c=this._renderBinStack[this._renderBinStack.length-2].getInstanceID();this.createLink(c,e)}},createLink:function(t,e){var r=t+"+"+e;this._uniqueEdges.has(r)||(this._linkList.push({parentNode:t,childrenNode:e}),this._uniqueEdges.add(r))},createNodeAndSetID:function(t,e){this._nodeList.push(e),(void 0===e._instanceID||e._instanceID<0&&e._refID!==this._refID)&&(e._instanceID=-1-this._generatorID++,e._refID=this._refID),this.createLink(t,e._instanceID)},generateRenderLeaf:function(t,e){var r=e._instanceID,i="RenderLeaf",n=e._geometry&&e._geometry.getName()?"\n"+e._geometry.getName():"Geometry",a=i+" ( "+e._instanceID+" )";a+="\n"+n+" ( "+e._geometry.getInstanceID()+" )",this._selectables.set(r.toString(),e),t.addNode(r,{label:a,description:"",style:"fill: "+this.getColorFromClassName(i)+";stroke-width: 0px;"})},generateStateGraph:function(t,e){var r=e._instanceID,i="StateGraph",n=i+" ( "+e._instanceID+" )";n+="\n"+e._leafs._length+" leafs",this._selectables.set(r.toString(),e),t.addNode(r,{label:n,description:"",style:"fill: "+this.getColorFromClassName(i)+";stroke-width: 0px;"})},generateRenderStage:function(t,e){var r=e.className()+" ( "+e._instanceID+" )";e.getName()&&(r+="\n"+e.getName()),r+="\nViewport ( "+e.getViewport().width()+" x "+e.getViewport().height()+" )",this._selectables.set(e.getInstanceID().toString(),e),t.addNode(e.getInstanceID(),{label:r,description:"",style:"fill: "+this.getColorFromClassName(e.className())+";stroke-width: 0px;"})},generateRenderBin:function(t,e){var r=e.className()+" ( "+e.getInstanceID()+" )";e.getName()&&(r+="\n"+e.getName());var i="";e.getSortMode()===n.SORT_BACK_TO_FRONT&&(i="SortMode: BackToFront");var a="BinNumber: "+e.getBinNumber()+"\n"+i;this._selectables.set(e.getInstanceID().toString(),e),t.addNode(e.getInstanceID(),{label:r,description:a,style:"fill: "+this.getColorFromClassName(e.className())+";stroke-width: 0px;"})},generateNodeAndLink:function(t){for(var e=0,r=this._nodeList.length;e<r;e++){var i=this._nodeList[e];i._geometry&&void 0!==i._depth?this.generateRenderLeaf(t,i):"StateGraph"===i.className()?this.generateStateGraph(t,i):"RenderStage"===i.className()?this.generateRenderStage(t,i):this.generateRenderBin(t,i)}for(var n=0,a=this._linkList.length;n<a;n++)t.addEdge(null,this._linkList[n].parentNode,this._linkList[n].childrenNode)}},t.exports=a},function(t,e,r){"use strict";var i=r(7),n=r(31),a=r(82),s=function(t){n.call(this,n.TRAVERSE_ALL_CHILDREN),this._selectables=t,this._nodeList=[],this._linkList=[],this._uniqueNodes=new window.Set,this._uniqueEdges=new window.Set};i.createPrototypeObject(s,i.objectInherit(n.prototype,{getColorFromClassName:function(t){switch(t){case"ShadowedScene":return"#3D3D3D";case"Camera":return"#AB7BCF";case"RenderBin":return"#59778B";case"LightSource":return"#53967D";case"RenderStage":return"#DDCC55";case"RenderLeaf":case"Geometry":return"#FFCC55";case"RigGeometry":return"#DD8800";case"MorphGeometry":return"#AA5500";case"MatrixTransform":return"#CE697E";case"StateSet":return"#0099FF";case"StateGraph":case"Skeleton":return"#96999E";case"Bone":return"#A9DEAA";case"Node":return"#FFFFFF";default:return"#FF00AA"}},createGraph:function(t){this.reset(),t.accept(this)},reset:function(){this._nodeList.length=0,this._linkList.length=0,this._uniqueNodes.clear(),this._uniqueEdges.clear()},apply:function(t){if(!t._isNormalDebug){if(this._uniqueNodes.has(t.getInstanceID())||(this._uniqueNodes.add(t.getInstanceID()),this._nodeList.push(t)),this.nodePath.length>=2){var e=this.nodePath[this.nodePath.length-2].getInstanceID(),r=t.getInstanceID(),i=e+"+"+r;this._uniqueEdges.has(i)||(this._linkList.push({parentNode:e,childrenNode:r}),this._uniqueEdges.add(i))}this.traverse(t)}},createMatrixGrid:function(t,e){var r="";return r+="<table><tr><td>"+e[0]+"</td>",r+="<td>"+e[4]+"</td>",r+="<td>"+e[8]+"</td>",r+="<td>"+e[12]+"</td></tr>",r+="<tr><td>"+e[1]+"</td>",r+="<td>"+e[5]+"</td>",r+="<td>"+e[9]+"</td>",r+="<td>"+e[13]+"</td></tr>",r+="<tr><td>"+e[2]+"</td>",r+="<td>"+e[6]+"</td>",r+="<td>"+e[10]+"</td>",r+="<td>"+e[14]+"</td></tr>",r+="<tr><td>"+e[3]+"</td>",r+="<td>"+e[7]+"</td>",r+="<td>"+e[11]+"</td>",r+="<td>"+e[15]+"</td></tr></table>"},getLabel:function(t){var e=t.className()+" ("+t.getInstanceID()+")";return t.getName&&t.getName()&&(e+="\n"+t.getName()),e},generateNode:function(t,e){var r="";e.getMatrix&&e.getMatrix()&&(r+="<br /><br />"+this.createMatrixGrid(e,e.getMatrix())),this._selectables.set(e.getInstanceID().toString(),e),t.addNode(e.getInstanceID(),{label:this.getLabel(e),description:r,style:"fill: "+this.getColorFromClassName(e.className())+";stroke-width: 0px;"})},generateStateSet:function(t,e){var r=e.getStateSet(),i=r.getInstanceID(),n=this.getLabel(r);n+="\nNbTexture : "+r.getNumTextureAttributeLists(),t.hasNode(i)||(this._selectables.set(i.toString(),r),t.addNode(i,{label:n,style:"fill: "+this.getColorFromClassName(r.className())+";stroke-width: 0px;"})),t.addEdge(null,e.getInstanceID(),i,{style:"stroke: "+this.getColorFromClassName(r.className())+";"})},generateSourceGeometry:function(t,e){var r=e.getSourceGeometry(),i=r.getInstanceID();this._selectables.set(i.toString(),r),t.addNode(i,{label:this.getLabel(r),style:"fill: "+this.getColorFromClassName(r.className())+";stroke-width: 0px;"}),t.addEdge(null,e.getInstanceID(),i,{style:"stroke: "+this.getColorFromClassName(r.className())+";"})},generateNodeAndLink:function(t){for(var e=0,r=this._nodeList.length;e<r;e++){var i=this._nodeList[e];this.generateNode(t,i),i.getStateSet()&&this.generateStateSet(t,i),i.getSourceGeometry&&i.getSourceGeometry()instanceof a&&this.generateSourceGeometry(t,i)}for(var n=0,s=this._linkList.length;n<s;n++)t.addEdge(null,this._linkList[n].parentNode,this._linkList[n].childrenNode)}}),"osgUtil","DisplayGraphNode"),t.exports=s},function(t,e){if("undefined"==typeof __WEBPACK_EXTERNAL_MODULE_210__){var r=new Error('Cannot find module "undefined"');throw r.code="MODULE_NOT_FOUND",r}t.exports=__WEBPACK_EXTERNAL_MODULE_210__},function(t,e,r){"use strict";var i=r(7),n=r(55),a=r(63),s=r(13),o=r(70),h=r(125),u=r(68),c=r(15).vec4,l=r(199),d=r(207),_=function(t){s.call(this),this._state=void 0,this._camera=t,this._renderStage=void 0,this._stateGraph=void 0,this._frameStamp=void 0,this._previousCullsettings=new n,this.setDefaults()};_.debugGraph=!1,i.createPrototypeObject(_,i.objectInherit(s.prototype,{setDefaults:function(){this._state=new h(new l.ShaderGeneratorProxy),this._cullVisitor=new a,this._cullVisitor.setRenderer(this),this._stateGraph=new u,this.getCamera().setClearColor(c.create()),this.setRenderStage(new o);var t=r(5),e=this.getCamera().getOrCreateStateSet();e.setAttributeAndModes(new t.Material),e.setAttributeAndModes(new t.Depth),e.setAttributeAndModes(new t.BlendFunc),e.setAttributeAndModes(new t.CullFace)},getCullVisitor:function(){return this._cullVisitor},setCullVisitor:function(t){t&&!t.getRenderer()&&t.setRenderer(this),this._cullVisitor=t},setRenderStage:function(t){this._renderStage=t},getCamera:function(){return this._camera},setFrameStamp:function(t){this._frameStamp=t},getFrameStamp:function(){return this._frameStamp},getState:function(){return this._state},setState:function(t){this._state=t},setGraphicContext:function(t){this._state.setGraphicContext(t)},getGraphicContext:function(){return this._state.getGraphicContext()},cullAndDraw:function(){this.cull(),this.draw()},cull:function(){var t=this.getCamera(),e=t.getView();this._cullVisitor.setFrameStamp(this._frameStamp),this._cullVisitor.resetStats(),u.reset(),this._stateGraph.clean(),this._renderStage.reset(),this._cullVisitor.reset(),this._cullVisitor.setStateGraph(this._stateGraph),this._cullVisitor.setRenderStage(this._renderStage),this._cullVisitor.pushStateSet(t.getStateSet()),this._previousCullsettings.reset(),this._previousCullsettings.setCullSettings(this._cullVisitor),this._cullVisitor.setCullSettings(t),this._previousCullsettings.getSettingSourceOverrider()===this._cullVisitor&&this._previousCullsettings.getEnableFrustumCulling()&&this._cullVisitor.setEnableFrustumCulling(!0),this._cullVisitor.pushCameraModelViewProjectionMatrix(t,t.getViewMatrix(),t.getProjectionMatrix()),t.getBound();var i=e.getLight(),n=r(212);if(i)switch(e.getLightingMode()){case n.LightingMode.HEADLIGHT:this._cullVisitor.addPositionedAttribute(null,i);break;case n.LightingMode.SKY_LIGHT:this._cullVisitor.addPositionedAttribute(t.getViewMatrix(),i)}this._cullVisitor.pushViewport(t.getViewport()),this._renderStage.setClearDepth(t.getClearDepth()),this._renderStage.setClearColor(t.getClearColor()),this._renderStage.setClearMask(t.getClearMask()),this._renderStage.setViewport(t.getViewport()),this._cullVisitor.setDatabaseRequestHandler(this._camera.getView().getDatabasePager()),this._cullVisitor.handleCullCallbacksAndTraverse(t),this._cullVisitor.popCameraModelViewProjectionMatrix(t),this._cullVisitor.setCullSettings(this._previousCullsettings),this._cullVisitor.popViewport(),this._cullVisitor.popStateSet(),this._renderStage.sort()},draw:function(){var t=this.getState();t.resetCacheFrame(),t.resetStats(),this._renderStage.setCamera(this._camera),this._renderStage.draw(t),_.debugGraph&&(d.instance().createRenderGraph(this._renderStage),_.debugGraph=!1),this._renderStage.setCamera(void 0),t.applyDefault()}}),"osgViewer","Renderer"),t.exports=_},function(t,e,r){"use strict";var i=r(48),n=r(54),a=r(93),s=r(71),o=r(99),h=r(15).mat4,u=r(40),c=r(104),l=r(122),d=r(15).vec3,_=r(129),f=r(49),g=r(37),p=r(165),m=r(166),v=r(211),S=r(213),x=r(207),b=r(9),y=function(){this._camera=new n,this._camera.setName("OSGJS camera"),this._scene=new S,this._camera.setName("OSGJS Scene"),this._frameStamp=new a,this._lightingMode=void 0,this._manipulator=void 0,this._canvasWidth=0,this._canvasHeight=0,this._requestContinousUpdate=!0,this._requestRedraw=!0,this.setLightingMode(y.LightingMode.HEADLIGHT);var t=this.createRenderer(this.getCamera());t.setFrameStamp(this._frameStamp),this.getCamera().setRenderer(t),this.getCamera().setView(this)};y.LightingMode={NO_LIGHT:0,HEADLIGHT:1,SKY_LIGHT:2},y.prototype={requestRedraw:function(){this._requestRedraw=!0},requestContinuousUpdate:function(t){this._requestContinousUpdate=t},createRenderer:function(t){var e=new v(t);return e},setGraphicContext:function(t){this.getCamera().getRenderer().getState().setGraphicContext(t)},getGraphicContext:function(){return this.getCamera().getRenderer().getState().getGraphicContext()},initWebGLCaps:function(t,e){g.instance(t,e)},computeCanvasSize:function(){return function(t){var e,r;e=t.clientWidth,r=t.clientHeight,e<1&&(e=1),r<1&&(r=1);var i=this._devicePixelRatio,n=Math.floor(e*i),a=Math.floor(r*i),s=!1;return this._canvasWidth!==n&&(t.width=n,this._canvasWidth=n,s=!0),this._canvasHeight!==a&&(t.height=a,this._canvasHeight=a,s=!0),s}}(),getCanvasWidth:function(){return this._canvasWidth},getCanvasHeight:function(){return this._canvasHeight},getCanvasClientWidth:function(){return Math.ceil(this._canvasWidth/this._devicePixelRatio)},getCanvasClientHeight:function(){return Math.ceil(this._canvasHeight/this._devicePixelRatio)},getCanvasPixelRatio:function(){return this._devicePixelRatio},setUpView:function(t,e){var r=window.devicePixelRatio||1,i=e.getNumber("overrideDevicePixelRatio"),n=e.getNumber("maxDevicePixelRatio")||-1;"number"==typeof i?r=i:n!==-1&&(r=Math.min(r,n)),this._devicePixelRatio=r,this.computeCanvasSize(t);var a=t.width,s=t.height,o=a/s;if(this._camera.setViewport(new _(0,0,a,s)),this._camera.setGraphicContext(this.getGraphicContext()),h.lookAt(this._camera.getViewMatrix(),d.fromValues(0,0,-10),d.create(),d.fromValues(0,1,0)),h.perspective(this._camera.getProjectionMatrix(),Math.PI/180*55,o,1,1e3),e&&e.enableFrustumCulling&&this.getCamera().getRenderer().getCullVisitor().setEnableFrustumCulling(!0),e&&e.debugGraph){var u=this.getCamera();x.instance().refreshGraph=function(){var t=x.instance();t.setDisplayGraphRenderer(!0),t.createGraph(u)},b.log("to refresh the graphs type in the console:\nOSG.osgUtil.DisplayGraph.instance().refreshGraph()")}},computeIntersections:function(t,e,r){return void 0===r&&(r=-1),this._lsi?this._lsi.reset():this._lsi=new m,this._origIntersect||(this._origIntersect=d.create(),this._dstIntersect=d.create()),this._lsi.set(d.set(this._origIntersect,t,e,0),d.set(this._dstIntersect,t,e,1)),this._iv?this._iv.reset():(this._iv=new p,this._iv.setIntersector(this._lsi)),this._iv.setTraversalMask(r),this._camera.accept(this._iv),this._lsi.getIntersections()},setFrameStamp:function(t){this._frameStamp=t},getFrameStamp:function(){return this._frameStamp},setCamera:function(t){this._camera=t},getCamera:function(){return this._camera},setSceneData:function(t){var e=this._scene.getSceneData();if(t!==e){this._scene.setSceneData(t);for(var r=this._camera.getChildren(),i=void 0,n=0,a=r.length;n<a;n++)if("osgStats"===r[n].getName()){i=r[n];break}this._camera.removeChildren(),this._camera.addChild(t),i&&this._camera.addChild(i)}},getSceneData:function(){return this._scene.getSceneData()},setDatabasePager:function(t){this._scene.setDatabasePager(t)},getDatabasePager:function(){return this._scene.getDatabasePager()},getScene:function(){return this._scene},getManipulator:function(){return this._manipulator},setManipulator:function(t){this._manipulator=t},getLight:function(){return this._light},setLight:function(t){this._light=t,this._lightingMode!==y.LightingMode.NO_LIGHT&&this._scene.getOrCreateStateSet().setAttributeAndModes(this._light)},getLightingMode:function(){return this._lightingMode},setLightingMode:function(t){this._lightingMode!==t&&(this._lightingMode=t,this._lightingMode!==y.LightingMode.NO_LIGHT?this._light||(this._light=new o):this._light=void 0)},flushDeletedGLObjects:function(t){var e=this.getGraphicContext(),r=t;r=i.flushDeletedGLBufferArrays(e,r),r=f.flushDeletedGLVertexArrayObjects(e,r),r=u.getTextureManager(e).flushDeletedTextureObjects(e,r),r=c.flushDeletedGLPrograms(e,r),r=l.flushDeletedGLShaders(e,r),r=s.flushDeletedGLFrameBuffers(e,r),s.flushDeletedGLRenderBuffers(e,r)},flushAllDeletedGLObjects:function(){var t=this.getGraphicContext();i.flushAllDeletedGLVertexArrayObjects(t),f.flushAllDeletedGLBufferArrays(t),u.getTextureManager(t).flushAllDeletedTextureObjects(t),c.flushAllDeletedGLPrograms(t),l.flushAllDeletedGLShaders(t),s.flushAllDeletedGLFrameBuffers(t),s.flushAllDeletedGLRenderBuffers(t)}},t.exports=y},function(t,e,r){"use strict";var i=r(7),n=r(13),a=r(155),s=function(){n.call(this),this._databasePager=new a,this._sceneData=void 0};i.createPrototypeObject(s,i.objectInherit(n.prototype,{getSceneData:function(){return this._sceneData},setSceneData:function(t){this._sceneData=t},setDatabasePager:function(t){this._databasePager=t},getDatabasePager:function(){return this._databasePager},updateSceneGraph:function(t){this._databasePager&&this._databasePager.updateSceneGraph(t.getFrameStamp()),this._sceneData&&this._sceneData.accept(t)}}),"osgViewer","Scene"),t.exports=s},function(t,e,r){"use strict";var i=r(12),n=r(64),a=r(89),s=r(53),o=r(57),h=r(41),u=r(15).vec2,c=r(15).vec3,l=r(15).vec4,d=r(15).mat4,_=r(15).quat,f=r(165),g=r(166),p=r(215),m=r(34),v=r(7),S=function(t,e){t[0]=void 0===e.offsetX?e.layerX:e.offsetX,t[1]=void 0===e.offsetY?e.layerY:e.offsetY},x=function(){};x.prototype={cull:function(){return!1}};var b=new s(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA),y=function(t){this._testPlane=t,this._inter=c.create(),g.call(this)};v.createPrototypeObject(y,v.objectInherit(g.prototype,{setTestPlane:function(t){this._testPlane=t},getTranslateDistance:function(){return this._inter},enter:function(){var t=c.create(),e=c.create();return function(r){if(void 0===r._nbAxis)return!0;if(c.init(t),t[r._nbAxis]=1,this._testPlane){var i=c.dot(this._iStart,t),n=c.dot(this._iEnd,t);if(i===n)return!1;var a=-i/(n-i);this._inter[0]=this._iStart[0]+(this._iEnd[0]-this._iStart[0])*a,this._inter[1]=this._iStart[1]+(this._iEnd[1]-this._iStart[1])*a,this._inter[2]=this._iStart[2]+(this._iEnd[2]-this._iStart[2])*a}else{c.normalize(e,c.sub(e,this._iEnd,this._iStart));var s=-c.dot(e,t),o=c.dot(this._iStart,e),h=Math.abs(1-s*s),u=-c.dot(this._iStart,t);c.init(this._inter),this._inter[r._nbAxis]=(s*o-u)/h}return!1}}(),intersectTriangle:function(){},intersectLine:function(){},intersectPoint:function(){}}),"osgUtil","LineCustomIntersector");var M=function(t){n.call(this),this._tmask=1,this._autoInsertMT=!1,this._viewer=t,this._canvas=t.getGraphicContext().canvas,this._manipulator=t.getManipulator(),this._rotateNode=new n,this._translateNode=new n,this._planeNode=new n,this._rotateInLocal=!0,this._translateInLocal=!0,this._showAngle=new n,this._downCanvasCoord=u.create(),this._hoverNode=null,this._keepHoverColor=l.create(),this._isEditing=!1,this._editLineOrigin=c.create(),this._editLineDirection=c.create(),this._editOffset=c.create(),this._editLocal=d.create(),this._editWorldTrans=d.create(),this._editWorldScaleRot=d.create(),this._editInvWorldScaleRot=d.create(),this._debugNode=new i,this._lastDistToEye=0,this._attachedNode=null,this.attachToGeometry(null),this._lsi=new y,this._origIntersect=c.create(),this._dstIntersect=c.create(),this._iv=new f,this._iv.setIntersector(this._lsi),this._eventMouse=t._eventProxy.StandardMouseKeyboard,this._enableMouseBack=!1,this.init()};M.NO_PICK=1,M.PICK_ARC_X=2,M.PICK_ARC_Y=4,M.PICK_ARC_Z=8,M.PICK_ARROW_X=16,M.PICK_ARROW_Y=32,M.PICK_ARROW_Z=64,M.PICK_PLANE_X=128,M.PICK_PLANE_Y=256,M.PICK_PLANE_Z=512,M.NO_FULL_CIRCLE=1024,M.PICK_ARC=M.PICK_ARC_X|M.PICK_ARC_Y|M.PICK_ARC_Z,M.PICK_ARROW=M.PICK_ARROW_X|M.PICK_ARROW_Y|M.PICK_ARROW_Z,M.PICK_PLANE=M.PICK_PLANE_X|M.PICK_PLANE_Y|M.PICK_PLANE_Z,M.PICK_GIZMO=M.PICK_ARC|M.PICK_ARROW|M.PICK_PLANE,v.createPrototypeNode(M,v.objectInherit(n.prototype,{setRotateInLocal:function(t){this._rotateInLocal=t},setTranslateInLocal:function(t){this._translateInLocal=t},setTraversalMask:function(t){this._tmask=t},isEditing:function(){return this._isEditing},init:function(){this.getOrCreateStateSet().setAttributeAndModes(new a(a.DISABLE)),this.getOrCreateStateSet().setAttributeAndModes(new o(o.DISABLE));var t=function(){};t.prototype={update:this.updateGizmo.bind(this)},this.addUpdateCallback(new t),this.addChild(this.initNodeTranslate()),this.addChild(this.initNodeTranslatePlane()),this.addChild(this.initNodeRotate()),this._debugNode&&(this._debugNode.addChild(p.createDebugLineGeometry()),this.addChild(this._debugNode),this._debugNode.setNodeMask(0));var e=this._canvas;e.addEventListener("mousemove",this.onMouseMove.bind(this)),e.addEventListener("mousedown",this.onMouseDown.bind(this)),e.addEventListener("mouseup",this.onMouseUp.bind(this)),e.addEventListener("mouseout",this.onMouseUp.bind(this))},attachToNodePath:function(t){var e;if(t)for(var r=t.length-1;r>=0;--r){var i=t[r].editMask||0;if(i&M.PICK_GIZMO){e=t[r];break}}return e?(this._attachedNode=e,void this.updateGizmoMask()):(this._attachedNode=null,void this.setNodeMask(0))},attachToMatrixTransform:function(t){return t?(void 0===t.editMask&&(t.editMask=M.PICK_GIZMO),this._attachedNode=t,void this.updateGizmoMask()):(this._attachedNode=null,void this.setNodeMask(0))},attachToGeometry:function(t){var e=t;if(!e)return this._attachedNode=null,void this.setNodeMask(0);var r=e.getParents();if(void 0===r[0].editMask){for(var i=new n;r.length>0;)r[0].addChild(i),r[0].removeChild(e);i.addChild(e),i.editMask=M.PICK_GIZMO,e=i}else e=r[0];this._attachedNode=e,this.updateGizmoMask()},updateGizmoMask:function(){if(!this._attachedNode)return void this.setNodeMask(0);var t=this._attachedNode.editMask;this.setNodeMask(t&M.PICK_GIZMO?M.NO_PICK:0),this._translateNode.setNodeMask(t&M.PICK_ARROW?M.PICK_ARROW:0),this._rotateNode.setNodeMask(t&M.PICK_ARC?M.PICK_ARC:0),this._planeNode.setNodeMask(t&M.PICK_PLANE?M.PICK_PLANE:0);var e=this._translateNode.getChildren();e[0].setNodeMask(t&M.PICK_ARROW_X?M.PICK_ARROW_X:0),e[1].setNodeMask(t&M.PICK_ARROW_Y?M.PICK_ARROW_Y:0),e[2].setNodeMask(t&M.PICK_ARROW_Z?M.PICK_ARROW_Z:0);var r=this._rotateNode.getChildren();r[0].setNodeMask(t&M.NO_FULL_CIRCLE?0:M.NO_PICK),r[1].setNodeMask(t&M.PICK_ARC_X?M.PICK_ARC_X:0),r[2].setNodeMask(t&M.PICK_ARC_Y?M.PICK_ARC_Y:0),r[3].setNodeMask(t&M.PICK_ARC_Z?M.PICK_ARC_Z:0);var i=this._planeNode.getChildren();i[0].setNodeMask(t&M.PICK_PLANE_X?M.PICK_PLANE_X:0),i[1].setNodeMask(t&M.PICK_PLANE_Y?M.PICK_PLANE_Y:0),i[2].setNodeMask(t&M.PICK_PLANE_Z?M.PICK_PLANE_Z:0)},onNodeHovered:function(){var t=l.fromValues(1,1,0,1);return function(e){if(this._hoverNode&&this._hoverNode.getStateSet().getUniform("uColor").setFloat4(this._keepHoverColor),!e)return void(this._hoverNode=null);for(var r=e._nodePath,i=r.length-1,n=r[i];void 0===n._nbAxis;){if(0===i)return;n=r[--i]}var a=n.getStateSet().getUniform("uColor");this._hoverNode=n,l.copy(this._keepHoverColor,a.getInternalArray()),a.setFloat4(t)}}(),initNodeRotate:function(){var t=p.createTorusGeometry(1,.01,6,64,2*Math.PI),e=p.createTorusGeometry(1,.01,6,64,Math.PI),r=p.createTorusGeometry(1,.1,6,64,Math.PI),a=new n,s=new n,o=new n,u=new n;s._nbAxis=0,o._nbAxis=1,u._nbAxis=2;var d=new i;d.setCullCallback(new x),d.addChild(r),t.setNodeMask(M.NO_PICK),e.setNodeMask(M.NO_PICK),s.setNodeMask(M.PICK_ARC_X),o.setNodeMask(M.PICK_ARC_Y),u.setNodeMask(M.PICK_ARC_Z),a.addChild(t),s.addChild(e),o.addChild(e),u.addChild(e),s.addChild(d),o.addChild(d),u.addChild(d),a.getOrCreateStateSet().addUniform(h.createFloat4(l.fromValues(.2,.2,.2,1),"uColor")),s.getOrCreateStateSet().addUniform(h.createFloat4(l.fromValues(1,0,0,1),"uColor")),o.getOrCreateStateSet().addUniform(h.createFloat4(l.fromValues(0,1,0,1),"uColor")),u.getOrCreateStateSet().addUniform(h.createFloat4(l.fromValues(0,0,1,1),"uColor"));var _=this._showAngle;_.getOrCreateStateSet().setAttributeAndModes(b),_.setNodeMask(0),_.getOrCreateStateSet().addUniform(h.createFloat3(c.fromValues(1,0,0),"uBase")),_.getOrCreateStateSet().addUniform(h.createFloat(0,"uAngle")),_.addChild(p.createQuadCircleGeometry());var f=this._rotateNode;return f.setNodeMask(M.PICK_ARC),f.addChild(a),f.addChild(s),f.addChild(o),f.addChild(u),f.addChild(_),f},initNodeTranslate:function(){var t=1.5,e=.3,r=.5,a=1.1*(t-r+e),s=new n;d.fromTranslation(s.getMatrix(),c.fromValues(0,0,t+.5*e)),s.addChild(p.createCylinderGeometry(0,.07,e,32,1,!0,!0));var o=new n;d.fromTranslation(o.getMatrix(),c.fromValues(0,0,.5*t)),o.addChild(p.createCylinderGeometry(.01,.01,t,32,1,!0,!0));var u=new i;u.addChild(o),u.addChild(s);var _=p.createCylinderGeometry(.1,.1,a,32,1,!0,!0),f=new n,g=new n,m=new n;f._nbAxis=0,g._nbAxis=1,m._nbAxis=2,d.fromRotation(f.getMatrix(),.5*Math.PI,c.fromValues(0,1,0)),d.fromRotation(g.getMatrix(),.5*-Math.PI,c.fromValues(1,0,0));var v=new n;v.setCullCallback(new x),d.fromTranslation(v.getMatrix(),c.fromValues(0,0,r+.5*a)),v.addChild(_),u.setNodeMask(M.NO_PICK),f.setNodeMask(M.PICK_ARROW_X),g.setNodeMask(M.PICK_ARROW_Y),m.setNodeMask(M.PICK_ARROW_Z),f.addChild(u),g.addChild(u),m.addChild(u),f.addChild(v),g.addChild(v),m.addChild(v),f.getOrCreateStateSet().addUniform(h.createFloat4(l.fromValues(1,0,0,1),"uColor")),g.getOrCreateStateSet().addUniform(h.createFloat4(l.fromValues(0,1,0,1),"uColor")),m.getOrCreateStateSet().addUniform(h.createFloat4(l.fromValues(0,0,1,1),"uColor"));var S=this._translateNode;return S.setNodeMask(M.PICK_ARROW),S.addChild(f),S.addChild(g),S.addChild(m),S},initNodeTranslatePlane:function(){var t=new n;d.fromTranslation(t.getMatrix(),c.fromValues(.5,.5,0)),d.mul(t.getMatrix(),d.fromScaling(d.create(),c.fromValues(.5,.5,1)),t.getMatrix()),t.addChild(p.createPlaneGeometry());var e=new n,r=new n,i=new n;e._nbAxis=0,r._nbAxis=1,i._nbAxis=2,d.fromRotation(e.getMatrix(),.5*-Math.PI,c.fromValues(0,1,0)),d.fromRotation(r.getMatrix(),.5*Math.PI,c.fromValues(1,0,0)),e.setNodeMask(M.PICK_PLANE_X),r.setNodeMask(M.PICK_PLANE_Y),i.setNodeMask(M.PICK_PLANE_Z),e.addChild(t),r.addChild(t),i.addChild(t),e.getOrCreateStateSet().addUniform(h.createFloat4(l.fromValues(1,0,0,.3),"uColor")),r.getOrCreateStateSet().addUniform(h.createFloat4(l.fromValues(0,1,0,.3),"uColor")),i.getOrCreateStateSet().addUniform(h.createFloat4(l.fromValues(0,0,1,.3),"uColor"));var a=this._planeNode;return a.setNodeMask(M.PICK_PLANE),a.getOrCreateStateSet().setAttributeAndModes(b),a.addChild(e),a.addChild(r),a.addChild(i),a},updateArcRotation:function(){var t=_.create(),e=_.setAxisAngle(_.create(),[0,1,0],.5*-Math.PI),r=_.setAxisAngle(_.create(),[1,0,0],.5*-Math.PI);return function(i){var n=this._rotateNode,a=n.getChildren();t[0]=-i[1],t[1]=i[0],t[2]=0,t[3]=1+i[2],_.normalize(t,t),d.fromQuat(a[0].getMatrix(),t),_.setAxisAngle(t,[1,0,0],Math.atan2(i[2],i[1])),_.mul(t,t,e),d.fromQuat(a[1].getMatrix(),t),_.setAxisAngle(t,[0,1,0],Math.atan2(-i[0],-i[2])),_.mul(t,t,r),d.fromQuat(a[2].getMatrix(),t),_.setAxisAngle(t,[0,0,1],Math.atan2(-i[0],i[1])),d.fromQuat(a[3].getMatrix(),t),a[1].dirtyBound(),a[2].dirtyBound(),a[3].dirtyBound()}}(),getTransformType:function(t){for(var e=t;e.getParents().length>0;){if(void 0!==e.referenceFrame&&e.referenceFrame===m.ABSOLUTE_RF)return m.ABSOLUTE_RF;e=e.getParents()[0]}return m.RELATIVE_RF},updateGizmo:function(){var t=c.create(),e=c.create(),r=c.create(),i=d.create(),n=d.create(),a=d.create(),s=d.create();return function(){if(this._attachedNode){var o=this.getTransformType(this._attachedNode);this.setReferenceFrame(o),this.setCullingActive(o===m.RELATIVE_RF);var h=this._attachedNode.getWorldMatrices()[0];d.getTranslation(e,h),d.fromTranslation(n,e);var u=3;if(o===m.ABSOLUTE_RF)t[0]=t[1]=t[2]=0,r[0]=r[1]=r[2]=1;else{var l=this._viewer.getCamera().getProjectionMatrix(),_=.023*this._canvas.clientWidth*l[0];this._manipulator.getEyePosition(t),this._lastDistToEye=this._isEditing?this._lastDistToEye:c.distance(e,t),u*=this._lastDistToEye/_}d.fromScaling(s,[u,u,u]),d.mul(this.getMatrix(),n,s),c.sub(t,t,e),c.normalize(t,t),this._rotateInLocal||this._translateInLocal?(d.getScale(r,h),
d.fromScaling(a,r),d.invert(a,a),d.mul(i,h,a),i[12]=i[13]=i[14]=0,this._translateInLocal&&(d.copy(this._translateNode.getMatrix(),i),d.copy(this._planeNode.getMatrix(),i)),this._rotateInLocal&&(d.copy(this._rotateNode.getMatrix(),i),d.invert(i,i),c.transformMat4(t,t,i))):d.identity(this._rotateNode.getMatrix()),this.updateArcRotation(t),this._rotateNode.dirtyBound(),this._translateNode.dirtyBound(),this._planeNode.dirtyBound(),this._isEditing&&d.copy(this._showAngle.getMatrix(),this._hoverNode.getMatrix())}}}(),computeNearestIntersection:function(){var t=function(t,e){return t._ratio-e._ratio},e=u.create();return function(r,i){S(e,r);var n=this._viewer,a=this._canvas,s=e[0]*(n._canvasWidth/a.clientWidth),o=(a.clientHeight-e[1])*(n._canvasHeight/a.clientHeight),h=this._viewer.computeIntersections(s,o,i);if(0!==h.length)return h.sort(t),h[0]}}(),setOnlyGizmoPicking:function(){this._viewer.getCamera().addChild(this),this._viewer.getSceneData().setNodeMask(0),this.setNodeMask(-1)},setOnlyScenePicking:function(){this._viewer.getCamera().removeChild(this),this._viewer.getSceneData().setNodeMask(-1),this.setNodeMask(M.NO_PICK)},pickGizmo:function(t,e){this.setOnlyGizmoPicking();var r=this.computeNearestIntersection(t,e);return this.setOnlyScenePicking(),r},getCanvasPositionFromWorldPoint:function(){var t=d.create();return function(e,r){var i=this._viewer.getCamera(),n=r;i.getViewport()?i.getViewport().computeWindowMatrix(t):d.identity(t),d.mul(t,t,i.getProjectionMatrix()),this.getReferenceFrame()===m.RELATIVE_RF&&d.mul(t,t,i.getViewMatrix()),c.transformMat4(n,e,t);var a=this._viewer,s=this._canvas;return n[0]=n[0]/(a._canvasWidth/s.clientWidth),n[1]=s.clientHeight-n[1]/(a._canvasHeight/s.clientHeight),n}}(),onMouseDown:function(t){if(S(this._downCanvasCoord,t),this._hoverNode&&this._attachedNode){this._enableMouseBack=this._eventMouse.getEnable(),this._eventMouse.setEnable(!1),this.saveEditMatrices();var e=this._hoverNode.getParents()[0].getNodeMask();this._isEditing=!0,e&M.PICK_ARC?(this._translateNode.setNodeMask(0),this._planeNode.setNodeMask(0),this.startRotateEdit(t)):e&M.PICK_ARROW?(this._rotateNode.setNodeMask(0),this._planeNode.setNodeMask(0),this.startTranslateEdit(t)):e&M.PICK_PLANE&&(this._rotateNode.setNodeMask(0),this._translateNode.setNodeMask(0),this.startPlaneEdit(t))}},saveEditMatrices:function(){d.copy(this._editLocal,this._attachedNode.getMatrix());var t=this._attachedNode.getWorldMatrices()[0];d.fromTranslation(this._editWorldTrans,c.fromValues(t[12],t[13],t[14])),d.copy(this._editWorldScaleRot,t),this._editWorldScaleRot[12]=this._editWorldScaleRot[13]=this._editWorldScaleRot[14]=0,d.invert(this._editInvWorldScaleRot,this._editWorldScaleRot)},startRotateEdit:function(t){var e=this._rotateNode.getWorldMatrices()[0],r=c.create();c.transformMat4(r,r,e),this.getCanvasPositionFromWorldPoint(r,r);var i=this.pickGizmo(t,this._hoverNode.getNodeMask()|M.PICK_ARC);if(i){var n=0===this._hoverNode._nbAxis?-1:1,a=c.create();a[0]=n*i._localIntersectionPoint[1],a[1]=-n*i._localIntersectionPoint[0],a[2]=i._localIntersectionPoint[2];var s=c.create();c.transformMat4(s,a,this._hoverNode.getMatrix()),c.transformMat4(s,s,e),this.getCanvasPositionFromWorldPoint(s,s);var o=this._editLineDirection;u.sub(o,s,r),u.normalize(o,o),this._showAngle.setNodeMask(M.NO_PICK),i._localIntersectionPoint[2]=0;var h=this._showAngle.getStateSet();h.getUniform("uAngle").setFloat(0),h.getUniform("uBase").setVec3(c.normalize(i._localIntersectionPoint,i._localIntersectionPoint)),S(this._editLineOrigin,t)}},startTranslateEdit:function(t){var e=this._editLineOrigin,r=this._editLineDirection,i=this._translateNode.getWorldMatrices()[0];d.getTranslation(e,i),c.init(r),r[this._hoverNode._nbAxis]=1,this._translateInLocal&&(c.transformMat4(r,r,this._editWorldScaleRot),c.normalize(r,r)),c.add(r,e,r),this.getCanvasPositionFromWorldPoint(e,e),this.getCanvasPositionFromWorldPoint(r,r),u.sub(r,r,e),u.normalize(r,r);var n=this._editOffset;S(n,t),u.sub(n,n,e)},startPlaneEdit:function(t){var e=this._editLineOrigin,r=this._planeNode.getWorldMatrices()[0];d.getTranslation(e,r),this.getCanvasPositionFromWorldPoint(e,e);var i=this._editOffset;S(i,t),u.sub(i,i,e)},drawLineCanvasDebug:function(t,e,r,i){this._debugNode.setNodeMask(M.NO_PICK);var n=this._debugNode.getChildren()[0].getAttributes().Vertex;n.getElements()[0]=t/this._canvas.clientWidth*2-1,n.getElements()[1]=(this._canvas.clientHeight-e)/this._canvas.clientHeight*2-1,n.getElements()[2]=r/this._canvas.clientWidth*2-1,n.getElements()[3]=(this._canvas.clientHeight-i)/this._canvas.clientHeight*2-1,n.dirty()},pickAndSelect:function(t){this.setNodeMask(0);var e=this.computeNearestIntersection(t,this._tmask);this._autoInsertMT?this.attachToGeometry(e?e._nodePath[e._nodePath.length-1]:e):this.attachToNodePath(e?e._nodePath:e)},onMouseUp:function(t){this._enableMouseBack&&(this._enableMouseBack=!1,this._eventMouse.setEnable(!0),this._eventMouse.mouseup(t)),this._debugNode&&this._debugNode.setNodeMask(0);var e=u.create();S(e,t),0===u.distance(e,this._downCanvasCoord)&&this.pickAndSelect(t),this._showAngle.setNodeMask(0),this._isEditing=!1,this._hoverNode&&this.updateGizmoMask()},onMouseMove:function(t){if(this._attachedNode){var e;if(this._isEditing===!1)return e=this.pickGizmo(t,M.PICK_GIZMO),void this.onNodeHovered(e);if(this._hoverNode){var r=this._hoverNode.getParents()[0];r===this._rotateNode?this.updateRotateEdit(t):r===this._translateNode?this.updateTranslateEdit(t):r===this._planeNode&&this.updatePlaneEdit(t)}}},updateRotateEdit:function(){var t=d.create(),e=u.create(),r=c.fromValues(1,0,0),i=c.fromValues(0,1,0),n=c.fromValues(0,0,1);return function(a){var s=this._editLineOrigin,o=this._editLineDirection;S(e,a),u.sub(e,e,s);var h=u.dot(e,o);this._debugNode&&this.drawLineCanvasDebug(s[0],s[1],s[0]+o[0]*h,s[1]+o[1]*h);var c=7*h/Math.min(this._canvas.clientWidth,this._canvas.clientHeight);c%=2*Math.PI;var l=this._hoverNode._nbAxis;0===l?d.fromRotation(t,-c,r):1===l?d.fromRotation(t,-c,i):2===l&&d.fromRotation(t,-c,n),this._showAngle.getOrCreateStateSet().getUniform("uAngle").setFloat(0===l?-c:c),this._rotateInLocal||(d.mul(t,this._editInvWorldScaleRot,t),d.mul(t,t,this._editWorldScaleRot)),d.mul(this._attachedNode.getMatrix(),this._editLocal,t),this._attachedNode.dirtyBound()}}(),updateTranslateEdit:function(){var t=u.create(),e=c.create();return function(r){var i=this._editLineOrigin,n=this._editLineDirection;S(t,r),u.sub(t,t,i),u.sub(t,t,this._editOffset);var a=u.dot(t,n);t[0]=i[0]+n[0]*a,t[1]=i[1]+n[1]*a,this._debugNode&&this.drawLineCanvasDebug(i[0],i[1],t[0],t[1]);var s=this._viewer,o=this._canvas,h=t[0]*(s._canvasWidth/o.clientWidth),l=(o.clientHeight-t[1])*(s._canvasHeight/o.clientHeight);if(this._lsi.reset(),this._lsi.setTestPlane(!1),this._lsi.set(c.set(this._origIntersect,h,l,0),c.set(this._dstIntersect,h,l,1)),this._iv.reset(),this._iv.setTraversalMask(this._hoverNode.getNodeMask()),d.copy(this.getMatrix(),this._editWorldTrans),this.setOnlyGizmoPicking(),this._viewer._camera.accept(this._iv),this.setOnlyScenePicking(),this._translateInLocal){d.getScale(e,this._editInvWorldScaleRot);var _=this._lsi.getTranslateDistance();c.mul(e,e,_)}else c.transformMat4(e,this._lsi.getTranslateDistance(),this._editInvWorldScaleRot);d.translate(this._attachedNode.getMatrix(),this._editLocal,e),this._attachedNode.dirtyBound()}}(),updatePlaneEdit:function(){var t=u.create(),e=c.create();return function(r){S(t,r),u.sub(t,t,this._editOffset);var i=this._viewer,n=this._canvas,a=t[0]*(i._canvasWidth/n.clientWidth),s=(n.clientHeight-t[1])*(i._canvasHeight/n.clientHeight);if(this._lsi.reset(),this._lsi.setTestPlane(!0),this._lsi.set(c.set(this._origIntersect,a,s,0),c.set(this._dstIntersect,a,s,1)),this._iv.reset(),this._iv.setTraversalMask(this._hoverNode.getNodeMask()),d.copy(this.getMatrix(),this._editWorldTrans),this.setOnlyGizmoPicking(),this._viewer._camera.accept(this._iv),this.setOnlyScenePicking(),this._translateInLocal){d.getScale(e,this._editInvWorldScaleRot);var o=this._lsi.getTranslateDistance();c.mul(e,e,o)}else c.transformMat4(e,this._lsi.getTranslateDistance(),this._editInvWorldScaleRot);d.translate(this._attachedNode.getMatrix(),this._editLocal,e),this._attachedNode.dirtyBound()}}()}),"osgUtil","NodeGizmo"),t.exports=M},function(t,e,r){"use strict";var i,n,a,s=r(48),o=r(36),h=r(46),u=r(91),c=r(45),l=r(104),d=r(122),_=["#ifdef GL_ES","precision highp float;","#endif"].join("\n"),f=function(){if(i)return i;var t="#define SHADER_NAME GizmoLine3D",e=[_,"attribute vec3 Vertex;","uniform mat4 uModelViewMatrix;","uniform mat4 uProjectionMatrix;",t,"","void main(void) {","  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex, 1.0);","}"].join("\n"),r=[_,"uniform vec4 uColor;",t,"","void main(void) {","  gl_FragColor = uColor;","}"].join("\n");return i=new l(new d(d.VERTEX_SHADER,e),new d(d.FRAGMENT_SHADER,r))},g=function(){if(n)return n;var t="#define SHADER_NAME GizmoLine2D",e=[_,"attribute vec2 Vertex;",t,"","void main(void) {","  gl_Position = vec4(Vertex, 0.0, 1.0);","}"].join("\n"),r=[_,t,"","void main(void) {","  gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);","}"].join("\n");return n=new l(new d(d.VERTEX_SHADER,e),new d(d.FRAGMENT_SHADER,r))},p=function(){if(a)return a;var t="#define SHADER_NAME GizmoQuadCircle",e=[_,"attribute vec3 Vertex;","uniform mat4 uModelViewMatrix;","uniform mat4 uProjectionMatrix;","varying vec3 vViewVertex;",t,"","void main(void) {","  vViewVertex = Vertex;","  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex, 1.0);","}"].join("\n"),r=[_,"uniform float uAngle;","uniform vec3 uBase;","varying vec3 vViewVertex;","const float PI = 3.14159265358979323846264;","const float PI2 = PI * 2.0;",t,"","void main(void) {","  if(length(vViewVertex) > 0.5)","    discard;","  vec3 vn = normalize(vViewVertex);","  float angle = atan(uBase.y * vn.x - uBase.x * vn.y, dot(uBase, vn));","  if(angle > 0.0) {","    if(uAngle >= 0.0 && angle > uAngle) discard;","    if(uAngle < -PI && angle < uAngle + PI2) discard;","    if(uAngle < 0.0 && uAngle > -PI) discard;","  }","  if(angle < 0.0) {","    if(uAngle <= 0.0 && angle < uAngle) discard;","    if(uAngle > PI && angle > uAngle - PI2) discard;","    if(uAngle > 0.0 && uAngle < PI) discard;","  }","  gl_FragColor = vec4(1.0, 1.0, 0.0, 0.5);","}"].join("\n");return a=new l(new d(d.VERTEX_SHADER,e),new d(d.FRAGMENT_SHADER,r))},m=function(){var t=new o;t.getAttributes().Vertex=new s(s.ARRAY_BUFFER,new Float32Array(4),2);var e=new u(h.LINES,0,2);return t.getPrimitives().push(e),t.getOrCreateStateSet().setAttributeAndModes(g()),t},v=function(t,e,r,i,n){var a=void 0!==t?t:1,u=void 0!==e?e:.2,l=void 0!==r?r:6,d=void 0!==i?i:64,_=void 0!==n?n:2*Math.PI,g=(l+1)*(d+1),p=l*d*2,m=new o,v=new Float32Array(3*g),S=new Uint16Array(3*p);_=_||2*Math.PI;var x=0,b=0,y=0,M=0;for(M=0;M<=l;++M)for(y=0;y<=d;++y){var T=y/d*_,A=M/l*Math.PI*2;b=3*x,v[b]=(a+u*Math.cos(A))*Math.cos(T),v[b+1]=(a+u*Math.cos(A))*Math.sin(T),v[b+2]=u*Math.sin(A),x++}for(x=0,M=1;M<=l;++M)for(y=1;y<=d;++y)b=6*x,S[b]=(d+1)*M+y-1,S[b+1]=S[b+3]=(d+1)*(M-1)+y-1,S[b+2]=S[b+5]=(d+1)*M+y,S[b+4]=(d+1)*(M-1)+y,x++;return m.getAttributes().Vertex=new s(s.ARRAY_BUFFER,v,3),m.getOrCreateStateSet().setAttributeAndModes(f()),m.getPrimitives().push(new c(h.TRIANGLES,new s(s.ELEMENT_ARRAY_BUFFER,S,1))),m},S=function(t,e,r,i,n,a,u){var l=void 0!==t?t:1,d=void 0!==e?e:1,_=void 0!==r?r:5,g=void 0!==i?i:32,p=void 0!==n?n:1,m=void 0===a||a,v=void 0===u||u;m=m&&l>0,v=v&&d>0;var S=.5*_,x=(p+1)*(g+1),b=p*g*2;m&&(x+=1,b+=g),v&&(x+=1,b+=g);var y=new o,M=new Float32Array(3*x),T=new Uint16Array(3*b),A=0,C=0,I=0,w=0;for(I=0;I<=p;I++){var E=I/p,N=E*(d-l)+l;for(w=0;w<=g;w++){var R=w/g;C=3*A,M[C]=N*Math.sin(R*Math.PI*2),M[C+1]=N*Math.cos(R*Math.PI*2),M[C+2]=-E*_+S,A++}}for(A=0,w=0;w<g;w++)for(I=0;I<p;I++)C=6*A,T[C]=(g+1)*I+w,T[C+1]=T[C+3]=(g+1)*(I+1)+w,T[C+2]=T[C+5]=(g+1)*I+w+1,T[C+4]=(g+1)*(I+1)+w+1,A++;A*=2;var F;if(m)for(F=(v?M.length-6:M.length-3)/3,M[3*F+2]=S,w=0;w<g;w++)C=3*A,T[C]=w,T[C+1]=w+1,T[C+2]=F,A++;if(v){F=(M.length-3)/3,M[3*F+2]=-S;var P=(g+1)*I;for(w=0;w<g;w++)C=3*A,T[C]=P+w+1,T[C+1]=P+w,T[C+2]=F,A++}return y.getAttributes().Vertex=new s(s.ARRAY_BUFFER,M,3),y.getOrCreateStateSet().setAttributeAndModes(f()),y.getPrimitives().push(new c(h.TRIANGLES,new s(s.ELEMENT_ARRAY_BUFFER,T,1))),y},x=function(t,e,r){for(var i=new o,n=new Float32Array(3*t),a=r||2*Math.PI,c=0;c<t;++c){var l=3*c,d=a*c/t;n[l]=Math.cos(d)*e,n[l+1]=Math.sin(d)*e}i.getAttributes().Vertex=new s(s.ARRAY_BUFFER,n,3);var _=new u(h.LINE_STRIP,0,t);return i.getOrCreateStateSet().setAttributeAndModes(f()),i.getPrimitives().push(_),i},b=function(t,e){var r=t?.5*t:.5,i=e?.5*e:.5,n=new o,a=new Float32Array(12);a[0]=-r,a[1]=-i,a[3]=r,a[4]=-i,a[6]=-r,a[7]=i,a[9]=r,a[10]=i,n.getAttributes().Vertex=new s(s.ARRAY_BUFFER,a,3);var c=new u(h.TRIANGLE_STRIP,0,4);return n.getOrCreateStateSet().setAttributeAndModes(f()),n.getPrimitives().push(c),n},y=function(){var t=b();return t.getOrCreateStateSet().setAttributeAndModes(p()),t},M={};M.createCircleGeometry=x,M.createCylinderGeometry=S,M.createTorusGeometry=v,M.createDebugLineGeometry=m,M.createPlaneGeometry=b,M.createQuadCircleGeometry=y,t.exports=M},function(t,e,r){"use strict";var i=r(7),n=r(15).vec3,a=r(15).mat4,s=r(167),o=r(217),h=function(){s.call(this),this._center=n.create(),this._iCenter=n.create(),this._radius=1,this._iRadius=1};i.createPrototypeObject(h,i.objectInherit(s.prototype,{set:function(t,e){n.copy(this._center,t),n.copy(this._iCenter,t),this._radius=this._iRadius=e,this.reset()},setCenter:function(t){n.copy(this._center,t),n.copy(this._iCenter,t)},setRadius:function(t){this._radius=this._iRadius=t},intersectNode:function(t){return this.intersectBoundingSphere(t.getBoundingSphere())},intersectBoundingSphere:function(t){if(!t.valid())return!1;var e=this._iRadius+t.radius();return n.sqrDist(t.center(),this._iCenter)<=e*e},intersect:function(){var t=new o;return function(e,r){t.setGeometry(r),t.setIntersectionVisitor(e),t.setIntersector(this),t.set(this._iCenter,this._iRadius);var i=r.getShape();i?i.intersect(t,i.getNodes()[0]):(r.computeTransformedVertices&&t.setVertices(r.computeTransformedVertices()),t.apply(r)),t.reset()}}(),setCurrentTransformation:function(){var t=n.create();return function(e){a.invert(e,e),n.transformMat4(this._iCenter,this._center,e),a.getScale(t,e);var r=t[0],i=t[1],s=t[2],o=r>i?r>s?r:s:i>s?i:s;this._iRadius=this._radius*o}}()}),"osgUtil","SphereIntersector"),t.exports=h},function(t,e,r){"use strict";var i=r(7),n=r(15).vec3,a=r(170),s=function(){a.Intersection.call(this),this._localIntersectionNormal=n.clone(n.ONE),this._i1=-1,this._i2=-1,this._i3=-1,this._r1=0,this._r2=0,this._r3=0},o=function(){a.apply(this),this._center=void 0,this._radius=0};i.createPrototypeObject(o,i.objectInherit(a.prototype,{set:function(t,e){this._center=t,this._radius=e},enter:function(t){for(var e=this._radius*this._radius,r=0,i=t.getMin(),n=t.getMax(),a=0,s=0;s<3;s++)this._center[s]<i[s]?(a=this._center[s]-i[s],r+=a*a):this._center[s]>n[s]&&(a=this._center[s]-n[s],r+=a*a);return r<=e},intersectPoint:function(t,e){var r=n.sqrDist(t,this._center);if(!(r>this._radius*this._radius)){var i=this.initIntersection(new s);i._i1=e,i._r1=1,n.copy(i._localIntersectionPoint,t),i._ratio=Math.sqrt(r)/this._radius}},intersectLine:function(){var t=n.create(),e=n.create();return function(r,i,a,o){n.sub(t,this._center,r),n.sub(e,i,r);var h=n.dot(t,e)/n.sqrLen(e),u=1;if(u=h<0?n.sqrLen(t):h>1?n.sqrDist(this._center,i):n.sqrLen(n.scaleAndAdd(t,t,e,-h)),!(u>this._radius*this._radius)){var c=this.initIntersection(new s);c._i1=a,c._i2=o,c._r1=1-h,c._r2=h,n.scaleAndAdd(c._localIntersectionPoint,r,e,h),c._ratio=Math.sqrt(u)/this._radius}}}(),intersectTriangle:function(){var t=n.create(),e=n.create(),r=n.create();return function(i,a,o,h,u,c){if(!this._limitOneIntersection||!this._hit){n.sub(t,a,i),n.sub(e,o,i);var l=n.sqrLen(t),d=n.dot(t,e),_=n.sqrLen(e);n.sub(r,i,this._center);var f=n.dot(r,t),g=n.dot(r,e),p=n.sqrLen(r),m=Math.abs(l*_-d*d);if(!(m<1e-10)){var v,S=d*g-_*f,x=d*f-l*g,b=4;if(S+x<=m)if(S<0)x<0?(b=4,f<0?(x=0,-f>=l?(S=1,v=l+2*f+p):(S=-f/l,v=f*S+p)):(S=0,g>=0?(x=0,v=p):-g>=_?(x=1,v=_+2*g+p):(x=-g/_,v=g*x+p))):(b=3,S=0,g>=0?(x=0,v=p):-g>=_?(x=1,v=_+2*g+p):(x=-g/_,v=g*x+p));else if(x<0)b=5,x=0,f>=0?(S=0,v=p):-f>=l?(S=1,v=l+2*f+p):(S=-f/l,v=f*S+p);else{b=0;var y=1/m;S*=y,x*=y,v=S*(l*S+d*x+2*f)+x*(d*S+_*x+2*g)+p}else{var M,T,A,C;S<0?(b=2,M=d+f,T=_+g,T>M?(A=T-M,C=l-2*d+_,A>=C?(S=1,x=0,v=l+2*f+p):(S=A/C,x=1-S,v=S*(l*S+d*x+2*f)+x*(d*S+_*x+2*g)+p)):(S=0,T<=0?(x=1,v=_+2*g+p):g>=0?(x=0,v=p):(x=-g/_,v=g*x+p))):x<0?(b=6,M=d+g,T=l+f,T>M?(A=T-M,C=l-2*d+_,A>=C?(x=1,S=0,v=_+2*g+p):(x=A/C,S=1-x,v=S*(l*S+d*x+2*f)+x*(d*S+_*x+2*g)+p)):(x=0,T<=0?(S=1,v=l+2*f+p):f>=0?(S=0,v=p):(S=-f/l,v=f*S+p))):(b=1,A=_+g-d-f,A<=0?(S=0,x=1,v=_+2*g+p):(C=l-2*d+_,A>=C?(S=1,x=0,v=l+2*f+p):(S=A/C,x=1-S,v=S*(l*S+d*x+2*f)+x*(d*S+_*x+2*g)+p)))}if(!(v>this._radius*this._radius)){var I=n.create(),w=this.initIntersection(new s);w._i1=h,w._i2=u,w._i3=c,w._r1=1-S-x,w._r2=S,w._r3=x;var E=w._localIntersectionPoint;n.scaleAndAdd(E,n.scaleAndAdd(E,i,t,S),e,x),n.cross(w._localIntersectionNormal,t,e),n.normalize(I,w._localIntersectionNormal),w._ratio=Math.sqrt(v)/this._radius,w._zone=b}}}}}()}),"osgUtil","SphereIntersectFunctor"),t.exports=o},function(t,e,r){"use strict";var i=r(7),n=r(48),a=r(36),s=r(31),o=r(46),h=r(15).vec3,u=i,c=function(){s.call(this),this._T=void 0,this._B=void 0,this._N=void 0,this._texCoordUnit=0};i.createPrototypeObject(c,i.objectInherit(s.prototype,{apply:function(t){t.getTypeID()===a.getTypeID()?this.generate(t,this._texCoordUnit):this.traverse(t)},setTexCoordUnit:function(t){this._texCoordUnit=t},computePrimitiveSet:function(t,e){if(e.getIndices){var r,i=e.getNumIndices(),n=t.getAttributes().Vertex,a=t.getAttributes().Normal,s=t.getAttributes()["TexCoord"+this._texCoordUnit];if(e.getMode()===o.TRIANGLES)for(r=0;r<i;r+=3)this.compute(e,n,a,s,r,r+1,r+2);else if(e.getMode()===o.TRIANGLE_STRIP)for(r=0;r<i-2;++r)r%2===0?this.compute(e,n,a,s,r,r+1,r+2):this.compute(e,n,a,s,r+1,r,r+2)}},generate:function(t,e){this._texCoordUnit=e,void 0===this._texCoordUnit&&(this._texCoordUnit=0);var r=t.getAttributes().Vertex.getElements().length;this._T=new u.Float32Array(r),this._B=new u.Float32Array(r),this._N=new u.Float32Array(r),t.getPrimitiveSetList().forEach(function(e){this.computePrimitiveSet(t,e)},this);for(var i=r/3,a=new u.Float32Array(4*i),s=h.create(),o=h.create(),c=h.create(),l=0;l<i;l++){var d=this._T.subarray(3*l,3*l+3),_=this._N.subarray(3*l,3*l+3),f=this._B.subarray(3*l,3*l+3);h.normalize(_,_);var g=h.dot(_,d);h.scale(o,_,g),h.sub(s,d,o),h.normalize(c,s),h.cross(s,_,d);var p=h.dot(s,f);p=p<0?-1:0,a[4*l]=c[0],a[4*l+1]=c[1],a[4*l+2]=c[2],a[4*l+3]=p}t.getAttributes().Normal.setElements(this._N),t.getAttributes().Tangent=new n("ARRAY_BUFFER",a,4)},compute:function(t,e,r,i,n,a,s){var o,u,c=t.index(n),l=t.index(a),d=t.index(s),_=e.getElements().subarray(3*c,3*c+3),f=e.getElements().subarray(3*l,3*l+3),g=e.getElements().subarray(3*d,3*d+3),p=r.getElements().subarray(3*c,3*c+3),m=r.getElements().subarray(3*l,3*l+3),v=r.getElements().subarray(3*d,3*d+3),S=i.getElements().subarray(2*c,2*c+2),x=i.getElements().subarray(2*l,2*l+2),b=i.getElements().subarray(2*d,2*d+2),y=h.create(),M=h.create(),T=h.create(),A=h.create(),C=h.create(),I=h.create(),w=h.create(),E=h.create(),N=h.create();h.set(E,f[0]-_[0],x[0]-S[0],x[1]-S[1]),h.set(N,g[0]-_[0],b[0]-S[0],b[1]-S[1]),h.cross(y,E,N),0!==y[0]&&(h.normalize(y,y),u=-y[1]/y[0],o=-y[2]/y[0],C[0]+=u,M[0]+=o,I[0]+=u,T[0]+=o,w[0]+=u,A[0]+=o),h.set(E,f[1]-_[1],x[0]-S[0],x[1]-S[1]),h.set(N,g[1]-_[1],b[0]-S[0],b[1]-S[1]),h.cross(y,E,N),0!==y[0]&&(h.normalize(y,y),u=-y[1]/y[0],o=-y[2]/y[0],C[1]+=u,M[1]+=o,I[1]+=u,T[1]+=o,w[1]+=u,A[1]+=o),h.set(E,f[2]-_[2],x[0]-S[0],x[1]-S[1]),h.set(N,g[2]-_[2],b[0]-S[0],b[1]-S[1]),h.cross(y,E,N),0!==y[0]&&(h.normalize(y,y),u=-y[1]/y[0],o=-y[2]/y[0],C[2]+=u,M[2]+=o,I[2]+=u,T[2]+=o,w[2]+=u,A[2]+=o);var R,F,P,L=h.create(),O=h.create();h.cross(L,p,C),h.cross(O,L,p),R=this._T.subarray(3*c,3*c+3),h.add(R,O,R),h.cross(L,M,p),h.cross(O,p,L),F=this._B.subarray(3*c,3*c+3),h.add(F,O,F),h.cross(L,m,I),h.cross(O,L,m),R=this._T.subarray(3*l,3*l+3),h.add(R,O,R),h.cross(L,T,m),h.cross(O,m,L),F=this._B.subarray(3*l,3*l+3),h.add(F,O,F),h.cross(L,v,w),h.cross(O,L,v),R=this._T.subarray(3*d,3*d+3),h.add(R,O,R),h.cross(L,A,v),h.cross(O,v,L),F=this._B.subarray(3*d,3*d+3),h.add(F,O,F),P=this._N.subarray(3*c,3*c+3),h.add(P,p,P),P=this._N.subarray(3*l,3*l+3),h.add(P,m,P),P=this._N.subarray(3*d,3*d+3),h.add(P,v,P)}}),"osgUtil","TangentSpaceGenerator"),t.exports=c},function(t,e,r){"use strict";var i=r(54),n=r(71),a=r(15).mat4,s=r(12),o=r(104),h=r(122),u=r(123),c=r(40),l=r(11),d=r(41),_=r(15).vec2,f=r(15).vec3,g=r(15).vec4,p=r(129),m={},v=function(t,e,r,i,n){this._viewer=t,this._rttScene=e,this._hmdConfig=r,this._root=i,this._canvas=n,this._width=n.width,this._height=n.height};v.prototype={update:function(){var t=this._canvas,e=t.width,r=t.height;if(e!==this._width||r!==this._height){this._root.removeChildren();var i=this._hmdConfig;i&&i.isCardboard&&(i.hResolution=e,i.vResolution=r),this._width=e,this._height=r,m.createScene(this._viewer,this._rttScene,i,this._root)}return!0}};var S=function(t,e){this._rootView=t,this._offsetView=e};S.prototype={update:function(t){var e=t.getViewMatrix();return a.mul(e,this._offsetView,this._rootView),!0}};var x=function(t,e,r,i){var n=e.hResolution/(2*e.vResolution),s=-1-4*(.25*e.hScreenSize-.5*e.lensSeparationDistance)/e.hScreenSize,o=e.distortionK[0]+e.distortionK[1]*Math.pow(s,2)+e.distortionK[2]*Math.pow(s,4)+e.distortionK[3]*Math.pow(s,6),h=180/Math.PI*2*Math.atan2(e.vScreenSize*o,2*e.eyeToScreenDistance),u=a.perspective(a.create(),Math.PI/180*h,n,.3,1e4),c=4*(.25*e.hScreenSize-.5*e.interpupillaryDistance)/e.hScreenSize,l=4*(.25*e.hScreenSize-.5*e.lensSeparationDistance)/e.hScreenSize,d=a.create(),g=a.create();i.projectionLeft=a.mul(d,a.fromTranslation(d,f.fromValues(c,0,0)),u),i.projectionRight=a.mul(g,a.fromTranslation(g,f.fromValues(-c,0,0)),u),i.viewLeft=a.fromTranslation(a.create(),f.fromValues(t*e.interpupillaryDistance*.5,0,0)),i.viewRight=a.fromTranslation(a.create(),f.fromValues(-t*e.interpupillaryDistance*.5,0,0)),r.lensCenterLeft=_.fromValues(l,0),r.lensCenterRight=_.fromValues(-l,0),r.hmdWarpParam=e.distortionK,r.chromAbParam=e.chromaAbParameter,r.scaleIn=_.fromValues(1,1/n),r.scale=_.fromValues(1/o,1*n/o)},b=function(){var t=["","#ifdef GL_ES","precision highp float;","#endif","uniform vec2 uScale;","uniform vec2 uScaleIn;","uniform vec2 uLensCenter;","uniform vec4 uHmdWarpParam;","uniform vec4 uChromAbParam;","uniform sampler2D Texture0;","varying vec2 vTexCoord0;","void main(void) {","  vec2 uv = (vTexCoord0 * 2.0) - 1.0;","  vec2 theta = (uv - uLensCenter) * uScaleIn;","  float rSq = theta.x * theta.x + theta.y * theta.y;","  vec2 rvector = theta * (uHmdWarpParam.x + uHmdWarpParam.y * rSq + uHmdWarpParam.z * rSq * rSq + uHmdWarpParam.w * rSq * rSq * rSq);","  vec2 rBlue = rvector * (uChromAbParam.z + uChromAbParam.w * rSq);","  vec2 tcBlue = (uLensCenter + uScale * rBlue);","  tcBlue = (tcBlue + 1.0) * 0.5;","  if (any(bvec2(clamp(tcBlue, vec2(0.0, 0.0), vec2(1.0, 1.0)) - tcBlue))) {","    gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","    return;","  }","  vec2 tcGreen = uLensCenter + uScale * rvector;","  tcGreen = (tcGreen + 1.0) * 0.5;","  vec2 rRed = rvector * (uChromAbParam.x + uChromAbParam.y * rSq);","  vec2 tcRed = uLensCenter + uScale * rRed;","  tcRed = (tcRed + 1.0) * 0.5;","  gl_FragColor = vec4(texture2D(Texture0, tcRed).r, texture2D(Texture0, tcGreen).g, texture2D(Texture0, tcBlue).b, 1);","}",""].join("\n");return new o(new h(h.VERTEX_SHADER,["attribute vec3 Vertex;","varying vec2 vTexCoord0;","void main(void) {","  gl_Position = vec4(Vertex * 2.0 - 1.0, 1.0);","  vTexCoord0 = Vertex.xy;","}","","#define SHADER_NAME VRpostProcessing",""].join("\n")),new h(h.FRAGMENT_SHADER,t))},y=function(t){var e=new c;return e.setTextureSize(t[0],t[1]),e.setMinFilter("LINEAR"),e.setMagFilter("LINEAR"),e},M=function(t,e,r,n,s,o){var h=new i,u=e[0],c=e[1],_=r[0],f=r[1];n===!0?t?h.setViewport(new p(0,0,_/2,f)):h.setViewport(new p(_/2,0,_/2,f)):t?h.setViewport(new p(.5*_-u,.5*(f-c),u,c)):h.setViewport(new p(.5*_,.5*(f-c),u,c)),a.ortho(h.getProjectionMatrix(),-.5,.5,-.5,.5,-5,5),h.setRenderOrder(i.NESTED_RENDER,0),h.setReferenceFrame(l.ABSOLUTE_RF);var g=h.getOrCreateStateSet();return g.setTextureAttributeAndModes(0,s),g.setAttributeAndModes(b()),g.addUniform(d.createFloat2(o.scale,"uScale")),g.addUniform(d.createFloat2(o.scaleIn,"uScaleIn")),g.addUniform(d.createFloat2(t?o.lensCenterLeft:o.lensCenterRight,"uLensCenter")),g.addUniform(d.createFloat4(o.hmdWarpParam,"uHmdWarpParam")),g.addUniform(d.createFloat4(o.chromAbParam,"uChromAbParam")),h},T=function(t,e){var r=new i;return r.setName("rtt camera"),r.setViewport(new p(0,0,t.getWidth(),t.getHeight())),r.setProjectionMatrix(e),r.setClearColor(g.fromValues(.3,.3,.3,0)),r.setRenderOrder(i.POST_RENDER,0),r.attachTexture(n.COLOR_ATTACHMENT0,t),r.attachRenderBuffer(n.DEPTH_ATTACHMENT,n.DEPTH_COMPONENT16),r.setReferenceFrame(l.ABSOLUTE_RF),r};m.createScene=function(t,e,r,i,n){var a=m.getDefaultConfig(r),o=_.fromValues(.5*a.hResolution,a.vResolution),h=_.fromValues(.5*a.hResolution,a.vResolution),c=t.getCamera().getViewport(),l=_.fromValues(c.width(),c.height()),d=t.getGraphicContext().canvas;a.isCardboard&&(l[0]=d.width,l[1]=d.height);var f=void 0!==n?n:1,g={},p={};x(f,a,g,p);var b=t.getCamera().getViewMatrix(),A=i||new s;A.addUpdateCallback(new v(t,e,r,A,d));var C=y(o),I=T(C,p.projectionLeft),w=M(!0,h,l,a.isCardboard,C,g);I.addUpdateCallback(new S(b,p.viewLeft));var E=y(o),N=T(E,p.projectionRight),R=M(!1,h,l,a.isCardboard,E,g);return N.addUpdateCallback(new S(b,p.viewRight)),I.addChild(e),N.addChild(e),w.addChild(u.createTexturedFullScreenFakeQuadGeometry()),R.addChild(u.createTexturedFullScreenFakeQuadGeometry()),A.addChild(I),A.addChild(N),A.addChild(w),A.addChild(R),A},m.getDefaultConfig=function(t){var e={hResolution:1920,vResolution:1080,hScreenSize:.1296,vScreenSize:.0729,interpupillaryDistance:.064,lensSeparationDistance:.0635,eyeToScreenDistance:.04,distortionK:g.fromValues(1,.22,.13,.02),chromaAbParameter:g.fromValues(.996,-.004,1.014,0),isCardboard:!1};return 2===t||void 0===t?e:1===t?(e.hResolution=1280,e.vResolution=800,e.hScreenSize=.14976,e.vScreenSize=.0936,e.lensSeparationDistance=.064,e.eyeToScreenDistance=.041,e.distortionK=g.fromValues(1,.22,.24,0),e):(void 0!==t.hResolution&&(e.hResolution=t.hResolution),void 0!==t.vResolution&&(e.vResolution=t.vResolution),void 0!==t.hScreenSize&&(e.hScreenSize=t.hScreenSize),void 0!==t.vScreenSize&&(e.vScreenSize=t.vScreenSize),void 0!==t.interpupillaryDistance&&(e.interpupillaryDistance=t.interpupillaryDistance),void 0!==t.lensSeparationDistance&&(e.lensSeparationDistance=t.lensSeparationDistance),void 0!==t.eyeToScreenDistance&&(e.eyeToScreenDistance=t.eyeToScreenDistance),void 0!==t.distortionK&&(e.distortionK=t.distortionK),void 0!==t.chromaAbParameter&&(e.chromaAbParameter=t.chromaAbParameter),void 0!==t.isCardboard&&(e.isCardboard=t.isCardboard),e)},t.exports=m},function(t,e,r){"use strict";var i=r(54),n=r(71),a=r(15).mat4,s=r(12),o=r(104),h=r(122),u=r(123),c=r(40),l=r(11),d=r(41),_=r(15).vec3,f=r(15).vec4,g=r(129),p=function(t,e){this._rootView=t,this._offsetView=e};p.prototype={update:function(t){var e=t.getViewMatrix();return a.mul(e,this._offsetView,this._rootView),!0}};var m=function(t){var e=new c;return e.setTextureSize(t.width,t.height),e.setMinFilter("LINEAR"),e.setMagFilter("LINEAR"),e},v=function(){var t=["#ifdef GL_ES","   precision highp float;","#endif","varying vec2 vTexCoord0;","uniform sampler2D TextureLeft;","uniform sampler2D TextureRight;","void main() {","   if (vTexCoord0.x < 0.5)","       gl_FragColor = texture2D(TextureLeft, vec2(vTexCoord0.x * 2.0, vTexCoord0.y));","   else","       gl_FragColor = texture2D(TextureRight, vec2(vTexCoord0.x * 2.0 - 1.0, vTexCoord0.y));","}"].join("\n");return new o(new h(h.VERTEX_SHADER,["attribute vec3 Vertex;","varying vec2 vTexCoord0;","void main(void) {","  gl_Position = vec4(Vertex * 2.0 - 1.0, 1.0);","  vTexCoord0 = Vertex.xy;","}","","#define SHADER_NAME VRpostProcessing",""].join("\n")),new h(h.FRAGMENT_SHADER,t))},S=function(t,e,r){var n=new i;n.setViewport(r),n.setRenderOrder(i.NESTED_RENDER,0),n.setReferenceFrame(l.ABSOLUTE_RF),a.ortho(n.getProjectionMatrix(),0,1,0,1,-5,5);var s=n.getOrCreateStateSet();return s.addUniform(d.createInt(0,"TextureLeft")),s.addUniform(d.createInt(1,"TextureRight")),s.setTextureAttributeAndModes(0,t),s.setTextureAttributeAndModes(1,e),s.setAttributeAndModes(v()),n.addChild(u.createTexturedFullScreenFakeQuadGeometry()),n},x=function(t,e){var r=new i;return r.setName("rtt camera"),r.setViewport(new g(0,0,t.getWidth(),t.getHeight())),r.setProjectionMatrix(e),r.setClearColor(f.fromValues(.3,.3,.3,0)),r.setRenderOrder(i.POST_RENDER,0),r.attachTexture(n.COLOR_ATTACHMENT0,t),r.attachRenderBuffer(n.DEPTH_ATTACHMENT,n.DEPTH_COMPONENT16),r.setReferenceFrame(l.ABSOLUTE_RF),r},b={};b.createScene=function(t,e,r,i,n){var o=i||new s,h=void 0!==n?n:1,u=r.getEyeParameters("left"),c=r.getEyeParameters("right"),l=new window.VRFrameData;r.getFrameData(l);var d=a.fromTranslation(a.create(),_.fromValues(-h*u.offset[0],u.offset[1],u.offset[2])),f=a.fromTranslation(a.create(),_.fromValues(-h*c.offset[0],c.offset[1],c.offset[2])),g={width:Math.max(u.renderWidth,c.renderWidth),height:Math.max(u.renderHeight,c.renderHeight)},v=m(g),b=m(g),y=x(v,l.leftProjectionMatrix),M=x(b,l.rightProjectionMatrix),T=t.getCamera().getViewMatrix();y.addUpdateCallback(new p(T,d)),M.addUpdateCallback(new p(T,f));var A=S(v,b,t.getCamera().getViewport());return y.addChild(e),M.addChild(e),o.addChild(y),o.addChild(M),o.addChild(A),o},t.exports=b},function(t,e,r){"use strict";var i=r(211),n=r(212),a=r(222),s=r(223),o=r(213),h={};h.Renderer=i,h.View=n,h.Viewer=a,h.EventProxy=s,h.Scene=o,t.exports=h},function(module,exports,__webpack_require__){"use strict";var Notify=__webpack_require__(9),mat4=__webpack_require__(15).mat4,Options=__webpack_require__(39),P=__webpack_require__(95),Timer=__webpack_require__(8),TimerGPU=__webpack_require__(131),UpdateVisitor=__webpack_require__(128),MACROUTILS=__webpack_require__(7),GLObject=__webpack_require__(43),FrameBufferObject=__webpack_require__(71),BufferArray=__webpack_require__(48),VertexArrayObject=__webpack_require__(49),Shader=__webpack_require__(122),Program=__webpack_require__(104),Texture=__webpack_require__(40),OrbitManipulator=__webpack_require__(174),EventProxy=__webpack_require__(223),View=__webpack_require__(212),WebGLUtils=__webpack_require__(38),WebGLDebugUtils=__webpack_require__(230),requestFile=__webpack_require__(149),Stats=__webpack_require__(231),defaultStats=__webpack_require__(236),glStats=__webpack_require__(237),browserStats=__webpack_require__(238),getGLSLOptimizer=function(){return new P(function(resolve,reject){window.deferOptimizeGLSL=resolve;var mod=["        var Module = {","            preRun: [],","            postRun: [ function () {",'                var func = Module.cwrap( "optimize_glsl", "string", [ "string", "number", "number" ] );',"                window.deferOptimizeGLSL( func );","            } ],","            print: function ( text ) {","                Notify.debug( text );","            },","            printErr: function ( text ) {","                Notify.debug( text );","            },","            setStatus: function ( text ) {","                Notify.debug( text );","            },","            totalDependencies: 0,","            monitorRunDependencies: function ( left ) {","                this.totalDependencies = Math.max( this.totalDependencies, left );",'                Module.setStatus( left ? "GLSL optimizer preparing... (" + ( this.totalDependencies - left ) + "/" + this.totalDependencies + ")" : "All downloads complete." );',"            },",'            memoryInitializerPrefixURL: "https://raw.githubusercontent.com/zz85/glsl-optimizer/gh-pages/"',"        };"].join("\n");
Notify.log("try to load glsl optimizer");var url="https://raw.githubusercontent.com/zz85/glsl-optimizer/gh-pages/glsl-optimizer.js",promise=requestFile(url);promise.then(function(script){eval(mod+script)}).catch(function(){reject()})})},Viewer=function(t,e,r){View.call(this),this._startTick=Timer.instance().tick(),this._stats=void 0,this._done=!1,this._runPromise=P.resolve(),this._canvas=t;var i=this.initOptions(e),n=this.initWebGLContext(t,i,r);if(!n)throw"No WebGL implementation found";this.initDeviceEvents(i,t),this.initRun(i),this._updateVisitor=new UpdateVisitor,this.setUpView(n.canvas,i),this.initStats(i,t),this._hmd=null,this._requestAnimationFrame=window.requestAnimationFrame.bind(window),this._options=i,this._contextLost=!1,this._forceRestoreContext=!0,this.renderBinded=this.render.bind(this)};MACROUTILS.createPrototypeObject(Viewer,MACROUTILS.objectInherit(View.prototype,{initDeviceEvents:function(t,e){var r=t.mouseEventNode||e,i=t.EventBackend||{};t.EventBackend||(t.EventBackend=i),i.StandardMouseKeyboard=t.EventBackend.StandardMouseKeyboard||{};var n=i.StandardMouseKeyboard.mouseEventNode||r;i.StandardMouseKeyboard.mouseEventNode=n,i.StandardMouseKeyboard.keyboardEventNode=i.StandardMouseKeyboard.keyboardEventNode||document,"ontouchstart"in window&&(i.Hammer=i.Hammer||{},i.Hammer.eventNode=i.Hammer.eventNode||r),i.GamePad=i.GamePad||{},this._eventProxy=this.initEventProxy(t)},initOptions:function(t){var e=new Options;return t&&e.extend(t),e.extendWithOptionsURL(),e.getBoolean("traceLogCall")===!0&&(Notify.traceLogCall=!0),e.getBoolean("enableFrustumCulling")===!0&&this.getCamera().getRenderer().getCullVisitor().setEnableFrustumCulling(!0),e},initWebGLContext:function(t,e,r){e.get("SimulateWebGLLostContext")&&(t=WebGLDebugUtils.makeLostContextSimulatingCanvas(t),t.loseContextInNCalls(e.get("SimulateWebGLLostContext")),this._canvas=t);var i=WebGLUtils.setupWebGL(t,e,r);return t.addEventListener("webglcontextlost",function(t){this.contextLost(),this._forceRestoreContext!==!1&&t.preventDefault()}.bind(this),!1),t.addEventListener("webglcontextrestored",function(){this.contextRestored()}.bind(this),!1),(Notify.reportWebGLError||e.get("reportWebGLError"))&&(i=WebGLDebugUtils.makeDebugContext(i)),this.initWebGLCaps(i),this.setGraphicContext(i),i},initRun:function(t){t.getBoolean("GLSLOptimizer")===!0&&(Shader.enableGLSLOptimizer=!0,this._runPromise=getGLSLOptimizer(),this._runPromise.then(function(t){Shader.glslOptimizer=t,Shader.glslOptimizer?Notify.log("uses glsl optimizer, use ?log=info to see shader output"):Notify.error("failed to load glsl optimizer")}).catch(function(t){Notify.error(t)}))},setContextLostCallback:function(t){this._contextLostCallback=t,this._contextLost&&(this._forceRestoreContext=t())},setContextRestoreCallback:function(t){this._contextRestoreCallback=t},contextLost:function(){Notify.log("webgl context lost"),this._contextLostCallback&&(this._forceRestoreContext=this._contextLostCallback()),this._contextLost=!0,window.cancelAnimationFrame(this._requestID)},contextRestored:function(){return this._forceRestoreContext===!1?void Notify.log("webgl context restore not supported - please reload the page - "):(this.restoreContext(),void Notify.log("webgl context restored"))},restoreContext:function(){var t=this.getGraphicContext();Shader.onLostContext(t),Program.onLostContext(t),BufferArray.onLostContext(t),VertexArrayObject.onLostContext(t),FrameBufferObject.onLostContext(t),Texture.getTextureManager(t).onLostContext(t),GLObject.onLostContext(t),this.getCamera().getRenderer().getState().resetCaches(),this.initWebGLCaps(t,!0),this.setGraphicContext(t),TimerGPU.instance(this.getGraphicContext(),!0),this._stats&&this._stats.reset(),this._contextLost=!1,this._requestRedraw=!0,this._contextRestoreCallback&&this._contextRestoreCallback(t),this._runImplementation()},init:function(){},getUpdateVisitor:function(){return this._updateVisitor},getState:function(){return this.getCamera().getRenderer().getState()},initStats:function(t){var e=TimerGPU.instance(this.getGraphicContext());return t.getBoolean("stats")?(this._stats=new Stats(this.getCamera().getViewport(),t),this._stats.addConfig(defaultStats),this._stats.addConfig(glStats),this._stats.addConfig(browserStats),this.getCamera().addChild(this._stats.getNode()),void e.setCallback(this.callbackTimerGPU.bind(this))):void e.disable()},callbackTimerGPU:function(t,e){this._stats&&this._stats.getCounter(e).set(t/1e6)},getViewerStats:function(){return this._stats},renderingTraversal:function(){if(this.getState()._frameStamp=this._frameStamp,this.getScene().getSceneData()&&this.getScene().getSceneData().getBound(),this.getCamera()){var t=this._stats,e=TimerGPU.instance(this.getGraphicContext()),r=this.getCamera().getRenderer();if(t&&t.getCounter("cull").start(),r.cull(),t&&t.getCounter("cull").end(),e.pollQueries(),e.start("glframe"),t&&t.getCounter("render").start(),r.draw(),t&&t.getCounter("render").end(),e.end("glframe"),t){var i=r.getCullVisitor();t.getCounter("cullcamera").set(i._numCamera),t.getCounter("cullmatrixtransform").set(i._numMatrixTransform),t.getCounter("cullprojection").set(i._numProjection),t.getCounter("cullnode").set(i._numNode),t.getCounter("culllightsource").set(i._numLightSource),t.getCounter("cullgeometry").set(i._numGeometry),t.getCounter("pushstateset").set(r.getState()._numPushStateSet),t.getCounter("applyStateSet").set(r.getState()._numApply)}}},updateTraversal:function(){var t=this._stats;t&&t.getCounter("update").start(),this._updateVisitor.resetStats(),this.getScene().updateSceneGraph(this._updateVisitor),t&&t.getCounter("updatecallback").set(this._updateVisitor._numUpdateCallback),this.getDatabasePager().releaseGLExpiredSubgraphs(.005),this.flushDeletedGLObjects(.005),t&&t.getCounter("update").end()},advance:function(t){var e=t;void 0===e&&(e=Number.MAX_VALUE);var r=this._frameStamp,i=r.getFrameNumber();r.setFrameNumber(i+1);var n=Timer.instance().deltaS(this._startTick,Timer.instance().tick());r.setReferenceTime(n);var a=r.getSimulationTime();r.setSimulationTime(e===Number.MAX_VALUE?n:e),r.setDeltaTime(r.getSimulationTime()-a)},beginFrame:function(){var t=this._stats;t&&(t.getCounter("frame").start(),t.getCounter("raf").tick(),t.getCounter("fps").frame())},endFrame:function(){var t=this.getFrameStamp().getFrameNumber();this._stats&&(Texture.getTextureManager(this.getGraphicContext()).updateStats(t,this._stats),this._stats.getCounter("stats").start(),this._stats.update(),this._stats.getCounter("stats").end(),this._stats.getCounter("frame").end())},checkNeedToDoFrame:function(){return this._requestContinousUpdate||this._requestRedraw},frame:function(){if(!this._contextLost){this.beginFrame(),this.advance();var t=this.updateViewport();this.updateEventProxy(this._eventProxy,this.getFrameStamp()),this._updateVisitor.setFrameStamp(this.getFrameStamp()),this.getManipulator()&&(this.getManipulator().update(this._updateVisitor),mat4.copy(this.getCamera().getViewMatrix(),this.getManipulator().getInverseMatrix())),(this.checkNeedToDoFrame()||t)&&(this._requestRedraw=!1,this.updateTraversal(),this.renderingTraversal()),this.endFrame(),this._hmd&&this._hmd.isPresenting&&this._hmd.submitFrame()}},setDone:function(t){this._done=t},done:function(){return this._done},render:function(){this.done()||(this._requestID=this._requestAnimationFrame(this.renderBinded,this._canvas),this.frame())},_runImplementation:function(){this.render()},run:function(){var t=this;this._runPromise.then(function(){t._runImplementation()}).catch(function(){t._runImplementation()})},setVRDisplay:function(t){this._hmd=t},getVRDisplay:function(){return this._hmd},setPresentVR:function(t){if(!this._hmd)return Notify.warn("no hmd device provided to the viewer!"),P.reject();if(!this._hmd.capabilities.canPresent)return P.reject();if(t){this._requestAnimationFrame=this._hmd.requestAnimationFrame.bind(this._hmd);var e=[{source:this.getGraphicContext().canvas}];return this._hmd.requestPresent(e)}return this._requestAnimationFrame=window.requestAnimationFrame.bind(window),this._hmd.exitPresent()},setupManipulator:function(t){void 0===t&&(t=new OrbitManipulator),void 0!==t.setNode?t.setNode(this.getSceneData()):t.view=this,t.setCamera(this.getCamera()),this.setManipulator(t)},updateViewport:function(){var t=this.getGraphicContext(),e=t.canvas,r=this.computeCanvasSize(e);if(!r)return!1;var i=this.getCamera(),n=i.getViewport(),a=n.width(),s=n.height(),o=e.width/a,h=e.height/s,u=o/h;return n.setViewport(Math.round(n.x()*o),Math.round(n.y()*h),Math.round(n.width()*o),Math.round(n.height()*h)),1!==u&&mat4.mul(i.getProjectionMatrix(),i.getProjectionMatrix(),mat4.fromScaling(mat4.create(),[1/u,1,1])),!0},initEventProxy:function(t){var e=t||{},r={},i=EventProxy,n=e.EventBackend;for(var a in i){var s=!0,o={};if(n&&void 0!==n[a]){var h=n[a].enable;s=void 0===h||h,o=n[a]}var u=new Options;if(u.extend(o).extend(t),delete u.EventBackend,s){var c=new i[a](this);c.init(u),r[a]=c}}return r},updateEventProxy:function(t,e){for(var r in t){var i=t[r];i.update&&i.update(e)}},setManipulator:function(t){this._manipulator&&this.removeEventProxy(),t.getCamera()||t.setCamera(this.getCamera()),View.prototype.setManipulator.call(this,t)},removeEventProxy:function(){var t=this._eventProxy;for(var e in t){var r=t[e];r.remove&&r.remove()}},getEventProxy:function(){return this._eventProxy}}),"osgViewer","Viewer"),module.exports=Viewer},function(t,e,r){"use strict";var i=r(224),n=r(225),a=r(226),s=r(227),o=r(229);t.exports={GamePad:i,Hammer:n,StandardMouseKeyboard:a,WebVR:s,DeviceOrientation:o}},function(t,e,r){"use strict";var i=r(9),n=function(t){this._viewer=t,this._type="GamePad",this._enable=!0,this._gamepadIndex=-1};n.prototype={setEnable:function(t){this._enable=t},getEnable:function(){return this._enable},init:function(){},isValid:function(){if(!this._enable)return!1;var t=this._viewer.getManipulator();if(!t)return!1;var e=t.getControllerList();return!!e[this._type]},getManipulatorController:function(){return this._viewer.getManipulator().getControllerList()[this._type]},gamepadPoll:function(){if(!navigator.getGamepads)return null;var t=navigator.getGamepads(),e=t[this._gamepadIndex];if(e)return e;for(var r=0,i=t.length;r<i;++r){var n=t[r];if(n&&n.id&&n.id.indexOf("Unknown Gamepad")===-1)return this._gamepadIndex=r,this.onGamepadConnect(n),n}return this._gamepadIndex>=0&&(this._gamepadIndex=-1,this.onGamepadConnect()),null},onGamepadConnect:function(t){i.log("Detected new gamepad!",t)},onGamepadDisconnect:function(){i.log("Gamepad disconnected")},update:function(){if(this.isValid()){var t=this.gamepadPoll();if(t){var e=this.getManipulatorController();e.update&&e.update(t)}}}},t.exports=n},function(t,e,r){"use strict";var i=r(162),n=function(t){this._enable=!0,this._viewer=t,this._type="Hammer",this._eventNode=void 0};n.prototype={setEnable:function(t){this._enable=t},getEnable:function(){return this._enable},getHammer:function(){return this._hammer},init:function(t){this._eventNode=t.eventNode,this._eventNode&&(this._hammer=new i.Manager(this._eventNode),this._hammer.add(new i.Pan),t.getBoolean("scrollwheel")&&this._hammer.add(new i.Pinch))},isValid:function(){return!(!this._enable||!this.getManipulatorController())},getManipulatorController:function(){var t=this._viewer.getManipulator();return t&&t.getControllerList()[this._type]},update:function(){var t=this.isValid(),e=this.getManipulatorController();e&&e.setValid(t),t&&this.getManipulatorController().setEventProxy(this._hammer)},remove:function(){this.isValid()&&this.getManipulatorController().removeEventProxy(this._hammer)}},t.exports=n},function(t,e,r){"use strict";var i=r(15).vec2,n=function(t){this._enable=!0,this._viewer=t,this._type="StandardMouseKeyboard",this._mouseEventNode=void 0,this._wheelEventNode=void 0,this._keyboardEventNode=void 0,this._eventList=["mousedown","mouseup","mouseout","mousemove","dblclick"],this._mousePosition=i.create()};n.prototype={setEnable:function(t){this._enable=t},getEnable:function(){return this._enable},init:function(t){var e=t.mouseEventNode,r=t.wheelEventNode||e,i=t.keyboardEventNode||e;t.getBoolean("scrollwheel")===!1&&(r=null),this._mouseEventNode=e,this._wheelEventNode=r,this._keyboardEventNode=i,this._callbacks={mousedown:this.mousedown.bind(this),mouseup:this.mouseup.bind(this),mouseout:this.mouseout.bind(this),mousemove:this.mousemove.bind(this),dblclick:this.dblclick.bind(this),mousewheel:this.mousewheel.bind(this),preventDefault:this.preventDefault.bind(this),keydown:this.keydown.bind(this),keyup:this.keyup.bind(this)},this.addEventListeners()},_addOrRemoveEventListeners:function(t){var e=this._callbacks,r=t?"removeEventListener":"addEventListener",i=this._mouseEventNode&&this._mouseEventNode[r].bind(this._mouseEventNode),n=this._wheelEventNode&&this._wheelEventNode[r].bind(this._wheelEventNode),a=this._keyboardEventNode&&this._keyboardEventNode[r].bind(this._keyboardEventNode);if(i)for(var s=0,o=this._eventList.length;s<o;s++){var h=this._eventList[s];i(h,e[h],!1)}n&&(n("DOMMouseScroll",e.mousewheel,!1),n("mousewheel",e.mousewheel,!1),n("MozMousePixelScroll",e.preventDefault,!1)),a&&(a("keydown",e.keydown,!1),a("keyup",e.keyup,!1))},addEventListeners:function(){return this._addOrRemoveEventListeners(!1)},removeEventListeners:function(){return this._addOrRemoveEventListeners(!0)},isValid:function(){return!!(this._enable&&this._viewer.getManipulator()&&this._viewer.getManipulator().getControllerList()[this._type])},getManipulatorController:function(){return this._viewer.getManipulator().getControllerList()[this._type]},keyup:function(t){if(this.isValid()&&this.getManipulatorController().keyup)return this.getManipulatorController().keyup(t)},keydown:function(t){if(this.isValid()&&this.getManipulatorController().keydown)return this.getManipulatorController().keydown(t)},mousedown:function(t){if(this.isValid()&&this.getManipulatorController().mousedown)return 1===t.button&&t.preventDefault(),this.getManipulatorController().mousedown(t)},mouseup:function(t){if(this.isValid()&&this.getManipulatorController().mouseup)return this.getManipulatorController().mouseup(t)},mouseout:function(t){if(this.isValid()&&this.getManipulatorController().mouseout)return this.getManipulatorController().mouseout(t)},mousemove:function(t){if(this.isValid()&&this.getManipulatorController().mousemove)return this.getManipulatorController().mousemove(t)},dblclick:function(t){if(this.isValid()&&this.getManipulatorController().dblclick)return this.getManipulatorController().dblclick(t)},mousewheel:function(t){if(this.isValid()){var e=this.getManipulatorController();if(e.mousewheel){t.preventDefault();var r=t||window.event,i=0,n=0,a=0;return t.detail?i=-t.detail/3:t.wheelDelta&&(i=t.wheelDelta/120),a=i,r.axis===r.HORIZONTAL_AXIS&&(a=0,n=-1*i),void 0!==r.wheelDeltaY&&(a=r.wheelDeltaY/120),void 0!==r.wheelDeltaX&&(n=-1*r.wheelDeltaX/120),e.mousewheel(t,i,n,a)}}},preventDefault:function(t){t.preventDefault()},getPositionRelativeToCanvas:function(t,e){return e=e||this._mousePosition,e[0]=void 0===t.offsetX?t.layerX:t.offsetX,e[1]=t.target.clientHeight-(void 0===t.offsetY?t.layerY:t.offsetY),e},update:function(){this.isValid()&&this.getManipulatorController().setEventProxy(this)}},t.exports=n},function(t,e,r){"use strict";var i=r(9),n=r(15).quat,a=r(15).vec3,s=r(15).mat4;r(228);var o=function(t){this._viewer=t,this._type="WebVR",this._enable=!1,this._hmd=void 0,this._sensor=void 0,this._frameData=void 0,this._quat=n.create(),this._pos=a.create(),this._worldScale=1};o.prototype={setWorldScale:function(t){this._worldScale=t},setEnable:function(t){this._enable=t},getEnable:function(){return this._enable},init:function(){if(navigator.getVRDisplays){var t=this;navigator.getVRDisplays().then(function(e){e.length>0&&(t._hmd=e[0],t._frameData=new window.VRFrameData,i.log("Found a VR display"),t._viewer.setVRDisplay(t._hmd))})}},getManipulatorController:function(){return this._viewer.getManipulator().getControllerList()[this._type]},isValid:function(){if(!this._enable)return!1;var t=this._viewer.getManipulator();return!!t&&(!!t.getControllerList()[this._type]&&!!this._hmd)},update:function(){var t=n.create(),e=a.create();return function(){if(this.isValid()){var r=this.getManipulatorController();if(r.update){this._hmd.getFrameData(this._frameData);var i=this._frameData.pose;if(i){var o=this._hmd.stageParameters&&this._hmd.stageParameters.sittingToStandingTransform,h=i.orientation;h&&(o&&(h=s.getRotation(t,o),n.mul(h,h,i.orientation)),this._quat[0]=h[0],this._quat[1]=-h[2],this._quat[2]=h[1],this._quat[3]=h[3]);var u=i.position;u&&(o&&(u=a.transformMat4(e,u,o)),this._pos[0]=u[0]*this._worldScale,this._pos[1]=-u[2]*this._worldScale,this._pos[2]=u[1]*this._worldScale),r.update(this._quat,this._pos)}}}}}(),getHmd:function(){return this._hmd}},t.exports=o},function(t,e,r){"use strict";var i=r(15).mat4;"getVRDisplays"in navigator&&("depthNear"in window.VRDisplay.prototype||(window.VRDisplay.prototype.depthNear=.01),"depthFar"in window.VRDisplay.prototype||(window.VRDisplay.prototype.depthFar=1e4),"VRFrameData"in window||(window.VRFrameData=function(){this.leftProjectionMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.rightViewMatrix=new Float32Array(16),this.pose=null},window.VRDisplay.prototype.getFrameData=function(){function t(t,n,a,s,o){i.perspectiveFromFieldOfView(t,s.fieldOfView,o.depthNear,o.depthFar);var h=a.orientation,u=a.position;h||(h=e),u||(u=r),i.fromRotationTranslation(n,h,u),i.translate(n,n,s.offset),i.invert(n,n)}var e=new Float32Array([0,0,0,1]),r=new Float32Array([0,0,0]);return function(e){var r=this.getPose();return!!r&&(e.pose=r,e.timestamp=r.timestamp,t(e.leftProjectionMatrix,e.leftViewMatrix,r,this.getEyeParameters("left"),this),t(e.rightProjectionMatrix,e.rightViewMatrix,r,this.getEyeParameters("right"),this),!0)}}()))},function(t,e){"use strict";var r=function(t){this._viewer=t,this._type="DeviceOrientation",this._enable=!1,this._deviceOrientation=void 0,this._screenOrientation=window.orientation||90};r.prototype={setEnable:function(t){this._enable=t},getEnable:function(){return this._enable},init:function(){var t=this;window.addEventListener("deviceorientation",function(e){null!==e.alpha&&void 0!==e.alpha&&(t._deviceOrientation=e)},!1),window.addEventListener("orientationchange",function(){null!==window.orientation&&void 0!==window.orientation&&(t._screenOrientation=window.orientation)},!1)},getManipulatorController:function(){return this._viewer.getManipulator().getControllerList()[this._type]},isValid:function(){if(!this._enable)return!1;if(!this._deviceOrientation)return!1;var t=this._viewer.getManipulator();return!!t&&!!t.getControllerList()[this._type]},update:function(){if(this.isValid()){var t=this.getManipulatorController();t.update&&t.update(this._deviceOrientation,this._screenOrientation)}}},t.exports=r},function(t,e){"use strict";var r=function(){function t(t){if(null==_){_={},f={};for(var e in t)"number"==typeof t[e]&&(_[t[e]]=e,f[e]=t[e])}}function e(){if(null==_)throw"WebGLDebugUtils.init(ctx) not called"}function r(t){return e(),void 0!==_[t]}function i(t){e();var r=_[t];return void 0!==r?"gl."+r:"/*UNKNOWN WebGL ENUM*/ 0x"+t.toString(16)}function n(t,e,r,n){var a=d[t];if(void 0!==a){var a=a[e];if(void 0!==a&&a[r]){if("object"==typeof a[r]&&void 0!==a[r].enumBitwiseOr){for(var s=a[r].enumBitwiseOr,o=0,h=[],u=0;u<s.length;++u){var c=f[s[u]];0!==(n&c)&&(o|=c,h.push(i(c)))}return o===n?h.join(" | "):i(n)}return i(n)}}return null===n?"null":void 0===n?"undefined":n.toString()}function a(t,e){for(var r="",i=e.length,a=0;a<i;++a)r+=(0==a?"":", ")+n(t,i,a,e[a]);return r}function s(t,e,r){t.__defineGetter__(r,function(){return e[r]}),t.__defineSetter__(r,function(t){e[r]=t})}function o(e,r,a,h){function u(t,e){return function(){a&&a(e,arguments);var i=t[e].apply(t,arguments),n=h.getError();return 0!=n&&(c[n]=!0,r(n,e,arguments)),i}}h=h||e,t(e),r=r||function(t,e,r){for(var a="",s=r.length,o=0;o<s;++o)a+=(0==o?"":", ")+n(e,s,o,r[o]);l("WebGL error "+i(t)+" in "+e+"("+a+")")};var c={},d={};for(var _ in e)if("function"==typeof e[_])if("getExtension"!=_)d[_]=u(e,_);else{var f=u(e,_);d[_]=function(){var t=f.apply(e,arguments);return t?o(t,r,a,h):null}}else s(d,e,_);return d.getError=function(){for(var t in c)if(c.hasOwnProperty(t)&&c[t])return c[t]=!1,t;return e.NO_ERROR},d}function h(t){var e=!!t.createTransformFeedback;e&&t.bindVertexArray(null);var r=t.getParameter(t.MAX_VERTEX_ATTRIBS),i=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,i);for(var n=0;n<r;++n)t.disableVertexAttribArray(n),t.vertexAttribPointer(n,4,t.FLOAT,!1,0,0),t.vertexAttrib1f(n,0),e&&t.vertexAttribDivisor(n,0);t.deleteBuffer(i);for(var a=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),n=0;n<a;++n)t.activeTexture(t.TEXTURE0+n),t.bindTexture(t.TEXTURE_CUBE_MAP,null),t.bindTexture(t.TEXTURE_2D,null),e&&(t.bindTexture(t.TEXTURE_2D_ARRAY,null),t.bindTexture(t.TEXTURE_3D,null),t.bindSampler(n,null));if(t.activeTexture(t.TEXTURE0),t.useProgram(null),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindRenderbuffer(t.RENDERBUFFER,null),t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.DITHER),t.disable(t.SCISSOR_TEST),t.blendColor(0,0,0,0),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.clearColor(0,0,0,0),t.clearDepth(1),t.clearStencil(-1),t.colorMask(!0,!0,!0,!0),t.cullFace(t.BACK),t.depthFunc(t.LESS),t.depthMask(!0),t.depthRange(0,1),t.frontFace(t.CCW),t.hint(t.GENERATE_MIPMAP_HINT,t.DONT_CARE),t.lineWidth(1),t.pixelStorei(t.PACK_ALIGNMENT,4),t.pixelStorei(t.UNPACK_ALIGNMENT,4),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.UNPACK_COLORSPACE_CONVERSION_WEBGL&&t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.BROWSER_DEFAULT_WEBGL),t.polygonOffset(0,0),t.sampleCoverage(1,!1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilMask(4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.viewport(0,0,t.canvas.width,t.canvas.height),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT),e){t.drawBuffers([t.BACK]),t.readBuffer(t.BACK),t.bindBuffer(t.COPY_READ_BUFFER,null),t.bindBuffer(t.COPY_WRITE_BUFFER,null),t.bindBuffer(t.PIXEL_PACK_BUFFER,null),t.bindBuffer(t.PIXEL_UNPACK_BUFFER,null);for(var s=t.getParameter(t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS),n=0;n<s;++n)t.bindBufferBase(t.TRANSFORM_FEEDBACK_BUFFER,n,null);for(var o=t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS),n=0;n<o;++n)t.bindBufferBase(t.UNIFORM_BUFFER,n,null);t.disable(t.RASTERIZER_DISCARD),t.pixelStorei(t.UNPACK_IMAGE_HEIGHT,0),t.pixelStorei(t.UNPACK_SKIP_IMAGES,0),t.pixelStorei(t.UNPACK_ROW_LENGTH,0),t.pixelStorei(t.UNPACK_SKIP_ROWS,0),t.pixelStorei(t.UNPACK_SKIP_PIXELS,0),t.pixelStorei(t.PACK_ROW_LENGTH,0),t.pixelStorei(t.PACK_SKIP_ROWS,0),t.pixelStorei(t.PACK_SKIP_PIXELS,0),t.hint(t.FRAGMENT_SHADER_DERIVATIVE_HINT,t.DONT_CARE)}for(;t.getError(););}function u(t){function e(t){return"function"==typeof t?t:function(e){t.handleEvent(e)}}function r(t){var e=t.addEventListener;t.addEventListener=function(r,i,n){switch(r){case"webglcontextlost":T(i);break;case"webglcontextrestored":A(i);break;default:e.apply(t,arguments)}}}function i(){for(var t=Object.keys(M),e=0;e<t.length;++e)delete M[t[e]]}function n(){++x,m||S==x&&t.loseContext()}function a(t,e){var r=t[e];return function(){if(n(),!m){var e=r.apply(t,arguments);return e}}}function o(){for(var t=0;t<v.length;++t){var e=v[t];e instanceof WebGLBuffer?l.deleteBuffer(e):e instanceof WebGLFramebuffer?l.deleteFramebuffer(e):e instanceof WebGLProgram?l.deleteProgram(e):e instanceof WebGLRenderbuffer?l.deleteRenderbuffer(e):e instanceof WebGLShader?l.deleteShader(e):e instanceof WebGLTexture?l.deleteTexture(e):_&&(e instanceof WebGLQuery?l.deleteQuery(e):e instanceof WebGLSampler?l.deleteSampler(e):e instanceof WebGLSync?l.deleteSync(e):e instanceof WebGLTransformFeedback?l.deleteTransformFeedback(e):e instanceof WebGLVertexArrayObject&&l.deleteVertexArray(e))}}function u(t){return{statusMessage:t,preventDefault:function(){b=!0}}}function c(t){for(var e in t)"function"==typeof t[e]?d[e]=a(t,e):s(d,t,e);d.getError=function(){if(n(),!m)for(var t;t=l.getError();)M[t]=!0;for(var t in M)if(M[t])return delete M[t],t;return d.NO_ERROR};var r=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"];_&&r.push("createQuery","createSampler","fenceSync","createTransformFeedback","createVertexArray");for(var i=0;i<r.length;++i){var o=r[i];d[o]=function(e){return function(){if(n(),m)return null;var r=e.apply(t,arguments);return r.__webglDebugContextLostId__=p,v.push(r),r}}(t[o])}var h=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];_&&h.push("getInternalformatParameter","getQuery","getQueryParameter","getSamplerParameter","getSyncParameter","getTransformFeedbackVarying","getIndexedParameter","getUniformIndices","getActiveUniforms","getActiveUniformBlockParameter","getActiveUniformBlockName");for(var i=0;i<h.length;++i){var o=h[i];d[o]=function(e){return function(){return n(),m?null:e.apply(t,arguments)}}(d[o])}var u=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];_&&u.push("isQuery","isSampler","isSync","isTransformFeedback","isVertexArray");for(var i=0;i<u.length;++i){var o=u[i];d[o]=function(e){return function(){return n(),!m&&e.apply(t,arguments)}}(d[o])}return d.checkFramebufferStatus=function(e){return function(){return n(),m?d.FRAMEBUFFER_UNSUPPORTED:e.apply(t,arguments)}}(d.checkFramebufferStatus),d.getAttribLocation=function(e){return function(){return n(),m?-1:e.apply(t,arguments)}}(d.getAttribLocation),d.getVertexAttribOffset=function(e){return function(){return n(),m?0:e.apply(t,arguments)}}(d.getVertexAttribOffset),d.isContextLost=function(){return m},_&&(d.getFragDataLocation=function(e){return function(){return n(),m?-1:e.apply(t,arguments)}}(d.getFragDataLocation),d.clientWaitSync=function(e){return function(){return n(),m?d.WAIT_FAILED:e.apply(t,arguments)}}(d.clientWaitSync),d.getUniformBlockIndex=function(e){return function(){return n(),m?d.INVALID_INDEX:e.apply(t,arguments)}}(d.getUniformBlockIndex)),d}var l,d,_,f=[],g=[],d={},p=1,m=!1,v=[],S=0,x=0,b=!1,y=0,M={};t.getContext=function(e){return function(){var r=e.apply(t,arguments);if(r instanceof WebGLRenderingContext||window.WebGL2RenderingContext&&r instanceof WebGL2RenderingContext){if(r!=l){if(l)throw"got different context";_=window.WebGL2RenderingContext&&r instanceof WebGL2RenderingContext,l=r,d=c(l)}return d}return r}}(t.getContext);var T=function(t){f.push(e(t))},A=function(t){g.push(e(t))};return r(t),t.loseContext=function(){if(!m){for(m=!0,S=0,++p;l.getError(););i(),M[l.CONTEXT_LOST_WEBGL]=!0;var e=u("context lost"),r=f.slice();setTimeout(function(){for(var i=0;i<r.length;++i)r[i](e);y>=0&&setTimeout(function(){t.restoreContext()},y)},0)}},t.restoreContext=function(){m&&g.length&&setTimeout(function(){if(!b)throw"can not restore. webglcontestlost listener did not call event.preventDefault";o(),h(l),m=!1,x=0,b=!1;for(var t=g.slice(),e=u("context restored"),r=0;r<t.length;++r)t[r](e)},0)},t.loseContextInNCalls=function(t){if(m)throw"You can not ask a lost contet to be lost";S=x+t},t.getNumCalls=function(){return x},t.setRestoreTimeout=function(t){y=t},t}var c=function(t){window.console&&window.console.log&&window.console.log(t)},l=function(t){window.console&&window.console.error?window.console.error(t):c(t)},d={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},bindBuffer:{2:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}},bufferData:{3:{0:!0,2:!0},4:{0:!0,2:!0},5:{0:!0,2:!0}},bufferSubData:{3:{0:!0},4:{0:!0},5:{0:!0}},copyBufferSubData:{5:{0:!0,1:!0}},getBufferSubData:{3:{0:!0},4:{0:!0},5:{0:!0}},blitFramebuffer:{10:{8:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]},9:!0}},framebufferTextureLayer:{5:{0:!0,1:!0}},invalidateFramebuffer:{2:{0:!0}},invalidateSubFramebuffer:{6:{0:!0}},readBuffer:{1:{0:!0}},getInternalformatParameter:{3:{0:!0,1:!0,2:!0}},renderbufferStorageMultisample:{5:{0:!0,2:!0}},texStorage2D:{5:{0:!0,2:!0}},texStorage3D:{6:{0:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0},10:{0:!0,2:!0,6:!0,7:!0}},texImage3D:{10:{0:!0,2:!0,7:!0,8:!0},11:{0:!0,2:!0,7:!0,8:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0},10:{0:!0,6:!0,7:!0}},texSubImage3D:{11:{0:!0,8:!0,9:!0},12:{0:!0,8:!0,9:!0}},copyTexSubImage3D:{9:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0},8:{0:!0,2:!0},9:{0:!0,2:!0}},compressedTexImage3D:{8:{0:!0,2:!0},9:{0:!0,2:!0},10:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0},9:{0:!0,6:!0},10:{0:!0,6:!0}},compressedTexSubImage3D:{10:{0:!0,8:!0},11:{0:!0,8:!0},12:{0:!0,8:!0}},vertexAttribIPointer:{5:{2:!0}},drawArraysInstanced:{4:{0:!0}},drawElementsInstanced:{5:{0:!0,2:!0}},drawRangeElements:{6:{0:!0,4:!0}},readPixels:{7:{4:!0,5:!0},8:{4:!0,5:!0}},clearBufferfv:{3:{0:!0},4:{0:!0}},clearBufferiv:{3:{0:!0},4:{0:!0}},clearBufferuiv:{3:{0:!0},4:{0:!0}},clearBufferfi:{4:{0:!0}},beginQuery:{2:{0:!0}},endQuery:{1:{0:!0}},getQuery:{2:{0:!0,1:!0}},getQueryParameter:{2:{1:!0}},samplerParameteri:{3:{1:!0,2:!0}},samplerParameterf:{3:{1:!0}},getSamplerParameter:{2:{1:!0}},fenceSync:{2:{0:!0,1:{enumBitwiseOr:[]}}},clientWaitSync:{3:{1:{enumBitwiseOr:["SYNC_FLUSH_COMMANDS_BIT"]}}},waitSync:{3:{1:{enumBitwiseOr:[]}}},getSyncParameter:{2:{1:!0}},bindTransformFeedback:{2:{0:!0}},beginTransformFeedback:{1:{0:!0}},transformFeedbackVaryings:{3:{2:!0}},bindBufferBase:{3:{0:!0}},bindBufferRange:{5:{0:!0}},getIndexedParameter:{2:{0:!0}},getActiveUniforms:{3:{2:!0}},getActiveUniformBlockParameter:{3:{2:!0}}},_=null,f=null;return{init:t,mightBeEnum:r,glEnumToString:i,glFunctionArgToString:n,glFunctionArgsToString:a,makeDebugContext:o,makeLostContextSimulatingCanvas:u,resetToInitialState:h}}();t.exports=r},function(t,e,r){var i=r(7),n=r(53),a=r(54),s=r(57),o=r(89),h=r(12),u=r(104),c=r(122),l=r(11),d=r(40),_=r(15).mat4,f=r(232),g=r(234),p=r(233),m=r(235),v=function(){var t=["attribute vec4 Vertex;","uniform mat4 uModelViewMatrix;","uniform mat4 uProjectionMatrix;","","varying vec2 vTexCoord0;","","void main(void) {","  vTexCoord0 = Vertex.zw;","  gl_Position = uProjectionMatrix * (uModelViewMatrix * vec4(Vertex.xy,0.0, 1.0));","}"].join("\n"),e=["varying vec2 vTexCoord0;","uniform sampler2D Texture0;","void main(void) {","  vec4 color = vec4(1.0);","  vec2 uv =  vTexCoord0;","  int isText = 0;","  if ( uv.y < 0.0 ) {","     isText = 1;","     uv.y = -uv.y;","  }","  if ( uv.y >= "+(f.backgroundColor-1).toFixed(1)+" ) {","     color = vec4(0.0,0.0,0.0,0.5);","     uv.y -= "+f.backgroundColor.toFixed(1)+";","  } else if ( uv.y >= "+(f.redColor-1).toFixed(1)+" ) {","     color = vec4(1.0,0.0,0.0,1.0);","     uv.y -= "+f.redColor.toFixed(1)+";","  } else if ( uv.y == "+(f.greyColor-1).toFixed(1)+" ) {","     color = vec4(0.5,0.5,0.5,1.0);","     uv.y -= "+f.greyColor.toFixed(1)+";","  } else {","     uv.y -= "+f.whiteColor.toFixed(1)+";","  }","  if ( isText == 1 ) {","     color *= texture2D( Texture0, uv.xy);","  }","  gl_FragColor = color;","}"].join("\n");
return new u(new c("VERTEX_SHADER",t),new c("FRAGMENT_SHADER",e))},S=function(t,e){this._captionsBuffer=void 0,this._valuesBuffer=void 0,this._dirtyCaptions=!0,this._dirtyValues=!0,this._labelMaxWidth=0,this._viewport=t,this._node=void 0,this._text=void 0,this._offsetGroup=void 0,this._counters={},this._groups={},this._updates=[],this._displayableCounters={},this._x=0,this._y=0,this._width=0,this._height=0,this._lineFactor=1.1,this._displayFilter=[],this._backgroundWidth=0,this._backgroundHeight=0,this._bufferStats=new f,this._historyGraph={},this._graphToDisplay=[],this._init(e)};i.createPrototypeObject(S,{getCounter:function(t){return this._counters[t]||(this._counters[t]=new g({caption:t,average:!0})),this._counters[t]},getBufferStats:function(){return this._bufferStats},addConfig:function(t){if(!t.init||t.init()){for(var e in t.values){var r=t.values[e],i=new g(r);this._counters[e]=i}if(t.groups)for(var n=0;n<t.groups.length;n++){var a=t.groups[n],s={caption:a.caption,values:a.values},o=a.name?a.name:a.caption;this._groups[o]=s}t.update&&this._updates.push(t.update)}},reset:function(){this._bufferStats.resetCaptions(),this._bufferStats.resetValues(),this._dirtyCaptions=!0,this._dirtyValue=!0,this._bufferStats.resize(this._bufferStats._maxNbVertexes)},update:function(){for(var t=0;t<this._updates.length;t++)this._updates[t](this);this._dirtyValues=!0,(this._checkViewportChanged()||this._checkCounterDisplayableChanged())&&(this._dirtyCaptions=!0),this._dirtyCaptions&&(this._bufferStats.resetCaptions(),this._generateCaptions(),this._dirtyCaptions=!1),this._dirtyValues&&(this._bufferStats.resetValues(),this._generateValues(),this._dirtyValues=!1)},getNode:function(){return this._node},setShowFilter:function(t){return this._dirtyCaptions=!0,t?void(this._displayFilter=t.slice()):void(this._displayFilter.length=0)},_init:function(t){var e=new a;e.setRenderOrder(a.POST_RENDER,0),e.setReferenceFrame(l.ABSOLUTE_RF),e.setClearMask(0);var r=new h;e.addChild(r),e.setName("osgStats"),this._node=e,this._text=new m;var i=16;if(t){var u=t.getString("statsFilter");if(u){var c=u.split(";");this.setShowFilter(c)}var _=t.getNumber("statsFontSize");void 0!==_&&(i=_)}var f=new d;f.setMinFilter(d.NEAREST),f.setMagFilter(d.NEAREST),this._text.setFontSize(i),this._text.getCanvas().then(function(t){this._dirtyCaptions=!0,r.addChild(this._bufferStats.getGeometry()),f.setImage(t)}.bind(this)),r.getOrCreateStateSet().setAttributeAndModes(v()),r.getOrCreateStateSet().setAttributeAndModes(new s(s.DISABLE)),r.getOrCreateStateSet().setAttributeAndModes(new n("SRC_ALPHA","ONE_MINUS_SRC_ALPHA")),r.getOrCreateStateSet().setAttributeAndModes(new o(o.DISABLE)),r.getOrCreateStateSet().setTextureAttributeAndModes(0,f)},_generateCaptions:function(){var t=0,e=this._text.getCharacterHeight(),r=t,i=this._viewport.height()-e;this._labelMaxWidth=0,this._bufferStats.generateBackground(0,this._viewport.height()-this._backgroundHeight,this._backgroundWidth,this._backgroundHeight);var n=this._displayFilter;for(var a in this._groups)if(!a||!n.length||n.indexOf(a)!==-1){var s=this._groups[a],o="--- "+s.caption+" ---",h=this._bufferStats.generateText(r,i,o,this._text,f.whiteColor);this._labelMaxWidth=Math.max(h,this._labelMaxWidth),r=t,i-=this._lineFactor*e;for(var u=0;u<s.values.length;u++){var c=s.values[u],l=this._counters[c];if(l&&l.isDisplayable()){var d=l._caption;h=this._bufferStats.generateText(r,i,d,this._text,f.whiteColor),this._labelMaxWidth=Math.max(h,this._labelMaxWidth),r=t,i-=e}}i-=e}this._bufferStats.captionsEnd()},_generateValues:function(){var t=this._text.getCharacterWidth(),e=this._labelMaxWidth+2*t,r=6*t,i=this._text.getCharacterHeight(),n=e,a=this._viewport.height()-i,s=this._displayFilter;for(var o in this._groups)if(!o||!s.length||s.indexOf(o)!==-1){var h=this._groups[o];n=e,a-=this._lineFactor*i;for(var u=0;u<h.values.length;u++){var c=h.values[u],l=this._counters[c];if(l&&l.isDisplayable()){var d,_=l.getAverageMs()?l.getAverageValue():l.getValue();d=Number.isInteger(_)?_.toString():_.toFixed(2);var g=f.whiteColor,m=l.getOver(),v=l.getBelow();0!==m?g=_>m?f.redColor:g:0!==v&&(g=_<v?f.redColor:g),this._bufferStats.generateText(n,a,d,this._text,g),l._graph&&(this._historyGraph[c]||(this._historyGraph[c]=new p),this._graphToDisplay.push(this._historyGraph[c]),this._historyGraph[c].setDisplayPosition(e+r,a),this._historyGraph[c].addValue(_,g)),n=e,a-=i}}a-=i}this._bufferStats.valuesEnd();for(var S=0;S<this._graphToDisplay.length;S++){var x=this._graphToDisplay[S];this._bufferStats.generateGraph(x,i-2)}var b=e+r;this._graphToDisplay.length&&(b+=2*p.maxGraphValue+1);var y=this._viewport.height()-a-2*i;this._backgroundWidth===b&&this._backgroundHeight===y||(this._backgroundWidth=b,this._backgroundHeight=y,this._dirtyCaptions=!0),this._graphToDisplay.length=0,this._bufferStats.graphsEnd(),this._bufferStats.update()},_checkCounterDisplayableChanged:function(){var t=!1;for(var e in this._counters){var r=this._counters[e];this._displayableCounters[e]!==r.isDisplayable()&&(this._displayableCounters[e]=r.isDisplayable(),t=!0)}return t},_checkViewportChanged:function(){var t=this._viewport.x(),e=this._viewport.y(),r=this._viewport.width(),i=this._viewport.height();if(t!==this._x||e!==this._y||r!==this._width||i!==this._height){this._x=t,this._y=e,this._width=r,this._height=i;var n=this._node;return _.ortho(n.getProjectionMatrix(),this._x,this._width,this._y,this._height,-5,5),!0}return!1}}),t.exports=S},function(t,e,r){var i=r(7),n=r(48),a=r(36),s=r(46),o=r(45),h=r(91),u=r(9),c=r(233),l=function(){this._usageHint=n.DYNAMIC_DRAW;var t=6560;this._nbVertexes=0,this._maxNbVertexes=0,this._captionNbVertexes=0,this._valuesNbVertexes=0,this._graphsNbVertexes=0,this.resize(t)};l.backgroundColor=10,l.redColor=7,l.greyColor=4,l.whiteColor=1,i.createPrototypeObject(l,{getGeometry:function(){return this._geometry},generateBackground:function(t,e,r,i){var n=this._vertexes;this._nbVertexes+=4,n[0]=t,n[1]=e,n[2]=0,n[3]=l.backgroundColor;var a=t+r,s=e+i;n[4]=t,n[5]=s,n[6]=0,n[7]=l.backgroundColor,n[8]=a,n[9]=s,n[10]=0,n[11]=l.backgroundColor,n[12]=a,n[13]=e,n[14]=0,n[15]=l.backgroundColor},generateCharacter:function(t,e,r,i,n,a,s){var o=this._vertexes,h=this._nbVertexes;this._nbVertexes+=4;var u=4*h;o[u++]=t,o[u++]=e,o[u++]=n,o[u++]=-(0+s);var c=t+r,l=e+i;o[u++]=t,o[u++]=l,o[u++]=n,o[u++]=-(1+s),o[u++]=c,o[u++]=l,o[u++]=a,o[u++]=-(1+s),o[u++]=c,o[u++]=e,o[u++]=a,o[u++]=-(0+s)},generateText:function(t,e,r,i,n){var a=r.length;this._nbVertexes+4*a>=this._maxNbVertexes&&this.resize(2*this._maxNbVertexes);for(var s=i._characterSizeUV,o=i._characterWidth,h=i._characterHeight,u=0;u<a;u++){var c=r.charCodeAt(u),l=i.getCharacterUV(c);this.generateCharacter(t,e,o,h,l,l+s,n),t+=o}return a*o},generateGraph:function(t,e){this._nbVertexes+2*c.maxGraphValue>=this._maxNbVertexes&&this.resize(2*this._maxNbVertexes);var r=this._vertexes,i=this._nbVertexes,n=t.getValues(),a=n.length,s=t.getIndex(),o=t.getX(),h=t.getY();this._nbVertexes+=2*a;for(var u=0;u<a;u++){var d=(s+u)%a,_=n[d],f=i+2*u,g=4*f,p=_,m=l.greyColor;p>=l.redColor&&(m=l.redColor,p-=l.redColor),p>1&&(p=1),p*=e,p<1&&(p=1),r[g]=o+2*u,r[g+1]=h,r[g+2]=0,r[g+3]=m,r[g+4]=o+2*u,r[g+5]=h+p,r[g+6]=0,r[g+7]=m}},resize:function(t){u.log("resize buffer to "+t),this._maxNbVertexes=t;var e=new Float32Array(4*t);this._vertexes&&e.set(this._vertexes),this._vertexes=e;var r=Math.ceil(t/4);this._indexes=new Uint16Array(6*r);for(var i=0,c=0;i<r;i++)this._indexes[c++]=4*i+0,this._indexes[c++]=4*i+1,this._indexes[c++]=4*i+3,this._indexes[c++]=4*i+3,this._indexes[c++]=4*i+1,this._indexes[c++]=4*i+2;if(this._geometry)return this._geometry.getAttributes().Vertex.setElements(this._vertexes),void this._characterPrimitive.getIndices().setElements(this._indexes);this._geometry=new a,this._geometry.getAttributes().Vertex=new n(n.ARRAY_BUFFER,this._vertexes,4,!0);var l=new n(n.ELEMENT_ARRAY_BUFFER,this._indexes,1);this._geometry.getAttributes().Vertex.setUsage(this._usageHint);var d=new o(s.TRIANGLES,l);this._characterPrimitive=d,this._geometry.getPrimitives().push(this._characterPrimitive);var _=new h(s.LINES,0,0);this._graphPrimitive=_,this._geometry.getPrimitives().push(this._graphPrimitive)},update:function(){var t=this._captionNbVertexes+this._valuesNbVertexes;this._characterPrimitive.setCount(t/4*6),this._graphPrimitive.setCount(this._graphsNbVertexes),this._graphPrimitive.setFirst(t),this._geometry.getAttributes().Vertex.dirty()},resetCaptions:function(){this._nbVertexes=0,this._captionNbVertexes=0},resetValues:function(){this._nbVertexes=this._captionNbVertexes,this._valuesNbVertexes=0,this._graphsNbVertexes=0},captionsEnd:function(){this._captionNbVertexes=this._nbVertexes},valuesEnd:function(){this._valuesNbVertexes=this._nbVertexes-this._captionNbVertexes},graphsEnd:function(){this._graphsNbVertexes=this._nbVertexes-(this._valuesNbVertexes+this._captionNbVertexes)},getCharacterPrimitive:function(){return this._characterPrimitive},getGraphPrimitive:function(){return this._graphPrimitive},getNbVertexes:function(){return this._nbVertexes}}),t.exports=l},function(t,e){var r=function(){this._values=new Float32Array(r.maxGraphValue),this._index=0,this._maxValue=0,this._x=0,this._y=0};r.maxGraphValue=120,r.prototype={getIndex:function(){return this._index},getValues:function(){return this._values},setDisplayPosition:function(t,e){this._x=t,this._y=e},getX:function(){return this._x},getY:function(){return this._y},addValue:function(t,e){var i=this._index;this._maxValue=t>this._maxValue?t:this._maxValue,this._maxValue*=.99,this._values[i]=t/(1.1*this._maxValue),e&&(this._values[i]+=e),this._index=(this._index+1)%r.maxGraphValue}},t.exports=r},function(t,e,r){var i=r(7),n=window.performance,a=function(t){this._caption=t.caption,this._accumValue=0,this._accumSamples=0,this._accumStart=0,this._value=0,this._averageValue=0,this._time=0,this._avgMs=0,this._over=t.over>0?t.over:0,this._below=t.below>0?t.below:0,this._graph=!!t.graph,t.average&&(this._avgMs=t.avgMs?t.avgMs:1e3),this._display=!1};i.createPrototypeObject(a,{isDisplayable:function(){return this._display},setDisplayable:function(t){this._display=t},getOver:function(){return this._over},getBelow:function(){return this._below},getGraph:function(){return this._graph},getAverageMs:function(){return this._avgMs},getAverageValue:function(){return this._averageValue},getValue:function(){return this._value},average:function(t){if(this._avgMs){this._accumValue+=t,this._accumSamples++;var e=n.now();e-this._accumStart>this._avgMs&&(this._averageValue=this._accumValue/this._accumSamples,this._accumValue=0,this._accumStart=e,this._accumSamples=0)}},start:function(){this._display=!0,this._time=n.now()},end:function(){this._value=n.now()-this._time,this.average(this._value)},set:function(t){this._display=!0,this._value=t,this.average(t)},tick:function(){this.end(),this.start()},frame:function(){var t=n.now()-this._time;this.set(1e3/t),this.start()}}),t.exports=a},function(t,e,r){var i=r(7),n=r(95),a=r(9),s="Courier New",o=function(t){var e=document.getElementsByTagName("body")[0],r=document.createElement("div"),i=document.createTextNode("M");r.appendChild(i),r.setAttribute("style",t),e.appendChild(r);var n=r.offsetHeight;return e.removeChild(r),n},h=function(t){return new n(function(e,r){window.WebFontConfig={google:{families:[t+":200"]},active:function(){e(t)},inactive:function(t){r("loadFont error:"+t)}};var i=document.createElement("script"),n=document.scripts[0];i.src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js",i.async=!0,i.onerror=function(){r()},n.parentNode.insertBefore(i,n)})},u=function(){this._canvas=void 0,this._characterHeight=0,this._characterWidth=0,this._fontSize=16,this._fontFamily="Source Code Pro",this._characterFirstCode=" ".charCodeAt(),this._characterLastCode="z".charCodeAt(),this._characterSizeUV=0,this._backgroundColor="rgba(0,0,0,0.0)",this._createCanvas()};i.createPrototypeObject(u,{setFontSize:function(t){this._fontSize=t},getCharacterWidth:function(){return this._characterWidth},getCharacterHeight:function(){return this._characterHeight},getCanvas:function(){return this._promise},getCharacterUV:function(t){var e=t-this._characterFirstCode;return e*this._characterSizeUV},_fillCanvas:function(t,e){var r=e+"px",i="font-family: "+t+"; font-size: "+r+";",n=o(i);a.debug(t+" "+r+" ==> "+n+" pixels high."),this._characterHeight=Math.ceil(n);var s=e+"px '"+t+"'",h=document.createElement("canvas"),u=h.getContext("2d");this._canvas=h,u.font=s,u.textBaseline="middle",this._characterWidth=u.measureText(" ").width,this._characterWidth=Math.ceil(this._characterWidth);var c=this._characterLastCode-this._characterFirstCode+1;a.info("Stats character size "+this._characterWidth+" x "+this._characterHeight+" texture width "+this._characterWidth*c),h.width=Math.ceil(this._characterWidth*c),h.height=this._characterHeight,this._characterSizeUV=this._characterWidth/h.width,u.font=s,u.textBaseline="middle",u.fillStyle="rgb(255,255,255)";for(var l=this._characterFirstCode,d=0;l<=this._characterLastCode;l++,d++){var _=String.fromCharCode(l),f=d*this._characterWidth,g=this._characterHeight/2;u.fillText(_,f,g)}return h},_createCanvas:function(){this._promise=h(this._fontFamily).then(function(t){return this._fillCanvas(t,this._fontSize)}.bind(this)).catch(function(){return this._fillCanvas(s,this._fontSize)}.bind(this))}}),t.exports=u},function(t,e){var r={frame:{caption:"Total frame time",over:16,average:!0,graph:!0,max:4},stats:{caption:"stats",over:1,graph:!0},fps:{caption:"Framerate (FPS)",below:30,average:!0},raf:{caption:"Time since last rAF",average:!0,avgMs:500},update:{caption:"update",average:!0,graph:!0},cull:{caption:"cull",average:!0,graph:!0,max:16},render:{caption:"render",average:!0,graph:!0},glframe:{caption:"glframe",average:!0,graph:!0},textureused:{caption:"texture used"},texturereserved:{caption:"texture reserved"},texturetotal:{caption:"texture total"},pushstateset:{caption:"num pushStateSet"},applyStateSet:{caption:"num applyStateSet"},updatecallback:{caption:"num updateCallback"},cullcamera:{caption:"camera"},cullmatrixtransform:{caption:"matrixTransform"},cullprojection:{caption:"projection"},cullnode:{caption:"node"},culllightsource:{caption:"lightSource"},cullgeometry:{caption:"geometry"}},i=[{name:"framerate",caption:"Framerate",values:["fps","raf"]},{name:"frameBudget",caption:"Frame Budget",base:"frame",values:["frame","update","cull","render","glframe","stats"]},{name:"sceneGraph",caption:"Scene Graph ",values:["pushstateset","updatecallback","applyStateSet"]},{name:"cullVisitor",caption:"Cull",values:["cullnode","cullmatrixtransform","cullcamera","culllighsource","cullprojection","cullgeometry"]},{name:"texture",caption:"Texture Memory",values:["texturereserved","textureused","texturetotal"]}],n={values:r,groups:i};t.exports=n},function(t,e){var r=window.WebGLRenderingContext,i=window.WebGL2RenderingContext,n=[r,i],a=function(t,e){return function(){e.apply(this,arguments),t.apply(this,arguments)}},s=0,o=0,h=0,u=0,c=0,l=0,d=0,_=0,f=0,g=0,p=function(){for(var t=!1,e=0;e<n.length;e++){var r=n[e];r&&(t=!0,r.prototype.drawArrays=a(r.prototype.drawArrays,function(){s++,arguments[0]===this.POINTS?l+=arguments[2]:c+=arguments[2]}),r.prototype.drawElements=a(r.prototype.drawElements,function(){o++,u+=arguments[1]/3,c+=arguments[1]}),r.prototype.useProgram=a(r.prototype.useProgram,function(){h++}),r.prototype.bindTexture=a(r.prototype.bindTexture,function(){d++}))}return t},m=function(t){var e=t.getBufferStats(),r=e.getNbVertexes(),i=e.getCharacterPrimitive(),n=e.getGraphPrimitive();o-=1,n.getCount()&&(s-=1),d-=2,h-=1,c-=i.getCount()+n.getCount(),u-=i.getCount()/3,_=r,f=i.getCount()/3,g=n.getCount()/2,t.getCounter("glDrawCalls").set(o+s),t.getCounter("glDrawElements").set(o),t.getCounter("glDrawArrays").set(s),t.getCounter("glBindTexture").set(d),t.getCounter("glUseProgram").set(h),t.getCounter("glFaces").set(u),t.getCounter("glVertices").set(c),t.getCounter("glPoints").set(l),t.getCounter("statsVertices").set(_),t.getCounter("statsFaces").set(f),t.getCounter("statsLines").set(g),_=0,f=0,g=0,s=0,o=0,h=0,u=0,c=0,l=0,d=0}.bind(this),v={values:{glDrawCalls:{caption:"drawCalls"},glDrawElements:{caption:"drawElements"},glDrawArrays:{caption:"drawArrays"},glBindTexture:{caption:"bindTexture"},glUseProgram:{caption:"useProgram"},glFaces:{caption:"totalFaces"},glVertices:{caption:"totalVertices"},glPoints:{caption:"totalPoints"},statsFaces:{caption:"statsFaces"},statsVertices:{caption:"statsVertices"},statsLines:{caption:"statsLines"}},groups:[{name:"webgl",caption:"WebGL",values:["glDrawCalls","glDrawElements","glDrawArrays","glUseProgram","glBindTexture","glFaces","glVertices","glPoints","statsVertices","statsFaces","statsLines"]}],update:m,init:p};t.exports=v},function(t,e,r){var i=r(9),n=void 0,a=Math.log(1024),s=function(t){var e=100,r=Math.floor(Math.log(t)/a);return 0===t&&(r=1),Math.round(t*e/Math.pow(1024,r))/e},o=function(){return window.performance&&window.performance.memory&&(n=window.performance.memory),n&&0!==n.totalJSHeapSize||i.warn("Stats will not report memory, not supported by your browse"),!!n},h=function(t){var e=0,r=0;n&&(e=s(n.usedJSHeapSize),r=s(n.totalJSHeapSize)),t.getCounter("browserMemory").set(e),t.getCounter("browserMemoryTotal").set(r)},u={values:{browserMemory:{caption:"Used Memory",average:!0,avgMs:1e3},browserMemoryTotal:{caption:"Total Memory"}},groups:[{name:"browser",caption:"Browser",values:["browserMemory","browserMemoryTotal"]}],update:h,init:o};t.exports=u},function(t,e,r){"use strict";var i=r(240),n=r(202),a=r(201),s=r(241),o=r(242),h=r(243),u=r(247),c=r(244),l=r(249),d=r(245),_=r(246),f=r(248),g=r(250),p={};p.ShadowCastAttribute=i,p.ShadowCastCompiler=n,p.ShadowReceiveAttribute=c,p.ShadowCasterVisitor=s,p.ShadowFrustumIntersection=o,p.ShadowMap=h,p.ShadowMapAtlas=u,p.ShadowedScene=g,p.ShadowSettings=l,p.ShadowCastShaderGenerator=a,p.ShadowTechnique=d,p.ShadowTexture=_,p.ShadowTextureAtlas=f,t.exports=p},function(t,e,r){"use strict";var i=r(7),n=r(30),a=function(t,e){n.call(this),this._enable=!t,this._shadowReceiveAttribute=e,this._dirtyHash=!0,this._hash=""};i.createPrototypeStateAttribute(a,i.objectInherit(n.prototype,{attributeType:"ShadowCast",cloneType:function(){return new a(!0)},setReceiveAttribute:function(t){this._shadowReceiveAttribute=t},getReceiveAttribute:function(){return this._shadowReceiveAttribute},getDefines:function(){return this._shadowReceiveAttribute.getDefines()},_computeInternalHash:function(){return"ShadowCast"+this._enable+this._shadowReceiveAttribute.getPrecision()},getHash:function(){var t=!1;return this._shadowReceiveAttribute&&this._shadowReceiveAttribute._dirtyHash&&(this._receiveAttributeDirty=!0),this._dirtyHash||t?(this._hash=this._computeInternalHash(),this._dirtyHash=!1,this._hash):this._hash},isEnabled:function(){return this._enable}}),"osgShadow","ShadowCastAttribute"),t.exports=a},function(t,e,r){"use strict";var i=r(53),n=r(54),a=r(89),s=r(99),o=r(66),h=r(31),u=r(7),c=function(t){h.call(this),this._noCastMask=t,this._nodeList=[]};u.createPrototypeObject(c,u.objectInherit(h.prototype,{reset:function(){this._nodeList=[]},removeNodeFromCasting:function(t){var e=t.getNodeMask();e===-1?(e=this._noCastMask,t.setNodeMask(e),this._nodeList.push(t)):0!==(e&~this._noCastMask)&&(t.setNodeMask(e|this._noCastMask),this._nodeList.push(t))},apply:function(t){var e=t.getStateSet();if(e){var r=e.getAttribute("BlendFunc");if(void 0!==r&&r.getSource()!==i.DISABLE){var h=e.getAttribute("Depth");if(h&&(h.getFunc()===a.DISABLE||h.getWriteMask()===!1))return void this.removeNodeFromCasting(t)}}return t.getTypeID()===s.typeID||t.getTypeID()===o.typeID?void this.removeNodeFromCasting(t):t.getTypeID()===n.typeID&&t.isRenderToTextureCamera()?void this.removeNodeFromCasting(t):void this.traverse(t)},setNoCastMask:function(t){this._noCastMask=t},restore:function(){for(var t=0,e=this._nodeList.length;t<e;t++){var r=this._nodeList[t],i=r.getNodeMask();i===this._noCastMask?r.setNodeMask(-1):r.setNodeMask(i&~this._noCastMask)}}}),"osgShadow","ShadowCasterVisitor"),t.exports=c},function(t,e,r){"use strict";var i=r(14),n=r(28),a=r(54),s=r(36),o=r(99),h=r(15).mat4,u=r(32),c=r(50),l=r(64),d=r(31),_=r(60),f=r(7),g=function(){d.call(this,d.TRAVERSE_ALL_CHILDREN),this._pooledMatrix=new u(h.create),this._matrixStack=new c,this._matrixStack.push(h.IDENTITY),this._bb=new i,this._bs=new n};f.createPrototypeObject(g,f.objectInherit(d.prototype,{reset:function(t,e,r,i,n){this.setTraversalMask(t),this._cameraFrustum=r,this._lightFrustum=n,this.getCameraPlaneMaskForLightNear(e,r,i?6:4),this._pooledMatrix.reset(),this._matrixStack.reset(),this._matrixStack.push(h.IDENTITY),this._bb.init()},getBoundingBox:function(){return this._bb},getCameraPlaneMaskForLightNear:function(t,e,r){var i,n=1,a=15;for(i=0;i<r;++i)a=a<<1|1;var s=e.getPlanes();for(i=0;i<r;++i)_.distanceToPlane(s[i],t)<0&&(a^=n),n<<=1;return this._cameraPlaneMaskedByLightNear=a,e.setResultMask(a),e.pushCurrentMask(a),a},applyTransform:function(t){var e=this._pooledMatrix.getOrCreateObject();h.copy(e,this._matrixStack.back()),t.computeLocalToWorldMatrix(e,this);var r=this._bs;t.getBound().transformMat4(this._bs,e),(0===this._cameraFrustum.getCurrentMask()||this._cameraFrustum.containsBoundingSphere(r))&&(0===this._lightFrustum.getCurrentMask()||this._lightFrustum.containsBoundingSphere(r))&&(this._cameraFrustum.pushCurrentMask(),this._lightFrustum.pushCurrentMask(),this.pushMatrix(e),this.traverse(t),this._cameraFrustum.popCurrentMask(),this._lightFrustum.popCurrentMask(),this.popMatrix())},applyBoundingBox:function(){var t=new i;return function(e){var r=this._matrixStack.back();h.exactEquals(r,h.IDENTITY)?this._bb.expandByBoundingBox(e):e.valid()&&(e.transformMat4(t,r),this._bb.expandByBoundingBox(t))}}(),apply:function(t){var e=t.getTypeID();if(t instanceof l)return void this.applyTransform(t);if(e===s.getTypeID()){var r=this._bs;if(t.getBound().transformMat4(r,this._matrixStack.back()),0!==this._cameraFrustum.getCurrentMask()&&!this._cameraFrustum.containsBoundingSphere(r))return;if(0!==this._lightFrustum.getCurrentMask()&&!this._lightFrustum.containsBoundingSphere(r))return;return void this.applyBoundingBox(t.getBoundingBox())}e===a.getTypeID()||e===o.getTypeID(),this.traverse(t)},pushMatrix:function(t){this._matrixStack.push(t)},popMatrix:function(){this._matrixStack.pop()}}),"osgShadow","ComputeMultiFrustumBoundsVisitor"),t.exports=g},function(t,e,r){"use strict";var i=r(54),n=r(63),a=r(53),s=r(89),o=r(71),h=r(15).mat4,u=r(64),c=r(9),l=r(123),d=r(30),_=r(29),f=r(191),g=r(40),p=r(11),m=r(41),v=r(7),S=r(46),x=r(15).vec3,b=r(15).vec4,y=r(129),M=r(37),T=r(244),A=r(240),C=r(245),I=r(246),w=function(t){this._shadowTechnique=t};v.createPrototypeObject(w,{cull:function(t,e){this._shadowTechnique.getShadowedScene().nodeTraverse(e);var r=e.getCurrentCullingSet(),i=e.getCurrentProjectionMatrix(),n=e.getComputedNear(),a=e.getComputedFar();return h.getFrustumPlanes(r.getFrustum().getPlanes(),i,e.getCurrentModelViewMatrix(),!1),r.getFrustum().setupMask(6),this._shadowTechnique.setLightFrustum(r.getFrustum(),n,a),!1}},"osgShadow","CameraCullCallback");var E=function(t,e){C.call(this),this._projectionMatrix=h.create(),this._viewMatrix=h.create(),this._lightNumberArrayIndex=-1,this._lightUp=x.fromValues(0,0,1),this._light=t.light,this._cameraShadow=new i,this._cameraShadow.setCullCallback(new w(this)),this._cameraShadow.setRenderOrder(i.PRE_RENDER,0),this._cameraShadow.setReferenceFrame(p.ABSOLUTE_RF),this._cameraShadow.setClearColor(b.fromValues(1,1,1,1)),e?this._texture=e:(this._texture=new I,this._textureUnitBase=4,this._textureUnit=this._textureUnitBase,this._textureMagFilter=void 0,this._textureMinFilter=void 0),this._textureSize=256;var r=m.createFloat2("RenderSize");this._texelSizeUniform=m.createFloat1(1/this._textureSize,"texelSize"),this._renderSize=r.getInternalArray(),this._renderSize[0]=this._renderSize[1]=this._textureSize,this._receivingStateset=void 0,this._casterStateSet=new _,this._casterStateSet.addUniform(m.createFloat1(0,"exponent0")),this._casterStateSet.addUniform(m.createFloat1(0,"exponent1")),this._casterStateSet.addUniform(m.createFloat1(.005,"bias")),this._casterStateSet.addUniform(this._texelSizeUniform),this._casterStateSet.addUniform(r),this._casterStateSet.setAttributeAndModes(new s(s.LESS),d.ON|d.OVERRIDE),this._casterStateSet.setAttributeAndModes(new a,d.ON|d.OVERRIDE),this._shadowReceiveAttribute=new T(this._light.getLightNumber()),this._casterStateSet.setAttributeAndModes(this._shadowReceiveAttribute,d.ON|d.OVERRIDE),this._shadowCastShaderGeneratorName="ShadowCast";var n=.001,o=1e3,u=m.createFloat4("uShadowDepthRange");this._casterStateSet.addUniform(u),this._depthRange=u.getInternalArray(),this._depthRange[0]=n,this._depthRange[1]=o,this._depthRange[2]=o-n,this._depthRange[3]=1/(o-n),this._worldLightPos=b.create(),this._worldLightPos[3]=0,this._worldLightDir=b.create(),this._worldLightDir[3]=1,this._castsShadowDrawTraversalMask=4294967295,this._castsShadowBoundsTraversalMask=4294967295,this._shaderProcessor=void 0,this._tmpVec=x.create(),this._tmpVecBis=x.create(),this._tmpVecTercio=x.create(),this._tmpMatrix=h.create(),t&&this.setShadowSettings(t),this._infiniteFrustum=!0;var c=new A(!1,this._shadowReceiveAttribute);this._casterStateSet.setAttributeAndModes(c,d.ON|d.OVERRIDE),this._casterStateSet.setShaderGeneratorName(this._shadowCastShaderGeneratorName,d.OVERRIDE|d.ON),this._debug=!1};v.createPrototypeObject(E,v.objectInherit(C.prototype,{getDepthRange:function(){return this._depthRange},setLightFrustum:function(t,e,r){this._lightFrustum=t,this._depthRange[0]=e,this._depthRange[1]=r,this.nearFarBounding(),this._debug&&(this._debugGeomFrustum.updateGeometry(this._projectionMatrix,this._depthRange),h.invert(this._debugNodeFrustum.getMatrix(),this._viewMatrix))},getCamera:function(){return this._cameraShadow},getTexture:function(){return this._texture},isDirty:function(){return this._dirty},setTextureUnitBase:function(t){this._textureUnitBase=t,this._textureUnit=t},setShadowSettings:function(t){t&&(this._light=t.light,this._shadowCastShaderGeneratorName=t.getShadowCastShaderGeneratorName(),this.setCastsShadowDrawTraversalMask(t.castsShadowDrawTraversalMask),this.setCastsShadowBoundsTraversalMask(t.castsShadowBoundsTraversalMask),this.setLight(this._light),this.setTextureSize(t.textureSize),this.setTexturePrecision(t.textureType),this.setKernelSizePCF(t.kernelSizePCF),this.setBias(t.bias),this.setNormalBias(t.normalBias))},setCastsShadowDrawTraversalMask:function(t){this._castsShadowDrawTraversalMask=t},getCastsShadowDrawTraversalMask:function(){return this._castsDrawShadowTraversalMask},setCastsShadowBoundsTraversalMask:function(t){this._castsShadowBoundsTraversalMask=t},getCastsShadowBoundsTraversalMask:function(){return this._castsShadowBoundsTraversalMask},getNormalBias:function(){return this._shadowReceiveAttribute.getNormalBias()},setNormalBias:function(t){this._shadowReceiveAttribute.setNormalBias(t)},getBias:function(){return this._shadowReceiveAttribute.getBias()},setBias:function(t){this._shadowReceiveAttribute.setBias(t),this._casterStateSet.getUniformList().bias.getUniform().setFloat(t)},getKernelSizePCF:function(){return this._shadowReceiveAttribute.getKernelSizePCF()},setKernelSizePCF:function(t){this._shadowReceiveAttribute.setKernelSizePCF(t)},setShadowedScene:function(t){C.prototype.setShadowedScene.call(this,t),this._receivingStateset=this._shadowedScene.getReceivingStateSet(),this.dirty()},checkLightNumber:function(){var t=this._light.getLightNumber();this._shadowReceiveAttribute.getLightNumber()!==t&&this._receivingStateset.getAttribute(this._shadowReceiveAttribute.getTypeMember())===this._shadowReceiveAttribute&&this._receivingStateset.removeAttribute(this._shadowReceiveAttribute.getTypeMember()),c.assert(this._shadowReceiveAttribute.getTypeMember()===this._shadowReceiveAttribute.attributeType+t,"TypeMember isnt reflecting light number"+this._shadowReceiveAttribute.getTypeMember()+" !== "+this._shadowReceiveAttribute.attributeType+t),this._texture&&!this._texture.hasLightNumber(t)&&this._receivingStateset.getTextureAttribute(this._textureUnit,this._texture.getTypeMember())===this._texture&&this._receivingStateset.removeTextureAttribute(this._textureUnit,this._texture.getTypeMember())},init:function(t,e,r){if(this._shadowedScene){this._filledOnce=!1,this.checkLightNumber(),this._cameraShadow||(this._cameraShadow=new i,this._cameraShadow.setCullCallback(new w(this)),this._cameraShadow.setRenderOrder(i.PRE_RENDER,0),this._cameraShadow.setReferenceFrame(p.ABSOLUTE_RF),this._cameraShadow.setClearColor(b.fromValues(1,1,1,1)));var n=this._light.getLightNumber();t?(this._texture=t,this._lightNumberArrayIndex=e,this._textureUnit=r,this._shadowReceiveAttribute.setAtlas(!0)):(this.initTexture(),this._textureUnit=this._textureUnitBase+n,this._texture.setLightNumber(n),this._texture.setName("ShadowTexture"+this._textureUnit),this._shadowReceiveAttribute.setAtlas(!1)),this._cameraShadow.setName("light_shadow_camera"+this._light.getName()),this._shadowReceiveAttribute.setLightNumber(n);var a=d.OVERRIDE|d.ON;this._receivingStateset.setAttributeAndModes(this._shadowReceiveAttribute,a),this._preventTextureBindingDuringShadowCasting(),this._casterStateSet.setTextureAttributeAndModes(this._textureUnit,g.textureNull,d.PROTECTED),this._receivingStateset.setTextureAttributeAndModes(this._textureUnit,this._texture,a),this._dirty=!1}},_preventTextureBindingDuringShadowCasting:function(){for(var t=M.instance().getWebGLParameter("MAX_TEXTURE_IMAGE_UNITS"),e=0;e<t;e++)this._casterStateSet.setTextureAttributeAndModes(e,g.textureNull,d.OVERRIDE|d.ON)},valid:function(){return!0},updateShadowTechnique:function(t,e,r){var i=this._cameraShadow,n=this._texture;if(i&&n){var a=i.getViewport();a||(a=new y,i.setViewport(a)),e?a.x()===e[0]&&a.y()===e[1]&&a.width()===e[2]&&a.height()===e[3]||(i.setFrameBufferObject(r),a.setViewport(e[0],e[1],e[2],e[3])):a.width()===n.getWidth()&&a.height()===n.getHeight()||(i.detachAll(),i.attachTexture(o.COLOR_ATTACHMENT0,n),i.attachRenderBuffer(o.DEPTH_ATTACHMENT,o.DEPTH_COMPONENT16),a.setViewport(0,0,n.getWidth(),n.getHeight()))}},updateShadowTechnic:function(){c.log("ShadowMap.updateShadowTechnic() is deprecated, use updateShadowTechnique instead"),this.updateShadowTechnique()},setTextureFiltering:function(){var t,e=this.getTexturePrecision();switch(e){case"HALF_FLOAT":t=g.HALF_FLOAT;break;case"FLOAT":t=g.FLOAT;break;default:case"UNSIGNED_BYTE":t=g.UNSIGNED_BYTE}this._texture.setInternalFormatType(t),this._texture.setMinFilter(g.NEAREST),this._texture.setMagFilter(g.NEAREST),this._textureMagFilter=g.NEAREST,this._textureMinFilter=g.NEAREST},initTexture:function(){if(this._dirty){this._texture||(this._texture=new I,this._textureUnit=this._textureUnitBase),this._texture.setTextureSize(this._textureSize,this._textureSize),this._texelSizeUniform.setFloat(1/this._textureSize),this._renderSize[0]=this._textureSize,this._renderSize[1]=this._textureSize;var t;t=g.RGBA,this.setTextureFiltering(),this._texture.setInternalFormat(t),this._texture.setWrapS(g.CLAMP_TO_EDGE),this._texture.setWrapT(g.CLAMP_TO_EDGE),this._texture.dirty()}},setTexturePrecision:function(t){t!==this._shadowReceiveAttribute.getPrecision()&&(this._shadowReceiveAttribute.setPrecision(t),this.dirty())},getTexturePrecision:function(){return this._shadowReceiveAttribute.getPrecision()},setTextureSize:function(t){t!==this._textureSize&&(this._textureSize=t,this.dirty())},getCasterStateSet:function(){return this._casterStateSet},setLight:function(t){t&&t!==this._light&&(this._light=t,this.dirty())},getUp:function(t){return Math.abs(x.dot(this._lightUp,t))>=1&&(1===this._lightUp[0]?(this._lightUp[0]=0,this._lightUp[1]=1,this._lightUp[2]=0):(this._lightUp[0]=1,this._lightUp[1]=0,this._lightUp[2]=0)),this._lightUp},nearFarBounding:function(){var t=this._depthRange[0],e=this._depthRange[1],r=E.EPSILON;
e<t-r?(this._emptyCasterScene=!0,e=1,t=r):t<r&&(t=r),this._depthRange[0]=t,this._depthRange[1]=e},makePerspectiveFromBoundingBox:function(t,e,r,i,n,a){var s=t.center(this._tmpVec),o=t.radius(),u=E.EPSILON,c=u,l=1;this._radius=o;var d=x.distance(s,r);d<-o?this._emptyCasterScene=!0:d<=0?(c=u,l=d+o):d<o?(c=u,l=d+o):(c=d-o,l=d+o),this._depthRange[0]=c,this._depthRange[1]=l,this.nearFarBounding();var _=this._depthRange[0]*Math.tan(e*Math.PI/180);_=_>o?o:_;var f=_,g=-f,p=_,m=-p,v=this.getUp(i);this._infiniteFrustum?h.infiniteFrustum(a,m,p,g,f,this._depthRange[0]):h.frustum(a,m,p,g,f,this._depthRange[0],this._depthRange[1]),h.lookAtDirection(n,r,i,v)},makeOrthoFromBoundingBox:function(t,e,r,i){var n=t.center(this._tmpVecTercio),a=t.radius(),s=a+a,o=1e-4,u=s+1e-4,c=this._tmpVec;x.scaleAndAdd(c,n,e,-s),o=a,u+=a;var l=.001;o<u*l&&(o=u*l);var d=this.getUp(e);h.lookAtDirection(r,c,e,d);var _,f;f=a,_=f,h.ortho(i,-_,_,-f,f,o,u),this._depthRange[0]=o,this._depthRange[1]=u},aimShadowCastingCamera:function(t,e){var r=this._light;if(!r)return void(this._emptyCasterScene=!0);var i=this._cameraShadow,n=this._worldLightPos,a=this._worldLightDir;h.copy(this._projectionMatrix,i.getProjectionMatrix()),h.copy(this._viewMatrix,i.getViewMatrix());for(var s,o=this._projectionMatrix,u=this._viewMatrix,l=t.getCurrentRenderBin().getPositionedAttribute(),d=l.getArray(),_=0;_<l.getLength();_++){var f=d[_],g=f[1],p=f[0];if(g===r){s=p;break}}if(void 0===s)return c.warn("light isnt inside children of shadowedScene Node"),void(this._emptyCasterScene=!0);var m=this._tmpMatrix;if(h.invert(m,t.getCurrentModelViewMatrix()),this._light.isDirectionLight())b.transformMat4(n,r.getPosition(),s),b.transformMat4(n,n,m),x.scale(n,n,-1),x.normalize(n,n),this.makeOrthoFromBoundingBox(e,n,u,o),this._debug&&h.invert(this._debugNodeFrustum.getMatrix(),u);else{h.mul(this._tmpMatrix,m,s);var v=this._tmpMatrix;x.transformMat4(n,r.getPosition(),v),v[12]=0,v[13]=0,v[14]=0,h.invert(v,v),h.transpose(v,v),x.copy(a,r.getDirection()),b.transformMat4(a,a,v),x.normalize(a,a),this.makePerspectiveFromBoundingBox(e,r.getSpotCutoff(),n,a,u,o)}h.copy(i.getProjectionMatrix(),this._projectionMatrix),h.copy(i.getViewMatrix(),this._viewMatrix)},frameShadowCastingFrustum:function(t){this._infiniteFrustum||n.prototype.clampProjectionMatrix(this._projectionMatrix,this._depthRange[0],this._depthRange[1],t.getNearFarRatio(),this._depthRange);var e=this._cameraShadow;h.copy(e.getProjectionMatrix(),this._projectionMatrix),h.copy(e.getViewMatrix(),this._viewMatrix),this.setShadowUniformsDepthValue(!1)},setShadowUniformsDepthValue:function(t){if(t?b.set(this._depthRange,0,0,0,0):(this._depthRange[2]=this._depthRange[1]-this._depthRange[0],this._depthRange[3]=1/this._depthRange[2]),this._lightNumberArrayIndex!==-1){var e=this._light.getLightNumber();this._texture.setViewMatrix(e,this._viewMatrix),this._texture.setProjectionMatrix(e,this._projectionMatrix),this._texture.setDepthRange(e,this._depthRange)}else this._texture.setViewMatrix(this._viewMatrix),this._texture.setProjectionMatrix(this._projectionMatrix),this._texture.setDepthRange(this._depthRange)},noDraw:function(){var t=this._casterStateSet.getUniformList();t.uShadowDepthRange.getUniform().setVec4(this._depthRange);var e=this._cameraShadow;h.copy(this._projectionMatrix,e.getProjectionMatrix()),h.copy(this._viewMatrix,e.getViewMatrix()),this.setShadowUniformsDepthValue(!0),this._filledOnce=!0},cullShadowCasting:function(t,e){if(this._debug){var r=e.getMin(),i=e.getMax();e.center(this._tmpVec);var n=this._debugNodeSceneCast.getMatrix();h.fromScaling(n,[i[0]-r[0],i[1]-r[1],i[2]-r[2],1]),h.setTranslation(n,this._tmpVec)}if(this._emptyCasterScene=!1,this.aimShadowCastingCamera(t,e),this._emptyCasterScene)return void this.noDraw();var a=t.getTraversalMask();t.setTraversalMask(this._castsShadowDrawTraversalMask),t.pushStateSet(this._casterStateSet),this._cameraShadow.setEnableFrustumCulling(!0),this._cameraShadow.setComputeNearFar(!0),this._debug&&this._debugNode.accept(t),this._cameraShadow.accept(t),this.nearFarBounding(),this.frameShadowCastingFrustum(t),this._cameraShadow.setComputeNearFar(!1),t.popStateSet(),t.setTraversalMask(a),this._filledOnce=!0},cleanReceivingStateSet:function(t){if(this._receivingStateset){if(this._receivingStateset.getAttribute(this._shadowReceiveAttribute.getTypeMember())===this._shadowReceiveAttribute&&this._receivingStateset.removeAttribute(this._shadowReceiveAttribute.getTypeMember()),t)return;this._texture&&this._receivingStateset.getTextureAttribute(this._textureUnit,this._texture.getTypeMember())===this._texture&&this._receivingStateset.removeTextureAttribute(this._textureUnit,this._texture.getTypeMember())}},cleanSceneGraph:function(t){this._cameraShadow=void 0,this._filledOnce=!1,this.cleanReceivingStateSet(t),this._texture=void 0,this._shadowedScene=void 0},setDebug:function(t){t&&!this._debug&&(this._debugNode||(this._debugGeomFrustum=f.createDebugFrustumGeometry(),this._debugGeomSceneCast=l.createBoundingBoxGeometry(),this._debugGeomSceneCast.getPrimitives()[0].mode=S.LINES,this._debugNode=new u,this._debugNodeFrustum=new u,this._debugNodeSceneCast=new u,this._debugNodeFrustum.addChild(this._debugGeomFrustum),this._debugNodeSceneCast.addChild(this._debugGeomSceneCast),this._debugNode.addChild(this._debugNodeFrustum),this._debugNode.addChild(this._debugNodeSceneCast))),this._debug=t},getDebug:function(){return this._debug},getLightNumber:function(){return this._light.getLightNumber()},getLight:function(){return this._light}}),"osgShadow","ShadowMap"),E.EPSILON=.005,t.exports=E},function(t,e,r){"use strict";var i=r(7),n=r(30),a=r(41),s=function(t,e){n.call(this),this._lightNumber=t,this._bias=.001,this._normalBias=void 0,this._precision="UNSIGNED_BYTE",this._kernelSizePCF=void 0,this._fakePCF=!0,this._rotateOffset=!1,this._enable=!e,this._isAtlasTexture=!1,this._dirtyHash=!0,this._hash=""};s.uniforms={},i.createPrototypeStateAttribute(s,i.objectInherit(n.prototype,{attributeType:"ShadowReceive",cloneType:function(){return new s(this._lightNumber,!0)},getTypeMember:function(){return this.attributeType+this.getLightNumber()},getLightNumber:function(){return this._lightNumber},getUniformName:function(t){var e=this.getType()+this.getLightNumber().toString();return"u"+e+"_"+t},getAtlas:function(){return this._isAtlasTexture},setAtlas:function(t){this._isAtlasTexture=t},setBias:function(t){this._bias=t},getBias:function(){return this._bias},setNormalBias:function(t){this._normalBias=t},getNormalBias:function(){return this._normalBias},getKernelSizePCF:function(){return this._kernelSizePCF},setKernelSizePCF:function(t){this._kernelSizePCF=t,this._dirtyHash=!0},setPrecision:function(t){this._precision=t,this._dirtyHash=!0},getPrecision:function(){return this._precision},setLightNumber:function(t){this._lightNumber=t,this._dirtyHash=!0},getOrCreateUniforms:function(){var t=s,e=this.getTypeMember();return t.uniforms[e]?t.uniforms[e]:(t.uniforms[e]={bias:a.createFloat(this.getUniformName("bias")),normalBias:a.createFloat(this.getUniformName("normalBias"))},t.uniforms[e])},getDefines:function(){var t=[],e=this.getKernelSizePCF();switch(e){case"4Tap(16texFetch)":t.push("#define _PCFx4");break;case"9Tap(36texFetch)":t.push("#define _PCFx9");break;case"16Tap(64texFetch)":t.push("#define _PCFx25");break;default:case"1Tap(4texFetch)":t.push("#define _PCFx1")}return"UNSIGNED_BYTE"!==this.getPrecision()&&t.push("#define _FLOATTEX"),this.getAtlas()&&t.push("#define _ATLAS_SHADOW"),this.getNormalBias()&&t.push("#define _NORMAL_OFFSET"),t},apply:function(){if(this._enable){var t=this.getOrCreateUniforms();t.normalBias.setFloat(this._normalBias),t.bias.setFloat(this._bias)}},isEnabled:function(){return this._enable},getHash:function(){return this._dirtyHash?(this._hash=this._computeInternalHash(),this._dirtyHash=!1,this._hash):this._hash},_computeInternalHash:function(){return this.getTypeMember()+"_"+this.getKernelSizePCF()}}),"osgShadow","ShadowReceiveAttribute"),t.exports=s},function(t,e,r){"use strict";var i=r(9),n=r(13),a=r(7),s=function(){n.call(this),this._shadowedScene=void 0,this._dirty=!1,this._enabled=!0,this._filledOnce=!1};a.createPrototypeObject(s,a.objectInherit(n.prototype,{dirty:function(){this._dirty=!0},getShadowedScene:function(){return this._shadowedScene},setEnabled:function(t){this._enabled=t},isEnabled:function(){return this._enabled},isFilledOnce:function(){return this._filledOnce},requestRedraw:function(){this._filledOnce=!1},setShadowedScene:function(t){this._shadowedScene=t},init:function(){i.log("No ShadowTechnique activated: normal rendering activated")},valid:function(){return!1},updateShadowTechnique:function(){},cullShadowCasting:function(){},cleanSceneGraph:function(){i.log("No ShadowTechnique activated: normal rendering activated")}}),"osgShadow","ShadowTechnique"),t.exports=s},function(t,e,r){"use strict";var i=r(9),n=r(40),a=r(41),s=r(7),o=r(15).vec4,h=function(){n.call(this),this._uniforms={},this._mapSize=o.create(),this._renderSize=o.create(),this._lightNumber=-1,this._dirtyHash=!0,this._hash=""};h.uniforms={},s.createPrototypeStateAttribute(h,s.objectInherit(n.prototype,{cloneType:function(){return new h},invalidate:function(){n.prototype.invalidate.call(this),this.dirty()},hasLightNumber:function(t){return this._lightNumber===t},setLightNumber:function(t){this._lightNumber=t,this._dirtyHash=!0},getLightNumber:function(){return this._lightNumber},getUniformName:function(t){var e="Shadow_"+this.getType()+this._lightNumber.toString();return"u"+e+"_"+t},setInternalFormatType:function(t){n.prototype.setInternalFormatType.call(this,t),this._dirtyHash=!0},getOrCreateUniforms:function(t){var e=h;if(i.assert(void 0!==t),i.assert(this._lightNumber!==-1),void 0!==e.uniforms[t])return e.uniforms[t];var r=e.uniforms[t]={ViewMatrix:a.createMat4(this.getUniformName("viewMatrix")),ProjectionMatrix:a.createMat4(this.getUniformName("projectionMatrix")),DepthRange:a.createFloat4(this.getUniformName("depthRange")),MapSize:a.createFloat4(this.getUniformName("mapSize")),RenderSize:a.createFloat4(this.getUniformName("renderSize"))},n="Texture"+t,s=a.createInt1(t,n);return r[n]=s,e.uniforms[t]},setViewMatrix:function(t){this._viewMatrix=t},setProjectionMatrix:function(t){this._projectionMatrix=t},setDepthRange:function(t){this._depthRange=t},setTextureSize:function(t,e){n.prototype.setTextureSize.call(this,t,e),this.dirty(),this._mapSize[0]=t,this._mapSize[1]=e,this._mapSize[2]=1/t,this._mapSize[3]=1/e,this._renderSize[0]=t,this._renderSize[1]=e,this._renderSize[2]=1/t,this._renderSize[3]=1/e},apply:function(t,e){if(n.prototype.apply.call(this,t,e),this._lightNumber!==-1){var r=this.getOrCreateUniforms(e);r.ViewMatrix.setMatrix4(this._viewMatrix),r.ProjectionMatrix.setMatrix4(this._projectionMatrix),r.DepthRange.setFloat4(this._depthRange),r.MapSize.setFloat4(this._mapSize),r.RenderSize.setFloat4(this._renderSize)}},getHash:function(){return this._dirtyHash?(this._hash=this._computeInternalHash(),this._dirtyHash=!1,this._hash):this._hash},_computeInternalHash:function(){return this.getTypeMember()+"_"+this._lightNumber+"_"+this._type}}),"osgShadow","ShadowTexture"),t.exports=h},function(t,e,r){"use strict";var i=r(9),n=r(15).vec4,a=r(54),s=r(7),o=r(245),h=r(248),u=r(243),c=r(40),l=r(71),d=r(41),_=r(129),f=function(t){this._lights=[],this._shadowMaps=[],this._viewportDimension=[],o.apply(this,arguments),this._shadowSettings=t,this._texture=new h,this._textureUnitBase=4,this._textureUnit=this._textureUnitBase,this._textureMagFilter=void 0,this._textureMinFilter=void 0,this._textureSize=1024,this._shadowMapSize=256,this._receivingStateset=void 0,this._shaderProcessor=void 0,t&&(this.setShadowSettings(t),t.atlasSize&&(this._textureSize=t.atlasSize),t.textureSize&&(this._shadowMapSize=t.textureSize)),this._texelSizeUniform=d.createFloat1(1/this._textureSize,"texelSize");var e=d.createFloat2("RenderSize");this._renderSize=e.getInternalArray(),this._renderSize[0]=this._renderSize[1]=this._textureSize,this._numShadowWidth=this._textureSize/this._shadowMapSize,this._numShadowHeight=this._textureSize/this._shadowMapSize,this._cameraClear=new a,this._cameraClear.setName("shadowAtlasCameraClear"),this._cameraClear.setRenderOrder(a.PRE_RENDER,0),this._cameraClear.setClearColor(n.fromValues(1,1,1,1)),this._cameraClear.setFrameBufferObject(new l)};s.createPrototypeObject(f,s.objectInherit(o.prototype,{getTexture:function(){return this._texture},isDirty:function(t){if(void 0!==t)return this._shadowMaps[t].isDirty();for(var e=0,r=this._shadowMaps.length;e<r;e++)if(this._shadowMaps[e].isDirty())return!0;return!1},setTextureUnitBase:function(t){this._textureUnitBase=t,this._textureUnit=t;for(var e=0,r=this._shadowMaps.length;e<r;e++)this._shadowMaps[e].setTextureUnitBase(t)},setShadowSettings:function(t){if(t){this._shadowSettings=t;for(var e=0,r=this._shadowMaps.length;e<r;e++)this._shadowMaps[e].setShadowSettings(t);this.setTextureSize(t.textureSize),this.setTexturePrecision(t.textureType)}},setCastsShadowDrawTraversalMask:function(t){for(var e=0,r=this._shadowMaps.length;e<r;e++)this._shadowMaps[e].setCastsShadowDrawTraversalMask(t)},getCastsShadowDrawTraversalMask:function(t){return void 0!==t?this._shadowMaps[t].getCastsShadowDrawTraversalMask():0!==this._shadowMaps.length?this._shadowMaps[0].getCastsShadowDrawTraversalMask():void 0},setCastsShadowBoundsTraversalMask:function(t){for(var e=0,r=this._shadowMaps.length;e<r;e++)this._shadowMaps[e].setCastsShadowBoundsTraversalMask(t)},getCastsShadowBoundsTraversalMask:function(t){return void 0!==t?this._shadowMaps[t].getCastsShadowDrawTraversalMask():0!==this._shadowMaps.length?this._shadowMaps[0].getCastsShadowDrawTraversalMask():void 0},getNormalBias:function(t){return void 0!==t?this._shadowMaps[t].getNormalBias():0!==this._shadowMaps.length?this._shadowMaps[0].getNormalBias():void 0},setNormalBias:function(t){for(var e=0,r=this._shadowMaps.length;e<r;e++)this._shadowMaps[e].setNormalBias(t)},getBias:function(t){return void 0!==t?this._shadowMaps[t].getBias():0!==this._shadowMaps.length?this._shadowMaps[0].getBias():void 0},setBias:function(t){for(var e=0,r=this._shadowMaps.length;e<r;e++)this._shadowMaps[e].setBias(t)},getKernelSizePCF:function(t){return void 0!==t?this._shadowMaps[t].getKernelSizePCF():1!==this._shadowMaps.length?this._shadowMaps[0].getKernelSizePCF():void 0},setKernelSizePCF:function(t){for(var e=0,r=this._shadowMaps.length;e<r;e++)this._shadowMaps[e].setKernelSizePCF(t)},setShadowedScene:function(t){o.prototype.setShadowedScene.call(this,t),this._receivingStateset=this._shadowedScene.getReceivingStateSet();for(var e=0,r=this._shadowMaps.length;e<r;e++)this._shadowMaps[e].setShadowedScene(t)},setTexturePrecision:function(t){for(var e=0,r=this._shadowMaps.length;e<r;e++)this._shadowMaps[e].setTexturePrecision(t)},getTexturePrecision:function(t){return void 0!==t?this._shadowMaps[t].getTexturePrecision():1!==this._shadowMaps.length?this._shadowMaps[0].getTexturePrecision():void 0},setTextureSize:function(t){t!==this._textureSize&&(this._shadowMapSize=t,this._numShadowWidth=this._textureSize/this._shadowMapSize,this._numShadowHeight=this._textureSize/this._shadowMapSize,this.dirty())},getShadowMap:function(t){return this._shadowMaps[t]},addLight:function(t){if(!t||this._lights.indexOf(t)!==-1)return i.warn("no light or light already added"),-1;var e=this._lights.length;if(e===this._numShadowWidth*this._numShadowHeight)return void i.warn("can't allocate shadow for light "+t.getLightNumber()+" ShadowAtlas already full ");this._lights.push(t),this._shadowSettings.setLight(t);var r=new u(this._shadowSettings,this._texture);return this._shadowMaps.push(r),this._shadowedScene&&r.setShadowedScene(this._shadowedScene),this.recomputeViewports(),r},init:function(){if(this._shadowedScene){this.initTexture();for(var t=[],e=0;e<this._lights.length;e++)t.push(this._lights[e].getLightNumber());this._texture.setLightNumberArray(t),this._textureUnit=this._textureUnitBase,this._texture.setName("ShadowTexture"+this._textureUnit);var r=d.createFloat2("RenderSize");this._texelSizeUniform=d.createFloat1(1/this._textureSize,"texelSize"),this._renderSize=r.getInternalArray(),this._renderSize[0]=this._renderSize[1]=this._textureSize,this.recomputeViewports();for(var i=0,n=this._shadowMaps.length;i<n;i++){var a=this._shadowMaps[i];this._shadowedScene||(this._shadowedScene=a.getShadowedScene(this._shadowedScene)),this._shadowedScene&&a.setShadowedScene(this._shadowedScene),a.init(this._texture,i,this._textureUnitBase),a.getCamera().setClearMask(0)}}},recomputeViewports:function(){for(var t=this._shadowMaps.length,e=t>2?Math.sqrt(2*Math.ceil(t/2)):t,r=e,i=this._textureSize/r,a=this._textureSize/e,s=this._textureSize/i,o=this._textureSize/a,h=0;h<t;h++){var u=this._shadowMaps[h],c=i*(h%s),l=a*Math.floor(h/o);this._viewportDimension.length<=h?this._viewportDimension.push(n.fromValues(c,l,i,a)):n.set(this._viewportDimension[h],c,l,i,a),this._texture.setLightShadowMapSize(this._lights[h].getLightNumber(),this._viewportDimension[h]),this._viewportDimension.length<=h?this._viewportDimension.push(n.fromValues(c,l,i,a)):n.set(this._viewportDimension[h],c,l,i,a),u.dirty()}},valid:function(){return!0},updateCameraClear:function(){var t=this._cameraClear,e=this._texture;if(t&&e){var r=t.getViewport();r||(r=new _,t.setViewport(r)),r.width()===e.getWidth()&&r.height()===e.getHeight()||(t.detachAll(),t.attachTexture(l.COLOR_ATTACHMENT0,e),t.attachRenderBuffer(l.DEPTH_ATTACHMENT,l.DEPTH_COMPONENT16),t.getViewport().setViewport(0,0,e.getWidth(),e.getHeight()))}},updateShadowTechnique:function(t){this.updateCameraClear();for(var e=0,r=this._shadowMaps.length;e<r;e++)this._shadowMaps[e].updateShadowTechnique(t,this._viewportDimension[e],this._cameraClear.getFrameBufferObject())},initTexture:function(){if(this._dirty){this._texture||(this._texture=new h,this._textureUnit=this._textureUnitBase),this._texture.setTextureSize(this._textureSize,this._textureSize),this._texelSizeUniform.setFloat(1/this._textureSize),this._renderSize[0]=this._textureSize,this._renderSize[1]=this._textureSize;var t;t=c.RGBA,u.prototype.setTextureFiltering.call(this),this._texture.setInternalFormat(t),this._texture.setWrapS(c.CLAMP_TO_EDGE),this._texture.setWrapT(c.CLAMP_TO_EDGE),this._texture.dirty()}},cullShadowCasting:function(t,e){this._cameraClear.accept(t);for(var r=0,i=this._shadowMaps.length;r<i;r++)this._shadowMaps[r].cullShadowCasting(t,e)},removeShadowMap:function(t){if(this._shadowMaps.length>0){var e=this._shadowMaps.indexOf(t);if(e!==-1){this._shadowMaps[e].valid()&&this._shadowMaps[e].cleanSceneGraph(!0),this._shadowMaps.splice(e,1);var r=this._texture.getLightNumberArray();e=r.indexOf(t.getLightNumber()),e!==-1&&r.splice(e,1);var i=t.getLight();e=this._lights.indexOf(i),e!==-1&&this._lights.splice(e,1),this.recomputeViewports()}}},addShadowMap:function(t){if(!(this._shadowMaps.length>0&&this._shadowMaps.indexOf(t)!==-1)){this._shadowMaps.push(t);var e=t.getLight();this._lights.indexOf(e)===-1&&this._lights.push(e),this._shadowedScene&&t.setShadowedScene(this._shadowedScene);var r=this._texture.getLightNumberArray();r.indexOf(t.getLightNumber())===-1&&r.push(e.getLightNumber()),this.recomputeViewports()}},cleanReceivingStateSet:function(){if(this._receivingStateset){this._texture&&this._receivingStateset.getTextureAttribute(this._textureUnit,this._texture.getTypeMember())===this._texture&&this._receivingStateset.removeTextureAttribute(this._textureUnit,this._texture.getTypeMember());for(var t=0,e=this._shadowMaps.length;t<e;t++)this._shadowMaps[t].cleanReceivingStateSet()}},cleanSceneGraph:function(){this._texture=void 0,this._shadowedScene=void 0},setDebug:function(t,e){if(e)this._shadowMaps[e].setDebug(t);else for(var r=0,i=this._shadowMaps.length;r<i;r++)this._shadowMaps[r].setDebug(t)}}),"osgShadow","ShadowMapAtlas"),t.exports=f},function(t,e,r){"use strict";var i=r(9),n=r(40),a=r(41),s=r(7),o=r(15).vec4,h=function(){n.call(this),this._uniforms={},this._lightNumberArray=[],this._viewMatrices=[],this._projectionMatrices=[],this._depthRanges=[],this._mapSizes=[],this._renderSize=o.create(),this._dirtyHash=!0,this._hash=""};h.uniforms={},s.createPrototypeStateAttribute(h,s.objectInherit(n.prototype,{cloneType:function(){return new h},getLightNumberArray:function(){return this._lightNumberArray},hasLightNumber:function(t){return this._lightNumberArray.indexOf(t)!==-1},setLightNumberArray:function(t){this._lightNumberArray=t,this._dirtyHash=!0},getUniformName:function(t,e){var r="Shadow_"+this.getType()+t.toString();return"u"+r+"_"+e},setInternalFormatType:function(t){n.prototype.setInternalFormatType.call(this,t),this._dirtyHash=!0},createUniforms:function(t,e){e["ViewMatrix_"+t]=a.createMat4(this.getUniformName(t,"viewMatrix")),e["ProjectionMatrix_"+t]=a.createMat4(this.getUniformName(t,"projectionMatrix")),e["DepthRange_"+t]=a.createFloat4(this.getUniformName(t,"depthRange")),e["MapSize_"+t]=a.createFloat4(this.getUniformName(t,"mapSize")),e["RenderSize_"+t]=e.RenderSize},getOrCreateUniforms:function(t){var e=h;if(i.assert(void 0!==t||0!==this._lightNumberArray.length),void 0!==e.uniforms[t])return e.uniforms[t];var r=e.uniforms[t]={},n=a.createFloat4(this.getUniformName(0,"renderSize"));r.RenderSize=n;for(var s=0,o=this._lightNumberArray.length;s<o;s++)this.createUniforms(this._lightNumberArray[s],r);var u="Texture"+t,c=a.createInt1(t,u);return r[u]=c,e.uniforms[t]},setViewMatrix:function(t,e){this._viewMatrices[t]=e},setProjectionMatrix:function(t,e){this._projectionMatrices[t]=e},setDepthRange:function(t,e){this._depthRanges[t]=e},setLightShadowMapSize:function(t,e){this._mapSizes[t]=e},apply:function(t,e){if(n.prototype.apply.call(this,t,e),0!==this._lightNumberArray.length){for(var r=this.getOrCreateUniforms(e),i=0,a=this._lightNumberArray.length;i<a;i++){var s=this._lightNumberArray[i];r["ViewMatrix_"+s]||this.createUniforms(s,r),r["ViewMatrix_"+s].setMatrix4(this._viewMatrices[s]),r["ProjectionMatrix_"+s].setMatrix4(this._projectionMatrices[s]),r["DepthRange_"+s].setFloat4(this._depthRanges[s]),r["MapSize_"+s].setFloat4(this._mapSizes[s]),r["RenderSize_"+s].setFloat4(this._renderSize)}r.RenderSize.setFloat4(this._renderSize)}},setTextureSize:function(t,e){this._renderSize[0]=t,this._renderSize[1]=e,this._renderSize[2]=1/t,this._renderSize[3]=1/e,n.prototype.setTextureSize.call(this,t,e),this.dirty()},_computeInternalHash:function(){for(var t=this.getTypeMember(),e=0,r=this._lightNumberArray.length;e<r;e++)t+="_"+this._lightNumberArray[e];return t+="_"+this._type},getHash:function(){return this._dirtyHash?(this._hash=this._computeInternalHash(),this._dirtyHash=!1,this._hash):this._hash}}),"osgShadow","ShadowTextureAtlas"),t.exports=h},function(t,e,r){"use strict";var i=r(7),n=r(40),a=["1Tap(4texFetch)","4Tap(16texFetch)","9Tap(36texFetch)","16Tap(64texFetch)"],s=function(t){this.castsShadowDrawTraversalMask=4294967295,this.castsShadowBoundsTraversalMask=4294967295,this.textureSize=1024,this.textureType="UNSIGNED_BYTE",this.textureFormat=n.RGBA,this.shadowProjection="fov",this.fov=50,this.kernelSizePCF="4Tap(4texFetch)",this.bias=.005,this.normalBias=void 0,this.shadowCastShaderGeneratorName="ShadowCast",i.objectMix(this,t)};s.kernelSizeList=a,s.prototype={setCastsShadowDrawTraversalMask:function(t){this.castsShadowDrawTraversalMask=t},getCastsShadowDrawTraversalMask:function(){return this.castsDrawShadowTraversalMask},setCastsShadowBoundsTraversalMask:function(t){this.castsShadowBoundsTraversalMask=t},getCastsShadowBoundsTraversalMask:function(){return this.castsShadowBoundsTraversalMask},setLight:function(t){this.light=t},getLight:function(){return this.light},setTextureSize:function(t){this.textureSize=t},getTextureSize:function(){return this.textureSize},setTextureType:function(t){this.textureType=t},getTextureType:function(){return this.textureType},setTextureFormat:function(t){this.textureFormat=t},getTextureFormat:function(){return this.textureFormat},setShadowCastShaderGeneratorName:function(t){this.shadowCastShaderGeneratorName=t},getShadowCastShaderGeneratorName:function(){return this.shadowCastShaderGeneratorName}},t.exports=s},function(t,e,r){"use strict";var i=r(63),n=r(15).mat4,a=r(12),s=r(31),o=r(29),h=r(7),u=r(15).vec4,c=r(35),l=r(241),d=function(t){a.call(this),this._shadowTechniques=[],this._optimizedFrustum=!1,this._frustumReceivers=[u.create(),u.create(),u.create(),u.create(),u.create(),u.create()],this._tmpMat=n.create(),this._receivingStateset=new o,this._computeBoundsVisitor=new c,this._castsShadowDrawTraversalMask=4294967295,this._castsShadowBoundsTraversalMask=4294967295,t&&this.setShadowSettings(t)};h.createPrototypeNode(d,h.objectInherit(a.prototype,{getReceivingStateSet:function(){return this._receivingStateset},getShadowTechniques:function(){return this._shadowTechniques},addShadowTechnique:function(t){this._shadowTechniques.length>0&&this._shadowTechniques.indexOf(t)!==-1||(this._shadowTechniques.push(t),t.valid()&&(t.setShadowedScene(this),t.dirty()))},removeShadowTechnique:function(t){if(this._shadowTechniques.length>0){var e=this._shadowTechniques.indexOf(t);e!==-1&&(this._shadowTechniques[e].valid()&&this._shadowTechniques[e].cleanSceneGraph(),this._shadowTechniques.splice(e,1))}},cleanSceneGraph:function(){for(var t=0,e=this._shadowTechniques.length;t<e;t++)this._shadowTechniques[t]&&this._shadowTechniques[t].valid()&&this._shadowTechniques[t].cleanSceneGraph()},dirty:function(){for(var t=0;t<this._shadowTechniques.length;t++)this._shadowTechniques[t].dirty()},nodeTraverse:function(t){a.prototype.traverse.call(this,t)},setShadowSettings:function(t){this._settings=t,this.setCastsShadowDrawTraversalMask(t.castsShadowDrawTraversalMask),this.setCastsShadowBoundsTraversalMask(t.castsShadowBoundsTraversalMask),t.userShadowCasterVisitor!==!1&&(this._removeNodesNeverCastingVisitor=t.userShadowCasterVisitor||new l(this._castsShadowTraversalMask))},setCastsShadowDrawTraversalMask:function(t){this._castsShadowDrawTraversalMask=t},getCastsShadowDrawTraversalMask:function(){return this._castsDrawShadowTraversalMask},setCastsShadowBoundsTraversalMask:function(t){this._castsShadowBoundsTraversalMask=t},getCastsShadowBoundsTraversalMask:function(){return this._castsShadowBoundsTraversalMask},computeShadowedSceneBounds:function(){this._removeNodesNeverCastingVisitor&&(this._removeNodesNeverCastingVisitor.setNoCastMask(~(this._castsShadowBoundsTraversalMask|this._castsShadowDrawTraversalMask)),this._removeNodesNeverCastingVisitor.reset(),this.accept(this._removeNodesNeverCastingVisitor)),this._computeBoundsVisitor.setTraversalMask(this._castsShadowBoundsTraversalMask),this._computeBoundsVisitor.reset(),this.accept(this._computeBoundsVisitor);var t=this._computeBoundsVisitor.getBoundingBox();return!!t.valid()||(this._removeNodesNeverCastingVisitor&&this._removeNodesNeverCastingVisitor.restore(),!1)},traverse:function(t){if(t.getVisitorType()===s.CULL_VISITOR){var e,r,i=this._shadowTechniques.length;i&&t.pushStateSet(this._receivingStateset),this.nodeTraverse(t),i&&t.popStateSet();var n=!1;for(e=0;e<i;e++)r=this._shadowTechniques[e],r&&r.valid()&&(r.isDirty()&&(n=!0,r.init()),!r.isEnabled()&&r.isFilledOnce()||(n=!0));if(!n)return;var a=this.computeShadowedSceneBounds(t);if(!a){for(e=0;e<i;e++)r=this._shadowTechniques[e],r.noDraw();return}var o=this._computeBoundsVisitor.getBoundingBox(),h=t.getCurrentModelMatrix();for(o.transformMat4(o,h),e=0;e<i;e++)r=this._shadowTechniques[e],!r.isEnabled()&&r.isFilledOnce()||(r.updateShadowTechnique(t),r.cullShadowCasting(t,o));this._removeNodesNeverCastingVisitor&&this._removeNodesNeverCastingVisitor.restore()}else this.nodeTraverse(t)}}),"osgShadow","ShadowedScene"),i.registerApplyFunction(d.nodeTypeID,i.getApplyFunction(a.nodeTypeID)),t.exports=d},function(t,e,r){var i={Stats:r(231),BufferStats:r(232),Graph:r(233),TextGenerator:r(235),Counter:r(234),defaultStats:r(236),browserStats:r(238),glStats:r(237)};t.exports=i},function(t,e,r){"use strict";var i=r(159),n={};n.Text=i,t.exports=n},function(t,e,r){"use strict";var i=r(156),n=r(157),a=r(158),s={};s.osg=i,s.osgAnimation=n,s.osgText=a,t.exports=s},function(t,e,r){"use strict";var i=r(255),n=r(256),a={};a.ReaderWriterGLTF=i,a.ReaderWriterZIP=n,t.exports=a},function(t,e,r){"use strict";var i=r(95),n=r(149),a=r(148),s=r(154),o=r(133),h=r(137),u=r(75),c=r(77),l=r(146),d=r(143),_=r(145),f=r(81),g=r(134),p=g.createQuatChannel,m=g.createVec3Channel,v=r(53),S=r(36),x=r(40),b=r(64),y=r(101),M=r(45),T=r(46),A=r(48),C=r(78),I=r(79),w=r(160),E=r(41),N=r(15).vec3,R=r(15).quat,F=r(15).mat4,P=function(){this._filesMap=void 0,this._loadedFiles=void 0,this._bufferViewCache=void 0,this._basicAnimationManager=void 0,this._visitedNodes=void 0,this._animatedNodes=void 0,this._skeletons=void 0,this._bones=void 0,this._skeletonToInfluenceMap=void 0,this._inputImgReader=void 0,this._localPath="",this.init()};P.WEBGL_COMPONENT_TYPES={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},P.TYPE_TABLE={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},P.TEXTURE_FORMAT={6406:x.ALPHA,6407:x.RGB,6408:x.RGBA,6409:x.LUMINANCE,6410:x.LUMINANCE_ALPHA},P.PBR_SPEC_EXT="KHR_materials_pbrSpecularGlossiness",P.PBR_SPEC_MODE="PBR_specular_glossiness",P.PBR_METAL_MODE="PBR_metal_roughness",P.ALBEDO_TEXTURE_UNIT=2,P.DIFFUSE_TEXTURE_UNIT=2,P.SPECULAR_GLOSSINESS_TEXTURE_UNIT=3,P.METALLIC_ROUGHNESS_TEXTURE_UNIT=3,P.SPECULAR_TEXTURE_UNIT=4,P.NORMAL_TEXTURE_UNIT=5,P.AO_TEXTURE_UNIT=6,P.EMISSIVE_TEXTURE_UNIT=7,P.ALBEDO_UNIFORM="albedoMap",P.METALLIC_ROUGHNESS_UNIFORM="metallicRoughnessMap",P.SPECULAR_UNIFORM="specularMap",P.NORMAL_UNIFORM="normalMap",P.AO_UNIFORM="aoMap",P.EMISSIVE_UNIFORM="emissiveMap",P.prototype={init:function(){this._glTFJSON=void 0,this._bufferViewCache={},this._basicAnimationManager=void 0,this._localPath="",this._visitedNodes={},this._animatedNodes={},this._skeletons={},this._bones={},this._skeletonToInfluenceMap={},this._stateSetMap={},this._filesMap=new window.Map,this._inputReader=new a},loadFile:i.method(function(t){if(this._filesMap.has(t))return this._filesMap.get(t);var e,r=t.substr(t.lastIndexOf(".")+1),i=w.getTypeForExtension(r),n=this._localPath+t;return"blob"===i?e=this._inputReader.readImageURL(n,{imageLoadingUsePromise:!0}):"arraybuffer"===i&&(e=this._inputReader.readBinaryArrayURL(n,{fileType:i})),this._filesMap.set(t,e),e.then(function(t){return t}),e}),loadAccessorBuffer:function(t,e){var r=this._glTFJSON,i=r.bufferViews[t.bufferView],n=r.buffers[i.buffer],a=this.loadFile(n.uri),s=this;return a.then(function(r){return s.assignBuffers(r,t,e,i)})},assignBuffers:i.method(function(t,e,r,i){if(!t)return null;var n=P.WEBGL_COMPONENT_TYPES[e.componentType],a=null;this._bufferViewCache[e.bufferView]||(this._bufferViewCache[e.bufferView]=t.slice(i.byteOffset,i.byteOffset+i.byteLength));var s=this._bufferViewCache[e.bufferView];return a=new n(s,e.byteOffset,e.count*P.TYPE_TABLE[e.type]),r?new A(r,a,P.TYPE_TABLE[e.type],!0):a}),findByKey:function(t,e){return t&&t[e]},registerUpdateCallback:function(t,e){var r=this._glTFJSON,i=null;i=r.nodes[t].jointName?new C:new I,i.setName(t);var n=N.create();F.getTranslation(n,e.getMatrix());var a=R.create();F.getRotation(a,e.getMatrix());var s=N.create();F.getScale(s,e.getMatrix()),i.getStackedTransforms().push(new l("translation",n)),i.getStackedTransforms().push(new d("rotation",a)),i.getStackedTransforms().push(new _("scale",s)),e.addUpdateCallback(i)},createTextureAndSetAttrib:i.method(function(t,e,r,i){if(t){var n=this._glTFJSON,a=n.textures[t.index];if(a){var s=n.images[a.source];if(s){var o=new x;o.setFlipY(!1),o.setWrapS("REPEAT"),o.setWrapT("REPEAT"),this.loadFile(s.uri).then(function(t){t&&(o.setImage(t,P.TEXTURE_FORMAT[a.format]),e.setTextureAttributeAndModes(r,o),i&&e.addUniform(E.createInt(r,i)))})}}}}),loadTransform:function(t){var e=F.create();if(t.matrix)return F.copy(e,t.matrix),e;var r=t.scale||N.ONE,i=t.rotation||R.IDENTITY,n=t.translation||N.ZERO;
return F.fromRotationTranslationScale(e,i,n,r),e},preprocessChannel:function(t,e){var r=this._glTFJSON,n=[],a=e.samplers[t.sampler],s=r.accessors[a.input],o=r.accessors[a.output],h=this.loadAccessorBuffer(s,null),u=this.loadAccessorBuffer(o,null);n.push(h,u);var c=this;return i.all(n).then(function(e){var r=e[0],i=e[1],n=null;return 4===P.TYPE_TABLE[o.type]?n=p(i,r,t.target.node,t.target.path,null):3===P.TYPE_TABLE[o.type]&&(n=m(i,r,t.target.node,t.target.path,null)),c._animatedNodes[t.target.node]=!0,n})},createAnimationFromChannels:function(t,e){return i.all(t).then(function(t){return o.createAnimation(t,e)})},preprocessAnimations:i.method(function(){var t=this._glTFJSON;if(t.animations){for(var e=[],r=window.Object.keys(t.animations),n=0;n<r.length;++n){for(var a=t.animations[r[n]],s=[],o=0;o<a.channels.length;++o){var u=a.channels[o],c=this.preprocessChannel(u,a);s.push(c)}var l=this.createAnimationFromChannels(s,r[n]);e.push(l)}var d=this;return i.all(e).then(function(t){var e=new h;e.init(t),d._basicAnimationManager=e,e.playAnimation(t[0].name)})}}),loadBone:function(t,e){var r=this._glTFJSON,i=r.nodes[t],n=this,a=r.accessors[e.inverseBindMatrices],s=this.loadAccessorBuffer(a,null);return s.then(function(r){for(var a=0;a<e.joints.length&&e.joints[a]!==i.jointName;++a);var s=new c(i.jointName),o=r.subarray(16*a,16*a+16);return s.setInvBindMatrixInSkeletonSpace(o),n._bones[t]=s,s})},buildInfluenceMap:function(t,e){if(!this._skeletonToInfluenceMap[t]){this._skeletonToInfluenceMap[t]={};for(var r=0;r<e.joints.length;r++){var i=e.joints[r];this._skeletonToInfluenceMap[t][i]=r}}},mapBonesToSkin:function(){for(var t=this._glTFJSON,e={},r=window.Object.keys(t.skins),i=0;i<r.length;++i)for(var n=t.skins[r[i]],a=0;a<n.joints.length;++a)for(var s=n.joints[a],o=window.Object.keys(t.nodes),h=0;h<o.length;++h){var u=t.nodes[o[h]];u.jointName&&u.jointName===s&&(e[o[h]]=n)}return e},preprocessBones:function(t){for(var e=this._glTFJSON,r=window.Object.keys(e.nodes),n=[],a=0;a<r.length;++a){var s=r[a],o=e.nodes[s];if(o.jointName){var h=this.loadBone(s,t[s]);n.push(h)}}return i.all(n)},preprocessSkeletons:i.method(function(){var t=this._glTFJSON;if(t.skins){for(var e=this.mapBonesToSkin(),r=window.Object.keys(t.nodes),i=0;i<r.length;++i){var n=r[i],a=t.nodes[n],s=t.skins[a.skin];if(a.skeletons)for(var o=0;o<a.skeletons.length;++o){for(var h=null,c=a.skeletons[o],l=0;l<r.length;++l){var d=r[l],_=t.nodes[d];if(_.jointName){var f=t.nodes[c];if(_.jointName===f.jointName){h=d;break}}}h&&!this._skeletons[h]&&(this._skeletons[c]=new u,e[h]=s),this.buildInfluenceMap(c,s)}}return this.preprocessBones(e)}}),loadPBRMaterial:i.method(function(t,e,r,n){var a=e.pbrMetallicRoughness,s=r.getOrCreateStateSet(),o=[],h="";return a&&(a.baseColorTexture&&o.push(this.createTextureAndSetAttrib(a.baseColorTexture,s,P.ALBEDO_TEXTURE_UNIT,P.ALBEDO_UNIFORM)),a.baseColorFactor&&s.addUniform(E.createFloat4(a.baseColorFactor,"uBaseColorFactor")),void 0!==a.metallicFactor&&s.addUniform(E.createFloat1(a.metallicFactor,"uMetallicFactor")),void 0!==a.roughnessFactor&&s.addUniform(E.createFloat1(a.roughnessFactor,"uRoughnessFactor")),a.metallicRoughnessTexture&&o.push(this.createTextureAndSetAttrib(a.metallicRoughnessTexture,s,P.METALLIC_ROUGHNESS_TEXTURE_UNIT,P.METALLIC_ROUGHNESS_UNIFORM)),h=P.PBR_METAL_MODE),n&&(n.diffuseFactor&&s.addUniform(E.createFloat4(n.diffuseFactor,"uBaseColorFactor")),void 0!==n.glossinessFactor&&s.addUniform(E.createFloat1(n.glossinessFactor,"uGlossinessFactor")),void 0!==n.specularFactor&&s.addUniform(E.createFloat3(n.specularFactor,"uSpecularFactor")),n.diffuseTexture&&o.push(this.createTextureAndSetAttrib(n.diffuseTexture,s,P.DIFFUSE_TEXTURE_UNIT,P.ALBEDO_UNIFORM)),n.specularGlossinessTexture&&o.push(this.createTextureAndSetAttrib(n.specularGlossinessTexture,s,P.SPECULAR_GLOSSINESS_TEXTURE_UNIT,P.METALLIC_ROUGHNESS_UNIFORM)),h=P.PBR_SPEC_MODE),e.normalTexture&&o.push(this.createTextureAndSetAttrib(e.normalTexture,s,P.NORMAL_TEXTURE_UNIT,P.NORMAL_UNIFORM)),e.occlusionTexture&&o.push(this.createTextureAndSetAttrib(e.occlusionTexture,s,P.AO_TEXTURE_UNIT,P.AO_UNIFORM)),void 0!==e.emissiveFactor&&s.addUniform(E.createFloat3(e.emissiveFactor,"uEmissiveFactor")),void 0!==e.emissiveTexture&&o.push(this.createTextureAndSetAttrib(e.emissiveTexture,s,P.EMISSIVE_TEXTURE_UNIT,P.EMISSIVE_UNIFORM)),r.setUserData({pbrWorklow:h}),r.stateset=s,s.setRenderingHint("TRANSPARENT_BIN"),s.setRenderBinDetails(1e3,"RenderBin"),s.setAttributeAndModes(new v("SRC_ALPHA","ONE_MINUS_SRC_ALPHA")),this._stateSetMap[t]=s,i.all(o)}),loadMaterial:i.method(function(t,e){var r=this._glTFJSON,i=r.materials[t];if(this._stateSetMap[t])return void(e.stateset=this._stateSetMap[t]);var n=this.findByKey(i.extensions,P.PBR_SPEC_EXT);if(i.pbrMetallicRoughness||n)return this.loadPBRMaterial(t,i,e,n);var a=i.values;if(a){var s=new y,o=e.getOrCreateStateSet();if(o.setAttribute(s),a.ambient&&s.setAmbient(a.ambient),a.emission&&s.setEmission(a.emission),a.shininess&&s.setShininess(a.shininess),a.specular&&s.setSpecular(a.specular),a.diffuse){if("string"==typeof a.diffuse)return this.createTextureAndSetAttrib(a.diffuse,o,0);s.setDiffuse(a.diffuse)}e.stateset=o,this._stateSetMap[t]=o}}),createGeometry:function(t,e){var r=this._glTFJSON,n=[],a=new S,s=a,o=function(t,e){e&&(this.getVertexAttributeList()[t]=e)};e&&(s=new f,s._boneNameID=this._skeletonToInfluenceMap[e]);for(var h=function(t){if(t){s.getAttributes().Weights=t;for(var e=s.getAttributes().Weights.getElements(),r=0,i=e.length/4;r<i;++r){var n=e[4*r]+e[4*r+1]+e[4*r+2]+e[4*r+3],a=1/n;e[4*r]*=a,e[4*r+1]*=a,e[4*r+2]*=a,e[4*r+3]*=a}}},u=window.Object.keys(t.attributes),c=0;c<u.length;++c){var l=r.accessors[t.attributes[u[c]]],d=this.loadAccessorBuffer(l,A.ARRAY_BUFFER);if(u[c].indexOf("POSITION")!==-1)d.then(o.bind(a,"Vertex"));else if(u[c].indexOf("NORMAL")!==-1)d.then(o.bind(a,"Normal"));else if(u[c].indexOf("TANGENT")!==-1)d.then(o.bind(a,"Tangent"));else if(u[c].indexOf("JOINT")!==-1)d.then(o.bind(s,"Bones"));else if(u[c].indexOf("WEIGHT")!==-1)d.then(h);else if(u[c].indexOf("COLOR")!==-1)d.then(o.bind(a,"Color"));else if(u[c].indexOf("TEXCOORD")!==-1){var _=u[c].substr(9);d.then(o.bind(a,"TexCoord"+_))}n.push(d)}var g=r.accessors[t.indices],p=this.loadAccessorBuffer(g,A.ELEMENT_ARRAY_BUFFER);return p.then(function(t){if(t){var e=new M(T.TRIANGLES,t);a.getPrimitives().push(e)}}),n.push(p),void 0!==t.material&&n.push(this.loadMaterial(t.material,a)),i.all(n).then(function(){return e&&(s.setSourceGeometry(a),s.mergeChildrenData(),s.computeBoundingBox=a.computeBoundingBox),s})},loadGLTFPrimitives:function(t,e,r){var n,a=this._glTFJSON,s=a.meshes[t],o=s.primitives,h=[];for(n=0;n<o.length;++n){var u=o[n],c=this.createGeometry(u,r);h.push(c)}return i.all(h).then(function(t){for(n=0;n<t.length;++n)e.addChild(t[n]);return t})},loadGLTFNode:i.method(function(t,e){if(!this._visitedNodes[t]){var r=this._glTFJSON,n=r.nodes[t],a=n.jointName?this._bones[t]:new b;if(a.setName(t),F.copy(a.getMatrix(),this.loadTransform(n)),n.jointName&&this._skeletons[n.joinName]){var s=this._skeletons[n.jointName];s.addChild(a),e.addChild(s)}var o,h=n.children,u=[];if(h)for(o=0;o<h.length;++o){var c=this.loadGLTFNode(h[o],a);u.push(c)}if(void 0!==n.mesh){var l=n.mesh;if(n.skeletons)for(var d=0;d<n.skeletons.length;++d){var _=n.skeletons[d],f=this._skeletons[_],g=new b;F.copy(g.getMatrix(),a.getMatrix());var p=this.loadGLTFPrimitives(l,g,_);f.addChild(g),u.push(p)}else{var m=this.loadGLTFPrimitives(l,a,null);u.push(m)}}return this._animatedNodes[t]&&this.registerUpdateCallback(t,a),this._skeletons[t]||e.addChild(a),this._visitedNodes[t]=!0,i.all(u)}}),readNodeURL:function(t,e){var r=this;if(this.init(),e&&void 0!==e.filesMap&&e.filesMap.size>0){this._filesMap=e.filesMap;var i=this._filesMap.get(t);return this.readJSON(i,t)}var a=t.lastIndexOf("/");this._localPath=a===-1?"":t.substr(0,a+1);var s=n(t);return s.then(function(t){return r.readJSON(t)})},readJSON:i.method(function(t,e){var r=new b;r.setName(e);var n=JSON.parse(t);if(n){this._glTFJSON=n;var a=[],s=this.preprocessAnimations(),o=this.preprocessSkeletons();a.push(o,s);var h=this;return i.all(a).then(function(){for(var t=[],e=window.Object.keys(n.scenes),a=0;a<e.length;++a){var s=n.scenes[e[a]];if(s)for(var o=0;o<s.nodes.length;++o){var u=h.loadGLTFNode(s.nodes[o],r);t.push(u)}}return h._basicAnimationManager&&r.addUpdateCallback(h._basicAnimationManager),i.all(t).then(function(){return r})})}})},s.instance().addReaderWriter("gltf",new P),t.exports=P},function(t,e,r){"use strict";var i=r(95),n=r(149),a=r(9),s=r(154),o=r(153),h=r(160),u=window.JSZip,c=function(){this._options=void 0,this._filesMap=new window.Map,this._fileName=""};c.prototype={readNodeURL:function(t,e){if(void 0===u)return void a.error("You need to add JSZip as a dependency");a.log("starting to read: "+t);var r=this;if(e&&void 0!==e.filesMap&&e.filesMap.has(t)){var s=e.filesMap.get(t);return this.readZipFile(s).then(function(){return r._fileName.length?o.readNodeURL(r._fileName,{filesMap:r._filesMap}):i.reject(r)})}var h=n(t,{responseType:"blob"});return h.then(function(t){r.readZipFile(t).then(function(){return o.readNodeURL(r._fileName,{filesMap:r._filesMap})})})},_registerZipImage:function(t,e,r,i){var n=i;"base64"===e&&(n=new window.Image,n.src="data:image/"+r+";base64,"+i),this._filesMap.set(t,n)},readZipFile:function(t){return u.loadAsync(t).then(function(t){var e=[];for(var r in t.files){var n=r.substr(r.lastIndexOf(".")+1),a=s.instance().getReaderWriterForExtension(n);void 0===a&&"osgjs"!==n||(this._fileName=r);var o=h.getTypeForExtension(n);if(void 0!==o){"blob"===o&&(o="base64");var u=t.file(r).async(o).then(this._registerZipImage.bind(this,r,o,n));e.push(u)}}return i.all(e)}.bind(this))}},s.instance().addReaderWriter("zip",new c),t.exports=c}])});