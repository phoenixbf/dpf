/*!
 * OSGJS
 * Cedric Pinson <trigrou@trigrou.com> (http://cedricpinson.com)
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("bluebird"),require("zlib"),require("hammerjs"),function(){try{return require("jquery")}catch(t){}}(),require("leapjs")):"function"==typeof define&&define.amd?define(["bluebird","zlib","hammer","jquery","leap"],e):"object"==typeof exports?exports.OSG=e(require("bluebird"),require("zlib"),require("hammerjs"),function(){try{return require("jquery")}catch(t){}}(),require("leapjs")):t.OSG=e(t.P,t.Zlib,t.Hammer,t.$,t.Leap)}(this,function(__WEBPACK_EXTERNAL_MODULE_90__,__WEBPACK_EXTERNAL_MODULE_133__,__WEBPACK_EXTERNAL_MODULE_142__,__WEBPACK_EXTERNAL_MODULE_217__,__WEBPACK_EXTERNAL_MODULE_236__){return function(t){function e(r){if(i[r])return i[r].exports;var n=i[r]={exports:{},id:r,loaded:!1};return t[r].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){t.exports=i(1)},function(t,e,i){"use strict";var r=i(2),n=i(4),a=i(113),s=i(128),o=i(141),h=i(165),u=i(228),c=i(174),l=i(242),d=i(254),f=i(255),p=i(256),_=r;_.osg=n,_.osgAnimation=a,_.osgDB=s,_.osgGA=o,_.osgUtil=h,_.osgViewer=u,_.osgShader=c,_.osgShadow=l,_.osgText=d,_.osgWrappers=f,_.osgPlugins=p;var g=["osg","osgAnimation","osgDB","osgGA","osgUtil","osgViewer","osgShader","osgShadow","osgText","osgWrappers","osgPlugins"];_.globalify=function(){g.forEach(function(t){window[t]=_[t]})},t.exports=_},function(t,e,i){"use strict";var r=i(3);t.exports={name:r.name,version:r.version,author:r.author}},function(t,e){t.exports={devDependencies:{chai:"^3.5.0","grunt-contrib-connect":"~0.9","grunt-documentation":"*","grunt-jsbeautifier":"^0.2.10","grunt-mocha":"^1.0.2","grunt-release":"^0.10.0",mocha:"^2.5.3","webpack-strip-block":"0.0.1","grunt-plato":"~0.2.1"},peerDependencies:{grunt:">=0.4.0"},dependencies:{"gl-matrix":"^2.3.2","grunt-lib-phantomjs":"^1.0.2","webpack-dev-server":"^1.7.0",webpack:"^1.7.3","raw-loader":"^0.5.1",path:"^0.11.14",leapjs:"^0.6.4","json-loader":"^0.5.4",jquery:"^2.1.3",hammerjs:"^2.0.4","grunt-webpack":"^1.0.8","grunt-shell":"*","grunt-git":"*","grunt-eslint":"*","grunt-copy-to":"0.0.12","grunt-contrib-uglify":"*","grunt-contrib-jshint":"*","grunt-contrib-copy":"*","grunt-contrib-clean":"*",grunt:"> 1.0.0",glob:"*",extend:"*","eslint-plugin-private-variables":"*",eslint:"*"},contributors:["Paul Cheyrou-Lagr√®ze <tuan.kuranes@gmail.com>","Jordi Torres <jtorresfabra@gmail.com>","Matt Fontaine <tehqin@gmail.com>","Stephane Ginier <stephane.ginier@gmail.com>"],version:"0.2.7",author:"Cedric Pinson <trigrou@trigrou.com> (http://cedricpinson.com)",license:"MIT",description:"OpenSceneGraph implementation in javascript",repository:{url:"git@github.com:cedricpinson/osgjs.git",type:"git"},name:"OpenSceneGraph"}},function(t,e,i){"use strict";var r=i(5),n=i(49),a=i(50),s=i(51),o=i(14),h=i(28),u=i(48),c=i(52),l=i(54),d=i(36),f=i(34),p=i(55),_=i(56),g=i(53),m=i(59),v=i(60),S=i(84),x=i(85),b=i(86),M=i(45),y=i(87),T=i(67),w=i(88),C=i(37),A=i(43),E=i(42),I=i(89),F=i(91),R=i(97),N=i(98),D=i(63),L=i(99),P=i(68),O=i(30),k=i(100),V=i(16),B=i(33),U=i(61),G=i(12),z=i(32),j=i(10),H=i(13),W=i(69),q=i(57),X=i(101),K=i(58),Y=i(102),Z=i(46),Q=i(103),J=i(62),$=i(65),tt=i(64),et=i(66),it=i(104),rt=i(105),nt=i(106),at=i(107),st=i(31),ot=i(8),ht=i(29),ut=i(40),ct=i(108),lt=i(11),dt=i(92),ft=i(41),pt=i(109),_t=i(6),gt=i(110),mt=i(7),vt=i(111),St=i(35),xt=i(9),bt=i(112),Mt=i(38),yt={};yt.AutoTransform=r,yt.BillboardAttribute=n,yt.BlendColor=a,yt.BlendFunc=s,yt.BoundingBox=o,yt.BoundingSphere=h,yt.BufferArray=u,yt.ColorMask=l,yt.Camera=c,yt.ColorMask=l,yt.ComputeBoundsVisitor=d,_t.objectMix(yt,f),yt.CullFace=p,yt.CullingSet=_,yt.CullSettings=g,yt.CullStack=m,yt.CullVisitor=v,yt.Depth=S,yt.DrawArrayLengths=x,yt.DrawArrays=b,yt.DrawElements=M,yt.EllipsoidModel=y,yt.WGS_84_RADIUS_EQUATOR=y.WGS_84_RADIUS_EQUATOR,yt.WGS_84_RADIUS_POLAR=y.WGS_84_RADIUS_POLAR,yt.FrameBufferObject=T,yt.FrameStamp=w,yt.Geometry=C,yt.GLObject=A,yt.Image=E,yt.ImageStream=I,yt.KdTree=F,yt.KdTreeBuilder=R,yt.Light=N,yt.LightSource=D,yt.LineWidth=L,yt.Lod=P,yt.Map=O,yt.Material=k,_t.objectMix(yt,V),yt.MatrixTransform=U,yt.MatrixMemoryPool=B,yt.Node=G,yt.NodeVisitor=z,_t.objectMix(yt,j),yt.Object=H,yt.PagedLOD=W,yt.Plane=K,yt.PointSizeAttribute=X,yt.Polytope=q,yt.PrimitiveSet=Z,yt.PrimitiveFunctor=Y,yt.Program=Q,yt.Projection=J,yt.RenderBin=$,yt.RenderLeaf=tt,yt.RenderStage=et,yt.Shader=it,_t.objectMix(yt,rt),yt.Stack=nt,yt.State=at,yt.StateAttribute=st,yt.StateGraph=ot,yt.StateSet=ht,yt.Scissor=vt,yt.Texture=ut,yt.TextureCubeMap=ct,yt.Transform=lt,yt.TriangleIndexFunctor=dt,yt.Uniform=ft,yt.UpdateVisitor=pt,_t.objectMix(yt,_t),yt.Viewport=gt;var Tt=i(15);yt.vec2=Tt.vec2,yt.vec3=Tt.vec3,yt.vec4=Tt.vec4,yt.quat=Tt.quat,yt.mat4=Tt.mat4,yt.memoryPools=mt.memoryPools,yt.Transform.RELATIVE_RF=St.RELATIVE_RF,yt.Transform.ABSOLUTE_RF=St.ABSOLUTE_RF,yt.Timer=xt,yt.TimerGPU=bt,yt.WebGLCaps=Mt,t.exports=yt},function(t,e,i){"use strict";var r=i(6),n=i(11),a=i(15).vec3,s=i(15).vec4,o=i(15).quat,h=i(15).mat4,u=i(32),c=i(35),l=i(12),d=function(){n.call(this),this._matrix=h.create(),this._position=a.create(),this._matrixDirty=!0,this._scale=a.fromValues(1,1,1),this._minimumScale=0,this._maximumScale=Number.MAX_VALUE,this._rotation=o.create(),this._pivotPoint=a.create(),this._autoScaleToScreen=!1,this._autoRotateToScreen=!1,this._cachedMatrix=h.create(),this._firstTimeToInitEyePoint=!0,this._autoScaleTransitionWidthRatio=.25,this._billboardAttribute=void 0,this._previousWidth=0,this._previousHeight=0,this._previousProjection=h.create(),this._previousModelView=h.create(),this._previousPosition=a.create()};d.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{getMatrix:function(){return this._matrix},setMatrix:function(t){this._matrix=t,this.dirtyBound()},setPosition:function(t){this._position=t,this._matrixDirty=!0,this.dirtyBound()},getPosition:function(){return this._position},setRotation:function(t){this._rotation=t,this._matrixDirty=!0,this.dirtyBound()},getRotation:function(){return this._rotation},setScale:function(t){this.setScaleFromvec3(a.fromValues(t,t,t))},setScaleFromvec3:function(t){this._scale=t,this._matrixDirty=!0,this.dirtyBound()},getScale:function(){return this._scale},setMinimumScale:function(t){this._minimumScale=t},getMinimumScale:function(){return this._minimumScale},setMaximumScale:function(t){this._maximumScale=t},getMaximumScale:function(){return this._maximumScale},setAutoScaleToScreen:function(t){this._autoScaleToScreen=t,this._matrixDirty=!0},getAutoScaleToScreen:function(){return this._autoScaleToScreen},setAutoRotateToScreen:function(t){this._autoRotateToScreen=t},getAutoRotateToScreen:function(){return this._autoRotateToScreen},setAutoScaleTransitionWidthRatio:function(t){this._autoScaleTransitionWidthRatio=t},getAutoScaleTransitionWidthRatio:function(){return this._autoScaleTransitionWidthRatio},computeLocalToWorldMatrix:function(t){this._matrixDirty&&this.computeMatrix(),this.referenceFrame===c.RELATIVE_RF?h.mul(t,t,this._matrix):h.copy(t,this._matrix)},computeMatrix:function(){var t=a.create(),e=h.create();return function(){this._matrixDirty&&(h.fromQuat(this._matrix,this._rotation),h.fromTranslation(e,this._position),h.mul(this._matrix,e,this._matrix),h.scale(this._matrix,this._matrix,this._scale),h.translate(this._matrix,this._matrix,a.neg(t,this._pivotPoint)),this._matrixDirty=!1)}}(),computeWorldToLocalMatrix:function(){var t=a.create(),e=o.create(),i=a.create(),r=h.create();return function(n){return(0!==this.scale[0]||0!==this.scale[1]||0!==this.scale[2])&&(i[0]=1/this._scale[0],i[1]=1/this._scale[1],i[2]=1/this._scale[2],this.referenceFrame===c.RELATIVE_RF?(h.fromTranslation(r,a.neg(t,this._position)),h.mul(n,r,n),o.zeroRotation(this._rotation)||(h.fromQuat(r,o.invert(e,this._rotation)),h.mul(n,r,n)),h.fromScaling(r,i),h.mul(n,r,n),h.fromTranslation(r,this._pivotPoint),h.mul(n,r,n)):(h.fromQuat(this._matrix,o.invert(e,this._rotation)),h.translate(n,n,a.neg(t,this._position)),h.fromScaling(r,i),h.mul(n,r,n),h.fromTranslation(r,this._pivotPoint),h.mul(n,r,n)),!0)}}(),computeBound:function(){var t=h.create();return function(e){return this._autoScaleToScreen&&this._firstTimeToInitEyePoint?e:(l.prototype.computeBound.call(this,e),e.valid()?(h.identity(t),this.computeLocalToWorldMatrix(t),e.transformMat4(e,t),e):e)}}(),accept:function(){return function(t){if(t.getVisitorType()===u.CULL_VISITOR){var e=t.getViewport().width(),i=t.getViewport().height(),r=t.getCurrentProjectionMatrix(),n=t.getCurrentModelViewMatrix(),c=this._position,d=this._firstTimeToInitEyePoint;if(this._firstTimeToInitEyePoint||(e!==this._previousWidth||i!==this._previousHeight?d=!0:h.exactEquals(r,this._previousProjection)&&h.exactEquals(n,this._previousModelView)?a.exactEquals(c,this._previousPosition)||(d=!0):d=!0),this._firstTimeToInitEyePoint=!1,d){if(this._autoScaleToScreen){var f=t.getViewport(),p=this.computePixelSizeVector(f,r,n),_=s.fromValues(this._position[0],this._position[1],this._position[2],1),g=s.dot(_,p);g=.48/g;var m=1/g;if(this._autoScaleTransitionWidthRatio>0){var v,S,x;if(this._minimumScale>0){var b=this._minimumScale,M=this._maximumScale<Number.MAX_VALUE?this._minimumScale+(this._maximumScale-this._minimumScale)*this._autoScaleTransitionWidthRatio:this._minimumScale*(1+this._autoScaleTransitionWidthRatio);v=1/(4*(M-b)),S=1-2*v*M,x=b+S*S/(4*v);var y=-S/(2*v);m<y?m=this._minimumScale:m<M&&(m=x+S*m+v*(m*m))}if(this._maximumScale<Number.MAX_VALUE){var T=this._maximumScale,w=this._minimumScale>0?this._maximumScale+(this._minimumScale-this._maximumScale)*this._autoScaleTransitionWidthRatio:this._maximumScale*(1-this._autoScaleTransitionWidthRatio);v=1/(4*(w-T)),S=1-2*v*w,x=T+S*S/(4*v);var C=-S/(2*v);m>C?m=this._maximumScale:m>w&&(m=x+S*m+v*(m*m))}}this.setScale(m)}if(this._autoRotateToScreen){var A=o.create();h.getRotation(A,n),this.setRotation(o.invert(A,A))}this._previousWidth=e,this._previousHeight=i,a.copy(this._previousPosition,c),h.copy(this._previousProjection,r),h.copy(this._previousModelView,n)}}l.prototype.accept.call(this,t)}}(),computePixelSizeVector:function(){var t=a.create(),e=a.create();return function(i,r,n){var o=r[0]*i.width()*.5,h=r[8]*i.width()*.5+r[11]*i.width()*.5;a.set(t,n[0]*o+n[2]*h,n[4]*o+n[6]*h,n[8]*o+n[10]*h);var u=r[5]*i.height()*.5,c=r[9]*i.height()*.5+r[11]*i.height()*.5;a.set(e,n[1]*u+n[2]*c,n[5]*u+n[6]*c,n[9]*u+n[10]*c);var l=r[11],d=r[15],f=s.fromValues(n[2]*l,n[6]*l,n[10]*l,n[14]*l+n[15]*d),p=.7071067811/Math.sqrt(a.sqrLen(t)+a.sqrLen(e));return s.scale(f,f,p),f}}()}),"osg","AutoTransform"),r.setTypeID(d),t.exports=d},function(t,e,i){"use strict";var r=i(7),n=i(8),a=i(9),s=i(10);window.Object.keys(n);var o={};o.init=function(){var t=i(8);r.memoryPools.stateGraph=new r.OsgObjectMemoryPool(t).grow(50)},o.extend=function(){var t,e,i,r,n=window.Object.prototype.toString,a=window.Object.prototype.hasOwnProperty,s=function(t){return"[object Function]"===n.call(t)},h=o.isArray,u=function(t){if(!t||"[object Object]"!==n.call(t)||t.nodeType||t.setInterval)return!1;if(t.constructor&&!a.call(t,"constructor")&&!a.call(t.constructor.prototype,"isPrototypeOf"))return!1;var e;for(e in t);return void 0===e||a.call(t,e)},c=arguments[0]||{},l=1,d=arguments.length,f=!1;for("boolean"==typeof c&&(f=c,c=arguments[1]||{},l=2),"object"==typeof c||s(c)||(c={}),d===l&&(c=this,--l);l<d;l++)if(null!==(t=arguments[l]))for(e in t)if(i=c[e],r=t[e],c!==r)if(f&&r&&(u(r)||h(r))){var p=i&&(u(i)||h(i))?i:h(r)?[]:{};c[e]=o.extend(f,p,r)}else void 0!==r&&(c[e]=r);return c},o.objectInherit=function(t){function e(){}e.prototype=t;for(var i=new e,r=1;r<arguments.length;r++)o.objectMix(i,arguments[r],!1);return i},o.objectMix=function(t,e,i){for(var r in e)i&&t[r]||(t[r]=e[r]);return t},o.objectType={},o.objectType.type=0,o.objectType.generate=function(t){var e=o.objectType.type;return o.objectType[e]=t,o.objectType[t]=e,o.objectType.type+=1,e},o.objectLibraryClass=function(t,e,i){t.className=function(){return i},t.libraryName=function(){return e};var r=e+"::"+i;return t.libraryClassName=function(){return r},t},o.setTypeID=function(t){var e=t.prototype.libraryClassName(),i=o.objectType.generate(e),r=function(){return i};t.typeID=t.prototype.typeID=i,t.getTypeID=t.prototype.getTypeID=r},o.createPrototypeClass=function(t,e,i,r){t.prototype=e,e.constructor=t,o.objectLibraryClass(e,i,r),o.setTypeID(t)},o.Float32Array="undefined"!=typeof Float32Array?Float32Array:null,o.Int32Array="undefined"!=typeof Int32Array?Int32Array:null,o.Uint8Array="undefined"!=typeof Uint8Array?Uint8Array:null,o.Uint16Array="undefined"!=typeof Uint16Array?Uint16Array:null,o.Uint32Array="undefined"!=typeof Uint32Array?Uint32Array:null;var h={};o.time=(s.console.time||function(t){h[t]=a.instance().tick()}).bind(s.console),o.timeEnd=(s.console.timeEnd||function(t){if(void 0!==h[t]){var e=a.instance().deltaM(h[t],a.instance().tick());s.debug(t+": "+e+"ms"),h[t]=void 0}}).bind(s.console),o.timeStamp=(s.console.timeStamp||s.console.markTimeline||function(){}).bind(s.console),o.profile=(s.console.profile||function(){}).bind(s.console),o.profileEnd=(s.console.profileEnd||function(){}).bind(s.console),t.exports=o},function(t,e){"use strict";var i={};i.memoryPools={},i.OsgObjectMemoryPool=function(t){return{_memPool:[],reset:function(){return this._memPool=[],this},put:function(t){this._memPool.push(t)},get:function(){return this._memPool.length>0?this._memPool.pop():(this.grow(),this.get())},grow:function(e){var i;i=void 0===e?this._memPool.length>0?2*this._memPool.length:20:e;for(var r=this._memPool.length;r++<i;)this._memPool.push(new t);return this}}},i.OsgArrayMemoryPool=function(){return{_mempoolofPools:[],reset:function(){return this._memPoolofPools={},this},put:function(t){this._memPoolofPools[t.length]||(this._memPoolofPools[t.length]=[]),this._memPoolofPools[t.length].push(t)},get:function(t){if(this._memPoolofPools[t]){if(this._memPoolofPools.length>0)return this._memPool.pop()}else this._memPoolofPools[t]=[];return this.grow(t),this.get()},grow:function(t,e){void 0===e&&(e=this._memPool.length>0?2*this._memPool.length:5);for(var i=this._memPool.length;i++<e;)this._memPool.push(new Array(t));return this}}},i.OsgObjectMemoryStack=function(t){return{_current:0,_memPool:[new t],reset:function(){return this._current=0,this},get:function(){var e=this._memPool[this._current++];return this._current>=this._memPool.length&&this._memPool.push(new t),e}}},t.exports=i},function(t,e,i){"use strict";var r=i(7),n=function(){this.depth=0,this.children={},this.children.keys=[],this.leafs=[],this.stateset=void 0,this.parent=void 0};n.prototype={clean:function(){this.leafs.length=0,this.stateset=void 0,this.parent=void 0,this.depth=0;for(var t,e,i=this.children,n=i.keys,a=0,s=n.length;a<s;a++)e=n[a],t=i[e],t.clean(),r.memoryPools.stateGraph.put(t);this.children={},n.length=0,this.children.keys=n},getStateSet:function(){return this.stateset},findOrInsert:function(t){var e,i=t.getInstanceID(),n=this.children;return n[i]?e=n[i]:(e=r.memoryPools.stateGraph.get(),e.parent=this,e.depth=this.depth+1,e.stateset=t,n[i]=e,n.keys.push(i)),e}},n.moveStateGraph=function(t,e,i){var r,n,a=[],s=i,o=e;if(s!==o&&void 0!==s)if(void 0!==o){if(o.parent===s.parent)return void 0!==o.stateset&&t.popStateSet(),void(void 0!==s.stateset&&t.pushStateSet(s.stateset));for(;o.depth>s.depth;)void 0!==o.stateset&&t.popStateSet(),o=o.parent;for(a=[];s.depth>o.depth;)void 0!==s.stateset&&a.push(s.stateset),s=s.parent;for(;o!==s;)void 0!==o.stateset&&t.popStateSet(),o=o.parent,void 0!==s.stateset&&a.push(s.stateset),s=s.parent;for(r=a.length-1,n=0;r>=n;--r)t.pushStateSet(a[r])}else{do void 0!==s.stateset&&a.push(s.stateset),s=s.parent;while(s);for(r=a.length-1,n=0;r>=n;--r)t.pushStateSet(a[r])}},t.exports=n},function(t,e){(function(e){"use strict";var i=function(){var t=window||e;if(void 0===t.performance)return function(){return Date.now()};var i=t.performance.now||t.performance.mozNow||t.performance.msNow||t.performance.oNow||t.performance.webkitNow||function(){return Date.now()};return function(){return i.apply(t.performance,arguments)}}(),r=function(){};r.instance=function(){return r._instance||(r._instance=new r),r._instance},r.prototype={deltaS:function(t,e){return(e-t)/1e3},deltaM:function(t,e){return e-t},tick:function(){return i()}},t.exports=r}).call(e,function(){return this}())},function(t,e){"use strict";function i(t,e){o.console&&(o.console[t](e),o.traceLogCall&&"error"!==t&&console.trace())}function r(t,e,i){o.console&&(o.console.groupCollapsed&&o.console.groupCollapsed(e),o.console[t](i),o.traceLogCall&&"error"!==t&&console.trace(),o.console.groupEnd&&o.console.groupEnd())}function n(t,e){return e?[t.slice(0,4),t.slice(4,8),t.slice(8,12),t.slice(12,16)]:[[t[0],t[4],t[8],t[12]],[t[1],t[5],t[9],t[13]],[t[2],t[6],t[10],t[14]],[t[3],t[7],t[11],t[15]]]}function a(t,e){o.console.table&&i("table",n(t,e))}function s(t,e,i){o.console.table&&r("table",t,n(e,i))}var o={};o.DEBUG=0,o.INFO=1,o.NOTICE=o.LOG=2,o.WARN=3,o.ERROR=4,o.console=window.console;for(var h=["log","info","warn","error","debug"],u={},c=0;c<h.length;++c){var l=h[c];u[l]=i.bind(o,l),u[l+"Fold"]=r.bind(o,l),u[l+"Matrix"]=a.bind(o),u[l+"MatrixFold"]=s.bind(o)}var d=function(t,e){void 0===this.console||t||this.console.assert(t,e)};o.assert=d,o.setNotifyLevel=function(t){for(var e=function(){},i=0;i<h.length;++i){var r=h[i],n=t>o[r.toUpperCase()];o[r]=n?e:u[r],o[r+"Fold"]=n?e:u[r+"Fold"],o[r+"Matrix"]=n?e:u[r+"Matrix"],o[r+"MatrixFold"]=n?e:u[r+"MatrixFold"]}o.notice=o.log,o.noticeFold=o.logFold,o.noticeMatrix=o.logMatrix,o.noticeMatrixFold=o.logMatrixFold},o.setNotifyLevel(o.NOTICE),o.reportWebGLError=!1,o.setConsole=function(t){o.console=t},t.exports=o},function(t,e,i){"use strict";var r=i(6),n=i(12),a=i(15).mat4,s=i(35),o=function(){n.call(this),this.referenceFrame=s.RELATIVE_RF};o.prototype=r.objectInherit(n.prototype,{setReferenceFrame:function(t){this.referenceFrame=t},getReferenceFrame:function(){return this.referenceFrame},computeBoundingSphere:function(){var t=a.create();return function(e){return n.prototype.computeBoundingSphere.call(this,e),e.valid()?(a.identity(t),this.computeLocalToWorldMatrix(t),e.transformMat4(e,t),e):e}}()}),t.exports=o},function(t,e,i){"use strict";var r=i(6),n=i(13),a=i(14),s=i(28),o=i(29),h=i(32),u=i(15).mat4,c=i(33),l=i(34),d=i(35),f=function(){n.call(this),this.children=[],this._parents=[],this.nodeMask=-1,this._boundingSphere=new s,this._boundingSphereComputed=!1,this._boundingBox=new a,this._boundingBoxComputed=!1,this._updateCallbacks=[],this._cullCallback=void 0,this._cullingActive=!0,this._numChildrenWithCullingDisabled=0,this._numChildrenRequiringUpdateTraversal=0,this._tmpBox=new a};f._reservedMatrixStack=new c;var p=function(){var t=f._reservedMatrixStack.get.bind(f._reservedMatrixStack);return u.identity(t)};f.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{getOrCreateStateSet:function(){return this.stateset||this.setStateSet(new o),this.stateset},getStateSet:function(){return this.stateset},accept:function(t){t.validNodeMask(this)&&(t.pushOntoNodePath(this),t.apply(this),t.popFromNodePath())},dirtyBound:function(){if(this._boundingSphereComputed===!0||this._boundingBoxComputed===!0){this._boundingSphereComputed=!1,this._boundingBoxComputed=!1;for(var t=this._parents,e=0,i=t.length;e<i;e++)t[e].dirtyBound()}},setNodeMask:function(t){this.nodeMask=t},getNodeMask:function(){return this.nodeMask},setStateSet:function(t){if(this.stateset!==t){var e=0;this.stateset&&(this.stateset.requiresUpdateTraversal()&&e--,this.stateset.removeParent(this)),t&&(t.addParent(this),t.requiresUpdateTraversal()&&++e),0!==e&&this.setNumChildrenRequiringUpdateTraversal(this.getNumChildrenRequiringUpdateTraversal()+e),this.stateset=t}},_updateNumChildrenRequeringUpdateTraversal:function(t){if(0===this._numChildrenRequiringUpdateTraversal&&this._parents.length)for(var e=0,i=this._parents.length;e<i;e++){var r=this._parents[e],n=r.getNumChildrenRequiringUpdateTraversal();r.setNumChildrenRequiringUpdateTraversal(n+t)}},setNumChildrenRequiringUpdateTraversal:function(t){if(this._numChildrenRequiringUpdateTraversal!==t){if(!this._updateCallbacks.length&&this._parents.length){var e=0;if(this._numChildrenRequiringUpdateTraversal>0&&--e,t>0&&++e,0!==e)for(var i=this._parents,r=0,n=i.length;r<n;r++){var a=i[r],s=a.getNumChildrenRequiringUpdateTraversal();a.setNumChildrenRequiringUpdateTraversal(s+e)}}this._numChildrenRequiringUpdateTraversal=t}},getNumChildrenRequiringUpdateTraversal:function(){return this._numChildrenRequiringUpdateTraversal},setUpdateCallback:function(t){if(t!==this._updateCallbacks[0]&&t){var e=Boolean(this._updateCallbacks.length);this._updateCallbacks.length?this._updateCallbacks[0]=t:this.addUpdateCallback(t),e||this._updateNumChildrenRequeringUpdateTraversal(1)}},getUpdateCallback:function(){return this._updateCallbacks[0]},addUpdateCallback:function(t){var e=Boolean(this._updateCallbacks.length);this._updateCallbacks.push(t),e||this._updateNumChildrenRequeringUpdateTraversal(1)},removeUpdateCallback:function(t){var e=this._updateCallbacks.indexOf(t);e!==-1&&(this._updateCallbacks.splice(e,1),this._updateCallbacks.length||this._updateNumChildrenRequeringUpdateTraversal(-1))},getUpdateCallbackList:function(){return this._updateCallbacks},setCullCallback:function(t){this._cullCallback=t},getCullCallback:function(){return this._cullCallback},hasChild:function(t){for(var e=0,i=this.children.length;e<i;e++)if(this.children[e]===t)return!0;return!1},addChild:function(t){if(this.children.indexOf(t)===-1)return this.children.push(t),t.addParent(this),this.dirtyBound(),(t.getNumChildrenRequiringUpdateTraversal()>0||t.getUpdateCallbackList().length)&&this.setNumChildrenRequiringUpdateTraversal(this.getNumChildrenRequiringUpdateTraversal()+1),t},getChildren:function(){return this.children},getNumChildren:function(){return this.children.length},getChild:function(t){return this.children[t]},getParents:function(){return this._parents},addParent:function(t){this._parents.push(t)},removeParent:function(t){var e=this._parents.indexOf(t);e!==-1&&this._parents.splice(e,1)},removeChildren:function(){var t=this.children,e=t.length;if(e){for(var i=0,r=0;r<e;r++){var n=t[r];n.removeParent(this),(n.getNumChildrenRequiringUpdateTraversal()>0||n.getUpdateCallbackList().length)&&++i}t.length=0,i&&this.setNumChildrenRequiringUpdateTraversal(this.getNumChildrenRequiringUpdateTraversal()-i),this.dirtyBound()}},removeChild:function(t){var e=this.children,i=e.indexOf(t);i!==-1&&(t.removeParent(this),e.splice(i,1),(t.getNumChildrenRequiringUpdateTraversal()>0||t.getUpdateCallbackList().length)&&this.setNumChildrenRequiringUpdateTraversal(this.getNumChildrenRequiringUpdateTraversal()-1))},traverse:function(t){for(var e=this.children,i=0,r=e.length;i<r;i++){var n=e[i];n.accept(t)}},ascend:function(t){for(var e=this._parents,i=0,r=e.length;i<r;i++){var n=e[i];n.accept(t)}},getBoundingBox:function(){return this._boundingBoxComputed||(this.computeBoundingBox(this._boundingBox),this._boundingBoxComputed=!0),this._boundingBox},computeBoundingBox:function(t){var e=i(36),r=e.instance=e.instance||new e;return r.setNodeMaskOverride(-1),r.reset(),r.apply(this),t.copy(r.getBoundingBox()),t},getBoundingSphere:function(){return this.getBound()},getBound:function(){return this._boundingSphereComputed||(this.computeBoundingSphere(this._boundingSphere),this._boundingSphereComputed=!0),this._boundingSphere},computeBoundingSphere:function(t){var e=this.children,i=e.length;if(t.init(),0===i)return t;var r,n,a=this._tmpBox;for(a.init(),n=0;n<i;n++)r=e[n],r.referenceFrame!==d.ABSOLUTE_RF&&a.expandByBoundingSphere(r.getBound());if(!a.valid())return t;for(t.set(a.center(t.center()),0),n=0;n<i;n++)r=e[n],r.referenceFrame!==d.ABSOLUTE_RF&&t.expandRadiusBySphere(r.getBound());return t},getWorldMatrices:function(){var t=function(){this.nodePaths=[],this.halt=void 0,h.call(this,h.TRAVERSE_PARENTS)};t.prototype=r.objectInherit(h.prototype,{reset:function(){this.nodePath.length=0,this.nodePaths.length=0},apply:function(t){0===t._parents.length||t===this.halt||t.referenceFrame===d.ABSOLUTE_RF?this.nodePaths.push(this.nodePath.slice(0)):this.traverse(t)}});var e=new t;return e.setNodeMaskOverride(-1),function(t,i){e.reset(),e.halt=t,this.accept(e);for(var r=[],n=i||u.create,a=0,s=e.nodePaths.length;a<s;a++){var o=e.nodePaths[a],h=n();0!==o.length&&l.computeLocalToWorld(o,!0,h),r.push(h)}return r}}(),getWorldMatrix:function(t,e){var i=this.getWorldMatrices(t,p);return 0===i.length?u.identity(e):u.copy(e,i[0]),f._reservedMatrixStack.reset(),e},setCullingActive:function(t){if(this._cullingActive!==t){if(0===this._numChildrenWithCullingDisabled&&this._parents.length>0){var e=0;if(this._cullingActive||--e,t||++e,0!==e)for(var i=0,r=this._parents.length;i<r;i++)this._parents[i].setNumChildrenWithCullingDisabled(this._parents[i].getNumChildrenWithCullingDisabled()+e)}this._cullingActive=t}},getCullingActive:function(){return this._cullingActive},isCullingActive:function(){return 0===this._numChildrenWithCullingDisabled&&this._cullingActive&&this.getBound().valid()},setNumChildrenWithCullingDisabled:function(t){if(this._numChildrenWithCullingDisabled!==t){if(this._cullingActive&&this._parents.length>0){var e=0;if(this._numChildrenWithCullingDisabled>0&&--e,t>0&&++e,0!==e)for(var i=0,r=this._parents.length;i<r;i++)this._parents[i].setNumChildrenWithCullingDisabled(this._parents[i].getNumChildrenWithCullingDisabled()+e)}this._numChildrenWithCullingDisabled=t}},getNumChildrenWithCullingDisabled:function(){return this._numChildrenWithCullingDisabled},releaseGLObjects:function(){void 0!==this.stateset&&this.stateset.releaseGLObjects()}}),"osg","Node"),r.setTypeID(f),t.exports=f},function(t,e,i){"use strict";var r=i(6),n=function(){this._name=void 0,this._userdata=void 0,this._instanceID=n.getInstanceID()};n.prototype=r.objectLibraryClass({cloneType:function(){var t=this.constructor;return new t},getInstanceID:function(){return this._instanceID},setName:function(t){this._name=t},getName:function(){return this._name},setUserData:function(t){this._userdata=t},getUserData:function(){return this._userdata}},"osg","Object");var a=0;n.getInstanceID=function(){return a+=1},t.exports=n},function(t,e,i){"use strict";var r=i(6),n=i(15).vec3,a=i(15).mat4,s=function(){this._min=n.create(),this._max=n.create(),this.init()};s.prototype=r.objectLibraryClass({init:function(){n.copy(this._min,n.INFINITY),n.copy(this._max,n.NEGATIVE_INFINITY)},copy:function(t){var e=this._min,i=t._min;e[0]=i[0],e[1]=i[1],e[2]=i[2];var r=this._max,n=t._max;r[0]=n[0],r[1]=n[1],r[2]=n[2]},valid:function(){return this._max[0]>=this._min[0]&&this._max[1]>=this._min[1]&&this._max[2]>=this._min[2]},expandByBoundingSphere:function(t){if(t.valid()){var e=this._max,i=this._min,r=t._radius,n=t._center[0],a=t._center[1],s=t._center[2];i[0]=Math.min(i[0],n-r),i[1]=Math.min(i[1],a-r),i[2]=Math.min(i[2],s-r),e[0]=Math.max(e[0],n+r),e[1]=Math.max(e[1],a+r),e[2]=Math.max(e[2],s+r)}},expandByvec3:function(t){var e=this._min,i=this._max;e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),i[0]=Math.max(i[0],t[0]),i[1]=Math.max(i[1],t[1]),i[2]=Math.max(i[2],t[2])},expandByBoundingBox:function(t){if(t.valid()){var e=this._min,i=this._max,r=t._min,n=t._max;r[0]<e[0]&&(e[0]=r[0]),n[0]>i[0]&&(i[0]=n[0]),r[1]<e[1]&&(e[1]=r[1]),n[1]>i[1]&&(i[1]=n[1]),r[2]<e[2]&&(e[2]=r[2]),n[2]>i[2]&&(i[2]=n[2])}},center:function(t){var e=this._min,i=this._max;return t[0]=.5*(e[0]+i[0]),t[1]=.5*(e[1]+i[1]),t[2]=.5*(e[2]+i[2]),t},radius:function(){return Math.sqrt(this.radius2())},radius2:function(){var t=this._min,e=this._max,i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return.25*(i*i+r*r+n*n)},getMin:function(){return this._min},getMax:function(){return this._max},setMin:function(t){return n.copy(this._min,t),this},setMax:function(t){return n.copy(this._max,t),this},xMax:function(){return this._max[0]},yMax:function(){return this._max[1]},zMax:function(){return this._max[2]},xMin:function(){return this._min[0]},yMin:function(){return this._min[1]},zMin:function(){return this._min[2]},corner:function(t,e){return 1&t?e[0]=this._max[0]:e[0]=this._min[0],2&t?e[1]=this._max[1]:e[1]=this._min[1],4&t?e[2]=this._max[2]:e[2]=this._min[2],e},transformMat4:function(){var t=n.create(),e=n.create();return function(i,r){var s=this.getMin(),o=this.getMax();a.getTranslation(t,r),n.copy(e,t);for(var h=0;h<3;++h)for(var u=4*h,c=s[h],l=o[h],d=0;d<3;++d){var f=r[u+d],p=f*l,_=f*c;p<_?(t[d]+=p,e[d]+=_):(t[d]+=_,e[d]+=p)}var g=i.getMax(),m=i.getMin();return g[0]=e[0],g[1]=e[1],g[2]=e[2],m[0]=t[0],m[1]=t[1],m[2]=t[2],i}}()},"osg","BoundingBox"),t.exports=s},function(t,e,i){"use strict";var r=i(16),n=i(17),a=i(27);n.glMatrix.setMatrixArrayType(a.ArrayType),n.glMatrix.EPSILON=1e-9;var s=n.vec2,o=n.vec3,h=n.vec4,u=n.mat4,c=n.quat;o.create32=function(){return new Float32Array(3)},o.create64=function(){return new Float64Array(3)},o.fromValues32=function(t,e,i){var r=new Float32Array(3);return r[0]=t,r[1]=e,r[2]=i,r},o.fromValues64=function(t,e,i){var r=new Float64Array(3);return r[0]=t,r[1]=e,r[2]=i,r},o.init=function(t){return o.set(t,0,0,0)},o.transformMat4Rotate=function(t,e,i){var r=e[0],n=e[1],a=e[2];return t[0]=i[0]*r+i[1]*n+i[2]*a,t[1]=i[4]*r+i[5]*n+i[6]*a,t[2]=i[8]*r+i[9]*n+i[10]*a,t},o.valid=function(t){return!r.isNaN(t[0])&&(!r.isNaN(t[1])&&!r.isNaN(t[2]))},o.neg=o.negate,o.ZERO=o.create(),o.ONE=o.fromValues(1,1,1),o.INFINITY=o.fromValues(1/0,1/0,1/0),o.NEGATIVE_INFINITY=o.fromValues(-(1/0),-(1/0),-(1/0)),s.create32=function(){return new Float32Array(2)},s.create64=function(){return new Float64Array(2)},s.fromValues32=function(t,e){var i=new Float32Array(2);return i[0]=t,i[1]=e,i},s.fromValues64=function(t,e){var i=new Float64Array(2);return i[0]=t,i[1]=e,i},s.init=function(t){return s.set(t,0,0)},s.valid=function(t){return!r.isNaN(t[0])&&!r.isNaN(t[1])},s.ZERO=s.create(),s.ONE=s.fromValues(1,1),s.INFINITY=s.fromValues(1/0,1/0),s.NEGATIVE_INFINITY=s.fromValues(-(1/0),-(1/0)),h.create32=function(){return new Float32Array(4)},h.create64=function(){return new Float64Array(4)},h.fromValues32=function(t,e,i,r){var n=new Float32Array(4);return n[0]=t,n[1]=e,n[2]=i,n[3]=r,n},h.fromValues64=function(t,e,i,r){var n=new Float64Array(4);return n[0]=t,n[1]=e,n[2]=i,n[3]=r,n},h.init=function(t){return h.set(t,0,0,0,0)},h.valid=function(t){return!r.isNaN(t[0])&&(!r.isNaN(t[1])&&(!r.isNaN(t[2])&&!r.isNaN(t[3])))},h.neg=h.negate,h.ZERO=h.create(),h.ONE=h.fromValues(1,1,1,1),h.INFINITY=h.fromValues(1/0,1/0,1/0,1/0),h.NEGATIVE_INFINITY=h.fromValues(-(1/0),-(1/0),-(1/0),-(1/0)),c.IDENTITY=c.create(),c.zeroRotation=function(t){return 0===t[0]&&0===t[1]&&0===t[2]&&1===t[3]},c.create32=function(){var t=new Float32Array(4);return t[3]=1,t},c.create64=function(){var t=new Float64Array(4);return t[3]=1,t},c.fromValues32=h.fromValues32,c.fromValues64=h.fromValues64,c.init=c.identity,c.nlerp=function(t,e,i,r){var n,a,s,o,h=e[0],u=e[1],c=e[2],l=e[3],d=i[0],f=i[1],p=i[2],_=i[3],g=h*d+u*f+c*p+l*_,m=1-r;g<0?(n=h*m-d*r,a=u*m-f*r,s=c*m-p*r,o=l*m-_*r):(n=h*m+d*r,a=u*m+f*r,s=c*m+p*r,o=l*m+_*r);var v=1/Math.sqrt(n*n+a*a+s*s+o*o);return t[0]=n*v,t[1]=a*v,t[2]=s*v,t[3]=o*v,t},u.IDENTITY=u.create(),u.create32=function(){var t=new Float32Array(16);return t[0]=t[5]=t[10]=t[15]=1,t},u.create64=function(){var t=new Float64Array(16);return t[0]=t[5]=t[10]=t[15]=1,t},u.setTranslation=function(t,e){return t[12]=e[0],t[13]=e[1],t[14]=e[2],t},u.getFrustum=function(t,e){var i,r,n=0,a=0,s=0,o=0;if(0!==e[3]||0!==e[7]||e[11]!==-1||0!==e[15])return!1;var h=e[14]/(e[10]-1),u=e[14]/(1+e[10]);return a=h*(e[8]-1)/e[0],n=h*(1+e[8])/e[0],s=h*(1+e[9])/e[5],o=h*(e[9]-1)/e[5],i=h,r=u,t.left=a,t.right=n,t.top=s,t.bottom=o,t.zNear=i,t.zFar=r,!0},u.getPerspective=function(){var t={right:0,left:0,top:0,bottom:0,zNear:0,zFar:0};return function(e,i){var r=u.getFrustum(t,i);return r&&(e.fovy=180/Math.PI*(Math.atan(t.top/t.zNear)-Math.atan(t.bottom/t.zNear)),
e.aspectRatio=(t.right-t.left)/(t.top-t.bottom)),e.zNear=t.zNear,e.zFar=t.zFar,e}}(),u.getLookAt=function(){var t=u.create(),e=o.create(),i=o.fromValues(0,1,0),r=o.fromValues(0,0,-1);return function(n,a,s,h,c){var l=void 0!==c?c:1;u.invert(t,h),u.getTranslation(n,t),o.transformMat4Rotate(s,i,h),o.transformMat4Rotate(a,r,h),o.normalize(a,a),o.add(a,o.scale(e,a,l),n)}}(),u.getFrustumPlanes=function(){var t=u.create();return function(e,i,r,n){u.mul(t,i,r);var a=!!n,s=e[0];s[0]=t[3]-t[0],s[1]=t[7]-t[4],s[2]=t[11]-t[8],s[3]=t[15]-t[12];var o=e[1];o[0]=t[3]+t[0],o[1]=t[7]+t[4],o[2]=t[11]+t[8],o[3]=t[15]+t[12];var h=e[2];h[0]=t[3]+t[1],h[1]=t[7]+t[5],h[2]=t[11]+t[9],h[3]=t[15]+t[13];var c=e[3];c[0]=t[3]-t[1],c[1]=t[7]-t[5],c[2]=t[11]-t[9],c[3]=t[15]-t[13];var l=4;if(a){l=6;var d=e[4];d[0]=t[3]-t[2],d[1]=t[7]-t[6],d[2]=t[11]-t[10],d[3]=t[15]-t[14];var f=e[5];f[0]=t[3]+t[2],f[1]=t[7]+t[6],f[2]=t[11]+t[10],f[3]=t[15]+t[14]}for(var p=0;p<l;p++){var _=e[p],g=1/Math.sqrt(_[0]*_[0]+_[1]*_[1]+_[2]*_[2]);_[0]*=g,_[1]*=g,_[2]*=g,_[3]*=g}}}(),u.infiniteFrustum=function(t,e,i,r,n,a){var s=2*a/(i-e),o=2*a/(n-r),h=(i+e)/(i-e),u=(n+r)/(n-r),c=-1;return t[0]=s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=h,t[9]=u,t[10]=c,t[11]=-1,t[12]=0,t[13]=0,t[14]=-2*a,t[15]=0,t},u.lookAtDirection=function(){var t=o.create(),e=o.create(),i=o.create();return function(r,n,a,s){var h=a;return o.cross(t,h,s),o.normalize(t,t),o.cross(e,t,h),o.normalize(e,e),r[0]=t[0],r[1]=e[0],r[2]=-h[0],r[3]=0,r[4]=t[1],r[5]=e[1],r[6]=-h[1],r[7]=0,r[8]=t[2],r[9]=e[2],r[10]=-h[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,u.translate(r,r,o.neg(i,n))}}(),u.getScale=function(){var t=o.create(),e=o.create(),i=o.create();return function(r,n){return t[0]=n[0],t[1]=n[4],t[2]=n[8],e[0]=n[1],e[1]=n[5],e[2]=n[9],i[0]=n[2],i[1]=n[6],i[2]=n[10],r[0]=o.length(t),r[1]=o.length(e),r[2]=o.length(i),r}}(),u.getSqrScale=function(){var t=o.create(),e=o.create(),i=o.create();return function(r,n){return t[0]=n[0],t[1]=n[4],t[2]=n[8],e[0]=n[1],e[1]=n[5],e[2]=n[9],i[0]=n[2],i[1]=n[6],i[2]=n[10],r[0]=o.sqrLen(t),r[1]=o.sqrLen(e),r[2]=o.sqrLen(i),r}}();var l=u.rotate;u.rotate=function(t,e,i,r){return l(t,e,i,r)||u.identity(t)};var d=u.fromRotation;u.fromRotation=function(t,e,i){return d(t,e,i)||u.identity(t)},t.exports=n},function(t,e){"use strict";var i=function(t,e,i){return Math.min(i,Math.max(e,t))},r=function(t,e,i){if(i<=t)return 0;if(i>=e)return 1;var r=(i-t)/(e-t);return r*r*(3-2*r)},n=function(t){return t!==t};t.exports={clamp:i,smoothStep:r,isNaN:n}},function(t,e,i){e.glMatrix=i(18),e.mat2=i(19),e.mat2d=i(20),e.mat3=i(21),e.mat4=i(22),e.quat=i(23),e.vec2=i(26),e.vec3=i(24),e.vec4=i(25)},function(t,e){var i={};i.EPSILON=1e-6,i.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,i.RANDOM=Math.random,i.ENABLE_SIMD=!1,i.SIMD_AVAILABLE=i.ARRAY_TYPE===Float32Array&&"SIMD"in this,i.USE_SIMD=i.ENABLE_SIMD&&i.SIMD_AVAILABLE,i.setMatrixArrayType=function(t){i.ARRAY_TYPE=t};var r=Math.PI/180;i.toRadian=function(t){return t*r},i.equals=function(t,e){return Math.abs(t-e)<=i.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))},t.exports=i},function(t,e,i){var r=i(18),n={};n.create=function(){var t=new r.ARRAY_TYPE(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},n.clone=function(t){var e=new r.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},n.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},n.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},n.fromValues=function(t,e,i,n){var a=new r.ARRAY_TYPE(4);return a[0]=t,a[1]=e,a[2]=i,a[3]=n,a},n.set=function(t,e,i,r,n){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t},n.transpose=function(t,e){if(t===e){var i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},n.invert=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],s=i*a-n*r;return s?(s=1/s,t[0]=a*s,t[1]=-r*s,t[2]=-n*s,t[3]=i*s,t):null},n.adjoint=function(t,e){var i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t},n.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},n.multiply=function(t,e,i){var r=e[0],n=e[1],a=e[2],s=e[3],o=i[0],h=i[1],u=i[2],c=i[3];return t[0]=r*o+a*h,t[1]=n*o+s*h,t[2]=r*u+a*c,t[3]=n*u+s*c,t},n.mul=n.multiply,n.rotate=function(t,e,i){var r=e[0],n=e[1],a=e[2],s=e[3],o=Math.sin(i),h=Math.cos(i);return t[0]=r*h+a*o,t[1]=n*h+s*o,t[2]=r*-o+a*h,t[3]=n*-o+s*h,t},n.scale=function(t,e,i){var r=e[0],n=e[1],a=e[2],s=e[3],o=i[0],h=i[1];return t[0]=r*o,t[1]=n*o,t[2]=a*h,t[3]=s*h,t},n.fromRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=-i,t[3]=r,t},n.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},n.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},n.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2))},n.LDU=function(t,e,i,r){return t[2]=r[2]/r[0],i[0]=r[0],i[1]=r[1],i[3]=r[3]-t[2]*i[1],[t,e,i]},n.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},n.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t},n.sub=n.subtract,n.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},n.equals=function(t,e){var i=t[0],n=t[1],a=t[2],s=t[3],o=e[0],h=e[1],u=e[2],c=e[3];return Math.abs(i-o)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-h)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(a-u)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(u))&&Math.abs(s-c)<=r.EPSILON*Math.max(1,Math.abs(s),Math.abs(c))},n.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},n.multiplyScalarAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t},t.exports=n},function(t,e,i){var r=i(18),n={};n.create=function(){var t=new r.ARRAY_TYPE(6);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},n.clone=function(t){var e=new r.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},n.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},n.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},n.fromValues=function(t,e,i,n,a,s){var o=new r.ARRAY_TYPE(6);return o[0]=t,o[1]=e,o[2]=i,o[3]=n,o[4]=a,o[5]=s,o},n.set=function(t,e,i,r,n,a,s){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t[4]=a,t[5]=s,t},n.invert=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],s=e[4],o=e[5],h=i*a-r*n;return h?(h=1/h,t[0]=a*h,t[1]=-r*h,t[2]=-n*h,t[3]=i*h,t[4]=(n*o-a*s)*h,t[5]=(r*s-i*o)*h,t):null},n.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},n.multiply=function(t,e,i){var r=e[0],n=e[1],a=e[2],s=e[3],o=e[4],h=e[5],u=i[0],c=i[1],l=i[2],d=i[3],f=i[4],p=i[5];return t[0]=r*u+a*c,t[1]=n*u+s*c,t[2]=r*l+a*d,t[3]=n*l+s*d,t[4]=r*f+a*p+o,t[5]=n*f+s*p+h,t},n.mul=n.multiply,n.rotate=function(t,e,i){var r=e[0],n=e[1],a=e[2],s=e[3],o=e[4],h=e[5],u=Math.sin(i),c=Math.cos(i);return t[0]=r*c+a*u,t[1]=n*c+s*u,t[2]=r*-u+a*c,t[3]=n*-u+s*c,t[4]=o,t[5]=h,t},n.scale=function(t,e,i){var r=e[0],n=e[1],a=e[2],s=e[3],o=e[4],h=e[5],u=i[0],c=i[1];return t[0]=r*u,t[1]=n*u,t[2]=a*c,t[3]=s*c,t[4]=o,t[5]=h,t},n.translate=function(t,e,i){var r=e[0],n=e[1],a=e[2],s=e[3],o=e[4],h=e[5],u=i[0],c=i[1];return t[0]=r,t[1]=n,t[2]=a,t[3]=s,t[4]=r*u+a*c+o,t[5]=n*u+s*c+h,t},n.fromRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=-i,t[3]=r,t[4]=0,t[5]=0,t},n.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},n.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},n.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},n.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+1)},n.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t},n.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t},n.sub=n.subtract,n.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t},n.multiplyScalarAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t},n.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},n.equals=function(t,e){var i=t[0],n=t[1],a=t[2],s=t[3],o=t[4],h=t[5],u=e[0],c=e[1],l=e[2],d=e[3],f=e[4],p=e[5];return Math.abs(i-u)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(n-c)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(a-l)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(l))&&Math.abs(s-d)<=r.EPSILON*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(o-f)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(h-p)<=r.EPSILON*Math.max(1,Math.abs(h),Math.abs(p))},t.exports=n},function(t,e,i){var r=i(18),n={};n.create=function(){var t=new r.ARRAY_TYPE(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},n.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},n.clone=function(t){var e=new r.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},n.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},n.fromValues=function(t,e,i,n,a,s,o,h,u){var c=new r.ARRAY_TYPE(9);return c[0]=t,c[1]=e,c[2]=i,c[3]=n,c[4]=a,c[5]=s,c[6]=o,c[7]=h,c[8]=u,c},n.set=function(t,e,i,r,n,a,s,o,h,u){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t[4]=a,t[5]=s,t[6]=o,t[7]=h,t[8]=u,t},n.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},n.transpose=function(t,e){if(t===e){var i=e[1],r=e[2],n=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=r,t[7]=n}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},n.invert=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],s=e[4],o=e[5],h=e[6],u=e[7],c=e[8],l=c*s-o*u,d=-c*a+o*h,f=u*a-s*h,p=i*l+r*d+n*f;return p?(p=1/p,t[0]=l*p,t[1]=(-c*r+n*u)*p,t[2]=(o*r-n*s)*p,t[3]=d*p,t[4]=(c*i-n*h)*p,t[5]=(-o*i+n*a)*p,t[6]=f*p,t[7]=(-u*i+r*h)*p,t[8]=(s*i-r*a)*p,t):null},n.adjoint=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],s=e[4],o=e[5],h=e[6],u=e[7],c=e[8];return t[0]=s*c-o*u,t[1]=n*u-r*c,t[2]=r*o-n*s,t[3]=o*h-a*c,t[4]=i*c-n*h,t[5]=n*a-i*o,t[6]=a*u-s*h,t[7]=r*h-i*u,t[8]=i*s-r*a,t},n.determinant=function(t){var e=t[0],i=t[1],r=t[2],n=t[3],a=t[4],s=t[5],o=t[6],h=t[7],u=t[8];return e*(u*a-s*h)+i*(-u*n+s*o)+r*(h*n-a*o)},n.multiply=function(t,e,i){var r=e[0],n=e[1],a=e[2],s=e[3],o=e[4],h=e[5],u=e[6],c=e[7],l=e[8],d=i[0],f=i[1],p=i[2],_=i[3],g=i[4],m=i[5],v=i[6],S=i[7],x=i[8];return t[0]=d*r+f*s+p*u,t[1]=d*n+f*o+p*c,t[2]=d*a+f*h+p*l,t[3]=_*r+g*s+m*u,t[4]=_*n+g*o+m*c,t[5]=_*a+g*h+m*l,t[6]=v*r+S*s+x*u,t[7]=v*n+S*o+x*c,t[8]=v*a+S*h+x*l,t},n.mul=n.multiply,n.translate=function(t,e,i){var r=e[0],n=e[1],a=e[2],s=e[3],o=e[4],h=e[5],u=e[6],c=e[7],l=e[8],d=i[0],f=i[1];return t[0]=r,t[1]=n,t[2]=a,t[3]=s,t[4]=o,t[5]=h,t[6]=d*r+f*s+u,t[7]=d*n+f*o+c,t[8]=d*a+f*h+l,t},n.rotate=function(t,e,i){var r=e[0],n=e[1],a=e[2],s=e[3],o=e[4],h=e[5],u=e[6],c=e[7],l=e[8],d=Math.sin(i),f=Math.cos(i);return t[0]=f*r+d*s,t[1]=f*n+d*o,t[2]=f*a+d*h,t[3]=f*s-d*r,t[4]=f*o-d*n,t[5]=f*h-d*a,t[6]=u,t[7]=c,t[8]=l,t},n.scale=function(t,e,i){var r=i[0],n=i[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},n.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},n.fromRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=-i,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},n.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},n.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},n.fromQuat=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],s=i+i,o=r+r,h=n+n,u=i*s,c=r*s,l=r*o,d=n*s,f=n*o,p=n*h,_=a*s,g=a*o,m=a*h;return t[0]=1-l-p,t[3]=c-m,t[6]=d+g,t[1]=c+m,t[4]=1-u-p,t[7]=f-_,t[2]=d-g,t[5]=f+_,t[8]=1-u-l,t},n.normalFromMat4=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],s=e[4],o=e[5],h=e[6],u=e[7],c=e[8],l=e[9],d=e[10],f=e[11],p=e[12],_=e[13],g=e[14],m=e[15],v=i*o-r*s,S=i*h-n*s,x=i*u-a*s,b=r*h-n*o,M=r*u-a*o,y=n*u-a*h,T=c*_-l*p,w=c*g-d*p,C=c*m-f*p,A=l*g-d*_,E=l*m-f*_,I=d*m-f*g,F=v*I-S*E+x*A+b*C-M*w+y*T;return F?(F=1/F,t[0]=(o*I-h*E+u*A)*F,t[1]=(h*C-s*I-u*w)*F,t[2]=(s*E-o*C+u*T)*F,t[3]=(n*E-r*I-a*A)*F,t[4]=(i*I-n*C+a*w)*F,t[5]=(r*C-i*E-a*T)*F,t[6]=(_*y-g*M+m*b)*F,t[7]=(g*x-p*y-m*S)*F,t[8]=(p*M-_*x+m*v)*F,t):null},n.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},n.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))},n.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t},n.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t},n.sub=n.subtract,n.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t},n.multiplyScalarAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t},n.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},n.equals=function(t,e){var i=t[0],n=t[1],a=t[2],s=t[3],o=t[4],h=t[5],u=t[6],c=t[7],l=t[8],d=e[0],f=e[1],p=e[2],_=e[3],g=e[4],m=e[5],v=t[6],S=e[7],x=e[8];return Math.abs(i-d)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(n-f)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(a-p)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(s-_)<=r.EPSILON*Math.max(1,Math.abs(s),Math.abs(_))&&Math.abs(o-g)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(g))&&Math.abs(h-m)<=r.EPSILON*Math.max(1,Math.abs(h),Math.abs(m))&&Math.abs(u-v)<=r.EPSILON*Math.max(1,Math.abs(u),Math.abs(v))&&Math.abs(c-S)<=r.EPSILON*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(l-x)<=r.EPSILON*Math.max(1,Math.abs(l),Math.abs(x))},t.exports=n},function(t,e,i){var r=i(18),n={scalar:{},SIMD:{}};n.create=function(){var t=new r.ARRAY_TYPE(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},n.clone=function(t){var e=new r.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},n.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},n.fromValues=function(t,e,i,n,a,s,o,h,u,c,l,d,f,p,_,g){var m=new r.ARRAY_TYPE(16);return m[0]=t,m[1]=e,m[2]=i,m[3]=n,m[4]=a,m[5]=s,m[6]=o,m[7]=h,m[8]=u,m[9]=c,m[10]=l,m[11]=d,m[12]=f,m[13]=p,m[14]=_,m[15]=g,m},n.set=function(t,e,i,r,n,a,s,o,h,u,c,l,d,f,p,_,g){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t[4]=a,t[5]=s,t[6]=o,t[7]=h,t[8]=u,t[9]=c,t[10]=l,t[11]=d,t[12]=f,t[13]=p,t[14]=_,t[15]=g,t},n.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},n.scalar.transpose=function(t,e){if(t===e){var i=e[1],r=e[2],n=e[3],a=e[6],s=e[7],o=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=a,t[11]=e[14],t[12]=n,t[13]=s,t[14]=o}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},n.SIMD.transpose=function(t,e){var i,r,n,a,s,o,h,u,c,l;return i=SIMD.Float32x4.load(e,0),r=SIMD.Float32x4.load(e,4),n=SIMD.Float32x4.load(e,8),a=SIMD.Float32x4.load(e,12),s=SIMD.Float32x4.shuffle(i,r,0,1,4,5),o=SIMD.Float32x4.shuffle(n,a,0,1,4,5),h=SIMD.Float32x4.shuffle(s,o,0,2,4,6),u=SIMD.Float32x4.shuffle(s,o,1,3,5,7),SIMD.Float32x4.store(t,0,h),SIMD.Float32x4.store(t,4,u),s=SIMD.Float32x4.shuffle(i,r,2,3,6,7),o=SIMD.Float32x4.shuffle(n,a,2,3,6,7),c=SIMD.Float32x4.shuffle(s,o,0,2,4,6),l=SIMD.Float32x4.shuffle(s,o,1,3,5,7),SIMD.Float32x4.store(t,8,c),SIMD.Float32x4.store(t,12,l),t},n.transpose=r.USE_SIMD?n.SIMD.transpose:n.scalar.transpose,n.scalar.invert=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],s=e[4],o=e[5],h=e[6],u=e[7],c=e[8],l=e[9],d=e[10],f=e[11],p=e[12],_=e[13],g=e[14],m=e[15],v=i*o-r*s,S=i*h-n*s,x=i*u-a*s,b=r*h-n*o,M=r*u-a*o,y=n*u-a*h,T=c*_-l*p,w=c*g-d*p,C=c*m-f*p,A=l*g-d*_,E=l*m-f*_,I=d*m-f*g,F=v*I-S*E+x*A+b*C-M*w+y*T;return F?(F=1/F,t[0]=(o*I-h*E+u*A)*F,t[1]=(n*E-r*I-a*A)*F,t[2]=(_*y-g*M+m*b)*F,t[3]=(d*M-l*y-f*b)*F,t[4]=(h*C-s*I-u*w)*F,t[5]=(i*I-n*C+a*w)*F,t[6]=(g*x-p*y-m*S)*F,t[7]=(c*y-d*x+f*S)*F,t[8]=(s*E-o*C+u*T)*F,t[9]=(r*C-i*E-a*T)*F,t[10]=(p*M-_*x+m*v)*F,t[11]=(l*x-c*M-f*v)*F,t[12]=(o*w-s*A-h*T)*F,t[13]=(i*A-r*w+n*T)*F,t[14]=(_*S-p*b-g*v)*F,t[15]=(c*b-l*S+d*v)*F,t):null},n.SIMD.invert=function(t,e){var i,r,n,a,s,o,h,u,c,l,d=SIMD.Float32x4.load(e,0),f=SIMD.Float32x4.load(e,4),p=SIMD.Float32x4.load(e,8),_=SIMD.Float32x4.load(e,12);return s=SIMD.Float32x4.shuffle(d,f,0,1,4,5),r=SIMD.Float32x4.shuffle(p,_,0,1,4,5),i=SIMD.Float32x4.shuffle(s,r,0,2,4,6),r=SIMD.Float32x4.shuffle(r,s,1,3,5,7),s=SIMD.Float32x4.shuffle(d,f,2,3,6,7),a=SIMD.Float32x4.shuffle(p,_,2,3,6,7),n=SIMD.Float32x4.shuffle(s,a,0,2,4,6),a=SIMD.Float32x4.shuffle(a,s,1,3,5,7),s=SIMD.Float32x4.mul(n,a),s=SIMD.Float32x4.swizzle(s,1,0,3,2),o=SIMD.Float32x4.mul(r,s),h=SIMD.Float32x4.mul(i,s),s=SIMD.Float32x4.swizzle(s,2,3,0,1),o=SIMD.Float32x4.sub(SIMD.Float32x4.mul(r,s),o),h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,s),h),h=SIMD.Float32x4.swizzle(h,2,3,0,1),s=SIMD.Float32x4.mul(r,n),s=SIMD.Float32x4.swizzle(s,1,0,3,2),o=SIMD.Float32x4.add(SIMD.Float32x4.mul(a,s),o),c=SIMD.Float32x4.mul(i,s),s=SIMD.Float32x4.swizzle(s,2,3,0,1),o=SIMD.Float32x4.sub(o,SIMD.Float32x4.mul(a,s)),c=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,s),c),c=SIMD.Float32x4.swizzle(c,2,3,0,1),s=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(r,2,3,0,1),a),s=SIMD.Float32x4.swizzle(s,1,0,3,2),n=SIMD.Float32x4.swizzle(n,2,3,0,1),o=SIMD.Float32x4.add(SIMD.Float32x4.mul(n,s),o),u=SIMD.Float32x4.mul(i,s),s=SIMD.Float32x4.swizzle(s,2,3,0,1),o=SIMD.Float32x4.sub(o,SIMD.Float32x4.mul(n,s)),u=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,s),u),u=SIMD.Float32x4.swizzle(u,2,3,0,1),s=SIMD.Float32x4.mul(i,r),s=SIMD.Float32x4.swizzle(s,1,0,3,2),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(a,s),u),c=SIMD.Float32x4.sub(SIMD.Float32x4.mul(n,s),c),s=SIMD.Float32x4.swizzle(s,2,3,0,1),u=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,s),u),c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(n,s)),s=SIMD.Float32x4.mul(i,a),s=SIMD.Float32x4.swizzle(s,1,0,3,2),h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(n,s)),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(r,s),u),s=SIMD.Float32x4.swizzle(s,2,3,0,1),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(n,s),h),u=SIMD.Float32x4.sub(u,SIMD.Float32x4.mul(r,s)),s=SIMD.Float32x4.mul(i,n),s=SIMD.Float32x4.swizzle(s,1,0,3,2),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(a,s),h),c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(r,s)),s=SIMD.Float32x4.swizzle(s,2,3,0,1),h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(a,s)),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(r,s),c),l=SIMD.Float32x4.mul(i,o),l=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(l,2,3,0,1),l),l=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(l,1,0,3,2),l),s=SIMD.Float32x4.reciprocalApproximation(l),l=SIMD.Float32x4.sub(SIMD.Float32x4.add(s,s),SIMD.Float32x4.mul(l,SIMD.Float32x4.mul(s,s))),(l=SIMD.Float32x4.swizzle(l,0,0,0,0))?(SIMD.Float32x4.store(t,0,SIMD.Float32x4.mul(l,o)),SIMD.Float32x4.store(t,4,SIMD.Float32x4.mul(l,h)),SIMD.Float32x4.store(t,8,SIMD.Float32x4.mul(l,u)),SIMD.Float32x4.store(t,12,SIMD.Float32x4.mul(l,c)),t):null},n.invert=r.USE_SIMD?n.SIMD.invert:n.scalar.invert,n.scalar.adjoint=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],s=e[4],o=e[5],h=e[6],u=e[7],c=e[8],l=e[9],d=e[10],f=e[11],p=e[12],_=e[13],g=e[14],m=e[15];return t[0]=o*(d*m-f*g)-l*(h*m-u*g)+_*(h*f-u*d),t[1]=-(r*(d*m-f*g)-l*(n*m-a*g)+_*(n*f-a*d)),t[2]=r*(h*m-u*g)-o*(n*m-a*g)+_*(n*u-a*h),t[3]=-(r*(h*f-u*d)-o*(n*f-a*d)+l*(n*u-a*h)),t[4]=-(s*(d*m-f*g)-c*(h*m-u*g)+p*(h*f-u*d)),t[5]=i*(d*m-f*g)-c*(n*m-a*g)+p*(n*f-a*d),t[6]=-(i*(h*m-u*g)-s*(n*m-a*g)+p*(n*u-a*h)),t[7]=i*(h*f-u*d)-s*(n*f-a*d)+c*(n*u-a*h),t[8]=s*(l*m-f*_)-c*(o*m-u*_)+p*(o*f-u*l),t[9]=-(i*(l*m-f*_)-c*(r*m-a*_)+p*(r*f-a*l)),t[10]=i*(o*m-u*_)-s*(r*m-a*_)+p*(r*u-a*o),t[11]=-(i*(o*f-u*l)-s*(r*f-a*l)+c*(r*u-a*o)),t[12]=-(s*(l*g-d*_)-c*(o*g-h*_)+p*(o*d-h*l)),t[13]=i*(l*g-d*_)-c*(r*g-n*_)+p*(r*d-n*l),t[14]=-(i*(o*g-h*_)-s*(r*g-n*_)+p*(r*h-n*o)),t[15]=i*(o*d-h*l)-s*(r*d-n*l)+c*(r*h-n*o),t},n.SIMD.adjoint=function(t,e){var i,r,n,a,s,o,h,u,c,l,d,f,p,i=SIMD.Float32x4.load(e,0),r=SIMD.Float32x4.load(e,4),n=SIMD.Float32x4.load(e,8),a=SIMD.Float32x4.load(e,12);return c=SIMD.Float32x4.shuffle(i,r,0,1,4,5),o=SIMD.Float32x4.shuffle(n,a,0,1,4,5),s=SIMD.Float32x4.shuffle(c,o,0,2,4,6),o=SIMD.Float32x4.shuffle(o,c,1,3,5,7),c=SIMD.Float32x4.shuffle(i,r,2,3,6,7),u=SIMD.Float32x4.shuffle(n,a,2,3,6,7),h=SIMD.Float32x4.shuffle(c,u,0,2,4,6),u=SIMD.Float32x4.shuffle(u,c,1,3,5,7),c=SIMD.Float32x4.mul(h,u),c=SIMD.Float32x4.swizzle(c,1,0,3,2),l=SIMD.Float32x4.mul(o,c),d=SIMD.Float32x4.mul(s,c),c=SIMD.Float32x4.swizzle(c,2,3,0,1),l=SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,c),l),d=SIMD.Float32x4.sub(SIMD.Float32x4.mul(s,c),d),d=SIMD.Float32x4.swizzle(d,2,3,0,1),c=SIMD.Float32x4.mul(o,h),c=SIMD.Float32x4.swizzle(c,1,0,3,2),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(u,c),l),p=SIMD.Float32x4.mul(s,c),c=SIMD.Float32x4.swizzle(c,2,3,0,1),l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(u,c)),p=SIMD.Float32x4.sub(SIMD.Float32x4.mul(s,c),p),p=SIMD.Float32x4.swizzle(p,2,3,0,1),c=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(o,2,3,0,1),u),c=SIMD.Float32x4.swizzle(c,1,0,3,2),h=SIMD.Float32x4.swizzle(h,2,3,0,1),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(h,c),l),f=SIMD.Float32x4.mul(s,c),c=SIMD.Float32x4.swizzle(c,2,3,0,1),l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(h,c)),f=SIMD.Float32x4.sub(SIMD.Float32x4.mul(s,c),f),f=SIMD.Float32x4.swizzle(f,2,3,0,1),c=SIMD.Float32x4.mul(s,o),c=SIMD.Float32x4.swizzle(c,1,0,3,2),f=SIMD.Float32x4.add(SIMD.Float32x4.mul(u,c),f),p=SIMD.Float32x4.sub(SIMD.Float32x4.mul(h,c),p),c=SIMD.Float32x4.swizzle(c,2,3,0,1),f=SIMD.Float32x4.sub(SIMD.Float32x4.mul(u,c),f),p=SIMD.Float32x4.sub(p,SIMD.Float32x4.mul(h,c)),c=SIMD.Float32x4.mul(s,u),c=SIMD.Float32x4.swizzle(c,1,0,3,2),d=SIMD.Float32x4.sub(d,SIMD.Float32x4.mul(h,c)),f=SIMD.Float32x4.add(SIMD.Float32x4.mul(o,c),f),c=SIMD.Float32x4.swizzle(c,2,3,0,1),d=SIMD.Float32x4.add(SIMD.Float32x4.mul(h,c),d),f=SIMD.Float32x4.sub(f,SIMD.Float32x4.mul(o,c)),c=SIMD.Float32x4.mul(s,h),c=SIMD.Float32x4.swizzle(c,1,0,3,2),d=SIMD.Float32x4.add(SIMD.Float32x4.mul(u,c),d),p=SIMD.Float32x4.sub(p,SIMD.Float32x4.mul(o,c)),c=SIMD.Float32x4.swizzle(c,2,3,0,1),d=SIMD.Float32x4.sub(d,SIMD.Float32x4.mul(u,c)),p=SIMD.Float32x4.add(SIMD.Float32x4.mul(o,c),p),SIMD.Float32x4.store(t,0,l),SIMD.Float32x4.store(t,4,d),SIMD.Float32x4.store(t,8,f),SIMD.Float32x4.store(t,12,p),t},n.adjoint=r.USE_SIMD?n.SIMD.adjoint:n.scalar.adjoint,n.determinant=function(t){var e=t[0],i=t[1],r=t[2],n=t[3],a=t[4],s=t[5],o=t[6],h=t[7],u=t[8],c=t[9],l=t[10],d=t[11],f=t[12],p=t[13],_=t[14],g=t[15],m=e*s-i*a,v=e*o-r*a,S=e*h-n*a,x=i*o-r*s,b=i*h-n*s,M=r*h-n*o,y=u*p-c*f,T=u*_-l*f,w=u*g-d*f,C=c*_-l*p,A=c*g-d*p,E=l*g-d*_;return m*E-v*A+S*C+x*w-b*T+M*y},n.SIMD.multiply=function(t,e,i){var r=SIMD.Float32x4.load(e,0),n=SIMD.Float32x4.load(e,4),a=SIMD.Float32x4.load(e,8),s=SIMD.Float32x4.load(e,12),o=SIMD.Float32x4.load(i,0),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(o,0,0,0,0),r),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(o,1,1,1,1),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(o,2,2,2,2),a),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(o,3,3,3,3),s))));SIMD.Float32x4.store(t,0,h);var u=SIMD.Float32x4.load(i,4),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,0,0,0,0),r),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,1,1,1,1),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,2,2,2,2),a),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,3,3,3,3),s))));SIMD.Float32x4.store(t,4,c);var l=SIMD.Float32x4.load(i,8),d=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,0,0,0,0),r),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,1,1,1,1),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,2,2,2,2),a),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,3,3,3,3),s))));SIMD.Float32x4.store(t,8,d);var f=SIMD.Float32x4.load(i,12),p=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,0,0,0,0),r),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,1,1,1,1),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,2,2,2,2),a),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,3,3,3,3),s))));return SIMD.Float32x4.store(t,12,p),t},n.scalar.multiply=function(t,e,i){var r=e[0],n=e[1],a=e[2],s=e[3],o=e[4],h=e[5],u=e[6],c=e[7],l=e[8],d=e[9],f=e[10],p=e[11],_=e[12],g=e[13],m=e[14],v=e[15],S=i[0],x=i[1],b=i[2],M=i[3];return t[0]=S*r+x*o+b*l+M*_,t[1]=S*n+x*h+b*d+M*g,t[2]=S*a+x*u+b*f+M*m,t[3]=S*s+x*c+b*p+M*v,S=i[4],x=i[5],b=i[6],M=i[7],t[4]=S*r+x*o+b*l+M*_,t[5]=S*n+x*h+b*d+M*g,t[6]=S*a+x*u+b*f+M*m,t[7]=S*s+x*c+b*p+M*v,S=i[8],x=i[9],b=i[10],M=i[11],t[8]=S*r+x*o+b*l+M*_,t[9]=S*n+x*h+b*d+M*g,t[10]=S*a+x*u+b*f+M*m,t[11]=S*s+x*c+b*p+M*v,S=i[12],x=i[13],b=i[14],M=i[15],t[12]=S*r+x*o+b*l+M*_,t[13]=S*n+x*h+b*d+M*g,t[14]=S*a+x*u+b*f+M*m,t[15]=S*s+x*c+b*p+M*v,t},n.multiply=r.USE_SIMD?n.SIMD.multiply:n.scalar.multiply,n.mul=n.multiply,n.scalar.translate=function(t,e,i){var r,n,a,s,o,h,u,c,l,d,f,p,_=i[0],g=i[1],m=i[2];return e===t?(t[12]=e[0]*_+e[4]*g+e[8]*m+e[12],t[13]=e[1]*_+e[5]*g+e[9]*m+e[13],t[14]=e[2]*_+e[6]*g+e[10]*m+e[14],t[15]=e[3]*_+e[7]*g+e[11]*m+e[15]):(r=e[0],n=e[1],a=e[2],s=e[3],o=e[4],h=e[5],u=e[6],c=e[7],l=e[8],d=e[9],f=e[10],p=e[11],t[0]=r,t[1]=n,t[2]=a,t[3]=s,t[4]=o,t[5]=h,t[6]=u,t[7]=c,t[8]=l,t[9]=d,t[10]=f,t[11]=p,t[12]=r*_+o*g+l*m+e[12],t[13]=n*_+h*g+d*m+e[13],t[14]=a*_+u*g+f*m+e[14],t[15]=s*_+c*g+p*m+e[15]),t},n.SIMD.translate=function(t,e,i){var r=SIMD.Float32x4.load(e,0),n=SIMD.Float32x4.load(e,4),a=SIMD.Float32x4.load(e,8),s=SIMD.Float32x4.load(e,12),o=SIMD.Float32x4(i[0],i[1],i[2],0);e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11]),r=SIMD.Float32x4.mul(r,SIMD.Float32x4.swizzle(o,0,0,0,0)),n=SIMD.Float32x4.mul(n,SIMD.Float32x4.swizzle(o,1,1,1,1)),a=SIMD.Float32x4.mul(a,SIMD.Float32x4.swizzle(o,2,2,2,2));var h=SIMD.Float32x4.add(r,SIMD.Float32x4.add(n,SIMD.Float32x4.add(a,s)));return SIMD.Float32x4.store(t,12,h),t},n.translate=r.USE_SIMD?n.SIMD.translate:n.scalar.translate,n.scalar.scale=function(t,e,i){var r=i[0],n=i[1],a=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},n.SIMD.scale=function(t,e,i){var r,n,a,s=SIMD.Float32x4(i[0],i[1],i[2],0);return r=SIMD.Float32x4.load(e,0),SIMD.Float32x4.store(t,0,SIMD.Float32x4.mul(r,SIMD.Float32x4.swizzle(s,0,0,0,0))),n=SIMD.Float32x4.load(e,4),SIMD.Float32x4.store(t,4,SIMD.Float32x4.mul(n,SIMD.Float32x4.swizzle(s,1,1,1,1))),a=SIMD.Float32x4.load(e,8),SIMD.Float32x4.store(t,8,SIMD.Float32x4.mul(a,SIMD.Float32x4.swizzle(s,2,2,2,2))),t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},n.scale=r.USE_SIMD?n.SIMD.scale:n.scalar.scale,n.rotate=function(t,e,i,n){var a,s,o,h,u,c,l,d,f,p,_,g,m,v,S,x,b,M,y,T,w,C,A,E,I=n[0],F=n[1],R=n[2],N=Math.sqrt(I*I+F*F+R*R);return Math.abs(N)<r.EPSILON?null:(N=1/N,I*=N,F*=N,R*=N,a=Math.sin(i),s=Math.cos(i),o=1-s,h=e[0],u=e[1],c=e[2],l=e[3],d=e[4],f=e[5],p=e[6],_=e[7],g=e[8],m=e[9],v=e[10],S=e[11],x=I*I*o+s,b=F*I*o+R*a,M=R*I*o-F*a,y=I*F*o-R*a,T=F*F*o+s,w=R*F*o+I*a,C=I*R*o+F*a,A=F*R*o-I*a,E=R*R*o+s,t[0]=h*x+d*b+g*M,t[1]=u*x+f*b+m*M,t[2]=c*x+p*b+v*M,t[3]=l*x+_*b+S*M,t[4]=h*y+d*T+g*w,t[5]=u*y+f*T+m*w,t[6]=c*y+p*T+v*w,t[7]=l*y+_*T+S*w,t[8]=h*C+d*A+g*E,t[9]=u*C+f*A+m*E,t[10]=c*C+p*A+v*E,t[11]=l*C+_*A+S*E,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},n.scalar.rotateX=function(t,e,i){var r=Math.sin(i),n=Math.cos(i),a=e[4],s=e[5],o=e[6],h=e[7],u=e[8],c=e[9],l=e[10],d=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*n+u*r,t[5]=s*n+c*r,t[6]=o*n+l*r,t[7]=h*n+d*r,t[8]=u*n-a*r,t[9]=c*n-s*r,t[10]=l*n-o*r,t[11]=d*n-h*r,t},n.SIMD.rotateX=function(t,e,i){var r=SIMD.Float32x4.splat(Math.sin(i)),n=SIMD.Float32x4.splat(Math.cos(i));e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var a=SIMD.Float32x4.load(e,4),s=SIMD.Float32x4.load(e,8);return SIMD.Float32x4.store(t,4,SIMD.Float32x4.add(SIMD.Float32x4.mul(a,n),SIMD.Float32x4.mul(s,r))),SIMD.Float32x4.store(t,8,SIMD.Float32x4.sub(SIMD.Float32x4.mul(s,n),SIMD.Float32x4.mul(a,r))),t},n.rotateX=r.USE_SIMD?n.SIMD.rotateX:n.scalar.rotateX,n.scalar.rotateY=function(t,e,i){var r=Math.sin(i),n=Math.cos(i),a=e[0],s=e[1],o=e[2],h=e[3],u=e[8],c=e[9],l=e[10],d=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*n-u*r,t[1]=s*n-c*r,t[2]=o*n-l*r,t[3]=h*n-d*r,t[8]=a*r+u*n,t[9]=s*r+c*n,t[10]=o*r+l*n,t[11]=h*r+d*n,t},n.SIMD.rotateY=function(t,e,i){var r=SIMD.Float32x4.splat(Math.sin(i)),n=SIMD.Float32x4.splat(Math.cos(i));e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var a=SIMD.Float32x4.load(e,0),s=SIMD.Float32x4.load(e,8);return SIMD.Float32x4.store(t,0,SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,n),SIMD.Float32x4.mul(s,r))),SIMD.Float32x4.store(t,8,SIMD.Float32x4.add(SIMD.Float32x4.mul(a,r),SIMD.Float32x4.mul(s,n))),t},n.rotateY=r.USE_SIMD?n.SIMD.rotateY:n.scalar.rotateY,n.scalar.rotateZ=function(t,e,i){var r=Math.sin(i),n=Math.cos(i),a=e[0],s=e[1],o=e[2],h=e[3],u=e[4],c=e[5],l=e[6],d=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*n+u*r,t[1]=s*n+c*r,t[2]=o*n+l*r,t[3]=h*n+d*r,t[4]=u*n-a*r,t[5]=c*n-s*r,t[6]=l*n-o*r,t[7]=d*n-h*r,t},n.SIMD.rotateZ=function(t,e,i){var r=SIMD.Float32x4.splat(Math.sin(i)),n=SIMD.Float32x4.splat(Math.cos(i));e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var a=SIMD.Float32x4.load(e,0),s=SIMD.Float32x4.load(e,4);return SIMD.Float32x4.store(t,0,SIMD.Float32x4.add(SIMD.Float32x4.mul(a,n),SIMD.Float32x4.mul(s,r))),SIMD.Float32x4.store(t,4,SIMD.Float32x4.sub(SIMD.Float32x4.mul(s,n),SIMD.Float32x4.mul(a,r))),t},n.rotateZ=r.USE_SIMD?n.SIMD.rotateZ:n.scalar.rotateZ,n.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},n.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},n.fromRotation=function(t,e,i){var n,a,s,o=i[0],h=i[1],u=i[2],c=Math.sqrt(o*o+h*h+u*u);return Math.abs(c)<r.EPSILON?null:(c=1/c,o*=c,
h*=c,u*=c,n=Math.sin(e),a=Math.cos(e),s=1-a,t[0]=o*o*s+a,t[1]=h*o*s+u*n,t[2]=u*o*s-h*n,t[3]=0,t[4]=o*h*s-u*n,t[5]=h*h*s+a,t[6]=u*h*s+o*n,t[7]=0,t[8]=o*u*s+h*n,t[9]=h*u*s-o*n,t[10]=u*u*s+a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},n.fromXRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=i,t[7]=0,t[8]=0,t[9]=-i,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},n.fromYRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-i,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=i,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},n.fromZRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=0,t[4]=-i,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},n.fromRotationTranslation=function(t,e,i){var r=e[0],n=e[1],a=e[2],s=e[3],o=r+r,h=n+n,u=a+a,c=r*o,l=r*h,d=r*u,f=n*h,p=n*u,_=a*u,g=s*o,m=s*h,v=s*u;return t[0]=1-(f+_),t[1]=l+v,t[2]=d-m,t[3]=0,t[4]=l-v,t[5]=1-(c+_),t[6]=p+g,t[7]=0,t[8]=d+m,t[9]=p-g,t[10]=1-(c+f),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t},n.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},n.getRotation=function(t,e){var i=e[0]+e[5]+e[10],r=0;return i>0?(r=2*Math.sqrt(i+1),t[3]=.25*r,t[0]=(e[6]-e[9])/r,t[1]=(e[8]-e[2])/r,t[2]=(e[1]-e[4])/r):e[0]>e[5]&e[0]>e[10]?(r=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/r,t[0]=.25*r,t[1]=(e[1]+e[4])/r,t[2]=(e[8]+e[2])/r):e[5]>e[10]?(r=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/r,t[0]=(e[1]+e[4])/r,t[1]=.25*r,t[2]=(e[6]+e[9])/r):(r=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/r,t[0]=(e[8]+e[2])/r,t[1]=(e[6]+e[9])/r,t[2]=.25*r),t},n.fromRotationTranslationScale=function(t,e,i,r){var n=e[0],a=e[1],s=e[2],o=e[3],h=n+n,u=a+a,c=s+s,l=n*h,d=n*u,f=n*c,p=a*u,_=a*c,g=s*c,m=o*h,v=o*u,S=o*c,x=r[0],b=r[1],M=r[2];return t[0]=(1-(p+g))*x,t[1]=(d+S)*x,t[2]=(f-v)*x,t[3]=0,t[4]=(d-S)*b,t[5]=(1-(l+g))*b,t[6]=(_+m)*b,t[7]=0,t[8]=(f+v)*M,t[9]=(_-m)*M,t[10]=(1-(l+p))*M,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t},n.fromRotationTranslationScaleOrigin=function(t,e,i,r,n){var a=e[0],s=e[1],o=e[2],h=e[3],u=a+a,c=s+s,l=o+o,d=a*u,f=a*c,p=a*l,_=s*c,g=s*l,m=o*l,v=h*u,S=h*c,x=h*l,b=r[0],M=r[1],y=r[2],T=n[0],w=n[1],C=n[2];return t[0]=(1-(_+m))*b,t[1]=(f+x)*b,t[2]=(p-S)*b,t[3]=0,t[4]=(f-x)*M,t[5]=(1-(d+m))*M,t[6]=(g+v)*M,t[7]=0,t[8]=(p+S)*y,t[9]=(g-v)*y,t[10]=(1-(d+_))*y,t[11]=0,t[12]=i[0]+T-(t[0]*T+t[4]*w+t[8]*C),t[13]=i[1]+w-(t[1]*T+t[5]*w+t[9]*C),t[14]=i[2]+C-(t[2]*T+t[6]*w+t[10]*C),t[15]=1,t},n.fromQuat=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],s=i+i,o=r+r,h=n+n,u=i*s,c=r*s,l=r*o,d=n*s,f=n*o,p=n*h,_=a*s,g=a*o,m=a*h;return t[0]=1-l-p,t[1]=c+m,t[2]=d-g,t[3]=0,t[4]=c-m,t[5]=1-u-p,t[6]=f+_,t[7]=0,t[8]=d+g,t[9]=f-_,t[10]=1-u-l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},n.frustum=function(t,e,i,r,n,a,s){var o=1/(i-e),h=1/(n-r),u=1/(a-s);return t[0]=2*a*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*a*h,t[6]=0,t[7]=0,t[8]=(i+e)*o,t[9]=(n+r)*h,t[10]=(s+a)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=s*a*2*u,t[15]=0,t},n.perspective=function(t,e,i,r,n){var a=1/Math.tan(e/2),s=1/(r-n);return t[0]=a/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(n+r)*s,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*n*r*s,t[15]=0,t},n.perspectiveFromFieldOfView=function(t,e,i,r){var n=Math.tan(e.upDegrees*Math.PI/180),a=Math.tan(e.downDegrees*Math.PI/180),s=Math.tan(e.leftDegrees*Math.PI/180),o=Math.tan(e.rightDegrees*Math.PI/180),h=2/(s+o),u=2/(n+a);return t[0]=h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=-((s-o)*h*.5),t[9]=(n-a)*u*.5,t[10]=r/(i-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*i/(i-r),t[15]=0,t},n.ortho=function(t,e,i,r,n,a,s){var o=1/(e-i),h=1/(r-n),u=1/(a-s);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+i)*o,t[13]=(n+r)*h,t[14]=(s+a)*u,t[15]=1,t},n.lookAt=function(t,e,i,a){var s,o,h,u,c,l,d,f,p,_,g=e[0],m=e[1],v=e[2],S=a[0],x=a[1],b=a[2],M=i[0],y=i[1],T=i[2];return Math.abs(g-M)<r.EPSILON&&Math.abs(m-y)<r.EPSILON&&Math.abs(v-T)<r.EPSILON?n.identity(t):(d=g-M,f=m-y,p=v-T,_=1/Math.sqrt(d*d+f*f+p*p),d*=_,f*=_,p*=_,s=x*p-b*f,o=b*d-S*p,h=S*f-x*d,_=Math.sqrt(s*s+o*o+h*h),_?(_=1/_,s*=_,o*=_,h*=_):(s=0,o=0,h=0),u=f*h-p*o,c=p*s-d*h,l=d*o-f*s,_=Math.sqrt(u*u+c*c+l*l),_?(_=1/_,u*=_,c*=_,l*=_):(u=0,c=0,l=0),t[0]=s,t[1]=u,t[2]=d,t[3]=0,t[4]=o,t[5]=c,t[6]=f,t[7]=0,t[8]=h,t[9]=l,t[10]=p,t[11]=0,t[12]=-(s*g+o*m+h*v),t[13]=-(u*g+c*m+l*v),t[14]=-(d*g+f*m+p*v),t[15]=1,t)},n.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},n.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))},n.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t[9]=e[9]+i[9],t[10]=e[10]+i[10],t[11]=e[11]+i[11],t[12]=e[12]+i[12],t[13]=e[13]+i[13],t[14]=e[14]+i[14],t[15]=e[15]+i[15],t},n.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t[9]=e[9]-i[9],t[10]=e[10]-i[10],t[11]=e[11]-i[11],t[12]=e[12]-i[12],t[13]=e[13]-i[13],t[14]=e[14]-i[14],t[15]=e[15]-i[15],t},n.sub=n.subtract,n.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12]*i,t[13]=e[13]*i,t[14]=e[14]*i,t[15]=e[15]*i,t},n.multiplyScalarAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t[9]=e[9]+i[9]*r,t[10]=e[10]+i[10]*r,t[11]=e[11]+i[11]*r,t[12]=e[12]+i[12]*r,t[13]=e[13]+i[13]*r,t[14]=e[14]+i[14]*r,t[15]=e[15]+i[15]*r,t},n.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},n.equals=function(t,e){var i=t[0],n=t[1],a=t[2],s=t[3],o=t[4],h=t[5],u=t[6],c=t[7],l=t[8],d=t[9],f=t[10],p=t[11],_=t[12],g=t[13],m=t[14],v=t[15],S=e[0],x=e[1],b=e[2],M=e[3],y=e[4],T=e[5],w=e[6],C=e[7],A=e[8],E=e[9],I=e[10],F=e[11],R=e[12],N=e[13],D=e[14],L=e[15];return Math.abs(i-S)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(S))&&Math.abs(n-x)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(x))&&Math.abs(a-b)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(s-M)<=r.EPSILON*Math.max(1,Math.abs(s),Math.abs(M))&&Math.abs(o-y)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(y))&&Math.abs(h-T)<=r.EPSILON*Math.max(1,Math.abs(h),Math.abs(T))&&Math.abs(u-w)<=r.EPSILON*Math.max(1,Math.abs(u),Math.abs(w))&&Math.abs(c-C)<=r.EPSILON*Math.max(1,Math.abs(c),Math.abs(C))&&Math.abs(l-A)<=r.EPSILON*Math.max(1,Math.abs(l),Math.abs(A))&&Math.abs(d-E)<=r.EPSILON*Math.max(1,Math.abs(d),Math.abs(E))&&Math.abs(f-I)<=r.EPSILON*Math.max(1,Math.abs(f),Math.abs(I))&&Math.abs(p-F)<=r.EPSILON*Math.max(1,Math.abs(p),Math.abs(F))&&Math.abs(_-R)<=r.EPSILON*Math.max(1,Math.abs(_),Math.abs(R))&&Math.abs(g-N)<=r.EPSILON*Math.max(1,Math.abs(g),Math.abs(N))&&Math.abs(m-D)<=r.EPSILON*Math.max(1,Math.abs(m),Math.abs(D))&&Math.abs(v-L)<=r.EPSILON*Math.max(1,Math.abs(v),Math.abs(L))},t.exports=n},function(t,e,i){var r=i(18),n=i(21),a=i(24),s=i(25),o={};o.create=function(){var t=new r.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},o.rotationTo=function(){var t=a.create(),e=a.fromValues(1,0,0),i=a.fromValues(0,1,0);return function(r,n,s){var h=a.dot(n,s);return h<-.999999?(a.cross(t,e,n),a.length(t)<1e-6&&a.cross(t,i,n),a.normalize(t,t),o.setAxisAngle(r,t,Math.PI),r):h>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(a.cross(t,n,s),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=1+h,o.normalize(r,r))}}(),o.setAxes=function(){var t=n.create();return function(e,i,r,n){return t[0]=r[0],t[3]=r[1],t[6]=r[2],t[1]=n[0],t[4]=n[1],t[7]=n[2],t[2]=-i[0],t[5]=-i[1],t[8]=-i[2],o.normalize(e,o.fromMat3(e,t))}}(),o.clone=s.clone,o.fromValues=s.fromValues,o.copy=s.copy,o.set=s.set,o.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},o.setAxisAngle=function(t,e,i){i=.5*i;var r=Math.sin(i);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(i),t},o.getAxisAngle=function(t,e){var i=2*Math.acos(e[3]),r=Math.sin(i/2);return 0!=r?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),i},o.add=s.add,o.multiply=function(t,e,i){var r=e[0],n=e[1],a=e[2],s=e[3],o=i[0],h=i[1],u=i[2],c=i[3];return t[0]=r*c+s*o+n*u-a*h,t[1]=n*c+s*h+a*o-r*u,t[2]=a*c+s*u+r*h-n*o,t[3]=s*c-r*o-n*h-a*u,t},o.mul=o.multiply,o.scale=s.scale,o.rotateX=function(t,e,i){i*=.5;var r=e[0],n=e[1],a=e[2],s=e[3],o=Math.sin(i),h=Math.cos(i);return t[0]=r*h+s*o,t[1]=n*h+a*o,t[2]=a*h-n*o,t[3]=s*h-r*o,t},o.rotateY=function(t,e,i){i*=.5;var r=e[0],n=e[1],a=e[2],s=e[3],o=Math.sin(i),h=Math.cos(i);return t[0]=r*h-a*o,t[1]=n*h+s*o,t[2]=a*h+r*o,t[3]=s*h-n*o,t},o.rotateZ=function(t,e,i){i*=.5;var r=e[0],n=e[1],a=e[2],s=e[3],o=Math.sin(i),h=Math.cos(i);return t[0]=r*h+n*o,t[1]=n*h-r*o,t[2]=a*h+s*o,t[3]=s*h-a*o,t},o.calculateW=function(t,e){var i=e[0],r=e[1],n=e[2];return t[0]=i,t[1]=r,t[2]=n,t[3]=Math.sqrt(Math.abs(1-i*i-r*r-n*n)),t},o.dot=s.dot,o.lerp=s.lerp,o.slerp=function(t,e,i,r){var n,a,s,o,h,u=e[0],c=e[1],l=e[2],d=e[3],f=i[0],p=i[1],_=i[2],g=i[3];return a=u*f+c*p+l*_+d*g,a<0&&(a=-a,f=-f,p=-p,_=-_,g=-g),1-a>1e-6?(n=Math.acos(a),s=Math.sin(n),o=Math.sin((1-r)*n)/s,h=Math.sin(r*n)/s):(o=1-r,h=r),t[0]=o*u+h*f,t[1]=o*c+h*p,t[2]=o*l+h*_,t[3]=o*d+h*g,t},o.sqlerp=function(){var t=o.create(),e=o.create();return function(i,r,n,a,s,h){return o.slerp(t,r,s,h),o.slerp(e,n,a,h),o.slerp(i,t,e,2*h*(1-h)),i}}(),o.invert=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],s=i*i+r*r+n*n+a*a,o=s?1/s:0;return t[0]=-i*o,t[1]=-r*o,t[2]=-n*o,t[3]=a*o,t},o.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},o.length=s.length,o.len=o.length,o.squaredLength=s.squaredLength,o.sqrLen=o.squaredLength,o.normalize=s.normalize,o.fromMat3=function(t,e){var i,r=e[0]+e[4]+e[8];if(r>0)i=Math.sqrt(r+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{var n=0;e[4]>e[0]&&(n=1),e[8]>e[3*n+n]&&(n=2);var a=(n+1)%3,s=(n+2)%3;i=Math.sqrt(e[3*n+n]-e[3*a+a]-e[3*s+s]+1),t[n]=.5*i,i=.5/i,t[3]=(e[3*a+s]-e[3*s+a])*i,t[a]=(e[3*a+n]+e[3*n+a])*i,t[s]=(e[3*s+n]+e[3*n+s])*i}return t},o.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},o.exactEquals=s.exactEquals,o.equals=s.equals,t.exports=o},function(t,e,i){var r=i(18),n={};n.create=function(){var t=new r.ARRAY_TYPE(3);return t[0]=0,t[1]=0,t[2]=0,t},n.clone=function(t){var e=new r.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},n.fromValues=function(t,e,i){var n=new r.ARRAY_TYPE(3);return n[0]=t,n[1]=e,n[2]=i,n},n.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},n.set=function(t,e,i,r){return t[0]=e,t[1]=i,t[2]=r,t},n.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t},n.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t},n.sub=n.subtract,n.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t},n.mul=n.multiply,n.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t},n.div=n.divide,n.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},n.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},n.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t},n.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t},n.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},n.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t},n.scaleAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t},n.distance=function(t,e){var i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(i*i+r*r+n*n)},n.dist=n.distance,n.squaredDistance=function(t,e){var i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return i*i+r*r+n*n},n.sqrDist=n.squaredDistance,n.length=function(t){var e=t[0],i=t[1],r=t[2];return Math.sqrt(e*e+i*i+r*r)},n.len=n.length,n.squaredLength=function(t){var e=t[0],i=t[1],r=t[2];return e*e+i*i+r*r},n.sqrLen=n.squaredLength,n.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},n.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},n.normalize=function(t,e){var i=e[0],r=e[1],n=e[2],a=i*i+r*r+n*n;return a>0&&(a=1/Math.sqrt(a),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a),t},n.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},n.cross=function(t,e,i){var r=e[0],n=e[1],a=e[2],s=i[0],o=i[1],h=i[2];return t[0]=n*h-a*o,t[1]=a*s-r*h,t[2]=r*o-n*s,t},n.lerp=function(t,e,i,r){var n=e[0],a=e[1],s=e[2];return t[0]=n+r*(i[0]-n),t[1]=a+r*(i[1]-a),t[2]=s+r*(i[2]-s),t},n.hermite=function(t,e,i,r,n,a){var s=a*a,o=s*(2*a-3)+1,h=s*(a-2)+a,u=s*(a-1),c=s*(3-2*a);return t[0]=e[0]*o+i[0]*h+r[0]*u+n[0]*c,t[1]=e[1]*o+i[1]*h+r[1]*u+n[1]*c,t[2]=e[2]*o+i[2]*h+r[2]*u+n[2]*c,t},n.bezier=function(t,e,i,r,n,a){var s=1-a,o=s*s,h=a*a,u=o*s,c=3*a*o,l=3*h*s,d=h*a;return t[0]=e[0]*u+i[0]*c+r[0]*l+n[0]*d,t[1]=e[1]*u+i[1]*c+r[1]*l+n[1]*d,t[2]=e[2]*u+i[2]*c+r[2]*l+n[2]*d,t},n.random=function(t,e){e=e||1;var i=2*r.RANDOM()*Math.PI,n=2*r.RANDOM()-1,a=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(i)*a,t[1]=Math.sin(i)*a,t[2]=n*e,t},n.transformMat4=function(t,e,i){var r=e[0],n=e[1],a=e[2],s=i[3]*r+i[7]*n+i[11]*a+i[15];return s=s||1,t[0]=(i[0]*r+i[4]*n+i[8]*a+i[12])/s,t[1]=(i[1]*r+i[5]*n+i[9]*a+i[13])/s,t[2]=(i[2]*r+i[6]*n+i[10]*a+i[14])/s,t},n.transformMat3=function(t,e,i){var r=e[0],n=e[1],a=e[2];return t[0]=r*i[0]+n*i[3]+a*i[6],t[1]=r*i[1]+n*i[4]+a*i[7],t[2]=r*i[2]+n*i[5]+a*i[8],t},n.transformQuat=function(t,e,i){var r=e[0],n=e[1],a=e[2],s=i[0],o=i[1],h=i[2],u=i[3],c=u*r+o*a-h*n,l=u*n+h*r-s*a,d=u*a+s*n-o*r,f=-s*r-o*n-h*a;return t[0]=c*u+f*-s+l*-h-d*-o,t[1]=l*u+f*-o+d*-s-c*-h,t[2]=d*u+f*-h+c*-o-l*-s,t},n.rotateX=function(t,e,i,r){var n=[],a=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],a[0]=n[0],a[1]=n[1]*Math.cos(r)-n[2]*Math.sin(r),a[2]=n[1]*Math.sin(r)+n[2]*Math.cos(r),t[0]=a[0]+i[0],t[1]=a[1]+i[1],t[2]=a[2]+i[2],t},n.rotateY=function(t,e,i,r){var n=[],a=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],a[0]=n[2]*Math.sin(r)+n[0]*Math.cos(r),a[1]=n[1],a[2]=n[2]*Math.cos(r)-n[0]*Math.sin(r),t[0]=a[0]+i[0],t[1]=a[1]+i[1],t[2]=a[2]+i[2],t},n.rotateZ=function(t,e,i,r){var n=[],a=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],a[0]=n[0]*Math.cos(r)-n[1]*Math.sin(r),a[1]=n[0]*Math.sin(r)+n[1]*Math.cos(r),a[2]=n[2],t[0]=a[0]+i[0],t[1]=a[1]+i[1],t[2]=a[2]+i[2],t},n.forEach=function(){var t=n.create();return function(e,i,r,n,a,s){var o,h;for(i||(i=3),r||(r=0),h=n?Math.min(n*i+r,e.length):e.length,o=r;o<h;o+=i)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],a(t,t,s),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2];return e}}(),n.angle=function(t,e){var i=n.fromValues(t[0],t[1],t[2]),r=n.fromValues(e[0],e[1],e[2]);n.normalize(i,i),n.normalize(r,r);var a=n.dot(i,r);return a>1?0:Math.acos(a)},n.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},n.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},n.equals=function(t,e){var i=t[0],n=t[1],a=t[2],s=e[0],o=e[1],h=e[2];return Math.abs(i-s)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(n-o)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(a-h)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(h))},t.exports=n},function(t,e,i){var r=i(18),n={};n.create=function(){var t=new r.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},n.clone=function(t){var e=new r.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},n.fromValues=function(t,e,i,n){var a=new r.ARRAY_TYPE(4);return a[0]=t,a[1]=e,a[2]=i,a[3]=n,a},n.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},n.set=function(t,e,i,r,n){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t},n.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},n.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t},n.sub=n.subtract,n.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t},n.mul=n.multiply,n.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t},n.div=n.divide,n.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},n.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},n.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t},n.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t},n.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},n.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},n.scaleAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t},n.distance=function(t,e){var i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2],a=e[3]-t[3];return Math.sqrt(i*i+r*r+n*n+a*a)},n.dist=n.distance,n.squaredDistance=function(t,e){var i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2],a=e[3]-t[3];return i*i+r*r+n*n+a*a},n.sqrDist=n.squaredDistance,n.length=function(t){var e=t[0],i=t[1],r=t[2],n=t[3];return Math.sqrt(e*e+i*i+r*r+n*n)},n.len=n.length,n.squaredLength=function(t){var e=t[0],i=t[1],r=t[2],n=t[3];return e*e+i*i+r*r+n*n},n.sqrLen=n.squaredLength,n.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},n.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},n.normalize=function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],s=i*i+r*r+n*n+a*a;return s>0&&(s=1/Math.sqrt(s),t[0]=i*s,t[1]=r*s,t[2]=n*s,t[3]=a*s),t},n.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},n.lerp=function(t,e,i,r){var n=e[0],a=e[1],s=e[2],o=e[3];return t[0]=n+r*(i[0]-n),t[1]=a+r*(i[1]-a),t[2]=s+r*(i[2]-s),t[3]=o+r*(i[3]-o),t},n.random=function(t,e){return e=e||1,t[0]=r.RANDOM(),t[1]=r.RANDOM(),t[2]=r.RANDOM(),t[3]=r.RANDOM(),n.normalize(t,t),n.scale(t,t,e),t},n.transformMat4=function(t,e,i){var r=e[0],n=e[1],a=e[2],s=e[3];return t[0]=i[0]*r+i[4]*n+i[8]*a+i[12]*s,t[1]=i[1]*r+i[5]*n+i[9]*a+i[13]*s,t[2]=i[2]*r+i[6]*n+i[10]*a+i[14]*s,t[3]=i[3]*r+i[7]*n+i[11]*a+i[15]*s,t},n.transformQuat=function(t,e,i){var r=e[0],n=e[1],a=e[2],s=i[0],o=i[1],h=i[2],u=i[3],c=u*r+o*a-h*n,l=u*n+h*r-s*a,d=u*a+s*n-o*r,f=-s*r-o*n-h*a;return t[0]=c*u+f*-s+l*-h-d*-o,t[1]=l*u+f*-o+d*-s-c*-h,t[2]=d*u+f*-h+c*-o-l*-s,t[3]=e[3],t},n.forEach=function(){var t=n.create();return function(e,i,r,n,a,s){var o,h;for(i||(i=4),r||(r=0),h=n?Math.min(n*i+r,e.length):e.length,o=r;o<h;o+=i)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],t[3]=e[o+3],a(t,t,s),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2],e[o+3]=t[3];return e}}(),n.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},n.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},n.equals=function(t,e){var i=t[0],n=t[1],a=t[2],s=t[3],o=e[0],h=e[1],u=e[2],c=e[3];return Math.abs(i-o)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-h)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(a-u)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(u))&&Math.abs(s-c)<=r.EPSILON*Math.max(1,Math.abs(s),Math.abs(c))},t.exports=n},function(t,e,i){var r=i(18),n={};n.create=function(){var t=new r.ARRAY_TYPE(2);return t[0]=0,t[1]=0,t},n.clone=function(t){var e=new r.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},n.fromValues=function(t,e){var i=new r.ARRAY_TYPE(2);return i[0]=t,i[1]=e,i},n.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},n.set=function(t,e,i){return t[0]=e,t[1]=i,t},n.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},n.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t},n.sub=n.subtract,n.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t},n.mul=n.multiply,n.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t},n.div=n.divide,n.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},n.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},n.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t},n.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t},n.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},n.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},n.scaleAndAdd=function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t},n.distance=function(t,e){var i=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(i*i+r*r)},n.dist=n.distance,n.squaredDistance=function(t,e){var i=e[0]-t[0],r=e[1]-t[1];return i*i+r*r},n.sqrDist=n.squaredDistance,n.length=function(t){var e=t[0],i=t[1];return Math.sqrt(e*e+i*i)},n.len=n.length,n.squaredLength=function(t){var e=t[0],i=t[1];return e*e+i*i},n.sqrLen=n.squaredLength,n.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},n.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},n.normalize=function(t,e){var i=e[0],r=e[1],n=i*i+r*r;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n),t},n.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},n.cross=function(t,e,i){var r=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=r,t},n.lerp=function(t,e,i,r){var n=e[0],a=e[1];return t[0]=n+r*(i[0]-n),t[1]=a+r*(i[1]-a),t},n.random=function(t,e){e=e||1;var i=2*r.RANDOM()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t},n.transformMat2=function(t,e,i){var r=e[0],n=e[1];return t[0]=i[0]*r+i[2]*n,t[1]=i[1]*r+i[3]*n,t},n.transformMat2d=function(t,e,i){var r=e[0],n=e[1];return t[0]=i[0]*r+i[2]*n+i[4],t[1]=i[1]*r+i[3]*n+i[5],t},n.transformMat3=function(t,e,i){var r=e[0],n=e[1];return t[0]=i[0]*r+i[3]*n+i[6],t[1]=i[1]*r+i[4]*n+i[7],t},n.transformMat4=function(t,e,i){var r=e[0],n=e[1];return t[0]=i[0]*r+i[4]*n+i[12],t[1]=i[1]*r+i[5]*n+i[13],t},n.forEach=function(){var t=n.create();return function(e,i,r,n,a,s){var o,h;for(i||(i=2),r||(r=0),h=n?Math.min(n*i+r,e.length):e.length,o=r;o<h;o+=i)t[0]=e[o],t[1]=e[o+1],a(t,t,s),e[o]=t[0],e[o+1]=t[1];return e}}(),n.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},n.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},n.equals=function(t,e){var i=t[0],n=t[1],a=e[0],s=e[1];return Math.abs(i-a)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-s)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))},t.exports=n},function(t,e){"use strict";t.exports={ArrayType:Float64Array}},function(t,e,i){"use strict";var r=i(14),n=i(15).vec3,a=i(15).mat4,s=function(){this._center=n.create(),this._radius=-1};s.prototype={init:function(){n.init(this._center),this._radius=-1},valid:function(){return this._radius>=0},set:function(t,e){this._center=t,this._radius=e},center:function(){return this._center},radius:function(){return this._radius},radius2:function(){return this._radius*this._radius},expandByBoundingBox:function(){var t=n.create(),e=new r;return function(i){if(i.valid())if(this.valid()){n.copy(e._min,i._min),n.copy(e._max,i._max);for(var r=0;r<8;r++)n.sub(t,i.corner(r,t),this._center),n.normalize(t,t),n.scaleAndAdd(t,this._center,t,-this._radius),e.expandByvec3(t);e.center(this._center),this._radius=e.radius()}else i.center(this._center),this._radius=i.radius()}}(),expandByvec3:function(){var t=n.create();return function(e){if(this.valid()){n.sub(t,e,this.center(t));var i=n.length(t);if(i>this.radius()){var r=.5*(i-this.radius());this._center[0]+=t[0]*(r/i),this._center[1]+=t[1]*(r/i),this._center[2]+=t[2]*(r/i),this._radius+=r}}else this._center[0]=e[0],this._center[1]=e[1],this._center[2]=e[2],this._radius=0}}(),expandRadiusBySphere:function(t){if(t.valid())if(this.valid()){var e=n.distance(this._center,t._center)+t._radius;e>this._radius&&(this._radius=e)}else n.copy(this._center,t._center),this._radius=t._radius},expandByBoundingSphere:function(t){if(t.valid()){if(!this.valid())return this._center[0]=t._center[0],this._center[1]=t._center[1],this._center[2]=t._center[2],void(this._radius=t.radius());var e=n.distance(t.center(),this.center());if(!(e+t.radius()<=this.radius())){if(e+this.radius()<=t.radius())return this._center[0]=t._center[0],this._center[1]=t._center[1],this._center[2]=t._center[2],void(this._radius=t._radius);var i=.5*(this.radius()+e+t.radius()),r=(i-this.radius())/e;this._center[0]+=(t._center[0]-this._center[0])*r,this._center[1]+=(t._center[1]-this._center[1])*r,this._center[2]+=(t._center[2]-this._center[2])*r,this._radius=i}}},contains:function(t){return!!this.valid()&&n.sqrDist(this.center(),t)<=this.radius2()},intersects:function(t){if(!this.valid()||!t.valid())return!1;var e=this.radius()+t.radius();return n.sqrDist(t.center(),this.center())<=e*e},transformMat4:function(){var t=n.create();return function(e,i){if(!this.valid())return e;e._center!==this._center&&(n.copy(e._center,this._center),e._radius=this._radius);var r=e._center,s=e._radius;a.getSqrScale(t,i);var o=Math.sqrt(Math.max(Math.max(t[0],t[1]),t[2]));return s*=o,e._radius=s,n.transformMat4(r,r,i),e}}()},t.exports=s},function(t,e,i){"use strict";var r=i(30),n=i(13),a=i(31),s=i(6),o=function(){n.call(this),this._parents=[],this.attributeMap=new r,this.textureAttributeMapList=[],this._binName=void 0,this._binNumber=0,this._shaderGeneratorPair=null,this._updateCallbackList=[],this.uniforms=new r,this._drawID=-1};o.AttributePair=function(t,e){this._object=t,this._value=e},o.AttributePair.prototype={getShaderGeneratorName:function(){return this._object},getAttribute:function(){return this._object},getUniform:function(){return this._object},getValue:function(){return this._value}},o.prototype=s.objectLibraryClass(s.objectInherit(n.prototype,{setDrawID:function(t){this._drawID=t},getDrawID:function(){return this._drawID},getAttributePair:function(t,e){return new o.AttributePair(t,e)},addUniform:function(t,e){var i=void 0!==e?e:a.ON,r=t.getName();this.uniforms[r]=this.getAttributePair(t,i),this.uniforms.dirty()},addParent:function(t){this._parents.push(t)},removeParent:function(t){var e=this._parents.indexOf(t);e!==-1&&this._parents.splice(e,1)},removeUniform:function(t){this.uniforms.remove(t.getName())},removeUniformByName:function(t){this.uniforms.remove(t)},getUniform:function(t){var e=this.uniforms;if(e[t])return e[t].getAttribute()},getUniformList:function(){return this.uniforms},setTextureAttributeAndModes:function(t,e,i){var r=void 0!==i?i:a.ON;this._setTextureAttribute(t,this.getAttributePair(e,r))},getNumTextureAttributeLists:function(){return this.textureAttributeMapList.length},getTextureAttribute:function(t,e){if(void 0!==this.textureAttributeMapList[t]){var i=this.textureAttributeMapList[t];if(void 0!==i[e])return i[e].getAttribute()}},removeTextureAttribute:function(t,e){if(void 0!==this.textureAttributeMapList[t]){var i=this.textureAttributeMapList[t];void 0!==i[e]&&(i.remove(e),this.textureAttributeMapList[t].dirty())}},getAttribute:function(t){if(void 0!==this.attributeMap[t])return this.attributeMap[t].getAttribute()},setAttributeAndModes:function(t,e){var i=void 0!==e?e:a.ON;this._setAttribute(this.getAttributePair(t,i))},setAttribute:function(t,e){var i=void 0!==e?e:a.ON;this._setAttribute(this.getAttributePair(t,i))},removeAttribute:function(t){void 0!==this.attributeMap[t]&&(delete this.attributeMap[t],this.attributeMap.dirty())},setRenderingHint:function(t){"OPAQUE_BIN"===t?this.setRenderBinDetails(0,"RenderBin"):"TRANSPARENT_BIN"===t?this.setRenderBinDetails(10,"DepthSortedBin"):this.setRenderBinDetails(0,"")},getUpdateCallbackList:function(){return this._updateCallbackList},removeUpdateCallback:function(t){var e=this._updateCallbackList.indexOf(t);if(e!==-1&&(this._updateCallbackList.splice(e,1),0===this._updateCallbackList.length))for(var i=this._parents,r=0,n=i.length;r<n;r++){var a=i[r];a.setNumChildrenRequiringUpdateTraversal(a.getNumChildrenRequiringUpdateTraversal()-1)}},requiresUpdateTraversal:function(){return!!this._updateCallbackList.length},addUpdateCallback:function(t){var e=Boolean(this._updateCallbackList.length);if(this._updateCallbackList.push(t),!e)for(var i=this._parents,r=0,n=i.length;r<n;r++){var a=i[r];a.setNumChildrenRequiringUpdateTraversal(a.getNumChildrenRequiringUpdateTraversal()+1)}},hasUpdateCallback:function(t){return this._updateCallbackList.indexOf(t)!==-1},setRenderBinDetails:function(t,e){this._binNumber=t,this._binName=e},getAttributeMap:function(){return this.attributeMap},getBinNumber:function(){return this._binNumber},getBinName:function(){return this._binName},setBinNumber:function(t){this._binNumber=t},setBinName:function(t){this._binName=t},getAttributeList:function(){for(var t=this.attributeMap,e=t.getKeys(),i=e.length,r=[],n=0;n<i;n++)r.push(t[e[n]]);return r},setShaderGeneratorName:function(t,e){this._shaderGeneratorPair=this.getAttributePair(t,e)},getShaderGeneratorPair:function(){return this._shaderGeneratorPair},getShaderGeneratorName:function(){return this._shaderGeneratorPair?this._shaderGeneratorPair.getShaderGeneratorName():void 0},releaseGLObjects:function(){for(var t=0,e=this.textureAttributeMapList.length;t<e;t++)this.getTextureAttribute(t,"Texture").releaseGLObjects();var i=this.getAttributeList();for(t=0,e=i.length;t<e;t++)i[t]._object.releaseGLObjects&&i[t]._object.releaseGLObjects()},_getUniformMap:function(){return this.uniforms},_setTextureAttribute:function(t,e){void 0===this.textureAttributeMapList[t]&&(this.textureAttributeMapList[t]=new r);var i=e.getAttribute().getTypeMember(),n=this.textureAttributeMapList[t];n[i]=e,n.dirty()},_setAttribute:function(t){var e=t.getAttribute().getTypeMember();this.attributeMap[e]=t,this.attributeMap.dirty()}}),"osg","StateSet"),t.exports=o},function(t,e){"use strict";var i=function(t){window.Object.defineProperty(this,"_dirty",{configurable:!0,enumerable:!1,writable:!0,value:!0}),window.Object.defineProperty(this,"_keys",{configurable:!0,enumerable:!1,writable:!0,value:void 0}),t&&this.setMap(t)};i.prototype={getKeys:function(){return this._dirty&&(this._keys=window.Object.keys(this),this._dirty=!1),this._keys},dirty:function(){this._dirty=!0},remove:function(t){delete this[t],this.dirty(),this.getKeys()},setMap:function(t){var e,i,r=window.Object.keys(this);if(r.length>0)for(e=0,i=r.length;e<i;e++)delete this[r[e]];if(r=window.Object.keys(t),r.length>0)for(e=0,i=r.length;e<i;e++){var n=r[e];this[n]=t[n]}this.dirty()}},t.exports=i},function(t,e,i){"use strict";var r=i(6),n=i(13),a=function(){n.call(this)};a.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},apply:function(){},getHash:function(){return this.getTypeMember()}}),"osg","StateAttribute"),a.OFF=0,a.ON=1,a.OVERRIDE=2,a.PROTECTED=4,a.INHERIT=8,t.exports=a},function(t,e){"use strict";var i=function(t){this.traversalMask=-1,this.nodeMaskOverride=0,this.traversalMode=t,void 0===t&&(this.traversalMode=i.TRAVERSE_ALL_CHILDREN),this.nodePath=[],this.visitorType=i.NODE_VISITOR,this._databaseRequestHandler=void 0,this._frameStamp=void 0,this.traverse=i._traversalFunctions[this.traversalMode],this.pushOntoNodePath=i._pushOntoNodePath[this.traversalMode],this.popFromNodePath=i._popFromNodePath[this.traversalMode]};i.TRAVERSE_PARENTS=1,i.TRAVERSE_ALL_CHILDREN=2,i.TRAVERSE_ACTIVE_CHILDREN=3,i.NODE_VISITOR=0,i.UPDATE_VISITOR=1,i.CULL_VISITOR=2;
var r=function(t){t.ascend(this)},n=function(t){t.traverse(this)};i._traversalFunctions=[void 0,r,n,n];var a=function(t){this.nodePath.unshift(t)},s=function(t){this.nodePath.push(t)};i._pushOntoNodePath=[void 0,a,s,s];var o=function(){return this.nodePath.shift()},h=function(){this.nodePath.pop()};i._popFromNodePath=[void 0,o,h,h],i.prototype={reset:function(){this.nodePath.length=0},setFrameStamp:function(t){this._frameStamp=t},getFrameStamp:function(){return this._frameStamp},setNodeMaskOverride:function(t){this.nodeMaskOverride=t},getNodeMaskOverride:function(){return this.nodeMaskOverride},setTraversalMask:function(t){this.traversalMask=t},getTraversalMask:function(){return this.traversalMask},getNodePath:function(){return this.nodePath},pushOntoNodePath:function(t){i._pushOntoNodePath[this.traversalMode].call(this,t)},popFromNodePath:function(){i._popFromNodePath[this.traversalMode].call(this)},validNodeMask:function(t){var e=t.getNodeMask();return 0!==(this.traversalMask&(this.nodeMaskOverride|e))},apply:function(t){this.traverse(t)},traverse:function(t){i._traversalFunctions[this.traversalMode].call(this,t)},getVisitorType:function(){return this.visitorType},setDatabaseRequestHandler:function(t){this._databaseRequestHandler=t},getDatabaseRequestHandler:function(){return this._databaseRequestHandler}},t.exports=i},function(t,e,i){"use strict";var r=i(15).mat4,n=function(){this._stack=[r.create()],this._current=0};n.prototype={reset:function(){this._current=0},get:function(){var t=this._stack[this._current++];return this._current===this._stack.length&&this._stack.push(r.create()),t}},t.exports=n},function(t,e,i){"use strict";var r=i(15).mat4,n=i(35),a=function(t,e,i){var a=e;void 0===a&&(a=!0);var s=i||r.create(),o=0;if(a){for(o=t.length-1;o>=0;o--){var h=t[o];if("Camera"===h.className()&&(h.getReferenceFrame()!==n.RELATIVE_RF||0===h.getParents().length))break}o+=1}for(var u=o,c=t.length;u<c;u++){var l=t[u];l.computeLocalToWorldMatrix&&l.computeLocalToWorldMatrix(s)}return s};t.exports={computeLocalToWorld:a}},function(t,e){"use strict";t.exports={RELATIVE_RF:0,ABSOLUTE_RF:1}},function(t,e,i){"use strict";var r=i(14),n=i(37),a=i(15).mat4,s=i(33),o=i(11),h=i(32),u=i(6),c=function(t){h.call(this,t),this._reservedMatrixStack=new s,this._matrixStack=[],this._bb=new r};c.prototype=u.objectLibraryClass(u.objectInherit(h.prototype,{reset:function(){this._reservedMatrixStack.reset(),this._matrixStack.length=0,this._bb.init()},getBoundingBox:function(){return this._bb},applyTransform:function(t){var e=this._reservedMatrixStack.get(),i=this._matrixStack.length;i?a.copy(e,this._matrixStack[i-1]):a.identity(e),t.computeLocalToWorldMatrix(e,this),this.pushMatrix(e),this.traverse(t),this.popMatrix()},apply:function(t){return t instanceof o?void this.applyTransform(t):t instanceof n?void this.applyBoundingBox(t.getBoundingBox()):void this.traverse(t)},pushMatrix:function(t){this._matrixStack.push(t)},popMatrix:function(){this._matrixStack.pop()},applyBoundingBox:function(){var t=new r;return function(e){var i=this._matrixStack.length;if(i){if(e.valid()){var r=this._matrixStack[i-1];e.transformMat4(t,r),this._bb.expandByBoundingBox(t)}}else this._bb.expandByBoundingBox(e)}}(),getMatrixStack:function(){return this._matrixStack}}),"osg","ComputeBoundsVisitor"),t.exports=c},function(t,e,i){"use strict";var r=i(6),n=i(12),a=i(10),s=i(38),o=i(45),h=i(47),u=function(){if(n.call(this),window.Proxy){var t=this;this._attributes={},this._primitives=[],this.attributes=new Proxy(this._attributes,{set:function(e,i,r){var n=e[i];return n!==r&&(e[i]=r,t.dirty()),!0}});var e=function(){this.push.apply(this,arguments),t.dirty()}.bind(this._primitives),i=function(){this.pop(),t.dirty()}.bind(this._primitives);this.primitives=new Proxy(this._primitives,{get:function(t,r){return"push"===r?e:"pop"===r?i:t[r]}})}else this.attributes={},this.primitives=[],this._primitives=this.primitives,this._attributes=this.attributes;this._cacheDrawCall={},this._extVAO=void 0,this._vao={},this._cacheVertexAttributeBufferList={},this._shape=void 0};u.enableVAO=Boolean(window.Proxy),u.enableVAO&&a.info("enable VAO"),u.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{releaseGLObjects:function(){void 0!==this.stateset&&this.stateset.releaseGLObjects();var t,e,i,r=window.Object.keys(this._attributes);for(e=0,i=r.length;e<i;e++)t=this._attributes[r[e]],t.releaseGLObjects();for(var n=0,a=this._primitives.length;n<a;n++){var s=this._primitives[n];void 0!==s.getIndices&&void 0!==s.getIndices()&&null!==s.getIndices()&&s.indices.releaseGLObjects()}this.releaseVAO()},releaseVAO:function(){if(this._extVAO)for(var t=window.Object.keys(this._vao),e=0,i=t.length;e<i;e++){var r=t[e];if(this._vao[r]){var n=this._vao[r];this._extVAO.deleteVertexArrayOES(n),this._vao[r]=void 0}}},dirty:function(){this._cacheDrawCall={},this.releaseVAO()},getPrimitives:function(){return this.getPrimitiveSetList()},getAttributes:function(){return this.getVertexAttributeList()},getShape:function(){return this._shape},setShape:function(t){this._shape=t},getVertexAttributeList:function(){return this.attributes},getPrimitiveSetList:function(){return this.primitives},setVertexAttribArray:function(t,e){this._attributes[t]!==e&&(this._attributes[t]=e,this.dirty())},_generateVertexSetup:function(t,e,i){for(var r=["//generated by Geometry::implementation","state.lazyDisablingOfVertexAttributes();","var attr;"],n=0,a=t.length;n<a;n++)r.push("attr = this._attributes['"+t[n]+"'];"),r.push("if ( attr.BufferArrayProxy ) attr = attr.getBufferArray();"),r.push("if ( !attr.isValid() ) return;"),r.push("state.setVertexAttribArray("+e[n]+", attr, attr.getNormalize() );");return r.push("state.applyDisablingOfVertexAttributes();"),i&&r.push("state.setIndexArray( this._primitives[ 0 ].getIndices() );"),r},_generatePrimitive:function(t,e,i){var r=[e?"state.enableVertexColor();":"state.disableVertexColor();"];if(i)return r.concat(["var primitive = this._primitives[ 0 ];","var indexes = primitive.getIndices();","if ( indexes.isDirty() ) {;","  indexes.bind( gl );","  indexes.compile( gl );","};","primitive.drawElements( state );"]);r.push("var primitives = this._primitives;");for(var n=0,a=t.length;n<a;n++)r.push("primitives["+n+"].draw(state);");return r},generateDrawCommand:function(){var t=[],e=[];return function(i,r,n){var a=r._attributesCache.getKeys(),s=r._attributesCache,u=this.getVertexAttributeList();e.length=0,t.length=0;var c,l,d,f,p,_,g,m=this._extVAO,v=m?[]:void 0,S=!1;for(l=0,d=a.length;l<d;l++)if(_=a[l],c=s[_],g=u[_],void 0!==g){var x=this._attributes[_];if(x instanceof h&&(x=x.getBufferArray(),m=!1),!x.isValid())return;m&&v.push(x),S||"Color"!==_||(S=!0),e.push(_),t.push(c)}var b,M;if(m){this._cacheVertexAttributeBufferList[n]=v;var y=1===this._primitives.length&&this._primitives[0]instanceof o,T=this._generateVertexSetup(e,t,y);i.clearVertexAttribCache();var w=this._extVAO.createVertexArrayOES();i.setVertexArrayObject(w),this._vao[n]=w;var C=new Function("state",T.join("\n"));C.call(this,i);var A=["var gl = state.getGraphicContext();","var vao = this._vao[ "+n+" ] ","var hasChanged = state.setVertexArrayObject( vao );","if ( hasChanged ) {","  var vaList = this._cacheVertexAttributeBufferList[ "+n+" ];","  var va;"];for(f=0,p=v.length;f<p;f++)A.push("  va = vaList[ "+f+"];"),A.push("  if ( va.isDirty() ) {;"),A.push("    va.bind( gl );"),A.push("    va.compile( gl );"),A.push("  };");A.push("}"),b=A.concat(this._generatePrimitive(this._primitives,S,y)).join("\n"),M="GeometryDrawImplementationCacheVAO"}else b=this._generateVertexSetup(e,t,!1).concat(this._generatePrimitive(this._primitives,S,!1)).join("\n"),M="GeometryDrawImplementationCache";var E=new Function("state","return function "+M+"( state ) { "+b+"}")();return this._cacheDrawCall[n]=E,E}}(),drawImplementation:function(t){var e=t.getLastProgramApplied(),i=e.getInstanceID(),r=this._cacheDrawCall[i];if(this._extVAO&&!this._vao[i]&&t.setVertexArrayObject(null),void 0===r){if(!this._primitives.length)return;if(void 0===this._extVAO&&u.enableVAO){var n=s.instance(t.getGraphicContext()).getWebGLExtension("OES_vertex_array_object");this._extVAO=n}r=this.generateDrawCommand(t,e,i)}r.call(this,t)},setBound:function(t){this._boundingBox=t,this._boundingBoxComputed=!0},computeBoundingBox:function(t){t.init();var e=this.getVertexAttributeList().Vertex;if(e&&e.getElements()&&e.getItemSize()>2){for(var i=e.getElements(),r=e.getItemSize(),n=t.getMin(),a=t.getMax(),s=n[0],o=n[1],h=n[2],u=a[0],c=a[1],l=a[2],d=0,f=i.length;d<f;d+=r){var p=i[d],_=i[d+1],g=i[d+2];p<s&&(s=p),p>u&&(u=p),_<o&&(o=_),_>c&&(c=_),g<h&&(h=g),g>l&&(l=g)}n[0]=s,n[1]=o,n[2]=h,a[0]=u,a[1]=c,a[2]=l}return t},computeBoundingSphere:function(t){t.init();var e=this.getBoundingBox();return t.expandByBoundingBox(e),t}}),"osg","Geometry"),u.appendVertexAttributeToList=function(t,e,i){for(var r,n,a=window.Object.keys(t),s=0,o=a.length;s<o;s++)r=a[s],n=r,void 0!==i&&(n+="_"+i),e[n]=t[r]},r.setTypeID(u),t.exports=u},function(t,e,i){"use strict";var r,n=i(10),a=i(39),s=function(){r||(r=i(40)),this._checkRTT={},this._webGLExtensions={},this._webGLParameters={},this._webGLShaderMaxInt="NONE",this._webGLShaderMaxFloat="NONE",this._bugsDB={},this._webGLPlatforms={},this._webGLParameters.MAX_COMBINED_TEXTURE_IMAGE_UNITS=8,this._webGLParameters.MAX_CUBE_MAP_TEXTURE_SIZE=16,this._webGLParameters.MAX_FRAGMENT_UNIFORM_VECTORS=16,this._webGLParameters.MAX_RENDERBUFFER_SIZE=1,this._webGLParameters.MAX_TEXTURE_IMAGE_UNITS=8,this._webGLParameters.MAX_TEXTURE_SIZE=64,this._webGLParameters.MAX_VARYING_VECTORS=8,this._webGLParameters.MAX_VERTEX_ATTRIBS=8,this._webGLParameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS=0,this._webGLParameters.MAX_VERTEX_UNIFORM_VECTORS=128,this._webGLParameters.MAX_VIEWPORT_DIMS=[1,1],this._webGLParameters.NUM_COMPRESSED_TEXTURE_FORMATS=0,this._webGLParameters.MAX_SHADER_PRECISION_FLOAT="none",this._webGLParameters.MAX_SHADER_PRECISION_INT="none",this._gl=void 0};s.instance=function(t){if(!s._instance){var e,i=t;if(!i){var r="undefined"!=typeof window&&window.gli;r&&(e=window.gli.host.inspectContext,window.gli.host.inspectContext=!1);var o=document.createElement("canvas");o.width=32,o.height=32;var h={antialias:!1};i=a.setupWebGL(o,h,function(){})}s._instance=new s,i?s._instance.init(i):n.warn("no support for webgl context detected."),e&&(window.gli.host.inspectContext=e)}return t&&t!==s._instance.getContext()&&s._instance.initContextDependant(t),s._instance},s.prototype={getContext:function(){return this._gl},initContextDependant:function(t){this._gl=t,this.initWebGLExtensions(t),this.hasLinearHalfFloatRTT(t),this.hasLinearFloatRTT(t),this.hasHalfFloatRTT(t),this.hasFloatRTT(t)},init:function(t){if(this.initWebGLParameters(t),this.initPlatformSupport(),this.initBugDB(),this.initContextDependant(t),this._isGL2="undefined"!=typeof window.WebGL2RenderingContext&&t instanceof window.WebGL2RenderingContext,this._isGL2){this._checkRTT[r.FLOAT+","+r.NEAREST]=!0,this._checkRTT[r.HALF_FLOAT+","+r.NEAREST]=!0,this._checkRTT[r.FLOAT+","+r.LINEAR]=!0,this._checkRTT[r.HALF_FLOAT+","+r.LINEAR]=!0;for(var e=["OES_element_index_uint","EXT_sRGB","EXT_blend_minmax","EXT_frag_depth","WEBGL_depth_texture","EXT_shader_texture_lod","OES_standard_derivatives","OES_texture_float","OES_texture_half_float","OES_vertex_array_object","WEBGL_draw_buffers","OES_fbo_render_mipmap","ANGLE_instanced_arrays"],i=s._instance.getWebGLExtensions(),n=function(){},a=0,o=e.length;a<o;a++)i[e[a]]=n}},isWebGL2:function(){return this._isGL2},initBugDB:function(){},initPlatformSupport:function(){var t=this._webGLPlatforms;t.Apple=navigator.vendor.indexOf("Apple")!==-1||navigator.vendor.indexOf("OS X")!==-1,t.Mobile=/Mobi/.test(navigator.userAgent)||/ablet/.test(navigator.userAgent)},getWebGLPlatform:function(t){return this._webGLPlatforms[t]},getWebGLPlatforms:function(){return this._webGLPlatforms},getWebGLParameter:function(t){return this._webGLParameters[t]},getWebGLParameters:function(){return this._webGLParameters},getShaderMaxPrecisionFloat:function(){return this._webGLParameters.MAX_SHADER_PRECISION_FLOAT},getShaderMaxPrecisionInt:function(){return this._webGLParameters.MAX_SHADER_PRECISION_INT},checkSupportRTT:function(t,e,i){var r=e+","+i;if(void 0!==this._checkRTT[r])return this._checkRTT[r];if(!t)return!1;var n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,2,2,0,t.RGBA,e,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,i);var a=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,a),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);var s=this._checkRTT[r]=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.deleteTexture(n),t.deleteFramebuffer(a),t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),s},hasLinearHalfFloatRTT:function(t){return this._webGLExtensions.OES_texture_half_float_linear&&this.checkSupportRTT(t,r.HALF_FLOAT,r.LINEAR)},hasLinearFloatRTT:function(t){return this._webGLExtensions.OES_texture_float_linear&&this.checkSupportRTT(t,r.FLOAT,r.LINEAR)},hasHalfFloatRTT:function(t){return this._webGLExtensions.OES_texture_half_float&&this.checkSupportRTT(t,r.HALF_FLOAT,r.NEAREST)},hasFloatRTT:function(t){return this._webGLExtensions.OES_texture_float&&this.checkSupportRTT(t,r.FLOAT,r.NEAREST)},queryPrecision:function(t,e,i){var r=t.getShaderPrecisionFormat(e,i);return!!r&&0!==r.precision},initWebGLParameters:function(t){if(t){for(var e=["MAX_COMBINED_TEXTURE_IMAGE_UNITS","MAX_CUBE_MAP_TEXTURE_SIZE","MAX_FRAGMENT_UNIFORM_VECTORS","MAX_RENDERBUFFER_SIZE","MAX_TEXTURE_IMAGE_UNITS","MAX_TEXTURE_SIZE","MAX_VARYING_VECTORS","MAX_VERTEX_ATTRIBS","MAX_VERTEX_TEXTURE_IMAGE_UNITS","MAX_VERTEX_UNIFORM_VECTORS","MAX_VIEWPORT_DIMS","SHADING_LANGUAGE_VERSION","VERSION","VENDOR","RENDERER","ALIASED_LINE_WIDTH_RANGE","ALIASED_POINT_SIZE_RANGE","RED_BITS","GREEN_BITS","BLUE_BITS","ALPHA_BITS","DEPTH_BITS","STENCIL_BITS"],i=this._webGLParameters,r=0,n=e.length;r<n;++r){var a=e[r];i[a]=t.getParameter(t[a])}this.queryPrecision(t,t.FRAGMENT_SHADER,t.HIGH_FLOAT)?i.MAX_SHADER_PRECISION_FLOAT="high":this.queryPrecision(t,t.FRAGMENT_SHADER,t.MEDIUM_FLOAT)?i.MAX_SHADER_PRECISION_FLOAT="medium":this.queryPrecision(t,t.FRAGMENT_SHADER,t.LOW_FLOAT)&&(i.MAX_SHADER_PRECISION_FLOAT="low"),this.queryPrecision(t,t.FRAGMENT_SHADER,t.HIGH_INT)?i.MAX_SHADER_PRECISION_INT="high":this.queryPrecision(t,t.FRAGMENT_SHADER,t.MEDIUM_INT)?i.MAX_SHADER_PRECISION_INT="medium":this.queryPrecision(t,t.FRAGMENT_SHADER,t.LOW_INT)&&(i.MAX_SHADER_PRECISION_INT="low");var s=t.getExtension("WEBGL_debug_renderer_info");s&&(i.UNMASKED_RENDERER_WEBGL=t.getParameter(s.UNMASKED_VENDOR_WEBGL),i.UNMASKED_VENDOR_WEBGL=t.getParameter(s.UNMASKED_RENDERER_WEBGL))}},getWebGLExtension:function(t){return this._webGLExtensions[t]},getWebGLExtensions:function(){return this._webGLExtensions},initWebGLExtensions:function(t,e){if(t){var i=e;void 0===i&&(i=!0);for(var n=t.getSupportedExtensions(),a=this._webGLExtensions,s=0,o=n.length;s<o;++s){var h=n[s];i&&this._bugsDB[h]||(a[h]=t.getExtension(h))}var u=this.getWebGLExtension("EXT_texture_filter_anisotropic");u&&(r.ANISOTROPIC_SUPPORT_EXT=!0,r.ANISOTROPIC_SUPPORT_MAX=t.getParameter(u.MAX_TEXTURE_MAX_ANISOTROPY_EXT))}}},t.exports=s},function(t,e){"use strict";var i=function(){var t=function(t){return'<div style="margin: auto; width:500px;z-index:10000;margin-top:20em;text-align:center;">'+t+"</div>"},e='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>',i='It doesn\'t appear your computer can support WebGL.<br/><a href="http://get.webgl.org">Click here for more information.</a>',r=function(r,a,s){function o(r){if(r.indexOf("WebGL2")===-1){var n=document.getElementsByTagName("body")[0];if(n){var a=window.WebGLRenderingContext?i:e;r&&(a+="<br/><br/>Status: "+r),n.innerHTML=t(a)}}}s=s||o,r.addEventListener&&r.addEventListener("webglcontextcreationerror",function(t){s(t.statusMessage)},!1);var h=n(r,a);return h||s(""),h},n=function(t,e){var i=[];e&&e.webgl2&&(i=i.concat(["webgl2","experimental-webgl2"])),i=i.concat(["webgl","experimental-webgl","webkit-3d","moz-webgl"]);for(var r=null,n=0;n<i.length;++n){try{r=t.getContext(i[n],e)}catch(t){}if(r)break}return r};return{create3DContext:n,setupWebGL:r}}();window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,e){window.setTimeout(t,1e3/60)}}()),window.cancelRequestAnimFrame||(window.cancelRequestAnimFrame=function(){return window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout}()),Date.now||(Date.now=function(){return(new Date).getTime()}),t.exports=i},function(t,e,i){"use strict";var r=i(10),n=i(6),a=i(31),s=i(41),o=i(42),h=i(43),u=i(30),c=i(44),l=i(38),d=window.ImageBitmap||function(){},f=function(t){return 0!==t&&(t&~t+1)===t},p=function(){a.call(this),h.call(this),this.setDefaultParameters(),this._dirty=!0,this._dirtyMipmap=!0,this._applyTexImage2DCallbacks=[],this._textureObject=void 0,this._textureNull=!0},_=function(t,e){var i=p[t];return void 0===i?(r.warn("bad Texture enum argument "+t+"\nfallback to "+e),e):i};p.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,p.UNPACK_FLIP_Y_WEBGL=37440,p.BROWSER_DEFAULT_WEBGL=37444,p.NONE=0,p.DEPTH_COMPONENT=6402,p.ALPHA=6406,p.RGB=6407,p.RGBA=6408,p.LUMINANCE=6409,p.LUMINANCE_ALPHA=6410,p.COMPRESSED_RGB_S3TC_DXT1_EXT=33776,p.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777,p.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778,p.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779,p.COMPRESSED_RGB_ATC_WEBGL=35986,p.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35987,p.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798,p.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840,p.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841,p.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842,p.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843,p.COMPRESSED_RGB_ETC1_WEBGL=36196,p.LINEAR=9729,p.NEAREST=9728,p.NEAREST_MIPMAP_NEAREST=9984,p.LINEAR_MIPMAP_NEAREST=9985,p.NEAREST_MIPMAP_LINEAR=9986,p.LINEAR_MIPMAP_LINEAR=9987,p.TEXTURE_MAX_ANISOTROPY_EXT=34046,p.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047,p.CLAMP_TO_EDGE=33071,p.REPEAT=10497,p.MIRRORED_REPEAT=33648,p.TEXTURE_2D=3553,p.TEXTURE_CUBE_MAP=34067,p.TEXTURE_BINDING_CUBE_MAP=34068,p.TEXTURE_CUBE_MAP_POSITIVE_X=34069,p.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,p.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,p.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,p.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,p.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,p.MAX_CUBE_MAP_TEXTURE_SIZE=34076,p.UNSIGNED_BYTE=5121,p.UNSIGNED_SHORT=5123,p.UNSIGNED_SHORT_4_4_4_4=32819,p.UNSIGNED_SHORT_5_5_5_1=32820,p.UNSIGNED_SHORT_5_6_5=33635,p.FLOAT=5126,p.HALF_FLOAT_OES=p.HALF_FLOAT=36193,p._sTextureManager=new window.Map,p.getTextureManager=function(t){return p._sTextureManager.has(t)||p._sTextureManager.set(t,new c),p._sTextureManager.get(t)},p.getEnumFromString=function(t){var e=t;return"string"==typeof e&&(e=_(e,t)),e},p.prototype=n.objectLibraryClass(n.objectInherit(h.prototype,n.objectInherit(a.prototype,{attributeType:"Texture",cloneType:function(){return new p},dirty:function(){this._dirty=!0},isDirty:function(){return this._dirty},isTextureNull:function(){return this._textureNull},getOrCreateUniforms:function(t){if(void 0===p.uniforms&&(p.uniforms=[]),void 0===p.uniforms[t]){var e=this.getType()+t,i=new u,r=s.createInt1(t,e);i.setMap({texture:r}),p.uniforms[t]=i}return p.uniforms[t]},setDefaultParameters:function(){this._image=void 0,this._magFilter=p.LINEAR,this._minFilter=p.LINEAR,this._maxAnisotropy=1,this._wrapS=p.CLAMP_TO_EDGE,this._wrapT=p.CLAMP_TO_EDGE,this._textureWidth=0,this._textureHeight=0,this._unrefImageDataAfterApply=!1,this._internalFormat=void 0,this._dirtyMipmap=!0,this._textureTarget=p.TEXTURE_2D,this._type=p.UNSIGNED_BYTE,this._isCompressed=!1,this._flipY=!0,this._colorSpaceConversion=p.NONE},setColorSpaceConversion:function(t){this._colorSpaceConversion=t},setFlipY:function(t){this._flipY=t},getTextureTarget:function(){return this._textureTarget},getTextureObject:function(){return this._textureObject},setTextureSize:function(t,e){var i=l.instance().getWebGLParameter("MAX_TEXTURE_SIZE");t===this._textureWidth&&e===this._textureHeight||this.dirty(),void 0!==t&&(t>i?(r.error("width ("+t+') too big for GPU. Max Texture Size is "'+i+'"'),this._textureWidth=i):this._textureWidth=t),void 0!==e&&(e>i?(r.error("height ("+e+') too big for GPU. Max Texture Size is "'+i+'"'),this._textureHeight=i):this._textureHeight=e),this._textureNull=!1},init:function(t){this._gl||this.setGraphicContext(t.getGraphicContext()),this._textureObject||(this._textureObject=p.getTextureManager(this._gl).generateTextureObject(this._gl,this,this._textureTarget,this._internalFormat,this._textureWidth,this._textureHeight),this.dirty(),this._dirtyTextureObject=!1,this._textureNull=!1)},addApplyTexImage2DCallback:function(t){var e=this._applyTexImage2DCallbacks.indexOf(t);e<0&&this._applyTexImage2DCallbacks.push(t)},removeApplyTexImage2DCallback:function(t){var e=this._applyTexImage2DCallbacks.indexOf(t);e>=0&&this._applyTexImage2DCallbacks.splice(e,1)},getWidth:function(){return this._textureWidth},getHeight:function(){return this._textureHeight},releaseGLObjects:function(){void 0!==this._textureObject&&null!==this._textureObject&&void 0!==this._gl&&p.getTextureManager(this._gl).releaseTextureObject(this._textureObject),this._textureObject=void 0},getWrapT:function(){return this._wrapT},getWrapS:function(){return this._wrapS},setWrapS:function(t){"string"==typeof t?this._wrapS=_(t,p.CLAMP_TO_EDGE):this._wrapS=t,this.dirtyTextureParameters()},setWrapT:function(t){"string"==typeof t?this._wrapT=_(t,p.CLAMP_TO_EDGE):this._wrapT=t,this.dirtyTextureParameters()},dirtyTextureParameters:function(){this.dirty(),this.dirtyMipmap(),this.dirtyTextureObject()},dirtyTextureObject:function(){this._dirtyTextureObject=!0,this.dirtyMipmap(),this.dirty()},getMinFilter:function(){return this._minFilter},getMagFilter:function(){return this._magFilter},setMaxAnisotropy:function(t){this._maxAnisotropy=t,this.dirtyTextureParameters()},getMaxAnisotropy:function(){return this._maxAnisotropy},setMinFilter:function(t){"string"==typeof t?this._minFilter=_(t,p.LINEAR):this._minFilter=t,this.dirtyTextureParameters()},setMagFilter:function(t){"string"==typeof t?this._magFilter=_(t,p.LINEAR):this._magFilter=t,this.dirtyTextureParameters()},setImage:function(t,e){var i=t;(t instanceof window.Image||t instanceof HTMLCanvasElement||t instanceof d||t instanceof Uint8Array)&&(i=new o(t)),this._image=i,this.setImageFormat(e),i&&(i.getWidth&&i.getHeight?this.setTextureSize(i.getWidth(),i.getHeight()):i.width&&i.height&&this.setTextureSize(i.width,i.height)),this._textureNull=!1,this.dirty()},getImage:function(){return this._image},setImageFormat:function(t){var e=t;e?("string"==typeof e&&(e=p[e]),this._imageFormat=e):this._imageFormat=p.RGBA},setInternalFormatType:function(t){"string"==typeof t?this._type=p[t]:this._type=t},getInternalFormatType:function(){return this._type},setUnrefImageDataAfterApply:function(t){this._unrefImageDataAfterApply=t},checkIsCompressed:function(t){var e=t||this._internalFormat;switch(e){case p.COMPRESSED_RGB_S3TC_DXT1_EXT:case p.COMPRESSED_RGBA_S3TC_DXT1_EXT:case p.COMPRESSED_RGBA_S3TC_DXT3_EXT:case p.COMPRESSED_RGBA_S3TC_DXT5_EXT:case p.COMPRESSED_RGB_ATC_WEBGL:case p.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:case p.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:case p.COMPRESSED_RGB_PVRTC_4BPPV1_IMG:case p.COMPRESSED_RGB_PVRTC_2BPPV1_IMG:case p.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:case p.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:case p.COMPRESSED_RGB_ETC1_WEBGL:return!0;default:return!1}},setInternalFormat:function(t){var e=t;e?("string"==typeof e&&(e=p[e]),this._isCompressed=this.checkIsCompressed(e)):(this._isCompressed=!1,e=p.RGBA),this._internalFormat=e},getInternalFormat:function(){return this._internalFormat},isDirtyMipmap:function(){return this._dirtyMipmap},dirtyMipmap:function(){this._dirtyMipmap=!0},applyFilterParameter:function(t,e){var i=f(this._textureWidth)&&f(this._textureHeight);if(i||(this._wrapT=p.CLAMP_TO_EDGE,this._wrapS=p.CLAMP_TO_EDGE,this._minFilter!==p.LINEAR_MIPMAP_LINEAR&&this._minFilter!==p.LINEAR_MIPMAP_NEAREST||(this._minFilter=p.LINEAR)),t.texParameteri(e,t.TEXTURE_MAG_FILTER,this._magFilter),t.texParameteri(e,t.TEXTURE_MIN_FILTER,this._minFilter),this._maxAnisotropy>1&&p.ANISOTROPIC_SUPPORT_EXT){var r=this._maxAnisotropy<p.ANISOTROPIC_SUPPORT_MAX?this._maxAnisotropy:p.ANISOTROPIC_SUPPORT_MAX;t.texParameterf(e,p.TEXTURE_MAX_ANISOTROPY_EXT,r)}t.texParameteri(e,t.TEXTURE_WRAP_S,this._wrapS),t.texParameteri(e,t.TEXTURE_WRAP_T,this._wrapT)},generateMipmap:function(t,e){if(this._dirtyMipmap=!1,this.hasMipmapFilter()){var i=this._image;if(i&&i.hasMipmap())for(var r=this._internalFormat,n=i.getMipmap(),a=1,s=n.length;a<s;a++){var o=n[a];this._isCompressed?this.applyTexImage2D(t,this._textureTarget,a,this._internalFormat,o.getWidth(),o.getHeight(),0,o.getImage()):this.applyTexImage2D(t,this._textureTarget,a,r,o.getWidth(),o.getHeight(),0,r,this._type,o.getImage())}else t.generateMipmap(e)}},hasMipmapFilter:function(){return this._minFilter===p.NEAREST_MIPMAP_NEAREST||this._minFilter===p.LINEAR_MIPMAP_NEAREST||this._minFilter===p.NEAREST_MIPMAP_LINEAR||this._minFilter===p.LINEAR_MIPMAP_LINEAR},applyTexImage2D:function(t){var e=Array.prototype.slice.call(arguments,1);n.timeStamp("osgjs.metrics:Texture.texImage2d"),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,this._flipY),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._colorSpaceConversion),this._isCompressed?t.compressedTexImage2D.apply(t,e):t.texImage2D.apply(t,e);var i=this._applyTexImage2DCallbacks.length;if(i>0)for(var r=0,a=i;r<a;r++)this._applyTexImage2DCallbacks[r].call(this)},computeTextureFormat:function(){this._internalFormat?this._imageFormat=this._internalFormat:(this._internalFormat=this._imageFormat||p.RGBA,this._imageFormat=this._internalFormat)},applyImage:function(t,e){this._isCompressed?this.applyTexImage2D(t,this._textureTarget,0,this._internalFormat,this._textureWidth,this._textureHeight,0,e.getImage()):e.isTypedArray()?this.applyTexImage2D(t,this._textureTarget,0,this._internalFormat,this._textureWidth,this._textureHeight,0,this._internalFormat,this._type,this._image.getImage()):this.applyTexImage2D(t,this._textureTarget,0,this._internalFormat,this._internalFormat,this._type,e.getImage()),e.setDirty(!1)},apply:function(t){var e=t.getGraphicContext();if(this._dirtyTextureObject&&(this.releaseGLObjects(),this._dirtyTextureObject=!1),void 0===this._textureObject||this.isDirty())if(this._textureNull)e.bindTexture(this._textureTarget,null);else{var i=this._image;if(void 0!==i)if(i.isReady()){this.computeTextureFormat();var r=i.getWidth()||this._textureWidth,n=i.getHeight()||this._textureHeight;this.setTextureSize(r,n),this._textureObject||this.init(t),this._textureObject.bind(e),this.applyImage(e,this._image),this.applyFilterParameter(e,this._textureTarget),this.generateMipmap(e,this._textureTarget),this._unrefImageDataAfterApply&&(this._image=void 0),this._dirty=!1}else e.bindTexture(this._textureTarget,null);else 0!==this._textureHeight&&0!==this._textureWidth&&(this.computeTextureFormat(),this._textureObject||this.init(t),this._textureObject.bind(e),this.applyTexImage2D(e,this._textureTarget,0,this._internalFormat,this._textureWidth,this._textureHeight,0,this._internalFormat,this._type,null),this.applyFilterParameter(e,this._textureTarget),this.generateMipmap(e,this._textureTarget),this._dirty=!1)}else this._textureObject.bind(e),this.isDirtyMipmap()&&this.generateMipmap(e,this._textureTarget),void 0!==this._image&&this._image.isDirty()&&this.applyImage(e,this._image)}})),"osg","Texture"),n.setTypeID(p),p.textureNull=new p,p.createFromImage=function(t,e){var i=new p;return i.setImage(t,e),i},p.createFromCanvas=function(t,e){return p.createFromImage(t,e)},t.exports=p},function(t,e){"use strict";var i=function(t){this._data=void 0,this._transpose=!1,this._glCall="",this._cache=void 0,this._name=t,this._type=void 0,this._isMatrix=!1};i.isUniform=function(t){return"object"==typeof t&&window.Object.getPrototypeOf(t)===i.prototype},i.prototype={getName:function(){return this._name},getType:function(){return this._type},apply:function(t,e){this._cache||(this._cache=t[this._glCall]),this._isMatrix?this._cache.call(t,e,this._transpose,this._data):this._cache.call(t,e,this._data)},setInternalArray:function(t){this._data=t},getInternalArray:function(){return this._data},setFloat:function(t){this._data[0]=t},setFloat1:function(t){this._data[0]=t[0]},setFloat2:function(t){this._data[0]=t[0],this._data[1]=t[1]},setFloat3:function(t){this._data[0]=t[0],this._data[1]=t[1],this._data[2]=t[2]},setFloat4:function(t){this._data[0]=t[0],this._data[1]=t[1],this._data[2]=t[2],this._data[3]=t[3]},setFloat9:function(t){this._data[0]=t[0],this._data[1]=t[1],this._data[2]=t[2],this._data[3]=t[3],this._data[4]=t[4],this._data[5]=t[5],this._data[6]=t[6],this._data[7]=t[7],this._data[8]=t[8]},setFloat16:function(t){this._data[0]=t[0],this._data[1]=t[1],this._data[2]=t[2],this._data[3]=t[3],this._data[4]=t[4],this._data[5]=t[5],this._data[6]=t[6],this._data[7]=t[7],this._data[8]=t[8],this._data[9]=t[9],this._data[10]=t[10],this._data[11]=t[11],this._data[12]=t[12],this._data[13]=t[13],this._data[14]=t[14],this._data[15]=t[15]}},i.prototype.setVec2=i.prototype.setFloat2,i.prototype.setVec3=i.prototype.setFloat3,i.prototype.setVec4=i.prototype.setFloat4,i.prototype.setMatrix4=i.prototype.setFloat16,i.prototype.setMatrix3=i.prototype.setFloat9,i.prototype.setInt=i.prototype.setFloat,i.prototype.setInt1=i.prototype.setFloat1,i.prototype.setInt2=i.prototype.setFloat2,i.prototype.setInt3=i.prototype.setFloat3,i.prototype.setInt4=i.prototype.setFloat4;var r=function(t,e,r,n,a,s){var o=void 0===e?void 0:t,h=new i(void 0===e?t:e);if(h._data=r(),void 0!==o)if(o.length)for(var u=0,c=o.length;u<c;++u)h._data[u]=o[u];else h._data[0]=o;return h._glCall=n,h._type=a,h._isMatrix=!!s,h},n=function(){return new Float32Array(1)},a=function(){return new Float32Array(2)},s=function(){return new Float32Array(3)},o=function(){return new Float32Array(4)},h=function(){return new Int32Array(1)},u=function(){return new Int32Array(2)},c=function(){return new Int32Array(3)},l=function(){return new Int32Array(4)},d=function(){var t=new Float32Array(4);return t[0]=t[3]=1,t},f=function(){var t=new Float32Array(9);return t[0]=t[4]=t[8]=1,t},p=function(){var t=new Float32Array(16);return t[0]=t[5]=t[10]=t[15]=1,t};i.createFloat1=function(t,e){return r(t,e,n,"uniform1fv","float")},i.createInt1=function(t,e){return r(t,e,h,"uniform1iv","int")},i.createFloat2=function(t,e){return r(t,e,a,"uniform2fv","vec2")},i.createInt2=function(t,e){return r(t,e,u,"uniform2iv","vec2i")},i.createFloat3=function(t,e){return r(t,e,s,"uniform3fv","vec3")},i.createInt3=function(t,e){return r(t,e,c,"uniform3iv","vec3i")},i.createFloat4=function(t,e){return r(t,e,o,"uniform4fv","vec4")},i.createInt4=function(t,e){return r(t,e,l,"uniform4iv","vec4i")},i.createMatrix2=function(t,e){return r(t,e,d,"uniformMatrix2fv","mat2",!0)},i.createMatrix3=function(t,e){return r(t,e,f,"uniformMatrix3fv","mat3",!0)},i.createMatrix4=function(t,e){return r(t,e,p,"uniformMatrix4fv","mat4",!0)},i.float=i.createFloatArray=i.createFloat=i.createFloat1,i.int=i.createIntArray=i.createInt=i.createInt1,i.vec2=i.createFloat2Array=i.createFloat2,i.vec2i=i.createInt2Array=i.createInt2,i.vec3=i.createFloat3Array=i.createFloat3,i.vec3i=i.createInt3Array=i.createInt3,i.vec4=i.createFloat4Array=i.createFloat4,i.vec4i=i.createInt4Array=i.createInt4,i.mat2=i.createMat2=i.createMatrix2,
i.mat3=i.createMat3=i.createMatrix3,i.mat4=i.createMat4=i.createMatrix4,t.exports=i},function(t,e,i){"use strict";var r=i(10),n=i(6),a=i(13),s=window.ImageBitmap||function(){},o=function(t){a.call(this),this._imageObject=void 0,this._url=void 0,this._width=void 0,this._height=void 0,this._dirty=!0,this._mipmap=[],t&&this.setImage(t),this._isGreyscale=void 0};o.prototype=n.objectLibraryClass(n.objectInherit(a.prototype,{dirty:function(){this._isGreyscale=void 0,this._dirty=!0},isDirty:function(){return this._dirty},setDirty:function(t){this._dirty=t},getImage:function(){return this._imageObject instanceof o?this._imageObject.getImage():this._imageObject},getURL:function(){return this._url},setURL:function(t){this._url=t},useOrCreateImage:function(t){return t instanceof o==!1?new o(t):t},setImage:function(t){if(!this._url&&t&&(t.src||t.currentSrc)&&(this._url=t.src||t.currentSrc),this._mipmap.length=0,Array.isArray(t)){for(var e=0,i=t.length;e<i;e++)this._mipmap.push(this.useOrCreateImage(t[e]));this.setWidth(this._mipmap[0].getWidth()),this.setHeight(this._mipmap[0].getHeight())}else this._mipmap.push(t);this._imageObject=this._mipmap[0],this.dirty()},isCanvas:function(){return this.getImage()instanceof window.HTMLCanvasElement},isBitmap:function(){return this.getImage()instanceof s},isVideo:function(){return this.getImage()instanceof window.HTMLVideoElement},isImage:function(){return this.getImage()instanceof window.Image},isTypedArray:function(){var t=this.getImage();return t instanceof Uint8Array||t instanceof Float32Array||t instanceof Uint16Array},setWidth:function(t){this._width=t},setHeight:function(t){this._height=t},getWidth:function(){var t=this.getImage();return this.isImage()?t.naturalWidth:this.isVideo()?t.videoWidth:this.isCanvas()||this.isBitmap()?t.width:this._width},getHeight:function(){var t=this.getImage();return this.isImage()?t.naturalHeight:this.isVideo()?t.videoHeight:this.isCanvas()||this.isBitmap()?t.height:this._height},isGreyscale:function(t){if(void 0!==this._isGreyscale)return this._isGreyscale;if(void 0!==this._imageObject&&this.isReady()&&void 0===this._isGreyscale){var e=this._imageObject;this.isCanvas()||(e=document.createElement("canvas"));var i=e.getContext("2d");e.width=this._imageObject.width,e.height=this._imageObject.height,i.drawImage(this._imageObject,0,0);var r,n;t||(r=e.width,n=e.height),t>0&&(t=Math.min(Math.min(e.width,e.height),t),r=n=t);for(var a=!0,s=e.width/r,o=e.height/n,h=0;h<r;h++)for(var u=0;u<n;u++){var c=Math.floor(s*(h+.5)),l=Math.floor(o*(u+.5)),d=i.getImageData(c,l,1,1).data;if(d[0]!==d[1]||d[0]!==d[2]){a=!1;break}}this._isGreyscale=a}return this._isGreyscale},isReady:function(){if(this._imageObject&&this._imageObject instanceof o)return this._imageObject.isReady();if(this.isCanvas()||this.isTypedArray()||this.isBitmap())return!0;if(this.isImage()){var t=this.getImage();if(t.complete)return void 0===t.naturalWidth||0!==t.naturalWidth}if(this.isVideo()&&0!==this.getWidth())return!0;var e=this.getImage();return e.complete?void 0===e.naturalWidth||0!==e.naturalWidth:(r.warn("Warning can't detect image object "),!1)},getMipmap:function(){return this._mipmap},hasMipmap:function(){return this._mipmap.length>1},release:function(){this._mipmap.length=0,this._imageObject=void 0}}),"osg","Image"),n.setTypeID(o),t.exports=o},function(t,e){"use strict";var i=function(){this._gl=void 0};i.prototype={setGraphicContext:function(t){this._gl=t},getGraphicContext:function(){return this._gl}},t.exports=i},function(t,e,i){"use strict";var r=i(10),n=i(9),a=function(t,e,i,r){this._target=t,this._internalFormat=e,this._width=i,this._height=r,this._size=0,this.computeSize()};a.prototype={match:function(t){return t._target===this._target&&t._internalFormat===this._internalFormat&&t._width===this._width&&t._height===this._height},computeSize:function(){var t=i(40),e=0;switch(this._internalFormat){case 1:e=8;break;case t.ALPHA:e=8;break;case t.LUMINANCE:e=8;break;case t.LUMINANCE_ALPHA:e=16;break;case 2:e=16;break;case t.RGB:e=24;break;case 3:e=24;break;case t.RGBA:e=32;break;case 4:e=32}var r=Math.ceil(this._width*this._height*e)/8;this._target===t.TEXTURE_CUBE_MAP&&(r*=6),r+=r/3,this._size=r},getSize:function(){return this._size}},a.getHash=function(){var t=Array.prototype.slice.call(arguments),e="";return t.forEach(function(t){e+=t}),e};var s=function(t,e,i){this._texture=t,this._id=e,this._textureSet=i};s.prototype={target:function(){return this._textureSet._profile._target},id:function(){return this._id},getTextureSet:function(){return this._textureSet},reset:function(){this._textureObject=null,this._texture=void 0},bind:function(t){t.bindTexture(this.target(),this._id)}};var o=function(t){this._profile=t,this._usedTextureObjects=[],this._orphanedTextureObjects=[]};o.prototype={getProfile:function(){return this._profile},getUsedTextureObjects:function(){return this._usedTextureObjects},getOrphanedTextureObjects:function(){return this._orphanedTextureObjects},takeOrGenerate:function(t,e){var i;if(this._orphanedTextureObjects.length>0)return i=this.takeFromOrphans(),i._texture=e,this._usedTextureObjects.push(i),i;var r=t.createTexture();return i=new s(e,r,this),this._usedTextureObjects.push(i),i},takeFromOrphans:function(){if(this._orphanedTextureObjects.length)return this._orphanedTextureObjects.pop()},orphan:function(t){var e=this._usedTextureObjects.indexOf(t);e!==-1&&(this._orphanedTextureObjects.push(this._usedTextureObjects[e]),this._usedTextureObjects.splice(e,1))},flushDeletedTextureObjects:function(t,e){if(e<=0)return e;var i,r=this._orphanedTextureObjects.length,a=0,s=n.instance().tick();for(i=0;i<r&&a<e;i++)t.deleteTexture(this._orphanedTextureObjects[i].id()),this._orphanedTextureObjects[i].reset(),a=n.instance().deltaS(s,n.instance().tick());return this._orphanedTextureObjects.splice(0,i),e-a},flushAllDeletedTextureObjects:function(t){for(var e=this._orphanedTextureObjects.length,i=this.getProfile().getSize(),n=0,a=e;n<a;++n)t.deleteTexture(this._orphanedTextureObjects[n].id()),this._orphanedTextureObjects[n].reset();this._orphanedTextureObjects.length=0,r.info("TextureManager: released "+e+" with "+e*i/1048576+" MB")}};var h=function(){this._textureSetMap={}};h.prototype={generateTextureObject:function(t,e,i,r,n,s){var h=a.getHash(i,r,n,s);void 0===this._textureSetMap[h]&&(this._textureSetMap[h]=new o(new a(i,r,n,s)));var u=this._textureSetMap[h],c=u.takeOrGenerate(t,e);return c},updateStats:function(t,e){var i=0,r=0;window.Object.keys(this._textureSetMap).forEach(function(t){var e=this._textureSetMap[t].getProfile(),n=e.getSize(),a=this._textureSetMap[t].getUsedTextureObjects().length,s=this._textureSetMap[t].getOrphanedTextureObjects().length;i+=a*n,r+=s*n},this);var n=1048576;e("textureused").set(i/n),e("texturereserved").set(r/n),e("texturetotal").set((i+r)/n)},reportStats:function(){var t=0;window.Object.keys(this._textureSetMap).forEach(function(e){var i=this._textureSetMap[e].getProfile(),n=i.getSize()/1048576,a=this._textureSetMap[e].getUsedTextureObjects().length;n*=a,t+=n,r.notice(String(n)+" MB with "+a+" texture of "+i._width+"x"+i._height+" "+i._internalFormat)},this),r.notice(String(t)+" MB in total")},flushAllDeletedTextureObjects:function(t){window.Object.keys(this._textureSetMap).forEach(function(e){this._textureSetMap[e].flushAllDeletedTextureObjects(t)},this)},flushDeletedTextureObjects:function(t,e){for(var i=e,r=window.Object.keys(this._textureSetMap),n=0,a=r.length;n<a&&i>0;n++)i=this._textureSetMap[r[n]].flushDeletedTextureObjects(t,i);return i},releaseTextureObject:function(t){if(t){var e=t.getTextureSet();e.orphan(t)}}},t.exports=h},function(t,e,i){"use strict";var r=i(46),n=function(t,e){this.mode=r.POINTS,void 0!==t&&("string"==typeof t&&(t=r[t]),this.mode=t),this.count=0,this.offset=0,this.indices=e,this.uType=n.UNSIGNED_SHORT,void 0!==e&&this.setIndices(e)};n.UNSIGNED_BYTE=5121,n.UNSIGNED_SHORT=5123,n.UNSIGNED_INT=5125,n.prototype={getMode:function(){return this.mode},draw:function(t){0!==this.count&&(t.setIndexArray(this.indices),this.drawElements(t))},drawElements:function(t){var e=t.getGraphicContext();e.drawElements(this.mode,this.count,this.uType,this.offset)},setIndices:function(t){this.indices=t;var e=t.getElements();this.count=e.length;var i=e.BYTES_PER_ELEMENT;1===i?this.uType=n.UNSIGNED_BYTE:2===i?this.uType=n.UNSIGNED_SHORT:4===i&&(this.uType=n.UNSIGNED_INT)},getIndices:function(){return this.indices},setFirst:function(t){this.offset=t},getFirst:function(){return this.offset},setCount:function(t){this.count=t},getCount:function(){return this.count},getNumIndices:function(){return this.indices.getElements().length},index:function(t){return this.indices.getElements()[t]}},t.exports=n},function(t,e){"use strict";var i={};i.POINTS=0,i.LINES=1,i.LINE_LOOP=2,i.LINE_STRIP=3,i.TRIANGLES=4,i.TRIANGLE_STRIP=5,i.TRIANGLE_FAN=6,t.exports=i},function(t,e,i){"use strict";var r=i(48),n=function(t){this._initialBufferArray=void 0,this._bufferArray=void 0,t&&(this.setBufferArray(t),this.setInitialBufferArray(t))},a={setInitialBufferArray:function(t){this._initialBufferArray=t},getInitialBufferArray:function(){return this._initialBufferArray},setBufferArray:function(t){this._bufferArray=t.getBufferArray?t.getBufferArray():t},getBufferArray:function(){return this._bufferArray}},s=window.Object.keys(r.prototype);s.forEach(function(t){a[t]=function(){return r.prototype[t].apply(this._bufferArray,arguments)}}),n.prototype=a,t.exports=n},function(t,e,i){"use strict";var r=i(6),n=i(13),a=i(43),s=i(9),o=function(t){var e;return t instanceof r.Float32Array&&(e=5126),t instanceof r.Uint32Array&&(e=5125),t instanceof r.Uint16Array&&(e=5123),t instanceof r.Uint8Array&&(e=5121),e},h=function(t,e,i,s){if(a.call(this),this._instanceID=n.getInstanceID(),this.dirty(),this._itemSize=i,this._target="string"==typeof t?h[t]:t,this._type=void 0,this._normalize=!1,void 0!==e){var o=e;s||(o=this._target===h.ELEMENT_ARRAY_BUFFER?e instanceof r.Uint16Array?e:new r.Uint16Array(e):e instanceof r.Float32Array?e:new r.Float32Array(e)),this.setElements(o)}};h.ELEMENT_ARRAY_BUFFER=34963,h.ARRAY_BUFFER=34962,h._sDeletedGLBufferArrayCache=new window.Map,h.deleteGLBufferArray=function(t,e){h._sDeletedGLBufferArrayCache.has(t)||h._sDeletedGLBufferArrayCache.set(t,[]),h._sDeletedGLBufferArrayCache.get(t).push(e)},h.flushDeletedGLBufferArrays=function(t,e){if(e<=0)return e;if(!h._sDeletedGLBufferArrayCache.has(t))return e;for(var i=0,r=s.instance().tick(),n=h._sDeletedGLBufferArrayCache.get(t),a=n.length,o=a-1;o>=0&&i<e;o--)t.deleteBuffer(n[o]),n.splice(o,1),i=s.instance().deltaS(r,s.instance().tick());return e-i},h.flushAllDeletedGLBufferArrays=function(t){if(h._sDeletedGLBufferArrayCache.has(t))for(var e=h._sDeletedGLBufferArrayCache.get(t),i=e.length,r=i-1;r>=0;r--)t.deleteBuffer(e[r]),e.splice(r,1)},h.prototype=r.objectInherit(a.prototype,{getInstanceID:function(){return this._instanceID},setItemSize:function(t){this._itemSize=t},isValid:function(){return void 0!==this._buffer||void 0!==this._elements},releaseGLObjects:function(){void 0!==this._buffer&&null!==this._buffer&&void 0!==this._gl&&h.deleteGLBufferArray(this._gl,this._buffer),this._buffer=void 0},setNormalize:function(t){this._normalize=t},getNormalize:function(){return this._normalize},bind:function(t){this._gl||this.setGraphicContext(t);var e=this._target,i=this._buffer;return i?void t.bindBuffer(e,i):void(!i&&this._elements.length>0&&(this._buffer=t.createBuffer(),this._numItems=this._elements.length/this._itemSize,t.bindBuffer(e,this._buffer)))},getItemSize:function(){return this._itemSize},dirty:function(){this._dirty=!0},isDirty:function(){return this._dirty},compile:function(t){this._dirty&&(r.timeStamp("osgjs.metrics:bufferData"),t.bufferData(this._target,this._elements,t.STATIC_DRAW),this._dirty=!1)},getElements:function(){return this._elements},setElements:function(t){this._elements=t,this._type=o(t),this._dirty=!0},getType:function(){return this._type}}),t.exports=h},function(t,e,i){"use strict";var r=i(6),n=i(31),a=function(){n.call(this),this._attributeEnable=!1};a.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{attributeType:"Billboard",cloneType:function(){return new a},setEnabled:function(t){this._attributeEnable=t},isEnabled:function(){return this._attributeEnable},apply:function(){}}),"osg","Billboard"),t.exports=a},function(t,e,i){"use strict";var r=i(6),n=i(31),a=i(15).vec4,s=function(t){n.call(this),this._constantColor=a.create(),a.set(this._constantColor,1,1,1,1),void 0!==t&&this.setConstantColor(t)};s.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{attributeType:"BlendColor",cloneType:function(){return new s},setConstantColor:function(t){a.copy(this._constantColor,t)},getConstantColor:function(){return this._constantColor},apply:function(t){var e=t.getGraphicContext();e.blendColor(this._constantColor[0],this._constantColor[1],this._constantColor[2],this._constantColor[3])}}),"osg","BlendColor"),t.exports=s},function(t,e,i){"use strict";var r=i(6),n=i(31),a=function(t,e,i,r){n.call(this),this._sourceFactor=a.DISABLE,this._destinationFactor=a.DISABLE,this._sourceFactorAlpha=this._sourceFactor,this._destinationFactorAlpha=this._destinationFactor,this._separate=!1,void 0!==t&&this.setSource(t),void 0!==e&&this.setDestination(e),void 0!==i&&this.setSourceAlpha(i),void 0!==r&&this.setDestinationAlpha(r)};a.DISABLE=-1,a.ZERO=0,a.ONE=1,a.SRC_COLOR=768,a.ONE_MINUS_SRC_COLOR=769,a.SRC_ALPHA=770,a.ONE_MINUS_SRC_ALPHA=771,a.DST_ALPHA=772,a.ONE_MINUS_DST_ALPHA=773,a.DST_COLOR=774,a.ONE_MINUS_DST_COLOR=775,a.SRC_ALPHA_SATURATE=776,a.BLEND_DST_RGB=32968,a.BLEND_SRC_RGB=32969,a.BLEND_DST_ALPHA=32970,a.BLEND_SRC_ALPHA=32971,a.CONSTANT_COLOR=32769,a.ONE_MINUS_CONSTANT_COLOR=32770,a.CONSTANT_ALPHA=32771,a.ONE_MINUS_CONSTANT_ALPHA=32772,a.BLEND_COLOR=32773,a.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{attributeType:"BlendFunc",cloneType:function(){return new a},setSource:function(t){this.setSourceRGB(t),this.setSourceAlpha(t)},getSource:function(){return this._sourceFactor},setDestination:function(t){this.setDestinationRGB(t),this.setDestinationAlpha(t)},getDestination:function(){return this._destinationFactor},getSeparate:function(){return this._separate},checkSeparate:function(){return this._sourceFactor!==this._sourceFactorAlpha||this._destinationFactor!==this._destinationFactorAlpha},setSourceRGB:function(t){"string"==typeof t?this._sourceFactor=a[t]:this._sourceFactor=t,this._separate=this.checkSeparate()},getSourceRGB:function(){return this._sourceFactor},setSourceAlpha:function(t){"string"==typeof t?this._sourceFactorAlpha=a[t]:this._sourceFactorAlpha=t,this._separate=this.checkSeparate()},getSourceAlpha:function(){return this._sourceFactorAlpha},setDestinationRGB:function(t){"string"==typeof t?this._destinationFactor=a[t]:this._destinationFactor=t,this._separate=this.checkSeparate()},getDestinationRGB:function(){return this._destinationFactor},setDestinationAlpha:function(t){"string"==typeof t?this._destinationFactorAlpha=a[t]:this._destinationFactorAlpha=t,this._separate=this.checkSeparate()},getDestinationAlpha:function(){return this._destinationFactorAlpha},apply:function(t){var e=t.getGraphicContext();this._sourceFactor===a.DISABLE||this._destinationFactor===a.DISABLE?e.disable(e.BLEND):(e.enable(e.BLEND),this._separate?e.blendFuncSeparate(this._sourceFactor,this._destinationFactor,this._sourceFactorAlpha,this._destinationFactorAlpha):e.blendFunc(this._sourceFactor,this._destinationFactor))}}),"osg","BlendFunc"),t.exports=a},function(t,e,i){"use strict";var r=i(6),n=i(11),a=i(53),s=i(15).mat4,o=i(40),h=i(35),u=i(15).vec4,c=function(){n.call(this),a.call(this),this.viewport=void 0,this._graphicContext=void 0,this.setClearColor(u.fromValues(0,0,0,1)),this.setClearDepth(1),this.setClearMask(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT),this.setViewMatrix(s.create()),this.setProjectionMatrix(s.create()),this.renderOrder=c.NESTED_RENDER,this.renderOrderNum=0,this._view=void 0,this._renderer=void 0,this._attachments={}};c.PRE_RENDER=0,c.NESTED_RENDER=1,c.POST_RENDER=2,c.COLOR_BUFFER_BIT=16384,c.DEPTH_BUFFER_BIT=256,c.STENCIL_BUFFER_BIT=1024,c.prototype=r.objectLibraryClass(r.objectInherit(a.prototype,r.objectInherit(n.prototype,{getView:function(){return this._view},setView:function(t){this._view=t},getRenderer:function(){return this._renderer},setRenderer:function(t){this._renderer=t},setFinalDrawCallback:function(t){this._finalDrawCallback=t},getFinalDrawCallback:function(){return this._finalDrawCallback},setInitialDrawCallback:function(t){this._initialDrawCallback=t},getInitialDrawCallback:function(){return this._initialDrawCallback},getAttachments:function(){return this._attachments},setGraphicContext:function(t){this._graphicContext=t},getGraphicContext:function(){return this._graphicContext},setClearDepth:function(t){this.clearDepth=t},getClearDepth:function(){return this.clearDepth},setClearMask:function(t){this.clearMask=t},getClearMask:function(){return this.clearMask},setClearColor:function(t){this.clearColor=t},getClearColor:function(){return this.clearColor},setViewport:function(t){this.viewport=t,this.getOrCreateStateSet().setAttributeAndModes(t)},getViewport:function(){return this.viewport},setViewMatrix:function(t){this.modelviewMatrix=t},setViewMatrixAsLookAt:function(t,e,i){s.lookAt(this.getViewMatrix(),t,e,i)},setProjectionMatrix:function(t){this.projectionMatrix=t},setProjectionMatrixAsOrtho:function(t,e,i,r,n,a){s.ortho(this.getProjectionMatrix(),t,e,i,r,n,a)},isRenderToTextureCamera:function(){return window.Object.keys(this._attachments).length>0},getViewMatrix:function(){return this.modelviewMatrix},getProjectionMatrix:function(){return this.projectionMatrix},getRenderOrder:function(){return this.renderOrder},setRenderOrder:function(t,e){this.renderOrder=t,this.renderOrderNum=e},detachAll:function(){this._attachments={},this.frameBufferObject&&this.frameBufferObject.dirty()},resetAttachments:function(){this.frameBufferObject&&(this.frameBufferObject.reset(),this.frameBufferObject=0),this._attachments={}},attachTexture:function(t,e,i){this.frameBufferObject&&this.frameBufferObject.dirty(),i||(i=o.TEXTURE_2D),this._attachments[t]={attachment:t,texture:e,textureTarget:i}},attachRenderBuffer:function(t,e){this.frameBufferObject&&this.frameBufferObject.dirty(),this._attachments[t]={format:e,attachment:t}},computeLocalToWorldMatrix:function(t){return this.referenceFrame===h.RELATIVE_RF?s.mul(t,t,this.modelviewMatrix):s.copy(t,this.modelviewMatrix),!0},computeWorldToLocalMatrix:function(){var t=s.create();return function(e){return s.invert(t,this.modelviewMatrix),this.referenceFrame===h.RELATIVE_RF?s.mul(e,t,e):s.copy(e,t),!0}}()})),"osg","Camera"),r.setTypeID(c),t.exports=c},function(t,e){"use strict";var i=function(){i.prototype.reset.call(this)};i.prototype={reset:function(){this._computeNearFar=!0,this._nearFarRatio=.005,this.bbCornerFar=3,this.bbCornerNear=4,this._enableFrustumCulling=!1,this._settingsSourceOverrider=this,this._LODScale=1,this._clampProjectionMatrixCallback=void 0},setCullSettings:function(t){this._computeNearFar=t._computeNearFar,this._nearFarRatio=t._nearFarRatio,this._enableFrustumCulling=t._enableFrustumCulling,this._settingsSourceOverrider=t._settingsSourceOverrider,this._clampProjectionMatrixCallback=t._clampProjectionMatrixCallback},setNearFarRatio:function(t){this._nearFarRatio=t},getNearFarRatio:function(){return this._nearFarRatio},setComputeNearFar:function(t){this._computeNearFar=t},getComputeNearFar:function(){return this._computeNearFar},setEnableFrustumCulling:function(t){this._enableFrustumCulling=t},getEnableFrustumCulling:function(){return this._enableFrustumCulling},getSettingSourceOverrider:function(){return this._settingsSourceOverrider},setClampProjectionMatrixCallback:function(t){this._clampProjectionMatrixCallback=t},getClampProjectionMatrixCallback:function(){return this._clampProjectionMatrixCallback},setLODScale:function(t){this._LODScale=t},getLODScale:function(){return this._LODScale}},t.exports=i},function(t,e,i){"use strict";var r=i(6),n=i(31),a=function(t,e,i,r){n.call(this),this._colorMask=[!0,!0,!0,!0],this.setMask(t,e,i,r)};a.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{attributeType:"ColorMask",cloneType:function(){return new a},setMask:function(t,e,i,r){void 0!==t&&void 0!==e&&void 0!==i&&void 0!==r&&(this._colorMask[0]=t,this._colorMask[1]=e,this._colorMask[2]=i,this._colorMask[3]=r)},apply:function(t){var e=t.getGraphicContext(),i=this._colorMask;e.colorMask(i[0],i[1],i[2],i[3])}}),"osg","ColorMask"),t.exports=a},function(t,e,i){"use strict";var r=i(6),n=i(31),a=function(t){n.call(this),this.setMode(void 0!==t?t:a.BACK)};a.DISABLE=0,a.FRONT=1028,a.BACK=1029,a.FRONT_AND_BACK=1032,a.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{attributeType:"CullFace",cloneType:function(){return new a},setMode:function(t){var e=t;"string"==typeof e&&(e=a[e]),this._mode=e},getMode:function(){return this._mode},apply:function(t){var e=t.getGraphicContext();this._mode===a.DISABLE?e.disable(e.CULL_FACE):(e.enable(e.CULL_FACE),e.cullFace(this._mode))}}),"osg","CullFace"),t.exports=a},function(t,e,i){"use strict";var r=i(57),n=function(){this._mask=n.DEFAULT_CULLING,this._frustum=new r};n.prototype={reset:function(){this._mask=n.DEFAULT_CULLING,this._frustum.clear()},setCullingMask:function(t){this._mask=t},getCullingMask:function(){return this._mask},setFrustum:function(t){this._frustum=t},getFrustum:function(){return this._frustum},getCurrentResultMask:function(){return this._frustum.getCurrentMask()},pushCurrentMask:function(){this._frustum.pushCurrentMask()},popCurrentMask:function(){this._frustum.popCurrentMask()},resetCullingMask:function(){this._frustum.setResultMask(this._frustum.getCurrentMask())},isBoundingBoxCulled:function(t){return!(!(this._mask&n.VIEW_FRUSTUM_CULLING)||this._frustum.containsBoundingBox(t))},isBoundingSphereCulled:function(t){return!(!(this._mask&n.VIEW_FRUSTUM_CULLING)||this._frustum.containsBoundingSphere(t))},isVerticesCulled:function(t){return!(!(this._mask&n.VIEW_FRUSTUM_CULLING)||this._frustum.containsVertices(t))}},n.NO_CULLING=0,n.VIEW_FRUSTUM_LEFT_CULLING=1,n.VIEW_FRUSTUM_RIGHT_CULLING=2,n.VIEW_FRUSTUM_TOP_CULLING=3,n.VIEW_FRUSTUM_BOTTOM_CULLING=4,n.NEAR_PLANE_CULLING=5,n.FAR_PLANE_CULLING=6,n.VIEW_FRUSTUM_SIDES_CULLING=n.VIEW_FRUSTUM_LEFT_CULLING|n.VIEW_FRUSTUM_RIGHT_CULLING|n.VIEW_FRUSTUM_BOTTOM_CULLING|n.VIEW_FRUSTUM_TOP_CULLING,n.VIEW_FRUSTUM_CULLING=n.VIEW_FRUSTUM_SIDES_CULLING|n.NEAR_PLANE_CULLING|n.FAR_PLANE_CULLING,n.DEFAULT_CULLING=n.VIEW_FRUSTUM_SIDES_CULLING,n.ENABLE_ALL_CULLING=n.VIEW_FRUSTUM_CULLING,t.exports=n},function(t,e,i){"use strict";var r=i(13),n=i(58),a=i(6),s=i(15).vec4,o=function(){this._clippingMask=0,this._planeList=[n.create(),n.create(),n.create(),n.create(),n.create(),n.create()],this._vertexList=[],this._maskStack=[],this._resultMask=0,this._maskStack.push(this._resultMask)};o.prototype=a.objectInherit(r.prototype,{getPlanes:function(){return this._planeList},setPlanes:function(t){this._planeList=t,this.setupMask()},clear:function(){if(this._clippingMask=0,this._planeList)for(var t=0,e=this._planeList.length;t<e;++t)n.init(this._planeList[t]);this._vertexList=[],this.setupMask()},setToUnitFrustum:function(t,e){void 0===t&&(t=!0),void 0===e&&(e=!0),this._planeList.length=0,this._planeList.push(s.set(n.create(),1,0,0,1)),this._planeList.push(s.set(n.create(),-1,0,0,1)),this._planeList.push(s.set(n.create(),0,1,0,1)),this._planeList.push(s.set(n.create(),0,-1,0,1)),t&&this._planeList.push(s.set(n.create(),0,0,1,1)),e&&this._planeList.push(s.set(n.create(),0,0,-1,1)),this.setupMask()},setToBoundingBox:function(t){this._planeList.length=0,this._planeList.push(s.set(n.create(),1,0,0,-t.getMin()[0])),this._planeList.push(s.set(n.create(),-1,0,0,t.getMax()[0])),this._planeList.push(s.set(n.create(),0,1,0,-t.getMin()[1])),this._planeList.push(s.set(n.create(),0,-1,0,t.getMax()[1])),this._planeList.push(s.set(n.create(),0,0,1,-t.getMin()[2])),this._planeList.push(s.set(n.create(),0,0,-1,t.getMax()[2])),this.setupMask()},setAndTransformProvidingInverse:function(t,e){this._referenceVertexList=t._referenceVertexList;var i=t._maskStack[this._maskStack.length-1];if(0===i)return this._maskStack[this._maskStack.length-1]=0,this._resultMask=0,void(this._planeList.length=0);var r,a=1,s=0;for(r=0;r!==t._planeList.length;++r)i&a&&++s,a<<=1;this._planeList.length=s,this._resultMask=0,a=1;var o=0;for(r=0;r!==t._planeList.length;++r)i&a&&(this._planeList[o]=t._planeList[r],n.transformProvidingInverse(this._planeList[o++],e),this._resultMask=this._resultMask<<1|1),a<<=1;this._maskStack[this._maskStack.length-1]=this._resultMask},voidset:function(t){this._planeList=t,this.setupMask()},add:function(t){this._planeList.push(t),this.setupMask()},empty:function(){return 0===this._planeList.length},getPlaneList:function(){return this._planeList},setReferenceVertexList:function(t){this._referenceVertexList=t},getReferenceVertexList:function(){return this._referenceVertexList},setupMask:function(t){this._resultMask=0;for(var e=void 0!==t?t:this._planeList.length,i=0;i<e;++i)this._resultMask=this._resultMask<<1|1;this._maskStack=[],this._maskStack.push(this._resultMask)},getCurrentMask:function(){return this._maskStack[this._maskStack.length-1]},setResultMask:function(t){this._resultMask=t},getResultMask:function(){return this._resultMask},getMaskStack:function(){return this._maskStack},pushCurrentMask:function(){this._maskStack.push(this._resultMask)},popCurrentMask:function(){return this._maskStack.pop()},containsVertex:function(t){if(!this._maskStack[this._maskStack.length-1])return!0;for(var e=1,i=0;i<this._planeList.length;++i){if(this._maskStack[this._maskStack.length-1]&e&&n.distanceToPlane(this._planeList[i],t)<0)return!1;e<<=1}return!0},containsVertices:function(t){if(!this._maskStack[this._maskStack.length-1])return!0;this._resultMask=this._maskStack[this._maskStack.length-1];for(var e=0;e<t.length;++e){for(var i=t[e],r=!1,a=1,s=0;!r&&s<this._planeList.length;++s)this._maskStack[this._maskStack.length-1]&a&&n.distanceToPlane(this._planeList[s],i)<0&&(r=!0),a<<=1;if(!r)return!0}return!1},containsBoundingSphere:function(t){if(!this._maskStack[this._maskStack.length-1]||!t.valid())return!0;this._resultMask=this._maskStack[this._maskStack.length-1];for(var e=1,i=0;i<this._planeList.length;++i){if(this._resultMask&e){var r=n.intersectsOrContainsBoundingSphere(this._planeList[i],t);if(n.OUTSIDE===r)return!1;n.INSIDE===r&&(this._resultMask^=e)}e<<=1}return!0},containsBoundingBox:function(t){if(!this._maskStack[this._maskStack.length-1])return!0;this._resultMask=this._maskStack[this._maskStack.length-1];for(var e=1,i=0;i<this._planeList.length;++i){if(this._resultMask&e){var r=n.intersectsOrContainsBoundingBox(this._planeList[i],t);if(n.OUTSIDE===r)return!1;n.INSIDE===r&&(this._resultMask^=e)}e<<=1}return!0},containsAllOfVertices:function(t){if(!this._maskStack[this._maskStack.length-1])return!1;this._resultMask=this._maskStack[this._maskStack.length-1];for(var e=1,i=0;i<this._planeList.length;++i){if(this._resultMask&e){var r=n.intersectsOrContainsVertices(this._planeList[i],t);if(r<1)return!1;this._resultMask^=e}e<<=1}return!0},containsAllOfBoundingSphere:function(t){if(!this._maskStack[this._maskStack.length-1])return!1;this._resultMask=this._maskStack[this._maskStack.length-1];for(var e=1,i=0;i<this._planeList.length;++i){if(this._resultMask&e){var r=n.intersectsOrContainsBoundingSphere(this._planeList[i],t);if(r<1)return!1;this._resultMask^=e}e<<=1}return!0},containsAllOfBoundingBox:function(t){if(!this._maskStack[this._maskStack.length-1])return!1;this._resultMask=this._maskStack[this._maskStack.length-1];for(var e=1,i=0;i<this._planeList.length;++i){if(this._resultMask&e){var r=n.intersectsOrContainsBoundingBox(this._planeList[i],t);if(r<1)return!1;this._resultMask^=e}e<<=1}return!0},transformProvidingInverse:function(t){if(this._maskStack[this._maskStack.length-1]){this._resultMask=this._maskStack[this._maskStack.length-1];for(var e=1,i=0;i<this._planeList.length;++i)this._resultMask&e&&(n.transformProvidingInverse(this._planeList[i],t),e<<=1)}}}),t.exports=o},function(t,e,i){"use strict";var r=i(6),n=i(15).vec4,a=i(15).vec3,s=r.objectInherit(n,{INSIDE:1,INTERSECT:2,OUTSIDE:3,transformProvidingInverse:function(){var t=s.create();return function(e,i){var r=e[0],n=e[1],a=e[2],o=e[3];return t[0]=i[0]*r+i[1]*n+i[2]*a+i[3]*o,t[1]=i[4]*r+i[5]*n+i[6]*a+i[7]*o,t[2]=i[8]*r+i[9]*n+i[10]*a+i[11]*o,t[3]=i[12]*r+i[13]*n+i[14]*a+i[15]*o,s.normalizeEquation(t),s.copy(t,e),e}},normalizeEquation:function(t){var e=1/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]*=e,t[1]*=e,t[2]*=e,t[3]*=e},getNormal:function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},setNormal:function(t,e){t[0]=e[0],t[1]=e[1],t[2]=e[2]},getDistance:function(t){return t[3]},setDistance:function(t,e){t[3]=e},distanceToPlane:function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]},intersectsOrContainsBoundingSphere:function(t,e){if(!e.valid())return s.OUTSIDE;var i=e.center(),r=e.radius(),n=this.distanceToPlane(t,i);return n<-r?s.OUTSIDE:n<=r?s.INTERSECT:s.INSIDE},instersectsBoundingSphere:function(t,e){return this.intersectsOrContainsBoundingSphere(t,e)===s.INTERSECT},intersectsOrContainsBoundingBox:function(){var t=a.create(),e=a.create(),i=a.create();return function(r,n,o){a.add(t,n.getMax(),n.getMin()),a.scale(t,t,.5),a.sub(t,n.getMax(),n.getMin()),a.scale(e,e,.5);var h=a.dot(t,r);o||(o=i,o[0]=Math.abs(r[0]),o[1]=Math.abs(r[1]),o[2]=Math.abs(r[2]));var u=a.dot(e,o);return h+u>0?s.INTERSECT:h-u>=0?s.INSIDE:s.OUTSIDE}},intersectsBoundingBox:function(t,e,i){return this.intersectsOrContainsBoundingBox(t,e,i)===s.INTERSECT},intersectOrContainsVertices:function(t,e){for(var i=-1,r=0;r<e.length;r++){var n=this.distanceToPlane(t,e[r]);if(n<0){if(1===i)return s.INTERSECT;i=2}else{if(!(n>0))return s.INTERSECT;if(2===i)return s.INTERSECT;i=1}}return i>0?s.INSIDE:s.OUTSIDE},intersectVertices:function(t,e){return this.intersectOrContainsVertices(t,e)===s.INTERSECT}});t.exports=s},function(t,e,i){"use strict";var r=i(6),n=i(28),a=i(52),s=i(34),o=i(53),h=i(56),u=i(15).mat4,c=i(58),l=i(33),d=i(11),f=i(35),p=i(15).vec3,_=function(){this._modelViewMatrixStack=[],this._projectionMatrixStack=[],this._viewportStack=[],this._cullingSetStack=[],this._frustumVolume=-1,this._bbCornerFar=0,this._bbCornerNear=0,this._reservedMatrixStack=new l,this._reserveCullingSetStack=[new h],this._reserveCullingSetStack.current=0,this._cameraIndexStack=[],this._cameraModelViewIndexStack=[],this._cameraMatrixInverse=[],this._cameraMatrixInverseRoot=void 0};_.prototype=r.objectInherit(o.prototype,{_getReservedCullingSet:function(){var t=this._reserveCullingSetStack[this._reserveCullingSetStack.current++];return this._reserveCullingSetStack.current===this._reserveCullingSetStack.length&&this._reserveCullingSetStack.push(new h),t},reset:function(){this._modelViewMatrixStack.length=0,this._projectionMatrixStack.length=0,this._cullingSetStack.length=0,this._reservedMatrixStack.reset(),this._reserveCullingSetStack.current=0,this._cameraModelViewIndexStack.length=0,this._cameraIndexStack.length=0,this._cameraMatrixInverse.length=0,this._cameraMatrixInverseRoot=void 0},getProjectionMatrixStack:function(){return this._projectionMatrixStack},getCurrentProjectionMatrix:function(){return this._projectionMatrixStack[this._projectionMatrixStack.length-1]},getCurrentModelViewMatrix:function(){return this._modelViewMatrixStack[this._modelViewMatrixStack.length-1]},getCameraInverseMatrix:function(){if(!this._cameraIndexStack.length)return this._cameraMatrixInverseRoot;var t=this._cameraIndexStack[this._cameraIndexStack.length-1],e=this.getNodePath()[t],i=e.getInstanceID();if(void 0===this._cameraMatrixInverse[i]){var r=this._cameraModelViewIndexStack[this._cameraModelViewIndexStack.length-1],n=this._modelViewMatrixStack[r],a=this._reservedMatrixStack.get();
u.invert(a,n),this._cameraMatrixInverse[i]=a}return this._cameraMatrixInverse[i]},getCurrentModelMatrix:function(){var t=this.getCameraInverseMatrix(),e=this._reservedMatrixStack.get(),i=u.mul(e,t,this.getCurrentModelViewMatrix());return i},getCurrentViewMatrix:function(){if(!this._cameraIndexStack.length)return this._modelViewMatrixStack[0];var t=this._cameraModelViewIndexStack[this._cameraModelViewIndexStack.length-1];return this._modelViewMatrixStack[t]},getViewport:function(){if(0!==this._viewportStack.length)return this._viewportStack[this._viewportStack.length-1]},getLookVectorLocal:function(t){var e=this.getCurrentModelViewMatrix();return p.set(t,-e[2],-e[6],-e[10])},pushViewport:function(t){this._viewportStack.push(t)},popViewport:function(){this._viewportStack.pop()},getFrustumPlanes:function(){var t=u.create();return function(e,i,r,n){u.mul(t,i,r);var a=!!n,s=e[0];s[0]=t[3]-t[0],s[1]=t[7]-t[4],s[2]=t[11]-t[8],s[3]=t[15]-t[12];var o=e[1];o[0]=t[3]+t[0],o[1]=t[7]+t[4],o[2]=t[11]+t[8],o[3]=t[15]+t[12];var h=e[2];h[0]=t[3]+t[1],h[1]=t[7]+t[5],h[2]=t[11]+t[9],h[3]=t[15]+t[13];var l=e[3];if(l[0]=t[3]-t[1],l[1]=t[7]-t[5],l[2]=t[11]-t[9],l[3]=t[15]-t[13],a){var d=e[4];d[0]=t[3]-t[2],d[1]=t[7]-t[6],d[2]=t[11]-t[10],d[3]=t[15]-t[14];var f=e[5];f[0]=t[3]+t[2],f[1]=t[7]+t[6],f[2]=t[11]+t[10],f[3]=t[15]+t[14]}for(var p=n?6:4,_=0;_<p;_++)c.normalizeEquation(e[_])}}(),pushCullingSet:function(){var t=this._getReservedCullingSet();this._enableFrustumCulling&&(u.getFrustumPlanes(t.getFrustum().getPlanes(),this.getCurrentProjectionMatrix(),this.getCurrentModelViewMatrix(),!1),t.getFrustum().setupMask(4)),this._cullingSetStack.push(t)},popCullingSet:function(){return this._cullingSetStack.pop()},getCurrentCullingSet:function(){return this._cullingSetStack[this._cullingSetStack.length-1]},pushCurrentMask:function(){var t=this.getCurrentCullingSet();t&&t.pushCurrentMask()},popCurrentMask:function(){var t=this.getCurrentCullingSet();t&&t.popCurrentMask()},isVerticesCulled:function(t){return!!this._enableFrustumCulling&&this.getCurrentCullingSet().isVerticesCulled(t)},isBoundingBoxCulled:function(t){return!!this._enableFrustumCulling&&(t.valid()&&this.getCurrentCullingSet().isBoundingBoxCulled(t))},isBoundingSphereCulled:function(t){return!!this._enableFrustumCulling&&(t.valid()&&this.getCurrentCullingSet().isBoundingSphereCulled(t))},isCulled:function(){var t=new n;return function(e,i){if(!this._enableFrustumCulling)return!1;if(e.isCullingActive()){if(0===this.getCurrentCullingSet().getCurrentResultMask())return!1;var r=this._reservedMatrixStack.get();return u.identity(r),r=e instanceof d?s.computeLocalToWorld(i.slice(0,i.length-1),!0,r):s.computeLocalToWorld(i,!0,r),e.getBound().transformMat4(t,r),this.getCurrentCullingSet().isBoundingSphereCulled(t)}return this.getCurrentCullingSet().resetCullingMask(),!1}}(),pushModelViewMatrix:function(){var t=p.create();return function(e){var i=this.getNodePath(),r=i.length;if(r){var n=r-1;i[n].getTypeID()===a.getTypeID()&&i[n].getReferenceFrame()===f.ABSOLUTE_RF&&(this._cameraIndexStack.push(n),this._cameraModelViewIndexStack.push(this._modelViewMatrixStack.length))}else{var s=this._reservedMatrixStack.get();u.invert(s,e),this._cameraMatrixInverseRoot=s}this._modelViewMatrixStack.push(e),this.getLookVectorLocal(t),this._bbCornerFar=(t[0]>=0?1:0)|(t[1]>=0?2:0)|(t[2]>=0?4:0),this._bbCornerNear=7&~this._bbCornerFar}}(),popModelViewMatrix:function(){var t=p.create();return function(){var e=this.getNodePath(),i=e.length-1;this._cameraIndexStack.length&&i===this._cameraIndexStack[this._cameraIndexStack.length-1]&&(this._cameraIndexStack.pop(),this._cameraModelViewIndexStack.pop()),this._modelViewMatrixStack.pop(),0!==this._modelViewMatrixStack.length?this.getLookVectorLocal(t):p.set(t,0,0,-1),this._bbCornerFar=(t[0]>=0?1:0)|(t[1]>=0?2:0)|(t[2]>=0?4:0),this._bbCornerNear=7&~this._bbCornerFar}}(),pushProjectionMatrix:function(t){this._projectionMatrixStack.push(t),this._frustumVolume=-1,this.pushCullingSet()},popProjectionMatrix:function(){this._projectionMatrixStack.pop(),this._frustumVolume=-1,this.popCullingSet()}}),t.exports=_},function(t,e,i){"use strict";var r=i(10),n=i(6),a=i(16),s=i(32),o=i(53),h=i(59),u=i(15).mat4,c=i(61),l=i(5),d=i(62),f=i(63),p=i(7),_=i(37),g=i(64),m=i(65),v=i(66),S=i(12),x=i(68),b=i(69),M=i(52),y=i(35),T=i(15).vec3,w=i(70),C=i(76),A=i(72),E=i(77),I=function(){s.call(this,s.TRAVERSE_ACTIVE_CHILDREN),o.call(this),h.call(this),this._rootStateGraph=void 0,this._currentStateGraph=void 0,this._currentRenderBin=void 0,this._currentRenderStage=void 0,this._rootRenderStage=void 0,this._computedNear=Number.POSITIVE_INFINITY,this._computedFar=Number.NEGATIVE_INFINITY;var t=T.fromValues(0,0,-1);this._camera=void 0,this._bbCornerFar=(t[0]>=0?1:0)|(t[1]>=0?2:0)|(t[2]>=0?4:0),this._bbCornerNear=7&~this._bbCornerFar,this._reserveLeafStack=[new g],this._reserveLeafStackCurrent=0,this._reserveRenderStageStacks={},this._reserveCullSettingsStack=[new o],this._reserveCullSettingsStackCurrent=0,this._renderBinStack=[],this.visitorType=s.CULL_VISITOR,this._identityMatrix=u.create(),this._renderer=void 0,this._renderStageType=v,this._numCamera=0,this._numMatrixTransform=0,this._numProjection=0,this._numNode=0,this._numLightSource=0,this._numGeometry=0};I.prototype=n.objectInherit(h.prototype,n.objectInherit(s.prototype,{distance:function(t,e){return-(t[0]*e[2]+t[1]*e[6]+t[2]*e[10]+e[14])},getComputedNear:function(){return this._computedNear},getComputedFar:function(){return this._computedFar},resetStats:function(){this._numCamera=0,this._numMatrixTransform=0,this._numProjection=0,this._numNode=0,this._numLightSource=0,this._numGeometry=0},handleCullCallbacksAndTraverse:function(t){var e=t.getCullCallback();e&&!e.cull(t,this)||this.traverse(t)},getCurrentCamera:function(){return this._currentRenderBin.getStage().getCamera()},updateCalculatedNearFar:function(){var t=T.create(),e=T.create();return function(i,r){var n,a,s=r.getBoundingBox();if(n=this.distance(s.corner(this._bbCornerNear,t),i),a=this.distance(s.corner(this._bbCornerFar,e),i),n>a){var o=n;n=a,a=o}return!(a<0)&&(n<this._computedNear&&(this._computedNear=n),a>this._computedFar&&(this._computedFar=a),!0)}}(),setStateGraph:function(t){this._rootStateGraph=t,this._currentStateGraph=t},setRenderStage:function(t){this._rootRenderStage=t,this._currentRenderBin=t},setRenderer:function(t){this._renderer=t},getRenderer:function(){return this._renderer},reset:function(){h.prototype.reset.call(this),this.resetRenderLeafStack(),this._reserveLeafStackCurrent=0,this.resetCullSettingsStack(),this._reserveCullSettingsStackCurrent=0;for(var t=window.Object.keys(this._reserveRenderStageStacks),e=0,i=t.length;e<i;e++){var r=t[e];this._reserveRenderStageStacks[r].reset()}m.resetStack(),this._computedNear=Number.POSITIVE_INFINITY,this._computedFar=Number.NEGATIVE_INFINITY},getCurrentRenderBin:function(){return this._currentRenderBin},setCurrentRenderBin:function(t){this._currentRenderBin=t},addPositionedAttribute:function(t,e){var i=t?t:this._identityMatrix;this._currentRenderBin.getStage().positionedAttribute.push([i,e])},pushStateSet:function(t){if(this._currentStateGraph=this._currentStateGraph.findOrInsert(t),void 0!==t.getBinName()){var e=this._renderBinStack,i=this._currentRenderBin;e.push(i),this._currentRenderBin=i.getStage().findOrInsert(t.getBinNumber(),t.getBinName())}},popStateSet:function(){var t=this._currentStateGraph,e=t.getStateSet();if(this._currentStateGraph=t.parent,void 0!==e.getBinName()){var i=this._renderBinStack;0===i.length?this._currentRenderBin=this._currentRenderBin.getStage():this._currentRenderBin=i.pop()}},popProjectionMatrix:function(){if(this._computeNearFar===!0&&this._computedFar>=this._computedNear){var t=this.getCurrentProjectionMatrix();void 0!==this._clampProjectionMatrixCallback?this._clampProjectionMatrixCallback(t,this._computedNear,this._computedFar,this._nearFarRatio):this.clampProjectionMatrix(t,this._computedNear,this._computedFar,this._nearFarRatio)}h.prototype.popProjectionMatrix.call(this)},clampProjectionMatrix:function(t,e,i,n,a){var s=1e-6;if(i<e-s)return r.log("clampProjectionMatrix not applied, invalid depth range, znear = "+e+"  zfar = "+i,!1,!0),!1;var o,h;if(i<e+s){var u=.5*(e+i);e=u-s,i=u+s}if(Math.abs(t[3])<s&&Math.abs(t[7])<s&&Math.abs(t[11])<s){var c=.02*(i-e);c<1&&(c=1),o=e-c,h=i+c,e=o,i=h,t[10]=-2/(h-o),t[14]=-(h+o)/(h-o)}else{var l=1.02,d=.98;o=e*d,h=i*l;var f=i*n;o<f&&(o=f),e=o,i=h;var p=t[10],_=t[14],g=t[11],m=t[15],v=(-o*p+_)/(-o*g+m),S=(-h*p+_)/(-h*g+m),x=Math.abs(2/(v-S)),b=-(v+S)/2,M=b*x;t[2]=t[2]*x+t[3]*M,t[6]=t[6]*x+t[7]*M,t[10]=p*x+g*M,t[14]=_*x+m*M}return void 0!==a&&(a[0]=e,a[1]=i),!0},popCameraModelViewProjectionMatrix:function(){this.popModelViewMatrix(),this.popProjectionMatrix()},pushCameraModelViewProjectionMatrix:function(t,e,i){this.pushModelViewMatrix(e),this.pushProjectionMatrix(i)},apply:function(t){this[t.typeID](t)},createOrReuseRenderStage:function(t){var e,i=t?t.className():"RenderStage",r=t?t.constructor:v;return this._reserveRenderStageStacks[i]?e=this._reserveRenderStageStacks[i]:(e=new p.OsgObjectMemoryStack(r),this._reserveRenderStageStacks[i]=e),e.get().init()},createOrReuseRenderLeaf:function(){var t=this._reserveLeafStack[this._reserveLeafStackCurrent++];return this._reserveLeafStackCurrent===this._reserveLeafStack.length&&this._reserveLeafStack.push(new g),t},resetRenderLeafStack:function(){for(var t=0,e=this._reserveLeafStackCurrent;t<=e;t++)this._reserveLeafStack[t].reset()},createOrReuseCullSettings:function(){var t=this._reserveCullSettingsStack[this._reserveCullSettingsStackCurrent++];return this._reserveCullSettingsStackCurrent===this._reserveCullSettingsStack.length&&this._reserveCullSettingsStack.push(new o),t},resetCullSettingsStack:function(){for(var t=0,e=this._reserveCullSettingsStackCurrent;t<=e;t++)this._reserveCullSettingsStack[t].reset()},postPushGeometry:function(t,e){var i,r;e instanceof C?(r=e.getStateSetAnimation(),r&&t.pushStateSet(r),i=e.getSourceGeometry(),i instanceof E&&(r=i.getStateSetAnimation(),r&&t.pushStateSet(r))):e instanceof E&&(r=e.getStateSetAnimation(),r&&t.pushStateSet(r))},prePopGeometry:function(t,e){if(e instanceof C){var i=e.getSourceGeometry();i instanceof E&&i.getStateSetAnimation()&&t.popStateSet(),e.getStateSetAnimation()&&t.popStateSet()}else e instanceof E&&e.getStateSetAnimation()&&t.popStateSet()},pushLeaf:function(t,e){var i=this._currentStateGraph.leafs;0===i.length&&this._currentRenderBin.addStateGraph(this._currentStateGraph);var r=this.createOrReuseRenderLeaf();r.init(this._currentStateGraph,t,this.getCurrentProjectionMatrix(),this.getCurrentViewMatrix(),this.getCurrentModelViewMatrix(),this.getCurrentModelMatrix(),e),i.push(r)}})),I.prototype[M.typeID]=function(t){this._numCamera++;var e=t.getStateSet();e&&this.pushStateSet(e);var i=this._reservedMatrixStack.get(),r=this._reservedMatrixStack.get();if(t.getReferenceFrame()===y.RELATIVE_RF){var n=this.getCurrentProjectionMatrix();u.mul(r,n,t.getProjectionMatrix());var a=this.getCurrentModelViewMatrix();u.mul(i,a,t.getViewMatrix())}else u.copy(i,t.getViewMatrix()),u.copy(r,t.getProjectionMatrix());var s=this._computedNear,o=this._computedFar,h=this.createOrReuseCullSettings();if(h.setCullSettings(this),this._computedNear=Number.POSITIVE_INFINITY,this._computedFar=Number.NEGATIVE_INFINITY,this.setCullSettings(t),h.getSettingSourceOverrider()===this&&h.getEnableFrustumCulling()&&this.setEnableFrustumCulling(!0),this.pushCameraModelViewProjectionMatrix(t,i,r),t.getViewport()&&this.pushViewport(t.getViewport()),t.getRenderOrder()===M.NESTED_RENDER)this.handleCullCallbacksAndTraverse(t);else{var c=this.getCurrentRenderBin(),l=c.getStage(),d=this.createOrReuseRenderStage(this._rootRenderStage);d.setCamera(t),d.setClearDepth(t.getClearDepth()),d.setClearColor(t.getClearColor()),d.setClearMask(t.getClearMask());var f;f=void 0===t.getViewport()?l.getViewport():t.getViewport(),d.setViewport(f),this.setCurrentRenderBin(d),this.handleCullCallbacksAndTraverse(t),this.setCurrentRenderBin(c),t.getRenderOrder()===M.PRE_RENDER?this.getCurrentRenderBin().getStage().addPreRenderStage(d,t.renderOrderNum):this.getCurrentRenderBin().getStage().addPostRenderStage(d,t.renderOrderNum)}this.popCameraModelViewProjectionMatrix(t),t.getViewport()&&this.popViewport(),this.setCullSettings(h),this._computedNear=s,this._computedFar=o,e&&this.popStateSet()},I.prototype[c.typeID]=function(t){if(this._numMatrixTransform++,!this.isCulled(t,this.nodePath)){this.pushCurrentMask();var e=this._reservedMatrixStack.get(),i=this.getCurrentModelViewMatrix();u.copy(e,i),t.computeLocalToWorldMatrix(e),this.pushModelViewMatrix(e);var r=t.getStateSet();r&&this.pushStateSet(r),this.handleCullCallbacksAndTraverse(t),r&&this.popStateSet(),this.popModelViewMatrix(),this.popCurrentMask()}},I.prototype[d.typeID]=function(t){this._numProjection++;var e=this.getCurrentProjectionMatrix(),i=this._reservedMatrixStack.get();u.mul(i,e,t.getProjectionMatrix()),this.pushProjectionMatrix(i);var r=t.getStateSet();r&&this.pushStateSet(r),this.handleCullCallbacksAndTraverse(t),r&&this.popStateSet(),this.popProjectionMatrix()},I.prototype[S.typeID]=function(t){if(this._numNode++,!this.isCulled(t,this.nodePath)){this.pushCurrentMask();var e=t.getStateSet();e&&this.pushStateSet(e),this.handleCullCallbacksAndTraverse(t),e&&this.popStateSet(),this.popCurrentMask()}},I.prototype[l.typeID]=I.prototype[c.typeID],I.prototype[x.typeID]=I.prototype[S.typeID],I.prototype[b.typeID]=I.prototype[S.typeID],I.prototype[f.typeID]=function(t){this._numLightSource++;var e=t.getStateSet();e&&this.pushStateSet(e);var i=t.getLight();i&&(t.getReferenceFrame()===y.RELATIVE_RF?this.addPositionedAttribute(this.getCurrentModelViewMatrix(),i):this.addPositionedAttribute(null,i)),this.handleCullCallbacksAndTraverse(t),e&&this.popStateSet()},I.prototype[_.typeID]=function(){var t=T.create(),e=!1;return function(i){this._numGeometry++;var n=this.getCurrentModelViewMatrix(),s=i.getBoundingBox();if(!this._computeNearFar||!s.valid()||this.updateCalculatedNearFar(n,i)){var o=i.getCullCallback();if(!o||o.cull(i,this)){var h=i.getStateSet();h&&this.pushStateSet(h),this.postPushGeometry(this,i);var u=0;s.valid()&&(u=this.distance(s.center(t),n)),a.isNaN(u)?e||(r.warn("warning geometry has a NaN depth, "+n+" center "+t),e=!0):this.pushLeaf(i,u),this.prePopGeometry(this,i),h&&this.popStateSet()}}}}(),I.prototype[w.typeID]=I.prototype[c.typeID],I.prototype[C.typeID]=I.prototype[_.typeID],I.prototype[E.typeID]=I.prototype[_.typeID],I.prototype[A.typeID]=I.prototype[c.typeID],t.exports=I},function(t,e,i){"use strict";var r=i(6),n=i(15).mat4,a=i(11),s=i(35),o=function(){a.call(this),this.matrix=n.create()};o.prototype=r.objectLibraryClass(r.objectInherit(a.prototype,{getMatrix:function(){return this.matrix},setMatrix:function(t){this.matrix=t,this.dirtyBound()},computeLocalToWorldMatrix:function(t){return this.referenceFrame===s.RELATIVE_RF?n.mul(t,t,this.matrix):n.copy(t,this.matrix),!0},computeWorldToLocalMatrix:function(){var t=n.create();return function(e){return n.invert(t,this.matrix),this.referenceFrame===s.RELATIVE_RF?n.mul(e,t,e):n.copy(e,t),!0}}()}),"osg","MatrixTransform"),r.setTypeID(o),t.exports=o},function(t,e,i){"use strict";var r=i(6),n=i(12),a=i(15).mat4,s=function(){n.call(this),this.projection=a.create()};s.prototype=r.objectInherit(n.prototype,{getProjectionMatrix:function(){return this.projection},setProjectionMatrix:function(t){this.projection=t}}),r.setTypeID(s),t.exports=s},function(t,e,i){"use strict";var r=i(6),n=i(12),a=i(35),s=i(15).vec3,o=function(){n.call(this),this._light=void 0,this._referenceFrame=a.RELATIVE_RF};o.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{getLight:function(){return this._light},setLight:function(t){this._light=t},setReferenceFrame:function(t){this._referenceFrame=t},getReferenceFrame:function(){return this._referenceFrame},computeBoundingSphere:function(){var t=s.create();return function(e){if(n.prototype.computeBoundingSphere.call(this,e),void 0!==this._light&&this._referenceFrame===a.RELATIVE_RF){var i=this._light.getPosition();0!==i[3]&&e.expandByvec3(s.scale(t,i,1/i[3]))}return e}}()}),"osg","LightSource"),r.setTypeID(o),t.exports=o},function(t,e,i){"use strict";var r=i(8),n=function(t,e){this.modelUniform=e._uniformsCache[t.modelMatrix.getName()],this.viewUniform=e._uniformsCache[t.viewMatrix.getName()],this.apply=void 0,this.generateUniformsApplyMethods()};n.prototype={generateUniformsApplyMethods:function(){var t=["//generated by RenderLeaf\n"];t.push("var gl = state.getGraphicContext();"),t.push("var matrixModelViewChanged = state.applyModelViewMatrix( modelview );"),t.push("state.applyProjectionMatrix( projection );"),void 0!==this.modelUniform&&(t.push("if ( matrixModelViewChanged ) {"),t.push("    var modelMatrix = state.modelMatrix;"),t.push("    modelMatrix.setMatrix4( model );"),t.push("    modelMatrix.apply( gl, this.modelUniform);"),t.push("};")),void 0!==this.viewUniform&&(t.push("if ( matrixModelViewChanged ) {"),t.push("    var viewMatrix = state.viewMatrix;"),t.push("    viewMatrix.setMatrix4( view );"),t.push("    viewMatrix.apply( gl, this.viewUniform);"),t.push("};"));var e=new Function("state","modelview","model","view","projection","return function RenderLeafApplyMatrixUniformCache( state, modelview, model, view, projection ) { "+t.join("\n")+"}")();this.apply=e}};var a=function(){this._parent=void 0,this._geometry=void 0,this._depth=0,this._projection=void 0,this._view=void 0,this._model=void 0,this._modelView=void 0};a.prototype={reset:function(){this._parent=void 0,this._geometry=void 0,this._depth=0,this._projection=void 0,this._view=void 0,this._model=void 0,this._modelView=void 0},init:function(t,e,i,r,n,a,s){this._parent=t,this._geometry=e,this._depth=s,this._projection=i,this._view=r,this._model=a,this._modelView=n},drawGeometry:function(){return function(t){var e=t.getLastProgramApplied(),i=e.getInstanceID(),r=t.getCacheUniformsApplyRenderLeaf(),a=r[i];a||(a=new n(t,e),r[i]=a),a.apply(t,this._modelView,this._model,this._view,this._projection,this._normal),this._geometry.drawImplementation(t)}}(),render:function(){var t=0,e=-1;return function(i,n){var a,s,o=this._parent,h=o.parent,u=o.stateset;void 0!==n?(a=n._parent,s=a.parent,s!==h?(r.moveStateGraph(i,s,h),i.applyStateSet(u)):o!==a?i.applyStateSet(u):i._stateSetStackChanged(t,e)&&i.applyStateSet(u)):(r.moveStateGraph(i,void 0,h),i.applyStateSet(u)),i._setStateSetsDrawID(++t),e=i.getStateSetStackSize(),this.drawGeometry(i)}}()},t.exports=a},function(t,e,i){"use strict";var r=i(6),n=i(10),a=i(13),s=i(16),o=function(t){a.call(this),this._leafs=[],this.positionedAttribute=[],this.stateGraphList=[],o.prototype.init.call(this,t)};o.SORT_BY_STATE=0,o.SORT_BACK_TO_FRONT=1,o.SORT_FRONT_TO_BACK=2,o.defaultSortMode=o.SORT_BY_STATE,o.BinPrototypes={RenderBin:function(){return o.getOrCreate().init()},DepthSortedBin:function(){return o.getOrCreate().init(o.SORT_BACK_TO_FRONT)}};var h=function(t,e){return e._depth-t._depth},u=function(t,e){return t._depth-e._depth},c=function(t,e){return t._binNum-e._binNum};o.prototype=r.objectLibraryClass(r.objectInherit(a.prototype,{init:function(t){return this._leafs.length=0,this.positionedAttribute.length=0,this._renderStage=void 0,this._bins={},this.stateGraphList.length=0,this._parent=void 0,this._binNum=0,this._sorted=!1,this._sortMode=void 0!==t?t:o.defaultSortMode,this._drawCallback=void 0,this},_createRenderBin:function(t){var e=o.BinPrototypes.RenderBin;return t&&o.BinPrototypes[t]&&(e=o.BinPrototypes[t]),e()},getStateGraphList:function(){return this.stateGraphList},copyLeavesFromStateGraphListToRenderLeafList:function(){this._leafs.splice(0,this._leafs.length);for(var t=!1,e=0,i=this.stateGraphList.length;e<i;e++)for(var r=this.stateGraphList[e].leafs,a=0,o=r.length;a<o;a++){var h=r[a];s.isNaN(h._depth)?t=!0:this._leafs.push(h)}t&&n.debug("warning: RenderBin::copyLeavesFromStateGraphListToRenderLeafList() detected NaN depth values, database may be corrupted."),this.stateGraphList.splice(0,this.stateGraphList.length)},getSortMode:function(){return this._sortMode},sortBackToFront:function(){this.copyLeavesFromStateGraphListToRenderLeafList(),this._leafs.sort(h)},sortFrontToBack:function(){this.copyLeavesFromStateGraphListToRenderLeafList(),this._leafs.sort(u)},sortImplementation:function(){var t=o;switch(this._sortMode){case t.SORT_BACK_TO_FRONT:this.sortBackToFront();break;case t.SORT_FRONT_TO_BACK:this.sortFrontToBack();break;case t.SORT_BY_STATE:}},sort:function(){if(!this._sorted){for(var t=this._bins,e=window.Object.keys(t),i=0,r=e.length;i<r;i++)t[e[i]].sort();this.sortImplementation(),this._sorted=!0}},setParent:function(t){this._parent=t},getParent:function(){return this._parent},getBinNumber:function(){return this._binNum},findOrInsert:function(t,e){var i=this._bins[t];return i||(i=this._createRenderBin(e),i._parent=this,i._binNum=t,i._renderStage=this._renderStage,this._bins[t]=i),i},getStage:function(){return this._renderStage},addStateGraph:function(t){this.stateGraphList.push(t)},reset:function(){this.stateGraphList.length=0,this._bins={},this.positionedAttribute.length=0,this._leafs.length=0,this._sorted=!1},draw:function(t,e){var i=e;return i=this._drawCallback&&this._drawCallback.drawImplementation?this._drawCallback.drawImplementation(this,t,i):this.drawImplementation(t,i)},applyPositionedAttribute:function(t,e){for(var i=0,r=e.length;i<r;i++){var n=e[i],a=n[1],s=n[0];t.setGlobalDefaultAttribute(a),a.apply(t),a.applyPositionedUniform(s,t),t.haveAppliedAttribute(a)}},drawImplementation:function(t,e){for(var i=e,r=window.Object.keys(this._bins),n=this._bins,a=[],s=0,o=r.length;s<o;s++){var h=r[s];a.push(n[h])}a.sort(c);for(var u,l=0,d=a.length;l<d&&(u=a[l],!(u.getBinNumber()>0));l++)i=u.draw(t,i);for(i=this.drawLeafs(t,i);l<d;l++)u=a[l],i=u.draw(t,i);return i},drawLeafs:function(t,e){for(var i,r=this.stateGraphList,n=this._leafs,a=e,s=0,o=n.length;s<o;s++)i=n[s],i.render(t,a),a=i;for(var h=0,u=r.length;h<u;h++)for(var c=r[h],l=0,d=c.leafs.length;l<d;l++)i=c.leafs[l],i.render(t,a),a=i;return a}}),"osg","RenderBin"),o.getOrCreate=function(){var t=o._reservedStack[o._reservedStackCurrent++];return o._reservedStackCurrent===o._reservedStack.length&&o._reservedStack.push(new o),t},o.resetStack=function(){o._reservedStackCurrent=0},o._reservedStack=[new o],o._reservedStackCurrent=0,t.exports=o},function(t,e,i){"use strict";var r=i(6),n=i(52),a=i(67),s=i(10),o=i(65),h=i(15).vec4,u=function(){o.call(this),this.clearColor=h.create(),this.preRenderList=[],this.postRenderList=[],u.prototype.init.call(this)};u.prototype=r.objectLibraryClass(r.objectInherit(o.prototype,{constructor:u,init:function(){return o.prototype.init.call(this),this.positionedAttribute.length=0,this.clearDepth=1,h.set(this.clearColor,0,0,0,1),this.clearMask=n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT,this.camera=void 0,this.viewport=void 0,this.preRenderList.length=0,this.postRenderList.length=0,this._renderStage=this,this},reset:function(){o.prototype.reset.call(this),this.preRenderList.length=0,this.postRenderList.length=0},setClearDepth:function(t){this.clearDepth=t},getClearDepth:function(){return this.clearDepth},setClearColor:function(t){h.copy(this.clearColor,t)},getClearColor:function(){return this.clearColor},setClearMask:function(t){this.clearMask=t},getClearMask:function(){return this.clearMask},setViewport:function(t){this.viewport=t},getViewport:function(){return this.viewport},setCamera:function(t){this.camera=t},getCamera:function(){return this.camera},getPositionedAttribute:function(){return this.positionedAttribute},getPreRenderStageList:function(){return this.preRenderList},getPostRenderStageList:function(){return this.postRenderList},addPreRenderStage:function(t,e){for(var i=0,r=this.preRenderList.length;i<r;i++){var n=this.preRenderList[i];if(e<n.order)break}i<this.preRenderList.length?this.preRenderList=this.preRenderList.splice(i,0,{order:e,renderStage:t}):this.preRenderList.push({order:e,renderStage:t})},addPostRenderStage:function(t,e){for(var i=0,r=this.postRenderList.length;i<r;i++){var n=this.postRenderList[i];if(e<n.order)break}i<this.postRenderList.length?this.postRenderList=this.postRenderList.splice(i,0,{order:e,renderStage:t}):this.postRenderList.push({order:e,renderStage:t})},drawPreRenderStages:function(t,e){for(var i=e,r=0,n=this.preRenderList.length;r<n;++r){var a=this.preRenderList[r].renderStage;i=a.draw(t,i)}return i},draw:function(t,e){this.camera&&this.camera.getInitialDrawCallback()&&this.camera.getInitialDrawCallback()(t);var i=this.drawPreRenderStages(t,e);return i=this.drawImplementation(t,i),i=this.drawPostRenderStages(t,i),this.camera&&this.camera.getFinalDrawCallback()&&this.camera.getFinalDrawCallback()(t),i},sort:function(){for(var t=0,e=this.preRenderList.length;t<e;++t)this.preRenderList[t].renderStage.sort();o.prototype.sort.call(this);for(var i=0,r=this.postRenderList.length;i<r;++i)this.postRenderList[i].renderStage.sort()},drawPostRenderStages:function(t,e){for(var i=e,r=0,n=this.postRenderList.length;r<n;++r){var a=this.postRenderList[r].renderStage;i=a.draw(t,i)}return i},applyCamera:function(t){var e=t.getGraphicContext();if(void 0===this.camera)return void e.bindFramebuffer(e.FRAMEBUFFER,null);var i=this.camera.getViewport(),r=this.camera.frameBufferObject;if(r||(r=new a,this.camera.frameBufferObject=r),r.isDirty()){var n,s,o=this.camera.getAttachments(),h=o[a.COLOR_ATTACHMENT0];h&&h.texture&&(n=h.texture.getWidth(),s=h.texture.getHeight());var u=window.Object.keys(o);if(u.length)for(var c=0,l=u.length;c<l;c++){var d=u[c],f=o[d],p={};p.attachment=f.attachment,void 0===f.texture?(p.format=f.format,p.width=void 0!==n?n:i.width(),p.height=void 0!==s?s:i.height()):void 0!==f.texture&&(p.texture=f.texture,p.textureTarget=f.textureTarget,f.format&&(p.format=f.format)),r.setAttachment(p)}}r.apply(t)},drawImplementation:function(t,e){var i=t.getGraphicContext();if(this.applyCamera(t),void 0===this.viewport&&s.log("RenderStage does not have a valid viewport"),t.applyAttribute(this.viewport),this.camera){var r=this.camera.getStateSet()&&this.camera.getStateSet().getAttribute("Scissor");r&&t.applyAttribute(r)}0!==this.clearMask&&(this.clearMask&i.COLOR_BUFFER_BIT&&i.clearColor(this.clearColor[0],this.clearColor[1],this.clearColor[2],this.clearColor[3]),this.clearMask&i.DEPTH_BUFFER_BIT&&(i.depthMask(!0),i.clearDepth(this.clearDepth)),i.clear(this.clearMask)),0!==this.positionedAttribute.length&&this.applyPositionedAttribute(t,this.positionedAttribute);var n=o.prototype.drawImplementation.call(this,t,e);return n}}),"osg","RenderStage"),t.exports=u},function(t,e,i){"use strict";var r=i(10),n=i(6),a=i(43),s=i(31),o=i(9),h=i(38),u=function(){a.call(this),s.call(this),this._fbo=void 0,this._rbo=void 0,this._attachments=[],this._dirty=!0};u.COLOR_ATTACHMENT0=36064,u.DEPTH_ATTACHMENT=36096,u.DEPTH_COMPONENT16=33189,u._sDeletedGLFrameBufferCache=new window.Map,u.deleteGLFrameBuffer=function(t,e){u._sDeletedGLFrameBufferCache.has(t)||u._sDeletedGLFrameBufferCache.set(t,[]),u._sDeletedGLFrameBufferCache.get(t).push(e)},u.flushDeletedGLFrameBuffers=function(t,e){if(e<=0)return e;if(!u._sDeletedGLFrameBufferCache.has(t))return e;for(var i=0,r=o.instance().tick(),n=u._sDeletedGLFrameBufferCache.get(t),a=n.length,s=a-1;s>=0&&i<e;s--)t.deleteFramebuffer(n[s]),n.splice(s,1),i=o.instance().deltaS(r,o.instance().tick());return e-i},u.flushAllDeletedGLFrameBuffers=function(t){if(u._sDeletedGLFrameBufferCache.has(t))for(var e=u._sDeletedGLFrameBufferCache.get(t),i=e.length,r=i-1;r>=0;r--)t.deleteFramebuffer(e[r]),e.splice(r,1)},u._sDeletedGLRenderBufferCache=new window.Map,u.deleteGLRenderBuffer=function(t,e){u._sDeletedGLRenderBufferCache.has(t)||u._sDeletedGLRenderBufferCache.set(t,[]),u._sDeletedGLRenderBufferCache.get(t).push(e)},u.flushDeletedGLRenderBuffers=function(t,e){if(e<=0)return e;if(!u._sDeletedGLRenderBufferCache.has(t))return e;for(var i=0,r=o.instance().tick(),n=u._sDeletedGLRenderBufferCache.get(t),a=n.length,s=a-1;s>=0&&i<e;s--)t.deleteRenderbuffer(n[s]),n.splice(s,1),i=o.instance().deltaS(r,o.instance().tick());return e-i},u.flushAllDeletedGLRenderBuffers=function(t){if(u._sDeletedGLRenderBufferCache.has(t))for(var e=u._sDeletedGLRenderBufferCache.get(t),i=e.length,r=i-1;r>=0;r--)t.deleteRenderbuffer(e[r]),e.splice(r,1)},u.prototype=n.objectInherit(a.prototype,n.objectInherit(s.prototype,{attributeType:"FrameBufferObject",cloneType:function(){return new u},dirty:function(){this._dirty=!0},isDirty:function(){return this._dirty},setAttachment:function(t){this._attachments.push(t)},releaseGLObjects:function(){void 0!==this._fbo&&void 0!==this._gl&&u.deleteGLFrameBuffer(this._gl,this._fbo),this._fbo=void 0,void 0!==this._rbo&&void 0!==this._gl&&u.deleteGLRenderBuffer(this._gl,this._rbo),this._rbo=void 0},_reportFrameBufferError:function(t){switch(t){case 36054:r.debug("FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case 36055:r.debug("FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case 36057:r.debug("FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case 36061:r.debug("FRAMEBUFFER_UNSUPPORTED");break;default:r.debug("FRAMEBUFFER unknown error "+t.toString(16))}},reset:function(){this.releaseGLObjects(),this._attachments=[]},getFrameBufferObject:function(){return this._fbo},createFrameBufferObject:function(t){this.setGraphicContext(t.getGraphicContext()),this._fbo=this._gl.createFramebuffer()},createRenderBuffer:function(t,e,i){var r=this._gl,n=r.createRenderbuffer();return r.bindRenderbuffer(r.RENDERBUFFER,n),r.renderbufferStorage(r.RENDERBUFFER,t,e,i),n},framebufferRenderBuffer:function(t,e){var i=this._gl;i.bindRenderbuffer(i.RENDERBUFFER,e),i.framebufferRenderbuffer(i.FRAMEBUFFER,t,i.RENDERBUFFER,e),void 0!==i.rawgl&&r.log("FBO: renderBuffer: "+this._fbo.trackedObject.defaultName)},framebufferTexture2D:function(t,e,i,n){var a=this._gl;return t.applyTextureAttribute(1,n),!(n.isDirty()||!n.getTextureObject())&&(a.framebufferTexture2D(a.FRAMEBUFFER,e,i,n.getTextureObject().id(),0),void 0!==a.rawgl&&r.log("FBO: texture: "+n.getName()+" : "+n.getTextureObject().id().trackedObject.defaultName+" fbo: "+this._fbo.trackedObject.defaultName),!0)},bindFrameBufferObject:function(){var t=this._gl;t.bindFramebuffer(t.FRAMEBUFFER,this._fbo)},checkStatus:function(){var t=this._gl,e=t.checkFramebufferStatus(t.FRAMEBUFFER);36053!==e&&this._reportFrameBufferError(e)},_checkAllowedSize:function(t,e){var i=h.instance().getWebGLParameter("MAX_RENDERBUFFER_SIZE");return!(0===t||0===e||e>i||t>i)||(r.error("width ("+t+") or height ("+t+') makes frame buffer not bindable. Max RenderBuffer is "'+i+'"'),!1)},apply:function(t){this._gl||this.setGraphicContext(t.getGraphicContext());var e=this._gl,i=this._attachments;if(i.length>0||this._fbo)if(this.isDirty()){this._fbo||this.createFrameBufferObject(t),this.bindFrameBufferObject();for(var n=!1,a=0,s=i.length;a<s;++a){var o=i[a];if(o.texture){var h=o.texture;if(!this._checkAllowedSize(h.getWidth(),h.getHeight()))return void this.releaseGLObjects();if(!this.framebufferTexture2D(t,o.attachment,o.textureTarget,h))return void this.releaseGLObjects()}else{if(!this._checkAllowedSize(o.width,o.height))return void this.releaseGLObjects();this._rbo=this.createRenderBuffer(o.format,o.width,o.height),this.framebufferRenderBuffer(o.attachment,this._rbo),n=!0}}this.checkStatus(),n&&e.bindRenderbuffer(e.RENDERBUFFER,null),this._dirty=!1}else e.bindFramebuffer(e.FRAMEBUFFER,this._fbo),r.reportWebGLError===!0&&this.checkStatus();else e.bindFramebuffer(e.FRAMEBUFFER,null)}})),t.exports=u},function(t,e,i){"use strict";var r=i(6),n=i(12),a=i(32),s=i(15).mat4,o=i(15).vec2,h=i(15).vec3,u=i(28),c=function(){n.call(this),this._radius=-1,this._range=[],this._rangeMode=c.DISTANCE_FROM_EYE_POINT,this._userDefinedCenter=[],this._centerMode=c.USE_BOUNDING_SPHERE_CENTER};c.DISTANCE_FROM_EYE_POINT=0,c.PIXEL_SIZE_ON_SCREEN=1,c.USE_BOUNDING_SPHERE_CENTER=0,
c.USER_DEFINED_CENTER=1,c.UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED=2,c.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{getRadius:function(){return this._radius},setRadius:function(t){this._radius=t},setCenter:function(t){this._centerMode!==c.UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED&&(this._centerMode=c.USER_DEFINED_CENTER),this._userDefinedCenter=t},getCenter:function(){return this._centerMode===c.USER_DEFINED_CENTER||this._centerMode===c.UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED?this._userDefinedCenter:this.getBound().center()},setCenterMode:function(t){this._centerMode=t},computeBoundingSphere:function(t){if(this._centerMode===c.USER_DEFINED_CENTER&&this._radius>=0)return t.set(this._userDefinedCenter,this._radius),t;if(this._centerMode===c.UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED&&this._radius>=0){t.set(this._userDefinedCenter,this._radius);var e=new u;return t.expandByBoundingSphere(n.prototype.computeBoundingSphere.call(this,e)),t}return n.prototype.computeBoundingSphere.call(this,t),t},projectBoundingSphere:function(){var t=h.create();return function(e,i,r){h.transformMat4(t,e.center(),i);var n=e.radius2(),a=t[2]*t[2],s=h.sqrLen(t),o=-Math.PI*r*r*n*Math.sqrt(Math.abs((s-n)/(n-a)))/(n-a);return o}}(),setRangeMode:function(t){this._rangeMode=t},addChildNode:function(t){if(n.prototype.addChild.call(this,t),this.children.length>this._range.length){var e=[],i=0;this._range.lenght>0&&(i=this._range[this._range.length-1][1]),e.push(o.fromValues(i,i)),this._range.push(e)}return!0},addChild:function(t,e,i){if(n.prototype.addChild.call(this,t),this.children.length>this._range.length){var r=[];r.push(o.fromValues(e,e)),this._range.push(r)}return this._range[this.children.length-1][0]=e,this._range[this.children.length-1][1]=i,!0},traverse:function(){var t=h.create(),e=h.create(),i=s.create();return function(r){var n=r.traversalMode;switch(n){case a.TRAVERSE_ALL_CHILDREN:for(var o=0;o<this.children.length;o++)this.children[o].accept(r);break;case a.TRAVERSE_ACTIVE_CHILDREN:var u=0,l=r.getCurrentModelViewMatrix();if(s.invert(i,l),this._rangeMode===c.DISTANCE_FROM_EYE_POINT){h.transformMat4(e,t,i);var d=h.distance(this.getBound().center(),e);u=d*r.getLODScale()}else{var f=r.getCurrentProjectionMatrix();u=this.projectBoundingSphere(this.getBound(),l,f[0]),u=u*r.getViewport().width()*r.getViewport().width()*.25/r.getLODScale()}var p=this.children.length;this._range.length<p&&(p=this._range.length);for(var _=0;_<p;++_)this._range[_][0]<=u&&u<this._range[_][1]&&this.children[_].accept(r)}}}()}),"osg","Lod"),r.setTypeID(c),t.exports=c},function(t,e,i){"use strict";var r=i(6),n=i(68),a=i(32),s=i(15).mat4,o=i(15).vec3,h=function(){n.call(this),this._perRangeDataList=[],this._loading=!1,this._expiryTime=0,this._expiryFrame=0,this._centerMode=n.USER_DEFINED_CENTER,this._frameNumberOfLastTraversal=0,this._databasePath="",this._numChildrenThatCannotBeExpired=0},u=function(){this.filename="",this.function=void 0,this.loaded=!1,this.timeStamp=0,this.frameNumber=0,this.frameNumberOfLastTraversal=0,this.dbrequest=void 0};h.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{setRange:function(t,e,i){if(t>=this._range.length){var r=[];r.push([e,e]),this._range.push(r)}this._range[t][0]=e,this._range[t][1]=i},setExpiryTime:function(t){this._expiryTime=t},setDatabasePath:function(t){this._databasePath=t},getDatabasePath:function(){return this._databasePath},setFileName:function(t,e){if(t>=this._perRangeDataList.length){var i=new u;i.filename=e,this._perRangeDataList.push(i)}else this._perRangeDataList[t].filename=e},setFunction:function(t,e){if(t>=this._perRangeDataList.length){var i=new u;i.function=e,this._perRangeDataList.push(i)}else this._perRangeDataList[t].function=e},addChild:function(t,e,i){n.prototype.addChild.call(this,t,e,i),this._perRangeDataList.push(new u)},addChildNode:function(t){n.prototype.addChildNode.call(this,t)},setFrameNumberOfLastTraversal:function(t){this._frameNumberOfLastTraversal=t},getFrameNumberOfLastTraversal:function(){return this._frameNumberOfLastTraversal},setTimeStamp:function(t,e){this._perRangeDataList[t].timeStamp=e},setFrameNumber:function(t,e){this._perRangeDataList[t].frameNumber=e},setNumChildrenThatCannotBeExpired:function(t){this._numChildrenThatCannotBeExpired=t},getNumChildrenThatCannotBeExpired:function(){return this._numChildrenThatCannotBeExpired},getDatabaseRequest:function(t){return this._perRangeDataList[t].dbrequest},removeExpiredChildren:function(t,e,i){if(!(this.children.length<=this._numChildrenThatCannotBeExpired)){var r,n,a=this.children.length-1;r=this._perRangeDataList[a].timeStamp+this._expiryTime,n=this._perRangeDataList[a].frameNumber+this._expiryFrame,r<t&&n<e&&(this._perRangeDataList[a].filename.length>0||void 0!==this._perRangeDataList[a].function)&&(i.push(this.children[a]),this.removeChild(this.children[a]),this._perRangeDataList[a].loaded=!1,void 0!==this._perRangeDataList[a].dbrequest&&(this._perRangeDataList[a].dbrequest._groupExpired=!0))}},traverse:function(){var t=o.create(),e=o.create(),i=s.create();return function(r){var h=r.traversalMode,u=!1;switch(r.getVisitorType()===a.CULL_VISITOR&&(this._frameNumberOfLastTraversal=r.getFrameStamp().getFrameNumber(),u=!0),h){case a.TRAVERSE_ALL_CHILDREN:for(var c=0;c<this.children.length;c++)this.children[c].accept(r);break;case a.TRAVERSE_ACTIVE_CHILDREN:var l=0,d=r.getCurrentModelViewMatrix();if(s.invert(i,d),this._rangeMode===n.DISTANCE_FROM_EYE_POINT){o.transformMat4(e,t,i);var f=o.distance(this.getBound().center(),e);l=f*r.getLODScale()}else{var p=r.getCurrentProjectionMatrix();l=this.projectBoundingSphere(this.getBound(),d,p[0]),l=l*r.getViewport().width()*r.getViewport().width()*.25/r.getLODScale(),l<0&&(l=this._range[this._range.length-1][0])}for(var _=!1,g=-1,m=0;m<this._range.length;++m)this._range[m][0]<=l&&l<this._range[m][1]&&(m<this.children.length?(u&&(this._perRangeDataList[m].timeStamp=r.getFrameStamp().getSimulationTime(),this._perRangeDataList[m].frameNumber=r.getFrameStamp().getFrameNumber()),this.children[m].accept(r),g=m):_=!0);if(_){var v=this.children.length;if(v>0&&v-1!==g&&(u&&(this._perRangeDataList[v-1].timeStamp=r.getFrameStamp().getSimulationTime(),this._perRangeDataList[v-1].frameNumber=r.getFrameStamp().getFrameNumber()),this.children[v-1].accept(r)),v<this._perRangeDataList.length){var S=(this._range[v][0]-l)/(this._range[v][1]-this._range[v][0]);this._rangeMode===n.PIXEL_SIZE_ON_SCREEN&&(S=-S);var x=r.nodePath[r.nodePath.length-1];if(this._perRangeDataList[v].loaded===!1){this._perRangeDataList[v].loaded=!0;var b=r.getDatabaseRequestHandler();this._perRangeDataList[v].dbrequest=b.requestNodeFile(this._perRangeDataList[v].function,this._databasePath+this._perRangeDataList[v].filename,x,r.getFrameStamp().getSimulationTime(),S)}else void 0!==this._perRangeDataList[v].dbrequest?(this._perRangeDataList[v].dbrequest._timeStamp=r.getFrameStamp().getSimulationTime(),this._perRangeDataList[v].dbrequest._priority=S):this._perRangeDataList[v].loaded=!1}}}}}()}),"osg","PagedLOD"),r.setTypeID(h),t.exports=h},function(t,e,i){"use strict";var r=i(6),n=i(61),a=i(71),s=i(32),o=i(74),h=i(72),u=function(){s.call(this,s.TRAVERSE_ALL_CHILDREN)};u.prototype=r.objectInherit(s.prototype,{apply:function(t){if(t.getTypeID()===h.getTypeID()){var e=t.getUpdateCallback();if(e instanceof o){for(var i=e._stackedTransforms,r=0,n=i.length;r<n;r++){var a=i[r];a.resetToDefaultValue()}e.computeChannels()}}this.traverse(t)}});var c=new u,l=function(){n.call(this)};l.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{setDefaultUpdateCallback:function(){this.addUpdateCallback(new a)},setRestPose:function(){this.accept(c)}}),"osgAnimation","Skeleton"),r.setTypeID(l),t.exports=l},function(t,e,i){"use strict";var r=i(6),n=i(72),a=i(32),s=i(10),o=i(13),h=function(){a.call(this)};h.prototype=r.objectInherit(a.prototype,{apply:function(t){if(t.getTypeID()===n.getTypeID()){for(var e=!1,i=t.getChildren(),r=0,a=t.getChildren().length;r<a;r++){var o=i[r];if(o.getTypeID()===n.getTypeID()){if(e)return void s.warn("Warning: a Bone was found after a non-Bone child within a Skeleton. Children of a Bone must be ordered with all child Bones first for correct update order.")}else e=!0}this.traverse(t)}}});var u=function(t,e){var i=t instanceof n?0:1,r=e instanceof n?0:1;return i-r},c=function(){this._needValidate=!0};c.prototype=r.objectInherit(o.prototype,{needToValidate:function(){return this._needValidate},update:function(t,e){if(this._needValidate&&e.getVisitorType()===a.UPDATE_VISITOR&&t.className&&"Skeleton"===t.className()){for(var i=new h,r=t.getChildren(),n=0,s=r.length;n<s;n++){var o=r[n];o.accept(i)}r.sort(u),this._needValidate=!1}return!0}}),t.exports=c},function(t,e,i){"use strict";var r=i(6),n=i(15).vec3,a=i(14),s=i(15).mat4,o=i(61),h=i(73),u=function(t){void 0!==t&&this.setName(t),o.call(this),this._invBindInSkeletonSpace=s.create(),this._boneInSkeletonSpace=s.create(),this._boneBoundingBox=new a};u.prototype=r.objectLibraryClass(r.objectInherit(o.prototype,{getOrCreateDebugColor:function(){return this._boneColor?this._boneColor:(this._boneColor=n.fromValues(Math.random(),Math.random(),Math.random()),this._boneColor)},getBoneBoundingBox:function(){return this._boneBoundingBox},setBoneBoundingBox:function(t){this._boneBoundingBox=t},getMatrixInSkeletonSpace:function(){return this._boneInSkeletonSpace},getInvBindMatrixInSkeletonSpace:function(){return this._invBindInSkeletonSpace},setMatrixInSkeletonSpace:function(t){s.copy(this._boneInSkeletonSpace,t)},setInvBindMatrixInSkeletonSpace:function(t){s.copy(this._invBindInSkeletonSpace,t)},getBoneParent:function(){for(var t=this.getParents(),e=0,i=t.length;e<i;e++){var r=t[e].getTypeID();if(r===u.getTypeID())return t[e]}},setDefaultUpdateCallback:function(t){this.addUpdateCallback(new h(void 0!==t?t:this.getName()))}}),"osgAnimation","Bone"),r.setTypeID(u),t.exports=u},function(t,e,i){"use strict";var r=i(6),n=i(10),a=i(74),s=i(15).mat4,o=i(32),h=function(){a.call(this)};h.prototype=r.objectInherit(a.prototype,{update:function(t,e){if(e.getVisitorType()===o.UPDATE_VISITOR){if(t.className&&"Bone"!==t.className())return n.warn("Warning: UpdateBone set on non-Bone object."),!1;var i=t;a.prototype.update.call(this,t),i.setMatrix(i.getMatrix());var r=i.getMatrix(),h=i.getBoneParent();h?s.mul(i.getMatrixInSkeletonSpace(),h.getMatrixInSkeletonSpace(),r):i.setMatrixInSkeletonSpace(r)}return!0}}),t.exports=h},function(t,e,i){"use strict";var r=i(6),n=i(15).mat4,a=i(75),s=function(){a.call(this),this._stackedTransforms=[],this._matrix=n.create(),this._dirty=!1};s.prototype=r.objectInherit(a.prototype,{getStackedTransforms:function(){return this._stackedTransforms},computeChannels:function(){this._dirty=!0;var t=this._matrix;n.identity(t);for(var e=this._stackedTransforms,i=0,r=e.length;i<r;i++){var a=e[i];a.applyToMatrix(t)}},update:function(t){return n.copy(t.getMatrix(),this._matrix),this._dirty&&(t.dirtyBound(),this._dirty=!1),!0}}),t.exports=s},function(t,e,i){"use strict";var r=i(10),n=i(6),a=i(13),s=i(61),o=function(){a.call(this)};o.checkPathIsAnimated=function(t){for(var e=0,i=t.length;e<i;++e){var r=t[e];if(r instanceof s)for(var n=r.getUpdateCallbackList(),a=0,h=n.length;a<h;++a)if(n[a]instanceof o)return!0}return!1},o.prototype=n.objectInherit(a.prototype,{linkChannel:function(){},linkAnimation:function(t){var e=this.getName();if(0===e.length)return r.log("no name on an update callback, discard"),0;for(var i=0,n=t.getChannels(),a=0,s=n.length;a<s;a++){var o=n[a];o.getTargetName()===e&&(this.linkChannel(o),i++)}return i}}),t.exports=o},function(t,e,i){"use strict";var r=i(6),n=i(15).vec3,a=i(37),s=i(10),o=i(15).mat4,h=i(29),u=i(77),c=i(79),l=i(81),d=i(75),f=i(34),p=function(){a.call(this),this._shape=null,this.addUpdateCallback(new c),this._root=void 0,this._pathToRoot=void 0,this._isAnimatedPath=!1,this._boneNameID={},this._matrixFromSkeletonToGeometry=o.create(),this._invMatrixFromSkeletonToGeometry=o.create(),this._rigTransformImplementation=new l,this._stateSetAnimation=new h,this._needToComputeMatrix=!0};p.prototype=r.objectLibraryClass(r.objectInherit(a.prototype,{getStateSetAnimation:function(){return this._stateSetAnimation},getSkeleton:function(){return this._root},setSkeleton:function(t){this._root=t},setPathToSkeleton:function(t){this._pathToRoot=t,this._isAnimatedPath=d.checkPathIsAnimated(t)},setNeedToComputeMatrix:function(t){this._needToComputeMatrix=t},getNeedToComputeMatrix:function(){return this._needToComputeMatrix},computeBoundingBox:function(t){t.init();var e=this.getVertexAttributeList().Vertex,i=this.getVertexAttributeList().Weights;if(e&&i&&e.getElements()&&e.getItemSize()>2){for(var r=i.getElements(),n=e.getElements(),a=e.getItemSize(),s=t.getMin(),o=t.getMax(),h=s[0],u=s[1],c=s[2],l=o[0],d=o[1],f=o[2],p=0,_=0,g=n.length;p<g;p+=a,_+=4)if(0===r[p]&&0===r[p+1]&&0===r[p+2]&&0===r[p+3]){var m=n[p],v=n[p+1],S=n[p+2];m<h&&(h=m),m>l&&(l=m),v<u&&(u=v),v>d&&(d=v),S<c&&(c=S),S>f&&(f=S)}s[0]=h,s[1]=u,s[2]=c,o[0]=l,o[1]=d,o[2]=f}return t},computeMatrixFromRootSkeleton:function(){return this._root?(o.identity(this._matrixFromSkeletonToGeometry),f.computeLocalToWorld(this._pathToRoot,!0,this._matrixFromSkeletonToGeometry),o.invert(this._invMatrixFromSkeletonToGeometry,this._matrixFromSkeletonToGeometry),void(this._isAnimatedPath||(this._needToComputeMatrix=!1))):void s.warn("Warning "+this.className()+".computeMatrixFromRootSkeleton if you have this message it means you miss to call buildTransformer( root ), or your RigGeometry ("+this.getName()+") is not attached to a Skeleton subgraph")},getMatrixFromSkeletonToGeometry:function(){return this._matrixFromSkeletonToGeometry},getInvMatrixFromSkeletonToGeometry:function(){return this._invMatrixFromSkeletonToGeometry},getSourceGeometry:function(){return this._geometry},setSourceGeometry:function(t){this._geometry=t},getBoneNameID:function(){return this._boneNameID},setBoneNameID:function(t){this._boneNameID=t},mergeChildrenVertexAttributeList:function(){this._geometry instanceof u&&this._geometry.mergeChildrenVertexAttributeList();var t=this._geometry.getVertexAttributeList();a.appendVertexAttributeToList(t,this.getVertexAttributeList())},mergeChildrenData:function(){this.mergeChildrenVertexAttributeList();var t=this._geometry.getPrimitiveSetList();this.getPrimitiveSetList().length=0;for(var e=0,i=t.length;e<i;e++)this.getPrimitiveSetList()[e]=t[e];this.getStateSet()&&console.error("A stateset in the rig is already present : "+this.getStateSet()),this.setStateSet(this._geometry.getStateSet())},update:function(){this._rigTransformImplementation.update(this)},computeTransformedVertex:function(t,e){e=e||n.create();var i=this.getVertexAttributeList(),r=i.Weights.getElements(),a=i.Bones.getElements(),s=0,o=0,h=0;if(this._geometry.computeTransformedVertex)this._geometry.computeTransformedVertex(t,e),s=e[0],o=e[1],h=e[2];else{var u=i.Vertex.getElements();s=u[3*t],o=u[3*t+1],h=u[3*t+2]}for(var c=4*t,l=this._rigTransformImplementation._skinningAttribute.getMatrixPalette(),d=0,f=0,p=0,_=0,g=0,m=0,v=0,S=0,x=0,b=0,M=0,y=0,T=0,w=!1,C=0;C<4;++C){var A=r[c+C];if(0!==A){var E=12*a[c+C];d+=l[E+0]*A,_+=l[E+1]*A,v+=l[E+2]*A,b+=l[E+3]*A,f+=l[E+4]*A,g+=l[E+5]*A,S+=l[E+6]*A,M+=l[E+7]*A,p+=l[E+8]*A,m+=l[E+9]*A,x+=l[E+10]*A,y+=l[E+11]*A,T+=A,w=!0}}w||(e[0]=s,e[1]=o,e[2]=h);var I=1/T;return e[0]=(d*s+_*o+v*h+b)*I,e[1]=(f*s+g*o+S*h+M)*I,e[2]=(p*s+m*o+x*h+y)*I,e},computeTransformedVertices:function(){for(var t=this.getVertexAttributeList(),e=this._geometry.computeTransformedVertices?this._geometry.computeTransformedVertices():t.Vertex.getElements(),i=t.Weights.getElements(),r=t.Bones.getElements(),n=this._riggedVerts||new Float32Array(e.length),a=this._rigTransformImplementation._skinningAttribute.getMatrixPalette(),s=0,o=0,h=e.length;s<h;s+=3,o+=4){var u,c=0,l=0,d=0,f=0,p=0,_=0,g=0,m=0,v=0,S=0,x=0,b=0,M=0,y=!1,T=i[o];0!==T&&(u=12*r[o],c+=a[u+0]*T,f+=a[u+1]*T,g+=a[u+2]*T,S+=a[u+3]*T,l+=a[u+4]*T,p+=a[u+5]*T,m+=a[u+6]*T,x+=a[u+7]*T,d+=a[u+8]*T,_+=a[u+9]*T,v+=a[u+10]*T,b+=a[u+11]*T,M+=T,y=!0),T=i[o+1],0!==T&&(u=12*r[o+1],c+=a[u+0]*T,f+=a[u+1]*T,g+=a[u+2]*T,S+=a[u+3]*T,l+=a[u+4]*T,p+=a[u+5]*T,m+=a[u+6]*T,x+=a[u+7]*T,d+=a[u+8]*T,_+=a[u+9]*T,v+=a[u+10]*T,b+=a[u+11]*T,M+=T,y=!0),T=i[o+2],0!==T&&(u=12*r[o+2],c+=a[u+0]*T,f+=a[u+1]*T,g+=a[u+2]*T,S+=a[u+3]*T,l+=a[u+4]*T,p+=a[u+5]*T,m+=a[u+6]*T,x+=a[u+7]*T,d+=a[u+8]*T,_+=a[u+9]*T,v+=a[u+10]*T,b+=a[u+11]*T,M+=T,y=!0),T=i[o+3],0!==T&&(u=12*r[o+3],c+=a[u+0]*T,f+=a[u+1]*T,g+=a[u+2]*T,S+=a[u+3]*T,l+=a[u+4]*T,p+=a[u+5]*T,m+=a[u+6]*T,x+=a[u+7]*T,d+=a[u+8]*T,_+=a[u+9]*T,v+=a[u+10]*T,b+=a[u+11]*T,M+=T,y=!0);var w=e[s],C=e[s+1],A=e[s+2];if(y){var E=1/M;n[s]=(c*w+f*C+g*A+S)*E,n[s+1]=(l*w+p*C+m*A+x)*E,n[s+2]=(d*w+_*C+v*A+b)*E}else n[s]=w,n[s+1]=C,n[s+2]=A}return n}}),"osgAnimation","RigGeometry"),r.setTypeID(p),t.exports=p},function(t,e,i){"use strict";var r=i(6),n=i(47),a=i(10),s=i(15).vec3,o=i(37),h=i(29),u=i(78),c=i(31),l=i(14),d=function(){o.call(this),this._shape=null,this._targets=[],this._stateSetAnimation=new h,this._targetWeights=new Float32Array(4),this._morphTargetNames=void 0,this._updateMorph=void 0,this._isInitialized=!1},f=d.EFFECTIVE_EPS=.05;d.prototype=r.objectLibraryClass(r.objectInherit(o.prototype,{init:function(){var t=new u(Math.min(4,this.getMorphTargets().length));return this.getStateSetAnimation().setAttributeAndModes(t,c.ON),t.setTargetWeights(this.getTargetsWeight()),this._targets[0]?(this._morphTargetNames=window.Object.keys(this._targets[0].getVertexAttributeList()),t.copyTargetNames(this._morphTargetNames)):(this._morphTargetNames=[],a.error("No Targets in the MorphGeometry !")),this._isInitialized=!0,!0},getMorphTargetNames:function(){return this._morphTargetNames},getStateSetAnimation:function(){return this._stateSetAnimation},getMorphTargets:function(){return this._targets},isInitialized:function(){return this._isInitialized},getTargetsWeight:function(){return this._targetWeights},computeBoundingBox:function(){var t=new l;return function(e){o.prototype.computeBoundingBox.call(this,e);for(var i=0,r=this._targets.length;i<r;i++)e.expandByBoundingBox(this._targets[i].computeBoundingBox(t));return e}}(),mergeChildrenVertexAttributeList:function(){for(var t=0,e=this._targets.length;t<e;t++){for(var i=this._targets[t],r=i.getVertexAttributeList(),a=window.Object.keys(r),s=0,h=a.length;s<h;s++){var u=a[s],c=r[u];c&&!c.getBufferArray&&(r[u]=new n(c))}o.appendVertexAttributeToList(i.getVertexAttributeList(),this.getVertexAttributeList(),t)}},_computeEffectiveSumWeights:function(){for(var t=0,e=this._targetWeights,i=0,r=e.length;i<r;++i){var n=e[i];Math.abs(n)<f||(t+=n)}var a=1e-5;return Math.abs(t)>a?t:t<0?-a:a},computeTransformedVertex:function(t,e){e=e||s.create();var i=3*t,r=this._targetWeights,n=this.getVertexAttributeList(),a=n.Vertex.getElements(),o=1-this._computeEffectiveSumWeights();e[0]=o*a[i],e[1]=o*a[i+1],e[2]=o*a[i+2];for(var h=0,u=r.length;h<u;++h){var c=r[h];if(!(Math.abs(c)<f)){var l=n["Vertex_"+h].getElements();e[0]+=c*l[i],e[1]+=c*l[i+1],e[2]+=c*l[i+2]}}return e},computeTransformedVertices:function(){for(var t=this._targetWeights,e=this.getVertexAttributeList(),i=e.Vertex.getElements(),r=i.length,n=this._morphedVerts=this._morphedVerts||new Float32Array(r),a=1-this._computeEffectiveSumWeights(),s=0;s<r;++s)n[s]=a*i[s];for(var o=0,h=t.length;o<h;++o){var u=t[o];if(!(Math.abs(u)<f))for(var c=e["Vertex_"+o].getElements(),l=0;l<r;++l)n[l]+=u*c[l]}return n}}),"osgAnimation","MorphGeometry"),r.setTypeID(d),t.exports=d},function(t,e,i){"use strict";var r=i(6),n=i(30),a=i(31),s=i(41),o=function(t,e){a.call(this),this._nbTarget=t,this._enable=!e,this._targetNames={},this._hashNames=""};o.uniforms={},o.prototype=r.objectLibraryClass(r.objectInherit(a.prototype,{attributeType:"Morph",cloneType:function(){return new o(void 0,!0)},hasTarget:function(t){return!!this._targetNames[t]},copyTargetNames:function(t){for(var e=this._targetNames,i="",r=e.length=t.length,n=0;n<r;++n){var a=t[n];e[a]=!0,i+=a}this._hashNames=i},getOrCreateUniforms:function(){var t=o,e=this.getNumTargets();if(t.uniforms[e])return t.uniforms[e];var i={};return i.uTargetWeights=s.createFloat4("uTargetWeights"),t.uniforms[e]=new n(i),t.uniforms[e]},getNumTargets:function(){return this._nbTarget},setTargetWeights:function(t){this._targetWeights=t},getTargetWeights:function(){return this._targetWeights},isEnabled:function(){return this._enable},getHash:function(){return this.getTypeMember()+this._hashNames+this.getNumTargets()+this.isEnabled()},apply:function(){if(this._enable){var t=this.getOrCreateUniforms();t.uTargetWeights.setFloat4(this._targetWeights)}}}),"osgAnimation","MorphAttribute"),r.setTypeID(o),t.exports=o},function(t,e,i){"use strict";var r=i(6),n=i(10),a=i(13),s=i(80),o=function(){a.call(this)};o.prototype=r.objectInherit(a.prototype,{init:function(t){var e=new s;return t.getParents().length>1&&n.warn("A RigGeometry should not have multi parent ( "+t.getName()+" )"),t.getParents()[0].accept(e),e._root?(t.setSkeleton(e._root),void t.setPathToSkeleton(e._pathToRoot)):void n.warn("A RigGeometry did not find a parent skeleton for RigGeometry ( "+t.getName()+" )")},update:function(t){if(t&&"RigGeometry"!==t.className())return!0;var e=t;return e.getSkeleton()||0===e.getParents().length||this.init(e),!e.getSkeleton()||(e.getNeedToComputeMatrix()&&e.computeMatrixFromRootSkeleton(),e.update(),!0)}}),t.exports=o},function(t,e,i){"use strict";var r=i(6),n=i(32),a=i(70),s=function(){n.call(this,n.TRAVERSE_PARENTS),this._root=void 0,this._pathToRoot=void 0};s.prototype=r.objectInherit(n.prototype,{apply:function(t){if(!this._root)return t.typeID===a.typeID?(this._root=t,void(this._pathToRoot=this.nodePath.slice(1))):void this.traverse(t)}}),t.exports=s},function(t,e,i){"use strict";var r=i(15).mat4,n=i(31),a=i(82),s=i(83),o=function(){this._isInitialized=!1,this._bones=[]};o.prototype={computeBonePalette:function(t,e){for(var i=window.Object.keys(t),r=i.length,n=this._bones,a=0;a<r;a++){var s=i[a],o=e[s],h=t[s];void 0!==o&&(n[o]=h)}return n},init:function(t){var e=new s;t.getSkeleton().accept(e);var i=e.getBoneMap();this.computeBonePalette(i,t._boneNameID);var r=3*this._bones.length,o=this._skinningAttribute=new a;return o.setMatrixPalette(new Float32Array(4*r)),t.getStateSetAnimation().setAttributeAndModes(o,n.ON),this._isInitialized=!0,!0},computeMatrixPalette:function(){var t=r.create();return function(e,i){for(var n=this._bones,a=this._skinningAttribute.getMatrixPalette(),s=0,o=0,h=n.length;o<h;o++){var u=n[o],c=u.getInvBindMatrixInSkeletonSpace(),l=u.getMatrixInSkeletonSpace();r.mul(t,l,c),r.mul(t,i,t),r.mul(t,t,e),a[s++]=t[0],a[s++]=t[4],a[s++]=t[8],a[s++]=t[12],a[s++]=t[1],a[s++]=t[5],a[s++]=t[9],a[s++]=t[13],a[s++]=t[2],a[s++]=t[6],a[s++]=t[10],a[s++]=t[14]}}}(),update:function(t){this._isInitialized||this.init(t),this.computeMatrixPalette(t.getMatrixFromSkeletonToGeometry(),t.getInvMatrixFromSkeletonToGeometry())}},t.exports=o},function(t,e,i){"use strict";var r=i(30),n=i(6),a=i(31),s=i(41),o=function(t,e){a.call(this),this._enable=!t,this._boneUniformSize=e};o.uniforms={},o.maxBoneUniformSize=1,o.maxBoneUniformAllowed=1/0,o.prototype=n.objectLibraryClass(n.objectInherit(a.prototype,{attributeType:"Skinning",cloneType:function(){return new o(!0)},setBoneUniformSize:function(t){this._boneUniformSize=t},getBoneUniformSize:function(){return void 0!==this._boneUniformSize?this._boneUniformSize:o.maxBoneUniformSize},getOrCreateUniforms:function(){var t=o,e=this.getBoneUniformSize();if(t.uniforms[e])return t.uniforms[e];var i={};return i.uBones=s.createFloat4Array("uBones"),t.uniforms[e]=new r(i),t.uniforms[e]},setMatrixPalette:function(t){this._matrixPalette=t,void 0===this._boneUniformSize&&(o.maxBoneUniformSize=Math.max(o.maxBoneUniformSize,t.length/4),o.maxBoneUniformSize=Math.min(o.maxBoneUniformAllowed,o.maxBoneUniformSize))},getMatrixPalette:function(){return this._matrixPalette},isEnabled:function(){return this._enable},getHash:function(){return this.getTypeMember()+this.getBoneUniformSize()+this.isEnabled()},apply:function(){this._enable&&this.getOrCreateUniforms().uBones.setInternalArray(this._matrixPalette)}}),"osgAnimation","SkinningAttribute"),n.setTypeID(o),t.exports=o},function(t,e,i){"use strict";var r=i(6),n=i(32),a=i(10),s=i(72),o=function(){n.call(this,n.TRAVERSE_ALL_CHILDREN),this._boneMap={}};o.prototype=r.objectInherit(n.prototype,{apply:function(t){if(t.typeID===s.typeID){var e=t.getName();e?this._boneMap[e]=t:a.warn("found Bone without name")}this.traverse(t)},getBoneMap:function(){return this._boneMap}}),t.exports=o},function(t,e,i){"use strict";var r=i(6),n=i(31),a=function(t,e,i,r){n.call(this),this._func=a.LESS,this._near=0,this._far=1,this._writeMask=!0,void 0!==t&&("string"==typeof t?this._func=a[t]:this._func=t),void 0!==e&&(this._near=e),void 0!==i&&(this._far=i),void 0!==r&&(this._writeMask=r)};a.DISABLE=0,a.NEVER=512,a.LESS=513,a.EQUAL=514,a.LEQUAL=515,a.GREATER=516,a.NOTEQUAL=517,a.GEQUAL=518,a.ALWAYS=519,a.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{attributeType:"Depth",cloneType:function(){return new a},setRange:function(t,e){this._near=t,this._far=e},setWriteMask:function(t){this._writeMask=t},getWriteMask:function(){return this._writeMask},getFunc:function(){return this._func},apply:function(t){var e=t.getGraphicContext();0===this._func?e.disable(e.DEPTH_TEST):(e.enable(e.DEPTH_TEST),e.depthFunc(this._func),e.depthMask(this._writeMask),e.depthRange(this._near,this._far))}}),"osg","Depth"),t.exports=a},function(t,e){"use strict";var i=function(t,e,i){this._mode=t,this._first=e,this._arrayLengths=i.slice(0)};i.prototype={draw:function(t){for(var e=t.getGraphicContext(),i=this._mode,r=this._first,n=this._arrayLengths,a=0,s=n.length;a<s;a++){var o=n[a];e.drawArrays(i,r,o),r+=o}},getMode:function(){return this._mode},getNumIndices:function(){for(var t=0,e=this._arrayLengths,i=0,r=e.length;i<r;i++)t+=e[i];return t},getCount:function(){return this.getNumIndices()},getArrayLengths:function(){return this._arrayLengths},getFirst:function(){return this._first},setFirst:function(t){this._first=t}},t.exports=i},function(t,e,i){"use strict";var r=i(46),n=function(t,e,i){this.mode=t,void 0!==t&&("string"==typeof t&&(t=r[t]),this.mode=t),this.first=e,this.count=i};n.prototype={draw:function(t){if(0!==this.count){var e=t.getGraphicContext();e.drawArrays(this.mode,this.first,this.count)}},getMode:function(){return this.mode},setCount:function(t){this.count=t},getCount:function(){return this.count},setFirst:function(t){this.first=t},getFirst:function(){return this.first},getNumIndices:function(){return this.count},index:function(t){return this.first+t}},t.exports=n},function(t,e,i){"use strict";var r=i(15).mat4,n=i(15).vec3,a=function(){this._radiusEquator=a.WGS_84_RADIUS_EQUATOR,this._radiusPolar=a.WGS_84_RADIUS_POLAR,this.computeCoefficients()};a.WGS_84_RADIUS_EQUATOR=6378137,a.WGS_84_RADIUS_POLAR=6356752.3142,a.prototype={setRadiusEquator:function(t){this._radiusEquator=t,this.computeCoefficients()},getRadiusEquator:function(){return this._radiusEquator},setRadiusPolar:function(t){this._radiusPolar=t,this.computeCoefficients()},getRadiusPolar:function(){return this._radiusPolar},convertLatLongHeightToXYZ:function(t,e,i,r){var n=Math.sin(t),a=Math.cos(t),s=this._radiusEquator/Math.sqrt(1-this._eccentricitySquared*n*n),o=(s+i)*a*Math.cos(e),h=(s+i)*a*Math.sin(e),u=(s*(1-this._eccentricitySquared)+i)*n;return r[0]=o,r[1]=h,r[2]=u,r},convertXYZToLatLongHeight:function(t,e,i,r){var n=Math.sqrt(t*t+e*e),a=Math.atan2(i*this._radiusEquator,n*this._radiusPolar),s=(this._radiusEquator*this._radiusEquator-this._radiusPolar*this._radiusPolar)/(this._radiusPolar*this._radiusPolar),o=Math.sin(a),h=Math.cos(a),u=Math.atan((i+s*this._radiusPolar*o*o*o)/(n-this._eccentricitySquared*this._radiusEquator*h*h*h)),c=Math.atan2(e,t),l=Math.sin(u),d=this._radiusEquator/Math.sqrt(1-this._eccentricitySquared*l*l),f=Math.cos(u);0===f&&(f=1);var p=n/f-d;return r[0]=u,r[1]=c,r[2]=p,r},computeLocalUpVector:function(t,e,i){var r,n,a,s=this.convertXYZToLatLongHeight(t,e,i,r,n,a);return r=s[0],n=s[1],a=s[2],[Math.cos(n)*Math.cos(r),Math.sin(n)*Math.cos(r),Math.sin(r)]},isWGS84:function(){return this._radiusEquator===a.WGS_84_RADIUS_EQUATOR&&this._radiusPolar===a.WGS_84_RADIUS_POLAR},computeCoefficients:function(){var t=(this._radiusEquator-this._radiusPolar)/this._radiusEquator;this._eccentricitySquared=2*t-t*t},computeLocalToWorldTransformFromLatLongHeight:function(t,e,i,n){var a=this.convertLatLongHeightToXYZ(t,e,i,n);return r.fromTranslation(n,a),this.computeCoordinateFrame(t,e,n),n},computeLocalToWorldTransformFromXYZ:function(t,e,i){var a=this.convertXYZToLatLongHeight(t,e,i),s=r.fromTranslation(r.create(),n.fromValues(t,e,i));return this.computeCoordinateFrame(a[0],a[1],s),s},computeCoordinateFrame:function(){var t=n.create(),e=n.create(),i=n.create();return function(a,s,o){t[0]=Math.cos(s)*Math.cos(a),t[1]=Math.sin(s)*Math.cos(a),t[2]=Math.sin(a),e[0]=-Math.sin(s),e[1]=-Math.cos(s),n.cross(i,t,e),r.set(o,e[0],e[1],e[2],0,i[0],i[1],i[2],0,t[0],t[1],t[2],0,0,0,0,1)}}()},t.exports=a},function(t,e){"use strict";var i=function(){this._frame=0,this._startSimulation=0,this._currentSimulation=0,this._deltaTime=0};i.prototype={setReferenceTime:function(t){this._startSimulation=t},getReferenceTime:function(){return this._startSimulation},setSimulationTime:function(t){this._currentSimulation=t},getSimulationTime:function(){return this._currentSimulation},setDeltaTime:function(t){this._deltaTime=t},getDeltaTime:function(){return this._deltaTime},setFrameNumber:function(t){this._frame=t},getFrameNumber:function(){return this._frame}},t.exports=i},function(t,e,i){"use strict";var r=i(90),n=i(6),a=i(42),s=function(t){a.call(this,t),this._canPlayDefered=void 0};s.PAUSE=0,s.PLAYING=1,s.prototype=n.objectLibraryClass(n.objectInherit(a.prototype,{isDirty:function(){return this._status===s.PLAYING},setImage:function(t){a.prototype.setImage.call(this,t),this._status=s.STOP,t.addEventListener("ended",function(){this._imageObject.loop||this.stop()}.bind(this),!0),this.dirty()},setLooping:function(t){this._imageObject.loop=t},play:function(){this._imageObject.play(),this._status=s.PLAYING},stop:function(){this._imageObject.pause(),this._status=s.PAUSE},whenReady:function(){return this._imageObject?(this._canPlayDefered||(this._canPlayDefered=r.defer(),this._imageObject.addEventListener("canplaythrough",this._canPlayDefered.resolve.bind(this._canPlayDefered,this),!0)),this._canPlayDefered.promise):r.reject()}}),"osg","ImageStream"),n.setTypeID(s),t.exports=s},function(t,e){t.exports=__WEBPACK_EXTERNAL_MODULE_90__},function(t,e,i){"use strict";var r=i(6),n=i(15).vec3,a=i(14),s=i(92),o=i(46),h=i(93),u=i(95),c=function(t,e){this._bb=new a,this._first=t,this._second=e,this._nodeRayStart=n.create(),this._nodeRayEnd=n.create()},l=function(t){this._kdTree=t,this._bb=new a,this._primitiveIndices=null,this._centers=null,this._axisOrder=n.create(),this._stackLength=0};l.prototype={build:function(t,e){var i=t._targetNumTrianglesPerLeaf,n=e.getVertexAttributeList().Vertex;if(!n)return!1;var s=n.getElements();if(!s)return!1;var o=s.length/3;if(o<i)return!1;this._bb.copy(e.getBoundingBox()),this._kdTree.setVertices(s),this.computeDivisions(t),t._numVerticesProcessed+=o,this.computeTriangles(e);var h=new c(-1,this._primitiveIndices.length);h._bb.copy(this._bb);var u=this._kdTree.addNode(h),l=new a;l.copy(this._bb),u=this.divide(t,l,u,0);for(var d=this._kdTree.getTriangles(),f=this._primitiveIndices,p=f.length,_=new r.Uint32Array(d.length),g=0,m=0;g<p;++g,m+=3){var v=3*f[g];_[m]=d[v],_[m+1]=d[v+1],_[m+2]=d[v+2]}return this._kdTree.setTriangles(_),this._kdTree.getNodes().length>0},computeTriangles:function(t){var e=this._kdTree,i=0,n=t.primitives,a=n.length,h=0;for(h=0;h<a;h++){var u=n[h],c=u.getMode();c===o.TRIANGLES?i+=u.getCount():c!==o.TRIANGLE_STRIP&&c!==o.TRIANGLE_FAN||(i+=3*(u.getCount()-2));
}var l=new r.Uint32Array(i),d=0,f=function(t,e,i){t!==e&&t!==i&&e!==i&&(l[d]=t,l[d+1]=e,l[d+2]=i,d+=3)},p=new s;p.init(t,f),p.apply(),l=l.subarray(0,d);var _=l.length;e.setTriangles(l);var g=e.getVertices();this._centers=new r.Float32Array(_);var m=this._centers;this._primitiveIndices=new r.Uint32Array(_/3);var v=this._primitiveIndices,S=0;for(h=0,S=0;h<_;h+=3,++S){var x=l[h],b=l[h+1],M=l[h+2];if(x===b||b===M||x===M)return;x*=3,b*=3,M*=3;var y=g[x],T=g[x+1],w=g[x+2],C=g[b],A=g[b+1],E=g[b+2],I=g[M],F=g[M+1],R=g[M+2],N=Math.min(y,Math.min(C,I)),D=Math.min(T,Math.min(A,F)),L=Math.min(w,Math.min(E,R)),P=Math.max(y,Math.max(C,I)),O=Math.max(T,Math.max(A,F)),k=Math.max(w,Math.max(E,R));m[h]=.5*(N+P),m[h+1]=.5*(D+O),m[h+2]=.5*(L+k),v[S]=S}},computeDivisions:function(t){this._stackLength=t._maxNumLevels;var e=this._bb._max,i=this._bb._min,r=e[0]-i[0],n=e[1]-i[1],a=e[2]-i[2],s=this._axisOrder;s[0]=r>=n&&r>=a?0:n>=a?1:2,s[2]=r<n&&r<a?0:n<a?1:2;var o=s[0]+s[2];s[1]=3===o?0:2===o?1:2},divide:function(t,e,i,r){var n=this._kdTree,a=this._primitiveIndices,s=n.getNodes(),o=s[i],h=o._first,u=o._second,l=r<this._stackLength&&h<0&&u>t._targetNumTrianglesPerLeaf,d=-h-1,f=d+u-1;if(!l)return h<0&&this.computeNodeBox(o,d,f),i;if(h>=0)return i;for(var p=this._axisOrder[r%3],_=e._min[p],g=e._max[p],m=.5*(_+g),v=0,S=0,x=!1,b=d,M=f,y=this._centers;b<M;){for(;b<M&&y[3*a[b]+p]<=m;)++b;for(;b<M&&y[3*a[M]+p]>m;)--M;if(b<M){var T=a[b];a[b]=a[M],a[M]=T,++b,--M}}b===M&&(y[3*a[b]+p]<=m?++b:--M),M-d<=-1?(v=0,S=i,x=!0):f-b<=-1?(v=i,S=0,x=!0):(v=n.addNode(new c(-d-1,M-d+1)),S=n.addNode(new c(-b-1,f-b+1)));var w=e._max[p];e._max[p]=m;var C=0!==v?this.divide(t,e,v,r+1):0;e._max[p]=w,w=e._min[p],e._min[p]=m;var A=0!==S?this.divide(t,e,S,r+1):0;if(e._min[p]=w,!x){o._first=C,o._second=A,x=!0;var E=o._bb;E.init(),0!==C&&E.expandByBoundingBox(s[C]._bb),0!==A&&E.expandByBoundingBox(s[A]._bb)}return i},computeNodeBox:function(t,e,i){for(var r=1/0,n=1/0,a=1/0,s=-(1/0),o=-(1/0),h=-(1/0),u=this._kdTree.getTriangles(),c=this._kdTree.getVertices(),l=this._primitiveIndices,d=e;d<=i;++d){var f=3*l[d],p=3*u[f],_=3*u[f+1],g=3*u[f+2],m=c[p],v=c[p+1],S=c[p+2],x=c[_],b=c[_+1],M=c[_+2],y=c[g],T=c[g+1],w=c[g+2];r=Math.min(r,Math.min(m,Math.min(x,y))),n=Math.min(n,Math.min(v,Math.min(b,T))),a=Math.min(a,Math.min(S,Math.min(M,w))),s=Math.max(s,Math.max(m,Math.max(x,y))),o=Math.max(o,Math.max(v,Math.max(b,T))),h=Math.max(h,Math.max(S,Math.max(M,w)))}var C=1e-6,A=t._bb,E=A._min,I=A._max;E[0]=r-C,E[1]=n-C,E[2]=a-C,I[0]=s+C,I[1]=o+C,I[2]=h+C}};var d=function(){this._vertices=null,this._kdNodes=[],this._triangles=null};d.prototype=r.objectLibraryClass({getVertices:function(){return this._vertices},setVertices:function(t){this._vertices=t},getNodes:function(){return this._kdNodes},getTriangles:function(){return this._triangles},setTriangles:function(t){this._triangles=t},addNode:function(t){return this._kdNodes.push(t),this._kdNodes.length-1},build:function(t,e){var i=new l(this);return i.build(t,e)},intersectRay:function(t,e,i,r){if(0===this._kdNodes.length)return!1;var n=i.length;return this._rayIntersector||(this._rayIntersector=new h,this._rayIntersector.setKdtree(this._vertices,this._kdNodes,this._triangles)),this._rayIntersector.init(i,t,e,r),this._rayIntersector.intersect(this.getNodes()[0],t,e),n!==i.length},intersectSphere:function(t,e,i,r){if(0===this._kdNodes.length)return!1;var n=i.length;return this._sphereIntersector||(this._sphereIntersector=new u,this._sphereIntersector.setKdtree(this._vertices,this._kdNodes,this._triangles)),this._sphereIntersector.init(i,t,e,r),this._sphereIntersector.intersect(this.getNodes()[0]),n!==i.length}},"osg","KdTree"),t.exports=d},function(t,e,i){"use strict";var r=i(46),n=i(45),a=i(86),s=function(){},o=s.functorDrawElements=[],h=s.functorDrawArrays=[];o[r.TRIANGLES]=function(t,e,i,r){for(var n=t+e,a=t;a<n;a+=3)r(i[a],i[a+1],i[a+2])},o[r.TRIANGLE_STRIP]=function(t,e,i,r){for(var n=2,a=t;n<e;++n,++a)n%2?r(i[a],i[a+2],i[a+1]):r(i[a],i[a+1],i[a+2])},o[r.TRIANGLE_FAN]=function(t,e,i,r){for(var n=i[t],a=2,s=t+1;a<e;++a,++s)r(n,i[s],i[s+1])},h[r.TRIANGLES]=function(t,e,i){for(var r=2,n=t;r<e;r+=3,n+=3)i(n,n+1,n+2)},h[r.TRIANGLE_STRIP]=function(t,e,i){for(var r=2,n=t;r<e;++r,++n)r%2?i(n,n+2,n+1):i(n,n+1,n+2)},h[r.TRIANGLE_FAN]=function(t,e,i){for(var r=2,n=t+1;r<e;++r,++n)i(t,n,n+1)},s.prototype={init:function(t,e){this._geom=t,this._cb=e},apply:function(){var t=this._geom,e=t.primitives;if(e)for(var i,r=this._cb,s=e.length,u=0;u<s;u++){var c=e[u];if(c instanceof n){if(i=o[c.getMode()]){var l=c.indices.getElements();i(c.getFirst()/l.BYTES_PER_ELEMENT,c.getCount(),l,r)}}else c instanceof a&&(i=h[c.getMode()],i&&i(c.getFirst(),c.getCount(),r))}}},t.exports=s},function(t,e,i){"use strict";var r=i(15).vec3,n=i(94),a=function(){this._intersector=new n,this._dInvX=r.create(),this._dInvY=r.create(),this._dInvZ=r.create()};a.prototype={setKdtree:function(t,e,i){this._vertices=t,this._kdNodes=e,this._triangles=i},init:function(){var t=r.create();return function(e,i,n,a){var s=r.sub(t,n,i),o=r.length(s),h=0;0!==o&&(h=1/o),r.scale(s,s,h),0!==s[0]&&r.scale(this._dInvX,s,1/s[0]),0!==s[1]&&r.scale(this._dInvY,s,1/s[1]),0!==s[2]&&r.scale(this._dInvZ,s,1/s[2]),this._intersector._intersections=e,this._intersector.setNodePath(a),this._intersector.set(i,n)}}(),intersect:function(){var t=r.create(),e=r.create(),i=r.create();return function(n,a,s){var o=n._first,h=n._second,u=this._triangles,c=this._vertices;if(o<0){var l=-o-1,d=l+h,f=this._intersector;f.index=l;for(var p=l;p<d;++p){var _=3*p,g=u[_],m=u[_+1],v=u[_+2],S=3*g;t[0]=c[S],t[1]=c[S+1],t[2]=c[S+2],S=3*m,e[0]=c[S],e[1]=c[S+1],e[2]=c[S+2],S=3*v,i[0]=c[S],i[1]=c[S+1],i[2]=c[S+2],f.intersect(t,e,i,g,m,v)}}else{var x,b=n._nodeRayStart,M=n._nodeRayEnd,y=this._kdNodes;r.copy(b,a),r.copy(M,s),o>0&&(x=y[o],this.intersectAndClip(b,M,x._bb)&&this.intersect(x,b,M)),h>0&&(r.copy(b,a),r.copy(M,s),x=y[h],this.intersectAndClip(b,M,x._bb)&&this.intersect(x,b,M))}}}(),intersectAndClip:function(){return function(t,e,i){var n=i._min,a=n[0],s=n[1],o=n[2],h=i._max,u=h[0],c=h[1],l=h[2],d=this._dInvX,f=this._dInvY,p=this._dInvZ;if(t[0]<=e[0]){if(e[0]<a)return!1;if(t[0]>u)return!1;t[0]<a&&r.scaleAndAdd(t,t,d,a-t[0]),e[0]>u&&r.scaleAndAdd(e,t,d,u-t[0])}else{if(t[0]<a)return!1;if(e[0]>u)return!1;e[0]<a&&r.scaleAndAdd(e,t,d,a-t[0]),t[0]>u&&r.scaleAndAdd(t,t,d,u-t[0])}if(t[1]<=e[1]){if(e[1]<s)return!1;if(t[1]>c)return!1;t[1]<s&&r.scaleAndAdd(t,t,f,s-t[1]),e[1]>c&&r.scaleAndAdd(e,t,f,c-t[1])}else{if(t[1]<s)return!1;if(e[1]>c)return!1;e[1]<s&&r.scaleAndAdd(e,t,f,s-t[1]),t[1]>c&&r.scaleAndAdd(t,t,f,c-t[1])}if(t[2]<=e[2]){if(e[2]<o)return!1;if(t[2]>l)return!1;t[2]<o&&r.scaleAndAdd(t,t,p,o-t[2]),e[2]>l&&r.scaleAndAdd(e,t,p,l-t[2])}else{if(t[2]<o)return!1;if(e[2]>l)return!1;e[2]<o&&r.scaleAndAdd(e,t,p,o-t[2]),t[2]>l&&r.scaleAndAdd(t,t,p,l-t[2])}return!0}}()},t.exports=a},function(t,e,i){"use strict";var r=i(15).vec3,n=i(15).mat4,a=i(92),s=i(34),o=function(t,e,i,r,n,a,s){this.normal=t,this.i1=e,this.i2=i,this.i3=r,this.r1=n,this.r2=a,this.r3=s},h=function(){this._intersections=[],this._nodePath=[],this._dir=r.create()};h.prototype={reset:function(){this._intersections.length=0},setNodePath:function(t){this._nodePath=t},set:function(t,e){this._start=t,this._end=e,this._dir=r.sub(this._dir,e,t),this._length=r.length(this._dir),this._invLength=1/this._length,r.scale(this._dir,this._dir,this._invLength)},apply:function(){var t=r.create(),e=r.create(),i=r.create(),n=new a;return function(r){if(r.getAttributes().Vertex){var a=r.getAttributes().Vertex.getElements(),s=this,o=function(r,n,o){if(r!==n&&r!==o&&n!==o){var h=3*r;t[0]=a[h],t[1]=a[h+1],t[2]=a[h+2],h=3*n,e[0]=a[h],e[1]=a[h+1],e[2]=a[h+2],h=3*o,i[0]=a[h],i[1]=a[h+1],i[2]=a[h+2],s.intersect(t,e,i,r,n,o)}};n.init(r,o),n.apply()}}}(),isBackFace:function(){var t=n.create();return function(e,i){n.identity(t),s.computeLocalToWorld(i,!0,t);var r=n.determinant(t);return r*e<0}}(),intersect:function(){var t=r.create(),e=r.create(),i=r.create(),n=r.create(),a=r.create(),s=r.create(),h=1e-20;return function(u,c,l,d,f,p){var _=this._dir;r.sub(e,l,u),r.sub(i,c,u),r.cross(a,_,e);var g=r.dot(a,i);if(!(g>-h&&g<h)){var m=1/g;r.sub(n,this._start,u);var v=r.dot(a,n)*m;if(!(v<0||v>1)){r.cross(s,n,i);var S=r.dot(s,_)*m;if(!(S<0||v+S>1)){var x=r.dot(s,e)*m;if(!(x<h||x>this._length)){var b=1-v-S,M=v,y=S,T=x*this._invLength,w=u[0]*b+c[0]*M+l[0]*y,C=u[1]*b+c[1]*M+l[1]*y,A=u[2]*b+c[2]*M+l[2]*y;r.cross(t,i,e),r.normalize(t,t),this._intersections.push({ratio:T,backface:this.isBackFace(g,this._nodePath),nodepath:this._nodePath.slice(0),TriangleIntersection:new o(r.clone(t),d,f,p,b,M,y),point:r.fromValues(w,C,A)}),this.hit=!0}}}}}}()},t.exports=h},function(t,e,i){"use strict";var r=i(6),n=i(15).vec3,a=i(93),s=i(96),o=function(){this._intersector=new s};o.prototype=r.objectInherit(a.prototype,{init:function(t,e,i,r){this._intersector._intersections=t,this._intersector.setNodePath(r),this._intersector.set(e,i),this._center=e,this._radius=i},intersect:function(){var t=n.create(),e=n.create(),i=n.create();return function(r){var n=r._first,a=r._second,s=this._triangles,o=this._vertices;if(n<0){var h=-n-1,u=h+a,c=this._intersector;c.index=h;for(var l=h;l<u;++l){var d=3*l,f=s[d],p=s[d+1],_=s[d+2],g=3*f;t[0]=o[g],t[1]=o[g+1],t[2]=o[g+2],g=3*p,e[0]=o[g],e[1]=o[g+1],e[2]=o[g+2],g=3*_,i[0]=o[g],i[1]=o[g+1],i[2]=o[g+2],c.intersect(t,e,i,f,p,_)}}else n>0&&this.intersectSphere(this._kdNodes[n]._bb)&&this.intersect(this._kdNodes[n]),a>0&&this.intersectSphere(this._kdNodes[a]._bb)&&this.intersect(this._kdNodes[a])}}(),intersectSphere:function(){var t=n.create();return function(e){var i=this._radius+e.radius();return n.sqrDist(e.center(t),this._center)<=i*i}}()}),t.exports=o},function(t,e,i){"use strict";var r=i(6),n=i(15).vec3,a=i(94),s=function(t,e,i,r){this.normal=t,this.i1=e,this.i2=i,this.i3=r},o=function(){a.apply(this)};o.prototype=r.objectInherit(a.prototype,{set:function(t,e){this._center=t,this._radius=e},intersect:function(){var t=n.create(),e=n.create(),i=n.create();return function(r,a,o,h,u,c){n.sub(t,a,r),n.sub(e,o,r);var l=n.sqrLen(t),d=n.dot(t,e),f=n.sqrLen(e);n.sub(i,r,this._center);var p=n.dot(i,t),_=n.dot(i,e),g=n.sqrLen(i),m=Math.abs(l*f-d*d);if(!(m<1e-10)){var v,S=d*_-f*p,x=d*p-l*_,b=4;if(S+x<=m)if(S<0)x<0?(b=4,p<0?(x=0,-p>=l?(S=1,v=l+2*p+g):(S=-p/l,v=p*S+g)):(S=0,_>=0?(x=0,v=g):-_>=f?(x=1,v=f+2*_+g):(x=-_/f,v=_*x+g))):(b=3,S=0,_>=0?(x=0,v=g):-_>=f?(x=1,v=f+2*_+g):(x=-_/f,v=_*x+g));else if(x<0)b=5,x=0,p>=0?(S=0,v=g):-p>=l?(S=1,v=l+2*p+g):(S=-p/l,v=p*S+g);else{b=0;var M=1/m;S*=M,x*=M,v=S*(l*S+d*x+2*p)+x*(d*S+f*x+2*_)+g}else{var y,T,w,C;S<0?(b=2,y=d+p,T=f+_,T>y?(w=T-y,C=l-2*d+f,w>=C?(S=1,x=0,v=l+2*p+g):(S=w/C,x=1-S,v=S*(l*S+d*x+2*p)+x*(d*S+f*x+2*_)+g)):(S=0,T<=0?(x=1,v=f+2*_+g):_>=0?(x=0,v=g):(x=-_/f,v=_*x+g))):x<0?(b=6,y=d+_,T=l+p,T>y?(w=T-y,C=l-2*d+f,w>=C?(x=1,S=0,v=f+2*_+g):(x=w/C,S=1-x,v=S*(l*S+d*x+2*p)+x*(d*S+f*x+2*_)+g)):(x=0,T<=0?(S=1,v=l+2*p+g):p>=0?(S=0,v=g):(S=-p/l,v=p*S+g))):(b=1,w=f+_-d-p,w<=0?(S=0,x=1,v=f+2*_+g):(C=l-2*d+f,w>=C?(S=1,x=0,v=l+2*p+g):(S=w/C,x=1-S,v=S*(l*S+d*x+2*p)+x*(d*S+f*x+2*_)+g)))}if(v<0&&(v=0),!(v>this._radius*this._radius)){var A=n.create();A&&(A[0]=r[0]+S*t[0]+x*e[0],A[1]=r[1]+S*t[1]+x*e[1],A[2]=r[2]+S*t[2]+x*e[2]);var E=n.create();n.cross(E,t,e),n.normalize(E,E),this._intersections.push({ratio:Math.sqrt(v),nodepath:this._nodePath.slice(0),TriangleIntersection:new s(E,h,u,c),point:A,zone:b}),this.hit=!0}}}}()}),t.exports=o},function(t,e,i){"use strict";var r=i(6),n=i(32),a=i(91),s=function(t){n.call(this),this._buildOptions=void 0!==t?t:{_numVerticesProcessed:0,_targetNumTrianglesPerLeaf:50,_maxNumLevels:20}};s.prototype=r.objectInherit(n.prototype,{apply:function(t){if(t.getShape){var e=t.getShape();if(void 0===e){var i=new a;i.build(this._buildOptions,t)&&t.setShape(i)}}this.traverse(t)}}),t.exports=s},function(t,e,i){"use strict";var r=i(6),n=i(31),a=i(41),s=i(15).mat4,o=i(15).vec3,h=i(15).vec4,u=i(30),c=function(t,e){n.call(this);var i=void 0!==t?t:0;this._ambient=h.fromValues(.2,.2,.2,1),this._diffuse=h.fromValues(.8,.8,.8,1),this._specular=h.fromValues(.2,.2,.2,1),this._position=h.fromValues(0,0,1,0),this._direction=o.fromValues(0,0,-1),this._ground=h.fromValues(.2,.2,.2,-1),this._spotCutoff=180,this._spotBlend=.01,this._attenuation=h.fromValues(1,0,0,0),this._lightNumber=i,this._invMatrix=s.create(),this._enable=!e};c.DIRECTION="DIRECTION",c.SPOT="SPOT",c.POINT="POINT",c.HEMI="HEMI",c.uniforms={},c.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{attributeType:"Light",cloneType:function(){return new c(this._lightNumber,!0)},getTypeMember:function(){return this.attributeType+this._lightNumber},getUniformName:function(t){var e=this.getType()+this._lightNumber.toString();return"u"+e+"_"+t},getHash:function(){return this.getTypeMember()+this.getLightType()+this.isEnabled().toString()},getOrCreateUniforms:function(){var t=c,e=this.getTypeMember();if(t.uniforms[e])return t.uniforms[e];var i={ambient:a.createFloat4(this.getUniformName("ambient")),diffuse:a.createFloat4(this.getUniformName("diffuse")),specular:a.createFloat4(this.getUniformName("specular")),attenuation:a.createFloat4(this.getUniformName("attenuation")),position:a.createFloat4(this.getUniformName("position")),direction:a.createFloat3(this.getUniformName("direction")),spotCutOff:a.createFloat1(this.getUniformName("spotCutOff")),spotBlend:a.createFloat1(this.getUniformName("spotBlend")),ground:a.createFloat4(this.getUniformName("ground")),matrix:a.createMatrix4(this.getUniformName("matrix")),invMatrix:a.createMatrix4(this.getUniformName("invMatrix"))};return t.uniforms[e]=new u(i),t.uniforms[e]},isEnabled:function(){return this._enable},setEnabled:function(t){this._enable=t},setAmbient:function(t){h.copy(this._ambient,t)},getAmbient:function(){return this._ambient},setDiffuse:function(t){h.copy(this._diffuse,t)},getDiffuse:function(){return this._diffuse},setSpecular:function(t){h.copy(this._specular,t)},getSpecular:function(){return this._specular},setPosition:function(t){h.copy(this._position,t)},getPosition:function(){return this._position},setDirection:function(t){o.copy(this._direction,t)},getDirection:function(){return this._direction},setSpotCutoff:function(t){this._spotCutoff=t},getSpotCutoff:function(){return this._spotCutoff},setSpotBlend:function(t){this._spotBlend=t},getSpotBlend:function(){return this._spotBlend},setGround:function(t){o.copy(this._ground,t)},getGround:function(){return this._ground},setConstantAttenuation:function(t){this._attenuation[0]=t},getConstantAttenuation:function(){return this._attenuation[0]},setLinearAttenuation:function(t){this._attenuation[1]=t},getLinearAttenuation:function(){return this._attenuation[1]},setQuadraticAttenuation:function(t){this._attenuation[2]=t},getQuadraticAttenuation:function(){return this._attenuation[2]},setLightType:function(t){return t===c.DIRECTION?this.setLightAsDirection():t===c.SPOT?this.setLightAsSpot():t===c.HEMI?this.setLightAsHemi():this.setLightAsPoint()},getLightType:function(){return this.isDirectionLight()?c.DIRECTION:this.isSpotLight()?c.SPOT:this.isHemiLight()?c.HEMI:c.POINT},setLightAsSpot:function(){h.set(this._position,0,0,0,1),o.set(this._direction,0,0,-1),this._ground[3]=-1,this._spotCutoff=90},setLightAsPoint:function(){h.set(this._position,0,0,0,1),o.set(this._direction,0,0,-1),this._ground[3]=-1},setLightAsDirection:function(){h.set(this._position,0,0,1,0),this._spotCutoff=180,this._ground[3]=-1},setLightAsHemi:function(){h.set(this._position,0,0,1,0),this._spotCutoff=180,this._ground[3]=1},setLightNumber:function(t){this._lightNumber=t},getLightNumber:function(){return this._lightNumber},isSpotLight:function(){return this._spotCutoff<180},isDirectionLight:function(){return 0===this._position[3]&&this._ground[3]===-1},isHemiLight:function(){return 1===this._ground[3]},applyPositionedUniform:function(t){var e=this.getOrCreateUniforms(),i=e.matrix.getInternalArray(),r=e.invMatrix.getInternalArray();s.copy(i,t),s.copy(r,t),r[12]=0,r[13]=0,r[14]=0,s.invert(r,r),s.transpose(r,r)},apply:function(){if(this._enable){var t=this.getOrCreateUniforms();if(t.position.setFloat4(this._position),this.isSpotLight()){var e=Math.cos(this._spotCutoff*Math.PI/180);t.spotCutOff.setFloat(e),t.spotBlend.setFloat((1-e)*this._spotBlend),t.direction.setFloat3(this._direction)}this.isHemiLight()&&t.ground.setFloat4(this._ground),t.attenuation.setFloat4(this._attenuation),t.diffuse.setFloat4(this._diffuse),t.specular.setFloat4(this._specular),t.ambient.setFloat4(this._ambient)}}}),"osg","Light"),r.setTypeID(c),t.exports=c},function(t,e,i){"use strict";var r=i(6),n=i(31),a=function(t){n.call(this),this.lineWidth=1,void 0!==t&&(this.lineWidth=t)};a.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{attributeType:"LineWidth",cloneType:function(){return new a},apply:function(t){t.getGraphicContext().lineWidth(this.lineWidth)}}),"osg","LineWidth"),t.exports=a},function(t,e,i){"use strict";var r=i(6),n=i(31),a=i(15).vec4,s=i(41),o=i(30),h=function(){n.call(this),this._ambient=a.fromValues(.2,.2,.2,1),this._diffuse=a.fromValues(.8,.8,.8,1),this._specular=a.fromValues(0,0,0,1),this._emission=a.fromValues(0,0,0,1),this._shininess=12.5};h.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{attributeType:"Material",cloneType:function(){return new h},getParameterName:function(t){return"u"+this.getType()+"_"+t},getOrCreateUniforms:function(){var t=h;if(t.uniforms)return t.uniforms;var e={ambient:s.createFloat4("uMaterialAmbient"),diffuse:s.createFloat4("uMaterialDiffuse"),specular:s.createFloat4("uMaterialSpecular"),emission:s.createFloat4("uMaterialEmission"),shininess:s.createFloat1("uMaterialShininess")};return t.uniforms=new o(e),t.uniforms},setEmission:function(t){a.copy(this._emission,t)},getEmission:function(){return this._emission},setAmbient:function(t){a.copy(this._ambient,t)},getAmbient:function(){return this._ambient},setSpecular:function(t){a.copy(this._specular,t)},getSpecular:function(){return this._specular},setDiffuse:function(t){a.copy(this._diffuse,t)},getDiffuse:function(){return this._diffuse},setShininess:function(t){this._shininess=t},getShininess:function(){return this._shininess},setTransparency:function(t){this._diffuse[3]=1-t},getTransparency:function(){return this._diffuse[3]},apply:function(){var t=this.getOrCreateUniforms();t.ambient.setFloat4(this._ambient),t.diffuse.setFloat4(this._diffuse),t.specular.setFloat4(this._specular),t.emission.setFloat4(this._emission),t.shininess.setFloat(this._shininess)}}),"osg","Material"),t.exports=h},function(t,e,i){"use strict";var r=i(6),n=i(31),a=i(41),s=i(30),o=function(t){n.call(this),this._enable=!t,this._pointSize=1,this._circleShape=!1};o.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{attributeType:"PointSize",cloneType:function(){return new o(!0)},setCircleShape:function(t){this._circleShape=t},isCircleShape:function(){return this._circleShape},setEnabled:function(t){this._enable=t},isEnabled:function(){return this._enable},setPointSize:function(t){this._pointSize=t},getOrCreateUniforms:function(){var t=o;if(t.uniforms)return t.uniforms;var e={pointSize:a.createFloat(1,"uPointSize")};return t.uniforms=new s(e),t.uniforms},getHash:function(){return this.getTypeMember()+(this.isEnabled()?"1":"0")+(this._circleShape?"1":"0")},apply:function(){if(this._enable){var t=this.getOrCreateUniforms();t.pointSize.setFloat(this._pointSize)}}}),"osg","PointSizeAttribute"),r.setTypeID(o),t.exports=o},function(t,e,i){"use strict";var r=i(15).vec3,n=i(46),a=i(45),s=i(86),o=function(t,e,i){this._geom=t,this._cb=e,this._vertices=i},h=o.functorDrawElements=[],u=o.functorDrawArrays=[];h[n.POINTS]=function(){var t=r.create();return function(e,i,r,n,a){for(var s=e+i,o=e;o<s;++o){var h=3*r[o];t[0]=a[h],t[1]=a[h+1],t[2]=a[h+2],n.operatorPoint(t)}}}(),h[n.LINES]=function(){var t=r.create(),e=r.create();return function(i,r,n,a,s){for(var o=i+r,h=i;h<o-1;h+=2){var u=3*n[h];t[0]=s[u],t[1]=s[u+1],t[2]=s[u+2],u=3*n[h+1],e[0]=s[u],e[1]=s[u+1],e[2]=s[u+2],a.operatorLine(t,e)}}}(),h[n.LINE_STRIP]=function(){var t=r.create(),e=r.create();return function(i,r,n,a,s){for(var o=i+r,h=i;h<o-1;++h){var u=3*n[h];t[0]=s[u],t[1]=s[u+1],t[2]=s[u+2],u=3*n[h+1],e[0]=s[u],e[1]=s[u+1],e[2]=s[u+2],a.operatorLine(t,e)}}}(),h[n.LINE_LOOP]=function(){var t=r.create(),e=r.create();return function(i,r,n,a,s){for(var o=i+r-1,h=i;h<o;++h){var u=3*n[h];t[0]=s[u],t[1]=s[u+1],t[2]=s[u+2],u=3*n[h+1],e[0]=s[u],e[1]=s[u+1],e[2]=s[u+2],a.operatorLine(t,e)}o=3*n[o],t[0]=s[o],t[1]=s[o+1],t[2]=s[o+2];var c=3*n[0];e[0]=s[c],e[1]=s[c+1],e[2]=s[c+2],a.operatorLine(t,e)}}(),h[n.TRIANGLES]=function(){var t=r.create(),e=r.create(),i=r.create();return function(r,n,a,s,o){for(var h=r+n,u=r;u<h;u+=3){var c=3*a[u];t[0]=o[c],t[1]=o[c+1],t[2]=o[c+2],c=3*a[u+1],e[0]=o[c],e[1]=o[c+1],e[2]=o[c+2],c=3*a[u+2],i[0]=o[c],i[1]=o[c+1],i[2]=o[c+2],s.operatorTriangle(t,e,i)}}}(),h[n.TRIANGLE_STRIP]=function(){var t=r.create(),e=r.create(),i=r.create();return function(r,n,a,s,o){for(var h=2,u=r;h<n;++h,++u){var c=3*a[u];t[0]=o[c],t[1]=o[c+1],t[2]=o[c+2],c=3*a[u+1],e[0]=o[c],e[1]=o[c+1],e[2]=o[c+2],c=3*a[u+2],i[0]=o[c],i[1]=o[c+1],i[2]=o[c+2],h%2?s.operatorTriangle(t,i,e):s.operatorTriangle(t,e,i)}}}(),h[n.TRIANGLE_FAN]=function(){var t=r.create(),e=r.create(),i=r.create();return function(r,n,a,s,o){for(var h=a[r],u=2,c=r+1;u<n;++u,++c){t[0]=o[h],t[1]=o[h+1],t[2]=o[h+2];var l=3*a[c];e[0]=o[l],e[1]=o[l+1],e[2]=o[l+2],l=3*a[c+1],i[0]=o[l],i[1]=o[l+1],i[2]=o[l+2],s.operatorTriangle(t,e,i)}}}(),u[n.POINTS]=function(){var t=r.create();return function(e,i,r,n){for(var a=e;a<e+i;++a){var s=3*a;t[0]=n[s],t[1]=n[s+1],t[2]=n[s+2],r.operatorPoint(t)}}}(),u[n.LINES]=function(){var t=r.create(),e=r.create();return function(i,r,n,a){for(var s=i;s<i+r-1;s+=2){var o=3*s;t[0]=a[o],t[1]=a[o+1],t[2]=a[o+2],o=3*(s+1),e[0]=a[o],e[1]=a[o+1],e[2]=a[o+2],n.operatorLine(t,e)}}}(),u[n.LINE_STRIP]=function(){var t=r.create(),e=r.create();return function(i,r,n,a){for(var s=i;s<i+r-1;++s){var o=3*s;t[0]=a[o],t[1]=a[o+1],t[2]=a[o+2],o=3*(s+1),e[0]=a[o],e[1]=a[o+1],e[2]=a[o+2],n.operatorLine(t,e)}}}(),u[n.LINE_LOOP]=function(){var t=r.create(),e=r.create();return function(i,r,n,a){for(var s=i+r-1,o=i;o<s;++o){var h=3*o;t[0]=a[h],t[1]=a[h+1],t[2]=a[h+2],h=3*(o+1),e[0]=a[h],e[1]=a[h+1],e[2]=a[h+2],n.operatorLine(t,e)}s=3*s,t[0]=a[s],t[1]=a[s+1],t[2]=a[s+2],i=3*i,e[0]=a[i],e[1]=a[i+1],e[2]=a[i+2],n.operatorLine(t,e)}}(),u[n.TRIANGLES]=function(){var t=r.create(),e=r.create(),i=r.create();return function(r,n,a,s){for(var o=r;o<r+n;o+=3){var h=3*o;t[0]=s[h],t[1]=s[h+1],t[2]=s[h+2],h=3*(o+1),e[0]=s[h],e[1]=s[h+1],e[2]=s[h+2],h=3*(o+2),i[0]=s[h],i[1]=s[h+1],i[2]=s[h+2],a.operatorTriangle(t,e,i)}}}(),u[n.TRIANGLE_STRIP]=function(){var t=r.create(),e=r.create(),i=r.create();return function(r,n,a,s){for(var o=2,h=r;o<n;++o,++h){var u=3*h;t[0]=s[u],t[1]=s[u+1],t[2]=s[u+2],u=3*(h+1),e[0]=s[u],e[1]=s[u+1],e[2]=s[u+2],u=3*(h+2),i[0]=s[u],i[1]=s[u+1],i[2]=s[u+2],o%2?a.operatorTriangle(t,i,e):a.operatorTriangle(t,e,i)}}}(),u[n.TRIANGLE_FAN]=function(){var t=r.create(),e=r.create(),i=r.create();return function(r,n,a,s){for(var o=2,h=r+1;o<n;++o,++h){t[0]=s[r],t[1]=s[r+1],t[2]=s[r+2];var u=3*h;e[0]=s[u],e[1]=s[u+1],e[2]=s[u+2],u=3*(h+1),i[0]=s[u],i[1]=s[u+1],i[2]=s[u+2],a.operatorTriangle(t,e,i)}}}(),o.prototype={apply:function(){var t=this._geom,e=t.primitives;if(e)for(var i,r=this._cb(),n=this._vertices,o=e.length,c=0;c<o;c++){var l=e[c];if(l instanceof a){if(i=h[l.getMode()]){var d=l.indices.getElements();i(l.getFirst()/d.BYTES_PER_ELEMENT,l.getCount(),d,r,n)}}else l instanceof s&&(i=u[l.getMode()],i&&i(l.getFirst(),l.getCount(),r,n))}}},t.exports=o},function(t,e,i){"use strict";var r=i(6),n=i(10),a=i(43),s=i(31),o=i(30),h=i(9),u=function(t,e){a.call(this),s.call(this),this._program=null,this._nullProgram=!0,this._vertex=void 0,this._fragment=void 0,this._uniformsCache=void 0,this._attributesCache=void 0,this._activeUniforms=void 0,this._foreignUniforms=void 0,this._trackAttributes=void 0,t&&this.setVertexShader(t),e&&this.setFragmentShader(e),this._dirty=!0},c=function(t){var e={},i=t.match(/attribute\s+\w+\s+\w+/g);if(null!==i)for(var r=0,n=i.length;r<n;r++){var a=i[r].match(/attribute\s+\w+\s+(\w+)/)[1];e[a]=!0}return e};u._sDeletedGLProgramCache=new window.Map,u.deleteGLProgram=function(t,e){u._sDeletedGLProgramCache.has(t)||u._sDeletedGLProgramCache.set(t,[]),u._sDeletedGLProgramCache.get(t).push(e)},u.flushDeletedGLPrograms=function(t,e){if(e<=0)return e;if(!u._sDeletedGLProgramCache.has(t))return e;for(var i=0,r=h.instance().tick(),n=u._sDeletedGLProgramCache.get(t),a=n.length,s=a-1;s>=0&&i<e;s--)t.deleteProgram(n[s]),n.splice(s,1),i=h.instance().deltaS(r,h.instance().tick());return e-i},u.flushAllDeletedGLPrograms=function(t){if(u._sDeletedGLProgramCache.has(t))for(var e=u._sDeletedGLProgramCache.get(t),i=e.length,r=i-1;r>=0;r--)t.deleteProgram(e[r]),e.splice(r,1)},u.prototype=r.objectLibraryClass(r.objectInherit(a.prototype,r.objectInherit(s.prototype,{attributeType:"Program",cloneType:function(){return new u},setVertexShader:function(t){this._vertex=t,this._nullProgram=!1},setFragmentShader:function(t){this._fragment=t,this._nullProgram=!1},getVertexShader:function(){return this._vertex},getFragmentShader:function(){return this._fragment},getProgram:function(){return this._program},setActiveUniforms:function(t){this._activeUniforms=t},getActiveUniforms:function(){return this._activeUniforms},setForeignUniforms:function(t){this._foreignUniforms=t},getForeignUniforms:function(){return this._foreignUniforms},setUniformsCache:function(t){this._uniformsCache=t},getUniformsCache:function(){return this._uniformsCache},setAttributesCache:function(t){this._attributesCache=t},getAttributesCache:function(){return this._attributesCache},setTrackAttributes:function(t){this._trackAttributes=t},getTrackAttributes:function(){return this._trackAttributes},releaseGLObjects:function(){void 0!==this._vertex&&this._vertex.releaseGLObjects(),void 0!==this._fragment&&this._fragment.releaseGLObjects(),null!==this._program&&(void 0!==this._gl&&u.deleteGLProgram(this._gl,this._program),this._program=void 0)},apply:function(t){if(!this._nullProgram){this._gl||this.setGraphicContext(t.getGraphicContext());var e=this._gl;if(!this._program||this._dirty){var i;this._vertex.shader||(i=this._vertex.compile(e)),this._fragment.shader||(i=this._fragment.compile(e));var a=c(this._vertex.getText());if(i&&(this._program=e.createProgram(),a.Vertex&&e.bindAttribLocation(this._program,0,"Vertex"),e.attachShader(this._program,this._vertex.shader),e.attachShader(this._program,this._fragment.shader),r.timeStamp("osgjs.metrics:linkShader"),e.linkProgram(this._program),!e.getProgramParameter(this._program,e.LINK_STATUS)&&!e.isContextLost())){var s=e.getProgramInfoLog(this._program);n.errorFold(s,"can't link program\nvertex shader:\n"+this._vertex.text+"\n fragment shader:\n"+this._fragment.text);var h=void 0!==e.rawgl?e.rawgl:e;void 0!==h&&void 0!==h.getExtension&&(h=h.getExtension("WEBGL_debug_shaders")),h&&"Failed to create D3D shaders.\n"===s&&(n.error(h.getTranslatedShaderSource(this._vertex.shader)),n.error(h.getTranslatedShaderSource(this._fragment.shader))),i=!1}if(!i){if(!u.prototype._failSafeCache){var l=e.createProgram();this._vertex.failSafe(e),this._fragment.failSafe(e),e.attachShader(l,this._vertex.shader),e.attachShader(l,this._fragment.shader),e.linkProgram(l),e.validateProgram(l),u.prototype._failSafeCache=l}n.warn("FailSafe shader Activated "),this._program=this._failSafeCache}this._uniformsCache=new o,this._attributesCache=new o,this.cacheUniformList(e,this._vertex.text),this.cacheUniformList(e,this._fragment.text),this.cacheAttributeList(e,window.Object.keys(a)),this._dirty=!1}t.applyProgram(this._program)}},cacheUniformList:function(t,e){var i=e.match(/uniform\s+\w+\s+\w+((\s)?\[(.*?)\])?/g),r=this._uniformsCache;if(null!==i)for(var n=0,a=i.length;n<a;n++){var s=i[n].match(/uniform\s+\w+\s+(\w+)/)[1],o=i[n].match(/uniform\s+\w+\s+(\w+)(\s?\[.*?\])?/)[1],h=t.getUniformLocation(this._program,s);void 0!==h&&null!==h&&void 0===r[o]&&(r[o]=h,this._uniformsCache.dirty())}},cacheAttributeList:function(t,e){for(var i=this._attributesCache,r=0,n=e.length;r<n;r++){var a=e[r],s=t.getAttribLocation(this._program,a);s!==-1&&void 0!==s&&void 0===i[a]&&(i[a]=s,this._attributesCache.dirty())}}})),"osg","Program"),t.exports=u},function(t,e,i){"use strict";var r=i(10),n=i(6),a=i(9),s=i(43),o=function(t,e){s.call(this);var i=t;"string"==typeof t&&(i=o[t]),this.type=i,this.setText(e)};o.VERTEX_SHADER=35633,o.FRAGMENT_SHADER=35632,o.VS_DBG="attribute vec3 Vertex;uniform mat4 uModelViewMatrix;uniform mat4 uProjectionMatrix;void main(void) {  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex, 1.0);}",o.FS_DBG="precision lowp float; void main(void) { gl_FragColor = vec4(1.0, 0.6, 0.6, 1.0);}";var h="\n#define SHADER_NAME FailSafe\n";o.VS_DBG+=h,o.FS_DBG+=h,o._sDeletedGLShaderCache=new window.Map,o.deleteGLShader=function(t,e){o._sDeletedGLShaderCache.has(t)||o._sDeletedGLShaderCache.set(t,[]),o._sDeletedGLShaderCache.get(t).push(e)},o.flushDeletedGLShaders=function(t,e){if(e<=0)return e;if(!o._sDeletedGLShaderCache.has(t))return e;for(var i=0,r=a.instance().tick(),n=o._sDeletedGLShaderCache.get(t),s=n.length,h=s-1;h>=0&&i<e;h--)t.deleteShader(n[h]),n.splice(h,1),i=a.instance().deltaS(r,a.instance().tick());return e-=i},o.flushAllDeletedGLShaders=function(t){if(o._sDeletedGLShaderCache.has(t))for(var e=o._sDeletedGLShaderCache.get(t),i=e.length,r=i-1;r>=0;r--)t.deleteShader(e[r]),e.splice(r,1)},o.prototype=n.objectInherit(s.prototype,{setText:function(t){this.text=t},getText:function(){return this.text},failSafe:function(t){this.shader=t.createShader(this.type),t.shaderSource(this.shader,this.type===o.VERTEX_SHADER?o.VS_DBG:o.FS_DBG),t.compileShader(this.shader)},processErrors:function(t,e){var i=/ERROR: [\d]+:([\d]+): (.+)/gim,n=e.split("\n"),a=n.length;if(0!==a){var s,o;for(null===i.exec(t)&&(i=/Shader compilation errors\n\((\d+)\, \d+\): (.+)/gim),i.lastIndex=0;null!=(o=i.exec(t));){o.index===i.lastIndex&&i.lastIndex++;var h=parseInt(o[1]);if(!(h>a)){r.error("ERROR "+o[2]+" in line "+h);var u=Math.max(0,h-7),c=Math.max(0,h-2);for(s=u;s<=c;s++)r.warn(n[s].replace(/^[ \t]+/g,""));for(c=Math.max(0,h-1),r.error(n[c].replace(/^[ \t]+/g,"")),u=Math.min(a,h),c=Math.min(a,h+5),s=u;s<c;s++)r.warn(n[s].replace(/^[ \t]+/g,""))}}}},compile:function(t){this._gl||this.setGraphicContext(t),this.shader=t.createShader(this.type);var e=this.text;if(o.enableGLSLOptimizer&&o.glslOptimizer){var i=this.type===o.VERTEX_SHADER?"vertex":"fragment";r.infoFold(i+" shader before optimization",e);var a=o.glslOptimizer(e,"2",this.type===o.VERTEX_SHADER);a.indexOf("Error:")!==-1?r.error(a):a.length<=1?r.warnFold("glsl optimizer returned an empty shader, the original will be used",e):(r.infoFold(i+" shader after optimization",a),e=a)}if(t.shaderSource(this.shader,e),n.timeStamp("osgjs.metrics:compileShader"),t.compileShader(this.shader),!t.getShaderParameter(this.shader,t.COMPILE_STATUS)&&!t.isContextLost()){var s=t.getShaderInfoLog(this.shader);this.processErrors(s,e);for(var h="\n"+e,u=h.split("\n"),c="\n",l=0,d=u.length;l<d;++l)c+=l+" "+u[l]+"\n";return r.debugFold("can't compile shader",c),!1}return!0},releaseGLObjects:function(){void 0!==this._gl&&o.deleteGLShader(this._gl,this.shader),this.shader=void 0}}),t.exports=o},function(t,e,i){"use strict";var r=i(15).vec3,n=i(48),a=i(37),s=i(46),o=i(86),h=i(45),u=i(103),c=i(104),l=i(6),d=function(t,e,i,r,o,u){var c,d,f,p=void 0!==t?t:0,_=void 0!==e?e:0,g=void 0!==i?i:0,m=void 0!==r?r:1,v=void 0!==o?o:1,S=void 0!==u?u:1,x=new a;c=m/2,d=v/2,f=S/2;var b=new l.Float32Array(72),M=new l.Float32Array(48),y=new l.Float32Array(72);b[0]=p-c,b[1]=_-d,b[2]=g+f,y[0]=0,y[1]=-1,y[2]=0,M[0]=0,M[1]=1,b[3]=p-c,b[4]=_-d,b[5]=g-f,y[3]=0,y[4]=-1,y[5]=0,M[2]=0,M[3]=0,b[6]=p+c,b[7]=_-d,b[8]=g-f,
y[6]=0,y[7]=-1,y[8]=0,M[4]=1,M[5]=0,b[9]=p+c,b[10]=_-d,b[11]=g+f,y[9]=0,y[10]=-1,y[11]=0,M[6]=1,M[7]=1,b[12]=p+c,b[13]=_+d,b[14]=g+f,y[12]=0,y[13]=1,y[14]=0,M[8]=0,M[9]=1,b[15]=p+c,b[16]=_+d,b[17]=g-f,y[15]=0,y[16]=1,y[17]=0,M[10]=0,M[11]=0,b[18]=p-c,b[19]=_+d,b[20]=g-f,y[18]=0,y[19]=1,y[20]=0,M[12]=1,M[13]=0,b[21]=p-c,b[22]=_+d,b[23]=g+f,y[21]=0,y[22]=1,y[23]=0,M[14]=1,M[15]=1,b[24]=p+c,b[25]=_-d,b[26]=g+f,y[24]=1,y[25]=0,y[26]=0,M[16]=0,M[17]=1,b[27]=p+c,b[28]=_-d,b[29]=g-f,y[27]=1,y[28]=0,y[29]=0,M[18]=0,M[19]=0,b[30]=p+c,b[31]=_+d,b[32]=g-f,y[30]=1,y[31]=0,y[32]=0,M[20]=1,M[21]=0,b[33]=p+c,b[34]=_+d,b[35]=g+f,y[33]=1,y[34]=0,y[35]=0,M[22]=1,M[23]=1,b[36]=p-c,b[37]=_+d,b[38]=g+f,y[36]=-1,y[37]=0,y[38]=0,M[24]=0,M[25]=1,b[39]=p-c,b[40]=_+d,b[41]=g-f,y[39]=-1,y[40]=0,y[41]=0,M[26]=0,M[27]=0,b[42]=p-c,b[43]=_-d,b[44]=g-f,y[42]=-1,y[43]=0,y[44]=0,M[28]=1,M[29]=0,b[45]=p-c,b[46]=_-d,b[47]=g+f,y[45]=-1,y[46]=0,y[47]=0,M[30]=1,M[31]=1,b[48]=p-c,b[49]=_+d,b[50]=g+f,y[48]=0,y[49]=0,y[50]=1,M[32]=0,M[33]=1,b[51]=p-c,b[52]=_-d,b[53]=g+f,y[51]=0,y[52]=0,y[53]=1,M[34]=0,M[35]=0,b[54]=p+c,b[55]=_-d,b[56]=g+f,y[54]=0,y[55]=0,y[56]=1,M[36]=1,M[37]=0,b[57]=p+c,b[58]=_+d,b[59]=g+f,y[57]=0,y[58]=0,y[59]=1,M[38]=1,M[39]=1,b[60]=p+c,b[61]=_+d,b[62]=g-f,y[60]=0,y[61]=0,y[62]=-1,M[40]=0,M[41]=1,b[63]=p+c,b[64]=_-d,b[65]=g-f,y[63]=0,y[64]=0,y[65]=-1,M[42]=0,M[43]=0,b[66]=p-c,b[67]=_-d,b[68]=g-f,y[66]=0,y[67]=0,y[68]=-1,M[44]=1,M[45]=0,b[69]=p-c,b[70]=_+d,b[71]=g-f,y[69]=0,y[70]=0,y[71]=-1,M[46]=1,M[47]=1;var T=new l.Uint16Array(36);T[0]=0,T[1]=1,T[2]=2,T[3]=0,T[4]=2,T[5]=3,T[6]=4,T[7]=5,T[8]=6,T[9]=4,T[10]=6,T[11]=7,T[12]=8,T[13]=9,T[14]=10,T[15]=8,T[16]=10,T[17]=11,T[18]=12,T[19]=13,T[20]=14,T[21]=12,T[22]=14,T[23]=15,T[24]=16,T[25]=17,T[26]=18,T[27]=16,T[28]=18,T[29]=19,T[30]=20,T[31]=21,T[32]=22,T[33]=20,T[34]=22,T[35]=23,x.getAttributes().Vertex=new n(n.ARRAY_BUFFER,b,3),x.getAttributes().Normal=new n(n.ARRAY_BUFFER,y,3),x.getAttributes().TexCoord0=new n(n.ARRAY_BUFFER,M,2);var w=new h(s.TRIANGLES,new n(n.ELEMENT_ARRAY_BUFFER,T,1));return x.getPrimitives().push(w),x},f=function(){var t=new a,e=new l.Float32Array([-1,-1,-1,4,4,-1]),i=new l.Float32Array([-1,-1,-1,4,4,-1]),r=new l.Uint16Array(3);r[0]=2,r[1]=1,r[2]=0,t.getAttributes().Vertex=new n(n.ARRAY_BUFFER,i,2),t.getAttributes().TexCoord0=new n(n.ARRAY_BUFFER,e,2);var o=new h(s.TRIANGLES,new n(n.ELEMENT_ARRAY_BUFFER,r,1));return t.getPrimitives().push(o),function(){return t}}(),p=function(t,e,i,o,u,c,d,f,p,_,g,m,v){void 0===m&&void 0===v&&(m=_,v=g,_=0,g=0);var S=new a,x=new l.Float32Array(12);x[0]=t+d,x[1]=e+f,x[2]=i+p,x[3]=t,x[4]=e,x[5]=i,x[6]=t+o,x[7]=e+u,x[8]=i+c,x[9]=t+o+d,x[10]=e+u+f,x[11]=i+c+p,void 0===m&&(m=1),void 0===v&&(v=1);var b=new l.Float32Array(8);b[0]=_,b[1]=v,b[2]=_,b[3]=g,b[4]=m,b[5]=g,b[6]=m,b[7]=v;var M=r.fromValues(o,u,c);r.cross(M,M,r.fromValues(d,f,p)),r.normalize(M,M);var y=new l.Float32Array(12);y[0]=M[0],y[1]=M[1],y[2]=M[2],y[3]=M[0],y[4]=M[1],y[5]=M[2],y[6]=M[0],y[7]=M[1],y[8]=M[2],y[9]=M[0],y[10]=M[1],y[11]=M[2];var T=new l.Uint16Array(6);T[0]=0,T[1]=1,T[2]=2,T[3]=0,T[4]=2,T[5]=3,S.getAttributes().Vertex=new n(n.ARRAY_BUFFER,x,3),S.getAttributes().Normal=new n(n.ARRAY_BUFFER,y,3),S.getAttributes().TexCoord0=new n(n.ARRAY_BUFFER,b,2);var w=new h(s.TRIANGLES,new n(n.ELEMENT_ARRAY_BUFFER,T,1));return S.getPrimitives().push(w),S},_=function(t){void 0===t&&(t=5),void 0===_.getShader&&(_.getShader=function(){if(void 0===_.getShader.program){var t=["#ifdef GL_ES","precision highp float;","#endif","attribute vec3 Vertex;","attribute vec4 Color;","uniform mat4 uModelViewMatrix;","uniform mat4 uProjectionMatrix;","","varying vec4 vColor;","","void main(void) {","  gl_Position = uProjectionMatrix * (uModelViewMatrix * vec4(Vertex, 1.0));","  vColor = Color;","}"].join("\n"),e=["#ifdef GL_ES","precision highp float;","#endif","varying vec4 vColor;","void main(void) {","gl_FragColor = vColor;","}"].join("\n"),i=new u(new c("VERTEX_SHADER",t),new c("FRAGMENT_SHADER",e));_.getShader.program=i}return _.getShader.program});var e=new a,i=new l.Float32Array(18);i[3]=t,i[10]=t,i[17]=t;var r=new l.Float32Array(24);r[0]=r[3]=1,r[4]=r[7]=1,r[9]=r[11]=1,r[13]=r[15]=1,r[18]=r[19]=1,r[22]=r[23]=1,e.getAttributes().Vertex=new n(n.ARRAY_BUFFER,i,3),e.getAttributes().Color=new n(n.ARRAY_BUFFER,r,4);var h=new o(s.LINES,0,6);return e.getPrimitives().push(h),e.getOrCreateStateSet().setAttributeAndModes(_.getShader()),e},g=function(t,e,i,u,c,d,f){t=t||50,u=void 0!==u?u:0,c=void 0!==c?c:2*Math.PI,d=void 0!==d?d:0,f=void 0!==f?f:Math.PI;for(var p=Math.max(3,Math.floor(e)||8),_=Math.max(2,Math.floor(i)||6),g=p*_/3>=65536,m=g?p*_*6:p*_*4,v=new l.Float32Array(3*m),S=new l.Float32Array(3*m),x=new l.Float32Array(2*m),b=g?void 0:new l.Uint16Array(p*_*6),M=0,y=0,T=new l.Float32Array(3),w=new l.Float32Array(3),C=new l.Float32Array(3),A=new l.Float32Array(3),E=new l.Float32Array(3),I=new l.Float32Array(3),F=new l.Float32Array(3),R=new l.Float32Array(3),N=new l.Float32Array(2),D=new l.Float32Array(2),L=new l.Float32Array(2),P=new l.Float32Array(2),O=function(e,i,n,a,s){n[0]=-t*Math.cos(u+e*c)*Math.sin(d+i*f),n[1]=t*Math.cos(d+i*f),n[2]=t*Math.sin(u+e*c)*Math.sin(d+i*f),r.normalize(a,n),s[0]=e,s[1]=1-i},k=0;k<_;k++)for(var V=0;V<p;V++){O((V+1)/p,k/_,T,E,N),O(V/p,k/_,w,I,D),O(V/p,(k+1)/_,C,F,L),O((V+1)/p,(k+1)/_,A,R,P);var B=3*M;v[B]=T[0],v[B+1]=T[1],v[B+2]=T[2],v[B+3]=w[0],v[B+4]=w[1],v[B+5]=w[2],v[B+6]=C[0],v[B+7]=C[1],v[B+8]=C[2],S[B]=E[0],S[B+1]=E[1],S[B+2]=E[2],S[B+3]=I[0],S[B+4]=I[1],S[B+5]=I[2],S[B+6]=F[0],S[B+7]=F[1],S[B+8]=F[2];var U=2*M;if(x[U]=N[0],x[U+1]=N[1],x[U+2]=D[0],x[U+3]=D[1],x[U+4]=L[0],x[U+5]=L[1],M+=3,g)B=3*M,v[B]=T[0],v[B+1]=T[1],v[B+2]=T[2],v[B+3]=C[0],v[B+4]=C[1],v[B+5]=C[2],v[B+6]=A[0],v[B+7]=A[1],v[B+8]=A[2],S[B]=E[0],S[B+1]=E[1],S[B+2]=E[2],S[B+3]=F[0],S[B+4]=F[1],S[B+5]=F[2],S[B+6]=R[0],S[B+7]=R[1],S[B+8]=R[2],U=2*M,x[U]=N[0],x[U+1]=N[1],x[U+2]=L[0],x[U+3]=L[1],x[U+4]=P[0],x[U+5]=P[1],M+=3;else{B=3*M,v[B]=A[0],v[B+1]=A[1],v[B+2]=A[2],S[B]=R[0],S[B+1]=R[1],S[B+2]=R[2],U=2*M,x[U]=P[0],x[U+1]=P[1];var G=3*y,z=M-3;b[G]=z,b[G+1]=z+1,b[G+2]=z+2,b[G+3]=z,b[G+4]=z+2,b[G+5]=z+3,y+=2,M+=1}}var j=new a;return j.getAttributes().Vertex=new n("ARRAY_BUFFER",v,3),j.getAttributes().Normal=new n("ARRAY_BUFFER",S,3),j.getAttributes().TexCoord0=new n("ARRAY_BUFFER",x,2),g?j.getPrimitives().push(new o(s.TRIANGLES,0,v.length/3)):j.getPrimitives().push(new h(s.TRIANGLES,new n("ELEMENT_ARRAY_BUFFER",b,1))),j},m=function(t,e,i,r,h,u,c,l,d,f,p){t=void 0!==t?t:-.5,e=void 0!==e?e:-.5,i=void 0!==i?i:0,r=void 0!==r?r:1,h=void 0!==h?h:0,u=void 0!==u?u:0,c=void 0!==c?c:0,l=void 0!==l?l:1,d=void 0!==d?d:0,f=void 0!==f?f:5,p=void 0!==p?p:f,f+=2,p+=2;var _=new a,g=new Float32Array(2*(f+p)*3),m=0,v=0,S=r/(f-1),x=h/(f-1),b=u/(f-1),M=t+r+c,y=e+h+l,T=i+u+d;for(m=0;m<f;++m)v=6*m,g[v]=t+S*m,g[v+1]=e+x*m,g[v+2]=i+b*m,g[v+3]=M-S*(f-m-1),g[v+4]=y-x*(f-m-1),g[v+5]=T-b*(f-m-1);for(S=c/(p-1),x=l/(p-1),b=d/(p-1),m=0;m<p;++m)v=6*(f+m),g[v]=t+S*m,g[v+1]=e+x*m,g[v+2]=i+b*m,g[v+3]=M-S*(p-m-1),g[v+4]=y-x*(p-m-1),g[v+5]=T-b*(p-m-1);_.getAttributes().Vertex=new n(n.ARRAY_BUFFER,g,3);var w=new o(s.LINES,0,2*(f+p));return _.getPrimitives().push(w),_},v=function(t){var e=new a,i=new Float32Array([-.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,-.5,.5,-.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5]);e.getAttributes().Vertex=new n(n.ARRAY_BUFFER,i,3),t||(t=[1,0,0,1]);for(var r=new l.Float32Array(32),o=0;o<8;o++)for(var u=0;u<4;u++)r[3*o+u]=t[u];e.getAttributes().Color=new n(n.ARRAY_BUFFER,r,4);var c=new l.Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);return e.getPrimitives().push(new h(s.LINES,new n("ELEMENT_ARRAY_BUFFER",c,1))),e};t.exports={createTexturedBoxGeometry:d,createTexturedQuadGeometry:p,createTexturedSphereGeometry:g,createTexturedFullScreenFakeQuadGeometry:f,createAxisGeometry:_,createTexturedSphere:g,createGridGeometry:m,createBoundingBoxGeometry:v}},function(t,e){"use strict";var i=function(){this.globalDefault=void 0,this.lastApplied=void 0,this.asChanged=!1,this._values=[],this._back=void 0};i.prototype={empty:function(){return 0===this._values.length},values:function(){return this._values},back:function(){return this._back},push:function(t){this._values.push(t),this._back=t},pop:function(){var t=this._values.pop();return this._back=this._values[this._values.length-1],t}},t.exports=i},function(t,e,i){"use strict";var r=i(30),n=i(15).mat4,a=i(10),s=i(13),o=i(103),h=i(31),u=i(106),c=i(41),l=i(6),d=i(38),f=[void 0,function(t,e){return t[0]===e[0]||(e[0]=t[0],!1)},function(t,e){return t[0]===e[0]&&t[1]===e[1]||(e[0]=t[0],e[1]=t[1],!1)},function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]||(e[0]=t[0],e[1]=t[1],e[2]=t[2],!1)},function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]||(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],!1)}],p=function(t){s.call(this),this._graphicContext=void 0,this._shaderGeneratorProxy=t,void 0===t&&console.break(),this._currentVAO=null,this._currentIndexVBO=null,this.vertexAttribList=[],this.stateSets=new u,this._shaderGeneratorNames=new u,this.uniforms=new r,this.textureAttributeMapList=[],this.attributeMap=new r,this.modelMatrix=c.createMatrix4(n.create(),"uModelMatrix"),this.viewMatrix=c.createMatrix4(n.create(),"uViewMatrix"),this.modelViewMatrix=c.createMatrix4(n.create(),"uModelViewMatrix"),this.projectionMatrix=c.createMatrix4(n.create(),"uProjectionMatrix"),this.modelViewNormalMatrix=c.createMatrix4(n.create(),"uModelViewNormalMatrix");var e=new u;e.globalDefault=c.createFloat1(0,"uArrayColorEnabled"),this.uniforms.setMap({ArrayColorEnabled:e}),this._previousColorAttribPair={},this.vertexAttribMap={},this.vertexAttribMap._disable=[],this.vertexAttribMap._keys=[],this._frameStamp=void 0,this._programCommonUniformsCache={},this._modelViewMatrix=void 0,this._projectionMatrix=void 0,this._program=void 0,this.applyAttribute(new o),this._numPushStateSet=0,this._numApply=0,this._programUniformCache=[],this._cacheUniformId=0};p.prototype=l.objectLibraryClass(l.objectInherit(s.prototype,{getCacheUniformsApplyRenderLeaf:function(){return this._programCommonUniformsCache},setGraphicContext:function(t){this._graphicContext=t,this._extVAO=d.instance(t).getWebGLExtension("OES_vertex_array_object")},getGraphicContext:function(){return this._graphicContext},getShaderGeneratorProxy:function(){return this._shaderGeneratorProxy},pushCheckOverride:function(t,e,i){0===t.values().length?t.push(this.getObjectPair(e,i)):t.back().value&h.OVERRIDE&&!(i&h.PROTECTED)?t.push(t.back()):t.push(this.getObjectPair(e,i))},pushStateSet:function(t){if(this._numPushStateSet++,this.stateSets.push(t),t.attributeMap&&this.pushAttributeMap(this.attributeMap,t.attributeMap),t.textureAttributeMapList)for(var e=t.textureAttributeMapList,i=0,r=e.length;i<r;i++)if(e[i]){var n=this.getOrCreateTextureAttributeMap(i);this.pushAttributeMap(n,e[i])}t.uniforms&&this.pushUniformsList(this.uniforms,t.uniforms);var a=t.getShaderGeneratorPair();a&&this.pushCheckOverride(this._shaderGeneratorNames,a.getShaderGeneratorName(),a.getValue())},getStateSetStackSize:function(){return this.stateSets.values().length},insertStateSet:function(){var t=[];return function(e,i){t.length=0;for(var r=this.getStateSetStackSize();r>e;)t.push(this.stateSets.back()),this.popStateSet(),r--;this.pushStateSet(i);for(var n=t.length-1;n>=0;n--)this.pushStateSet(t[n])}}(),removeStateSet:function(){var t=[];return function(e){var i=this.getStateSetStackSize();if(e>=i)return void a.warn("Warning State:removeStateSet "+e+" out of range");for(t.length=0;i-1>e;)t.push(this.stateSets.back()),this.popStateSet(),i--;this.popStateSet();for(var r=t.length-1;r>=0;r--)this.pushStateSet(t[r])}}(),resetCacheFrame:function(){this._modelViewMatrix=this._projectionMatrix=void 0},resetStats:function(){this._numApply=0,this._numPushStateSet=0},applyProgram:function(t){this._program!==t&&(this._program=t,this.getGraphicContext().useProgram(t))},applyModelViewMatrix:function(){var t=n.create();return function(e){if(this._modelViewMatrix===e)return!1;var i=this.getLastProgramApplied(),r=i.getUniformsCache(),a=this.modelViewMatrix,s=r.uModelViewMatrix,o=this.getGraphicContext();s&&(a.setMatrix4(e),a.apply(o,s));var h;if(this._modelViewMatrix){for(var u=this._modelViewMatrix,c=0;c<11;c++)if(e[c]!==u[c]){h=!0;break}}else h=!0;return h&&(a=this.modelViewNormalMatrix,s=r.uModelViewNormalMatrix,s&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[8]=e[8],t[9]=e[9],t[10]=e[10],n.invert(t,t),n.transpose(t,t),a.setMatrix4(t),a.apply(o,s))),this._modelViewMatrix=e,!0}}(),applyModelViewMatrixEperiment:function(){var t=n.create(),e=function(t,e){return t[0]!==e[0]||(t[1]!==e[1]||(t[2]!==e[2]||(t[4]!==e[4]||(t[5]!==e[5]||(t[6]!==e[6]||(t[8]!==e[8]||(t[9]!==e[9]||t[10]!==e[10])))))))},i=1e-6,r=1+i,a=1-i;return function(i){if(this._modelViewMatrix===i)return!1;var s=this.getLastProgramApplied(),o=this.modelViewMatrix,h=s.getUniformsCache().uModelViewMatrix;h&&(o.setMatrix4(i),o.apply(this.getGraphicContext(),h));var u=!0;if(this._modelViewMatrix&&(u=e(i,this._modelViewMatrix)),u&&(o=this.modelViewNormalMatrix,h=s.getUniformsCache().uModelViewNormalMatrix)){t[0]=i[0],t[1]=i[1],t[2]=i[2],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[8]=i[8],t[9]=i[9],t[10]=i[10];var c=t[0]*t[0]+t[4]*t[4]+t[8]*t[8],l=t[1]*t[1]+t[5]*t[5]+t[9]*t[9],d=t[2]*t[2]+t[6]*t[6]+t[10]*t[10];(c>r||c<a||l>r||l<a||d>r||d<a)&&(n.invert(t,t),n.transpose(t,t)),o.setMatrix4(t),o.apply(this.getGraphicContext(),h)}return this._modelViewMatrix=i,!0}}(),applyProjectionMatrix:function(t){if(this._projectionMatrix!==t){this._projectionMatrix=t;var e=this.getLastProgramApplied(),i=this.projectionMatrix,r=e.getUniformsCache()[i.getName()];r&&(i.setMatrix4(t),i.apply(this.getGraphicContext(),r))}},applyStateSet:function(t){this.pushStateSet(t),this.apply(),this.popStateSet()},popAllStateSets:function(){for(;this.stateSets.values().length;)this.popStateSet()},popStateSet:function(){if(!this.stateSets.empty()){var t=this.stateSets.pop();if(t.attributeMap&&this.popAttributeMap(this.attributeMap,t.attributeMap),t.textureAttributeMapList)for(var e=t.textureAttributeMapList,i=0,r=e.length;i<r;i++)e[i]&&this.popAttributeMap(this.textureAttributeMapList[i],e[i]);t.uniforms&&this.popUniformsList(this.uniforms,t.uniforms),t.getShaderGeneratorPair()&&this._shaderGeneratorNames.pop()}},_createAttributeStack:function(t,e,i){var r=new u;return t[e]=r,t[e].globalDefault=i,t.dirty(),r},haveAppliedAttribute:function(t){var e=t.getTypeMember(),i=this.attributeMap[e];i||(i=this._createAttributeStack(this.attributeMap,e,t.cloneType())),i.lastApplied=t,i.asChanged=!0},applyAttribute:function(t){var e=t.getTypeMember(),i=this.attributeMap,r=i[e];r||(r=this._createAttributeStack(this.attributeMap,e,t.cloneType())),r.lastApplied!==t&&(t.apply&&t.apply(this),r.lastApplied=t,r.asChanged=!0)},applyTextureAttribute:function(t,e){var i=this.getGraphicContext();i.activeTexture(i.TEXTURE0+t);var n=e.getTypeMember();this.textureAttributeMapList[t]||(this.textureAttributeMapList[t]=new r);var a=this.getOrCreateTextureAttributeMap(t),s=a[n];s||(s=this._createAttributeStack(a,n,e.cloneType())),s.lastApplied!==e&&(e.apply&&e.apply(this,t),s.lastApplied=e,s.asChanged=!0)},getLastProgramApplied:function(){return this.attributeMap.Program.lastApplied},applyDefault:function(){this.popAllStateSets(),this.applyAttributeMap(this.attributeMap),this.applyTextureAttributeMapList(this.textureAttributeMapList)},apply:function(){var t=this.getLastProgramApplied();this.applyAttributeMap(this.attributeMap),this.applyTextureAttributeMapList(this.textureAttributeMapList);var e=this._generateAndApplyProgram();e?this._applyGeneratedProgramUniforms(this.attributeMap.Program.lastApplied):this._applyCustomProgramUniforms(this.attributeMap.Program.lastApplied),t!==this.getLastProgramApplied()&&(this._modelViewMatrix=void 0,this._projectionMatrix=void 0)},applyAttributeMap:function(t){for(var e,i=t.getKeys(),r=0,n=i.length;r<n;r++){var s=i[r];if(e=t[s],e&&e.asChanged){var o;o=0===e.values().length?e.globalDefault:e.back().object,a.assert(s===o.getTypeMember(),"State:applyAttributeMap attribute key "+s+" !== "+o.getTypeMember()),e.lastApplied!==o&&(o.apply&&o.apply(this),e.lastApplied=o),e.asChanged=!1}}},getObjectPair:function(t,e){return{object:t,value:e}},pushUniformsList:function(t,e){for(var i,r,n=e.getKeys(),a=0,s=n.length;a<s;a++){var o=n[a],h=e[o];r=h.getUniform(),i=r.getName(),t[i]||this._createAttributeStack(t,i,r),this.pushCheckOverride(t[i],r,h.getValue())}},popUniformsList:function(t,e){for(var i=e.getKeys(),r=0,n=i.length;r<n;r++){var a=i[r];t[a].pop()}},_applyTextureAttributeStack:function(t,e,i){var r;r=0===i.values().length?i.globalDefault:i.back().object,i.lastApplied!==r&&(t.activeTexture(t.TEXTURE0+e),r.apply(this,e),i.lastApplied=r),i.asChanged=!1},applyTextureAttributeMapList:function(t){for(var e,i=this._graphicContext,r=0,n=t.length;r<n;r++)if(e=t[r])for(var a=e.getKeys(),s=0,o=a.length;s<o;s++){var h=a[s],u=e[h];u&&u.asChanged&&this._applyTextureAttributeStack(i,r,u)}},setGlobalDefaultAttribute:function(t){var e=t.getTypeMember(),i=this.attributeMap;void 0===i[e]?this._createAttributeStack(i,e,t):i[e].globalDefault=t},getGlobalDefaultAttribute:function(t){var e=this.attributeMap;if(void 0!==e[t])return e[t].globalDefault},setGlobalDefaultTextureAttribute:function(t,e){var i=this.getOrCreateTextureAttributeMap(t),r=e.getTypeMember();void 0===i[r]?this._createAttributeStack(i,r,e):i[r].globalDefault=e},getGlobalDefaultTextureAttribute:function(t,e){var i=this.getOrCreateTextureAttributeMap(t),r=i[e];return r.globalDefault},getOrCreateTextureAttributeMap:function(t){return this.textureAttributeMapList[t]||(this.textureAttributeMapList[t]=new r),this.textureAttributeMapList[t]},pushAttributeMap:function(t,e){for(var i,r=e.getKeys(),n=0,a=r.length;n<a;n++){var s=r[n],o=e[s],h=o.getAttribute();void 0===t[s]&&this._createAttributeStack(t,s,h.cloneType()),i=t[s],this.pushCheckOverride(i,h,o.getValue()),i.asChanged=!0}},popAttributeMap:function(t,e){for(var i,r=e.getKeys(),n=0,a=r.length;n<a;n++){var s=r[n];i=t[s],i.pop(),i.asChanged=!0}},setIndexArray:function(t){var e=this._graphicContext;this._currentIndexVBO!==t&&(t.bind(e),this._currentIndexVBO=t),t.isDirty()&&t.compile(e)},lazyDisablingOfVertexAttributes:function(){for(var t=this.vertexAttribMap._keys,e=0,i=t.length;e<i;e++){var r=t[e];this.vertexAttribMap[r]&&(this.vertexAttribMap._disable[r]=!0)}},enableVertexColor:function(){var t=this.attributeMap.Program.lastApplied;if(t.getUniformsCache().uArrayColorEnabled&&t.getAttributesCache().Color){var e=this.uniforms.ArrayColorEnabled.globalDefault,i=this._previousColorAttribPair[t.getInstanceID()];i||(e.setFloat(1),e.apply(this.getGraphicContext(),t.getUniformsCache().uArrayColorEnabled),this._previousColorAttribPair[t.getInstanceID()]=!0)}},disableVertexColor:function(){var t=this.attributeMap.Program.lastApplied;if(t.getUniformsCache().uArrayColorEnabled&&t.getAttributesCache().Color){var e=this.uniforms.ArrayColorEnabled.globalDefault,i=this._previousColorAttribPair[t.getInstanceID()];i&&(e.setFloat(0),e.apply(this.getGraphicContext(),t.getUniformsCache().uArrayColorEnabled),this._previousColorAttribPair[t.getInstanceID()]=!1)}},applyDisablingOfVertexAttributes:function(){for(var t=this.vertexAttribMap._keys,e=0,i=t.length;e<i;e++)if(this.vertexAttribMap._disable[t[e]]===!0){var r=t[e];this._graphicContext.disableVertexAttribArray(r),this.vertexAttribMap._disable[r]=!1,this.vertexAttribMap[r]=!1}},clearVertexAttribCache:function(){for(var t=this.vertexAttribMap,e=t._keys,i=0,r=e.length;i<r;i++){var n=e[i];t[n]=void 0,t._disable[n]=!1}this.vertexAttribMap._disable.length=0,this.vertexAttribMap._keys.length=0},setVertexArrayObject:function(t){return this._currentVAO!==t&&(this._extVAO.bindVertexArrayOES(t),this._currentVAO=t,t||this.clearVertexAttribCache(),this._currentIndexVBO=void 0,!0)},setVertexAttribArray:function(t,e,i){var r=this.vertexAttribMap;r._disable[t]=!1;var n=this._graphicContext,a=!1;e.isDirty()&&(e.bind(n),e.compile(n),a=!0);var s=r[t];s!==e&&(a||e.bind(n),s||(n.enableVertexAttribArray(t),void 0===s&&r._keys.push(t)),r[t]=e,n.vertexAttribPointer(t,e.getItemSize(),e.getType(),i,0,0))},_getActiveUniformsFromProgramAttributes:function(t,e){var i=this.attributeMap,r=t.getTrackAttributes().attributeKeys;if(r.length>0)for(var n=0,a=r.length;n<a;n++){var s=r[n],o=i[s];if(void 0!==o){var h=o.globalDefault;if(void 0!==h.getOrCreateUniforms)for(var u=h.getOrCreateUniforms(),c=u.getKeys(),l=0,d=c.length;l<d;l++)e.push(u[c[l]])}}},_getActiveUniformsFromProgramTextureAttributes:function(t,e){var i=t.getTrackAttributes().textureAttributeKeys;if(void 0!==i)for(var r=0,n=i.length;r<n;r++){var a=i[r];if(void 0!==a){var s=this.textureAttributeMapList[r];if(void 0!==s)for(var o=0,h=a.length;o<h;o++){var u=a[o],c=s[u];if(void 0!==c){var l=c.globalDefault;if(void 0!==l.getOrCreateUniforms)for(var d=l.getOrCreateUniforms(),f=d.getKeys(),p=0,_=f.length;p<_;p++)e.push(d[f[p]])}}}}},_cacheUniformsForCustomProgram:function(t,e){this._getActiveUniformsFromProgramAttributes(t,e),this._getActiveUniformsFromProgramTextureAttributes(t,e);for(var i=this._graphicContext,n=new r,a=0,s=e.length;a<s;a++){var o=e[a],h=o.getName(),u=i.getUniformLocation(t._program,h);void 0!==u&&null!==u&&(n[h]=o)}n.dirty(),t.trackUniforms=n},_applyCustomProgramUniforms:function(){var t=[];return function(e){t.length=0,void 0!==e.getTrackAttributes()&&void 0===e.trackUniforms&&this._cacheUniformsForCustomProgram(e,t);var i,r=e.getUniformsCache(),n=r.getKeys(),a=this.uniforms;e.trackUniforms&&(i=e.trackUniforms);for(var s,o=0,h=n.length;o<h;o++){var u=n[o],c=r[u],l=a[u];void 0===l?void 0!==i&&(s=i[u],void 0!==s&&s.apply(this._graphicContext,c)):(s=0===l.values().length?l.globalDefault:l.back().object,s.apply(this._graphicContext,c))}}}(),_generateAndApplyProgram:function(){var t=this.attributeMap;if(void 0===t.Program||0===t.Program.values().length||t.Program.back().value===h.OFF){var e=this._shaderGeneratorNames.back(),i=this._shaderGeneratorProxy.getShaderGenerator(e?e.object:void 0),r=i.getOrCreateProgram(this);return this.applyAttribute(r),r}},_computeForeignUniforms:function(t,e){for(var i=t.getKeys(),r=t,n=[],a=0,s=i.length;a<s;a++){var o=i[a],h=r[o];void 0!==h&&void 0===e[o]&&o!==this.modelViewMatrix.getName()&&o!==this.modelMatrix.getName()&&o!==this.viewMatrix.getName()&&o!==this.projectionMatrix.getName()&&o!==this.modelViewNormalMatrix.getName()&&"uArrayColorEnabled"!==o&&n.push(o)}return n},_removeUniformsNotRequiredByProgram:function(t,e){for(var i=t.getKeys(),r=0,n=i.length;r<n;r++){var a=i[r],s=e[a];void 0!==s&&null!==s||(delete t[a],t.dirty())}},_cacheUniformsForGeneratedProgram:function(t){var e=this._computeForeignUniforms(t.getUniformsCache(),t.getActiveUniforms());t.setForeignUniforms(e),this._removeUniformsNotRequiredByProgram(t.getActiveUniforms(),t.getUniformsCache())},_copyUniformEntry:function(t){var e,i=t.getInternalArray();return i.length<16&&(e=new i.constructor(i.length)),e},_initUniformCache:function(t){var e,i,r,n,a,s,o=t.getActiveUniforms(),h=o.getKeys(),u=t.getForeignUniforms(),c=this.uniforms,l=[],d=[];if(t._cacheUniformId=this._cacheUniformId++,this._programUniformCache[t._cacheUniformId]={},u.length)for(r=l,e=0,i=u.length;e<i;e++){n=u[e];var f=c[n];f&&(s=f.globalDefault,a=this._copyUniformEntry(s),r.push(a))}if(h.length)for(r=d,e=0,i=h.length;e<i;e++)n=h[e],s=o[n],a=this._copyUniformEntry(s),r.push(a);this._programUniformCache[t._cacheUniformId].foreign=l,this._programUniformCache[t._cacheUniformId].active=d},_checkCacheAndApplyUniform:function(t,e,i,r,n){var a,s=t.getInternalArray(),o=s.length;if(o<=4){var h=e[i];a=f[o](s,h)}else a=!1;if(!a){var u=r[n];t.apply(this._graphicContext,u)}},_applyGeneratedProgramUniforms:function(t){var e=t.getForeignUniforms();e||(this._cacheUniformsForGeneratedProgram(t),e=t.getForeignUniforms(),this._initUniformCache(t));var i,r,n,s,o=t.getUniformsCache(),h=t.getActiveUniforms(),u=this._programUniformCache[t._cacheUniformId].active,c=this._programUniformCache[t._cacheUniformId].foreign,l=h.getKeys();for(i=0,r=l.length;i<r;i++)n=l[i],s=h[n],this._checkCacheAndApplyUniform(s,u,i,o,n);var d=this.uniforms;for(i=0,r=e.length;i<r;i++){n=e[i];var f=d[n];void 0!==f&&(0===f.values().length?(s=f.globalDefault,a.warn("Uniform Default Not attached to a StateSet in Scene Hierarchy: "+f.globalDefault.getName())):s=f.back().object),this._checkCacheAndApplyUniform(s,c,i,o,n)}},_setStateSetsDrawID:function(t){for(var e=this.stateSets.values(),i=0,r=e.length;i<r;i++)e[i].setDrawID(t)},_stateSetStackChanged:function(t,e){var i=this.stateSets.values(),r=i.length;if(e!==r)return!0;for(var n=0;n<r;n++)if(t!==i[n].getDrawID())return!0;return!1}}),"osg","State"),t.exports=p},function(t,e,i){"use strict";var r=i(6),n=i(42),a=i(10),s=i(40),o=function(){s.call(this),this._images={};for(var t=0;t<6;t++)this._images[s.TEXTURE_CUBE_MAP_POSITIVE_X+t]=new n};o.prototype=r.objectLibraryClass(r.objectInherit(s.prototype,{setDefaultParameters:function(){s.prototype.setDefaultParameters.call(this),this._textureTarget=s.TEXTURE_CUBE_MAP,this._flipY=!1},cloneType:function(){return new o},setImage:function(t,e,i){var r=t;"string"==typeof r&&(r=s[r]),this._images[r].setImage(e,i),this.setImageFormat(i),this.setTextureSize(this._images[r].getWidth(),this._images[r].getHeight()),this._textureNull=!1,this.dirty()},getImage:function(t){return this._images[t].getImage()},initCubemapContent:function(t){var e=this._internalFormat;return this.applyTexImage2D(t,t.TEXTURE_CUBE_MAP_POSITIVE_X,0,e,this._textureWidth,this._textureHeight,0,e,this._type,null),this.applyTexImage2D(t,t.TEXTURE_CUBE_MAP_NEGATIVE_X,0,e,this._textureWidth,this._textureHeight,0,e,this._type,null),this.applyTexImage2D(t,t.TEXTURE_CUBE_MAP_POSITIVE_Y,0,e,this._textureWidth,this._textureHeight,0,e,this._type,null),this.applyTexImage2D(t,t.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,e,this._textureWidth,this._textureHeight,0,e,this._type,null),this.applyTexImage2D(t,t.TEXTURE_CUBE_MAP_POSITIVE_Z,0,e,this._textureWidth,this._textureHeight,0,e,this._type,null),this.applyTexImage2D(t,t.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,e,this._textureWidth,this._textureHeight,0,e,this._type,null),!0},generateMipmap:function(t,e){if(this.hasMipmapFilter()){if(this._images[s.TEXTURE_CUBE_MAP_POSITIVE_X].hasMipmap())for(var i=0;i<6;i++){var r=this._images[s.TEXTURE_CUBE_MAP_POSITIVE_X+i];r.hasMipmap()||a.error("mipmap not set correctly for TextureCubemap");for(var n=this._internalFormat,o=1;o<r.getMipmap().length;o++){var h=r.getMipmap()[o].getWidth();this.applyTexImage2D(t,t.TEXTURE_CUBE_MAP_POSITIVE_X+i,o,n,h,h,0,n,this._type,r.getMipmap()[o].getImage())}}else t.generateMipmap(e);this._dirtyMipmap=!1}},applyImageTarget:function(t,e,i){var r=this._images[i];return r.getImage()&&r.isReady()?r.isDirty()?(this.setTextureSize(r.getWidth(),r.getHeight()),r.setDirty(!1),r.isTypedArray()?this.applyTexImage2D(t,i,0,e,this._textureWidth,this._textureHeight,0,e,this._type,r.getImage()):this.applyTexImage2D(t,i,0,e,e,this._type,r.getImage()),!this._unrefImageDataAfterApply||this.hasMipmap()&&r.hasMipmap()||r.release(),1):1:0},initCubemapContentImage:function(t){var e=this._internalFormat,i=0;return i+=this.applyImageTarget(t,e,t.TEXTURE_CUBE_MAP_POSITIVE_X),i+=this.applyImageTarget(t,e,t.TEXTURE_CUBE_MAP_NEGATIVE_X),i+=this.applyImageTarget(t,e,t.TEXTURE_CUBE_MAP_POSITIVE_Y),i+=this.applyImageTarget(t,e,t.TEXTURE_CUBE_MAP_NEGATIVE_Y),i+=this.applyImageTarget(t,e,t.TEXTURE_CUBE_MAP_POSITIVE_Z),i+=this.applyImageTarget(t,e,t.TEXTURE_CUBE_MAP_NEGATIVE_Z),6===i},apply:function(t){var e=t.getGraphicContext();if(this._dirtyTextureObject&&this.releaseGLObjects(),void 0===this._textureObject||this.isDirty())if(this._textureNull)e.bindTexture(this._textureTarget,null);else{this._textureObject||(this.computeTextureFormat(),this.init(t)),this._textureObject.bind(e);var i;i=this._images[s.TEXTURE_CUBE_MAP_POSITIVE_X].getImage()?this.initCubemapContentImage(e):this.initCubemapContent(e),i&&(this._dirty=!1,this.applyFilterParameter(e,this._textureTarget),this.generateMipmap(e,this._textureTarget))}else this._textureObject.bind(e),this.isDirtyMipmap()&&this.generateMipmap(e,this._textureTarget)}}),"osg","TextureCubeMap"),r.setTypeID(o),t.exports=o},function(t,e,i){"use strict";var r=i(6),n=i(32),a=function(){n.call(this),this.visitorType=n.UPDATE_VISITOR,this._numUpdateCallback=0};a.prototype=r.objectInherit(n.prototype,{resetStats:function(){this._numUpdateCallback=0},apply:function(t){var e=t.getStateSet();if(e&&e.requiresUpdateTraversal()){var i=e.getUpdateCallbackList(),r=i.length;if(r){this._numUpdateCallback+=r;for(var n=0,a=r;n<a;n++)i[n].update(e,this)}}for(var s=t.getUpdateCallbackList(),o=s.length,h=0;h<o;h++)if(this._numUpdateCallback++,!s[h].update(t,this))return;t.getNumChildrenRequiringUpdateTraversal()>0&&this.traverse(t)}}),t.exports=a},function(t,e,i){"use strict";var r=i(6),n=i(31),a=i(15).mat4,s=i(15).vec3,o=function(t,e,i,r){n.call(this),this._x=void 0!==t?t:0,this._y=void 0!==e?e:0,this._width=void 0!==i?i:800,this._height=void 0!==r?r:600};o.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{attributeType:"Viewport",cloneType:function(){return new o},apply:function(t){var e=t.getGraphicContext();e.viewport(this._x,this._y,this._width,this._height)},setViewport:function(t,e,i,r){this._x=t,this._y=e,this._width=i,this._height=r},x:function(){return this._x},y:function(){return this._y},width:function(){return this._width},height:function(){return this._height},computeWindowMatrix:function(){var t=a.create(),e=a.create(),i=s.fromValues(1,1,1);return function(r){a.fromTranslation(t,i),a.fromScaling(e,[.5*this._width,.5*this._height,.5]);var n=a.fromTranslation(r,s.fromValues(this._x,this._y,0));return a.mul(n,n,a.mul(e,e,t))}}()}),"osg","Viewport"),t.exports=o},function(t,e,i){"use strict";var r=i(6),n=i(31),a=function(t,e,i,r){n.call(this),this._x=void 0!==t?t:-1,this._y=void 0!==e?e:-1,this._width=void 0!==i?i:-1,this._height=void 0!==r?r:-1};a.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{attributeType:"Scissor",cloneType:function(){return new a},apply:function(t){var e=t.getGraphicContext();this._x!==-1?(e.enable(e.SCISSOR_TEST),e.scissor(this._x,this._y,this._width,this._height)):e.disable(e.SCISSOR_TEST)},setScissor:function(t,e,i,r){this._x=t,this._y=e,this._width=i,this._height=r},x:function(){return this._x},y:function(){return this._y},width:function(){return this._width},height:function(){return this._height}}),"osg","Scissor"),t.exports=a},function(t,e,i){"use strict";var r=i(10),n=function(t){if(this._enabled=!1,t){var e=t.getExtension("EXT_disjoint_timer_query");if(!e)return this;if(this._hasTimeElapsed=e.getQueryEXT(e.TIME_ELAPSED_EXT,e.QUERY_COUNTER_BITS_EXT)>=30,this._hasTimeStamp=e.getQueryEXT(e.TIMESTAMP_EXT,e.QUERY_COUNTER_BITS_EXT)>=30,!this._hasTimeElapsed&&!this._hasTimeStamp)return this;this._hasTimeStamp||r.debug("Warning: do not use interleaved GPU query"),this._gl=t,this._glTimer=e,this._enabled=!0}this._frameAverageCount=10,this._glQueries=[],this._queriesByID={},this._userQueries=[],this._queryCount=0,this._nbOpened=0};n.FRAME_COUNT=0,n.instance=function(t){return n._instance?t&&n._instance.getContext()!==t&&n._instance.setContext(t):n._instance=new n(t),n._instance},n.prototype={getContext:function(){return this._gl},setContext:function(t){this._gl=t},setFrameAverageCount:function(t){this._frameAverageCount=t},clearQueries:function(){for(var t=this._glQueries,e=0,i=t.length;e<i;++e){var r=t[e];this._glTimer.deleteQueryEXT(r._pollingStartQuery),r._pollingEndQuery&&this._glTimer.deleteQueryEXT(r)}this._userQueries.length=0,this._glQueries.length=0,this._queriesByID={}},supportTimeStamp:function(){return this._hasTimeStamp},enable:function(){this._enabled=this._glTimer},disable:function(){this._enabled=!1},isEnabled:function(){return this._enabled},setCallback:function(t){this._callback=t;
},createUserQuery:function(t){var e;return e=this._hasTimeStamp?this.createGLQuery():{_startIndex:0,_endIndex:0},e._id=t,e._frame=n.FRAME_COUNT,e._isOpened=!0,e._siblings=[],e},createGLQuery:function(){var t={};return t._isWaiting=!1,t._pollingStartQuery=void 0,t._pollingEndQuery=void 0,t._averageTimer=0,t._resultCount=0,this._hasTimeStamp&&(t._pollingEndQuery=this._glTimer.createQueryEXT()),t._pollingStartQuery=this._glTimer.createQueryEXT(),this._glQueries.push(t),t},getOrCreateLastGLQuery:function(){var t=this._glQueries[this._queryCount-1];return t?t:t=this._glQueries[this._queryCount-1]=this.createGLQuery()},beginCurrentQuery:function(){if(0!==this._nbOpened){this._queryCount++;var t=this.getOrCreateLastGLQuery();t._isWaiting||this._glTimer.beginQueryEXT(this._glTimer.TIME_ELAPSED_EXT,t._pollingStartQuery)}},endCurrentQuery:function(){0!==this._nbOpened&&(this.getOrCreateLastGLQuery()._isWaiting||this._glTimer.endQueryEXT(this._glTimer.TIME_ELAPSED_EXT))},getAvailableQueryByID:function(t){var e=this._queriesByID[t];if(!e)return e=this._queriesByID[t]=this.createUserQuery(t),this._userQueries.push(e),e;if(e._frame===n.FRAME_COUNT){if(e._isOpened)return e;for(var i=e._siblings,r=0,a=i.length;r<a;++r){var s=i[r];if(s._frame!==n.FRAME_COUNT||s._isOpened)return s._frame=n.FRAME_COUNT,s}var o=this.createUserQuery();return i.push(o),o}return e._frame=n.FRAME_COUNT,e},start:function(t){if(this._enabled){var e=this.getAvailableQueryByID(t);e._isOpened=!0,this._hasTimeStamp?e._isWaiting||this._glTimer.queryCounterEXT(e._pollingStartQuery,this._glTimer.TIMESTAMP_EXT):(this.endCurrentQuery(),this._nbOpened++,e._startIndex=this._queryCount,this.beginCurrentQuery())}},end:function(t){if(this._enabled){var e=this.getAvailableQueryByID(t);e._isOpened=!1,this._hasTimeStamp?e._isWaiting||this._glTimer.queryCounterEXT(e._pollingEndQuery,this._glTimer.TIMESTAMP_EXT):(this.endCurrentQuery(),e._endIndex=this._queryCount,this._nbOpened--,this.beginCurrentQuery())}},computeQueryAverageTime:function(t){for(var e=0,i=this._glQueries,r=t._startIndex;r<t._endIndex;++r){var n=i[r]._averageTimer;if(n<0)return-1;e+=n}return e},computeFullAverageTime:function(t){var e=this.computeQueryAverageTime(t);if(e<0)return-1;for(var i=t._siblings,r=0,a=i.length;r<a;++r){var s=i[r];if(s._frame===n.FRAME_COUNT-1){var o=this.computeQueryAverageTime(s);if(o<0)return-1;e+=o}}return e},pollQueries:function(){if(n.FRAME_COUNT++,this._queryCount=0,this._nbOpened=0,this._enabled&&this._callback){var t,e=this._glQueries,i=e.length,r=this._gl.getParameter(this._glTimer.GPU_DISJOINT_EXT);if(r)for(t=0;t<i;++t)e[t]._isWaiting=!1;else{for(t=0;t<i;++t)this.pollQuery(e[t]);var a=this._userQueries,s=a.length;for(t=0;t<s;++t){var o=a[t],h=this.computeFullAverageTime(o);h>0&&this._callback(h,o._id)}}}},pollQuery:function(t){t._isWaiting=!1;var e=this._hasTimeStamp?t._pollingEndQuery:t._pollingStartQuery,i=this._glTimer.getQueryObjectEXT(e,this._glTimer.QUERY_RESULT_AVAILABLE_EXT);if(!i)return t._isWaiting=!0,0;var r;if(this._hasTimeStamp){var n=this._glTimer.getQueryObjectEXT(t._pollingStartQuery,this._glTimer.QUERY_RESULT_EXT),a=this._glTimer.getQueryObjectEXT(e,this._glTimer.QUERY_RESULT_EXT);r=a-n}else r=this._glTimer.getQueryObjectEXT(e,this._glTimer.QUERY_RESULT_EXT);return t._resultCount++,t._resultCount>this._frameAverageCount&&(t._averageTimer=0,t._resultCount=1),t._averageTimer=t._averageTimer+(r-t._averageTimer)/t._resultCount,t._averageTimer}},t.exports=n},function(t,e,i){"use strict";var r=i(6),n=i(114),a=i(82),s=i(75),o=i(118),h=i(72),u=i(115),c=i(120),l=i(122),d=i(119),f=i(78),p=i(77),_=i(76),g=i(70),m=i(123),v=i(124),S=i(125),x=i(126),b=i(127),M=i(73),y=i(74),T=i(121),w=i(71),C={};r.objectMix(C,l),r.objectMix(C,d),C.Animation=n,C.SkinningAttribute=a,C.AnimationUpdateCallback=s,C.BasicAnimationManager=o,C.Bone=h,C.Channel=u,C.CollectAnimationUpdateCallbackVisitor=c,C.MorphAttribute=f,C.MorphGeometry=p,C.RigGeometry=_,C.Skeleton=g,C.StackedMatrix=m,C.StackedQuaternion=v,C.StackedRotateAxis=S,C.StackedScale=x,C.StackedTranslate=b,C.UpdateBone=M,C.UpdateMatrixTransform=y,C.UpdateMorph=T,C.UpdateSkeleton=w,t.exports=C},function(t,e,i){"use strict";var r=i(115),n=0,a=function(t,e){for(var i=1/0,r=-(1/0),a=0;a<t.length;a++)i=Math.min(i,t[a].start),r=Math.max(r,t[a].end);var s=r-i,o=e||"animation"+n.toString();return n++,{channels:t,duration:s,name:o,start:i}},s=function(t){for(var e=[],i=0;i<t.channels.length;i++){var n=r.createInstanceChannel(t.channels[i]);e.push(n)}return{channels:e,duration:t.duration,start:0,name:t.name,firstKeyTime:t.start}},o=function(){};o.createAnimation=a,o.createInstanceAnimation=s,t.exports=o},function(t,e,i){"use strict";var r=i(15).vec3,n=i(15).quat,a=i(116),s=i(117),o={},h=function(t,e,i,r,n,a){var s=i[0],o=i[i.length-1];return a.start=s,a.keys=e,a.end=o,a.times=i,a.type=t,a.duration=o-s,a.target=r,a.name=n,a},u=function(t,e,i,r,n){return h(s.Vec3,t,e,i,r,n||{})},c=function(t,e,i,r,n){return h(s.Float,t,e,i,r,n||{})},l=function(t,e,i,r,n){return h(s.Quat,t,e,i,r,n||{})},d=function(t,e,i,r,n){return h(s.QuatSlerp,t,e,i,r,n||{})},f=function(t,e,i,r,n){return h(s.FloatCubicBezier,t,e,i,r,n||{})},p=function(t,e,i,r,n){return h(s.Vec3CubicBezier,t,e,i,r,n||{})},_={create:function(){return 0}},g={create:function(){return r.create32()}},m={create:function(){return n.create32()}},v=function(t,e){return{channel:e,value:t.create(),targetID:a.InvalidTargetID,weight:1,key:0,start:0,end:0}},S=function(t){return v(g,t)},x=function(t){return v(m,t)},b=function(t){return v(_,t)},M=function(t){return v(_,t)},y=function(t){return v(g,t)},T=function(t){return o[t.type](t)};o.createInstanceChannel=T,o.createInstanceVec3Channel=S,o.createInstanceQuatChannel=x,o.createInstanceQuatSlerpChannel=x,o.createInstanceFloatChannel=b,o.createInstanceFloatCubicBezierChannel=M,o.createInstanceVec3CubicBezierChannel=y,o.createVec3Channel=u,o.createQuatChannel=l,o.createQuatSlerpChannel=d,o.createFloatChannel=c,o.createFloatCubicBezierChannel=f,o.createVec3CubicBezierChannel=p,o[s.Vec3]=S,o[s.Quat]=x,o[s.QuatSlerp]=x,o[s.Float]=b,o[s.FloatCubicBezier]=M,o[s.Vec3CubicBezier]=y,o.ChannelType=s,t.exports=o},function(t,e,i){"use strict";var r=i(15).mat4,n=i(15).quat,a=i(15).vec3,s=i(117),o={};o.InvalidTargetID=-1;var h=function(t,e,i){return{type:t,id:o.InvalidTargetID,channels:[],value:e,defaultValue:i}},u=function(t){return h(s.Quat,n.copy(n.create(),t),n.copy(n.create(),t))},c=function(t){return h(s.Matrix,r.copy(r.create(),t),r.copy(r.create(),t))},l=function(t){return h(s.Vec3,a.copy(a.create(),t),a.copy(a.create(),t))},d=function(t){return h(s.Float,t,t)};o.createQuatTarget=u,o.createVec3Target=l,o.createFloatTarget=d,o.createMatrixTarget=c,t.exports=o},function(t,e){"use strict";t.exports={Vec3:0,Quat:1,Float:2,FloatCubicBezier:3,Vec3CubicBezier:4,QuatSlerp:5,Matrix:6,Count:7}},function(t,e,i){"use strict";var r=i(10),n=i(6),a=i(13),s=i(15).quat,o=i(15).vec3,h=i(15).mat4,u=i(115),c=i(114),l=i(119),d=i(120),f=i(116),p=i(121),_={lerp:function(t,e,i){return t+(e-t)*i},init:function(){return 0},copy:function(t){return t},create:function(){return 0}},g=[];g[u.ChannelType.Float]=1,g[u.ChannelType.FloatCubicBezier]=1,g[u.ChannelType.Vec3]=3,g[u.ChannelType.Vec3CubicBezier]=3,g[u.ChannelType.Quat]=4,g[u.ChannelType.QuatSlerp]=4,g[u.ChannelType.Matrix]=16;var m=[];m.length=u.ChannelType.Count,m[u.ChannelType.Vec3]=o,m[u.ChannelType.Quat]=s,m[u.ChannelType.QuatSlerp]=s,m[u.ChannelType.Float]=_,m[u.ChannelType.FloatCubicBezier]=_,m[u.ChannelType.Vec3CubicBezier]=o,m[u.ChannelType.Matrix]=h;var v=function(){a.call(this),this._simulationTime=0,this._pauseTime=0,this._timeFactor=1,this._startTime=0,this._instanceAnimations={},this._startAnimations={},this._targets=[],this._targetsMap={},this._targetsByTypes=[],this._targetsByTypes.length=u.ChannelType.Count;for(var t=0,e=this._targetsByTypes.length;t<e;t++)this._targetsByTypes[t]=[];this._activeAnimations={},this._activeAnimationList=[],this._activeChannelsByTypes=[],this._activeChannelsByTypes.length=u.ChannelType.Count;for(var i=0,r=this._activeChannelsByTypes.length;i<r;i++)this._activeChannelsByTypes[i]=[];this._animationsUpdateCallback={},this._animationsUpdateCallbackArray=[],this._animationsToRegister=[],this._pause=!1,this._dirty=!1,this._seekTime=-1};v.prototype=n.objectInherit(a.prototype,{init:function(t){this._simulationTime=0,this._pauseTime=0,this._timeFactor=1,this._startTime=0,this._instanceAnimations={},this._startAnimations={},this._resetTargets(),this._activeAnimations={},this._activeAnimationList.length=0;for(var e=0,i=this._activeChannelsByTypes.length;e<i;e++)this._activeChannelsByTypes[e].length=0;this._animationsUpdateCallback={},this._animationsUpdateCallbackArray.length=0,this._pause=!1,this._seekTime=-1,this.addAnimations(t)},addAnimations:function(t){var e=this._addAnimation(t);Array.prototype.push.apply(this._animationsToRegister,e),this._dirty=!0,this._registerAnimations()},update:function(t,e){this._dirty&&(this._findAnimationUpdateCallback(t),this._registerTargetFoundInAnimationCallback(),this._registerAnimations());var i=e.getFrameStamp().getSimulationTime();return this._seekTime!==-1&&(this._pauseTime=-this._seekTime+this._startTime+i),this._seekTime=-1,this._pause?this._pauseTime=i-this._simulationTime+this._startTime:this._simulationTime=this._startTime+(i-this._pauseTime),this.updateManager(this._simulationTime*this._timeFactor),!0},updateManager:function(t){this._processStartAnimation(t);for(var e=u.ChannelType.Count,i=0;i<e;i++){var r=this._activeChannelsByTypes[i];this._updateChannelsType(t,r,l[i])}for(var n=0;n<e;n++){var a=this._targetsByTypes[n];this._updateTargetType(a,m[n])}for(var s=0,o=this._animationsUpdateCallbackArray.length;s<o;s++){var h=this._animationsUpdateCallbackArray[s];h.computeChannels()}this._removeFinishedAnimation(t)},togglePause:function(){this._pause=!this._pause,this._pause||(this._seekTime=this._simulationTime)},getSimulationTime:function(){return this._simulationTime},setSimulationTime:function(t){this._simulationTime=t},setSeekTime:function(t){this._simulationTime=t,this._seekTime=t},stopAnimation:function(t){for(var e=this._activeAnimationList,i=0,r=e.length;i<r;++i)if(e[i].name===t)return this._removeActiveChannels(this._instanceAnimations[t]),this._activeAnimations[t]=void 0,void e.splice(i,1)},stopAllAnimation:function(){for(var t=this._activeAnimationList,e=0,i=t.length;e<i;++e){var r=t[e].name;this._removeActiveChannels(this._instanceAnimations[r]),this._activeAnimations[r]=void 0}t.length=0},setTimeFactor:function(t){var e=t/this._timeFactor;this._startTime+=(this._simulationTime-this._simulationTime*e)/e,this._timeFactor=t,this._pause&&(this._simulationTime+=(this._simulationTime-this._simulationTime*e)/e)},getTimeFactor:function(){return this._timeFactor},isPlaying:function(t){return!!this._activeAnimations[t]},playAnimationObject:function(t){var e=this._instanceAnimations[t.name];return e?void(this.isPlaying(t.name)||(e.priority=void 0===t.priority?0:t.priority,e.weight=void 0===t.weight?1:t.weight,e.loop=void 0===t.loop||t.loop,this._startAnimations[e.name]=e)):void r.info("no animation "+t.name+" found")},playAnimation:function(t,e,i,r){var n;return n="object"==typeof t?t:{name:t,priority:i,weight:r,loop:e},this.playAnimationObject(n)},getAnimations:function(){return this._instanceAnimations},_registerAnimations:function(){if(this._targets.length){for(var t=0,e=this._animationsToRegister.length;t<e;t++){var i=this._animationsToRegister[t];this._registerInstanceAnimation(i)}this._animationsToRegister.length=0,this._dirty=!1}},_registerInstanceAnimation:function(t){for(var e=t.channels,i=0,n=e.length;i<n;i++){var a=e[i],s=a.channel.target,o=a.channel.name,h=s+"."+o;this._targetMap[h]?a.targetID=this._targetMap[h].id:r.warn("registerInstanceAnimation did not find targetName ("+h+") in the scene graph")}return!0},_findAnimationUpdateCallback:function(t){var e=new d;t.accept(e),this._animationsUpdateCallback=e.getAnimationUpdateCallbackMap()},_registerTargetFoundInAnimationCallback:function(){this._resetTargets();for(var t,e,i,n=0,a=this._targetMap,s=this._targets,o=function(t,e,i){if(a[t])e!==a[t]&&r.warn("detected differents target instance with the same name ("+i+")");else{a[t]=e,e.id=n++,s.push(e);var o=e.type;this._targetsByTypes[o].push(e)}}.bind(this),h=this._animationsUpdateCallback,u=window.Object.keys(h),c=0,l=u.length;c<l;c++){var d=u[c],f=h[d];if(f.getStackedTransforms&&f.getStackedTransforms().length){this._animationsUpdateCallbackArray.push(f);for(var _=f.getStackedTransforms(),g=0,m=_.length;g<m;g++){var v=_[g];t=v.getTarget(),e=v.getName(),i=f.getName()+"."+e,o(i,t,e)}}else if(f instanceof p)for(var S=0,x=f.getNumTarget();S<x;S++)e=f.getTargetName(S),i=e+"."+S,t=f.getTarget(S),o(i,t,e)}},_addAnimation:function(t){for(var e=[],i=0,r=t.length;i<r;i++){var n=t[i],a=n.name;if(!this._instanceAnimations[a]){var s=c.createInstanceAnimation(n);this._instanceAnimations[a]=s,e.push(s)}}return e},_addActiveChannels:function(t,e){for(var i=e.channels,r=0,n=i.length;r<n;r++){var a=i[r],s=a.channel.type;a.t=t,a.instanceAnimation=e;var o=a.targetID;o!==f.InvalidTargetID&&(this._activeChannelsByTypes[s].push(a),this._targets[o].channels.push(a))}},_removeActiveChannels:function(t){for(var e=t.channels,i=0,r=e.length;i<r;i++){var n=e[i],a=n.channel.type,s=n.targetID;if(s!==f.InvalidTargetID){var o=this._targets[s].channels,h=o.indexOf(n);o.splice(h,1);var u=this._activeChannelsByTypes[a],c=u.indexOf(n);u.splice(c,1)}}},_updateTargetType:function(t,e){for(var i=0,r=t.length;i<r;i++){var n=t[i],a=n.channels,s=a.length;if(0===s)n.value=e.copy(n.defaultValue,n.value);else if(1===s)n.value=e.copy(a[0].value,n.value);else{n.value=e.init(n.value);for(var o=0,h=0,u=a.length;h<u;h++){var c=a[h],l=c.weight;if(o+=l,0!==o&&0!==l){var d=l/o;n.value=e.lerp(n.value,n.value,c.value,d)}}}}},_updateChannelsType:function(t,e,i){for(var r=0,n=e.length;r<n;r++){var a=e[r],s=a.instanceAnimation,o=s.loop,h=t-a.t;o&&s.duration>0&&(h%=s.duration),i(h+s.firstKeyTime,a)}},_removeFinishedAnimation:function(t){for(var e=this._activeAnimationList,i=0;i<e.length;){var r=e[i],n=r.name;t>r.end&&r.loop===!1?(this._removeActiveChannels(r),this._activeAnimations[n]=void 0,e.splice(i,1)):i++}},_addActiveAnimation:function(t,e){this._activeAnimations[e.name]=e;var i=this._instanceAnimations[e.name];i.start=t,i.end=t+i.duration,this._addActiveChannels(t,i),this._activeAnimationList.push(i)},_processStartAnimation:function(t){if(this._targets.length){for(var e=this._startAnimations,i=window.Object.keys(e),r=0,n=i.length;r<n;r++){var a=i[r],s=e[a],o=s.name;this.isPlaying(o)||this._addActiveAnimation(t,s)}i.length&&(this._startAnimations={})}},_resetTargets:function(){this._targetMap={},this._targets.length=0;for(var t=0,e=this._targetsByTypes.length;t<e;t++)this._targetsByTypes[t].length=0},resetAllStackedTransforms:function(){for(var t=this._animationsUpdateCallbackArray,e=0,i=t.length;e<i;e++){for(var r=t[e].getStackedTransforms(),n=0,a=r.length;n<a;n++)r[n].resetToDefaultValue();t[e].computeChannels()}},setAnimationLerpEndStart:function(t,e){var i=t.channels;void 0===t.originalDuration&&(t.originalDuration=t.duration),t.duration=t.originalDuration+e;for(var r=t.firstKeyTime,n=t.originalDuration,a=0,s=i.length;a<s;++a){var o=i[a].channel;if(!(Math.abs(o.start-r)>.01||Math.abs(o.duration-n)>.01)){void 0===o.originalEnd&&(o.originalEnd=o.end),o.end=o.originalEnd+e;var h=g[o.type],u=o.times.buffer.byteLength/4;if(0===e)o.keys=new Float32Array(o.keys.buffer,0,(u-1)*h),o.times=new Float32Array(o.times.buffer,0,u-1);else{o.keys=new Float32Array(o.keys.buffer,0,u*h);for(var c=(u-1)*h,l=0;l<h;++l)o.keys[c+l]=o.keys[l];o.times=new Float32Array(o.times.buffer,0,u),o.times[u-1]=o.times[u-2]+e}}}}}),v.TypeToSize=g,t.exports=v},function(t,e,i){"use strict";var r=i(15).vec3,n=i(15).quat,a=i(115),s=function(t,e,i){i[0]=e[t++],i[1]=e[t++],i[2]=e[t++]},o=function(t,e,i){i[0]=e[t++],i[1]=e[t++],i[2]=e[t++],i[3]=e[t++]},h=function(t,e){var i=e.channel,r=e.value,n=i.start,a=i.end,o=i.keys,h=i.times;if(t>=a)return e.key=0,void s(o.length-3,o,r);if(t<=n)return e.key=0,void s(0,o,r);var u=e.key;if(t>h[u])for(;h[u+1]<t;)u++;else if(t<h[u])for(;h[u]>t;)u--;var c=h[u],l=h[u+1],d=3*u,f=o[d++],p=o[d++],_=o[d++],g=o[d++],m=o[d++],v=o[d++],S=(t-c)/(l-c);r[0]=f+(g-f)*S,r[1]=p+(m-p)*S,r[2]=_+(v-_)*S,e.key=u},u=function(){var t=n.create32(),e=n.create32();return function(i,r){var a=r.channel,s=r.value,h=a.start,u=a.end,c=a.keys,l=a.times;if(i>=u)return r.key=0,void o(c.length-4,c,s);if(i<=h)return r.key=0,void o(0,c,s);var d=r.key;if(i>l[d])for(;l[d+1]<i;)d++;else if(i<l[d])for(;l[d]>i;)d--;var f=l[d],p=l[d+1],_=4*d;t[0]=c[_++],t[1]=c[_++],t[2]=c[_++],t[3]=c[_++],e[0]=c[_++],e[1]=c[_++],e[2]=c[_++],e[3]=c[_++];var g=(i-f)/(p-f);n.nlerp(s,t,e,g),r.key=d}}(),c=function(){var t=n.create32(),e=n.create32();return function(i,r){var a=r.channel,s=r.value,h=a.start,u=a.end,c=a.keys,l=a.times;if(i>=u)return r.key=0,void o(c.length-4,c,s);if(i<=h)return r.key=0,void o(0,c,s);var d=r.key;if(i>l[d])for(;l[d+1]<i;)d++;else if(i<l[d])for(;l[d]>i;)d--;var f=l[d],p=l[d+1],_=4*d;t[0]=c[_++],t[1]=c[_++],t[2]=c[_++],t[3]=c[_++],e[0]=c[_++],e[1]=c[_++],e[2]=c[_++],e[3]=c[_++];var g=(i-f)/(p-f);n.slerp(s,t,e,g),r.key=d}}(),l=function(t,e){var i=e.channel,r=e.value,n=i.start,a=i.end,s=i.keys,o=i.times;if(t>=a)return e.key=0,void(e.value=s[s.length-1]);if(t<=n)return e.key=0,void(e.value=s[0]);var h=e.key;if(t>o[h])for(;o[h+1]<t;)h++;else if(t<o[h])for(;o[h]>t;)h--;var u=o[h],c=o[h+1],l=h,d=s[l++],f=s[l++],p=(t-u)/(c-u);r=d+(f-d)*p,e.key=h,e.value=r},d=function(t,e){var i=e.channel,r=e.value,n=i.start,a=i.end,s=i.keys,o=i.times;if(t>=a)return e.key=0,void(e.value=s[s.length-3]);if(t<=n)return e.key=0,void(e.value=s[0]);var h=e.key;if(t>o[h])for(;o[h+1]<t;)h++;else if(t<o[h])for(;o[h]>t;)h--;var u=(t-o[h])/(o[h+1]-o[h]),c=1-u,l=c*c,d=l*c,f=u*u,p=3*h,_=s[p]*d,g=s[p+1]*(3*u*l),m=s[p+2]*(3*f*c),v=s[p+3]*(f*u);r=_+g+m+v,e.key=h,e.value=r},f=function(){var t=r.create(),e=r.create(),i=r.create(),n=r.create();return function(a,o){var h=o.channel,u=o.value,c=h.start,l=h.end,d=h.keys,f=h.times;if(a>=l)return o.key=0,void s(d.length-9,d,u);if(a<=c)return o.key=0,void s(0,d,u);var p=o.key;if(a>f[p])for(;f[p+1]<a;)p++;else if(a<f[p])for(;f[p]>a;)p--;var _=(a-f[p])/(f[p+1]-f[p]),g=1-_,m=g*g,v=m*g,S=_*_,x=9*p;r.scale(t,r.set(t,d[x++],d[x++],d[x++]),v),r.scale(e,r.set(e,d[x++],d[x++],d[x++]),3*_*m),r.scale(i,r.set(i,d[x++],d[x++],d[x++]),3*S*g),r.scale(n,r.set(n,d[x++],d[x++],d[x++]),S*_),u[0]=t[0]+e[0]+i[0]+n[0],u[1]=t[1]+e[1]+i[1]+n[1],u[2]=t[2]+e[2]+i[2]+n[2],o.key=p}}(),p=a.ChannelType,_={};_[p.Vec3]=h,_[p.Quat]=u,_[p.QuatSlerp]=c,_[p.Float]=l,_[p.FloatCubicBezier]=d,_[p.Vec3CubicBezier]=f,_.Vec3LerpInterpolator=h,_.QuatLerpInterpolator=u,_.QuatSlerpInterpolator=c,_.FloatLerpInterpolator=l,_.FloatCubicBezierInterpolator=d,_.Vec3CubicBezierInterpolator=f,t.exports=_},function(t,e,i){"use strict";var r=i(6),n=i(32),a=i(75),s=function(){n.call(this),this._animationUpdateCallback={}};s.prototype=r.objectInherit(n.prototype,{getAnimationUpdateCallbackMap:function(){return this._animationUpdateCallback},apply:function(t){for(var e=t.getUpdateCallbackList(),i=0,r=e.length;i<r;i++){var n=e[i];n instanceof a&&(this._animationUpdateCallback[n.getInstanceID()]=n)}this.traverse(t)}}),t.exports=s},function(t,e,i){"use strict";var r=i(6),n=i(48),a=i(76),s=i(75),o=i(116),h=i(77),u=function(){s.call(this),this._isInitialized=!1,this._targets=[],this._targetNames=[],this._morphs=[],this._weights=new Float32Array(4),this._indexMap=[0,0,0,0],this._gpuMorphed=[]},c=h.EFFECTIVE_EPS,l=function(t,e){return Math.abs(e.value)-Math.abs(t.value)};u.prototype=r.objectInherit(s.prototype,{init:function(t){for(var e=t.getChildren(),i=0,r=e.length;i<r;i++){var n,s=e[i];s instanceof h?n=s:s instanceof a&&s.getSourceGeometry()instanceof h&&(n=s.getSourceGeometry()),n&&n.getName()===this.getName()&&(n.isInitialized()||n.init(),this._morphs.push(n),this._isInitialized=!0)}},isInitialized:function(){return this._isInitialized},getNumTarget:function(){return this._targets.length},getTarget:function(t){return this._targets[t]},getTargetName:function(t){return this._targetNames[t]},addTarget:function(t,e){this._targets[e]=o.createFloatTarget(0),this._targetNames[e]=t},_remapBufferArrays:function(){for(var t=this._indexMap,e=this._morphs,i=0;i<4;++i)for(var r=t[i],n="_"+i,a="_"+r,s=0,o=e.length;s<o;++s)for(var h=e[s],u=h.getVertexAttributeList(),c=h.getMorphTargetNames(),l=0,d=c.length;l<d;++l){var f=c[l];u[f+n].setBufferArray(u[f+a].getInitialBufferArray())}},_mergeExtraMorphTarget:function(t,e,i){var r=0,a=this._gpuMorphed,s=t[e],o=s.getElements().length,h=o/s.getItemSize(),u=s.getItemSize();s._cpuMorph=s._cpuMorph||new n(n.ARRAY_BUFFER,new Float32Array(o),u);var l=s._cpuMorph.getElements();for(r=0;r<o;++r)l[r]=0;for(var d=this._targets,f=0,p=d.length;f<p;++f)if(a[f]!==!0){var _=d[f].value;if(!(Math.abs(_)<c)){_/=i;var g=t[e+"_"+f].getInitialBufferArray().getElements();for(r=0;r<h;++r){var m=r*u;l[m]+=_*g[m],l[m+1]+=_*g[m+1],l[m+2]+=_*g[m+2]}}}t[e+"_3"].setBufferArray(s._cpuMorph),s._cpuMorph.dirty()},_computeExtraWeightsSum:function(){for(var t=this._gpuMorphed,e=0,i=this._targets,r=0,n=i.length;r<n;++r)if(t[r]!==!0){var a=i[r].value;Math.abs(a)<c||(e+=a)}var s=1e-5;return Math.abs(e)>s?e:e<0?-s:s},_morphBufferArrayCPU:function(){for(var t=this._weights[3]=this._computeExtraWeightsSum(),e={},i=this._morphs,r=0,n=i.length;r<n;++r)for(var a=i[r],s=a.getVertexAttributeList(),o=a.getMorphTargetNames(),h=0,u=o.length;h<u;++h){var c=o[h],l=s[c];l&&!e[l.getInstanceID()]&&(e[l.getInstanceID()]=!0,this._mergeExtraMorphTarget(s,c,t))}},updateWeights:function(){var t=0,e=this._targets,i=e.length,r=this._weights;if(r[0]=r[1]=r[2]=r[3]=0,i<=4)for(t=0;t<i;++t)r[t]=e[t].value;else{var n=this._indexMap;n[0]=n[1]=n[2]=n[3]=0;var a=this._gpuMorphed;for(a.length=i,t=0;t<i;++t)a[t]=!1;var s=e.slice(0).sort(l);for(t=0;t<4;++t){var o=e.indexOf(s[t]);a[o]=!0,n[t]=o,r[t]=s[t].value}var h=Math.abs(s[4].value)>=c;a[n[3]]=!h,this._remapBufferArrays(),h&&this._morphBufferArrayCPU()}},update:function(t){this.isInitialized()||this.init(t),this.updateWeights();for(var e=this._weights,i=Math.min(4,this._targets.length),r=this._morphs,n=0,a=r.length;n<a;++n)for(var s=r[n].getTargetsWeight(),o=0;o<i;o++)s[o]=e[o];return!0}}),t.exports=u},function(t,e){"use strict";var i=function(t){return-(t*(t-2))},r=function(t){return t*t},n=function(t){return t-=1,t*t*t+1},a=function(t){return t*t*t},s=function(t){return t-=1,-(t*t*t*t-1)},o=function(t){return t*t*t*t},h=function(t){return Math.pow(2,-10*t)*Math.sin((t-.075)*(2*Math.PI)/.3)+1},u=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375};t.exports={easeOutQuad:i,easeInQuad:r,easeOutCubic:n,easeInCubic:a,easeOutQuart:s,easeInQuart:o,easeOutElastic:h,easeOutBounce:u,EaseOutQuad:i,EaseInQuad:r,EaseOutCubic:n,EaseInCubic:a,EaseOutQuart:s,EaseInQuart:o,EaseOutElastic:h,EaseOutBounce:u}},function(t,e,i){"use strict";var r=i(6),n=i(13),a=i(15).mat4,s=i(116),o=function(t,e){n.call(this),this._target=s.createMatrixTarget(e||a.IDENTITY),t&&this.setName(t)};o.prototype=r.objectInherit(n.prototype,{init:function(t){this.setMatrix(t),a.copy(this._target.defaultValue,t)},getTarget:function(){return this._target},getMatrix:function(){return this._target.value},setMatrix:function(t){a.copy(this._target.value,t)},resetToDefaultValue:function(){this.setMatrix(this._target.defaultValue)},applyToMatrix:function(t){a.mul(t,t,this._target.value)}}),t.exports=o},function(t,e,i){"use strict";var r=i(6),n=i(13),a=i(15).mat4,s=i(15).quat,o=i(116),h=s.create(),u=function(t,e){n.call(this),this._target=o.createQuatTarget(e||h),t&&this.setName(t)};u.prototype=r.objectInherit(n.prototype,{init:function(t){this.setQuaternion(t),s.copy(this._target.defaultValue,t)},setQuaternion:function(t){s.copy(this._target.value,t)},getTarget:function(){return this._target},resetToDefaultValue:function(){this.setQuaternion(this._target.defaultValue)},applyToMatrix:function(){var t=a.create();return function(e){var i=t;a.fromQuat(i,this._target.value),a.mul(e,e,i)}}()}),t.exports=u},function(t,e,i){"use strict";var r=i(6),n=i(13),a=i(15).mat4,s=i(15).vec3,o=i(15).quat,h=i(116),u=function(t,e,i){n.call(this),this._axis=s.fromValues(0,0,1),e&&s.copy(this._axis,e),this._target=h.createFloatTarget("number"==typeof i?i:0),t&&this.setName(t)};u.prototype=r.objectInherit(n.prototype,{init:function(t,e){this.setAxis(t),this.setAngle(e),this._target.defaultValue=e},setAxis:function(t){s.copy(this._axis,t)},setAngle:function(t){this._target.value=t},getTarget:function(){return this._target},resetToDefaultValue:function(){this.setAngle(this._target.defaultValue)},applyToMatrix:function(){var t=a.create(),e=o.create();return function(i){var r=this._axis,n=e,s=t,h=this._target.value;o.setAxisAngle(n,r,h),a.fromQuat(s,n),a.mul(i,i,s)}}()}),t.exports=u},function(t,e,i){"use strict";var r=i(6),n=i(13),a=i(15).mat4,s=i(15).vec3,o=i(116),h=function(t,e){n.call(this),this._target=o.createVec3Target(e||s.ONE),t&&this.setName(t)};h.prototype=r.objectInherit(n.prototype,{init:function(t){this.setScale(t),s.copy(this._target.defaultValue,t)},setScale:function(t){s.copy(this._target.value,t)},getTarget:function(){return this._target},resetToDefaultValue:function(){this.setScale(this._target.defaultValue)},applyToMatrix:function(t){var e=this._target.value;a.scale(t,t,e)}}),t.exports=h},function(t,e,i){"use strict";var r=i(6),n=i(13),a=i(15).vec3,s=i(15).mat4,o=i(116),h=function(t,e){n.call(this),this._target=o.createVec3Target(e||a.ZERO),t&&this.setName(t)};h.prototype=r.objectInherit(n.prototype,{init:function(t){this.setTranslate(t),a.copy(this._target.defaultValue,t)},setTranslate:function(t){a.copy(this._target.value,t)},getTarget:function(){return this._target},resetToDefaultValue:function(){this.setTranslate(this._target.defaultValue)},applyToMatrix:function(t){s.translate(t,t,this._target.value)}}),t.exports=h},function(t,e,i){"use strict";var r=i(6),n=i(129),a=i(134),s=i(136),o=i(137),h=i(138),u=i(139),c=i(135),l={};l.Input=n,r.objectMix(l,a),l.DatabasePager=s,l.ObjectWrapper.serializers.osg=o,l.ObjectWrapper.serializers.osgAnimation=h,l.ObjectWrapper.serializers.osgText=u,l.Registry=c,l.requestFile=i(130);var d=i(132);r.objectMix(l,d),t.exports=l},function(t,e,i){"use strict";var r=i(90),n=i(6),a=i(2),s=i(130),o=i(131),h=i(132),u=i(10),c=i(42),l=i(48),d=i(86),f=i(85),p=i(45),_=i(46),g=function(t,e){this._json=t;var i=e;void 0===i&&(i={}),this._identifierMap=i,this._objectRegistry={},this._cacheReadObject={},this.setOptions(n.objectMix({},o))};g.imageFallback||(g.imageFallback=function(){var t=new window.Image;return t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQIW2P8DwQACgAD/il4QJ8AAAAASUVORK5CYII=",t}()),g.prototype={clone:function(){var t=new g;return t._objectRegistry=this._objectRegistry,t._cacheReadObject=this._cacheReadObject,t},setOptions:function(t){this._defaultOptions=t},getOptions:function(){return this._defaultOptions},setProgressXHRCallback:function(t){this._defaultOptions.progressXHRCallback=t},setReadNodeURLCallback:function(t){this._defaultOptions.readNodeURL=t},registerObject:function(t,e){this._objectRegistry[t]=e},getJSON:function(){return this._json},setJSON:function(t){return this._json=t,this},setPrefixURL:function(t){this._defaultOptions.prefixURL=t},getPrefixURL:function(){return this._defaultOptions.prefixURL},setDatabasePath:function(t){this._defaultOptions.databasePath=t},getDatabasePath:function(){return this._defaultOptions.databasePath},computeURL:function(t){return"string"==typeof this._defaultOptions.prefixURL&&this._defaultOptions.prefixURL.length>0?this._defaultOptions.prefixURL+t:t},requestFile:function(t,e){return s(t,e)},getObjectWrapper:function(t){if(this._objectRegistry[t])return new this._objectRegistry[t];for(var e=a,i=t.split("."),r=0,n=i.length;r<n;r++){var s=e[i[r]];if(void 0===s)return;e=s}return this._objectRegistry[t]=e,new e},fetchImage:function(t,e,i,r){var n="data:image/",a=e.substring(0,n.length)===n,s=new window.Image;return s.onerror=function(){u.warn("warning use white texture as fallback instead of "+e),t.setImage(g.imageFallback),r&&r.resolve(t)},!a&&i.imageCrossOrigin&&(s.crossOrigin=i.imageCrossOrigin),s.onload=function(){r?(i.imageOnload&&i.imageOnload.call(t),r.resolve(t)):i.imageOnload&&i.imageOnload.call(t)},t.setURL(e),t.setImage(s),s.src=e,t},readImageURL:function(t,e){if(void 0===e&&(e=this._defaultOptions),e.readImageURL)return e.readImageURL.call(this,t,e);"data:image"!==t.substr(0,10)&&(t=this.computeURL(t));var i=new c;if(e.imageLoadingUsePromise!==!0)return this.fetchImage(i,t,e);var n=r.defer();return this.fetchImage(i,t,e,n),n.promise},readNodeURL:function(t,e){var a=e;if(void 0===a&&(a=this._defaultOptions),a.readNodeURL)return a.readNodeURL.call(this,t,a);t=this.computeURL(t);var s=r.defer();if(a=n.objectMix({},a),!a.prefixURL){var o=this.getPrefixURL(),c=t.lastIndexOf("/");c!==-1&&(o=t.substring(0,c+1)),a.prefixURL=o}var l=this,d=i(134),f=function(e){d.parseSceneGraph(e,a).then(function(e){s.resolve(e),u.log("loaded "+t)}).catch(s.reject.bind(s))},p=function(t){function e(t){return t.length<2?"0"+t:t}function i(t){for(var i="",r=0,n=t.length;r<n;++r)i+="%"+e(t[r].toString(16));return i=decodeURIComponent(i)}var r=t;h.isGunzipBuffer(t)&&(r=h.gunzip(t));var n=new Uint8Array(r),a=i(n);return a},_=l.requestFile(t);return _.then(function(e){var i;try{i=JSON.parse(e)}catch(e){u.error("cant parse url "+t+" try to gunzip")}if(i)return f(i);var r=l.requestFile(t,{responseType:"arraybuffer"});return r.then(function(t){var e=p(t);i=JSON.parse(e),f(i)}).catch(function(e){u.error("cant read file "+t+" status "+e),s.reject()}).done(),!0}).catch(function(e){u.error("cant get file "+t+" status "+e),s.reject()}).done(),s.promise},_unzipTypedArray:function(t){var e=new Uint8Array(t);if(31===e[0]&&139===e[1]){var r=i(133);r||u.error("osg failed to use a gunzip.min.js to uncompress a gz file.\n You can add this vendors to enable this feature or adds the good header in your gzip file served by your server");var n=new r.Gunzip(e),a=n.decompress();return a.buffer}return t},readBinaryArrayURL:function(t,e){if(void 0===e&&(e=this._defaultOptions),e.readBinaryArrayURL)return e.readBinaryArrayURL.call(this,t,e);if(t=this.computeURL(t),void 0!==this._identifierMap[t])return this._identifierMap[t];var i=r.defer(),n=this.requestFile(t,{responseType:"arraybuffer",progress:this._defaultOptions.progressXHRCallback});return this._identifierMap[t]=i.promise,n.then(function(t){i.resolve(this._unzipTypedArray(t))}.bind(this)),i.promise},initializeBufferArray:function(t,e,i,a){if(void 0===a&&(a=this.getOptions()),a.initializeBufferArray)return a.initializeBufferArray.call(this,t,e,i);var s=t.File,o=r.defer();return this.readBinaryArrayURL(s).then(function(r){var a,s;!function(){var t=new Uint8Array([18,52]),e=new Uint16Array(t.buffer);s="1234"===e[0].toString(16)}();var h=0;void 0!==t.Offset&&(h=t.Offset);var c=n[e].BYTES_PER_ELEMENT,l=t.Size,d=i.getItemSize(),f=l*c*d;if(s){u.log("big endian detected");var p=n[e],_=new p(l*d),g=new DataView(r,h,f),m=0,v=_.length;if("Uint16Array"===e)for(;m<v;m++)_[m]=g.getUint16(m*c,!0);else if("Float32Array"===e)for(;m<v;m++)_[m]=g.getFloat32(m*c,!0);a=_,g=null}else a=new n[e](r,h,d*l);i.setElements(a),o.resolve(i)}).catch(function(){u.warn("Can't read binary array URL")}),o.promise},readBufferArray:function(t){var e,i=this.getJSON(),a=i.UniqueID;if(void 0!==a&&(e=this._identifierMap[a],void 0!==e))return e;if(void 0===t&&(t=this.getOptions()),t.readBufferArray)return t.readBufferArray.call(this);if(!i.Elements&&!i.Array||!i.ItemSize||!i.Type)return r.reject();var s;if(i.Elements)s=r.resolve(new l(l[i.Type],i.Elements,i.ItemSize));else if(i.Array){
var o=new l(l[i.Type]);o.setItemSize(i.ItemSize);var h,c;if(i.Array.Float32Array?(h=i.Array.Float32Array,c="Float32Array"):i.Array.Uint16Array?(h=i.Array.Uint16Array,c="Uint16Array"):i.Array.Uint8Array&&(h=i.Array.Uint8Array,c="Uint8Array"),void 0===h)return u.warn("Typed Array "+window.Object.keys(i.Array)[0]),r.reject();h.File?s=this.initializeBufferArray(h,c,o):h.Elements&&(o.setElements(new n[c](h.Elements)),s=r.resolve(o))}return void 0!==a&&(this._identifierMap[a]=s),s},readUserDataContainer:function(){var t,e=this.getJSON(),i=e.UniqueID;return void 0!==i&&(t=this._identifierMap[i],void 0!==t)?t.Values:(this._identifierMap[i]=e,e.Values)},readPrimitiveSet:function(){var t,e,i,n,a,s,o=this.getJSON(),h=r.defer(),c=o.DrawElementUShort||o.DrawElementUByte||o.DrawElementUInt||o.DrawElementsUShort||o.DrawElementsUByte||o.DrawElementsUInt||void 0;if(c){if(t=c.UniqueID,void 0!==t&&(e=this._identifierMap[t],void 0!==e))return e;var l=c.Indices,g=o;n=c.Mode,n=n?_[n]:_.TRIANGLES,i=new p(n),this.setJSON(l),this.readBufferArray().then(function(t){i.setIndices(t),h.resolve(i)}).catch(function(){u.warn("Error buffer array")}),this.setJSON(g)}var m=o.DrawArray||o.DrawArrays;if(m){if(t=m.UniqueID,void 0!==t&&(e=this._identifierMap[t],void 0!==e))return e;n=m.Mode||m.mode,a=void 0!==m.First?m.First:m.first,s=void 0!==m.Count?m.Count:m.count;var v=new d(_[n],a,s);h.resolve(v)}var S=o.DrawArrayLengths||void 0;if(S){if(t=S.UniqueID,void 0!==t&&(e=this._identifierMap[t],void 0!==e))return e;n=S.Mode,a=S.First;var x=S.ArrayLengths,b=new f(_[n],a,x);h.resolve(b)}return void 0!==t&&(this._identifierMap[t]=h.promise),h.promise},readObject:function(){var t=this.getJSON(),e=window.Object.keys(t)[0];if(!e)return u.warn("can't find property for object "+t),r.reject();var n,a=t[e].UniqueID;if(void 0!==a&&(n=this._identifierMap[a],void 0!==n))return n;var s=this.getObjectWrapper(e);if(!s)return u.warn("can't instanciate object "+e),r.reject();var o=i(134),h=o.ObjectWrapper.serializers;if(this._cacheReadObject[e])h=this._cacheReadObject[e];else{for(var c=e.split("."),l=0,d=c.length;l<d;l++){var f=h[c[l]];if(void 0===f)return u.warn("can't find function to read object "+e+" - undefined"),r.reject();h=f}this._cacheReadObject[e]=h}var p=h(this.setJSON(t[e]),s);return void 0!==a&&(this._identifierMap[a]=p,s._uniqueID=a),p}},t.exports=g},function(t,e,i){var r=i(90),n=function(t,e){var i=r.defer(),n=new XMLHttpRequest;return n.open("GET",t,!0),e&&e.responseType&&(n.responseType=e.responseType),e&&e.progress&&n.addEventListener("progress",e.progress,!1),n.addEventListener("error",function(){i.reject()},!1),n.addEventListener("load",function(){"arraybuffer"===n.responseType||"blob"===n.responseType?i.resolve(n.response):i.resolve(n.responseText)}),n.send(null),i.promise};t.exports=n},function(t,e){"use strict";var i={prefixURL:"",databasePath:"",progressXHRCallback:void 0,readNodeURL:void 0,readImageURL:void 0,readBinaryArrayURL:void 0,imageLoadingUsePromise:!0,imageOnload:void 0,imageCrossOrigin:void 0};t.exports=i},function(t,e,i){var r=i(10),n=function(t){var e=new Uint8Array(t);return 31===e[0]&&139===e[1]},a=function(t){var e=new Uint8Array(t),n=i(133);n||r.error("osg failed to use a gunzip.min.js to uncompress a gz file.\n You can add this vendors to enable this feature or get it at https://github.com/imaya/zlib.js/blob/master/bin/gunzip.min.js");var a=new n.Gunzip(e),s=a.decompress();return s.buffer};t.exports={isGunzipBuffer:n,gunzip:a}},function(t,e){t.exports=__WEBPACK_EXTERNAL_MODULE_133__},function(t,e,i){"use strict";var r=i(10),n=i(6),a=i(41),s=i(51),o=i(37),h=i(48),u=i(46),c=i(86),l=i(45),d=i(29),f=i(12),p=i(15).mat4,_=i(61),g=i(62),m=i(135),v={};v.ObjectWrapper={},v.ObjectWrapper.serializers={},v.readImage=function(t,e){return v.registry().readImageURL(t,e)},v.readImageURL=v.readImage,v.readBinaryArrayURL=function(t,e){return v.registry().readBinaryArrayURL(t,e)},v.readNodeURL=function(t,e){var i=t.substr(t.lastIndexOf(".")+1),r=m.instance().getReaderWriterForExtension(i);return void 0!==r?r.readNodeURL(t,e):v.registry().readNodeURL(t,e)},v.registry=function(){var t=i(129);return void 0===v.registry._input&&(v.registry._input=new t),v.registry._input},v.parseSceneGraph=function(t,e){if(!(void 0!==t.Version&&t.Version>0)){n.time("osgjs.metric:ReaderParser.parseSceneGraphDeprecated");var i=v.parseSceneGraphDeprecated(t);return n.timeEnd("osgjs.metric:ReaderParser.parseSceneGraphDeprecated"),i}n.time("osgjs.metric:ReaderParser.parseSceneGraph");var a=function(t){for(var e=window.Object.keys(t),i=0,r=e.length;i<r;i++)if("Generator"!==e[i]&&"Version"!==e[i])return e[i]},s=a(t);if(s){var o={};o[s]=t[s];var h=v.registry().clone();h.setJSON(o);var u=n.objectMix(n.objectMix({},v.registry().getOptions()),e||{});h.setOptions(u);var c=h.readObject();return n.timeEnd("osgjs.metric:ReaderParser.parseSceneGraph"),c}r.log("can't parse scenegraph "+t)},v.parseSceneGraphDeprecated=function(t){var e,m=function(t,e){var i=e[t];return void 0===i&&(i=e[t.toLowerCase()]),i},S=function(t,e){var i=m("Name",e);i&&void 0!==t.setName&&t.setName(i)},x=function(t,e){S(t,e),t.setAmbient(m("Ambient",e)),t.setDiffuse(m("Diffuse",e)),t.setEmission(m("Emission",e)),t.setSpecular(m("Specular",e)),t.setShininess(m("Shininess",e))},b=function(t,e){S(t,e),t.setSourceRGB(e.SourceRGB),t.setSourceAlpha(e.SourceAlpha),t.setDestinationRGB(e.DestinationRGB),t.setDestinationAlpha(e.DestinationAlpha)},M=function(t,e){var i=e.MagFilter||e.mag_filter||void 0;i&&t.setMagFilter(i);var n=e.MinFilter||e.min_filter||void 0;n&&t.setMinFilter(n);var a=e.WrapT||e.wrap_t||void 0;a&&t.setWrapT(a);var s=e.WrapS||e.wrap_s||void 0;s&&t.setWrapS(s);var o=m("File",e);v.readImage(o).then(function(e){t.setImage(e)}).catch(function(){r.log("Can't read image")})},y=function(t,e){S(t,e);var n=m("Textures",e)||m("TextureAttributeList",e)||void 0;if(n)for(var o=0,h=n.length;o<h;o++){var u=m("File",n[o]);if(u){var c=i(40),l=new c;M(l,n[o]),t.setTextureAttributeAndModes(o,l),t.addUniform(a.createInt1(o,"Texture"+o))}else r.log("no texture on unit "+o+" skip it")}var d=m("BlendFunc",e);if(d){var f=new s;b(f,d),t.setAttributeAndModes(f)}var p=m("Material",e);if(p){var _=i(100),g=new _;x(g,p),t.setAttributeAndModes(g)}},T=t.children,w=t.primitives||t.Primitives||void 0,C=t.attributes||t.Attributes||void 0;if(w||C){var A=new o;S(A,t),A.stateset=t.stateset,t=A;for(var E=0,I=w.length;E<I;E++){var F=w[E].mode;if(w[E].indices){var R=w[E].indices;R=new h(h[R.type],R.elements,R.itemSize),F=F?u[F]:"TRIANGLES",A.getPrimitiveSetList().push(new l(F,R))}else{F=u[F];var N=w[E].first,D=w[E].count;A.getPrimitiveSetList().push(new c(F,N,D))}}for(var L=window.Object.keys(C),P=0,O=L.length;P<O;P++){var k=L[P],V=C[k];A.getVertexAttributeList()[k]=new h(V.type,V.elements,V.itemSize)}}var B=m("StateSet",t);if(B){var U=new d;y(U,B),t.stateset=U}var G=t.matrix||t.Matrix||void 0;G&&(e=new _,S(e,t),n.extend(e,t),p.copy(e.getMatrix(),G),t=e);var z=t.projection||t.Projection||void 0;if(z&&(e=new g,S(e,t),n.extend(e,t),p.copy(e.setProjectionMatrix(),z),t=e),void 0===t.typeID&&(e=new f,S(e,t),n.extend(e,t),t=e),T){t.children=[];for(var j=0,H=T.length;j<H;j++)t.addChild(v.parseSceneGraphDeprecated(T[j]))}return t},t.exports=v},function(t,e,i){"use strict";var r=i(10),n={instance:function(){return n._instance||(n._instance=n,n._instance.plugins=new window.Map),n._instance},addReaderWriter:function(t,e){void 0!==n.instance().plugins.get(t)&&r.warn("the '"+t+"' plugin already exists"),n.instance().plugins.set(t,e)},getReaderWriterForExtension:function(t){return n.instance().plugins.get(t)}};t.exports=n},function(t,e,i){"use strict";var r=i(90),n=i(6),a=i(32),s=i(69),o=i(9),h=function(){this._pendingRequests=[],this._pendingNodes=[],this._loading=!1,this._progressCallback=void 0,this._lastCB=!0,this._activePagedLODList=new Set,this._childrenToRemoveList=new Set,this._downloadingRequestsNumber=0,this._maxRequestsPerFrame=10,this._acceptNewRequests=!0,this._targetMaximumNumberOfPagedLOD=75},u=function(){this._loadedModel=void 0,this._group=void 0,this._url=void 0,this._function=void 0,this._timeStamp=0,this._groupExpired=!1,this._priority=0},c=function(t,e){a.call(this,a.TRAVERSE_ALL_CHILDREN),this._activePagedLODList=t,this._frameNumber=e};c.prototype=n.objectInherit(a.prototype,{apply:function(t){t.getTypeID()===s.getTypeID()&&(t.setFrameNumberOfLastTraversal(this._frameNumber),this._activePagedLODList.add(t)),this.traverse(t)}});var l=function(){a.call(this,a.TRAVERSE_ALL_CHILDREN)};l.prototype=n.objectInherit(a.prototype,{apply:function(t){t.releaseGLObjects(),this.traverse(t)}});var d=function(){a.call(this,a.TRAVERSE_ALL_CHILDREN),this._childrenList=[]};d.prototype=n.objectInherit(a.prototype,{apply:function(t){t.getTypeID()===s.getTypeID()&&(this._childrenList.push(t),this._markRequestsExpired(t)),this.traverse(t)},removeExpiredChildrenAndFindPagedLODs:function(t,e,i,r){if(!t.children.length)return!1;var n=r.length;t.removeExpiredChildren(e,i,r);for(var a=n;a<r.length;a++)r[a].accept(this);return n!==r.length},_markRequestsExpired:function(t){for(var e,i=t._perRangeDataList.length,r=0;r<i;r++)e=t.getDatabaseRequest(r),void 0!==e&&(e._groupExpired=!0,e._loadedModel=null)}}),h.prototype=n.objectLibraryClass({setTargetMaximumNumberOfPageLOD:function(t){this._targetMaximumNumberOfPagedLOD=t},getTargetMaximumNumberOfPageLOD:function(){return this._targetMaximumNumberOfPagedLOD},setAcceptNewDatabaseRequests:function(t){this._acceptNewRequests=t},getAcceptNewDatabaseRequests:function(){return this._acceptNewRequests},reset:function(){this._pendingRequests=[],this._pendingNodes=[],this._loading=!1,this._lastCB=!0,this._activePagedLODList.clear(),this._childrenToRemoveList.clear(),this._downloadingRequestsNumber=0,this._maxRequestsPerFrame=10,this._acceptNewRequests=!0,this._targetMaximumNumberOfPagedLOD=75},updateSceneGraph:function(t){void 0!==this._progressCallback&&this.executeProgressCallback(),this.removeExpiredSubgraphs(t,.0025),this.takeRequests(),this.addLoadedDataToSceneGraph(t,.005)},executeProgressCallback:function(){this._pendingRequests.length>0||this._pendingNodes.length>0?(this._progressCallback(this._pendingRequests.length+this._downloadingRequestsNumber,this._pendingNodes.length),this._lastCB=!1):this._lastCB||(this._progressCallback(this._pendingRequests.length+this._downloadingRequestsNumber,this._pendingNodes.length),this._lastCB=!0)},setMaxRequestsPerFrame:function(t){this._maxRequestsPerFrame=t},getMaxRequestsPerFrame:function(){return this._maxRequestsPerFrame},getRequestListSize:function(){return this._pendingRequests.length+this._downloadingRequestsNumber},setProgressCallback:function(t){this._progressCallback=t},addLoadedDataToSceneGraph:function(t,e){if(e<=0)return 0;var i=0,r=o.instance().tick();this._pendingNodes.sort(function(t,e){return e._timeStamp-t._timeStamp});for(var n=0;n<this._pendingNodes.length;n++){if(i>e)return 0;var a=this._pendingNodes.shift(),s=t.getFrameNumber(),h=t.getSimulationTime();if(a._groupExpired===!1){var u=a._group;u.setTimeStamp(u.children.length,h),u.setFrameNumber(u.children.length,s),u.addChildNode(a._loadedModel),this._activePagedLODList.has(u)?this.registerPagedLODs(a._loadedModel,s):this.registerPagedLODs(u,s)}else a._loadedModel=void 0,a=void 0;i=o.instance().deltaS(r,o.instance().tick())}return e-=i},isLoading:function(){return this._loading},registerPagedLODs:function(t,e){t&&t.accept(new c(this._activePagedLODList,e))},requestNodeFile:function(t,e,i,r,n){if(this._acceptNewRequests){var a=new u;return a._group=i,a._function=t,a._url=e,a._timeStamp=r,a._priority=n,this._pendingRequests.push(a),a}},takeRequests:function(){if(this._pendingRequests.length){var t=Math.min(this._maxRequestsPerFrame,this._pendingRequests.length);this._pendingRequests.sort(function(t,e){var i=t._timeStamp-e._timeStamp;return 0===i&&(i=t._priority-e._priority),i});for(var e=0;e<t;e++)this._downloadingRequestsNumber++,this.processRequest(this._pendingRequests.shift())}},processRequest:function(t){this._loading=!0;var e=this;return t._groupExpired?(e._downloadingRequestsNumber--,void(this._loading=!1)):void(void 0!==t._function?this.loadNodeFromFunction(t._function,t._group).then(function(i){e._downloadingRequestsNumber--,t._loadedModel=i,e._pendingNodes.push(t),e._loading=!1}):""!==t._url&&this.loadNodeFromURL(t._url).then(function(i){e._downloadingRequestsNumber--,t._loadedModel=i,e._pendingNodes.push(t),e._loading=!1}))},loadNodeFromFunction:function(t,e){var i=t(e);return i?i&&i.then?i:r.resolve(i):r.reject()},loadNodeFromURL:function(t){var e=i(134);return e.readNodeURL(t)},releaseGLExpiredSubgraphs:function(t){if(t<=0)return 0;var e=0,i=o.instance().tick(),r=this;return this._childrenToRemoveList.forEach(function(n){e>t||(r._childrenToRemoveList.delete(n),n.accept(new l),n.removeChildren(),n=null,e=o.instance().deltaS(i,o.instance().tick()))}),t-=e},removeExpiredSubgraphs:function(t,e){if(0===t.getFrameNumber())return 0;var i=this._activePagedLODList.size-this._targetMaximumNumberOfPagedLOD,r=t.getSimulationTime()-.1,n=t.getFrameNumber()-1;return i>0&&(e=this.removeExpiredChildren(i,r,n,e)),e},removeExpiredChildren:function(t,e,i,r){var n=0,a=o.instance().tick(),s=this,h=[],u=new d;return this._activePagedLODList.forEach(function(c){if(n>r)return 0;if(t<0)return r;if(i<c.getFrameNumberOfLastTraversal())return r;u.removeExpiredChildrenAndFindPagedLODs(c,e,i,h);for(var l=0;l<u._childrenList.length;l++)s._activePagedLODList.delete(u._childrenList[l]),t--;for(l=0;l<h.length;l++)s._childrenToRemoveList.add(h[l]);u._childrenList.length=0,h.length=0,n=o.instance().deltaS(a,o.instance().tick())}),r-=n}},"osgDB","DatabasePager"),t.exports=h},function(t,e,i){"use strict";var r=i(90),n=i(35),a={};a.Object=function(t,e){var i=t.getJSON();if(i.Name&&e.setName(i.Name),i.UserDataContainer){var r=t.setJSON(i.UserDataContainer).readUserDataContainer();void 0!==r&&e.setUserData(r)}return e},a.Node=function(t,e){var i=t.getJSON();a.Object(t,e);var n=[];if(i.UpdateCallbacks)for(var s=e.addUpdateCallback.bind(e),o=0,h=i.UpdateCallbacks.length;o<h;o++){var u=t.setJSON(i.UpdateCallbacks[o]).readObject();n.push(u),u.then(s)}if(i.StateSet){var c=t.setJSON(i.StateSet).readObject();n.push(c),c.then(e.setStateSet.bind(e))}var l=[];if(i.Children)for(var d=0,f=i.Children.length;d<f;d++)l.push(t.setJSON(i.Children[d]).readObject());return r.all(n).then(function(){return r.all(l).then(function(t){for(var i=t.length,r=0;r<i;r++)e.addChild(t[r]);return e})})},a.StateSet=function(t,e){var i=t.getJSON();a.Object(t,e),void 0!==i.RenderingHint&&e.setRenderingHint(i.RenderingHint);var n=[],s=function(i){var r=t.setJSON(i).readObject();r.isRejected()||(n.push(r),r.then(e.setAttributeAndModes.bind(e)))};if(void 0!==i.AttributeList)for(var o=0,h=i.AttributeList.length;o<h;o++)s(i.AttributeList[o]);var u=function(i,r){var a=t.setJSON(r).readObject();a.isRejected()||(n.push(a),a.then(e.setTextureAttributeAndModes.bind(e,i)))};if(i.TextureAttributeList)for(var c=i.TextureAttributeList,l=0,d=c.length;l<d;l++)for(var f=c[l],p=0,_=f.length;p<_;p++)u(l,f[p]);return r.all(n).then(function(){return e})},a.Material=function(t,e){var i=t.getJSON();return i.Diffuse&&i.Emission&&i.Specular&&void 0!==i.Shininess?(a.Object(t,e),e.setAmbient(i.Ambient),e.setDiffuse(i.Diffuse),e.setEmission(i.Emission),e.setSpecular(i.Specular),e.setShininess(i.Shininess),r.resolve(e)):r.reject()},a.BlendFunc=function(t,e){var i=t.getJSON();return i.SourceRGB&&i.SourceAlpha&&i.DestinationRGB&&i.DestinationAlpha?(a.Object(t,e),e.setSourceRGB(i.SourceRGB),e.setSourceAlpha(i.SourceAlpha),e.setDestinationRGB(i.DestinationRGB),e.setDestinationAlpha(i.DestinationAlpha),r.resolve(e)):r.reject()},a.CullFace=function(t,e){var i=t.getJSON();return void 0===i.Mode?r.reject():(a.Object(t,e),e.setMode(i.Mode),r.resolve(e))},a.BlendColor=function(t,e){var i=t.getJSON();return i.ConstantColor?(a.Object(t,e),e.setConstantColor(i.ConstantColor),r.resolve(e)):r.reject()},a.Light=function(t,e){var i=t.getJSON();return i.Ambient&&i.Diffuse&&i.Direction&&i.Position&&i.Specular&&void 0!==i.LightNum&&void 0!==i.SpotCutoff&&void 0!==i.LinearAttenuation&&void 0!==i.ConstantAttenuation&&void 0!==i.QuadraticAttenuation?(a.Object(t,e),e.setAmbient(i.Ambient),e.setConstantAttenuation(i.ConstantAttenuation),e.setDiffuse(i.Diffuse),e.setDirection(i.Direction),e.setLightNumber(i.LightNum),e.setLinearAttenuation(i.LinearAttenuation),e.setPosition(i.Position),e.setQuadraticAttenuation(i.QuadraticAttenuation),e.setSpecular(i.Specular),e.setSpotCutoff(i.SpotCutoff),e.setSpotBlend(.01),void 0!==i.SpotExponent&&e.setSpotBlend(i.SpotExponent/128),r.resolve(e)):r.reject()},a.Texture=function(t,e){var i=t.getJSON();a.Object(t,e),i.MinFilter&&e.setMinFilter(i.MinFilter),i.MagFilter&&e.setMagFilter(i.MagFilter),i.WrapT&&e.setWrapT(i.WrapT),i.WrapS&&e.setWrapS(i.WrapS);var r=i.File;return void 0===r&&(r="no-image-provided"),t.readImageURL(r).then(function(t){return e.setImage(t),e})},a.Projection=function(t,e){var i=t.getJSON();if(!i.Matrix)return r.reject();var n=a.Node(t,e);return e.setMatrix(i.Matrix),n},a.MatrixTransform=function(t,e){var i=t.getJSON();if(!i.Matrix)return r.reject();var n=a.Node(t,e);return e.setMatrix(i.Matrix),n},a.LightSource=function(t,e){var i=t.getJSON();if(!i.Light)return r.reject();var s=a.Node(t,e);return r.all([t.setJSON(i.Light).readObject(),s]).then(function(t){var r=t[0];return e.setLight(r),"ABSOLUTE_RF"===i.ReferenceFrame&&e.setReferenceFrame(n.ABSOLUTE_RF),e})},a.functionSortAttributes=function(t,e){return t.indexOf("TexCoord")!==-1&&e.indexOf("TexCoord")!==-1?parseInt(t.substr(8),10)-parseInt(e.substr(8),10):t<e?-1:t>e?1:0},a.Geometry=function(t,e){var i=t.getJSON();if(!i.VertexAttributeList)return r.reject();i.PrimitiveSetList=i.PrimitiveSetList||[];var n=[];n.push(a.Node(t,e));var s=e.getPrimitives(),o=s.push.bind(s),h=0,u=i.PrimitiveSetList.length;for(h=0;h<u;h++){var c=t.setJSON(i.PrimitiveSetList[h]).readPrimitiveSet();n.push(c),c.then(o)}var l=function(t,e){this.getVertexAttributeList()[t]=e},d=i.VertexAttributeList,f=window.Object.keys(d);for(f.sort(a.functionSortAttributes),u=f.length,h=0;h<u;h++){var p=f[h],_=t.setJSON(d[p]).readBufferArray();n.push(_),_.then(l.bind(e,p))}return r.all(n).then(function(){return e})},a.PagedLOD=function(t,e){var i=t.getJSON();a.Object(t,e),"USE_BOUNDING_SPHERE_CENTER"===i.CenterMode?e.setCenterMode(0):"UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED"===i.CenterMode&&e.setCenterMode(2),e.setCenter([i.UserCenter[0],i.UserCenter[1],i.UserCenter[2]]),e.setRadius(i.UserCenter[3]),"PIXEL_SIZE_ON_SCREEN"===i.RangeMode&&e.setRangeMode(1);for(var n,s=i.RangeList,o=0;o<window.Object.keys(s).length;o++){n="Range "+o;var h=s[n];e.setRange(o,h[0],h[1])}for(s=i.RangeDataList,o=0;o<window.Object.keys(s).length;o++)n="File "+o,e.setFileName(o,s[n]);e.setDatabasePath(t.getDatabasePath());var u=[];if(i.Children)for(var c=0,l=i.Children.length;c<l;c++)u.push(t.setJSON(i.Children[c]).readObject());return r.all(u).then(function(t){var i=t.length;for(o=0;o<i;o++)e.addChildNode(t[o]);return e})},t.exports=a},function(t,e,i){"use strict";var r=i(90),n=i(10),a=i(137),s=i(115),o=i(114),h=i(134),u=i(123),c=i(126),l=i(77),d=i(37),f={},p=function(){},_=h.registry();_.registerObject("osgAnimation.Vec3LerpChannel",p),_.registerObject("osgAnimation.FloatLerpChannel",p),_.registerObject("osgAnimation.QuatSlerpChannel",p),_.registerObject("osgAnimation.QuatLerpChannel",p),_.registerObject("osgAnimation.FloatCubicBezierChannel",p),_.registerObject("osgAnimation.Vec3CubicBezierChannel",p),_.registerObject("osgAnimation.StackedMatrixElement",u),_.registerObject("osgAnimation.StackedScaleElement",c),f.Animation=function(t){var e=t.getJSON();if(void 0===e.Name||!e.Channels||0===e.Channels.length)return r.reject();for(var i=[],n=0,a=e.Channels.length;n<a;n++){var s=t.setJSON(e.Channels[n]).readObject();i.push(s)}return r.all(i).then(function(t){return o.createAnimation(t,e.Name)})},f.StandardVec3Channel=function(t,e,i){var n=t.getJSON();if(!(void 0!==n.TargetName&&n.KeyFrames&&n.Name&&n.KeyFrames.Time&&n.KeyFrames.Key&&3===n.KeyFrames.Key.length))return r.reject();var a=t.setJSON(n.KeyFrames.Time).readBufferArray(),s=t.setJSON(n.KeyFrames.Key[0]).readBufferArray(),o=t.setJSON(n.KeyFrames.Key[1]).readBufferArray(),h=t.setJSON(n.KeyFrames.Key[2]).readBufferArray();return r.all([a,s,o,h]).then(function(t){for(var r=t[0].getElements(),a=t[1].getElements(),s=t[2].getElements(),o=t[3].getElements(),h=r.length,u=new Float32Array(new ArrayBuffer(4*(h+1)*3),0,3*h),c=new Float32Array(new ArrayBuffer(4*(h+1)),0,h),l=0;l<h;l++){var d=3*l;c[l]=r[l],u[d++]=a[l],u[d++]=s[l],u[d]=o[l]}return i(u,c,n.TargetName,n.Name,e),e})},f.StandardQuatChannel=function(t,e,i){var n=t.getJSON();if(!(void 0!==n.TargetName&&n.KeyFrames&&n.Name&&n.KeyFrames.Time&&n.KeyFrames.Key&&4===n.KeyFrames.Key.length))return r.reject();var a=t.setJSON(n.KeyFrames.Time).readBufferArray(),s=t.setJSON(n.KeyFrames.Key[0]).readBufferArray(),o=t.setJSON(n.KeyFrames.Key[1]).readBufferArray(),h=t.setJSON(n.KeyFrames.Key[2]).readBufferArray(),u=t.setJSON(n.KeyFrames.Key[3]).readBufferArray();return r.all([a,s,o,h,u]).then(function(t){for(var r=t[0].getElements(),a=t[1].getElements(),s=t[2].getElements(),o=t[3].getElements(),h=t[4].getElements(),u=r.length,c=new Float32Array(new ArrayBuffer(4*(u+1)*4),0,4*u),l=new Float32Array(new ArrayBuffer(4*(u+1)),0,u),d=0;d<u;d++){var f=4*d;l[d]=r[d],c[f++]=a[d],c[f++]=s[d],c[f++]=o[d],c[f]=h[d]}return i(c,l,n.TargetName,n.Name,e),e})},f.StandardFloatChannel=function(t,e,i){var n=t.getJSON();if(!(void 0!==n.TargetName&&n.KeyFrames&&n.Name&&n.KeyFrames.Time&&n.KeyFrames.Key))return r.reject();var a=t.setJSON(n.KeyFrames.Time).readBufferArray(),s=t.setJSON(n.KeyFrames.Key).readBufferArray();return r.all([a,s]).then(function(t){for(var r=t[0].getElements(),a=t[1].getElements(),s=r.length,o=new Float32Array(new ArrayBuffer(4*(s+1)),0,s),h=new Float32Array(new ArrayBuffer(4*(s+1)),0,s),u=0;u<s;u++)h[u]=r[u],o[u]=a[u];return i(o,h,n.TargetName,n.Name,e),e})},f.Vec3LerpChannel=function(t,e){return f.StandardVec3Channel(t,e,s.createVec3Channel)},f.QuatLerpChannel=function(t,e){return f.StandardQuatChannel(t,e,s.createQuatChannel)},f.QuatSlerpChannel=function(t,e){return f.StandardQuatChannel(t,e,s.createQuatChannel)},f.FloatLerpChannel=function(t,e){return f.StandardFloatChannel(t,e,s.createFloatChannel)},f.FloatCubicBezierChannel=function(t,e){var i=t.getJSON();if(!(void 0!==i.TargetName&&i.KeyFrames&&i.Name&&i.KeyFrames.Time&&i.KeyFrames.Position&&i.KeyFrames.ControlPointOut&&i.KeyFrames.ControlPointIn))return r.reject();for(var n=[],a=window.Object.keys(i.KeyFrames),o=0;o<a.length;o++)n.push(t.setJSON(i.KeyFrames[a[o]]).readBufferArray());return r.all(n).then(function(t){for(var r=t[0].getElements(),n=t[1].getElements(),a=t[2].getElements(),o=t[3].getElements(),h=o.length,u=new Float32Array(new ArrayBuffer(4*(h+1)*3),0,3*h),c=new Float32Array(new ArrayBuffer(4*(h+1)),0,h),l=0;l<h;l++){var d=3*l;c[l]=o[l],u[d++]=a[l],u[d++]=r[l],u[d]=n[l]}return s.createFloatCubicBezierChannel(u,c,i.TargetName,i.Name,e),e})},f.Vec3CubicBezierChannel=function(t,e){var i=t.getJSON();if(!(void 0!==i.TargetName&&i.KeyFrames&&i.Name&&i.KeyFrames.Time&&i.KeyFrames.Position&&i.KeyFrames.ControlPointOut&&i.KeyFrames.ControlPointIn&&3===i.KeyFrames.Position.length&&3===i.KeyFrames.ControlPointIn.length&&3===i.KeyFrames.ControlPointOut.length))return r.reject();for(var n=[],a=window.Object.keys(i.KeyFrames),o=0;o<a.length;o++){var h=a[o],u=i.KeyFrames[h];"Time"!==h?(n.push(t.setJSON(u[0]).readBufferArray()),n.push(t.setJSON(u[1]).readBufferArray()),n.push(t.setJSON(u[2]).readBufferArray())):n.push(t.setJSON(u).readBufferArray())}return r.all(n).then(function(t){for(var r=t[0].getElements(),n=t[1].getElements(),a=t[2].getElements(),o=t[3].getElements(),h=t[4].getElements(),u=t[5].getElements(),c=t[6].getElements(),l=t[7].getElements(),d=t[8].getElements(),f=t[9].getElements(),p=f.length,_=new Float32Array(new ArrayBuffer(4*(p+1)*9),0,9*p),g=new Float32Array(new ArrayBuffer(4*(p+1)),0,p),m=0;m<p;m++){var v=9*m;g[m]=f[m],_[v++]=c[m],_[v++]=l[m],_[v++]=d[m],_[v++]=r[m],_[v++]=n[m],_[v++]=a[m],_[v++]=o[m],_[v++]=h[m],_[v]=u[m]}return s.createVec3CubicBezierChannel(_,g,i.TargetName,i.Name,e),e})},f.BasicAnimationManager=function(t,e){var i=t.getJSON();if(!i.Animations)return r.reject();a.Object(t,e);for(var s=[],o=0,h=i.Animations.length;o<h;o++){var u=t.setJSON(i.Animations[o]).readObject();u.isRejected()?n.warn("An Animation failed on the parsing!"):s.push(u)}return r.all(s).then(function(t){return e.init(t),e})},f.UpdateMatrixTransform=function(t,e){var i=t.getJSON();if(/*!jsonObj.Name ||*/!i.StackedTransforms)return r.reject();a.Object(t,e);for(var n=[],s=0,o=i.StackedTransforms.length;s<o;s++)n.push(t.setJSON(i.StackedTransforms[s]).readObject());return r.all(n).then(function(t){for(var i=e.getStackedTransforms(),r=0,n=t.length;r<n;r++)i.push(t[r]);return e.computeChannels(),e})},f.StackedTranslate=function(t,e){var i=t.getJSON();return i.Name&&i.Translate?(a.Object(t,e),e.init(i.Translate),r.resolve(e)):r.reject()},f.StackedQuaternion=function(t,e){var i=t.getJSON();return i.Name&&i.Quaternion?(a.Object(t,e),e.init(i.Quaternion),r.resolve(e)):r.reject()},f.StackedRotateAxis=function(t,e){var i=t.getJSON();return i.Axis&&void 0!==i.Angle?(a.Object(t,e),e.init(i.Axis,i.Angle),r.resolve(e)):r.reject()},f.StackedMatrix=function(t,e){var i=t.getJSON();return i.Name&&i.Matrix?(a.Object(t,e),e.init(i.Matrix),r.resolve(e)):r.reject()},f.StackedScale=function(t,e){var i=t.getJSON();return i.Name&&i.Scale?(a.Object(t,e),e.init(i.Scale),r.resolve(e)):r.reject()},f.Bone=function(t,e){var i=t.getJSON();if(!i.InvBindMatrixInSkeletonSpace)return r.reject();var n=a.MatrixTransform(t,e);if(e.setInvBindMatrixInSkeletonSpace(i.InvBindMatrixInSkeletonSpace),i.BoundingBox){var s=e.getBoneBoundingBox();s.setMax(i.BoundingBox.max),s.setMin(i.BoundingBox.min)}return n},f.UpdateBone=f.UpdateMatrixTransform,f.UpdateSkeleton=function(t,e){return a.Object(t,e),r.resolve(e)},f.Skeleton=a.MatrixTransform,f.RigGeometry=function(t,e){var i=t.getJSON();if(!i.SourceGeometry)return r.reject();i.BoneMap||n.warn("No boneMap found in a RigGeometry !");var s=a.Geometry(t,e);e._boneNameID=i.BoneMap;var o,h=i.SourceGeometry["osg.Geometry"];return h?(t.setJSON(h),e.setSourceGeometry(new d),o=a.Geometry(t,e.getSourceGeometry())):(h=i.SourceGeometry["osgAnimation.MorphGeometry"],h?(t.setJSON(h),e.setSourceGeometry(new l),o=f.MorphGeometry(t,e.getSourceGeometry())):n.warn("SourceGeometry type no recognized")),void 0===e._uniqueID&&(e._uniqueID=h.UniqueID),r.all([s,o]).then(function(){return e.mergeChildrenData(),e})},f.MorphGeometry=function(t,e){var i=t.getJSON();if(!i.MorphTargets)return r.reject();var n=i.MorphTargets,s=[];s.push(a.Geometry(t,e));for(var o=0,h=n.length;o<h;o++)s.push(t.setJSON(n[o]).readObject());return r.all(s).then(function(t){for(var e=t[0],i=e.getMorphTargets(),r=1,n=t.length;r<n;r++)i.push(t[r]);return e.mergeChildrenVertexAttributeList(),e})},f.UpdateMorph=function(t,e){var i=t.getJSON();if(!i.TargetMap)return r.reject();a.Object(t,e);for(var n=window.Object.keys(i.TargetMap),s=0,o=n.length;s<o;s++){var h=n[s];e.addTarget(i.TargetMap[h],parseInt(h,10))}return r.resolve(e)},f.StackedMatrixElement=f.StackedMatrix,f.StackedScaleElement=f.StackedScale,t.exports=f},function(t,e,i){"use strict";var r=i(90),n=i(137),a=i(10),s=i(140),o={};o.Text=function(t,e){var i=t.getJSON();if(!i.Text)return r.reject();var o=n.Node(t,e);if(e.setColor(i.Color),e.setText(i.Text),e.setAutoRotateToScreen(i.AutoRotateToScreen),e.setPosition(i.Position),e.setCharacterSize(i.CharacterSize),"VERTICAL"===i.Layout)return a.error("Vertical Alignment not supported"),r.reject();var h=i.Alignment;return i.Alignment.indexOf("BASE_LINE")>-1&&("LEFT_BASE_LINE"===i.Alignment?h=s.LEFT_CENTER:"CENTER_BASE_LINE"===i.Alignment?h=s.CENTER_CENTER:"RIGHT_BASE_LINE"===i.Alignment?h=s.RIGHT_CENTER:"LEFT_BOTTOM_BASE_LINE"===i.Alignment?h=s.LEFT_BOTTOM:"CENTER_BOTTOM_BASE_LINE"===i.Alignment?h=s.CENTER_BOTTOM:"RIGHT_BOTTOM_BASE_LINE"===i.Alignment&&(h=s.RIGHT_BOTTOM),a.log("Base line alignments not supported, alignment converted")),e.setAlignment(h),e.setLayout(i.Layout),o},t.exports=o},function(t,e,i){"use strict";var r=i(6),n=i(15).vec3,a=i(15).vec4,s=i(15).mat4,o=i(5),h=i(61),u=i(105),c=i(40),l=i(51),d=i(15).quat,f=i(32),p=i(12),_=function(t){o.call(this),this._canvas=document.createElement("canvas"),this._context=this._canvas.getContext("2d"),this._matrixTransform=new h,this.addChild(this._matrixTransform),this._text="",void 0!==t&&(this._text=t),this._font="monospace",this._color=a.fromValues(0,0,0,1),this._fillStyle="rgba( 0, 0, 0, 1 )",this._context.textAlign="center",this._textX=void 0,this._context.baseLine="middle",this._textY=void 0,this._characterSize=1,this._characterSizeMode=_.OBJECT_COORDS,this._fontSize=32,this._geometry=void 0,this._autoRotateToScreen=!1,this._position=n.create(),this._layout=_.LEFT_TO_RIGHT,this._alignment=_.CENTER_CENTER,this._forcePowerOfTwo=!1,this._texture=new c,this.drawText(),this._dirty=!1,this._previousModelView=s.create()};_.OBJECT_COORDS=0,_.SCREEN_COORDS=1,_.OBJECT_COORDS_WITH_MAXIMUM_SCREEN_SIZE_CAPPED_BY_FONT_HEIGHT=2,_.LEFT_TO_RIGHT="ltr",_.RIGHT_TO_LEFT="rtl",_.LEFT_TOP=0,_.LEFT_CENTER=1,_.LEFT_BOTTOM=2,_.CENTER_TOP=3,_.CENTER_CENTER=4,_.CENTER_BOTTOM=5,_.RIGHT_TOP=6,_.RIGHT_CENTER=7,_.RIGHT_BOTTOM=8,_.prototype=r.objectLibraryClass(r.objectInherit(o.prototype,{drawText:function(){if(void 0!==this._geometry&&(this._matrixTransform.removeChild(this._geometry),this._geometry.releaseGLObjects()),this._text){this.setTextProperties(),this._canvas.width=this._context.measureText(this._text).width,this._canvas.height=2*this._fontSize,this._forcePowerOfTwo&&(this._canvas.width=this._nextPowerOfTwo(this._canvas.width),this._canvas.height=this._nextPowerOfTwo(this._canvas.height)),this.setTextProperties(),this._context.clearRect(0,0,this._canvas.width,this._canvas.height),this._context.fillText(this._text,this._textX,this._textY);var t=this._canvas.width/this._canvas.height,e=this._characterSize*t;this._geometry=u.createTexturedQuadGeometry(-e/2,-this._characterSize/2,0,e,0,0,0,this._characterSize,0),this._texture.setTextureSize(this._canvas.width,this._canvas.height),this._texture.setMinFilter("LINEAR"),this._texture.setMagFilter("LINEAR"),this._texture.setImage(this._canvas);var i=this._geometry.getOrCreateStateSet();i.setTextureAttributeAndModes(0,this._texture),i.setRenderingHint("TRANSPARENT_BIN"),i.setAttributeAndModes(new l(l.ONE,l.ONE_MINUS_SRC_ALPHA)),this._matrixTransform.addChild(this._geometry),this.dirtyBound()}},setText:function(t){this._text=t,this._dirty=!0},getText:function(){return this._text},setFont:function(t){this._font=t,this._dirty=!0},setColor:function(t){this._color=t,this._fillStyle="rgba("+Math.round(255*t[0])+","+Math.round(255*t[1])+","+Math.round(255*t[2])+","+t[3]+")",this._context.fillStyle=this._fillStyle,this._context.fillText(this._text,this._textX,this._textY)},getColor:function(){return this._color},setCharacterSize:function(t){this._characterSize=t,this._characterSizeMode!==_.OBJECT_COORDS&&(s.fromScaling(this._matrixTransform.getMatrix(),[this._characterSize,this._characterSize,this._characterSize]),this._characterSizeMode===_.OBJECT_COORDS_WITH_MAXIMUM_SCREEN_SIZE_CAPPED_BY_FONT_HEIGHT&&this.setMaximumScale(this._characterSize)),this._dirty=!0},getCharacterSize:function(){return this._characterSize},setCharacterSizeMode:function(t){this._characterSizeMode=t,this._characterSizeMode!==_.OBJECT_COORDS?(s.fromScaling(this._matrixTransform.getMatrix(),[this._characterSize,this._characterSize,this._characterSize]),this.setAutoScaleToScreen(!0),this.setMaximumScale(Number.MAX_VALUE),this._characterSizeMode===_.OBJECT_COORDS_WITH_MAXIMUM_SCREEN_SIZE_CAPPED_BY_FONT_HEIGHT&&this.setMaximumScale(this._characterSize)):(this._matrixTransform.setMatrix(s.create()),
this.setAutoScaleToScreen(!1)),this._dirty=!0},getCharacterSizeMode:function(){return this._characterSizeMode},setFontResolution:function(t){this._fontSize=t,this._dirty=!0},getFontResolution:function(){return this._fontSize},setPosition:function(t){this._position=t,s.fromTranslation(this.getMatrix(),t)},getPosition:function(){return this._position},setTextProperties:function(){this._context.fillStyle=this._fillStyle,this._setAlignmentValues(this._alignment),this._context.font=this._fontSize+"px "+this._font,this._context.direction=this._layout},setAutoRotateToScreen:function(t){o.prototype.setAutoRotateToScreen.call(this,t),this._dirty=!0},getAutoRotateToScreen:function(){return this._autoRotateToScreen},setLayout:function(t){"string"==typeof t?this._layout=_[t]:this._layout=t,this._dirty=!0},getLayout:function(){return this._layout},setAlignment:function(t){"string"==typeof t?this._alignment=_[t]:this._alignment=t,this._dirty=!0},getAlignment:function(){return this._alignment},accept:function(){return function(t){if(this._dirty&&(this.drawText(),this._dirty=!1),t.getVisitorType()===f.CULL_VISITOR){var e=t.getViewport().width(),i=t.getViewport().height(),r=t.getCurrentProjectionMatrix(),o=t.getCurrentModelViewMatrix(),h=this._position,u=this._firstTimeToInitEyePoint;if(this._firstTimeToInitEyePoint||(s.exactEquals(o,this._previousModelView)?e!==this._previousWidth||i!==this._previousHeight?u=!0:s.exactEquals(r,this._previousProjection)?n.exactEquals(h,this._previousPosition)||(u=!0):u=!0:u=!0),this._firstTimeToInitEyePoint=!1,u){if(this._autoScaleToScreen){var c=t.getViewport(),l=this.computePixelSizeVector(c,r,o),_=a.fromValues(this._position[0],this._position[1],this._position[2],1),g=a.dot(_,l);g=.48/g;var m=1/g;if(this._autoScaleTransitionWidthRatio>0){var v,S,x;if(this._minimumScale>0){var b=this._minimumScale,M=this._maximumScale<Number.MAX_VALUE?this._minimumScale+(this._maximumScale-this._minimumScale)*this._autoScaleTransitionWidthRatio:this._minimumScale*(1+this._autoScaleTransitionWidthRatio);v=1/(4*(M-b)),S=1-2*v*M,x=b+S*S/(4*v);var y=-S/(2*v);m<y?m=this._minimumScale:m<M&&(m=x+S*m+v*(m*m))}if(this._maximumScale<Number.MAX_VALUE){var T=this._maximumScale,w=this._minimumScale>0?this._maximumScale+(this._minimumScale-this._maximumScale)*this._autoScaleTransitionWidthRatio:this._maximumScale*(1-this._autoScaleTransitionWidthRatio);v=1/(4*(w-T)),S=1-2*v*w,x=T+S*S/(4*v);var C=-S/(2*v);m>C?m=this._maximumScale:m>w&&(m=x+S*m+v*(m*m))}}this.setScale(m)}if(this._autoRotateToScreen){var A=d.create(),E=t.getCurrentModelViewMatrix();s.getRotation(A,E),this.setRotation(d.invert(A,A))}this._previousWidth=e,this._previousHeight=i,n.copy(this._previousPosition,h),s.copy(this._previousProjection,r),s.copy(this._previousModelView,o)}}p.prototype.accept.call(this,t)}}(),_setAlignmentValues:function(t){switch(t){case _.LEFT_TOP:this._context.textAlign="left",this._textX=0,this._context.textBaseline="top",this._textY=0;break;case _.LEFT_CENTER:this._context.textAlign="left",this._textX=0,this._context.textBaseline="middle",this._textY=this._canvas.height/2;break;case _.LEFT_BOTTOM:this._context.textAlign="left",this._textX=0,this._context.textBaseline="bottom",this._textY=this._canvas.height;break;case _.CENTER_TOP:this._context.textAlign="center",this._textX=this._canvas.width/2,this._context.textBaseline="top",this._textY=0;break;case _.CENTER_CENTER:this._context.textAlign="center",this._textX=this._canvas.width/2,this._context.textBaseline="middle",this._textY=this._canvas.height/2;break;case _.CENTER_BOTTOM:this._context.textAlign="center",this._textX=this._canvas.width/2,this._context.textBaseline="bottom",this._textY=this._canvas.height;break;case _.RIGHT_TOP:this._context.textAlign="right",this._textX=this._canvas.width,this._context.textBaseline="top",this._textY=0;break;case _.RIGHT_CENTER:this._context.textAlign="right",this._textX=this._canvas.width,this._context.textBaseline="middle",this._textY=this._canvas.height/2;break;case _.RIGHT_BOTTOM:this._context.textAlign="right",this._textX=this._canvas.width,this._context.textBaseline="bottom",this._textY=this._canvas.height}},setForcePowerOfTwo:function(t){this._forcePowerOfTwo=t},getForcePowerOfTwo:function(){return this._forcePowerOfTwo},_nextPowerOfTwo:function(t){var e=t;return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e++,e}}),"osgText","Text"),t.exports=_},function(t,e,i){"use strict";var r=i(142),n=i(143),a=i(158),s=i(159),o=i(160),h=i(147),u=i(161),c=i(163),l=i(162),d=i(144),f=i(145),p=i(146),_=i(148),g=i(149),m=i(150),v=i(151),S=i(153),x=i(164),b=i(152),M={};r.NO_MOUSEEVENTS=!0,M.CADManipulator=n,M.getCADManipulatorStandardMouseKeyboardController=function(){return a},M.getCADManipulatorHammerController=function(){return s},M.FirstPersonManipulator=o,M.getFirstPersonDeviceOrientationController=function(){return h},M.getFirstPersonManipulatorHammerController=function(){return u},M.getFirstPersonStandardMouseKeyboardControllerClass=function(){return c},M.getFirstPersonWebVRControllerClass=function(){return l},M.Manipulator=d,M.OrbitManipulator=f,M.getOrbitManipulatorDeviceOrientationController=function(){return p},M.getOrbitManipulatorGamePadController=function(){return _},M.getOrbitManipulatorHammerController=function(){return g},M.getOrbitManipulatorLeapMotionController=function(){return m},M.getOrbitManipulatorStandardMouseKeyboardController=function(){return v},M.getOrbitManipulatorWebVRController=function(){return S},M.SwitchManipulator=x,M.OrbitManipulator.Rotate=b.ROTATE,M.OrbitManipulator.Pan=b.PAN,M.OrbitManipulator.Zoom=b.ZOOM,t.exports=M},function(t,e){t.exports=__WEBPACK_EXTERNAL_MODULE_142__},function(t,e,i){"use strict";var r=i(6),n=i(144),a=i(145),s=i(154),o=i(155),h=i(156),u=i(34),c=i(15).mat4,l=i(15).vec2,d=i(15).vec3,f=i(15).quat,p=i(158),_=i(159),g=function(){n.call(this),this._tmpHomePosition=d.create(),this._intersectionVisitor=new s,this._lineSegmentIntersector=new o,this._polytopeIntersector=void 0,this._usePolytopeIntersector=!1,this._dimensionMask=4,this.init()};g.Interpolator=function(){this._current=l.create(),this._target=l.create(),this._delta=l.create(),this._reset=!1,this.reset(),this._width=void 0,this._height=void 0},g.Interpolator.prototype={setWidth:function(t){this._width=t},setHeight:function(t){this._height=t},reset:function(){for(var t=0,e=this._current.length;t<e;t++)this._current[t]=this._target[t]=0;this._reset=!0},update:function(){var t,e;return t=void 0===this._width?0:(this._target[0]-this._current[0])/this._width,this._delta[0]=t,this._current[0]=this._target[0],e=void 0===this._height?0:(this._target[1]-this._current[1])/this._height,this._delta[1]=e,this._current[1]=this._target[1],this._delta},set:function(){for(var t=0,e=this._current.length;t<e;t++)this._current[t]=this._target[t]=arguments[t];this._reset=!1},isReset:function(){return this._reset},getCurrent:function(){return this._current},setTarget:function(){for(var t=0,e=this._target.length;t<e;t++)this._reset?this._target[t]=this._current[t]=arguments[t]:this._target[t]=arguments[t];this._reset=!1},addTarget:function(){for(var t=0;t<arguments.length;t++)this._target[t]+=arguments[t]},getTarget:function(){return this._target},getDelta:function(){return this._delta}},g.AvailableControllerList=["StandardMouseKeyboard","Hammer"],g.ControllerList=["StandardMouseKeyboard","Hammer"],g.prototype=r.objectInherit(n.prototype,{init:function(){this._distance=25,this._target=d.create(),this._upz=d.fromValues(0,0,1),this._right=d.fromValues(1,0,0),d.init(this._target);var t=c.fromRotation(c.create(),-Math.PI,this._upz),e=c.fromRotation(c.create(),Math.PI/10,this._right);this._rotation=c.create(),c.mul(this._rotation,t,e),this._time=0,this._rotate=new g.Interpolator,this._pan=new g.Interpolator,this._zoom=new a.Interpolator(1),this._panFactor=1.5,this._rotateFactor=1,this._zoomFactor=1,this._inverseMatrix=c.create(),this._homeEye=void 0,this._homeCenter=void 0,this._homeUp=d.fromValues(0,0,1),this._orientation=f.create(),this._pivotPoint=d.create(),this._eye=void 0,this._zoomDir=d.create();var i=this;g.ControllerList.forEach(function(t){void 0!==g[t]&&(i._controllerList[t]=new g[t](i))})},setViewer:function(t){this._viewer=t},reset:function(){this.init()},setNode:function(t){this._node=t},setPivotPoint:function(t){d.copy(this._pivotPoint,t)},setTarget:function(){var t=d.create();return function(e){d.copy(this._target,e),this.getEyePosition(t),this._distance=d.distance(e,t)}}(),setEyePosition:function(t){d.copy(this._eye,t),this._distance=d.distance(this._target,t)},setHomePosition:function(t,e,i){this._homeEye=t,this._homeCenter=e,this._homeUp=i},computeHomePosition:function(){var t=d.create(),e=d.create(),i=d.create(),r=c.create();return function(n){var a=this.getHomeBound(n);if(a){this.setDistance(this.getHomeDistance(a)),this.setTarget(a.center()),this.setPivotPoint(a.center()),void 0===this._homeEye&&(this._homeEye=d.create(),this.getEyePosition(this._homeEye)),void 0===this._homeCenter&&(this._homeCenter=d.create(),d.copy(this._homeCenter,a.center())),void 0===this._eye&&(this._eye=d.create()),d.copy(this._eye,this._homeEye),d.copy(this._target,this._homeCenter),d.copy(this._upz,this._homeUp),c.copy(r,this._rotation);var s=this._target,o=this._eye;d.sub(t,s,o),d.normalize(t,t),d.cross(e,t,this._upz),d.normalize(e,e),d.cross(i,e,t),d.normalize(i,i),r[0]=e[0],r[1]=i[0],r[2]=-t[0],r[3]=0,r[4]=e[1],r[5]=i[1],r[6]=-t[1],r[7]=0,r[8]=e[2],r[9]=i[2],r[10]=-t[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,c.getRotation(this._orientation,r),f.invert(this._orientation,this._orientation)}}}(),setZoomFactor:function(t){this._zoomFactor=t},setRotateFactor:function(t){this._rotateFactor=t},setPanFactor:function(t){this._panFactor=t},setDistance:function(t){this._distance=t},setUsePolytopeIntersector:function(t){this._usePolytopeIntersector=t},getUsePolytopeIntersector:function(){return this._usePolytopeIntersector},getDistance:function(){return this._distance},zoom:function(t){this._distance=t},getRotateInterpolator:function(){return this._rotate},getPanInterpolator:function(){return this._pan},getZoomInterpolator:function(){return this._zoom},getIntersectionVisitor:function(){return this._intersectionVisitor},getLineSegmentIntersector:function(){return this._lineSegmentIntersector},getOrCreatePolytopeIntersector:function(){return void 0===this._polytopeIntersector&&(this._polytopeIntersector=new h,this._polytopeIntersector.setIntersectionLimit(h.LIMIT_ONE_PER_DRAWABLE),this._polytopeIntersector.setDimensionMask(h.DimZero|h.DimOne)),this._polytopeIntersector},getTarget:function(t){return d.copy(t,this._target),t},getEyePosition:function(t){void 0===this._eye?this.computeEyePosition(this._target,this._distance,t):d.copy(t,this._eye)},computeEyePosition:function(){var t=d.create(),e=c.create();return function(i,r,n){c.invert(e,this._rotation),t[1]=r,d.transformMat4(n,t,e),d.add(n,i,n)}}(),computePan:function(){var t=d.create(),e=d.create(),i=d.create();return function(r,n,a){var s=d.length(d.sub(i,this._eye,this._pivotPoint))/this._panFactor;s<10&&(s=10),t[0]=r*s/2,t[1]=n*s/2,t[2]=0,d.transformMat4(e,t,a),d.add(this._eye,this._eye,e)}}(),computeZoom:function(){var t=d.create(),e=d.create();return function(i){var r=i*this._zoomFactor;d.sub(t,this._pivotPoint,this._eye),d.add(this._eye,this._eye,d.scale(e,t,r))}}(),computeRotation:function(){var t=d.create(),e=d.create(),i=d.create(),r=d.create(),n=f.create(),a=f.create(),s=f.create(),o=d.create(),h=d.create();return function(u,c){d.transformQuat(e,this._right,this._orientation),d.normalize(t,e),d.sub(i,this._eye,this._pivotPoint);var l=d.dot(t,i);d.sub(r,i,d.scale(h,t,l));var p=d.fromValues(-r[0],-r[1],0),_=Math.atan2(-r[2],d.length(p));c=Math.max(-Math.PI/2+.01,Math.min(Math.PI/2-.01,_+c))-_,f.setAxisAngle(n,e,c*this._rotateFactor),f.setAxisAngle(a,this._upz,u*this._rotateFactor),f.mul(s,a,n),d.transformQuat(o,i,s),d.add(this._eye,o,this._pivotPoint),f.mul(this._orientation,a,this._orientation),d.transformQuat(e,this._right,this._orientation),f.setAxisAngle(n,e,c*this._rotateFactor),f.mul(this._orientation,n,this._orientation)}}(),update:function(){var t=c.create(),e=c.create();return function(i){var r=i.getFrameStamp().getDeltaTime(),n=10,a=this._rotate.update();this.computeRotation(-a[0]*n,a[1]*n),c.fromQuat(t,this._orientation);var s=this._pan.update();this.computePan(-s[0]*n,-s[1]*n,t),a=this._zoom.update(r),this.computeZoom(-a[0]/10),c.fromTranslation(e,this._eye),c.mul(this._inverseMatrix,e,t),c.invert(this._inverseMatrix,this._inverseMatrix)}}(),getInverseMatrix:function(){return this._inverseMatrix},computeIntersections:function(){var t=[],e=d.create();return function(i){var r=this._camera.getView(),n=this._camera,a=n.getViewport().width(),s=n.getViewport().height();this._rotate.setWidth(a),this._rotate.setHeight(s),this._pan.setWidth(a),this._pan.setHeight(s);var o,h;if(0!==(4&this._dimensionMask)&&(t=r.computeIntersections(i[0],i[1]),t.length>0&&(o=t[0].point,t[0].nodepath.shift(),h=u.computeLocalToWorld(t[0].nodepath),d.transformMat4(e,o,h),this.setPivotPoint(e))),0===t.length&&this._usePolytopeIntersector){var c=this.getOrCreatePolytopeIntersector();c.reset(),c.setPolytopeFromWindowCoordinates(i[0]-5,i[1]-5,i[0]+5,i[1]+5);var l=this._intersectionVisitor;l.setIntersector(c),r.getCamera().accept(l),t=c.getIntersections(),t.sort(function(t,e){return t._distance-e._distance}),t.length>0&&(o=t[0]._center,t[0].nodePath.shift(),h=u.computeLocalToWorld(t[0].nodePath),d.transformMat4(e,o,h),this.setPivotPoint(e))}}}(),getPositionRelativeToCanvas:function(){var t=l.create(),e=l.create();return function(i,r){var n=this._camera._graphicContext.canvas;this.getOffsetRect(n,t);var a=n.width/n.clientWidth,s=n.height/n.clientHeight;return e[0]=(i-t[1])*a,e[1]=(n.clientHeight-(r-t[0]))*s,e}}(),getCanvasCenter:function(){var t=l.create(),e=l.create();return function(){var i=this._camera.getGraphicContext().canvas;this.getOffsetRect(i,t);var r=i.width/i.clientWidth,n=i.height/i.clientHeight;return e[0]=i.clientWidth/2*r,e[1]=i.clientHeight/2*n,e}}(),getOffsetRect:function(t,e){var i=t.getBoundingClientRect(),r=document.body,n=document.documentElement,a=window.pageYOffset||n.scrollTop||r.scrollTop,s=window.pageXOffset||n.scrollLeft||r.scrollLeft,o=n.clientTop||r.clientTop||0,h=n.clientLeft||r.clientLeft||0,u=i.top+a-o,c=i.left+s-h;return e[0]=Math.round(u),e[1]=Math.round(c),e}}),g.StandardMouseKeyboard=p,g.Hammer=_,t.exports=g},function(t,e,i){"use strict";var r=i(28),n=i(15).mat4,a=function(t){this._boundStrategy=t,void 0===this._boundStrategy&&(this._boundStrategy=a.COMPUTE_HOME_USING_SPHERE),this._controllerList={},this._inverseMatrix=n.create(),this._camera=void 0,this._node=void 0,this._frustum={},this._computeBoundNodeMaskOverride=-1};a.prototype={setCamera:function(t){this._camera=t},getCamera:function(){return this._camera},setNode:function(t){this._node=t},setComputeBoundNodeMaskOverride:function(t){this._computeBoundNodeMaskOverride=t},getComputeBoundNodeMaskOverride:function(){return this._computeBoundNodeMaskOverride},getHomeBound:function(t){var e=this._node;if(e){var n=void 0!==t?t:this._boundStrategy;if(n&a.COMPUTE_HOME_USING_BBOX){var s=new r,o=null;if(this._computeBoundNodeMaskOverride===-1)o=e.getBoundingBox();else{var h=i(36),u=new h;u.setNodeMaskOverride(this._computeBoundNodeMaskOverride),u.reset(),u.apply(e),o=u.getBoundingBox()}if(o.valid()&&s.expandByBoundingBox(o),n&a.COMPUTE_HOME_USING_SPHERE){var c=e.getBound();if(c.radius()<s.radius())return c}return s}return e.getBound()}},getHomeDistance:function(t){var e=this._frustum,i=t.radius();if(this._camera&&n.getFrustum(e,this._camera.getProjectionMatrix())){var r=Math.abs(e.right-e.left)/e.zNear/2,a=Math.abs(e.top-e.bottom)/e.zNear/2;i/=Math.sin(Math.atan2(a<r?a:r,1))}else i*=1.5;return i},update:function(){},getInverseMatrix:function(){return this._inverseMatrix},getControllerList:function(){return this._controllerList}},a.COMPUTE_HOME_USING_SPHERE=1,a.COMPUTE_HOME_USING_BBOX=2,t.exports=a},function(t,e,i){"use strict";var r=i(6),n=i(15).vec3,a=i(15).mat4,s=i(144),o=i(146),h=i(148),u=i(149),c=i(150),l=i(151),d=i(153),f=function(t){s.call(this,t),this._homePosition=n.create(),this._frustum={},this.init()};f.Interpolator=function(t,e){this._current=new Float32Array(t),this._target=new Float32Array(t),this._delta=new Float32Array(t),this._delay=void 0!==e?e:.15,this._reset=!1,this._start=0,this.reset()},f.Interpolator.prototype={setDelay:function(t){this._delay=t},reset:function(){for(var t=0,e=this._current.length;t<e;t++)this._current[t]=this._target[t]=0;this._reset=!0},update:function(t){for(var e=Math.min(1,this._delay*t*60),i=0,r=this._current.length;i<r;i++){var n=(this._target[i]-this._current[i])*e;this._delta[i]=n,this._current[i]+=n}return this._delta},set:function(){for(var t=0,e=this._current.length;t<e;t++)this._current[t]=this._target[t]=arguments[t];this._reset=!1},isReset:function(){return this._reset},getCurrent:function(){return this._current},setTarget:function(){for(var t=0,e=this._target.length;t<e;t++)this._reset?this._target[t]=this._current[t]=arguments[t]:this._target[t]=arguments[t];this._reset=!1},addTarget:function(){for(var t=0;t<arguments.length;t++)this._target[t]+=arguments[t]},getTarget:function(){return this._target},getDelta:function(){return this._delta},getStart:function(){return this._start},setStart:function(t){this._start=t}},f.AvailableControllerList=["StandardMouseKeyboard","LeapMotion","GamePad","Hammer","DeviceOrientation","WebVR"],f.ControllerList=["StandardMouseKeyboard","LeapMotion","GamePad","Hammer","DeviceOrientation","WebVR"],f.prototype=r.objectInherit(s.prototype,{init:function(){this._distance=25,this._target=n.create(),this._upz=n.fromValues(0,0,1),n.init(this._target);var t=a.fromRotation(a.create(),-Math.PI,this._upz),e=a.fromRotation(a.create(),Math.PI/10,n.fromValues(1,0,0));this._rotation=a.create(),a.mul(this._rotation,t,e),this._time=0,this._vrMatrix=a.create(),this._rotate=new f.Interpolator(2),this._pan=new f.Interpolator(2),this._zoom=new f.Interpolator(1),this._minSpeed=1e-4,this._scaleMouseMotion=1,this._inverseMatrix=a.create(),this._autoPushTarget=!0,this._limitPitchUp=.5*Math.PI*.9,this._limitPitchDown=-this._limitPitchUp,this._limitYawLeft=-Math.PI,this._limitYawRight=-this._limitYawLeft,this._limitZoomIn=1e-4,this._limitZoomOut=1/0;var i=this;f.ControllerList.forEach(function(t){void 0!==f[t]&&(i._controllerList[t]=new f[t](i))})},setLimitPitchUp:function(t){this._limitPitchUp=t},setLimitPitchDown:function(t){this._limitPitchDown=t},setLimitYawLeft:function(t){this._limitYawLeft=t},setLimitYawRight:function(t){this._limitYawRight=t},setLimitZoomOut:function(t){this._limitZoomOut=t},setLimitZoomIn:function(t){this._limitZoomIn=t},setDelay:function(t){this._rotate.setDelay(t),this._pan.setDelay(t),this._zoom.setDelay(t)},reset:function(){this.init()},setTarget:function(t){n.copy(this._target,t);var e=n.create();this.getEyePosition(e),this._distance=n.distance(t,e)},setEyePosition:function(){var t=n.create(),e=n.create(),i=n.create();return function(r){var a=this._rotation,s=this._target;n.sub(t,r,s),n.normalize(t,t),n.cross(e,t,this._upz),n.normalize(e,e),n.cross(i,e,t),n.normalize(i,i),a[0]=e[0],a[1]=t[0],a[2]=i[0],a[3]=0,a[4]=e[1],a[5]=t[1],a[6]=i[1],a[7]=0,a[8]=e[2],a[9]=t[2],a[10]=i[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,this._distance=n.distance(s,r)}}(),computeHomePosition:function(t){var e=this.getHomeBound(t);e&&e.valid()&&(this.setDistance(this.getHomeDistance(e)),this.setTarget(e.center()))},getHomePosition:function(){if(void 0!==this._node){var t=this._target,e=this.getDistance();this.computeEyePosition(t,e,this._homePosition)}return this._homePosition},setMinSpeed:function(t){this._minSpeed=t},getMinSpeed:function(){return this._minSpeed},setDistance:function(t){this._distance=t},getDistance:function(){return this._distance},getSpeedFactor:function(){return Math.max(this._distance,this._minSpeed)},computePan:function(){var t=a.create(),e=n.create(),i=n.create();return function(r,s){var o=this._camera.getProjectionMatrix(),h=1===o[15]?1:2/o[5],u=this.getSpeedFactor()*h;s*=u,r*=u,a.invert(t,this._rotation),e[0]=t[0],e[1]=t[1],e[2]=t[2],n.normalize(e,e),i[0]=t[8],i[1]=t[9],i[2]=t[10],n.normalize(i,i),n.scale(e,e,-r),n.scale(i,i,s),n.add(this._target,this._target,e),n.add(this._target,this._target,i)}}(),computeRotation:function(){var t=n.fromValues(1,0,0);return function(e,i){var r=Math.atan(-this._rotation[6]/this._rotation[5])+i/10;r=Math.min(Math.max(r,this._limitPitchDown),this._limitPitchUp);var n=e/10,s=Math.atan2(this._rotation[4],this._rotation[0]),o=s+n;this._limitYawRight===Math.PI&&this._limitYawLeft===-Math.PI||(n>0&&s<=this._limitYawRight&&o>this._limitYawRight?o=this._limitYawRight:n<0&&s>=this._limitYawLeft&&o<this._limitYawLeft&&(o=this._limitYawLeft)),a.fromRotation(this._rotation,-r,t),a.rotate(this._rotation,this._rotation,-o,this._upz)}}(),computeZoom:function(t){this.zoom(t)},setAutoPushTarget:function(t){this._autoPushTarget=t},zoom:function(){var t=n.create();return function(e){var i=this._distance+this.getSpeedFactor()*(e-1);this._autoPushTarget&&i<this._limitZoomIn&&(n.sub(t,this._target,this.getEyePosition(t)),n.normalize(t,t),n.scale(t,t,this._limitZoomIn-i),n.add(this._target,this._target,t)),this._distance=Math.max(this._limitZoomIn,Math.min(this._limitZoomOut,i))}}(),getRotateInterpolator:function(){return this._rotate},getPanInterpolator:function(){return this._pan},getZoomInterpolator:function(){return this._zoom},getTarget:function(t){return n.copy(t,this._target)},getEyePosition:function(t){return this.computeEyePosition(this._target,this._distance,t),t},computeEyePosition:function(){var t=n.create(),e=a.create();return function(i,r,s){a.invert(e,this._rotation),t[1]=r,n.transformMat4(s,t,e),n.add(s,i,s)}}(),update:function(){var t=n.create();return function(e){var i,r=e.getFrameStamp().getDeltaTime(),s=.1;i=this._rotate.update(r),this.computeRotation(-i[0]*s*this._scaleMouseMotion,-i[1]*s*this._scaleMouseMotion);var o=.002;i=this._pan.update(r),this.computePan(-i[0]*o,-i[1]*o),i=this._zoom.update(r),this.computeZoom(1+i[0]/10);var h=this._target,u=this._distance;a.invert(this._inverseMatrix,this._rotation),a.mul(this._inverseMatrix,this._vrMatrix,this._inverseMatrix),n.set(t,0,u,0),n.transformMat4(t,t,this._inverseMatrix),a.lookAt(this._inverseMatrix,n.add(t,h,t),h,this._upz)}}(),setPoseVR:function(t){a.fromQuat(this._vrMatrix,t)}}),f.DeviceOrientation=o,f.GamePad=h,f.Hammer=u,f.LeapMotion=c,f.WebVR=d,f.StandardMouseKeyboard=l,t.exports=f},function(t,e,i){"use strict";var r=i(15).quat,n=i(15).vec3,a=i(147),s=function(t){this._manipulator=t,this.init()};s.prototype={init:function(){this._stepFactor=1,this._quat=r.create(),this._pos=n.create()},update:function(t,e){a.computeQuaternion(this._quat,t,e),this._manipulator.setPoseVR(this._quat,this._pos)}},t.exports=s},function(t,e,i){"use strict";var r=i(15).quat,n=i(15).vec3,a=Math.PI/180,s=function(t,e,i,r,n){var a=Math.cos(e/2),s=Math.cos(i/2),o=Math.cos(r/2),h=Math.sin(e/2),u=Math.sin(i/2),c=Math.sin(r/2);return"XYZ"===n?(t[0]=h*s*o+a*u*c,t[1]=a*u*o-h*s*c,t[2]=a*s*c+h*u*o,t[3]=a*s*o-h*u*c):"YXZ"===n?(t[0]=h*s*o+a*u*c,t[1]=a*u*o-h*s*c,t[2]=a*s*c-h*u*o,t[3]=a*s*o+h*u*c):"ZXY"===n?(t[0]=h*s*o-a*u*c,t[1]=a*u*o+h*s*c,t[2]=a*s*c+h*u*o,t[3]=a*s*o-h*u*c):"ZYX"===n?(t[0]=h*s*o-a*u*c,t[1]=a*u*o+h*s*c,t[2]=a*s*c-h*u*o,t[3]=a*s*o+h*u*c):"YZX"===n?(t[0]=h*s*o+a*u*c,t[1]=a*u*o+h*s*c,t[2]=a*s*c-h*u*o,t[3]=a*s*o-h*u*c):"XZY"===n&&(t[0]=h*s*o-a*u*c,t[1]=a*u*o-h*s*c,t[2]=a*s*c+h*u*o,t[3]=a*s*o+h*u*c),t},o=function(t){this._manipulator=t,this.init()};o.computeQuaternion=function(){var t=r.create(),e=r.fromValues(-Math.sqrt(.5),0,0,Math.sqrt(.5));return function(i,n,o){var h=n.alpha*a,u=n.beta*a,c=n.gamma*a,l=o*a;s(i,u,h,-c,"YXZ");var d=-l/2;t[1]=Math.sin(d),t[3]=Math.cos(d),r.mul(i,i,t),r.mul(i,i,e);var f=i[1];return i[1]=-i[2],i[2]=f,i}}(),o.prototype={init:function(){this._stepFactor=1,this._quat=r.create(),this._pos=n.create()},update:function(t,e){o.computeQuaternion(this._quat,t,e),this._manipulator.setPoseVR(this._quat,this._pos)}},t.exports=o},function(t,e,i){"use strict";var r=i(15).vec2,n=function(t){this._manipulator=t,this.init()};n.prototype={init:function(){this._delay=.15,this._threshold=.08,this._mode=0,this._padFactor=10,this._zoomFactor=.5,this._rotateFactor=5},addPan:function(t,e,i){t.setDelay(this._delay),t.addTarget(e*this._padFactor,i*this._padFactor)},addZoom:function(t,e){t.setDelay(this._delay),t.addTarget(e*this._zoomFactor)},addRotate:function(t,e,i){t.setDelay(this._delay),t.addTarget(e*this._rotateFactor,i*this._rotateFactor)},gamepadaxes:function(t){var e=.005,i=this._manipulator.getRotateInterpolator(),r=this._manipulator.getZoomInterpolator(),n=this._manipulator.getPanInterpolator();4===t.length?((Math.abs(t[0])>e||Math.abs(t[1])>e)&&this.addRotate(i,-t[0],t[1]),Math.abs(t[3])>e&&this.addZoom(r,-t[3])):t.length>=5&&((Math.abs(t[0])>e||Math.abs(t[1])>e)&&this.addPan(n,-t[0],t[1]),Math.abs(t[2])>e&&this.addZoom(r,-t[2]),(Math.abs(t[3])>e||Math.abs(t[4])>e)&&this.addRotate(i,t[4],t[3]))},gamepadbuttondown:function(t){if(t.button>=12&&t.button<=15){var e=this._manipulator.getPanInterpolator(),i=e.getTarget(),n={12:r.fromValues(0,-1),13:r.fromValues(0,1),14:r.fromValues(-1,0),15:r.fromValues(1,0)}[t.button];e.setDelay(this._delay),e.setTarget(i[0]-10*n[0],i[1]+10*n[1])}},update:function(t){if(t){var e=t.axes,i=t.buttons;this.gamepadaxes(e);for(var r=function(){},n=0;n<i.length;n++)i[n]&&this.gamepadbuttondown({preventDefault:r,gamepad:t,button:n},!!i[n])}}},t.exports=n},function(t,e,i){"use strict";var r=i(10),n=i(16),a=function(t){this._manipulator=t,this.init()};a.prototype={init:function(){this._panFactorX=1,this._panFactorY=-this._panFactorX,this._rotateFactorX=.6,this._rotateFactorY=-this._rotateFactorX,this._zoomFactor=5,this._lastScale=0,this._nbPointerLast=0,this._delay=.15,this._transformStarted=!1,this._dragStarted=!1},setEventProxy:function(t){if(void 0!==t&&(void 0===t||t!==this._eventProxy)){this._eventProxy=t;var e=this,i=t,a=function(t){return void 0!==t.pointers?t.pointers.length:1},s=function(t){return"touches "+a(t)+" distance "+t.distance+" x "+t.deltaX+" y "+t.deltaY};i.get("pinch").set({threshold:.1}),i.get("pan").set({threshold:0,pointers:0}),i.get("pinch").recognizeWith(i.get("pan")),this._cbPanStart=function(t){var i=e._manipulator;i&&!e._transformStarted&&"mouse"!==t.pointerType&&(e._dragStarted=!0,e._nbPointerLast=a(t),2===e._nbPointerLast?(i.getPanInterpolator().reset(),i.getPanInterpolator().set(t.center.x*e._panFactorX,t.center.y*e._panFactorY)):(i.getRotateInterpolator().reset(),i.getRotateInterpolator().set(t.center.x*e._rotateFactorX,t.center.y*e._rotateFactorY)),r.debug("drag start, "+s(t)))},this._cbPanMove=function(t){var i=e._manipulator;if(i&&e._dragStarted&&"mouse"!==t.pointerType){var n=a(t);e._nbPointerLast!==n&&(2===n?i.getPanInterpolator().reset():i.getRotateInterpolator().reset(),e._nbPointerLast=n),2===n?(i.getPanInterpolator().setTarget(t.center.x*e._panFactorX,t.center.y*e._panFactorY),r.debug("pan, "+s(t))):(i.getRotateInterpolator().setDelay(e._delay),i.getRotateInterpolator().setTarget(t.center.x*e._rotateFactorX,t.center.y*e._rotateFactorY),r.debug("rotate, "+s(t)))}},this._cbPanEnd=function(t){var i=e._manipulator;i&&e._dragStarted&&"mouse"!==t.pointerType&&(e._dragStarted=!1,r.debug("drag end, "+s(t)))},this._cbPinchStart=function(t){var i=e._manipulator;i&&"mouse"!==t.pointerType&&(e._transformStarted=!0,e._lastScale=t.scale,i.getZoomInterpolator().reset(),i.getZoomInterpolator().set(e._lastScale),t.preventDefault(),r.debug("zoom start, "+s(t)))},this._cbPinchEnd=function(t){"mouse"!==t.pointerType&&(e._transformStarted=!1,r.debug("zoom end, "+s(t)))},this._cbPinchInOut=function(t){var i=e._manipulator;if(i&&e._transformStarted&&"mouse"!==t.pointerType){var a=t.scale>e._lastScale?e._zoomFactor:3*e._zoomFactor,o=0,h=.5;a*=n.smoothStep(o,h,-Math.abs(t.velocity)+(o+h));var u=(t.scale-e._lastScale)*a;e._lastScale=t.scale,i.getZoomInterpolator().setTarget(i.getZoomInterpolator().getTarget()[0]-u),r.debug("zoom, "+s(t))}},i.on("panstart ",this._cbPanStart),i.on("panmove",this._cbPanMove),i.on("panend",this._cbPanEnd),i.on("pinchstart",this._cbPinchStart),i.on("pinchend",this._cbPinchEnd),i.on("pinchin pinchout",this._cbPinchInOut)}},removeEventProxy:function(t){t&&this._eventProxy&&(t.off("panstart ",this._cbPanStart),t.off("panmove",this._cbPanMove),t.off("panend",this._cbPanEnd),t.off("pinchstart",this._cbPinchStart),t.off("pinchend",this._cbPinchEnd),t.off("pinchin pinchout",this._cbPinchInOut))},setManipulator:function(t){this._manipulator=t}},t.exports=a},function(t,e,i){"use strict";var r=i(10),n=i(15).vec3,a=i(15).vec2,s=function(t){this._manipulator=t,this.init()},o={rotate:{dtx:-1.44,dty:-1.08,dtz:-.1,delay:.05,method:"getRotateInterpolator"},pan:{dtx:-1.44,dty:-1.08,delay:.05,method:"getPanInterpolator"},zoom:{dtx:0,dty:-.5,delay:.05,method:"getZoomInterpolator"},"zoom-twohands":{dtx:-.05,dty:0,delay:.05,method:"getZoomInterpolator"}};s.prototype={init:function(){this._virtualCursor=a.fromValues(0,0),this._targetPosition=a.fromValues(0,0),this._previousFrame=void 0,this._displacement=a.fromValues(0,0),this._top=a.fromValues(0,1),this._motion=a.fromValues(0,0),this._delay=.05,this._threshold=.08,this._directionDotThreshold=.5,this._mode="rotate"},update:function(t){if(this._previousFrame||(this._previousFrame=t),0!==t.fingers.length){var e=this._previousFrame.translation(t);if(this._previousFrame=t,0!==t.hands.length&&!(Math.abs(e[0])<this._threshold&&Math.abs(e[1])<this._threshold)){var i=this._mode,a=0;if(t.gestures.length>0)for(var s=0;s<t.gestures.length;s++){var h=t.gestures[s];if("circle"===h.type)return void this._manipulator.computeHomePosition()}if(1===t.hands.length)t.hands[0].fingers.length>=3?(i="zoom",a=t.hands[0].palmPosition[1]/10,a=Math.max(a-4,.01)):i=t.hands[0].fingers.length>1?"pan":"rotate";else if(2===t.hands.length){var u=Math.abs(n.dot(t.hands[0].palmNormal,this._top)),c=Math.abs(n.dot(t.hands[1].palmNormal,this._top));u<this._directionDotThreshold&&c<this._directionDotThreshold?i="zoom-twohands":(i=void 0,this._handsDistanceOld=void 0)}var l=this._manipulator.getZoomInterpolator();if(void 0!==i){if(i!==this._mode)return r.info("Switch to mode "+i),this._motion[0]=0,this._motion[1]=0,this._mode=i,void("zoom"!==i&&"zoom-twohands"!==i||l.isReset()&&(l.setStart(1),l.set(0)));var d,f,p;d=o[i].dtx,f=o[i].dty,p=o[i].dtz,this._motion[0]+=e[0]*d,this._motion[1]+=e[1]*f;var _=o[i].delay,g=o[i].method;if(this._manipulator[g]().setDelay(_),"zoom"===i)r.log(a),l.setTarget(a);else if("zoom-twohands"===i){var m=n.distance(t.hands[1].palmPosition,t.hands[0].palmPosition);if(void 0!==this._handsDistanceOld){var v=d*(m-this._handsDistanceOld);a=l._target,a[0]+=v}this._handsDistanceOld=m}else"rotate"===i&&(a=l._target[0],a+=e[2]*p,a=Math.max(a,.01),l.setTarget(a)),this._manipulator[g]().addTarget(this._motion[0],this._motion[1]);this._motion[1]=this._motion[0]=0}}}}},t.exports=s},function(t,e,i){"use strict";var r=i(16),n=i(152),a=function(t){this._manipulator=t,this.init()};a.prototype={init:function(){this.releaseButton(),this._rotateKey=65,this._zoomKey=83,this._panKey=68,this._mode=void 0,this._delay=.15},getMode:function(){return this._mode},setMode:function(t){this._mode=t},setEventProxy:function(t){this._eventProxy=t},setManipulator:function(t){this._manipulator=t},mousemove:function(t){if(this._buttonup!==!0){var e=this._eventProxy.getPositionRelativeToCanvas(t),i=this._manipulator;if(r.isNaN(e[0])===!1&&r.isNaN(e[1])===!1){var a=this.getMode();if(a===n.ROTATE)i.getRotateInterpolator().setDelay(this._delay),i.getRotateInterpolator().setTarget(e[0],e[1]);else if(a===n.PAN)i.getPanInterpolator().setTarget(e[0],e[1]);else if(a===n.ZOOM){var s=i.getZoomInterpolator();s.isReset()&&(s.setStart(e[1]),
s.set(0));var o=e[1]-s.getStart();s.setStart(e[1]);var h=s.getTarget()[0];s.setTarget(h-o/20)}}t.preventDefault()}},mousedown:function(t){var e=this._manipulator,i=this.getMode();void 0===i&&(0===t.button?t.shiftKey?this.setMode(n.PAN):t.ctrlKey?this.setMode(n.ZOOM):this.setMode(n.ROTATE):2===t.button&&t.ctrlKey?this.setMode(n.ZOOM):this.setMode(n.PAN)),this.pushButton();var r=this._eventProxy.getPositionRelativeToCanvas(t);i=this.getMode(),i===n.ROTATE?(e.getRotateInterpolator().reset(),e.getRotateInterpolator().set(r[0],r[1])):i===n.PAN?(e.getPanInterpolator().reset(),e.getPanInterpolator().set(r[0],r[1])):i===n.ZOOM&&(e.getZoomInterpolator().setStart(r[1]),e.getZoomInterpolator().set(0)),t.preventDefault()},mouseup:function(){this.releaseButton(),this.setMode(void 0)},mouseout:function(){this.releaseButton(),this.setMode(void 0)},mousewheel:function(t,e){var i=this._manipulator;t.preventDefault();var r=i.getZoomInterpolator().getTarget()[0]-e;i.getZoomInterpolator().setTarget(r)},pushButton:function(){this._buttonup=!1},releaseButton:function(){this._buttonup=!0},keydown:function(t){32===t.keyCode?(this._manipulator.computeHomePosition(),t.preventDefault()):t.keyCode===this._panKey&&this.getMode()!==n.PAN?(this.setMode(n.PAN),this._manipulator.getPanInterpolator().reset(),this.pushButton(),t.preventDefault()):t.keyCode===this._zoomKey&&this.getMode()!==n.ZOOM?(this.setMode(n.ZOOM),this._manipulator.getZoomInterpolator().reset(),this.pushButton(),t.preventDefault()):t.keyCode===this._rotateKey&&this.getMode()!==n.ROTATE&&(this.setMode(n.ROTATE),this._manipulator.getRotateInterpolator().reset(),this.pushButton(),t.preventDefault())},keyup:function(t){t.keyCode===this._panKey?this.mouseup(t):t.keyCode===this._rotateKey?this.mouseup(t):t.keyCode===this._rotateKey&&this.mouseup(t),this.setMode(void 0)}},t.exports=a},function(t,e){"use strict";t.exports={ROTATE:0,PAN:1,ZOOM:2}},function(t,e){"use strict";var i=function(t){this._manipulator=t,this.init()};i.prototype={init:function(){},update:function(t,e){this._manipulator.setPoseVR(t,e)}},t.exports=i},function(t,e,i){"use strict";var r=i(6),n=i(32),a=i(15).mat4,s=i(33),o=i(35),h=function(){n.call(this),this._intersector=void 0,this._projectionStack=[a.IDENTITY],this._modelStack=[a.IDENTITY],this._viewStack=[a.IDENTITY],this._windowStack=[a.IDENTITY],this.reset()};h.prototype=r.objectInherit(n.prototype,{reset:function(){h._reservedMatrixStack.reset()},setIntersector:function(t){this._intersector=t},getIntersector:function(){return this._intersector},pushModelMatrix:function(t){this._modelStack.push(t)},getModelMatrix:function(){return this._modelStack.length?this._modelStack[this._modelStack.length-1]:void 0},popModelMatrix:function(){return this._modelStack.pop()},pushViewMatrix:function(t){this._viewStack.push(t)},getViewMatrix:function(){return this._viewStack.length?this._viewStack[this._viewStack.length-1]:void 0},popViewMatrix:function(){return this._viewStack.pop()},pushProjectionMatrix:function(t){this._projectionStack.push(t)},getProjectionMatrix:function(){return this._projectionStack.length?this._projectionStack[this._projectionStack.length-1]:void 0},popProjectionMatrix:function(){return this._projectionStack.pop()},pushWindowMatrix:function(t){this._windowStack.push(t)},pushWindowMatrixUsingViewport:function(t){this._windowStack.push(t.computeWindowMatrix(h._reservedMatrixStack.get()))},getWindowMatrix:function(){return this._windowStack.length?this._windowStack[this._windowStack.length-1]:void 0},popWindowMatrix:function(){return this._windowStack.pop()},getTransformation:function(){var t=a.create64();return function(){return a.copy(t,this.getWindowMatrix()||a.IDENTITY),a.mul(t,t,this.getProjectionMatrix()||a.IDENTITY),a.mul(t,t,this.getViewMatrix()||a.IDENTITY),a.mul(t,t,this.getModelMatrix()||a.IDENTITY),t}}(),enter:function(t){return this._intersector.enter(t)},apply:function(t){t.getViewMatrix?this.applyCamera(t):t.getMatrix?this.applyTransform(t):this.applyNode(t)},applyCamera:function(t){var e=t.getViewport();void 0!==e&&this.pushWindowMatrixUsingViewport(e);var i,r,n;t.getReferenceFrame()===o.RELATIVE_RF&&this.getViewMatrix()&&this.getProjectionMatrix()?(i=a.mul(h._reservedMatrixStack.get(),this.getProjectionMatrix(),t.getProjectionMatrix()),r=this.getViewMatrix(),n=a.mul(h._reservedMatrixStack.get(),this.getModelMatrix(),t.getViewMatrix())):(i=t.getProjectionMatrix(),r=t.getViewMatrix(),n=a.identity(h._reservedMatrixStack.get())),this.pushProjectionMatrix(i),this.pushViewMatrix(r),this.pushModelMatrix(n),this._intersector.setCurrentTransformation(this.getTransformation()),this.traverse(t),this.popModelMatrix(),this.popViewMatrix(),this.popProjectionMatrix(),void 0!==e&&this.popWindowMatrix(),this._intersector.setCurrentTransformation(this.getTransformation())},applyNode:function(t){if(this.enter(t))return t.primitives?void this._intersector.intersect(this,t):void(t.traverse&&this.traverse(t))},applyTransform:function(t){if(this.enter(t)){if(t.getReferenceFrame()===o.ABSOLUTE_RF){var e=h._reservedMatrixStack.get();this.pushViewMatrix(a.identity(e)),this.pushModelMatrix(t.getMatrix())}else if(this._modelStack.length>0){var i=a.copy(h._reservedMatrixStack.get(),this.getModelMatrix());a.mul(i,i,t.getMatrix()),this.pushModelMatrix(i)}else this.pushModelMatrix(t.getMatrix());this._intersector.setCurrentTransformation(this.getTransformation()),this.traverse(t),this.popModelMatrix(),t.getReferenceFrame()===o.ABSOLUTE_RF&&this.popViewMatrix(),this._intersector.setCurrentTransformation(this.getTransformation())}}}),h._reservedMatrixStack=new s,t.exports=h},function(t,e,i){"use strict";var r=i(15).vec3,n=i(15).mat4,a=i(94),s=function(){this._start=r.create(),this._end=r.create(),this._iStart=r.create(),this._iEnd=r.create(),this._intersections=[]};s.prototype={set:function(t,e){r.copy(this._start,t),r.copy(this._iStart,t),r.copy(this._end,e),r.copy(this._iEnd,e)},setStart:function(t){r.copy(this._start,t),r.copy(this._iStart,t)},setEnd:function(t){r.copy(this._end,t),r.copy(this._iEnd,t)},reset:function(){this._intersections.length=0},enter:function(t){return!t.isCullingActive()||this.intersects(t.getBound())},intersects:function(){var t=r.create(),e=r.create();return function(i){if(!i.valid())return!1;r.sub(t,this._iStart,i.center());var n=r.sqrLen(t)-i.radius2();if(n<=0)return!0;r.sub(e,this._iEnd,this._iStart);var a=r.sqrLen(e),s=2*r.dot(t,e),o=s*s-4*a*n;if(o<0)return!1;o=Math.sqrt(o);var h=.5/a,u=(-s-o)*h,c=(-s+o)*h;return!(u<=0&&c<=0)&&!(u>1&&c>1)}}(),intersect:function(){var t=new a;return function(e,i){var r=i.getShape();if(r)return r.intersectRay(this._iStart,this._iEnd,this._intersections,e.nodePath);if(t.reset(),t.setNodePath(e.nodePath),t.set(this._iStart,this._iEnd),i.computeTransformedVertices){var n=i.getVertexAttributeList(),a=n.Vertex.getElements();n.Vertex._elements=i.computeTransformedVertices(),t.apply(i),n.Vertex._elements=a}else t.apply(i);for(var s=t._intersections,o=this._intersections,h=s.length,u=0;u<h;u++)o.push(s[u]);return h>0}}(),getIntersections:function(){return this._intersections},setCurrentTransformation:function(t){n.invert(t,t),r.transformMat4(this._iStart,this._start,t),r.transformMat4(this._iEnd,this._end,t)}},t.exports=s},function(t,e,i){"use strict";var r=i(157),n=i(15).vec4,a=i(15).vec3,s=function(){this._intersections=[],this._index=0,this._polytope=[],this._iPolytope=[],this._referencePlane=n.create(),this._iReferencePlane=n.create(),this._intersectionLimit=s.NO_LIMIT,this._dimensionMask=s.AllDims};s.NO_LIMIT=0,s.LIMIT_ONE_PER_DRAWABLE=1,s.LIMIT_ONE=2,s.DimZero=1,s.DimOne=2,s.DimTwo=4,s.AllDims=s.DimZero|s.DimOne|s.DimTwo;var o=function(t,e,i){var r=e[0],n=e[1],a=e[2],s=e[3];t[0]=i[0]*r+i[1]*n+i[2]*a+i[3]*s,t[1]=i[4]*r+i[5]*n+i[6]*a+i[7]*s,t[2]=i[8]*r+i[9]*n+i[10]*a+i[11]*s,t[3]=i[12]*r+i[13]*n+i[14]*a+i[15]*s};s.prototype={setPolytope:function(t){this._polytope=t,this._referencePlane[0]=t[t.length-1][0],this._referencePlane[1]=t[t.length-1][1],this._referencePlane[2]=t[t.length-1][2],this._referencePlane[3]=t[t.length-1][3]},setPolytopeFromWindowCoordinates:function(t,e,i,r){this.setPolytope([n.fromValues(1,0,0,-t),n.fromValues(-1,0,0,i),n.fromValues(0,1,0,-e),n.fromValues(0,-1,0,r),n.fromValues(0,0,1,0)])},setDimensionMask:function(t){this._dimensionMask=t},reset:function(){this._intersections.length=0},enter:function(t){return!this.reachedLimit()&&this.intersects(t.getBound())},reachedLimit:function(){return this._intersectionLimit===s.LIMIT_ONE&&this._intersections.length>0},intersects:function(){var t=a.create();return function(e){if(!e.valid())return!1;var i,r=e.center();a.copy(t,r);for(var n=-e.radius(),s=0,o=this._iPolytope.length;s<o;s++)if(i=this._iPolytope[s][0]*t[0]+this._iPolytope[s][1]*t[1]+this._iPolytope[s][2]*t[2]+this._iPolytope[s][3],i<=n)return!1;return!0}}(),intersect:function(t,e){if(this.reachedLimit())return!1;var i=new r;i.setNodePath(t.nodePath),i.set(this._iPolytope,this._iReferencePlane),i.setLimitOneIntersection(this._intersectionLimit===s.LIMIT_ONE_PER_DRAWABLE||this._intersectionLimit===s.LIMIT_ONE),i.setDimensionMask(this._dimensionMask),i.apply(e);var n=i._intersections.length;if(n>0){for(var a=0;a<n;a++)this._intersections.push(i._intersections[a]);return!0}return!1},getIntersections:function(){return this._intersections},setIntersectionLimit:function(t){this._intersectionLimit=t},setCurrentTransformation:function(t){for(var e,i=n.create(),r=0,a=this._polytope.length;r<a;r++){var s=this._polytope[r];o(i,s,t),e=1/Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]),i[0]*=e,i[1]*=e,i[2]*=e,i[3]*=e,this._iPolytope[r]=n.clone(i)}o(this._iReferencePlane,this._referencePlane,t),e=1/Math.sqrt(this._iReferencePlane[0]*this._iReferencePlane[0]+this._iReferencePlane[1]*this._iReferencePlane[1]+this._iReferencePlane[2]*this._iReferencePlane[2]),this._iReferencePlane[0]*=e,this._iReferencePlane[1]*=e,this._iReferencePlane[2]*=e,this._iReferencePlane[3]*=e}},t.exports=s},function(t,e,i){"use strict";var r=i(16),n=i(15).vec3,a=i(102),s=function(t,e,i,r,a){this._index=t-1,this._distance=0,this._maxDistance=-1,this._numPoints=0,this._points=[],this._maxNumIntersections=6,this._center=n.create();for(var s=0,o=e.length;s<o;s++)if(0!==i[s]){this._points[this._numPoints++]=n.clone(e[s]),n.add(this._center,this._center,e[s]);var h=r[0]*e[s][0]+r[1]*e[s][1]+r[2]*e[s][2]+r[3];if(h>this._maxDistance&&(this._maxDistance=h),this._numPoints===this._maxNumIntesections)break}n.scale(this._center,this._center,1/this._numPoints),this._distance=r[0]*this._center[0]+r[1]*this._center[1]+r[2]*this._center[2]+r[3],this.nodePath=a},o=function(t,e,i){this._planeMask=t,this._pos=e,this._dir=i},h=function(){this._intersections=[],this._nodePath=[],this._index=0,this._referencePlane=[],this._planes=[],this._lines=[],this._candidates=[],this._candidatesMasks=[],this._lines=[],this._planesMask=0,this._limitOneIntersection=!1,this._dimensionMask=void 0};h.prototype={setNodePath:function(t){this._nodePath=t},set:function(t,e){this._planes=t,this._referencePlane=e,this._planesMask=0,this._lines.length=0;for(var i=0;i<this._planes.length;i++)this._planesMask=this._planesMask<<1|1},setDimensionMask:function(t){this._dimensionMask=t},apply:function(t){if(t.getAttributes().Vertex){var e=t.getAttributes().Vertex.getElements(),i=this,r=function(){return{operatorPoint:function(t){i.intersectPoint(t)},operatorLine:function(t,e){i.intersectLine(t,e)},operatorTriangle:function(t,e,r){i.intersectTriangle(t,e,r)}}},n=new a(t,r,e);n.apply()}},checkCandidatePoints:function(t){for(var e=1,i=this._candidates.length,r=0,n=this._planes.length;r<n&&i>0;++r,e<<=1)if(!(t&e))for(var a=0;a<this._candidates.length;++a)if(0!==this._candidatesMasks[a]&&!(e&this._candidatesMasks[a])&&this.distance(this._planes[r],this._candidates[a])<0&&(this._candidatesMasks[a]=0,--i,0===i))return 0;return i},intersectPoint:function(){var t=n.create();return function(e){if(this._index++,0!==(1&this._dimensionMask)&&!(this._limitOneIntersection&&this._intersections.length>0)){for(var i,r=0,a=this._planes.length;r<a;++r)if(i=this.distance(this._planes[r],e),i<0)return;this._candidates=[],this._candidatesMasks=[],n.copy(t,e),this._candidates.push(t),this._candidatesMasks.push(this._planesMask),this._intersections.push(new s(this._index,this._candidates,this._candidatesMasks,this._referencePlane,this._nodePath.slice(0)))}}}(),intersectLine:function(){var t=n.create();return function(e,i){if(this._index++,0!==(2&this._dimensionMask)&&!(this._limitOneIntersection&&this._intersections.length>0)){var r=!0,a=!0,o=1,h=0;this._candidates=[],this._candidatesMasks=[];for(var u,c,l,d,f=0,p=this._planes.length;f<p;++f,o<<=1){if(u=this.distance(this._planes[f],e),c=this.distance(this._planes[f],i),l=u<0,d=c<0,l&&d)return;l||d?(l&&(r=!1),d&&(a=!1),0===u?(n.copy(t,e),this._candidates.push(t),this._candidatesMasks.push(o)):0===c?(n.copy(t,i),this._candidates.push(t),this._candidatesMasks.push(o)):l&&!d?(n.sub(t,i,e),n.scale(t,t,u/(-u+c)),n.sub(t,e,t),this._candidates.push(t),this._candidatesMasks.push(o)):!l&&d&&(n.sub(t,i,e),n.scaleAndAdd(t,e,t,u/(u-c)),this._candidates.push(t),this._candidatesMasks.push(o))):h|=o}if(h===this._planesMask)return this._candidates.push(n.clone(e)),this._candidatesMasks.push(this._planesMask),this._candidates.push(n.clone(i)),this._candidatesMasks.push(this._planesMask),void this._intersections.push(new s(this._index,this._candidates,this._candidatesMasks,this._referencePlane,this._nodePath.slice(0)));var _=this.checkCandidatePoints(h);_>0&&(r&&(this._candidatesMasks.push(this._planesMask),this._candidates.push(n.clone(e))),a&&(this._candidatesMasks.push(this._planesMask),this._candidates.push(n.clone(i))),this._intersections.push(new s(this._index,this._candidates,this._candidatesMasks,this._referencePlane,this._nodePath.slice(0))))}}}(),intersectTriangle:function(){var t=n.create(),e=n.create(),i=n.create(),r=n.create(),a=n.create(),o=n.create(),h=n.create();return function(u,c,l){if(this._index++,0!==(4&this._dimensionMask)&&!(this._limitOneIntersection&&this._intersections.length>0)){var d=1,f=0;this._candidates=[],this._candidatesMasks=[];for(var p,_,g,m,v,S,x=0,b=this._planes.length;x<b;++x,d<<=1){if(p=this.distance(this._planes[x],u),_=this.distance(this._planes[x],c),g=this.distance(this._planes[x],l),m=p<0,v=_<0,S=g<0,m&&v&&S)return;m||v||S?(0===p?(n.copy(t,u),this._candidates.push(n.clone(t)),this._candidatesMasks.push(d)):0===_?(n.copy(t,c),this._candidates.push(n.clone(t)),this._candidatesMasks.push(d)):m&&!v?(n.sub(t,c,u),n.scale(t,t,p/(-p+_)),n.sub(t,u,t),this._candidates.push(n.clone(t)),this._candidatesMasks.push(d)):!m&&v&&(n.sub(t,c,u),n.scaleAndAdd(t,u,t,p/(p-_)),this._candidates.push(n.clone(t)),this._candidatesMasks.push(d)),0===g?(n.copy(t,l),this._candidates.push(n.clone(t)),this._candidatesMasks.push(d)):m&&!S?(n.sub(t,l,u),n.scale(t,t,p/(-p+g)),n.sub(t,u,t),this._candidates.push(n.clone(t)),this._candidatesMasks.push(d)):!m&&S&&(n.sub(t,l,u),n.scaleAndAdd(t,u,t,p/(p-g)),this._candidates.push(n.clone(t)),this._candidatesMasks.push(d)),v&&!S?(n.sub(t,l,c),n.scale(t,t,_/(-_+g)),n.sub(t,c,t),this._candidates.push(n.clone(t)),this._candidatesMasks.push(d)):!v&&S&&(n.sub(t,l,c),n.scaleAndAdd(t,c,t,_/(_-g)),this._candidates.push(n.clone(t)),this._candidatesMasks.push(d))):f|=d}if(f===this._planesMask)return this._candidates.push(n.clone(u)),this._candidatesMasks.push(this._planesMask),this._candidates.push(n.clone(c)),this._candidatesMasks.push(this._planesMask),this._candidates.push(n.clone(l)),this._candidatesMasks.push(this._planesMask),void this._intersections.push(new s(this._index,this._candidates,this._candidatesMasks,this._referencePlane,this._nodePath.slice(0)));var M=this.checkCandidatePoints(f);if(M>0)return void this._intersections.push(new s(this._index,this._candidates,this._candidatesMasks,this._referencePlane,this._nodePath.slice(0)));var y=this.getPolytopeLines();for(this._candidates=[],this._candidatesMasks=[],n.sub(e,c,u),n.sub(i,l,u),x=0;x<y.length;++x){n.cross(a,y[x]._dir,i);var T=n.dot(e,a);if(!(Math.abs(T)<1e-6)){var w=1/T;n.sub(o,y[x]._pos,u);var C=w*n.dot(o,a);if(!(C<0||C>1)){n.cross(h,o,e);var A=w*n.dot(y[x]._dir,h);if(!(A<0||C+A>1)){var E=w*n.dot(i,h);n.scaleAndAdd(r,y[x]._pos,y[x]._dir,E),this._candidates.push(n.copy(n.create(),r)),this._candidatesMasks.push(y[x]._planeMask)}}}}return M=this.checkCandidatePoints(f),M>0?void this._intersections.push(new s(this._index,this._candidates,this._candidatesMasks,this._referencePlane,this._nodePath.slice(0))):void 0}}}(),getPolytopeLines:function(){var t=n.create(),e=n.create(),i=n.create(),a=n.create(),s=n.create(),h=n.create(),u=1e-6;return function(){if(this._lines.length>0)return this._lines;for(var c=1,l=0,d=this._planes.length;l<d;l++,c<<=1){n.copy(i,this.getNormal(this._planes[l])),n.scale(a,i,-this._planes[l][3]);for(var f=c<<1,p=l+1,_=this._planes.length;p<_;++p,f<<=1)if(n.copy(s,this.getNormal(this._planes[p])),!(Math.abs(n.dot(i,s))>1-u)){n.cross(t,i,s),n.cross(e,t,i);var g=-this.distance(this._planes[p],a)/n.dot(e,s);r.isNaN(g)||(n.scaleAndAdd(h,a,e,g),this._lines.push(new o(c|f,n.clone(h),n.clone(t))))}}return this._lines}}(),setLimitOneIntersection:function(t){this._limitOneIntersection=t},distance:function(t,e){var i=t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3];return i},getNormal:function(){var t=n.create();return function(e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}}()},t.exports=h},function(t,e,i){"use strict";var r=i(145),n=function(t){this._manipulator=t,this._timer=!1,this.init()};n.prototype={init:function(){this.releaseButton(),this._rotateKey=65,this._zoomKey=83,this._panKey=68,this._mode=void 0},getMode:function(){return this._mode},setMode:function(t){this._mode=t},setEventProxy:function(t){this._eventProxy=t},setManipulator:function(t){this._manipulator=t},setDimensionMask:function(t){this._dimensionMask=t},mousemove:function(t){if(this._buttonup!==!0){var e=this._manipulator,i=e.getPositionRelativeToCanvas(t.clientX,t.clientY);if(isNaN(i[0])===!1&&isNaN(i[1])===!1){var n=this.getMode();if(n===r.Rotate)e.getRotateInterpolator().setTarget(i[0],i[1]);else if(n===r.Pan)e.getPanInterpolator().setTarget(i[0],i[1]);else if(n===r.Zoom){var a=e.getZoomInterpolator();e.computeIntersections(i),a.isReset()&&(a.setStart(i[1]),a.set(0));var s=i[1]-a.getStart();a.setStart(i[1]);var o=a.getTarget()[0];a.setTarget(o-s/20)}}t.preventDefault()}},mousedown:function(t){var e=this._manipulator,i=this.getMode();void 0===i&&(0===t.button?t.shiftKey?this.setMode(r.Pan):t.ctrlKey?this.setMode(r.Zoom):this.setMode(r.Rotate):this.setMode(r.Pan)),this.pushButton();var n=e.getPositionRelativeToCanvas(t.clientX,t.clientY);e.computeIntersections(n),i=this.getMode(),i===r.Rotate?(e.getRotateInterpolator().reset(),e.getRotateInterpolator().set(n[0],n[1])):i===r.Pan?(e.getPanInterpolator().reset(),e.getPanInterpolator().set(n[0],n[1])):i===r.Zoom&&(e.getZoomInterpolator().setStart(n[1]),e.getZoomInterpolator().set(0)),t.preventDefault()},mouseup:function(){this.releaseButton(),this.setMode(void 0)},mousewheel:function(t,e){var i=this._manipulator;t.preventDefault();var r=i.getZoomInterpolator().getTarget()[0]-e;i.getZoomInterpolator().setTarget(r);var n;if(this._timer===!1){this._timer=!0;var a=this;clearTimeout(n),n=setTimeout(function(){a._timer=!1},200);var s=i.getPositionRelativeToCanvas(t.clientX,t.clientY);i.computeIntersections(s)}},dblclick:function(t){var e=this._manipulator;t.preventDefault(),e.getZoomInterpolator().set(0);var i=e.getZoomInterpolator().getTarget()[0]-10;e.getZoomInterpolator().setTarget(i);var r=e.getPositionRelativeToCanvas(t.clientX,t.clientY);e.computeIntersections(r)},pushButton:function(){this._buttonup=!1},releaseButton:function(){this._buttonup=!0},keydown:function(t){32===t.keyCode?(this._manipulator.computeHomePosition(),t.preventDefault()):t.keyCode===this._panKey&&this.getMode()!==r.Pan?(this.setMode(r.Pan),this._manipulator.getPanInterpolator().reset(),this.pushButton(),t.preventDefault()):t.keyCode===this._zoomKey&&this.getMode()!==r.Zoom?(this.setMode(r.Zoom),this._manipulator.getZoomInterpolator().reset(),this.pushButton(),t.preventDefault()):t.keyCode===this._rotateKey&&this.getMode()!==r.Rotate&&(this.setMode(r.Rotate),this._manipulator.getRotateInterpolator().reset(),this.pushButton(),t.preventDefault())},keyup:function(t){t.keyCode===this._panKey?this.mouseup(t):t.keyCode===this._rotateKey?this.mouseup(t):t.keyCode===this._rotateKey&&this.mouseup(t),this.setMode(void 0)}},t.exports=n},function(t,e,i){"use strict";var r=i(10),n=function(t){this._manipulator=t,this._timer=!1,this.init()};n.prototype={init:function(){this._panFactorX=1,this._panFactorY=-this._panFactorX,this._rotateFactorX=.6,this._rotateFactorY=-this._rotateFactorX,this._zoomFactor=5,this._lastScale=0,this._nbPointerLast=0,this._lastPos=void 0},setEventProxy:function(t){if(void 0!==t&&(void 0===t||t!==this._eventProxy)){this._eventProxy=t;var e=this,i=t,n=function(t){return void 0!==t.pointers?t.pointers.length:1},a=function(t){return"touches "+n(t)+" distance "+t.distance+" x "+t.deltaX+" y "+t.deltaY};i.get("pinch").set({threshold:.1}),i.get("pan").set({threshold:0,pointers:0}),i.get("pinch").recognizeWith(i.get("pan")),i.get("tap").set({taps:2,posThreshold:300}),this._cbPanStart=function(t){var i=e._manipulator;if(i&&!e._transformStarted&&"mouse"!==t.pointerType){var s=t;e._dragStarted=!0,e._nbPointerLast=n(s);var o;2===e._nbPointerLast?(o=i.getPositionRelativeToCanvas(t.center.x,t.center.y),e._lastPos=o):o=void 0===e._lastPos?i.getCanvasCenter():e._lastPos,i.computeIntersections(o),2===e._nbPointerLast?(i.getPanInterpolator().reset(),i.getPanInterpolator().set(t.center.x*e._panFactorX,t.center.y*e._panFactorY)):i.getRotateInterpolator().reset(),r.debug("drag start, "+a(s))}},this._cbPanMove=function(t){var i=e._manipulator;if(i&&e._dragStarted&&"mouse"!==t.pointerType){var s=t,o=n(s);e._nbPointerLast!==o&&(2===o?i.getPanInterpolator().reset():i.getRotateInterpolator().reset(),e._nbPointerLast=o),2===o?(i.getPanInterpolator().setTarget(t.center.x*e._panFactorX,t.center.y*e._panFactorY),r.debug("pan, "+a(s))):(i.getRotateInterpolator().setTarget(t.center.x*e._rotateFactorX,t.center.y*e._rotateFactorY),r.debug("rotate, "+a(s)))}},this._cbPanEnd=function(t){var i=e._manipulator;if(i&&e._dragStarted&&"mouse"!==t.pointerType){e._dragStarted=!1;var n=t;r.debug("drag end, "+a(n))}},this._cbPinchStart=function(t){var i=e._manipulator;if(i&&"mouse"!==t.pointerType){e._transformStarted=!0;var n=t;e._lastScale=n.scale,i.getZoomInterpolator().reset(),i.getZoomInterpolator().set(e._lastScale),t.preventDefault(),r.debug("zoom start, "+a(n))}},this._cbPinchEnd=function(t){"mouse"!==t.pointerType&&(e._transformStarted=!1,r.debug("zoom end, "+a(t)))},this._cbPinchInOut=function(t){var i=e._manipulator;if(i&&e._transformStarted&&"mouse"!==t.pointerType){var n=t,s=n.scale>e._lastScale?e._zoomFactor:4*e._zoomFactor,o=(n.scale-e._lastScale)*s;e._lastScale=n.scale,i.getZoomInterpolator().setTarget(i.getZoomInterpolator().getTarget()[0]-o),r.debug("zoom, "+a(n))}},this._cbDoubleTap=function(t){var i=e._manipulator;if(i&&"mouse"!==t.pointerType){var n=t,s=i.getPositionRelativeToCanvas(t.center.x,t.center.y);e._lastPos=s,i.getZoomInterpolator().set(0);var o=i.getZoomInterpolator().getTarget()[0]-10;i.getZoomInterpolator().setTarget(o),r.debug("tap, "+a(n))}},i.on("panstart ",this._cbPanStart),i.on("panmove",this._cbPanMove),i.on("panend",this._cbPanEnd),i.on("pinchstart",this._cbPinchStart),i.on("pinchend",this._cbPinchEnd),i.on("pinchin pinchout",this._cbPinchInOut),i.on("tap",this._cbDoubleTap)}},removeEventProxy:function(t){t&&this._eventProxy&&(t.off("panstart ",this._cbPanStart),t.off("panmove",this._cbPanMove),t.off("panend",this._cbPanEnd),t.off("pinchstart",this._cbPinchStart),t.off("pinchend",this._cbPinchEnd),t.off("pinchin pinchout",this._cbPinchInOut),t.off("tap",this._cbDoubleTap))},setManipulator:function(t){this._manipulator=t}},t.exports=n},function(t,e,i){"use strict";var r=i(6),n=i(144),a=i(145),s=i(15).mat4,o=i(15).vec2,h=i(15).vec3,u=i(15).quat,c=i(147),l=i(161),d=i(162),f=i(163),p=function(t){n.call(this,t),this.init()};p.AvailableControllerList=["StandardMouseKeyboard","WebVR","DeviceOrientation","Hammer"],p.ControllerList=["StandardMouseKeyboard","WebVR","DeviceOrientation","Hammer"],p.prototype=r.objectInherit(n.prototype,{computeHomePosition:function(t){var e=this.getHomeBound(t);if(e&&e.valid()){this._distance=this.getHomeDistance(e);var i=e.center();h.scale(this._eye,this._direction,-this._distance),h.add(this._eye,i,this._eye),this.setTarget(i)}},init:function(){this._direction=h.fromValues(0,1,0),this._eye=h.fromValues(0,25,10),this._up=h.fromValues(0,0,1),this._distance=1,this._forward=new a.Interpolator(1),this._side=new a.Interpolator(1),this._lookPosition=new a.Interpolator(2),this._pan=new a.Interpolator(2),this._zoom=new a.Interpolator(1),this._stepFactor=1,this._angleVertical=0,this._angleHorizontal=0,this._tmpGetTargetDir=h.create(),this._vrEnable=!1,this._vrRot=u.create(),this._vrPos=h.create(),this._vrTrans=h.create();var t=this;this._controllerList={},p.ControllerList.forEach(function(e){void 0!==p[e]&&(t._controllerList[e]=new p[e](t))})},setDelay:function(t){this._forward.setDelay(t),this._side.setDelay(t),this._lookPosition.setDelay(t),this._pan.setDelay(t),this._zoom.setDelay(t)},getEyePosition:function(t){return t[0]=this._eye[0],t[1]=this._eye[1],t[2]=this._eye[2],t},setEyePosition:function(t){return this._eye[0]=t[0],this._eye[1]=t[1],this._eye[2]=t[2],this},getTarget:function(t){var e=h.scale(this._tmpGetTargetDir,this._direction,this._distance);return h.add(t,this._eye,e),t},setTarget:function(t){var e=this._tmpGetTargetDir;h.sub(e,t,this._eye),e[2]=0,h.normalize(e,e),this._angleHorizontal=Math.acos(e[1]),e[0]<0&&(this._angleHorizontal=-this._angleHorizontal),h.sub(e,t,this._eye),h.normalize(e,e),this._angleVertical=-Math.asin(e[2]),h.copy(this._direction,e)},getLookPositionInterpolator:function(){return this._lookPosition},getSideInterpolator:function(){return this._side},getForwardInterpolator:function(){return this._forward},getPanInterpolator:function(){return this._pan},getZoomInterpolator:function(){return this._zoom},getRotateInterpolator:function(){return this._lookPosition},computeRotation:function(){var t=s.create(),e=s.create(),i=h.fromValues(1,0,0),r=h.fromValues(0,1,0),n=h.fromValues(0,0,1),a=.5*Math.PI;return function(o,u){this._angleVertical+=.01*u,this._angleHorizontal-=.01*o,this._angleVertical>a?this._angleVertical=a:this._angleVertical<-a&&(this._angleVertical=-a),this._vrEnable?(h.transformQuat(this._direction,r,this._vrRot),h.normalize(this._direction,this._direction),h.transformQuat(this._up,n,this._vrRot)):(s.fromRotation(t,-this._angleVertical,i),s.fromRotation(e,-this._angleHorizontal,n),s.mul(e,e,t),h.transformMat4(this._direction,r,e),h.normalize(this._direction,this._direction),h.transformMat4(this._up,n,e))}}(),reset:function(){this.init()},setDistance:function(t){this._distance=t},getDistance:function(){return this._distance},setStepFactor:function(t){this._stepFactor=t},computePosition:function(){var t=o.create();return function(e){this._forward.update(e),this._side.update(e);var i=this._distance<.001?.001:this._distance,r=this._camera.getProjectionMatrix(),n=1===r[15]?1:2/r[5];t[0]=this._forward.getCurrent()[0],t[1]=this._side.getCurrent()[0];var a=o.sqrLen(t);a>1&&o.scale(t,t,1/Math.sqrt(a));var s=this._pan.update(e),u=this._zoom.update(e),c=this._stepFactor*i*n*e,l=this._stepFactor*i*n*.005;this.moveForward(t[0]*c-u[0]*l*20),this.strafe(t[1]*c-s[0]*l),this.strafeVertical(-s[1]*l),this._vrEnable&&(h.add(this._eye,this._eye,this._vrTrans),h.init(this._vrTrans))}}(),update:function(){var t=h.create();return function(e){var i=e.getFrameStamp().getDeltaTime(),r=this._lookPosition.update(i);this.computeRotation(.5*-r[0],.5*-r[1]),this.computePosition(i),h.add(t,this._eye,this._direction),s.lookAt(this._inverseMatrix,this._eye,t,this._up),this._vrEnable=!1}}(),setPoseVR:function(t,e){this._vrEnable=!0,u.copy(this._vrRot,t),h.sub(this._vrTrans,e,this._vrPos),h.copy(this._vrPos,e)},moveForward:function(){var t=h.create();return function(e){h.normalize(t,this._direction),h.scale(t,t,e),h.add(this._eye,this._eye,t)}}(),strafe:function(){var t=h.create();return function(e){h.cross(t,this._direction,this._up),h.normalize(t,t),h.scale(t,t,e),h.add(this._eye,this._eye,t)}}(),strafeVertical:function(){var t=h.create();return function(e){h.normalize(t,this._up),h.scale(t,t,e),h.add(this._eye,this._eye,t)}}()}),p.DeviceOrientation=c,p.Hammer=l,p.WebVR=d,p.StandardMouseKeyboard=f,t.exports=p},function(t,e,i){"use strict";var r=i(149);t.exports=r},function(t,e){"use strict";var i=function(t){this._manipulator=t,this.init()};i.prototype={init:function(){},update:function(t,e){this._manipulator.setPoseVR(t,e)}},t.exports=i},function(t,e){"use strict";var i=function(t){this._manipulator=t,this.init()};i.prototype={init:function(){this.releaseButton(),this._delay=.15,this._stepFactor=1},setEventProxy:function(t){this._eventProxy=t},setManipulator:function(t){this._manipulator=t,this._manipulator.setStepFactor(this._stepFactor)},pushButton:function(){this._buttonup=!1},releaseButton:function(){this._buttonup=!0},mousedown:function(t){var e=this._eventProxy.getPositionRelativeToCanvas(t),i=this._manipulator;i.getLookPositionInterpolator().set(e[0],e[1]),this.pushButton()},mouseup:function(){this.releaseButton()},mouseout:function(){this.releaseButton()},mousemove:function(t){if(this._buttonup!==!0){var e=this._eventProxy.getPositionRelativeToCanvas(t);this._manipulator.getLookPositionInterpolator().setDelay(this._delay),this._manipulator.getLookPositionInterpolator().setTarget(e[0],e[1])}},mousewheel:function(t,e){t.preventDefault(),this._stepFactor=Math.min(Math.max(.001,this._stepFactor+.01*e),4),this._manipulator.setStepFactor(this._stepFactor)},keydown:function(t){var e=this._manipulator;if(32===t.keyCode)e.computeHomePosition(),t.preventDefault();else{if(87===t.keyCode||90===t.keyCode||38===t.keyCode)return e.getForwardInterpolator().setDelay(this._delay),e.getForwardInterpolator().setTarget(1),t.preventDefault(),!1;if(83===t.keyCode||40===t.keyCode)return e.getForwardInterpolator().setDelay(this._delay),e.getForwardInterpolator().setTarget(-1),t.preventDefault(),!1;if(68===t.keyCode||39===t.keyCode)return e.getSideInterpolator().setDelay(this._delay),e.getSideInterpolator().setTarget(1),t.preventDefault(),!1;if(65===t.keyCode||81===t.keyCode||37===t.keyCode)return e.getSideInterpolator().setDelay(this._delay),e.getSideInterpolator().setTarget(-1),t.preventDefault(),!1}},keyup:function(t){var e=this._manipulator;return 87===t.keyCode||90===t.keyCode||38===t.keyCode||83===t.keyCode||40===t.keyCode?(e.getForwardInterpolator().setDelay(this._delay),e.getForwardInterpolator().setTarget(0),!1):68===t.keyCode||39===t.keyCode||65===t.keyCode||81===t.keyCode||37===t.keyCode?(e.getSideInterpolator().setDelay(this._delay),e.getSideInterpolator().setTarget(0),!1):void 0}},t.exports=i},function(t,e){"use strict";var i=function(){this._manipulatorList=[],this._currentManipulator=void 0};i.prototype={getCamera:function(){return this.getCurrentManipulator().getCamera()},setCamera:function(t){for(var e=this.getManipulatorList(),i=0,r=e.length;i<r;++i)e[i].setCamera(t)},update:function(t){var e=this.getCurrentManipulator();if(void 0!==e)return e.update(t)},getNode:function(){return this.getCurrentManipulator()._node},setNode:function(t){for(var e=this.getManipulatorList(),i=0,r=e.length;i<r;++i)e[i].setNode(t)},getControllerList:function(){return this.getCurrentManipulator().getControllerList()},getNumManipulator:function(){return this._manipulatorList.length},addManipulator:function(t){this._manipulatorList.push(t),void 0===this._currentManipulator&&this.setManipulatorIndex(0)},getManipulatorList:function(){return this._manipulatorList;
},setManipulatorIndex:function(t){this._currentManipulator=t},getCurrentManipulatorIndex:function(){return this._currentManipulator},getCurrentManipulator:function(){return this._manipulatorList[this._currentManipulator]},reset:function(){this.getCurrentManipulator().reset()},computeHomePosition:function(t){var e=this.getCurrentManipulator();void 0!==e&&e.computeHomePosition(t)},getInverseMatrix:function(){var t=this.getCurrentManipulator();if(void 0!==t)return t.getInverseMatrix()},getHomeBound:function(t){return this.getCurrentManipulator().getHomeBound(t)},getHomeDistance:function(t){return this.getCurrentManipulator().getHomeDistance(t)}},t.exports=i},function(t,e,i){"use strict";var r=i(166),n=i(167),a=i(168),s=i(178),o=i(214),h=i(154),u=i(155),c=i(6),l=i(221),d=i(222),f=i(223),p=i(156),_=i(157),g=i(224),m=i(225),v=i(94),S=i(226),x=i(227),b={};b.Composer=r,c.objectMix(b,n),b.DisplayNormalVisitor=a,b.DisplayGeometryVisitor=s,b.DisplayGraph=o,b.IntersectionVisitor=h,b.LineSegmentIntersector=u,b.NodeGizmo=l,b.GizmoGeometry=d,b.WebVRCustom=S,b.ParameterVisitor=f,b.PolytopeIntersector=p,b.PolytopePrimitiveIntersector=_,b.SphereIntersector=g,b.TangentSpaceGenerator=m,b.TriangleIntersect=v,b.WebVR=x,t.exports=b},function(t,e,i){"use strict";var r=i(10),n=i(6),a=i(12),s=i(55),o=i(84),h=i(40),u=i(52),c=i(67),l=i(110),d=i(15).mat4,f=i(41),p=i(29),_=i(103),g=i(104),m=i(105),v=i(35),S=i(15).vec2,x=i(15).vec3,b=function(){a.call(this),this._stack=[],this._renderToScreen=!1,this._dirty=!1,this._textureRTT=[],this._cameraRTT=[];var t=function(){};t.prototype={update:function(t){return t.isDirty()&&t.build(),!0}},this.addUpdateCallback(new t),this.getOrCreateStateSet().setAttributeAndModes(new o("DISABLE")),this.getOrCreateStateSet().setAttributeAndModes(new s("BACK"))};b.prototype=n.objectInherit(a.prototype,{dirty:function(){for(var t=0,e=this._stack.length;t<e;t++)this._stack[t].filter.dirty()},addPass:function(t,e,i){var r={};return r.filter=t,e instanceof h?(r.texture=e,r.textureTarget=i||h.TEXTURE_2D):void 0!==e&&void 0!==i&&(r.width=Math.floor(e),r.height=Math.floor(i)),this._stack.push(r),r.filter},renderToScreen:function(t,e){this._renderToScreen=!0,this._renderToScreenWidth=t,this._renderToScreenHeight=e},getResultTexture:function(){return this._resultTexture},isDirty:function(){for(var t=0,e=this._stack.length;t<e;t++)if(this._stack[t].filter.isDirty())return!0;return!1},debugCheckRttNotReadWrite:function(t,e){for(var i=0,n=e.getNumTextureAttributeLists();i<n;i++){var a=e.getTextureAttribute(i,"Texture");r.assert(t!==a,"Composer: write/read at the same time on a texture is undefined behavior")}},build:function(){var t=this;t._textureRTT=[],t._cameraRTT=[],this.removeChildren();var e;this._stack.forEach(function(i,n,a){if(i.filter.isDirty()&&i.filter.build(),i.filter.interConnectFilters)return void(e=i.filter.interConnectFilters(t,n,a));var s,o,p=i.filter.getStateSet();if(void 0!==i.texture)s=i.texture.getWidth(),o=i.texture.getHeight();else if(void 0!==i.width&&void 0!==i.height)s=i.width,o=i.height;else{var _=p.getTextureAttribute(0,"Texture");void 0===_?r.warn("Composer can't find any information to setup texture output size"):(s=_.getWidth(),o=_.getHeight())}var g=n===a.length-1&&t._renderToScreen===!0;if(!g&&void 0===p.getAttribute("Program"))return void a[n+1].filter.getStateSet().setTextureAttributeAndModes(0,p.getTextureAttribute(0,"Texture"));var x=new u;t._cameraRTT.push(x),x.setStateSet(p);var b;if(g===!0)s=t._renderToScreenWidth,o=t._renderToScreenHeight;else{x.setRenderOrder(u.PRE_RENDER,0),b=i.texture;var M=i.textureTarget;void 0===b&&(b=new h,b.setName("composer Rtt "+i.filter.getFragmentName()),b.setTextureSize(s,o),M=h.TEXTURE_2D,t._textureRTT.push(b)),x.attachTexture(c.COLOR_ATTACHMENT0,b,M)}var y=new l(0,0,s,o);x.setReferenceFrame(v.ABSOLUTE_RF),x.setViewport(y),d.ortho(x.getProjectionMatrix(),0,1,0,1,-5,5);var T=m.createTexturedFullScreenFakeQuadGeometry();i.filter.buildGeometry&&(T=i.filter.buildGeometry(T)),T.setName("composer layer"),b&&(t.debugCheckRttNotReadWrite(b,p),n+1<a.length&&a[n+1].filter.getStateSet().setTextureAttributeAndModes(0,b)),e=b,x.addChild(T),i.filter.getStateSet().addUniform(f.createFloat2(S.fromValues(s,o),"RenderSize")),x.setClearMask(0),x.setName(i.filter.getFragmentName()||"Composer Pass"+n),t.addChild(x)}),this._resultTexture=e}}),b.Filter=function(){this._stateSet=new p,this._dirty=!0,this._fragmentName="FilterOSGJS",this._vertexName=""},b.Filter.prototype={setFragmentName:function(t){this._fragmentName=t},getFragmentName:function(){return this._fragmentName},setVertexName:function(t){this._vertexName=t},getVertexName:function(){return this._vertexName},getDefineFragmentName:function(){return"\n#define SHADER_NAME "+this._fragmentName+"\n"},getDefineVertexName:function(){return"\n#define SHADER_NAME "+(this._vertexName||this._fragmentName)+"\n"},getStateSet:function(){return this._stateSet},getOrCreateStateSet:function(){return this._stateSet},dirty:function(){this._dirty=!0},isDirty:function(){return this._dirty}},b.Filter.defaultVertexShader=["attribute vec3 Vertex;","varying vec2 vTexCoord0;","void main(void) {","  gl_Position = vec4(Vertex*2.0 - 1.0,1.0);","  vTexCoord0 = Vertex.xy;","}",""].join("\n"),b.Filter.defaultFragmentShaderHeader=["#ifdef GL_FRAGMENT_PRECISION_HIGH\n precision highp float;\n #else\n precision mediump float;\n#endif","varying vec2 vTexCoord0;","uniform vec2 RenderSize;","uniform sampler2D Texture0;",""].join("\n"),b.Filter.shaderUtils=["vec4 packFloatTo4x8(in float v) {","vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * v;","enc = fract(enc);","enc -= enc.yzww * vec4(1.0/255.0,1.0/255.0,1.0/255.0,0.0);","return enc;","}"," ","vec4 pack2FloatTo4x8(in vec2 val) {"," const vec2 bitSh = vec2(256.0, 1.0);"," const vec2 bitMsk = vec2(0.0, 1.0/256.0);"," vec2 res1 = fract(val.x * bitSh);"," res1 -= res1.xx * bitMsk;"," vec2 res2 = fract(val.y * bitSh);"," res2 -= res2.xx * bitMsk;"," return vec4(res1.x,res1.y,res2.x,res2.y);","}"," ","float unpack4x8ToFloat( vec4 rgba ) {"," return dot( rgba, vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/16581375.0) );","}"," ","vec2 unpack4x8To2Float(in vec4 val) {"," const vec2 unshift = vec2(1.0/256.0, 1.0);"," return vec2(dot(val.xy, unshift), dot(val.zw, unshift));","}","vec2 encodeNormal (vec3 n)","{","    float f = sqrt(8.0*n.z+8.0);","    return n.xy / f + 0.5;","}","vec3 decodeNormal (vec2 enc)","{","    vec2 fenc = enc*4.0-2.0;","    float f = dot(fenc,fenc);","    float g = sqrt(1.0-f/4.0);","    vec3 n;","    n.xy = fenc*g;","    n.z = 1.0-f/2.0;","    return n;","}",""].join("\n"),b.Filter.Helper={pascalCache:[[1]],getOrCreatePascalCoefficients:function(t){t=void 0===t?5:Math.min(t,128);var e=b.Filter.Helper.pascalCache;if(e[t])return e[t];for(var i=e.length-1;i<t;i++){var r=e[i],n=r.length,a=new Array(n);a[0]=1,a[n]=1;for(var s=i===e.length-1?Math.pow(2,i):1,o=0;o<n-1;o++)a[o+1]=(r[o]+r[o+1])*s;s=Math.pow(2,i+1);for(var h=0;h<n+1;h++)a[h]/=s;e.push(a)}return e[t]}},b.Filter.Custom=function(t,e){b.Filter.call(this),this._fragmentShader=t,this._uniforms=e,this._vertexShader=b.Filter.defaultVertexShader},b.Filter.Custom.prototype=n.objectInherit(b.Filter.prototype,{setFragmentShader:function(t){this._fragmentShader=t},setVertexShader:function(t){this._vertexShader=t},autoBindFragmentUniformStateSet:function(t,e,i){var r=0,n=e.match(/uniform\s+\w+\s+\w+/g);if(n)for(var a=0,s=n.length;a<s;a++){var o,h=n[a].match(/uniform\s+(\w+)\s+(\w+)/),u=h[1],c=h[2];if(i[c]){var l=i[c];u.search("sampler")!==-1?(t.setTextureAttributeAndModes(r,l),o=f.createInt1(r,c),r++,t.addUniform(o)):(o=f.isUniform(l)?l:f[u](i[c],c),t.addUniform(o))}}},build:function(){this._program=new _(new g(g.VERTEX_SHADER,this._vertexShader+this.getDefineVertexName()),new g(g.FRAGMENT_SHADER,this._fragmentShader+this.getDefineFragmentName())),this._uniforms&&this.autoBindFragmentUniformStateSet(this._stateSet,this._fragmentShader,this._uniforms),this._stateSet.setAttributeAndModes(this._program),this._dirty=!1}}),b.Filter.PingPong=function(t,e,i,r,n,a){b.Filter.Custom.apply(this,[n,a]),this._cameraRtt0=t,this._rtt0=e,this._cameraRtt1=i,this._rtt1=r,this._fragmentName="PingPong"},b.Filter.PingPong.prototype=n.objectInherit(b.Filter.Custom.prototype,{interConnectFilters:function(t,e,i){var r=this.getStateSet(),n=this._cameraRtt0.getOrCreateStateSet(),a=this._cameraRtt1.getOrCreateStateSet();n.setAttributeAndModes(this._program),a.setAttributeAndModes(this._program);var s,o,h,u,c=this.getStateSet().getUniformList();if(c)for(h=window.Object.keys(c),s=0,o=h.length;s<o;s++)u=c[h[s]].getUniform(),n.addUniform(u),a.addUniform(u);if(c=this._uniforms)for(h=window.Object.keys(c),s=0,o=h.length;s<o;s++)u=c[h[s]],n.addUniform(u),a.addUniform(u);var l=f.createInt1(0,"Texture0"),d=f.createInt1(1,"Texture1");n.addUniform(l),n.addUniform(d),a.addUniform(l),a.addUniform(d);var p=r.getTextureAttribute(0,"Texture");if(n.setTextureAttributeAndModes(0,p),a.setTextureAttributeAndModes(0,p),n.setTextureAttributeAndModes(1,this._rtt1),a.setTextureAttributeAndModes(1,this._rtt0),e!==i.length-1){var _=i[e+1].filter.getStateSet();_.setTextureAttributeAndModes(0,this._rtt0),_.setTextureAttributeAndModes(1,this._rtt1),_.addUniform(l),_.addUniform(d)}var g=m.createTexturedFullScreenFakeQuadGeometry();return this.buildGeometry&&(g=this.buildGeometry(g)),g.setName("composer layer"),this._cameraRtt0.addChild(g),this._cameraRtt1.addChild(g),t.addChild(this._cameraRtt0),t.addChild(this._cameraRtt1),t._textureRTT.push(this._rtt0),t._textureRTT.push(this._rtt1),t._cameraRTT.push(this._cameraRtt0),t._cameraRTT.push(this._cameraRtt1),this._cameraRtt1.setNodeMask(0),this._rtt0},switch:function(){var t=this._cameraRtt0.getNodeMask(),e=this._cameraRtt1.getNodeMask();this._cameraRtt0.setNodeMask(e),this._cameraRtt1.setNodeMask(t)}}),b.Filter.AverageHBlur=function(t,e,i,r){b.Filter.call(this),this._linear=e!==!1,this.setBlurSize(void 0!==t?t:5),this._unpack=i,this._pack=r,this._pixelSize=1,this._fragmentName="AverageHBlur"+this._nbSamples},b.Filter.AverageHBlur.prototype=n.objectInherit(b.Filter.prototype,{setBlurSize:function(t){t%2!==1&&(t+=1),this._nbSamples=t,this.dirty()},setPixelSize:function(t){this._pixelSize=t,this.dirty()},getUVOffset:function(t){return"vec2(float("+t+")/RenderSize[0], 0.0);"},getShaderBlurKernel:function(){var t=this._nbSamples,e=[];e.push(" pixel = unpack(Texture0, vTexCoord0 );"),e.push(" if (pixel.w == 0.0) { gl_FragColor = pixel; return; }"),e.push(" vec2 offset;");var i,r=Math.floor(t/2);r%2!==0&&(t+=1,r=Math.floor(t/2));var n=2*r+1,a=1/n;if(this._linear){var s,o,h=1,u=(1-a)/(2*r);for(e.push(" pixel *= float("+a+");"),e.push(" vec4 pixelLin = vec4(0.0);"),i=0;i<r;i+=2)o=h+.5,h+=2,s=this.getUVOffset(o*this._pixelSize),e.push(" offset = "+s),e.push(" pixelLin += unpack(Texture0, vTexCoord0 + offset);"),e.push(" pixelLin += unpack(Texture0, vTexCoord0 - offset);");e.push(" pixel += pixelLin * float("+2*u+");")}else{for(i=0;i<r;i++)e.push(" offset = "+this.getUVOffset((i+1)*this._pixelSize)),e.push(" pixel += unpack(Texture0, vTexCoord0 + offset);"),e.push(" pixel += unpack(Texture0, vTexCoord0 - offset);");e.push(" pixel *= float("+a+");")}return e},build:function(){var t=this._stateSet.getTextureAttribute(0,"Texture");t&&this._linear?(t.setMinFilter("LINEAR"),t.setMagFilter("LINEAR")):this._linear=!1;var e=b.Filter.defaultVertexShader,i=[b.Filter.defaultFragmentShaderHeader,"uniform float width;",this._unpack||"vec4 unpack(const in sampler2D tex, const in vec2 uv) { return texture2D(tex, uv); }",this._pack||"vec4 pack(vec4 pix) { return pix; }","void main (void)","{","  vec4 pixel;",this.getShaderBlurKernel().join("\n"),"  gl_FragColor = pack(pixel);","}",""].join("\n"),r=new _(new g(g.VERTEX_SHADER,e+this.getDefineVertexName()),new g(g.FRAGMENT_SHADER,i+this.getDefineFragmentName()));void 0===this._stateSet.getUniform("Texture0")&&this._stateSet.addUniform(f.createInt1(0,"Texture0")),this._stateSet.setAttributeAndModes(r),this._dirty=!1}}),b.Filter.AverageVBlur=function(t,e,i,r){b.Filter.AverageHBlur.call(this,t,e,i,r),this._fragmentName="AverageVBlur"+this._nbSamples},b.Filter.AverageVBlur.prototype=n.objectInherit(b.Filter.AverageHBlur.prototype,{getUVOffset:function(t){return"vec2(0.0, float("+t+")/RenderSize[1]);"}}),b.Filter.BilateralHBlur=function(t,e,i){b.Filter.call(this),void 0===t&&(t={});var r=t.nbSamples,n=t.depthTexture,a=t.radius;this.setBlurSize(void 0!==r?r:5),this._depthTexture=n,this._radius=f.createFloat(1,"radius"),this._pixelSize=f.createFloat(1,"pixelSize"),this.setRadius(a),this._unpack=e,this._pack=i,this._fragmentName="BilateralHBlur"+this._nbSamples},b.Filter.BilateralHBlur.prototype=n.objectInherit(b.Filter.prototype,{setBlurSize:function(t){t%2!==1&&(t+=1),this._nbSamples=t,this.dirty()},setPixelSize:function(t){this._pixelSize.setFloat(t)},setRadius:function(t){this._radius.setFloat(t)},getUVOffset:function(t){return"vec2(0.0, float("+t+") * pixelSize )/RenderSize[1];"},getShaderBlurKernel:function(){var t=this._nbSamples,e=[];e.push(" pixel = unpack(Texture0, vTexCoord0 );"),e.push(" if (pixel.w <= 0.0001) { gl_FragColor = vec4(1.0); return; }"),e.push(" vec2 offset, tmpUV;"),e.push(" depth = getDepthValue(unpack(Texture1, vTexCoord0 ));");for(var i=1;i<Math.ceil(t/2);i++)e.push(" offset = "+this.getUVOffset(i)),e.push(" tmpUV =  vTexCoord0 + offset;"),e.push(" tmpDepth = getDepthValue(unpack(Texture1, tmpUV ));"),e.push(" if ( abs(depth-tmpDepth) < radius) {"),e.push("   pixel += unpack(Texture0, tmpUV);"),e.push("   nbHits += 1.0;"),e.push(" }"),e.push(" tmpUV =  vTexCoord0 - offset;"),e.push(" tmpDepth = getDepthValue(unpack(Texture1, tmpUV ));"),e.push(" if ( abs(depth-tmpDepth) < radius) {"),e.push("   pixel += unpack(Texture0, tmpUV);"),e.push("   nbHits += 1.0;"),e.push(" }");return e.push(" pixel /= nbHits;"),e},build:function(){var t=b.Filter.defaultVertexShader,e=[b.Filter.defaultFragmentShaderHeader,"uniform sampler2D Texture1;","uniform float width;","uniform mat4 projection;","uniform float radius;","uniform float pixelSize;",this._unpack||"vec4 unpack(const in sampler2D tex, const in vec2 uv) { return texture2D(tex, uv); }",this._pack||"vec4 pack(vec4 pix) { return pix; }","float znear,zfar,zrange;","",b.Filter.shaderUtils,"","float getDepthValue(vec4 v) {","  float depth = unpack4x8ToFloat(v);","  depth = depth*zrange+znear;","  return -depth;","}","void main (void)","{","  vec4 pixel;","  float depth, tmpDepth;","  znear = projection[3][2] / (projection[2][2]-1.0);","  zfar = projection[3][2] / (projection[2][2]+1.0);","  zrange = zfar-znear;","  float nbHits = 1.0;",this.getShaderBlurKernel().join("\n"),"  gl_FragColor = pack(pixel);","}",""].join("\n"),i=new _(new g(g.VERTEX_SHADER,t+this.getDefineVertexName()),new g(g.FRAGMENT_SHADER,e+this.getDefineFragmentName()));void 0===this._stateSet.getUniform("Texture0")&&this._stateSet.addUniform(f.createInt1(0,"Texture0")),void 0===this._stateSet.getUniform("Texture1")&&this._stateSet.addUniform(f.createInt1(1,"Texture1")),this._stateSet.addUniform(this._radius),this._stateSet.addUniform(this._pixelSize),this._stateSet.setTextureAttributeAndModes(1,this._depthTexture),this._stateSet.setAttributeAndModes(i),this._dirty=!1}}),b.Filter.BilateralVBlur=function(t,e,i){b.Filter.BilateralHBlur.call(this,t,e,i),this._fragmentName="BilateralVBlur"+this._nbSamples},b.Filter.BilateralVBlur.prototype=n.objectInherit(b.Filter.BilateralHBlur.prototype,{getUVOffset:function(t){return"vec2(float("+t+")*pixelSize/RenderSize[0],0.0);"}}),b.Filter.InputTexture=function(t){b.Filter.call(this),this._stateSet.setTextureAttributeAndModes(0,t),this._fragmentName="InputTexture"},b.Filter.InputTexture.prototype=n.objectInherit(b.Filter.prototype,{build:function(){this._dirty=!1}}),b.Filter.HBlur=function(t,e,i,r){b.Filter.call(this),this._linear=e!==!1,this.setBlurSize(void 0!==t?t:5),this._unpack=i,this._pack=r,this._fragmentName="HBlur"+this._nbSamples},b.Filter.HBlur.prototype=n.objectInherit(b.Filter.prototype,{setBlurSize:function(t){t%2!==0&&(t+=1),this._nbSamples=t,this.dirty()},getUVOffset:function(t){return"vec2(float("+t+")/ RenderSize[0], 0.0) ;"},build:function(){var t=this._nbSamples,e=this._stateSet.getTextureAttribute(0,"Texture");e&&this._linear?(e.setMinFilter("LINEAR"),e.setMagFilter("LINEAR")):this._linear=!1;var i=b.Filter.defaultVertexShader,r=.005/t,n=t,a=b.Filter.Helper.getOrCreatePascalCoefficients(n),s=Math.floor(n/2),o=[];o.push(" pixel = float("+a[s]+")*unpack(Texture0, vTexCoord0 ).rgb;"),o.push(" vec2 offset;");var h,u,c,l,d;if(this._linear)for(h=1,u=s+1;u<t;u+=2){var p=a[u],m=a[u+1];if(c=p+m,c<r)break;var v=h,S=h+1;h+=2,d=(v*p+S*m)/c,l=this.getUVOffset(d),o.push(" offset = "+l),o.push(" pixel += "+c+"* unpack(Texture0, (vTexCoord0.xy + offset.xy)).rgb;"),o.push(" pixel += "+c+"* unpack(Texture0, (vTexCoord0.xy - offset.xy)).rgb;")}else for(h=1,u=s+1;u<t&&(c=a[u],!(c<r));u++)d=h++,l=this.getUVOffset(d),o.push(" offset = "+l),o.push(" pixel += "+c+"* unpack(Texture0, (vTexCoord0.xy + offset.xy)).rgb;"),o.push(" pixel += "+c+"* unpack(Texture0, (vTexCoord0.xy - offset.xy)).rgb;");var x=[b.Filter.defaultFragmentShaderHeader,"uniform float width;",this._unpack||"vec4 unpack(const in sampler2D tex, const in vec2 uv) { return texture2D(tex, uv); }",this._pack||"vec4 pack(vec4 pix) { return pix; }","void main (void)","{","  vec3 pixel;",o.join("\n"),"  gl_FragColor = pack(vec4(pixel, 1.0));","}",""].join("\n"),M=new _(new g(g.VERTEX_SHADER,i+this.getDefineVertexName()),new g(g.FRAGMENT_SHADER,x+this.getDefineFragmentName()));void 0===this._stateSet.getUniform("Texture0")&&this._stateSet.addUniform(f.createInt1(0,"Texture0")),this._stateSet.setAttributeAndModes(M),this._dirty=!1}}),b.Filter.VBlur=function(t,e,i,r){b.Filter.HBlur.call(this,t,e,i,r),this._fragmentName="VBlur"+this._nbSamples},b.Filter.VBlur.prototype=n.objectInherit(b.Filter.HBlur.prototype,{getUVOffset:function(t){return"vec2(0.0, float("+t+")/RenderSize[1]) ;"}}),b.Filter.SobelFilter=function(){b.Filter.call(this),this._color=f.createFloat3(x.fromValues(1,1,1),"color"),this._factor=f.createFloat(1,"factor"),this._fragmentName="SobelFilter"},b.Filter.SobelFilter.prototype=n.objectInherit(b.Filter.prototype,{setColor:function(t){this._color.setVec3(t)},setFactor:function(t){this._factor.setFloat(t)},build:function(){var t=this._stateSet,e=b.Filter.defaultVertexShader,i=["",b.Filter.defaultFragmentShaderHeader,"uniform vec3 color;","uniform float factor;","void main (void)","{","  float fac0 = 2.0;","  float fac1 = 1.0;","  float offsetx = 1.0/RenderSize[0];","  float offsety = 1.0/RenderSize[1];","  vec4 texel0 = texture2D(Texture0, vTexCoord0 + vec2(offsetx, offsety));","  vec4 texel1 = texture2D(Texture0, vTexCoord0 + vec2(offsetx, 0.0));","  vec4 texel2 = texture2D(Texture0, vTexCoord0 + vec2(offsetx, -offsety));","  vec4 texel3 = texture2D(Texture0, vTexCoord0 + vec2(0.0, -offsety));","  vec4 texel4 = texture2D(Texture0, vTexCoord0 + vec2(-offsetx, -offsety));","  vec4 texel5 = texture2D(Texture0, vTexCoord0 + vec2(-offsetx, 0.0));","  vec4 texel6 = texture2D(Texture0, vTexCoord0 + vec2(-offsetx, offsety));","  vec4 texel7 = texture2D(Texture0, vTexCoord0 + vec2(0.0, offsety));","  vec4 rowx = -fac0*texel5 + fac0*texel1 +  -fac1*texel6 + fac1*texel0 + -fac1*texel4 + fac1*texel2;","  vec4 rowy = -fac0*texel3 + fac0*texel7 +  -fac1*texel4 + fac1*texel6 + -fac1*texel2 + fac1*texel0;","  float mag = sqrt(dot(rowy,rowy)+dot(rowx,rowx));","  if (mag < 1.0/255.0) discard;","  mag *= factor;","  mag = min(1.0, mag);","  gl_FragColor = vec4(color*mag,mag);","}",""].join("\n"),r=new _(new g(g.VERTEX_SHADER,e+this.getDefineVertexName()),new g(g.FRAGMENT_SHADER,i+this.getDefineFragmentName()));t.setAttributeAndModes(r),t.addUniform(this._color),t.addUniform(this._factor),t.addUniform(f.createInt1(0,"Texture0")),this._dirty=!1}}),b.Filter.BlendMix=function(){b.Filter.call(this);var t,e,i,r=0,n=1,a=this._stateSet;3===arguments.length?(t=arguments[0],e=arguments[1],i=arguments[2],r=1,n=2,a.setTextureAttributeAndModes(r,t)):2===arguments.length?(e=arguments[0],i=arguments[1]):1===arguments.length&&(e=arguments[0],i=.5),a.setTextureAttributeAndModes(n,e),a.addUniform(f.createInt1(r,"Texture0")),a.addUniform(f.createInt1(n,"Texture1")),this._mixValueUniform=f.createFloat1(i,"MixValue"),a.addUniform(this._mixValueUniform),this._fragmentName="BlendMix"},b.Filter.BlendMix.prototype=n.objectInherit(b.Filter.prototype,{getBlendFactorUniform:function(){return this._mixValueUniform},build:function(){var t=this._stateSet,e=b.Filter.defaultVertexShader,i=["",b.Filter.defaultFragmentShaderHeader,"uniform sampler2D Texture1;","uniform float MixValue;","void main (void)","{","  gl_FragColor = mix(texture2D(Texture0,vTexCoord0), texture2D(Texture1,vTexCoord0),MixValue);","}",""].join("\n"),r=new _(new g(g.VERTEX_SHADER,e+this.getDefineVertexName()),new g(g.FRAGMENT_SHADER,i+this.getDefineFragmentName()));t.setAttributeAndModes(r),this._dirty=!1}}),b.Filter.BlendMultiply=function(){b.Filter.call(this);var t,e,i=this._stateSet,r=0,n=1;2===arguments.length?(t=arguments[0],e=arguments[1],r=1,r=2,i.setTextureAttributeAndModes(r,t)):1===arguments.length&&(e=arguments[0]),i.setTextureAttributeAndModes(n,e),i.addUniform(f.createInt1(r,"Texture0")),i.addUniform(f.createInt1(n,"Texture1")),this._fragmentName="BlendMultiply"},b.Filter.BlendMultiply.prototype=n.objectInherit(b.Filter.prototype,{build:function(){var t=b.Filter.defaultVertexShader,e=["",b.Filter.defaultFragmentShaderHeader,"uniform sampler2D Texture1;","uniform float MixValue;","void main (void)","{","  gl_FragColor = texture2D(Texture0,vTexCoord0)*texture2D(Texture1,vTexCoord0);","}",""].join("\n"),i=new _(new g(g.VERTEX_SHADER,t+this.getDefineVertexName()),new g(g.FRAGMENT_SHADER,e+this.getDefineFragmentName()));this._stateSet.setAttributeAndModes(i),this._dirty=!1}}),b.Filter.SSAO=function(t){b.Filter.call(this);var e=this._stateSet,i=16,r=.05;if(void 0!==t){void 0!==t.nbSamples&&(i=t.nbSamples),void 0!==t.radius&&(r=t.radius);var n=t.normal,a=t.position,s=n.getWidth(),o=n.getHeight();this._size=S.fromValues(s,o),e.setTextureAttributeAndModes(0,n),e.setTextureAttributeAndModes(1,a)}this._radius=r,this._nbSamples=i,this._noiseTextureSize=16,this._sceneRadius=2,e.addUniform(f.createFloat1(1,"Power")),e.addUniform(f.createFloat1(r,"Radius")),e.addUniform(f.createInt1(0,"Texture0")),e.addUniform(f.createInt1(1,"Texture1")),e.addUniform(f.createInt1(2,"Texture2")),e.addUniform(f.createFloat1(.1,"AngleLimit")),this.initNoise(),this._fragmentName="SSAO"},b.Filter.SSAO.prototype=n.objectInherit(b.Filter.prototype,{initNoise:function(){var t=this._noiseTextureSize,e=new Array(t*t*3);!function(e){for(var i=S.fromValues(0,0),r=0;r<t*t;r++)i[0]=2*(Math.random()-.5),i[1]=2*(Math.random()-.5),S.normalize(i,i),e[3*r+0]=255*(.5*i[0]+.5),e[3*r+1]=255*(.5*i[1]+.5),e[3*r+2]=127.5}(e);var i=new h;i.setWrapS("REPEAT"),i.setWrapT("REPEAT"),i.setMinFilter("NEAREST"),i.setMagFilter("NEAREST"),i.setTextureSize(t,t),i.setImage(new Uint8Array(e),"RGB"),this._noiseTexture=i},setSceneRadius:function(t){this._sceneRadius=t,this.dirty()},setAngleLimit:function(t){var e=this._stateSet.getUniform("AngleLimit");e.setFloat(t)},setNbSamples:function(t){t!==this._nbSamples&&(this._nbSamples=Math.floor(t),this.dirty())},setRadius:function(t){var e=this._stateSet.getUniform("Radius");e.setFloat(t)},setPower:function(t){var e=this._stateSet.getUniform("Power");e.setFloat(t)},build:function(){var t=this._stateSet,e=this._nbSamples,i=new Array(4*e);!function(t){for(var i=x.create(),r=0;r<e;r++){i[0]=2*(Math.random()-.5),i[1]=2*(Math.random()-.5),i[2]=Math.random(),x.normalize(i,i);var n=Math.max(r/e,.1);n=.1+.9*(n*n),t[3*r+0]=i[0],t[3*r+1]=i[1],t[3*r+2]=i[2],t[3*r+3]=n}}(i),t.setTextureAttributeAndModes(2,this._noiseTexture);var r=t.getUniform("noiseSampling");void 0===r?(r=f.createFloat2(S.fromValues(this._size[0]/this._noiseTextureSize,this._size[1]/this._noiseTextureSize),"noiseSampling"),t.addUniform(r)):r.setVec2(S.fromValues(this._size[0]/this._noiseTextureSize,this._size[1]/this._noiseTextureSize));for(var n=["","attribute vec3 Vertex;","attribute vec2 TexCoord0;","varying vec2 vTexCoord0;","uniform mat4 uModelViewMatrix;","uniform mat4 uProjectionMatrix;","void main(void) {","  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex,1.0);","  vTexCoord0 = TexCoord0;","}",""].join("\n"),a=[],s=0;s<e;s++)a.push("kernel["+s+"] = vec4("+i[3*s]+","+i[3*s+1]+", "+i[3*s+2]+", "+i[3*s+3]+");");a=a.join("\n");var o=["",b.Filter.defaultFragmentShaderHeader,"uniform sampler2D Texture1;","uniform sampler2D Texture2;","uniform mat4 projection;","uniform vec2 noiseSampling;","uniform float Power;","uniform float Radius;","uniform float AngleLimit;","#define NB_SAMPLES "+this._nbSamples,"float depth;","vec3 normal;","vec4 position;","vec4 kernel["+e+"];","mat3 computeBasis()","{","  vec2 uvrand = vTexCoord0*noiseSampling;","  vec3 rvec = texture2D(Texture2, uvrand*2.0).xyz*2.0-vec3(1.0);","  vec3 tangent = normalize(rvec - normal * dot(rvec, normal));","  vec3 bitangent = cross(normal, tangent);","  mat3 tbn = mat3(tangent, bitangent, normal);","  return tbn;","}","void main (void)","{",a,"  position = texture2D(Texture1, vTexCoord0);","  vec4 p = texture2D(Texture0, vTexCoord0);","  depth = p.w;","  normal = vec3(p);","  if ( position.w == 0.0) {","     gl_FragColor = vec4(1.0,1.0,1.0,0.0);","     return;","  }",""," mat3 tbn = computeBasis();"," float occlusion = 0.0;"," for (int i = 0; i < NB_SAMPLES; i++) {","    vec3 vecKernel = vec3(kernel[i]);","    vecKernel[2] = max(AngleLimit,vecKernel[2]);","    vec3 sample = tbn * vecKernel;","    vec3 dir = sample;","    float w = dot(dir, normal);","    float dist = 1.0-kernel[i].w;","    w *= dist*dist*Power;","    sample = dir * float(Radius) + position.xyz;","    vec4 offset = projection * vec4(sample,1.0);","    offset.xy /= offset.w;","    offset.xy = offset.xy * 0.5 + 0.5;","    float sample_depth = texture2D(Texture1, offset.xy).z;","    float range_check = abs(sample.z - sample_depth) < float(Radius) ? 1.0 : 0.0;","    occlusion += (sample_depth > sample.z ? 1.0 : 0.0) * range_check*w;"," }"," occlusion = 1.0 - (occlusion / float(NB_SAMPLES));"," gl_FragColor = vec4(vec3(occlusion),1.0);","}",""].join("\n"),h=new _(new g(g.VERTEX_SHADER,n+this.getDefineVertexName()),new g(g.FRAGMENT_SHADER,o+this.getDefineFragmentName()));t.setAttributeAndModes(h),this._dirty=!1}}),b.Filter.SSAO8=function(t){b.Filter.SSAO.call(this,t),this._fragmentName="SSAO8"},b.Filter.SSAO8.prototype=n.objectInherit(b.Filter.SSAO.prototype,{buildGeometry:function(t){return t.getAttributes().TexCoord1=this._texCoord1,t},build:function(){var t=this._stateSet,e=this._nbSamples,i=new Array(4*e);!function(t){for(var i=x.create(),r=0;r<e;r++){i[0]=2*(Math.random()-.5),i[1]=2*(Math.random()-.5),i[2]=Math.random(),x.normalize(i,i);var n=Math.max(r/e,.1);n=.1+.9*(n*n),t[3*r+0]=i[0],t[3*r+1]=i[1],t[3*r+2]=i[2],t[3*r+3]=n}}(i),t.setTextureAttributeAndModes(2,this._noiseTexture);var r=t.getUniform("noiseSampling");void 0===r?(r=f.createFloat2(S.fromValues(this._size[0]/this._noiseTextureSize,this._size[1]/this._noiseTextureSize),"noiseSampling"),t.addUniform(r)):r.setVec2(S.fromValues(this._size[0]/this._noiseTextureSize,this._size[1]/this._noiseTextureSize));for(var n=["","attribute vec3 Vertex;","attribute vec2 TexCoord0;","attribute vec3 TexCoord1;","varying vec2 vTexCoord0;","varying vec3 vTexCoord1;","uniform mat4 uModelViewMatrix;","uniform mat4 uProjectionMatrix;","void main(void) {","  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex,1.0);","  vTexCoord0 = TexCoord0;","  vTexCoord1 = TexCoord1;","}",""].join("\n"),a=[],s=0;s<e;s++)a.push("kernel["+s+"] = vec4("+i[3*s]+","+i[3*s+1]+", "+i[3*s+2]+", "+i[3*s+3]+");");a=a.join("\n");var o=["",b.Filter.defaultFragmentShaderHeader,"varying vec3 vTexCoord1;","uniform sampler2D Texture1;","uniform sampler2D Texture2;","uniform mat4 projection;","uniform vec2 noiseSampling;","uniform float Power;","uniform float Radius;","uniform float AngleLimit;","#define NB_SAMPLES "+this._nbSamples,"float depth;","float znear, zfar, zrange;","vec3 normal;","vec3 position;","vec4 kernel["+e+"];",b.Filter.shaderUtils,"mat3 computeBasis()","{","  vec2 uvrand = vTexCoord0*noiseSampling;","  //uvrand = rand(gl_FragCoord.xy);","  vec3 rvec = texture2D(Texture2, uvrand*2.0).xyz*2.0-vec3(1.0);","  //vec3 rvec = normalize(vec3(uvrand,0.0));","  vec3 tangent = normalize(rvec - normal * dot(rvec, normal));","  vec3 bitangent = cross(normal, tangent);","  mat3 tbn = mat3(tangent, bitangent, normal);","  return tbn;","}","float getDepthValue(vec4 v) {","  float depth = unpack4x8ToFloat(v);","  depth = depth*zrange+znear;","  //depth = depth*zrange;","  return -depth;","}","void main (void)","{",a,"  vec4 p = texture2D(Texture0, vTexCoord0);","  if (dot(p,p) < 0.001) { ","     gl_FragColor = vec4(1.0,1.0,1.0,0.0);","     return;","  }","  znear = projection[3][2] / (projection[2][2]-1.0);","  zfar = projection[3][2] / (projection[2][2]+1.0);","  zrange = zfar-znear;","  depth = getDepthValue(texture2D(Texture1, vTexCoord0));","  if ( -depth < znear) {","     gl_FragColor = vec4(1.0,1.0,1.0,0.0);","     return;","  }","  normal = decodeNormal(unpack4x8To2Float(p));","  position = -vTexCoord1*depth;","  position.z = -position.z;",""," mat3 tbn = computeBasis();"," float occlusion = 0.0;"," for (int i = 0; i < NB_SAMPLES; i++) {","    vec3 vecKernel = vec3(kernel[i]);","    vecKernel[2] = max(AngleLimit,vecKernel[2]);","    vec3 sample = tbn * vec3(vecKernel);","    vec3 dir = sample;","    float w = dot(dir, normal);","    float dist = 1.0-kernel[i].w;","    w *= dist*dist*Power;","    sample = dir * float(Radius) + position.xyz;","    vec4 offset = projection * vec4(sample,1.0);","    offset.xy /= offset.w;","    offset.xy = offset.xy * 0.5 + 0.5;","    float sample_depth = getDepthValue(texture2D(Texture1, offset.xy));","    float range_check = abs(sample.z - sample_depth) < float(Radius) ? 1.0 : 0.0;","    occlusion += (sample_depth > sample.z ? 1.0 : 0.0) * range_check*w;"," }"," occlusion = 1.0 - (occlusion / float(NB_SAMPLES));"," gl_FragColor = vec4(vec3(occlusion),1.0);","}",""].join("\n"),h=new _(new g(g.VERTEX_SHADER,n+this.getDefineVertexName()),new g(g.FRAGMENT_SHADER,o+this.getDefineFragmentName()));t.setAttributeAndModes(h),this._dirty=!1}}),t.exports=b},function(t,e,i){"use strict";var r=i(105),n=function(t,e){var i,r;e?(i=e[0],r=e[1]):(i=t[14]/(t[10]-1),r=t[14]/(1+t[10]));var n=i*(t[8]-1)/t[0],a=i*(1+t[8])/t[0],s=i*(1+t[9])/t[5],o=i*(t[9]-1)/t[5],h=r*(t[8]-1)/t[0],u=r*(1+t[8])/t[0],c=r*(1+t[9])/t[5],l=r*(t[9]-1)/t[5],d=this.getAttributes().Vertex,f=d.getElements();f[0]=n,f[1]=o,f[2]=-i,f[3]=a,f[4]=o,f[5]=-i,f[6]=a,f[7]=s,f[8]=-i,f[9]=n,f[10]=s,f[11]=-i,f[12]=h,f[13]=l,f[14]=-r,f[15]=u,f[16]=l,f[17]=-r,f[18]=u,f[19]=c,f[20]=-r,f[21]=h,f[22]=c,f[23]=-r,d.dirty()},a=function(){var t=r.createBoundingBoxGeometry();return t.updateGeometry=n,t};t.exports={createDebugFrustumGeometry:a}},function(t,e,i){"use strict";var r=i(6),n=i(32),a=i(37),s=i(48),o=i(86),h=i(46),u=i(29),c=i(41),l=i(84),d=i(15).vec3,f=i(169),p=i(170),_=i(76),g=i(77),m=i(121),v=function(){p.apply(this,arguments)};v.prototype=r.objectInherit(p.prototype,{getFragmentShaderName:function(){return"CompilerOffsetNormal"},initTextureAttributes:function(){},createFragmentShaderGraph:function(){var t=this.getNode("glFragColor");return this.getNode("SetAlpha").inputs({color:this.getOrCreateUniform("vec3","uColorDebug"),alpha:this.createVariable("float").setValue("1.0")}).outputs({color:t}),[t]},getOffsetDirection:function(){return this.getOrCreateModelNormal()},getOrCreateModelVertex:function(){var t=this.getVariable("vertexOffset");if(t)return t;t=this.createVariable("vec3","vertexOffset");var e="%out = %offset == 1.0 ? %vertex + normalize(%direction.xyz) * %scale: %vertex;";
return this.getNode("InlineCode").code(e).inputs({offset:this.getOrCreateAttribute("float","Offset"),direction:this.getOffsetDirection(),vertex:p.prototype.getOrCreateModelVertex.call(this),scale:this.getOrCreateUniform("float","uScale")}).outputs({out:t}),t},getOrCreateViewVertex:function(){var t=this._variables.FragEyeVector;return t&&!t.isEmpty()?t:(t=this._varyings.FragEyeVector||this.createVariable("vec4","FragEyeVector"),this.getNode("MatrixMultPosition").inputs({matrix:this.getOrCreateUniform("mat4","uViewMatrix"),vec:this.getOrCreateModelVertex()}).outputs({vec:t}),t)}});var S=function(){f.apply(this,arguments),this.setShaderCompiler(v)};S.prototype=f.prototype;var x=function(){v.apply(this,arguments)};x.prototype=r.objectInherit(v.prototype,{getFragmentShaderName:function(){return"CompilerOffsetTangent"},getOffsetDirection:function(){return this.getOrCreateModelTangent()}});var b=function(){f.apply(this,arguments),this.setShaderCompiler(x)};b.prototype=f.prototype;var M=function(){n.call(this),this._unifScale=c.createFloat(1,"uScale");var t=this._normalStateSet=new u;t.addUniform(c.createFloat3(d.fromValues(1,0,0),"uColorDebug")),t.addUniform(this._unifScale),t.setAttributeAndModes(new l(l.NEVER)),t.setShaderGeneratorName("debugNormal");var e=this._tangentStateSet=new u;e.addUniform(c.createFloat3(d.fromValues(0,1,0),"uColorDebug")),e.addUniform(this._unifScale),e.setAttributeAndModes(new l(l.NEVER)),e.setShaderGeneratorName("debugTangent")};M.CompilerOffsetNormal=v,M.CompilerOffsetTangent=x,M.ShaderGeneratorCompilerOffsetNormal=S,M.ShaderGeneratorCompilerOffsetTangent=b,M.prototype=r.objectInherit(n.prototype,{setScale:function(t){this._unifScale.setFloat(t)},setTangentVisibility:function(t){this._tangentStateSet.setAttributeAndModes(new l(t?l.LESS:l.NEVER))},setNormalVisibility:function(t){this._normalStateSet.setAttributeAndModes(new l(t?l.LESS:l.NEVER))},apply:function(t){for(var e=t.getUpdateCallbackList(),i=0,r=e.length;i<r;++i)e[i]instanceof m&&(e[i]._isInitialized=!1);if(!t._isVisitedNormalDebug){if(t._isVisitedNormalDebug=!0,t instanceof a==!1)return this.traverse(t);this._createDebugGeom(t,"Normal",this._normalStateSet),this._createDebugGeom(t,"Tangent",this._tangentStateSet)}},_createDoubleOffsetArray:function(t){for(var e=new Float32Array(2*t),i=0;i<t;++i)e[2*i]=1;return new s(s.ARRAY_BUFFER,e,1)},_createDoubledBufferArray:function(t){t.getInitialBufferArray&&(t=t.getInitialBufferArray());for(var e=t.getItemSize(),i=t.getElements(),r=i.length/e,n=i.constructor,a=new n(2*i.length),o=0;o<r;++o)for(var h=o*e,u=2*h,c=0;c<e;++c)a[u+c]=a[u+c+e]=i[h+c];return new s(s.ARRAY_BUFFER,a,e)},_addMorphTargets:function(t,e,i){var r=e.getMorphTargets();e.setName(t.getName());for(var n=t.getMorphTargets(),s=0,o=n.length;s<o;++s){var h=n[s],u=h.getVertexAttributeList(),c=new a;c.setName(h.getName());var l=c.getVertexAttributeList();l.Vertex=this._createDoubledBufferArray(u.Vertex),u[i]&&(l[i]=this._createDoubledBufferArray(u[i])),r.push(c)}return e.mergeChildrenVertexAttributeList(),e},_createDebugGeom:function(t,e,i){var r=t.getAttributes(),n=r[e];if(n){var s=r.Vertex;if(s){var u;t instanceof g?u=t:t.getSourceGeometry&&t.getSourceGeometry()instanceof g&&(u=t.getSourceGeometry());var c=s.getElements().length/s.getItemSize(),l=u?new g:new a;l.getAttributes().Vertex=this._createDoubledBufferArray(s),l.getAttributes().Offset=this._createDoubleOffsetArray(c),l.getAttributes()[e]=this._createDoubledBufferArray(n),l.getPrimitives().push(new o(h.LINES,0,2*c)),u&&this._addMorphTargets(u,l,e);var d;if(t instanceof _){var f=new _;f.setSourceGeometry(l),f.getVertexAttributeList().Bones=this._createDoubledBufferArray(r.Bones),f.getVertexAttributeList().Weights=this._createDoubledBufferArray(r.Weights),f._rigTransformImplementation=t._rigTransformImplementation,f._stateSetAnimation=t._stateSetAnimation,f.mergeChildrenData(),d=f}else d=l;var p=t.getParents(),m=p.length;d._isVisitedNormalDebug=!0,d._isNormalDebug=!0,d.setStateSet(i);for(var v=0;v<m;++v)p[v].addChild(d);return d}}}}),t.exports=M},function(t,e,i){"use strict";var r=i(10),n=i(103),a=i(104),s=i(30),o=i(170),h=i(179),u=["ShadowReceive","Skinning","Morph","ShadowTexture","Texture","Light","Material","Billboard","PointSize"],c=function(){this._cache=new window.Map,this._shaderProcessor=new h,this._acceptAttributeTypes=new window.Set(u),this._ShaderCompiler=o};c.prototype={setShaderCompiler:function(t){this._ShaderCompiler=t},getShaderCompiler:function(){return this._ShaderCompiler},getAcceptAttributeTypes:function(){return this._acceptAttributeTypes},getShaderProcessor:function(){return this._shaderProcessor},setShaderProcessor:function(t){this._shaderProcessor=t},filterAttributeTypes:function(t){if("osg"!==t.libraryName()&&"osgShadow"!==t.libraryName()&&"osgAnimation"!==t.libraryName())return!0;var e=t.getType();return!this._acceptAttributeTypes.has(e)||!(!t.isEnabled||t.isEnabled())},getActiveAttributeList:function(t,e){for(var i="",r=t.attributeMap,n=r.getKeys(),a=0,s=n.length;a<s;a++){var o=n[a],h=r[o],u=h.lastApplied;this.filterAttributeTypes(u)||(i+=u.getHash?u.getHash():u.getType(),e.push(u))}return i},getActiveTextureAttributeList:function(t,e){var i,r,n="",a=t.textureAttributeMapList;for(i=0,r=a.length;i<r;i++){var s=a[i];if(s){e[i]=[];for(var o=s.getKeys(),h=0,u=o.length;h<u;h++){var c=o[h],l=s[c];if(0!==l.values().length){var d=l.lastApplied;this.filterAttributeTypes(d)||d.isTextureNull()||(n+=d.getHash?d.getHash():d.getType(),e[i].push(d))}}}}return n},getActiveUniforms:function(t,e,i){for(var r={},n=0,a=e.length;n<a;n++){var o=e[n];if(o.getOrCreateUniforms){var h=o.getOrCreateUniforms();if(void 0!==h)for(var u=h.getKeys(),c=0,l=u.length;c<l;c++){var d=u[c],f=h[d];r[f.getName()]=f}}}for(var p=0,_=i.length;p<_;p++){var g=i[p];if(g)for(var m=0,v=g.length;m<v;m++)for(var S=g[m],x=S.getOrCreateUniforms(p),b=x.getKeys(),M=0,y=b.length;M<y;M++){var T=b[M],w=x[T];r[w.getName()]=w}}return new s(r)},getOrCreateProgram:function(){var t=[],e=[];return function(i){var s="";e.length=0,t.length=0,s+=this.getActiveAttributeList(i,e),s+=this.getActiveTextureAttributeList(i,t);var o=this._cache.get(s);if(void 0!==o)return o;var h=this._ShaderCompiler,u=new h(e,t,this._shaderProcessor);r.debug("New Compilation ",!1,!0),r.debug({Attributes:e,Texture:t,Hash:s,Compiler:u.getFragmentShaderName()},!1,!0);var c=u.createFragmentShader(),l=u.createVertexShader(),d=new n(new a(a.VERTEX_SHADER,l),new a(a.FRAGMENT_SHADER,c));return d.hash=s,d.setActiveUniforms(this.getActiveUniforms(i,e,t)),d.generated=!0,this._cache.set(s,d),d}}()},t.exports=c},function(t,e,i){"use strict";var r=i(10),n=i(41),a=i(171),s=i(6),o=i(212),h=i(213),u=function(t,e,i){this._attributes=t,this._textureAttributes=e,this._fragmentShaderMode=!1,this._activeNodeList={},this._compiledNodeList={},this._traversedNodeList={},this._variables={},this._varyings={},this._vertexShader=[],this._fragmentShader=[],this._shaderProcessor=i,this._texturesByName={},this._shadowsTextures=[],this._lights=[],this._shadows=[],this._textures=[],this._material=null,this._invariantPosition=!1,this._isBillboard=!1,this._customVertexShader=!1,this._customFragmentShader=!1,this.initAttributes(),this.initTextureAttributes()};u.prototype=s.extend({},o,h,{getOrCreateProjectionMatrix:function(){return this.getOrCreateUniform("mat4","uProjectionMatrix")},getFragmentShaderName:function(){return this._material?"CompilerOSGJS":"NoMaterialCompilerOSGJS"},getVertexShaderName:function(){return this.getFragmentShaderName()},getOrCreateConstantOne:function(t){return this.getOrCreateConstant(t,t+"White").setValue(t+"(1.0)")},getOrCreateConstantZero:function(t){return this.getOrCreateConstant(t,t+"Black").setValue(t+"(0.0)")},initAttributes:function(){for(var t=this._attributes,e=this._lights,i=this._shadows,r=0,n=t.length;r<n;r++){var a=t[r].className();"Light"===a?e.push(t[r]):"Material"===a?this._material=t[r]:"ShadowReceiveAttribute"===a?i.push(t[r]):"Billboard"===a?this._isBillboard=!!t[r]:"SkinningAttribute"===a?this._skinningAttribute=t[r]:"MorphAttribute"===a?this._morphAttribute=t[r]:"PointSizeAttribute"===a&&(this._pointSizeAttribute=t[r])}},initTextureAttributes:function(){var t=this._textureAttributes,e=t.length;this._textures.length=this._shadowsTextures.length=e;for(var i=0;i<e;i++){var r=t[i];if(void 0!==r)for(var n=0,a=r.length;n<a;n++)this.registerTextureAttributes(r[n],i)}},registerTextureAttributes:function(t,e){var i=t.className();return"Texture"===i?this.registerTexture(t,e):i.indexOf("ShadowTexture")!==-1?this.registerTextureShadow(t,e):void 0},registerTexture:function(t,e){var i=t.getName();i||(i="Texture"+e,t.setName(i)),this._textures[e]=t,this._texturesByName[i]={texture:t,variable:void 0,textureUnit:e}},registerTextureShadow:function(t,e){var i=t.getName();i||(i="Texture"+e,t.setName(i)),this._shadowsTextures[e]=t,this._texturesByName[i]={texture:t,variable:void 0,textureUnit:e,shadow:!0}},getTextureByName:function(t){var e=this._texturesByName[t];if(!e||e.variable)return e;var i,r=e.texture,n=e.textureUnit,a=r.className(),s="Texture"+n;if("Texture"===a)i=this.getOrCreateSampler("sampler2D",s);else{if("TextureCubeMap"!==a)return;i=this.getOrCreateSampler("samplerCube",s)}var o=this._fragmentShaderMode?this.getOrCreateVarying("vec2","vTexCoord"+n):this.getOrCreateAttribute("vec2","TexCoord"+n);return e.variable=this.createTextureRGBA(r,i,o),e},createShaderFromGraphs:function(t){this._compiledNodeList={};for(var e=window.Object.keys(this._variables),i=[],n=0,a=e.length;n<a;n++){var s=this._variables[e[n]],o=s.declare();o&&i.push(o)}var h=this.evaluateExtensions(t),u=this.evaluateDefines(t),c=[];c.push("\n"),c.push(this.evaluateGlobalVariableDeclaration(t)),this._invariantPosition&&!this._fragmentShaderMode&&c.push("\ninvariant gl_Position;"),c.push("\n"),c.push(this.evaluateGlobalFunctionDeclaration(t)),c.push("void main() {"),0!==i.length&&(c.push("// vars\n"),c.push(i.join(" ")),c.push("\n// end vars\n")),0===t.length&&r.error("shader without any final Node output (need at least one)"),c.push(this.evaluate(t)),c.push("}");var l=c.join("\n"),d=this._shaderProcessor.processShader(l,u,h,this._fragmentShaderMode?"fragment":"vertex"),f=window.Object.keys(this._compiledNodeList),p=window.Object.keys(this._activeNodeList);return p.filter(function(t){var e=f.indexOf(t)!==-1;if(!e){var i=this._activeNodeList[t],n=i.getName();"Variable"===n&&(n+=" "+i.getVariable()+" ("+i.getType()+")"),r.warn("Nodes requested, but not compiled: "+t+" "+n+" "+i.toString())}return e},this),d},getNode:function(){var t=a.getNode.apply(a,arguments),e=t.getID();return this._activeNodeList[e]=t,t},getVariable:function(t){return this._variables[t]},getAttributeType:function(t){for(var e=0;e<this._attributes.length;e++)if(this._attributes[e].getType()===t)return this._attributes[e]},createVariable:function(t,e,i){var r=e;if(void 0===r){var n=window.Object.keys(this._variables).length;r="tmp_"+n}else if(this._variables[r]){if(r+=i,void 0===i)return this.createVariable(t,e,1);if(this._variables[r])return i++,this.createVariable(t,e,i)}var a=this.getNode("Variable",t,r);return this._variables[r]=a,a},getOrCreateUniformFromUniformMap:function(t,e){for(var i=window.Object.keys(t),r={},n=e?e:"",a=0;a<i.length;a++){var s=n+i[a];r[s]=this.getOrCreateUniform(t[i[a]])}return r},getOrCreateTextureStateAttributeUniforms:function(t,e,i){var r=t.getOrCreateUniforms(i);return this.getOrCreateUniformFromUniformMap(r,e)},getOrCreateStateAttributeUniforms:function(t,e){var i=t.getOrCreateUniforms();return this.getOrCreateUniformFromUniformMap(i,e)},getOrCreateUniform:function(t,e,i){var a=e;if(t instanceof n){var s=t;t=s.getType(),a=s.getName()}else void 0===a&&r.error("Cannot create unamed Uniform");var o=this._variables[a];if(o){if(o.getType()===t)return o;"sampler2D"===o.getType()&&"sampler2D"!==t&&r.error("Same uniform, but different type ("+t+", "+o.getType()+", "+o.getVariable()+")")}var h=this.getNode("Uniform",t,a,i);return this._variables[a]=h,h},getOrCreateSampler:function(t,e){void 0===e&&r.error("No name given for sampler type : "+t);var i=this._variables[e];if(i)return i;var n=this.getNode("Sampler",t,e);return this._variables[e]=n,n},getOrCreateAttribute:function(t,e){this._fragmentShaderMode&&r.error("No Vertex Attribute in Fragment Shader");var i=this._variables[e];if(i)return i.getType()!==t&&r.error("Same attribute, but different type"),i;var n=this.getNode("Attribute",t,e);return this._variables[e]=n,n},getOrCreateConstant:function(t,e){var i=e;if(void 0===i){var n=window.Object.keys(this._variables).length;i="tmp_"+n}else{var a=this._variables[i];if(a)return a.getType()!==t&&r.error("Same constant name, but different type"),a}var s=this.getNode("Constant",t,i);return this._variables[i]=s,s},getOrCreateVarying:function(t,e){void 0===e&&r.error("Error: Mandatory to name varying (as you need to retrieve them)");var i=this._variables[e];return i?(this._varyings[e]||r.error("Error: requesting a varying not declared with getOrCreateVarying previously"),i.getType()!==t&&r.error("Error: Same varying, but different type"),i):(this._fragmentShaderMode||this._customFragmentShader||r.error("Error: requesting a varying not declared in Fragment Shader Graph (for Custom Vertex Shader, add this._customFragmentShader to the processor): "+e+" "+t),i=this._variables[e]=this._varyings[e]=this.getNode("Varying",t,e))},markNodeAsVisited:function(t){var e=t.getID();this._activeNodeList[e]===t?this._compiledNodeList[e]=t:r.warn("Node not requested by using Compiler getNode and/or not registered in nodeFactory "+t.toString())},checkOrMarkNodeAsTraversed:function(t){var e=t.getID();return!!this._traversedNodeList[e]||(this._traversedNodeList[e]=t,!1)},traverse:function(t,e){if(!this.checkOrMarkNodeAsTraversed(e)){var i=e.getInputs();if(!Array.isArray(i)){for(var r=window.Object.keys(i),n=[],a=0;a<r.length;a++)n.push(i[r[a]]);i=n}for(var s=0,o=i.length;s<o;s++){e.checkInputsOutputs();var h=i[s];void 0!==h&&h!==e&&this.traverse(t,h)}t.call(t,e),this.markNodeAsVisited(e)}},preTraverse:function(t){return this._traversedNodeList={},t._map={},t._text=[],t},evaluateAndGatherField:function(t,e){var i=function(t){var i=t.getType();if(void 0!==i&&""!==i||r.error("Your node "+t+" has no type"),t[e]&&void 0===this._map[i]){this._map[i]=!0;var n=t[e]();Array.prototype.push.apply(this._text,n)}};this.preTraverse(i);for(var n=0,a=t.length;n<a;n++)this.traverse(i,t[n]);return i._text},evaluateGlobalFunctionDeclaration:function(t){var e=function(t){var e=t.getType();if(void 0!==e&&""!==e||r.error("Your node "+t+" has no type"),t.globalFunctionDeclaration&&void 0===this._map[e]){this._map[e]=!0;var i=t.globalFunctionDeclaration();void 0!==i&&this._text.push(i)}};this.preTraverse(e);for(var i=0,n=t.length;i<n;i++)this.traverse(e,t[i]);return e._text.join("\n")},evaluateGlobalVariableDeclaration:function(t){var e=function(t){var e=t.getID();if(t.globalDeclaration&&void 0===this._map[e]){this._map[e]=!0;var i=t.globalDeclaration();void 0!==i&&this._text.push(i)}};this.preTraverse(e);var i=0,r=t.length;for(i=0;i<r;i++)this.traverse(e,t[i]);var n=e._text,a=n.length;if(a>0){this.sortDeclarations(n);var s=n[0][0];for(i=0;i<a;++i){var o=n[i][0];o!==s&&(s=o,n[i-1]+="\n")}}return n.join("\n")},sortDeclarations:function(t){if(t.sort(),!this._fragmentShaderMode)for(var e=0,i=t.length;e<i;++e){var r=t[e];if("a"!==r[0])break;if(r.indexOf("Vertex")!==-1){t.splice(e,1),t.unshift(r);break}}},evaluate:function(t){var e=function(t){var e=t.getID();if(void 0===this._map[e]){var i=t.computeShader();if(void 0!==i){if(void 0!==t.getComment){var r=t.getComment();void 0!==r&&this._text.push(r)}this._text.push(i)}this._map[e]=!0}};this.preTraverse(e);for(var i=0,r=t.length;i<r;i++)this.traverse(e,t[i]);return e._text.join("\n")},evaluateDefines:function(t){return this.evaluateAndGatherField(t,"getDefines")},evaluateExtensions:function(t){return this.evaluateAndGatherField(t,"getExtensions")}}),t.exports=u},function(t,e,i){"use strict";var r=i(10),n=i(172),a=i(205),s=i(207),o=i(208),h=i(210),u=i(209),c=i(206),l=i(203),d=i(211),f=function(){this._nodes=new window.Map,this.registerNodes(n),this.registerNodes(a),this.registerNodes(c),this.registerNodes(s),this.registerNodes(o),this.registerNodes(l),this.registerNodes(h),this.registerNodes(u),this.registerNodes(d)};f.prototype={registerNodes:function(t){var e=this;window.Object.keys(t).forEach(function(i){e.registerNode(i,t[i])})},registerNode:function(t,e){this._nodes.has(t)&&r.warn("Node "+t+" already registered"),this._nodes.set(t,e)},getNode:function(t){var e=this._nodes.get(t);if(!e)return void r.warn("Node "+t+" does not exist");var i=window.Object.create(e.prototype);return e.apply(i,Array.prototype.slice.call(arguments,1)),i}};var p=new f;t.exports=p},function(t,e,i){"use strict";var r=i(6),n=i(173),a=i(204),s=function(){a.call(this)};s.prototype=r.objectInherit(a.prototype,{type:"Skinning",validInputs:["weights","bonesIndex","matrixPalette"],validOutputs:["mat4"],globalFunctionDeclaration:function(){return'#pragma include "skinning.glsl"'},computeShader:function(){return n.callFunction("skeletalTransform",this._outputs.mat4,[this._inputs.weights,this._inputs.bonesIndex])}}),t.exports={Skinning:s}},function(t,e,i){"use strict";var r=function(t,e){if(!t||!e)return"";var i;for(var r in e)i=e[r],void 0!==i&&(i.getVariable&&(i=i.getVariable()),t=t.replace("%s",i));return t},n=function(t,e){var i=t,r=[],n=e;void 0===e&&(n="");for(var a=0,s=i.length;a<s;a++){var o,h=i[a];o=void 0===h?"undefined":"string"==typeof h?h:h.getType?h.getType()+" "+h.getVariable():h.getVariable(),r.push(n+o)}return r},a=function(t,e,r){var a=i(174),s=[],o="";if(a.debugShaderNode&&(s.push("\n// output"),Array.prototype.push.apply(s,n([e],"// "))),e&&(e.getVariable&&(e=e.getVariable()),o=e+" = "),o=o+t+"( ",r&&r.length>0){a.debugShaderNode&&(s.push("// inputs"),Array.prototype.push.apply(s,n(r,"// ")));for(var h=0,u=r.length;h<u;h++)o+=r[h].getVariable?r[h].getVariable():r[h],h!==u-1&&(o+=", ")}return o+=" );\n",a.debugShaderNode?s.join("\n")+"\n"+o:o};t.exports={callFunction:a,checkVariableType:n,sprintf:r}},function(t,e,i){"use strict";var r=i(170),n=i(169),a=i(175),s=i(179),o=i(171),h=i(202),u=i(173),c={};c.Compiler=r,c.ShaderGenerator=n,c.ShaderGeneratorProxy=a,c.ShaderProcessor=s,c.nodeFactory=o,c.node=h,c.utils=u,c.debugShaderNode=!1,c.debugShaderNode=!0,t.exports=c},function(t,e,i){"use strict";var r=i(169),n=i(176),a=i(168),s=i(178),o=function(){return this._generators=new window.Map,this.addShaderGenerator("default",new r),this.addShaderGenerator("ShadowCast",new n),this.addShaderGenerator("debugNormal",new a.ShaderGeneratorCompilerOffsetNormal),this.addShaderGenerator("debugTangent",new a.ShaderGeneratorCompilerOffsetTangent),this.addShaderGenerator("debugGeometry",new s.ShaderGeneratorCompilerColorGeometry),this.addShaderGenerator("debugSkinning",new s.ShaderGeneratorCompilerColorSkinning),this};o.prototype={getShaderGenerator:function(t){return t?this._generators.get(t):this._generators.get("default")},addShaderGenerator:function(t,e){this._generators.set(t,e)}},t.exports=o},function(t,e,i){"use strict";var r=i(169),n=i(177),a=function(){r.apply(this,arguments),this.setShaderCompiler(n),this._acceptAttributeTypes=new window.Set(["ShadowCast","Skinning","Morph","PointSize"])};a.prototype=r.prototype,t.exports=a},function(t,e,i){"use strict";var r=i(6),n=i(170),a=function(){n.apply(this,arguments)};a.prototype=r.objectInherit(n.prototype,{getCompilerName:function(){return"ShadowCast"},getFragmentShaderName:function(){return this.getCompilerName()},initAttributes:function(){for(var t=this._attributes,e=0,i=t.length;e<i;e++){var r=t[e].className();"ShadowCastAttribute"===r?this._shadowCastAttribute=t[e]:"Billboard"===r?this._isBillboard=!!t[e]:"SkinningAttribute"===r?this._skinningAttribute=t[e]:"MorphAttribute"===r?this._morphAttribute=t[e]:"PointSizeAttribute"===r&&(this._pointSizeAttribute=t[e])}},registerTextureAttributes:function(){},createShadowCastDepth:function(t){return this.getNode("ShadowCast").setShadowCastAttribute(this._shadowCastAttribute).inputs({exponent0:this.getOrCreateUniform("float","exponent0"),exponent1:this.getOrCreateUniform("float","exponent1"),shadowDepthRange:this.getOrCreateUniform("vec4","uShadowDepthRange"),fragEye:this.getOrCreateVarying("vec4","vViewVertex")}).outputs({color:t}),t},createFragmentShaderGraph:function(){var t=this.getNode("glFragColor");return[this.createShadowCastDepth(t)]}}),t.exports=a},function(t,e,i){"use strict";var r=i(6),n=i(32),a=i(37),s=i(76),o=i(41),h=i(29),u=i(15).vec3,c=i(169),l=i(170),d=i(48),f=i(86),p=i(46),_=i(61),g=i(84),m=function(){l.apply(this,arguments)};m.prototype=r.objectInherit(l.prototype,{getFragmentShaderName:function(){return"CompilerDebugGeometry"},initTextureAttributes:function(){},createFragmentShaderGraph:function(){var t=this.getNode("glFragColor");return this.getNode("SetAlpha").inputs({color:this.getOrCreateUniform("vec3","uColorDebug"),alpha:this.createVariable("float").setValue("1.0")}).outputs({color:t}),[t]}});var v=function(){c.apply(this,arguments),this.setShaderCompiler(m)};v.prototype=c.prototype;var S=function(){l.apply(this,arguments)};S.prototype=r.objectInherit(l.prototype,{getFragmentShaderName:function(){return"CompilerDebugSkinning"},initTextureAttributes:function(){},createFragmentShaderGraph:function(){var t=this.getNode("glFragColor");return this.getNode("SetAlpha").inputs({color:this.getOrCreateVarying("vec3","vBonesColor"),alpha:this.createVariable("float").setValue("1.0")}).outputs({color:t}),[t]},declareVertexVaryings:function(t){var e=this.getOrCreateVarying("vec3","vBonesColor");return this.getNode("SetFromNode").inputs(this.getOrCreateAttribute("vec3","BonesColor")).outputs(e),l.prototype.declareVertexVaryings.call(this,t)}});var x=function(){c.apply(this,arguments),this.setShaderCompiler(S)};x.prototype=c.prototype;var b=function(){n.call(this),this._debugColor=!0,this._debugSkinning=!1,this._stCenter=new h,this._stCenter.setShaderGeneratorName("debugGeometry")};b.CompilerColorGeometry=m,b.ShaderGeneratorCompilerColorGeometry=v,b.CompilerSkinningGeometry=S,b.ShaderGeneratorCompilerColorSkinning=x,b.prototype=r.objectInherit(n.prototype,{setGeometryDebug:function(t){this._stCenter.setAttributeAndModes(new g(g.ALWAYS)),this._debugColor=!0,this._debugSkinning=!1,this.apply(t)},setSkinningDebug:function(t){this._stCenter.setAttributeAndModes(new g(g.NEVER)),this._debugColor=!1,this._debugSkinning=!0,this.apply(t)},disableDebug:function(t){this._stCenter.setAttributeAndModes(new g(g.NEVER)),this._debugColor=!1,this._debugSkinning=!1,this.apply(t)},apply:function(t){if(!t._isNormalDebug&&!t._isCenterDebug){if(t instanceof a)if(this._debugColor||this._debugSkinning&&t instanceof s){void 0===t._originalStateSet&&(t._originalStateSet=t.getStateSet()||null);var e=new h;if(t.setStateSet(e),this._debugSkinning){e.setShaderGeneratorName("debugSkinning");var i=t.getVertexAttributeList();if(!i.BonesColor){for(var r=i.Bones.getElements(),n=i.Weights.getElements(),c=t._rigTransformImplementation._bones,l=r.length/4,g=new Float32Array(3*l),m=0;m<l;++m){var v=4*m,S=c[r[v]].getOrCreateDebugColor(),x=c[r[v+1]].getOrCreateDebugColor(),b=c[r[v+2]].getOrCreateDebugColor(),M=c[r[v+3]].getOrCreateDebugColor(),y=n[v],T=n[v+1],w=n[v+2],C=n[v+3],A=3*m;g[A]=y*S[0]+T*x[0]+w*b[0]+C*M[0],g[A+1]=y*S[1]+T*x[1]+w*b[1]+C*M[1],g[A+2]=y*S[2]+T*x[2]+w*b[2]+C*M[2]}i.BonesColor=new d(d.ARRAY_BUFFER,g,3)}}else{var E=u.fromValues(Math.random(),Math.random(),Math.random());e.addUniform(o.createFloat3(E,"uColorDebug")),e.setShaderGeneratorName("debugGeometry");var I=t.getBound(),F=new Float32Array(18),R=.1*I.radius();F[0]=R,F[3]=-R,F[7]=R,F[10]=-R,F[14]=R,F[17]=-R;var N=new a;N.getAttributes().Vertex=new d(d.ARRAY_BUFFER,F,3);var D=new f(p.LINES,0,6);N.getPrimitives().push(D);var L=new _,P=I.center();L.getMatrix()[12]=P[0],L.getMatrix()[13]=P[1],L.getMatrix()[14]=P[2],L.addChild(N),this.nodePath[this.nodePath.length-2].addChild(L),E=u.fromValues(.8*E[0],.8*E[1],.8*E[2]),N.getOrCreateStateSet().addUniform(o.createFloat3(E,"uColorDebug")),L.setStateSet(this._stCenter),L._isCenterDebug=!0}}else void 0!==t._originalStateSet&&t.setStateSet(t._originalStateSet||void 0);this.traverse(t)}}}),t.exports=b},function(t,e,i){"use strict";var r=i(10),n=i(180),a=i(188),s=function(t){if(!t){if(s.instance)return s.instance;s.instance=this}return this.addShaders(n),this.addShaders(a),this};s.prototype={_shadersText:{},_shadersList:{},_globalDefaultprecision:"#ifdef GL_FRAGMENT_PRECISION_HIGH\n precision highp float;\n #else\n precision mediump float;\n#endif",_debugLines:!1,_includeR:/#pragma include "([^"]+)"/g,_includeCondR:/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,_defineR:/\#define\s+([a-zA-Z_0-9]+)/,_precisionR:/precision\s+(high|low|medium)p\s+float/,addShaders:function(t){var e=window.Object.keys(t);e.forEach(function(e){this._shadersList[e]=e,this._shadersText[e]=t[e]},this)},instrumentShaderlines:function(t,e){return"\n#line 0 "+e+"\n"+t},getShaderTextPure:function(t){var e=this._shadersText[t];return e||(r.error("shader file/text: "+t+" not registered"),e=""),e},getShader:function(t,e,i,r){var n=this.getShaderTextPure(t);return this.processShader(n,e,i,r)},preprocess:function(t,e,i,r){var n=this;return t.replace(this._includeCondR,function(t,a){var s=a.split(" "),o=s[0].replace(/"/g,"");if(s.length>1&&r){for(var h=!1,u=r.map(function(t){return n._defineR.test(t)&&t.replace(/\s+/g," ").split(" ")[1]}),c=1;c<s.length&&!h;c++)for(var l=s[c].replace(/"/g,""),d=0;d<u.length&&!h;d++)if(u[d]!==!1&&u[d]===l){h=!0;break}if(!h)return""}if(i.indexOf(o)!==-1)return"";var f=this.getShaderTextPure(o);return i.push(o),this._debugLines&&(f=this.instrumentShaderlines(f,e)),e++,f=this.preprocess(f,e,i,r)}.bind(this))},processShader:function(t,e,i,r){var n=[],a=t,s=0;this._debugLines&&(a=this.instrumentShaderlines(a,s),s++),void 0!==e&&(e=e.sort().filter(function(t,i){return!i||t!==e[i-1]})),void 0!==i&&(i=i.sort().filter(function(t,e){return!e||t!==i[e-1]}));var o=this.preprocess(a,s,n,e,r),h="";return h+="#version 100\n",void 0!==i&&(h+=i.join("\n")+"\n"),this._globalDefaultprecision&&(this._precisionR.test(o)||(h+=this._globalDefaultprecision+"\n")),void 0!==e&&(h+=e.join("\n")+"\n"),o=h+o}},t.exports=s},function(t,e,i){"use strict";var r=i(181),n=i(182),a=i(183),s=i(184),o=i(185),h=i(186),u=i(187);t.exports={"functions.glsl":r,"lights.glsl":n,"skinning.glsl":a,"textures.glsl":s,"colorEncode.glsl":o,"noise.glsl":h,"billboard.glsl":u}},function(t,e){t.exports="// the approximation :\r\n// http://chilliant.blogspot.fr/2012/08/srgb-approximations-for-hlsl.html\r\n// introduced slightly darker colors and more slight banding in the darks.\r\n// The reference implementation (or even a single pow approx) did not introduced these effects.\r\n\r\n// so for now we stick with the reference implementation :\r\n// https://www.khronos.org/registry/gles/extensions/EXT/EXT_sRGB.txt\r\n// with the slight changes :\r\n// - we always assume the color is >= 0.0 (so no check)\r\n// - unlike the previous approximation, linear to srgb is monotonic so we don't need to check if the color is > 1\r\n\r\n#define LIN_SRGB(x) x < 0.0031308 ? x * 12.92 : 1.055 * pow(x, 1.0/2.4) - 0.055\r\nfloat linearTosRGB(const in float c) {\r\n    return LIN_SRGB(c);\r\n}\r\nvec3 linearTosRGB(const in vec3 c) {\r\n    return vec3(LIN_SRGB(c.r), LIN_SRGB(c.g), LIN_SRGB(c.b));\r\n}\r\nvec4 linearTosRGB(const in vec4 c) {\r\n    return vec4(LIN_SRGB(c.r), LIN_SRGB(c.g), LIN_SRGB(c.b), c.a);\r\n}\r\n\r\n#define SRGB_LIN(x) x < 0.04045 ? x * (1.0 / 12.92) : pow((x + 0.055) * (1.0 / 1.055), 2.4)\r\nfloat sRGBToLinear(const in float c) {\r\n    return SRGB_LIN(c);\r\n}\r\nvec3 sRGBToLinear(const in vec3 c) {\r\n    return vec3(SRGB_LIN(c.r), SRGB_LIN(c.g), SRGB_LIN(c.b));\r\n}\r\nvec4 sRGBToLinear(const in vec4 c) {\r\n    return vec4(SRGB_LIN(c.r), SRGB_LIN(c.g), SRGB_LIN(c.b), c.a);\r\n}\r\n\r\n//http://graphicrants.blogspot.fr/2009/04/rgbm-color-encoding.html\r\nvec3 RGBMToRGB( const in vec4 rgba ) {\r\n    const float maxRange = 8.0;\r\n    return rgba.rgb * maxRange * rgba.a;\r\n}\r\n\r\nconst mat3 LUVInverse = mat3( 6.0013,    -2.700,   -1.7995,\r\n                              -1.332,    3.1029,   -5.7720,\r\n                              0.3007,    -1.088,    5.6268 );\r\n\r\nvec3 LUVToRGB( const in vec4 vLogLuv ) {\r\n    float Le = vLogLuv.z * 255.0 + vLogLuv.w;\r\n    vec3 Xp_Y_XYZp;\r\n    Xp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\r\n    Xp_Y_XYZp.z = Xp_Y_XYZp.y / vLogLuv.y;\r\n    Xp_Y_XYZp.x = vLogLuv.x * Xp_Y_XYZp.z;\r\n    vec3 vRGB = LUVInverse * Xp_Y_XYZp;\r\n    return max(vRGB, 0.0);\r\n}\r\n\r\n// http://graphicrants.blogspot.fr/2009/04/rgbm-color-encoding.html\r\nvec4 encodeRGBM(const in vec3 col, const in float range) {\r\n    if(range <= 0.0)\r\n        return vec4(col, 1.0);\r\n    vec4 rgbm;\r\n    vec3 color = col / range;\r\n    rgbm.a = clamp( max( max( color.r, color.g ), max( color.b, 1e-6 ) ), 0.0, 1.0 );\r\n    rgbm.a = ceil( rgbm.a * 255.0 ) / 255.0;\r\n    rgbm.rgb = color / rgbm.a;\r\n    return rgbm;\r\n}\r\n\r\nvec3 decodeRGBM(const in vec4 col, const in float range) {\r\n    if(range <= 0.0)\r\n        return col.rgb;\r\n    return range * col.rgb * col.a;\r\n}"},function(t,e){t.exports="////////////////\r\n// ATTENUATION\r\n/////////////\r\nfloat getLightAttenuation(const in float dist, const in vec4 lightAttenuation)\r\n{\r\n    // lightAttenuation(constantEnabled, linearEnabled, quadraticEnabled)\r\n    // TODO find a vector alu instead of 4 scalar\r\n    float constant = lightAttenuation.x;\r\n    float linear = lightAttenuation.y*dist;\r\n    float quadratic = lightAttenuation.z*dist*dist;\r\n    return 1.0 / ( constant + linear + quadratic );\r\n}\r\n//\r\n// LIGHTING EQUATION TERMS\r\n///\r\nvoid specularCookTorrance(const in vec3 n, const in vec3 l, const in vec3 v, const in float hard, const in vec3 materialSpecular, const in vec3 lightSpecular, out vec3 specularContrib)\r\n{\r\n    vec3 h = normalize(v + l);\r\n    float nh = dot(n, h);\r\n    float specfac = 0.0;\r\n\r\n    if(nh > 0.0) {\r\n        float nv = max( dot(n, v), 0.0 );\r\n        float i = pow(nh, hard);\r\n        i = i / (0.1 + nv);\r\n        specfac = i;\r\n    }\r\n    // ugly way to fake an energy conservation (mainly to avoid super bright stuffs with low glossiness)\r\n    float att = hard > 100.0 ? 1.0 : smoothstep(0.0, 1.0, hard * 0.01);\r\n    specularContrib = specfac*materialSpecular*lightSpecular*att;\r\n}\r\n\r\nvoid lambert(const in float ndl,  const in vec3 materialDiffuse, const in vec3 lightDiffuse, out vec3 diffuseContrib)\r\n{\r\n    diffuseContrib = ndl*materialDiffuse*lightDiffuse;\r\n}\r\n////////////////////////\r\n/// Main func\r\n///////////////////////\r\n\r\n/// for each light\r\n//direction, dist, NDL, attenuation, compute diffuse, compute specular\r\n\r\nvec3 computeSpotLightShading(\r\n                             const in vec3 normal,\r\n                             const in vec3 eyeVector,\r\n\r\n                             const in vec3 materialAmbient,\r\n                             const in vec3 materialDiffuse,\r\n                             const in vec3 materialSpecular,\r\n                             const in float materialShininess,\r\n\r\n                             const in vec3 lightAmbient,\r\n                             const in vec3 lightDiffuse,\r\n                             const in vec3 lightSpecular,\r\n\r\n                             const in vec3  lightSpotDirection,\r\n                             const in vec4  lightAttenuation,\r\n                             const in vec4  lightSpotPosition,\r\n                             const in float lightCosSpotCutoff,\r\n                             const in float lightSpotBlend,\r\n\r\n                             const in mat4 lightMatrix,\r\n                             const in mat4 lightInvMatrix,\r\n\r\n                             out vec3 eyeLightPos,\r\n                             out vec3 eyeLightDir,\r\n                             out float NdotL,\r\n                             out bool lighted)\r\n{\r\n    lighted = false;\r\n    eyeLightPos = vec3(lightMatrix * lightSpotPosition);\r\n    eyeLightDir = eyeLightPos - vViewVertex.xyz;\r\n    // compute dist\r\n    float dist = length(eyeLightDir);\r\n    // compute attenuation\r\n    float attenuation = getLightAttenuation(dist, lightAttenuation);\r\n    if (attenuation != 0.0)\r\n        {\r\n            // compute direction\r\n            eyeLightDir = dist > 0.0 ? eyeLightDir / dist :  vec3( 0.0, 1.0, 0.0 );\r\n            if (lightCosSpotCutoff > 0.0)\r\n                {\r\n                    //compute lightSpotBlend\r\n                    vec3 lightSpotDirectionEye = normalize(mat3(vec3(lightInvMatrix[0]), vec3(lightInvMatrix[1]), vec3(lightInvMatrix[2]))*lightSpotDirection);\r\n\r\n                    float cosCurAngle = dot(-eyeLightDir, lightSpotDirectionEye);\r\n                    float diffAngle = cosCurAngle - lightCosSpotCutoff;\r\n                    float spot = 1.0;\r\n                    if ( diffAngle < 0.0 ) {\r\n                        spot = 0.0;\r\n                    } else {\r\n                        if ( lightSpotBlend > 0.0 )\r\n                            spot = cosCurAngle * smoothstep(0.0, 1.0, (cosCurAngle - lightCosSpotCutoff) / (lightSpotBlend));\r\n                    }\r\n\r\n                    if (spot > 0.0)\r\n                        {\r\n                            // compute NdL\r\n                            NdotL = dot(eyeLightDir, normal);\r\n                            if (NdotL > 0.0)\r\n                                {\r\n                                    lighted = true;\r\n                                    vec3 diffuseContrib;\r\n                                    lambert(NdotL, materialDiffuse, lightDiffuse, diffuseContrib);\r\n                                    vec3 specularContrib;\r\n                                    specularCookTorrance(normal, eyeLightDir, eyeVector, materialShininess, materialSpecular, lightSpecular, specularContrib);\r\n                                    return spot * attenuation * (diffuseContrib + specularContrib);\r\n                                }\r\n                        }\r\n                }\r\n        }\r\n    return vec3(0.0);\r\n}\r\n\r\nvec3 computePointLightShading(\r\n                              const in vec3 normal,\r\n                              const in vec3 eyeVector,\r\n\r\n                              const in vec3 materialAmbient,\r\n                              const in vec3 materialDiffuse,\r\n                              const in vec3 materialSpecular,\r\n                              const in float materialShininess,\r\n\r\n                              const in vec3 lightAmbient,\r\n                              const in vec3 lightDiffuse,\r\n                              const in vec3 lightSpecular,\r\n\r\n                              const in vec4 lightPosition,\r\n                              const in vec4 lightAttenuation,\r\n\r\n                              const in mat4 lightMatrix,\r\n\r\n                              out vec3 eyeLightPos,\r\n                              out vec3 eyeLightDir,\r\n                              out float NdotL,\r\n                              out bool lighted)\r\n{\r\n\r\n    eyeLightPos =  vec3(lightMatrix * lightPosition);\r\n    eyeLightDir = eyeLightPos - vViewVertex.xyz;\r\n    float dist = length(eyeLightDir);\r\n    // compute dist\r\n    // compute attenuation\r\n    float attenuation = getLightAttenuation(dist, lightAttenuation);\r\n    if (attenuation != 0.0)\r\n        {\r\n            // compute direction\r\n            eyeLightDir = dist > 0.0 ? eyeLightDir / dist :  vec3( 0.0, 1.0, 0.0 );\r\n            // compute NdL\r\n            NdotL = dot(eyeLightDir, normal);\r\n            if (NdotL > 0.0)\r\n                {\r\n                    lighted = true;\r\n                    vec3 diffuseContrib;\r\n                    lambert(NdotL, materialDiffuse, lightDiffuse, diffuseContrib);\r\n                    vec3 specularContrib;\r\n                    specularCookTorrance(normal, eyeLightDir, eyeVector, materialShininess, materialSpecular, lightSpecular, specularContrib);\r\n                    return attenuation * (diffuseContrib + specularContrib);\r\n                }\r\n        }\r\n    return vec3(0.0);\r\n}\r\n\r\nvec3 computeSunLightShading(\r\n\r\n                            const in vec3 normal,\r\n                            const in vec3 eyeVector,\r\n\r\n                            const in vec3 materialAmbient,\r\n                            const in vec3 materialDiffuse,\r\n                            const in vec3 materialSpecular,\r\n                            const in float materialShininess,\r\n\r\n                            const in vec3 lightAmbient,\r\n                            const in vec3 lightDiffuse,\r\n                            const in vec3 lightSpecular,\r\n\r\n                            const in vec4 lightPosition,\r\n\r\n                            const in mat4 lightMatrix,\r\n\r\n                            out vec3 eyeLightDir,\r\n                            out float NdotL,\r\n                            out bool lighted)\r\n{\r\n\r\n    lighted = false;\r\n    eyeLightDir = normalize( vec3(lightMatrix * lightPosition ) );\r\n    // compute NdL   // compute NdL\r\n    NdotL = dot(eyeLightDir, normal);\r\n    if (NdotL > 0.0)\r\n        {\r\n            lighted = true;\r\n            vec3 diffuseContrib;\r\n            lambert(NdotL, materialDiffuse, lightDiffuse, diffuseContrib);\r\n            vec3 specularContrib;\r\n            specularCookTorrance(normal, eyeLightDir, eyeVector, materialShininess, materialSpecular, lightSpecular, specularContrib);\r\n            return (diffuseContrib + specularContrib);\r\n        }\r\n    return vec3(0.0);\r\n}\r\n\r\nvec3 computeHemiLightShading(\r\n\r\n    const in vec3 normal,\r\n    const in vec3 eyeVector,\r\n\r\n    const in vec3 materialDiffuse,\r\n    const in vec3 materialSpecular,\r\n    const in float materialShininess,\r\n\r\n    const in vec3 lightDiffuse,\r\n    const in vec3 lightGround,\r\n\r\n    const in vec4 lightPosition,\r\n\r\n    const in mat4 lightMatrix,\r\n\r\n    out vec3 eyeLightDir,\r\n    out float NdotL,\r\n    out bool lighted)\r\n{\r\n    lighted = false;\r\n\r\n    eyeLightDir = normalize( vec3(lightMatrix * lightPosition ) );\r\n    NdotL = dot(eyeLightDir, normal);\r\n    float weight = 0.5 * NdotL + 0.5;\r\n    vec3 diffuseContrib = materialDiffuse * mix(lightGround, lightDiffuse, weight);\r\n\r\n    // same cook-torrance as above for sky/ground\r\n    float skyWeight = 0.5 * dot(normal, normalize(eyeVector + eyeLightDir)) + 0.5;\r\n    float gndWeight = 0.5 * dot(normal, normalize(eyeVector - eyeLightDir)) + 0.5;\r\n    float skySpec = pow(skyWeight, materialShininess);\r\n    float skyGround = pow(gndWeight, materialShininess);\r\n    float divisor = (0.1 + max( dot(normal, eyeVector), 0.0 ));\r\n    float att = materialShininess > 100.0 ? 1.0 : smoothstep(0.0, 1.0, materialShininess * 0.01);\r\n    vec3 specularContrib = lightDiffuse * materialSpecular * weight * att * (skySpec + skyGround) / divisor;\r\n\r\n    return diffuseContrib + specularContrib;\r\n}\r\n";
},function(t,e){t.exports="//////////////////////////////\r\n// OPTIMIZED VERSION (NO IF)\r\n//////////////////////////////\r\nmat4 skeletalTransform( const in vec4 weightsVec, const in vec4 bonesIdx ) {\r\n    mat4 outMat_1;\r\n    mat4 tmpMat_2;\r\n    highp ivec4 tmpvar_3;\r\n    tmpvar_3 = (3 * ivec4(bonesIdx));\r\n    tmpMat_2 = mat4(1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0);\r\n    vec4 tmpvar_4;\r\n    tmpvar_4 = -(abs(weightsVec));\r\n    tmpMat_2[0] = uBones[tmpvar_3.x];\r\n    tmpMat_2[1] = uBones[(tmpvar_3.x + 1)];\r\n    tmpMat_2[2] = uBones[(tmpvar_3.x + 2)];\r\n    outMat_1 = ((float(\r\n    ((tmpvar_4.x + tmpvar_4.y) >= -((tmpvar_4.z + tmpvar_4.w)))\r\n    ) * mat4(1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0)) + (weightsVec.x * tmpMat_2));\r\n    tmpMat_2[0] = uBones[tmpvar_3.y];\r\n    tmpMat_2[1] = uBones[(tmpvar_3.y + 1)];\r\n    tmpMat_2[2] = uBones[(tmpvar_3.y + 2)];\r\n    outMat_1 = (outMat_1 + (weightsVec.y * tmpMat_2));\r\n    tmpMat_2[0] = uBones[tmpvar_3.z];\r\n    tmpMat_2[1] = uBones[(tmpvar_3.z + 1)];\r\n    tmpMat_2[2] = uBones[(tmpvar_3.z + 2)];\r\n    outMat_1 = (outMat_1 + (weightsVec.z * tmpMat_2));\r\n    tmpMat_2[0] = uBones[tmpvar_3.w];\r\n    tmpMat_2[1] = uBones[(tmpvar_3.w + 1)];\r\n    tmpMat_2[2] = uBones[(tmpvar_3.w + 2)];\r\n    outMat_1 = (outMat_1 + (weightsVec.w * tmpMat_2));\r\n\r\n    return outMat_1;\r\n}\r\n\r\n//////////////////////////////\r\n// UN-OPTIMIZED VERSION (WITH IF)\r\n//////////////////////////////\r\n\r\n// //http://http.developer.nvidia.com/GPUGems/gpugems_ch04.html\r\n// mat4 getMat4FromVec4( const int index, inout mat4 myMat ) {\r\n//     // We have to use a global variable because we can't access dynamically\r\n//     // matrix is transpose so we should do vec * matrix\r\n//     myMat[0] = uBones[ index ];\r\n//     myMat[1] = uBones[ index + 1];\r\n//     myMat[2] = uBones[ index + 2];\r\n//     return myMat;\r\n// }\r\n\r\n// mat4 skeletalTransform( const in vec4 weightsVec, const in vec4 bonesIdx ) {\r\n//     ivec4 idx =  3 * ivec4(bonesIdx);\r\n//     mat4 tmpMat = mat4(1.0);\r\n//     mat4 outMat = mat4(0.0);\r\n\r\n//     // we handle negative weights\r\n//     if(all(equal(weightsVec, vec4(0.0)))) return tmpMat;\r\n\r\n//     if(weightsVec.x != 0.0) outMat += weightsVec.x * getMat4FromVec4( idx.x, tmpMat );\r\n//     if(weightsVec.y != 0.0) outMat += weightsVec.y * getMat4FromVec4( idx.y, tmpMat );\r\n//     if(weightsVec.z != 0.0) outMat += weightsVec.z * getMat4FromVec4( idx.z, tmpMat );\r\n//     if(weightsVec.w != 0.0) outMat += weightsVec.w * getMat4FromVec4( idx.w, tmpMat );\r\n//     return outMat;\r\n// }\r\n\r\n//////////////////////////////\r\n// UN-OPTIMIZED VERSION (NO IF)\r\n//////////////////////////////\r\n\r\n// mat4 skeletalTransform( const in vec4 weightsVec, const in vec4 bonesIdx ) {\r\n//     ivec4 idx =  3 * ivec4(bonesIdx);\r\n//     mat4 tmpMat = mat4(1.0);\r\n\r\n//     // if sum is 0, return identity\r\n//     vec4 absWeights = -abs(weightsVec);\r\n//     mat4 outMat = step(0.0, absWeights.x + absWeights.y + absWeights.z + absWeights.w) * tmpMat;\r\n\r\n//     // we handle negative weights\r\n//     // outMat[3][3] += weightsVec.x + weightsVec.y + weightsVec.z + weightsVec.w;\r\n\r\n//     tmpMat[0] = uBones[ idx.x ];\r\n//     tmpMat[1] = uBones[ idx.x + 1];\r\n//     tmpMat[2] = uBones[ idx.x + 2];\r\n//     outMat += weightsVec.x * tmpMat;\r\n\r\n//     tmpMat[0] = uBones[ idx.y ];\r\n//     tmpMat[1] = uBones[ idx.y + 1];\r\n//     tmpMat[2] = uBones[ idx.y + 2];\r\n//     outMat += weightsVec.y * tmpMat;\r\n\r\n//     tmpMat[0] = uBones[ idx.z ];\r\n//     tmpMat[1] = uBones[ idx.z + 1];\r\n//     tmpMat[2] = uBones[ idx.z + 2];\r\n//     outMat += weightsVec.z * tmpMat;\r\n\r\n//     tmpMat[0] = uBones[ idx.w ];\r\n//     tmpMat[1] = uBones[ idx.w + 1];\r\n//     tmpMat[2] = uBones[ idx.w + 2];\r\n//     outMat += weightsVec.w * tmpMat;\r\n\r\n//     return outMat;\r\n// }\r\n"},function(t,e){t.exports="vec3 textureRGB(const in sampler2D texture, const in vec2 uv) {\r\n    return texture2D(texture, uv.xy ).rgb;\r\n}\r\n\r\nvec4 textureRGBA(const in sampler2D texture, const in vec2 uv) {\r\n    return texture2D(texture, uv.xy ).rgba;\r\n}\r\n\r\nfloat textureIntensity(const in sampler2D texture, const in vec2 uv) {\r\n    return texture2D(texture, uv).r;\r\n}\r\n\r\nfloat textureAlpha(const in sampler2D texture, const in vec2 uv) {\r\n    return texture2D(texture, uv.xy ).a;\r\n}\r\n"},function(t,e){t.exports="\r\nfloat decodeFloatRGBA( vec4 rgba ) {\r\n    return dot( rgba, vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/16581375.0) );\r\n}\r\n\r\nvec4 encodeFloatRGBA( float v ) {\r\n    vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * v;\r\n    enc = fract(enc);\r\n    enc -= enc.yzww * vec4(1.0/255.0,1.0/255.0,1.0/255.0,0.0);\r\n    return enc;\r\n}\r\n\r\nvec2 decodeHalfFloatRGBA( vec4 rgba ) {\r\n    return vec2(rgba.x + (rgba.y / 255.0), rgba.z + (rgba.w / 255.0));\r\n}\r\n\r\nvec4 encodeHalfFloatRGBA( vec2 v ) {\r\n    const vec2 bias = vec2(1.0 / 255.0, 0.0);\r\n    vec4 enc;\r\n    enc.xy = vec2(v.x, fract(v.x * 255.0));\r\n    enc.xy = enc.xy - (enc.yy * bias);\r\n\r\n    enc.zw = vec2(v.y, fract(v.y * 255.0));\r\n    enc.zw = enc.zw - (enc.ww * bias);\r\n    return enc;\r\n}\r\n"},function(t,e){t.exports='#pragma include "hash.glsl"\r\n\r\n//// noise glsl\r\n\r\n// Based on Morgan McGuire @morgan3d\r\n// https://www.shadertoy.com/view/4dS3Wd\r\nfloat noise2D(const in vec2 x) {\r\n    vec2 i = floor(x);\r\n    vec2 f = fract(x);\r\n\r\n    // Four corners in 2D of a tile\r\n    float a = hash21(i);\r\n    float b = hash21(i + vec2(1.0, 0.0));\r\n    float c = hash21(i + vec2(0.0, 1.0));\r\n    float d = hash21(i + vec2(1.0, 1.0));\r\n\r\n    vec2 u = f * f * (3.0 - 2.0 * f);\r\n    return mix(a, b, u.x) + (c - a) * u.y * (1.0 - u.x) + (d - b) * u.x * u.y;\r\n}\r\n\r\n//// end noise glsl\r\n'},function(t,e){t.exports="vec3 getScale( const in mat4 matrix ) {\r\n      // Only working with positive scales.\r\n      float xs = matrix[0][0] * matrix[0][1] * matrix[0][2] * matrix[0][3] < 0. ? -1. : 1.;\r\n      float ys = matrix[1][0] * matrix[1][1] * matrix[1][2] * matrix[1][3] < 0. ? -1. : 1.;\r\n      float zs = matrix[2][0] * matrix[2][1] * matrix[2][2] * matrix[2][3] < 0. ? -1. : 1.;\r\n      vec3 scale;\r\n      scale.x = xs * sqrt( matrix[0][0] * matrix[0][0] + matrix[0][1] * matrix[0][1] + matrix[0][2] * matrix[0][2]);\r\n      scale.y = ys * sqrt( matrix[1][0] * matrix[1][0] + matrix[1][1] * matrix[1][1] + matrix[1][2] * matrix[1][2]);\r\n      scale.z = zs * sqrt( matrix[2][0] * matrix[2][0] + matrix[2][1] * matrix[2][1] + matrix[2][2] * matrix[2][2]);\r\n      return scale;\r\n}\r\n\r\nvec4 billboard( const in vec3 vertex, const in mat4 modelViewMatrix, const in mat4 projectionMatrix ) {\r\n      vec3 scale = getScale( modelViewMatrix );\r\n      return projectionMatrix * ( vec4( scale.x* vertex.x , scale.y * vertex.y, scale.z * vertex.z, 1.0 ) + vec4( modelViewMatrix[ 3 ].xyz, 0.0 ) );\r\n}\r\n"},function(t,e,i){"use strict";var r=i(189),n=i(190),a=i(191),s=i(192),o=i(193),h=i(194),u=i(195),c=i(196),l=i(197),d=i(198),f=i(199),p=i(200),_=i(201);t.exports={"shadowsCastFrag.glsl":r,"shadowsReceive.glsl":n,"shadowsReceiveMain.glsl":a,"shadowLinearSoft.glsl":s,"pcf.glsl":o,"bandPCF.glsl":h,"tapPCF.glsl":u,"hash.glsl":c,"arrayPoisson.glsl":l,"poissonPCF.glsl":d,"esm.glsl":f,"vsm.glsl":p,"evsm.glsl":_}},function(t,e){t.exports='\r\n#pragma include "colorEncode.glsl"\r\n\r\n// see shadowSettings.js header for shadow algo param explanations\r\n\r\n#ifdef _EVSM\r\n// Convert depth to EVSM coefficients\r\n// Input depth should be in [0, 1]\r\nvec2 warpDepth(const in float depth, const in vec2 exponents) {\r\n    float pos =  exp( exponents.x * depth);\r\n    float neg = -exp(-exponents.y * depth);\r\n    return vec2(pos, neg);\r\n}\r\n\r\n// Convert depth value to EVSM representation\r\nvec4 shadowDepthToEVSM(const in float depth, const in float expo0, const in float expo1) {\r\n    vec2 warpedDepth = warpDepth(depth, vec2(expo0, expo1));\r\n    return vec4(warpedDepth.xy, warpedDepth.xy * warpedDepth.xy);\r\n}\r\n#endif // _EVSM\r\n\r\n\r\n#if defined(_NONE) ||  defined(_PCF)\r\nvec4 computeShadowDepth(const in vec4 fragEye,\r\n                        const in vec4 shadowRange)\r\n#else\r\nvec4 computeShadowDepth(const in vec4 fragEye,\r\n                        const in vec4 shadowRange,\r\n                        const in float expo0,\r\n                        const in float expo1)\r\n#endif\r\n{\r\n    // distance to camera\r\n    float depth =  -fragEye.z * fragEye.w;\r\n    // most precision near 0, make sure we are near 0 and in  [0,1]\r\n    depth = (depth - shadowRange.x ) * shadowRange.w;\r\n\r\n    vec4 outputFrag;\r\n\r\n#if defined (_FLOATTEX) && defined(_PCF)\r\n    outputFrag = vec4(depth, 0.0, 0.0, 1.0);\r\n#elif defined (_FLOATTEX)  && defined(_ESM)\r\n    float depthScale = expo1;\r\n    depth = exp(-depth * depthScale);\r\n    outputFrag = vec4(depth, 0.0, 0.0, 1.0);\r\n#elif defined (_FLOATTEX)  && defined(_VSM)\r\n    outputFrag = vec4(depth, depth * depth, 0.0, 1.0);\r\n#elif defined (_FLOATTEX)  && defined(_EVSM)\r\n    outputFrag = shadowDepthToEVSM(depth, expo0, expo1);\r\n#elif defined (_FLOATTEX) // && defined(_NONE)\r\n    outputFrag = vec4(depth, 0.0, 0.0, 1.0);\r\n#elif defined(_PCF)\r\n    outputFrag = encodeFloatRGBA(depth);\r\n#elif defined(_ESM)\r\n    float depthScale = expo1;\r\n    depthScale = exp(-depth * depthScale);\r\n    outputFrag = encodeFloatRGBA(depthScale);\r\n#elif defined(_VSM)\r\n    outputFrag = encodeHalfFloatRGBA(vec2(depth, depth* depth));\r\n#else // NONE\r\n    outputFrag = encodeFloatRGBA(depth);\r\n\r\n#endif\r\n\r\n    return outputFrag;\r\n}\r\n'},function(t,e){t.exports='//begin shadows\r\n\r\n#pragma include "colorEncode.glsl"\r\n\r\n// see shadowSettings.js header for shadow algo param explanations\r\n\r\n// end Float codec\r\nfloat getSingleFloatFromTex(const in sampler2D depths, const in vec2 uv){\r\n#ifndef _FLOATTEX\r\n    return  decodeFloatRGBA(texture2D(depths, uv));\r\n#else\r\n    return texture2D(depths, uv).x;\r\n#endif\r\n}\r\n\r\nvec2 getDoubleFloatFromTex(const in sampler2D depths, const in vec2 uv){\r\n#ifndef _FLOATTEX\r\n    return decodeHalfFloatRGBA(texture2D(depths, uv));\r\n#else\r\n    return texture2D(depths, uv).xy;\r\n#endif\r\n}\r\n\r\nvec4 getQuadFloatFromTex(const in sampler2D depths, const in vec2 uv){\r\n    return texture2D(depths, uv).xyzw;\r\n}\r\n// end Float codec\r\n\r\n\r\n#pragma include "vsm.glsl" "_VSM"\r\n\r\n#pragma include "evsm.glsl" "_EVSM"\r\n\r\n#pragma include "esm.glsl" "_ESM"\r\n\r\n#pragma include "pcf.glsl" "_NONE" "_PCF"'},function(t,e){t.exports="\r\n// 0 for early out\r\nbool earlyOut = false;\r\n\r\n// Calculate shadow amount\r\nfloat shadow = 1.0;\r\n\r\nif(!lighted) {\r\n    shadow = 0.0;\r\n    earlyOut = true;\r\n}\r\n\r\nif (depthRange.x == depthRange.y) {\r\n    earlyOut = true;\r\n}\r\n\r\nvec4 shadowVertexEye;\r\nfloat shadowReceiverZ = 0.0;\r\nvec4 shadowVertexProjected;\r\nvec2 shadowUV;\r\n\r\nif(!earlyOut) {\r\n\r\n    shadowVertexEye=  shadowViewMatrix *  vec4(vertexWorld, 1.0);\r\n    shadowReceiverZ=  - shadowVertexEye.z;\r\n    shadowVertexProjected = shadowProjectionMatrix * shadowVertexEye;\r\n\r\n    if (shadowVertexProjected.w < 0.0) {\r\n        earlyOut = true; // notably behind camera\r\n    }\r\n      \r\n    if (!earlyOut) {\r\n        shadowUV.xy = shadowVertexProjected.xy / shadowVertexProjected.w;\r\n        shadowUV.xy = shadowUV.xy * 0.5 + 0.5;// mad like\r\n\r\n        if(any(bvec4 ( shadowUV.x > 1., shadowUV.x < 0., shadowUV.y > 1., shadowUV.y < 0.))) {\r\n            earlyOut = true;// limits of light frustum\r\n        }\r\n          \r\n        // most precision near 0, make sure we are near 0 and in [0,1]\r\n        shadowReceiverZ =  (shadowReceiverZ - depthRange.x)* depthRange.w;\r\n\r\n        if(shadowReceiverZ < 0.0) {\r\n            earlyOut = true; // notably behind camera\r\n        }\r\n          \r\n    }\r\n      \r\n}\r\n\r\n\r\n#if defined( _PCF )\r\n\r\n// pcf pbias to add on offset\r\nvec2 shadowBiasPCF = vec2(0.);\r\n\r\n#ifdef GL_OES_standard_derivatives\r\n\r\nshadowBiasPCF.x = clamp(dFdx(shadowReceiverZ)* shadowTextureSize.z, -1.0, 1.0 );\r\nshadowBiasPCF.y = clamp(dFdy(shadowReceiverZ)* shadowTextureSize.w, -1.0, 1.0 );\r\n\r\n#endif\r\n\r\n#endif\r\n\r\n\r\nvec4 clampDimension;\r\n\r\n#ifdef _ATLAS_SHADOW\r\n \r\nshadowUV.xy  = ((shadowUV.xy * shadowMapSize.zw ) + shadowMapSize.xy) / shadowTextureSize.xy;\r\n\r\n// clamp uv bias/filters by half pixel to avoid point filter on border\r\nclampDimension.xy = shadowMapSize.xy + vec2(0.5);\r\nclampDimension.zw = (shadowMapSize.xy + shadowMapSize.zw) - vec2(0.5);\r\n\r\nclampDimension = clampDimension / (shadowTextureSize.xyxy);\r\n\r\n\r\n#else\r\n\r\nclampDimension = vec4(0.0, 0.0, 1.0, 1.0);\r\n\r\n#endif\r\n\r\n\r\n// now that derivatives is done\r\n// and we don't access any mipmapped/texgrad texture\r\n// we can early out\r\n// see http://teknicool.tumblr.com/post/77263472964/glsl-dynamic-branching-and-texture-samplers\r\nif (earlyOut) return shadow;\r\n\r\n// depth bias: fighting shadow acne (depth imprecsion z-fighting)\r\nfloat shadowBias = 0.0;\r\n// cosTheta is dot( n, l ), clamped between 0 and 1\r\n//float shadowBias = 0.005*tan(acos(N_Dot_L));\r\n// same but 4 cycles instead of 15\r\nshadowBias += 0.05 *  sqrt( 1. -  N_Dot_L*N_Dot_L) / clamp(N_Dot_L, 0.0005,  1.0);\r\n\r\n//That makes sure that plane perpendicular to light doesn't flicker due to\r\n//selfshadowing and 1 = dot(Normal, Light) using a min bias\r\nshadowBias = clamp(shadowBias, 0.00005,  bias);\r\n\r\n// shadowZ must be clamped to [0,1]\r\n// otherwise it's not comparable to\r\n// shadow caster depth map\r\n// which is clamped to [0,1]\r\n// Not doing that makes ALL shadowReceiver > 1.0 black\r\n// because they ALL becomes behind any point in Caster depth map\r\nshadowReceiverZ = clamp(shadowReceiverZ, 0., 1. - shadowBias);\r\n\r\nshadowReceiverZ -= shadowBias;\r\n\r\n// Now computes Shadow\r\n\r\n#ifdef _NONE\r\n\r\nfloat shadowDepth = getSingleFloatFromTex(tex, shadowUV.xy);\r\n// shadowReceiverZ : receiver depth in light view\r\n// shadowDepth : caster depth in light view\r\n// receiver is shadowed if its depth is superior to the caster\r\nshadow = ( shadowReceiverZ > shadowDepth ) ? 0.0 : 1.0;\r\n\r\n#elif defined( _PCF )\r\n\r\nshadow = getShadowPCF(tex, shadowTextureSize, shadowUV, shadowReceiverZ, shadowBiasPCF, clampDimension);\r\n\r\n#elif defined( _ESM )\r\n\r\nshadow = fetchESM(tex, shadowTextureSize, shadowUV, shadowReceiverZ, exponent0, exponent1);\r\n\r\n#elif  defined( _VSM )\r\n\r\nvec2 moments = getDoubleFloatFromTex(tex, shadowUV.xy);\r\nshadow = chebyshevUpperBound(moments, shadowReceiverZ, epsilonVSM);\r\n\r\n#elif  defined( _EVSM )\r\n\r\nvec4 occluder = getQuadFloatFromTex(tex, shadowUV.xy);\r\nvec2 exponents = vec2(exponent0, exponent1);\r\nvec2 warpedDepth = warpDepth(shadowReceiverZ, exponents);\r\n\r\nfloat derivationEVSM = epsilonVSM;\r\n// Derivative of warping at depth\r\nvec2 depthScale = derivationEVSM * exponents * warpedDepth;\r\nvec2 minVariance = depthScale * depthScale;\r\n\r\nfloat epsilonEVSM = -epsilonVSM;\r\n\r\n// Compute the upper bounds of the visibility function both for x and y\r\nfloat posContrib = chebyshevUpperBound(occluder.xz, -warpedDepth.x, minVariance.x);\r\nfloat negContrib = chebyshevUpperBound(occluder.yw, warpedDepth.y, minVariance.y);\r\n\r\nshadow = min(posContrib, negContrib);\r\n\r\n#endif\r\n\r\n\r\nreturn shadow;\r\n\r\n"},function(t,e){t.exports="\r\n// simulation of texture2Dshadow glsl call on HW\r\n// http://codeflow.org/entries/2013/feb/15/soft-shadow-mapping/\r\nfloat texture2DCompare(const in sampler2D depths, const in vec2 uv, const in float compare, const in vec4 clampDimension){\r\n\r\n    float depth = getSingleFloatFromTex(depths, clamp(uv, clampDimension.xy, clampDimension.zw));\r\n    return step(compare, depth);\r\n\r\n}\r\n\r\n// simulates linear fetch like texture2d shadow\r\nfloat texture2DShadowLerp(const in sampler2D depths, const in vec4 size, const in vec2 uv, const in float compare, const in vec4 clampDimension){\r\n\r\n#if defined(_FAKE_PCF)\r\n    // CHEAT: it's wrong, but 4x faster\r\n    // wronb because http://www.eng.utah.edu/~cs5610/handouts/reeves87.pdf p2\r\n    return texture2DCompare(depths, uv, compare, clampDimension);\r\n#else\r\n    vec2 f = fract(uv*size.xy+0.5);\r\n    vec2 centroidUV = floor(uv*size.xy+0.5)*size.zw;\r\n\r\n    float lb = texture2DCompare(depths, centroidUV+size.zw*vec2(0.0, 0.0), compare, clampDimension);\r\n    float lt = texture2DCompare(depths, centroidUV+size.zw*vec2(0.0, 1.0), compare, clampDimension);\r\n    float rb = texture2DCompare(depths, centroidUV+size.zw*vec2(1.0, 0.0), compare, clampDimension);\r\n    float rt = texture2DCompare(depths, centroidUV+size.zw*vec2(1.0, 1.0), compare, clampDimension);\r\n    float a = mix(lb, lt, f.y);\r\n    float b = mix(rb, rt, f.y);\r\n    float c = mix(a, b, f.x);\r\n    return c;\r\n#endif\r\n\r\n}\r\n"},function(t,e){t.exports='\r\n#pragma include "bandPCF.glsl" "_BAND_PCF"\r\n#pragma include "poissonPCF.glsl" "_POISSON_PCF"\r\n#pragma include "tapPCF.glsl" "_TAP_PCF"\r\n\r\n#ifdef _ATLAS_SHADOW\r\n\r\nfloat computeShadow(const in bool lighted,\r\n                    const in sampler2D tex,\r\n                    const in vec4 shadowMapSize,\r\n                    const in vec4 shadowTextureSize,\r\n                    const in mat4 shadowProjectionMatrix,\r\n                    const in mat4 shadowViewMatrix,\r\n                    const in vec4 depthRange,\r\n                    const in float N_Dot_L,\r\n                    const in vec3 vertexWorld,\r\n                    const in float bias\r\n    )\r\n#else\r\n    \r\nfloat computeShadow(const in bool lighted,\r\n                    const in sampler2D tex,\r\n                    const in vec4 shadowTextureSize,\r\n                    const in mat4 shadowProjectionMatrix,\r\n                    const in mat4 shadowViewMatrix,\r\n                    const in vec4 depthRange,\r\n                    const in float N_Dot_L,\r\n                    const in vec3 vertexWorld,\r\n                    const in float bias\r\n    )\r\n    \r\n#endif\r\n{\r\n                        \r\n    #pragma include "shadowsReceiveMain.glsl" "_PCF" "_NONE"\r\n\r\n}\r\n\r\n'},function(t,e){t.exports="\r\n\r\n\r\nfloat getShadowPCF(const in sampler2D tex, const in vec4 size, const in vec2 uv, const in float shadowZ, const in vec2 biasPCF) {\r\n\r\n    float shadowed = 0.0;\r\n\r\n    #define TSF(off1, off2) getSingleFloatFromTex( tex, uv.xy + vec2(off1, off2) + biasPCF )\r\n\r\n    float dx0 = -size.z;\r\n    float dy0 = -size.w;\r\n    float dx1 = size.z;\r\n    float dy1 = size.w;\r\n\r\n    // fastest but gives banding\r\n#if defined(_PCFx4)\r\n\r\n    vec4 sV;\r\n\r\n    // vector ops faster alu\r\n    sV.x = TSF( dx0, dy0 );\r\n    sV.y = TSF( dx1, dy0 );\r\n    sV.z = TSF( dx1, dy0 );\r\n    sV.w = TSF( dx1, dy1 );\r\n    sV = vec4(lessThan(vec4(shadowZ), sV  ));\r\n    shadowed = dot(sV, vec4(0.25));\r\n\r\n    // here still didn't querying the real shadow at uv.\r\n    // This could be a single func checking for branching\r\n    // like before going to x9, x16 or anything\r\n    // or even complex \"blurring\"\r\n    if (shadowed != 0.0) // we're on an edge\r\n    {\r\n        shadowed += step(shadowZ, TSF(0.0, 0.0));\r\n        shadowed *= 0.5;\r\n    }\r\n\r\n#elif defined(_PCFx9)\r\n\r\n\r\n    mat3 kern;\r\n    mat3 depthKernel;\r\n\r\n\r\n    depthKernel[0][0] = TSF( dx0, dy0 );\r\n    depthKernel[0][1] = TSF( dx0, 0.0 );\r\n    depthKernel[0][2] = TSF( dx0, dy1 );\r\n    depthKernel[1][0] = TSF( 0.0, dy0 );\r\n    depthKernel[1][1] = TSF( 0.0, 0.0 );\r\n    depthKernel[1][2] = TSF( 0.0, dy1 );\r\n    depthKernel[2][0] = TSF( dx1, dy0 );\r\n    depthKernel[2][1] = TSF( dx1, 0.0 );\r\n    depthKernel[2][2] = TSF( dx1, dy1 );\r\n\r\n    // using 4 vector ops to save ALU\r\n    // filter is done post dept/shadow compare\r\n    vec3 shadowZ3 = vec3( shadowZ );\r\n    kern[0] = vec3(lessThan(shadowZ3, depthKernel[0]  ));\r\n    kern[0] *= vec3(0.25);\r\n\r\n    kern[1] = vec3(lessThan(shadowZ3, depthKernel[1] ));\r\n    kern[1] *= vec3(0.25);\r\n\r\n    kern[2] = vec3(lessThan(shadowZ3, depthKernel[2] ));\r\n    kern[2] *= vec3(0.25);\r\n\r\n    vec2 fractCoord = 1.0 - fract( uv.xy );\r\n\r\n    kern[0] = mix( kern[1], kern[0], fractCoord.x );\r\n    kern[1] = mix( kern[2], kern[1], fractCoord.x );\r\n\r\n    vec4 sV;\r\n    sV.x = mix( kern[0][1], kern[0][0], fractCoord.y );\r\n    sV.y = mix( kern[0][2], kern[0][1], fractCoord.y );\r\n    sV.z = mix( kern[1][1], kern[1][0], fractCoord.y );\r\n    sV.w = mix( kern[1][2], kern[1][1], fractCoord.x );\r\n\r\n    shadowed = dot( sV, vec4( 1.0 ) );\r\n\r\n#elif defined(_PCFx16)\r\n\r\n    float dx2 = -2.0 * size.z;\r\n    float dy2 = -2.0 * size.w;\r\n    float dx3 = 2.0 * size.z;\r\n    float dy3 = 2.0 * size.w;\r\n\r\n    shadowed += step(shadowZ , TSF(dx2, dy2));\r\n    shadowed += step(shadowZ , TSF(dx0, dy2));\r\n    shadowed += step(shadowZ , TSF(dx1, dy2));\r\n    shadowed += step(shadowZ , TSF(dx3, dy2));\r\n\r\n    shadowed += step(shadowZ , TSF(dx2, dy0));\r\n    shadowed += step(shadowZ , TSF(dx0, dy0));\r\n    shadowed += step(shadowZ , TSF(dx1, dy0));\r\n    shadowed += step(shadowZ , TSF(dx3, dy0));\r\n\r\n    shadowed += step(shadowZ , TSF(dx2, dy1));\r\n    shadowed += step(shadowZ , TSF(dx0, dy1));\r\n    shadowed += step(shadowZ , TSF(dx1, dy1));\r\n    shadowed += step(shadowZ , TSF(dx3, dy1));\r\n\r\n    shadowed += step(shadowZ , TSF(dx2, dy3));\r\n    shadowed += step(shadowZ , TSF(dx0, dy3));\r\n    shadowed += step(shadowZ , TSF(dx1, dy3));\r\n    shadowed += step(shadowZ , TSF(dx3, dy3));\r\n\r\n    shadowed = shadowed / 16.0;\r\n#endif // pcfx16\r\n    return shadowed;\r\n\r\n}\r\n"},function(t,e){t.exports='\r\n#pragma include "noise.glsl" "_ROTATE_OFFSET"\r\n\r\n#pragma include "shadowLinearSoft.glsl"\r\n\r\nfloat getShadowPCF(const in sampler2D depths, const in vec4 size, const in vec2 uv, const in float compare, const in vec2 biasPCF, const in vec4 clampDimension)\r\n{\r\n\r\n     float res = 0.0;\r\n\r\n#if defined(_ROTATE_OFFSET)\r\n     res += texture2DShadowLerp(depths, size,   uv + size.zw*(noise2D(uv*gl_FragCoord.xy)*2.0 - 1.0) + biasPCF, compare, clampDimension);\r\n#else\r\n     res += texture2DShadowLerp(depths, size,   uv + biasPCF, compare, clampDimension);\r\n#endif\r\n\r\n\r\n#if defined(_PCFx1)\r\n\r\n#else\r\n\r\n    float dx0 = -size.z;\r\n    float dy0 = -size.w;\r\n    float dx1 = size.z;\r\n    float dy1 = size.w;\r\n\r\n#define TSF(o1,o2) texture2DShadowLerp(depths, size, uv + vec2(o1, o2) + biasPCF,  compare, clampDimension)\r\n\r\n    res += TSF(dx0, dx0);\r\n    res += TSF(dx0, .0);\r\n    res += TSF(dx0, dx1);\r\n\r\n#if defined(_PCFx4)\r\n\r\n    res /=4.0;\r\n\r\n#elif defined(_PCFx9)\r\n    res += TSF(.0, dx0);\r\n    res += TSF(.0, dx1);\r\n\r\n    res += TSF(dx1, dx0);\r\n    res += TSF(dx1, .0);\r\n    res += TSF(dx1, dx1);\r\n\r\n\r\n    res /=9.0;\r\n\r\n#elif defined(_PCFx25)\r\n\r\n    float dx02 = -2.0*size.z;\r\n    float dy02 = -2.0*size.w;\r\n    float dx2 = 2.0*size.z;\r\n    float dy2 = 2.0*size.w;\r\n\r\n    // complete row above\r\n    res += TSF(dx0, dx02);\r\n    res += TSF(dx0, dx2);\r\n\r\n    res += TSF(.0, dx02);\r\n    res += TSF(.0, dx2);\r\n\r\n    res += TSF(dx1, dx02);\r\n    res += TSF(dx1, dx2);\r\n\r\n    // two new col\r\n    res += TSF(dx02, dx02);\r\n    res += TSF(dx02, dx0);\r\n    res += TSF(dx02, .0);\r\n    res += TSF(dx02, dx1);\r\n    res += TSF(dx02, dx2);\r\n\r\n    res += TSF(dx2, dx02);\r\n    res += TSF(dx2, dx0);\r\n    res += TSF(dx2, .0);\r\n    res += TSF(dx2, dx1);\r\n    res += TSF(dx2, dx2);\r\n\r\n\r\n    res/=25.0;\r\n\r\n#endif\r\n\r\n#undef TSF\r\n\r\n#endif\r\n    return res;\r\n}\r\n/////// end Tap\r\n'},function(t,e){t.exports="//// hash glsl\r\n\r\n// Dave Hoskins: hash without sin\r\n//https://www.shadertoy.com/view/4djSRW\r\n#define MOD2 vec2(443.8975,397.2973)\r\n//----------------------------------------------------------------------------------------\r\n//  1 out, 1 in...\r\n//note: normalized uniform random, [0;1[\r\nfloat hash11(const in float p)\r\n{\r\n    vec2 p2 = fract(vec2(p) * MOD2);\r\n    p2 += dot(p2.yx, p2.xy+19.19);\r\n    return fract(p2.x * p2.y);\r\n}\r\n//note: normalized uniform random, [0;1[\r\n//  2 out, 1 in...\r\nfloat hash21(const in vec2 p)\r\n{\r\n    vec2 p2 = fract(p * MOD2);\r\n    p2 += dot(p2.yx, p2.xy+19.19);\r\n    return fract(p2.x * p2.y);\r\n}\r\n\r\n\r\n// Based on Morgan McGuire @morgan3d\r\n// https://www.shadertoy.com/view/4dS3Wd\r\n// using Sin\r\n//  1 out, 1 in...\r\nfloat hashSin11( const in float n )\r\n{\r\n    return fract(sin(n)*43758.5453);\r\n}\r\n\r\n//note: normalized uniform random, [0;1[\r\n//  2 out, 1 in...\r\nfloat hashSin21( const in vec2 n ) {\r\n    return fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453);\r\n}\r\n\r\n// note: [-1;1]\r\n// iq: https://www.shadertoy.com/view/Xsl3Dl\r\n// note: value noise\r\n//  2 out, 2 in...\r\nvec2 hashSin22( const in vec2 n )\r\n{\r\n    return fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* vec2(43758.5453,35458.5734));\r\n}\r\n//  3 out, 3 in...\r\nvec3 hashSin33( in vec3 p )\r\n{\r\n    p = vec3( dot(p,vec3(127.1,311.7, 74.7)),\r\n              dot(p,vec3(269.5,183.3,246.1)),\r\n              dot(p,vec3(113.5,271.9,124.6)));\r\n    return fract(sin(p)*43758.5453123);\r\n}\r\n\r\n// Returns a random number based on a vec3 and an int.\r\nfloat hashSin41(const in vec4 seed){\r\n    return fract(sin(dot(seed, vec4(12.9898,78.233,45.164,94.673)) * 43758.5453));\r\n}\r\n\r\n/////// end hash\r\n"},function(t,e){t.exports="vec2 poissonDisk[64];\r\n\r\npoissonDisk[0] = vec2(-0.613392, 0.617481);\r\npoissonDisk[1] = vec2(0.170019, -0.040254);\r\npoissonDisk[2] = vec2(-0.299417, 0.791925);\r\npoissonDisk[3] = vec2(0.645680, 0.493210);\r\npoissonDisk[4] = vec2(-0.651784, 0.717887);\r\npoissonDisk[5] = vec2(0.421003, 0.027070);\r\npoissonDisk[6] = vec2(-0.817194, -0.271096);\r\npoissonDisk[7] = vec2(-0.705374, -0.668203);\r\npoissonDisk[8] = vec2(0.977050, -0.108615);\r\npoissonDisk[9] = vec2(0.063326, 0.142369);\r\npoissonDisk[10] = vec2(0.203528, 0.214331);\r\npoissonDisk[11] = vec2(-0.667531, 0.326090);\r\npoissonDisk[12] = vec2(-0.098422, -0.295755);\r\npoissonDisk[13] = vec2(-0.885922, 0.215369);\r\npoissonDisk[14] = vec2(0.566637, 0.605213);\r\npoissonDisk[15] = vec2(0.039766, -0.396100);\r\npoissonDisk[16] = vec2(0.751946, 0.453352);\r\npoissonDisk[17] = vec2(0.078707, -0.715323);\r\npoissonDisk[18] = vec2(-0.075838, -0.529344);\r\npoissonDisk[19] = vec2(0.724479, -0.580798);\r\npoissonDisk[20] = vec2(0.222999, -0.215125);\r\npoissonDisk[21] = vec2(-0.467574, -0.405438);\r\npoissonDisk[22] = vec2(-0.248268, -0.814753);\r\npoissonDisk[23] = vec2(0.354411, -0.887570);\r\npoissonDisk[24] = vec2(0.175817, 0.382366);\r\npoissonDisk[25] = vec2(0.487472, -0.063082);\r\npoissonDisk[26] = vec2(-0.084078, 0.898312);\r\npoissonDisk[27] = vec2(0.488876, -0.783441);\r\npoissonDisk[28] = vec2(0.470016, 0.217933);\r\npoissonDisk[29] = vec2(-0.696890, -0.549791);\r\npoissonDisk[30] = vec2(-0.149693, 0.605762);\r\npoissonDisk[31] = vec2(0.034211, 0.979980);\r\npoissonDisk[32] = vec2(0.503098, -0.308878);\r\npoissonDisk[33] = vec2(-0.016205, -0.872921);\r\npoissonDisk[34] = vec2(0.385784, -0.393902);\r\npoissonDisk[35] = vec2(-0.146886, -0.859249);\r\npoissonDisk[36] = vec2(0.643361, 0.164098);\r\npoissonDisk[37] = vec2(0.634388, -0.049471);\r\npoissonDisk[38] = vec2(-0.688894, 0.007843);\r\npoissonDisk[39] = vec2(0.464034, -0.188818);\r\npoissonDisk[40] = vec2(-0.440840, 0.137486);\r\npoissonDisk[41] = vec2(0.364483, 0.511704);\r\npoissonDisk[42] = vec2(0.034028, 0.325968);\r\npoissonDisk[43] = vec2(0.099094, -0.308023);\r\npoissonDisk[44] = vec2(0.693960, -0.366253);\r\npoissonDisk[45] = vec2(0.678884, -0.204688);\r\npoissonDisk[46] = vec2(0.001801, 0.780328);\r\npoissonDisk[47] = vec2(0.145177, -0.898984);\r\npoissonDisk[48] = vec2(0.062655, -0.611866);\r\npoissonDisk[49] = vec2(0.315226, -0.604297);\r\npoissonDisk[50] = vec2(-0.780145, 0.486251);\r\npoissonDisk[51] = vec2(-0.371868, 0.882138);\r\npoissonDisk[52] = vec2(0.200476, 0.494430);\r\npoissonDisk[53] = vec2(-0.494552, -0.711051);\r\npoissonDisk[54] = vec2(0.612476, 0.705252);\r\npoissonDisk[55] = vec2(-0.578845, -0.768792);\r\npoissonDisk[56] = vec2(-0.772454, -0.090976);\r\npoissonDisk[57] = vec2(0.504440, 0.372295);\r\npoissonDisk[58] = vec2(0.155736, 0.065157);\r\npoissonDisk[59] = vec2(0.391522, 0.849605);\r\npoissonDisk[60] = vec2(-0.620106, -0.328104);\r\npoissonDisk[61] = vec2(0.789239, -0.419965);\r\npoissonDisk[62] = vec2(-0.545396, 0.538133);\r\npoissonDisk[63] = vec2(-0.178564, -0.596057);\r\n"},function(t,e){t.exports='\r\n\r\n#pragma include "shadowLinearSoft.glsl"\r\n\r\n#pragma include "hash.glsl"\r\n\r\nfloat getShadowPCF(const in sampler2D tex, const in vec4 size, const in vec2 uv, const in float shadowZ, const in vec2 biasPCF) {\r\n\r\n    vec2 o = size.zw;\r\n    float s = 0.0;\r\n\r\n// Not Good, as it needs the lerp things\r\n#pragma include "arrayPoisson.glsl"\r\n\r\n    int idx = 0;\r\n\r\n    // Not Good, as it needs the lerp things\r\n#define TSF_BASE(p, m) texture2DShadowLerp(tex, size, uv + m*poissonDisk[p]*o + biasPCF,  shadowZ)\r\n\r\n// fixed pattern in the shadow, no noise\r\n#define TSF_FIXED(i) TSF_BASE(i, 1.0)\r\n\r\n    // rand  using screenpos: No banding,"moves" camera\r\n#define TSF_SCREEN(i) TSF_BASE(i, hashSin22( float(i)*gl_FragCoord.xy ))\r\n\r\n//rand using worl proj +depth as world psace xyez\r\n#define TSF_SPACE(i)  TSF_BASE(i, hashSin41(vec4(uv.xy, shadowZ, float(i))))\r\n\r\n#define TSF(k) TSF_SPACE(k)\r\n\r\n\r\n    s += TSF(1);\r\n    s += TSF(2);\r\n    s += TSF(3);\r\n    s += TSF(4);\r\n\r\n#ifdef _PCFx4\r\n    const float kernSize = 4.;\r\n#else\r\n    s += TSF(5);\r\n    s += TSF(6);\r\n    s += TSF(7);\r\n    s += TSF(8);\r\n#ifdef _PCFx9\r\n    const float kernSize = 8.;\r\n#else\r\n    s += TSF(9);\r\n    s += TSF(10);\r\n    s += TSF(11);\r\n    s += TSF(12);\r\n    s += TSF(13);\r\n    s += TSF(14);\r\n    s += TSF(15);\r\n    s += TSF(16);\r\n#ifdef _PCFx16\r\n    const float kernSize = 16.;\r\n#else\r\n    s += TSF(17);\r\n    s += TSF(18);\r\n    s += TSF(19);\r\n    s += TSF(20);\r\n    s += TSF(21);\r\n    s += TSF(22);\r\n    s += TSF(23);\r\n    s += TSF(24);\r\n    s += TSF(25);\r\n#ifdef _PCFx25\r\n    const float kernSize = 25.;\r\n#else\r\n    s += TSF(26);\r\n    s += TSF(27);\r\n    s += TSF(28);\r\n    s += TSF(29);\r\n    s += TSF(30);\r\n    s += TSF(31);\r\n    s += TSF(32);\r\n#ifdef _PCFx32\r\n    const float kernSize = 32.;\r\n#endif // 32\r\n#endif // 25\r\n#endif // 16\r\n#endif // 8\r\n#endif // 4\r\n\r\n    s /= kernSize;\r\n    return s;\r\n}\r\n// end poisson\r\n#undef TSF\r\n'},function(t,e){t.exports='////////////////////////////////////////////////\r\n// ESM\r\nfloat fetchESM(const in sampler2D tex, const in vec4 shadowMapSize, const in vec2 shadowUV, const in float shadowZ,  const in float exponent0, const in float exponent1) {\r\n\r\n\r\n#if defined(_FLOATTEX) && (!defined(_FLOATLINEAR))\r\n    // emulate bilinear filtering (not needed if webgm/GPU support filtering FP32/FP16 textures)\r\n    vec2 unnormalized = shadowUV * shadowMapSize.xy;\r\n    vec2 fractional = fract(unnormalized);\r\n    unnormalized = floor(unnormalized);\r\n\r\n    vec4 occluder4;\r\n    occluder4.x = getSingleFloatFromTex(tex, (unnormalized + vec2( -0.5,  0.5 ))* shadowMapSize.zw );\r\n    occluder4.y = getSingleFloatFromTex(tex, (unnormalized + vec2( 0.5,   0.5 ))* shadowMapSize.zw );\r\n    occluder4.z = getSingleFloatFromTex(tex, (unnormalized + vec2( 0.5,  -0.5 ))* shadowMapSize.zw );\r\n    occluder4.w = getSingleFloatFromTex(tex, (unnormalized + vec2( -0.5, -0.5 ))* shadowMapSize.zw );\r\n\r\n    float occluder = (occluder4.w + (occluder4.x - occluder4.w) * fractional.y);\r\n    occluder = occluder + ((occluder4.z + (occluder4.y - occluder4.z) * fractional.y) - occluder)*fractional.x;\r\n\r\n#else\r\n    float occluder = getSingleFloatFromTex(tex, shadowUV);\r\n#endif\r\n\r\n\r\n    // we\'re on an edge\r\n    float depthScale = exponent1;\r\n    float over_darkening_factor = exponent0;\r\n    float receiver = depthScale * ( shadowZ);\r\n    return 1.0 - clamp(over_darkening_factor*(occluder*exp(receiver)), 0.0, 1.0);\r\n}\r\n\r\n\r\nfloat computeShadow(const in bool lighted,\r\n                    const in sampler2D tex,\r\n                    const in vec4 shadowMapSize,\r\n                    const in mat4 shadowProjectionMatrix,\r\n                    const in mat4 shadowViewMatrix,\r\n                    const in vec4 depthRange,\r\n                    const in float N_Dot_L,\r\n                    const in vec3 vertexWorld,\r\n                    const in float bias,\r\n                    const in float exponent0,\r\n                    const in float exponent1\r\n    )\r\n{\r\n    #pragma include "shadowsReceiveMain.glsl" "_ESM"\r\n}\r\n\r\n// end ESM\r\n';
},function(t,e){t.exports='//////VSM\r\n//http://en.wikipedia.org/wiki/Chebyshev%27s_inequality\r\nfloat chebychevInequality (const in vec2 moments, const in float t)\r\n{\r\n    // No shadow if depth of fragment is in front\r\n    if ( t <= moments.x )\r\n        return 1.0;\r\n\r\n    // Calculate variance, which is actually the amount of\r\n    // error due to precision loss from fp32 to RG/BA\r\n    // (moment1 / moment2)\r\n    float variance = moments.y - (moments.x * moments.x);\r\n    variance = max(variance, 0.02);\r\n\r\n    // Calculate the upper bound\r\n    float d = t - moments.x;\r\n    return variance / (variance + d * d);\r\n}\r\n\r\n// http://http.developer.nvidia.com/GPUGems3/gpugems3_ch08.html\r\nfloat chebyshevUpperBound(const in vec2 moments, const in float mean, const in float minVariance)\r\n{\r\n    float d = mean - moments.x;\r\n    if ( d <= 0.0 )\r\n        return 1.0;\r\n    // Compute variance\r\n    float variance = moments.y - (moments.x * moments.x);\r\n    variance = max(variance, minVariance);\r\n\r\n    // Compute probabilistic upper bound\r\n    //p represent an upper bound on the visibility percentage of the receiver. This value //attempts to estimate how much of the distribution of occluders at the surface location is //beyond the surface\'s distance from the light. If it is 0, then there is no probability //that the fragment is partially lit, so it will be fully in shadow. If it is a value in the //[0, 1] range, it represent the penumbrae value of the shadow edge.\r\n    float p = smoothstep(mean, mean, moments.x);\r\n\r\n    // Remove the [0, Amount] tail and linearly rescale (Amount, 1].\r\n    /// light bleeding when shadows overlap.\r\n\r\n    float pMax = smoothstep(0.2, 1.0, variance / (variance + d*d));\r\n    // One-tailed chebyshev\r\n    return clamp(max(p, pMax), 0.0, 1.0);\r\n}\r\n\r\n// might be included for EVSM\r\n#ifdef _VSM\r\nfloat computeShadow(const in bool lighted,\r\n                    const in sampler2D tex,\r\n                    const in vec4 shadowMapSize,\r\n                    const in mat4 shadowProjectionMatrix,\r\n                    const in mat4 shadowViewMatrix,\r\n                    const in vec4 depthRange,\r\n                    const in float N_Dot_L,\r\n                    const in vec3 vertexWorld,\r\n                    const in float bias,\r\n                    const in float epsilonVSM\r\n    )\r\n{\r\n#pragma include "shadowsReceiveMain.glsl" "_VSM"\r\n}\r\n#endif // _VSM\r\n\r\n// end VSM\r\n'},function(t,e){t.exports='// EVSM\r\n\r\n#pragma include "vsm.glsl"\r\n\r\n// Convert depth to EVSM coefficients\r\n// Input depth should be in [0, 1]\r\nvec2 warpDepth(const in float depth, const in vec2 exponents)\r\n{\r\n    float pos =  exp( exponents.x * depth);\r\n    float neg = -exp(-exponents.y * depth);\r\n    return vec2(pos, neg);\r\n}\r\n\r\n\r\nfloat computeShadow(const in bool lighted,\r\n                    const in sampler2D tex,\r\n                    const in vec4 shadowMapSize,\r\n                    const in mat4 shadowProjectionMatrix,\r\n                    const in mat4 shadowViewMatrix,\r\n                    const in vec4 depthRange,\r\n                    const in float N_Dot_L,\r\n                    const in vec3 vertexWorld,\r\n                    const in float bias,\r\n                    const in float epsilonVSM,\r\n                    const in float exponent0,\r\n                    const in float exponent1\r\n    )\r\n{\r\n    #pragma include "shadowsReceiveMain.glsl" "_EVSM"\r\n}\r\n\r\n// _EVSM\r\n'},function(t,e,i){"use strict";var r=[i(172),i(203),i(205),i(206),i(207),i(208),i(209)],n={};r.forEach(function(t){window.Object.keys(t).forEach(function(e){var i=t[e];if(void 0!==this[e])throw"duplicate entry in node library";this[e]=i},this)},n),t.exports=n},function(t,e,i){"use strict";var r=i(6),n=i(173),a=i(204),s=function(){a.call(this)},o=function(t){return"vec4"===t.getType()?t.getVariable()+".rgb":t};s.prototype=r.objectInherit(a.prototype,{type:"Morph",validInputs:["weights","vertex","target0"],validOutputs:["out"],globalFunctionDeclaration:function(){var t=window.Object.keys(this._inputs).length-2,e=0,i="vec3 morphTransform( const in vec4 weights,  const in vec3 vertex, const in vec3 target0";for(e=1;e<t;++e)i+=", const in vec3 target"+e;if(i+=" ) { \n",1===t)i+="return mix(vertex, target0, weights[0])";else{for(i+="\tvec3 vecOut = vertex * (1.0 - ( weights[0]",e=1;e<t;++e)i+=" + weights["+e+"]";for(i+="));\n",e=0;e<t;++e)i+="\tvecOut += target"+e+" * weights["+e+"];\n";i+="\treturn vecOut"}return i+=";\n}\n"},computeShader:function(){for(var t=this._inputs,e=[t.weights,o(t.vertex)],i=0;i<4&&t["target"+i];i++)e.push(o(t["target"+i]));return n.callFunction("morphTransform",this._outputs.out,e)}}),t.exports={Morph:s}},function(t,e,i){"use strict";var r=i(10),n=0,a=function(){this._name="AbstractNode",this._inputs=[],this._outputs=null,this._id=n++,this._text=void 0};a.prototype={getID:function(){return this._id},getName:function(){return this._name},getType:function(){return this.type},toString:function(){var t="name : "+this._name;return this.type&&(t+=" ("+this.type+")"),t},getInputs:function(){return this._inputs},getOutputs:function(){return this._outputs},checkInputsOutputs:function(){var t,e;if(this.validInputs)for(t=0;t<this.validInputs.length;t++)if(e=this.validInputs[t],!this._inputs[e])return r.error("Shader node "+this.type+" validation error input "+e+" is missing"),!1;if(this.validOutputs)for(t=0;t<this.validOutputs.length;t++)if(e=this.validOutputs[t],!this._outputs[e])return r.error("Shader node "+this.type+" validation error output "+e+" is missing"),!1;return!0},inputs:function(){for(var t=0,e=arguments.length;t<e;t++){var i=arguments[t];if(!i){r.error("Shader node "+this.type+" input number "+e+" is undefined ");break}if(Array.isArray(i))return this.inputs.apply(this,i),this;if("object"==typeof i&&null!==i&&i instanceof a==!1)return this._inputs=i,this;this._inputs.push(i)}return this},outputs:function(t){if(this._outputs=t,this._outputs instanceof a==!0)this.autoLink(this._outputs);else for(var e=window.Object.keys(this._outputs),i=0;i<e.length;i++){var r=e[i];this.autoLink(this._outputs[r])}return this},autoLink:function(t){return void 0===t?this:(t.inputs(this),this)},computeShader:function(){return this._text},comment:function(t){this._comment="//"+t},getComment:function(){return this._comment}},t.exports=a},function(t,e,i){"use strict";var r=i(6),n=i(173),a=i(204),s=n.sprintf,o=function(t,e){a.call(this),this._name="Variable",this._prefix=e,this._type=t,this._value=void 0};o.prototype=r.objectInherit(a.prototype,{getType:function(){return this._type},getVariable:function(){return this._prefix},setValue:function(t){return this._value=t,this},toString:function(){var t="prefix : "+this._prefix;return t+=", name : "+this._prefix,this.type&&(t+=" ("+this.type+")"),t},declare:function(){return void 0!==this._value?s("%s %s = %s;",[this._type,this.getVariable(),this._value]):s("%s %s;",[this._type,this.getVariable()])},isEmpty:function(){return void 0===this._value&&0===this._inputs.length},reset:function(){this._inputs=[],this._outputs=null,this._value=void 0,this._text=void 0}});var h=function(t,e){o.call(this,t,e)};h.prototype=r.objectInherit(o.prototype,{declare:function(){return s("const %s %s = %s;",[this._type,this.getVariable(),this._value])}});var u=function(t,e,i){o.call(this,t,e),this._size=i};u.prototype=r.objectInherit(o.prototype,{declare:function(){},globalDeclaration:function(){return this._size?s("uniform %s %s[%s];",[this._type,this.getVariable(),this._size]):s("uniform %s %s;",[this._type,this.getVariable()])}});var c=function(t,e){o.call(this,t,e)};c.prototype=r.objectInherit(o.prototype,{declare:function(){},globalDeclaration:function(){return s("attribute %s %s;",[this._type,this.getVariable()])}});var l=function(t,e){o.call(this,t,e)};l.prototype=r.objectInherit(o.prototype,{declare:function(){},globalDeclaration:function(){return s("varying %s %s;",[this._type,this.getVariable()])}});var d=function(t,e){o.call(this,t,e)};d.prototype=r.objectInherit(o.prototype,{declare:function(){},globalDeclaration:function(){return s("uniform %s %s;",[this._type,this.getVariable()])}});var f=function(t,e){o.call(this,t,e)};f.prototype=r.objectInherit(o.prototype,{_unique:!0,isUnique:function(){return this._unique},outputs:function(){return this},getVariable:function(){return this._prefix}});var p=function(){f.call(this,"vec4","gl_FragColor"),this._name="glFragColor"};p.prototype=r.objectInherit(f.prototype,{});var _=function(){f.call(this,"vec4","gl_Position"),this._name="glPosition"};_.prototype=r.objectInherit(f.prototype,{});var g=function(){f.call(this,"float","gl_PointSize"),this._name="glPointSize"};g.prototype=r.objectInherit(f.prototype,{}),t.exports={Output:f,glPointSize:g,glPosition:_,glFragColor:p,Sampler:d,Variable:o,Constant:h,Attribute:c,Varying:l,Uniform:u}},function(t,e,i){"use strict";var r=i(6),n=i(173),a=i(204),s=function(){a.call(this)};s.prototype=r.objectInherit(a.prototype,{type:"TextureAbstractNode",functionName:"noTextureFunction",validInputs:["sampler","uv"],validOutputs:["color"],computeShader:function(){return n.callFunction(this.functionName,this._outputs.color,[this._inputs.sampler,this._inputs.uv.getVariable()+".xy"])},globalFunctionDeclaration:function(){return'#pragma include "textures.glsl"'}});var o=function(){s.call(this)};o.prototype=r.objectInherit(s.prototype,{type:"TextureRGB",functionName:"textureRGB"});var h=function(){o.call(this)};h.prototype=r.objectInherit(o.prototype,{type:"TextureRGBA",functionName:"textureRGBA"});var u=function(){o.call(this)};u.prototype=r.objectInherit(o.prototype,{type:"TextureAlpha",functionName:"textureAlpha"});var c=function(){o.call(this)};c.prototype=r.objectInherit(o.prototype,{type:"TextureIntensity",functionName:"textureIntensity"}),t.exports={NodeTextures:s,TextureRGB:o,TextureRGBA:h,TextureAlpha:u,TextureIntensity:c}},function(t,e,i){"use strict";var r=i(6),n=i(173),a=i(204),s=n.sprintf,o=function(){a.call(this)};o.prototype=r.objectInherit(a.prototype,{globalFunctionDeclaration:function(){return'#pragma include "functions.glsl"'}});var h=function(){o.call(this)};h.prototype=r.objectInherit(o.prototype,{type:"Normalize",validInputs:["vec"],validOuputs:["vec"],computeShader:function(){return n.callFunction("normalize",this._outputs.vec,[this._inputs.vec])}});var u=function(){o.call(this)};u.prototype=r.objectInherit(o.prototype,{type:"sRGBToLinear",validInputs:["color"],validOuputs:["color"],computeShader:function(){return this.computeConversion("sRGBToLinear")},computeConversion:function(t){var e=this._outputs.color,i=this._inputs.color,r=e.getType()!==i.getType()?".rgb":"";return n.callFunction(t,e.getVariable()+r,[i.getVariable()+r])}});var c=function(){u.call(this)};c.prototype=r.objectInherit(u.prototype,{type:"LinearTosRGB",computeShader:function(){return this.computeConversion("linearTosRGB")}});var l=function(){o.call(this)};l.prototype=r.objectInherit(o.prototype,{type:"FrontNormal",validInputs:["normal"],validOuputs:["normal"],computeShader:function(){return s("%s = gl_FrontFacing ? %s : -%s ;",[this._outputs.normal.getVariable(),this._inputs.normal.getVariable(),this._inputs.normal.getVariable()])}});var d=function(t){return t.getType&&"vec4"===t.getType()?t.getVariable()+".rgb":t},f=function(){o.call(this)};f.prototype=r.objectInherit(o.prototype,{type:"EncodeRGBM",validInputs:["color","range"],validOutputs:["color"],computeShader:function(){return n.callFunction("encodeRGBM",this._outputs.color,[d(this._inputs.color),this._inputs.range])}});var p=function(){o.call(this)};p.prototype=r.objectInherit(o.prototype,{type:"DecodeRGBM",validInputs:["color","range"],validOutputs:["color"],computeShader:function(){return n.callFunction("decodeRGBM",this._outputs.color,[this._inputs.color,this._inputs.range])}});var _=function(t){a.call(this),this._defineName=t,this._defineValue=""};_.prototype=r.objectInherit(a.prototype,{type:"Define",setValue:function(t){return this._defineValue=t,this},getDefines:function(){return["#define "+this._defineName+" "+this._defineValue]}}),t.exports={NodeFunctions:o,Normalize:h,sRGBToLinear:u,LinearTosRGB:c,FrontNormal:l,DecodeRGBM:p,EncodeRGBM:f,Define:_}},function(t,e,i){"use strict";var r=i(6),n=i(173),a=i(204),s=function(){a.call(this)};s.prototype=r.objectInherit(a.prototype,{validOutputs:["color"],globalFunctionDeclaration:function(){return'#pragma include "lights.glsl"'}});var o=function(t){return"vec4"===t.getType()?t.getVariable()+".rgb":t},h=function(){s.call(this)};h.prototype=r.objectInherit(s.prototype,{type:"PointLight",validInputs:["normal","eyeVector","materialambient","materialdiffuse","materialspecular","materialshininess","lightambient","lightdiffuse","lightspecular","lightposition","lightattenuation","lightmatrix","lighted","lightEyePos","lightEyeDir","lightNDL"],computeShader:function(){return n.callFunction("computePointLightShading",this._outputs.color,[this._inputs.normal,this._inputs.eyeVector,o(this._inputs.materialambient),o(this._inputs.materialdiffuse),o(this._inputs.materialspecular),this._inputs.materialshininess,o(this._inputs.lightambient),o(this._inputs.lightdiffuse),o(this._inputs.lightspecular),this._inputs.lightposition,this._inputs.lightattenuation,this._inputs.lightmatrix,this._inputs.lightEyePos,this._inputs.lightEyeDir,this._inputs.lightNDL,this._inputs.lighted])}});var u=function(){s.call(this)};u.prototype=r.objectInherit(s.prototype,{type:"SpotLight",validInputs:["normal","eyeVector","materialambient","materialdiffuse","materialspecular","materialshininess","lightambient","lightdiffuse","lightspecular","lightdirection","lightattenuation","lightposition","lightspotCutOff","lightspotBlend","lightmatrix","lightinvMatrix","lighted","lightEyePos","lightEyeDir","lightNDL"],computeShader:function(){return n.callFunction("computeSpotLightShading",this._outputs.color,[this._inputs.normal,this._inputs.eyeVector,o(this._inputs.materialambient),o(this._inputs.materialdiffuse),o(this._inputs.materialspecular),this._inputs.materialshininess,o(this._inputs.lightambient),o(this._inputs.lightdiffuse),o(this._inputs.lightspecular),this._inputs.lightdirection,this._inputs.lightattenuation,this._inputs.lightposition,this._inputs.lightspotCutOff,this._inputs.lightspotBlend,this._inputs.lightmatrix,this._inputs.lightinvMatrix,this._inputs.lightEyePos,this._inputs.lightEyeDir,this._inputs.lightNDL,this._inputs.lighted])}});var c=function(){s.call(this)};c.prototype=r.objectInherit(s.prototype,{type:"SunLight",validInputs:["normal","eyeVector","materialambient","materialdiffuse","materialspecular","materialshininess","lightambient","lightdiffuse","lightspecular","lightposition","lightmatrix","lighted","lightEyeDir","lightNDL"],computeShader:function(){return n.callFunction("computeSunLightShading",this._outputs.color,[this._inputs.normal,this._inputs.eyeVector,o(this._inputs.materialambient),o(this._inputs.materialdiffuse),o(this._inputs.materialspecular),this._inputs.materialshininess,o(this._inputs.lightambient),o(this._inputs.lightdiffuse),o(this._inputs.lightspecular),this._inputs.lightposition,this._inputs.lightmatrix,this._inputs.lightEyeDir,this._inputs.lightNDL,this._inputs.lighted])}});var l=function(){s.call(this)};l.prototype=r.objectInherit(s.prototype,{type:"HemiLight",validInputs:["normal","eyeVector","materialdiffuse","materialspecular","materialshininess","lightdiffuse","lightground","lightposition","lightmatrix","lighted","lightEyeDir","lightNDL"],computeShader:function(){return n.callFunction("computeHemiLightShading",this._outputs.color,[this._inputs.normal,this._inputs.eyeVector,o(this._inputs.materialdiffuse),o(this._inputs.materialspecular),this._inputs.materialshininess,o(this._inputs.lightdiffuse),o(this._inputs.lightground),this._inputs.lightposition,this._inputs.lightmatrix,this._inputs.lightEyeDir,this._inputs.lightNDL,this._inputs.lighted])}}),t.exports={PointLight:h,SpotLight:u,SunLight:c,HemiLight:l}},function(t,e,i){"use strict";var r=i(10),n=i(6),a=i(204),s=i(173),o=s.sprintf,h=function(){a.call(this)};h.prototype=a.prototype;var u=function(){h.call(this)};u.prototype=n.objectInherit(h.prototype,{type:"Add",operator:"+",computeShader:function(){var t=this._outputs.getType(),e="";"vec4"===t?e=".rgba":"vec3"===t?e=".rgb":"vec2"===t&&(e=".rg");for(var i=this._outputs.getVariable()+" = "+this._inputs[0].getVariable()+e,r=1,n=this._inputs.length;r<n;r++){var a=this._inputs[r];i+=this.operator+a.getVariable(),"float"!==a.getType()&&(i+=e)}return i+=";"}});var c=function(){u.call(this)};c.prototype=n.objectInherit(u.prototype,{type:"Mult",operator:"*"});var l=function(){u.call(this)};l.prototype=n.objectInherit(u.prototype,{type:"SetFromNode"});var d=function(){u.call(this),this._overwriteW=!0,this._forceComplement=!0,this._inverseOp=!1};d.prototype=n.objectInherit(u.prototype,{type:"MatrixMultDirection",operator:"*",validInputs:["vec","matrix"],validOutputs:["vec"],complement:"0.",setInverse:function(t){return this._inverseOp=t,this},setForceComplement:function(t){return this._forceComplement=t,this},setOverwriteW:function(t){return this._overwriteW=t,this},computeShader:function(){var t=this._inputs.vec.getVariable(),e=this._inputs.matrix.getVariable(),i=this._outputs.vec.getVariable(),r=this._inputs.vec.getType(),n=this._outputs.vec.getType(),a=i+" = ";"vec4"!==n&&(a+=n+"(");var s=t;return(this._forceComplement||"vec4"!==r)&&(s="vec4("+t+".xyz, "+this.complement+")"),a+=this._inverseOp?s+this.operator+e:e+this.operator+s,"vec4"!==n&&(a+=")"),a+=";",this._overwriteW||"vec4"!==r||(a+="\n"+i+".a = "+t+".a;"),a}});var f=function(){d.call(this),this._forceComplement=!1};f.prototype=n.objectInherit(d.prototype,{type:"MatrixMultPosition",complement:"1."});var p=function(){a.call(this)};p.prototype=n.objectInherit(a.prototype,{type:"InlineCode",code:function(t){return this._text=t,this},computeShader:function(){var t=n.objectMix({},this._inputs);t=n.objectMix(t,this._outputs);for(var e=new RegExp("%[A-Za-z0-9_]+","gm"),i=this._text,a=this._text.match(e),s=new Set,o=0;o<a.length;o++){var h=a[o].substr(1);if(!s.has(h)){t[h]||(r.error("error with inline code\n"+this._text),r.error("input "+h+" not provided for "+a[o]));var u=new RegExp(a[o].toString(),"gm");i=i.replace(u,t[h].getVariable()),s.add(h)}}return i}});var _=function(){h.call(this)};_.prototype=n.objectInherit(h.prototype,{type:"SetAlpha",validInputs:["color","alpha"],validOuputs:["color"],computeShader:function(){var t=this._inputs.alpha;return o("%s = vec4( %s.rgb, %s );",[this._outputs.color.getVariable(),this._inputs.color.getVariable(),"float"!==t.getType()?t.getVariable()+".a":t.getVariable()])}});var g=function(){h.call(this)};g.prototype=n.objectInherit(h.prototype,{type:"PreMultAlpha",validInputs:["color"],validOuputs:["color"],computeShader:function(){var t,e=void 0!==this._inputs.alpha?this._inputs.alpha:this._inputs.color;return t="float"!==e.getType()?e.getVariable()+".a":e.getVariable(),o("%s.rgb = %s.rgb * %s;",[this._outputs.color.getVariable(),this._inputs.color.getVariable(),t])}}),t.exports={BaseOperator:h,Mult:c,MatrixMultPosition:f,MatrixMultDirection:d,Add:u,InlineCode:p,SetAlpha:_,SetFromNode:l,PreMultAlpha:g}},function(t,e,i){"use strict";var r=i(6),n=i(173),a=i(204),s=function(){a.call(this)};s.prototype=r.objectInherit(a.prototype,{type:"ShadowReceiveNode",validInputs:["lighted","shadowTexture","shadowTextureProjectionMatrix","shadowTextureViewMatrix","shadowTextureDepthRange","lightNDL","vertexWorld","shadowbias"],validOutputs:["float"],globalFunctionDeclaration:function(){return'#pragma include "shadowsReceive.glsl"'},setShadowAttribute:function(t){this._shadow=t},getDefines:function(){return this._shadow.getDefines()},getExtensions:function(){return this._shadow.getExtensions()},computeShader:function(){var t=this._inputs,e=[t.lighted,t.shadowTexture];this._shadow.getAtlas()&&e.push(t.shadowTextureMapSize),e=e.concat([t.shadowTextureRenderSize,t.shadowTextureProjectionMatrix,t.shadowTextureViewMatrix,t.shadowTextureDepthRange,t.lightNDL,t.vertexWorld,t.shadowbias]);var i=this._shadow.getAlgorithm();return"ESM"===i?(e.push(this._inputs.shadowexponent0),e.push(this._inputs.shadowexponent1)):"EVSM"===i?(e.push(this._inputs.shadowepsilonVSM),e.push(this._inputs.shadowexponent0),e.push(this._inputs.shadowexponent1)):"VSM"===i&&e.push(this._inputs.shadowepsilonVSM),n.callFunction("computeShadow",this._outputs.float,e)}});var o=function(){a.call(this)};o.prototype=r.objectInherit(a.prototype,{type:"ShadowCast",validInputs:["exponent0","exponent1","shadowDepthRange","fragEye"],validOutputs:["color"],globalFunctionDeclaration:function(){return'#pragma include "shadowsCastFrag.glsl"'},setShadowCastAttribute:function(t){return this._shadowCast=t,this},getDefines:function(){return this._shadowCast.getDefines()},computeShader:function(){var t=this._inputs,e=this._shadowCast.getAlgorithm();return"NONE"===e||"PCF"===e?n.callFunction("computeShadowDepth",this._outputs.color,[t.fragEye,t.shadowDepthRange]):n.callFunction("computeShadowDepth",this._outputs.color,[t.fragEye,t.shadowDepthRange,t.exponent0,t.exponent1])}}),t.exports={ShadowCast:o,ShadowReceive:s}},function(t,e,i){"use strict";var r=i(6),n=i(173),a=i(204),s=function(){a.apply(this)};s.prototype=r.objectInherit(a.prototype,{type:"Billboard",validInputs:["Vertex","ModelViewMatrix","ProjectionMatrix"],validOutputs:["vec"],globalFunctionDeclaration:function(){return'#pragma include "billboard.glsl"'},computeShader:function(){return n.callFunction("billboard",this._outputs.vec,[this._inputs.Vertex,this._inputs.ModelViewMatrix,this._inputs.ProjectionMatrix])}}),t.exports={Billboard:s}},function(t,e,i){"use strict";var r=i(10),n={createVertexShader:function(){this._fragmentShaderMode=!1;var t=this.declareVertexMain(),e=this.getVertexShaderName();e&&t.push(this.getNode("Define","SHADER_NAME").setValue(e));var i=this.createShaderFromGraphs(t);return r.debug(i),i},declareVertexMain:function(){var t=[this.declarePointSize(),this.declareVertexPosition()];return this.declareVertexVaryings(t),t},declarePointSize:function(){var t=this.getNode("glPointSize");return this._pointSizeAttribute&&this._pointSizeAttribute.isEnabled()?(this.getNode("InlineCode").code("%pointSize = min(64.0, max(1.0, -%size / %position.z));").inputs({position:this.getOrCreateViewVertex(),size:this.getOrCreateUniform("float","uPointSize")}).outputs({pointSize:t}),t):(this.getNode("SetFromNode").inputs(this.getOrCreateConstantOne("float")).outputs(t),t)},declareVertexVaryings:function(t){var e=this._varyings;e.vModelVertex&&this.getNode("SetFromNode").inputs(this.getOrCreateModelVertex()).outputs(e.vModelVertex),e.vModelNormal&&this.getNode("SetFromNode").inputs(this.getOrCreateModelNormal()).outputs(e.vModelNormal),e.vModelTangent&&this.getNode("SetFromNode").inputs(this.getOrCreateModelTangent()).outputs(e.vModelTangent),e.vViewVertex&&this.getNode("SetFromNode").inputs(this.getOrCreateViewVertex()).outputs(e.vViewVertex),e.vViewNormal&&this.getNode("SetFromNode").inputs(this.getOrCreateViewNormal()).outputs(e.vViewNormal),e.vViewTangent&&this.getNode("SetFromNode").inputs(this.getOrCreateViewTangent()).outputs(e.vViewTangent),e.vVertexColor&&this.getNode("InlineCode").code("%vcolor = %venabled == 1.0 ? %acolor : vec4(1.0, 1.0, 1.0, 1.0);").inputs({venabled:this.getOrCreateUniform("float","uArrayColorEnabled"),acolor:this.getOrCreateAttribute("vec4","Color")}).outputs({vcolor:this.getOrCreateVarying("vec4","vVertexColor")});for(var i=window.Object.keys(e),r=0,n=i.length;r<n;r++){var a=e[i[r]];t.push(a);var s=a.getVariable();s.indexOf("vTexCoord")!==-1&&this.getNode("SetFromNode").inputs(this.getOrCreateAttribute("vec2",s.substring(1))).outputs(a)}},declareVertexPosition:function(){var t=this.getNode("glPosition");return this._isBillboard?this.declareVertexTransformBillboard(t):this.declareScreenVertex(t),t},getOrCreateModelVertex:function(){var t=this._variables.modelVertex;return t?t:(t=this.createVariable("vec3","modelVertex"),this.getNode("MatrixMultPosition").inputs({matrix:this.getOrCreateUniform("mat4","uModelMatrix"),vec:this.getOrCreateLocalVertex()}).outputs({vec:t}),t)},getOrCreateModelNormal:function(){var t=this._variables.modelNormal;return t?t:(t=this.createVariable("vec3","modelNormal"),this.getNode("MatrixMultDirection").inputs({matrix:this.getOrCreateUniform("mat4","uModelMatrix"),vec:this.getOrCreateLocalNormal()}).outputs({vec:t}),t)},getOrCreateModelTangent:function(){var t=this._variables.modelTangent;return t?t:(t=this.createVariable("vec4","modelTangent"),this.getNode("MatrixMultDirection").setOverwriteW(!1).inputs({matrix:this.getOrCreateUniform("mat4","uModelMatrix"),vec:this.getOrCreateLocalTangent()}).outputs({vec:t}),t)},getOrCreateViewVertex:function(){var t=this._variables.viewVertex;return t?t:(t=this.createVariable("vec4","viewVertex"),this.getNode("MatrixMultPosition").inputs({matrix:this.getOrCreateUniform("mat4","uModelViewMatrix"),vec:this.getOrCreateLocalVertex()}).outputs({vec:t}),t)},getOrCreateViewNormal:function(){var t=this._variables.viewNormal;return t?t:(t=this.createVariable("vec3","viewNormal"),this.getNode("MatrixMultDirection").inputs({matrix:this.getOrCreateUniform("mat4","uModelViewNormalMatrix"),vec:this.getOrCreateLocalNormal()}).outputs({vec:t}),t)},getOrCreateViewTangent:function(){var t=this._variables.viewTangent;return t?t:(t=this.createVariable("vec4","viewTangent"),this.getNode("MatrixMultDirection").setOverwriteW(!1).inputs({matrix:this.getOrCreateUniform("mat4","uModelViewNormalMatrix"),vec:this.getOrCreateLocalTangent()}).outputs({vec:t}),t)},declareScreenVertex:function(t){this.getNode("MatrixMultPosition").inputs({matrix:this.getOrCreateProjectionMatrix(),vec:this.getOrCreateViewVertex()}).outputs({vec:t})},declareVertexTransformBillboard:function(t){this.getNode("Billboard").inputs({Vertex:this.getOrCreateAttribute("vec3","Vertex"),ModelViewMatrix:this.getOrCreateUniform("mat4","uModelViewMatrix"),ProjectionMatrix:this.getOrCreateUniform("mat4","uProjectionMatrix")}).outputs({vec:t})},getOrCreateBoneMatrix:function(){var t=this._variables.boneMatrix;if(t)return t;t=this.createVariable("mat4","boneMatrix");var e=this.getOrCreateAttribute("vec4","Weights"),i=this.getOrCreateAttribute("vec4","Bones"),r=this.getOrCreateUniform("vec4","uBones",this._skinningAttribute.getBoneUniformSize());return this.getNode("Skinning").inputs({weights:e,bonesIndex:i,matrixPalette:r}).outputs({mat4:t}),t},getTarget:function(t,e){var i=t.indexOf("Tangent")!==-1?"vec4":"vec3";return this.getOrCreateAttribute(i,t+"_"+e)},morphTangentApproximation:function(t,e){var i=this.getOrCreateLocalNormal();return this._skinningAttribute&&(i=this.createVariable("vec3"),this.getNode("Normalize").inputs({vec:this.getOrCreateMorphNormal()}).outputs({vec:i})),this.getNode("InlineCode").code("%out = %tangent.rgb - dot(%tangent.rgb, %normal) * %normal;").inputs({tangent:t,normal:i}).outputs({out:e}),e},morphTransformVec3:function(t,e){for(var i={vertex:t,weights:this.getOrCreateUniform("vec4","uTargetWeights")},r=this._morphAttribute.getNumTargets(),n=0;n<r;n++)i["target"+n]=this.getTarget(t.getVariable(),n);return this.getNode("Morph").inputs(i).outputs({out:e}),e},skinTransformVertex:function(t,e){return this.getNode("MatrixMultPosition").setInverse(!0).inputs({matrix:this.getOrCreateBoneMatrix(),vec:t}).outputs({vec:e}),e},skinTransformNormal:function(t,e){return this.getNode("MatrixMultDirection").setInverse(!0).inputs({matrix:this.getOrCreateBoneMatrix(),vec:t}).outputs({vec:e}),e},getOrCreateMorphVertex:function(){var t=this.getVariable("morphVertex");if(t)return t;var e=this.getOrCreateAttribute("vec3","Vertex");return this._morphAttribute&&this._morphAttribute.hasTarget("Vertex")?this.morphTransformVec3(e,this.createVariable("vec3","morphVertex")):e},getOrCreateMorphNormal:function(){var t=this.getVariable("morphNormal");if(t)return t;var e=this.getOrCreateAttribute("vec3","Normal");return this._morphAttribute&&this._morphAttribute.hasTarget("Normal")?this.morphTransformVec3(e,this.createVariable("vec3","morphNormal")):e},getOrCreateMorphTangent:function(){var t=this.getVariable("morphTangent");if(t)return t;var e=this.getOrCreateAttribute("vec4","Tangent"),i=this._morphAttribute&&this._morphAttribute.hasTarget("Tangent");return i?this.morphTransformVec3(e,this.createVariable("vec3","morphTangent")):e},getOrCreateSkinVertex:function(){var t=this.getVariable("skinVertex");if(t)return t;var e=this.getOrCreateMorphVertex();return this._skinningAttribute?this.skinTransformVertex(e,this.createVariable("vec3","skinVertex")):e},getOrCreateSkinNormal:function(){var t=this.getVariable("skinNormal");if(t)return t;var e=this.getOrCreateMorphNormal();return this._skinningAttribute?this.skinTransformNormal(e,this.createVariable("vec3","skinNormal")):e},getOrCreateSkinTangent:function(){var t=this.getVariable("skinTangent");if(t)return t;var e=this.getOrCreateMorphTangent();return this._skinningAttribute?this.skinTransformNormal(e,this.createVariable("vec3","skinTangent")):e},getOrCreateLocalVertex:function(){return this.getOrCreateSkinVertex()},getOrCreateLocalNormal:function(){var t=this.getVariable("localNormal");if(t)return t;var e=this.getOrCreateSkinNormal();return e===this.getOrCreateAttribute("vec3","Normal")?e:(t=this.createVariable("vec3","localNormal"),this.getNode("Normalize").inputs({vec:e}).outputs({vec:t}),t)},getOrCreateLocalTangent:function(){var t=this.getVariable("localTangent");if(t)return t;var e=this.getOrCreateAttribute("vec4","Tangent"),i=this.getOrCreateSkinTangent();return i===e?i:this.normalizeAndSetAlpha(i,e,this.createVariable("vec4","localTangent"))},normalizeAndSetAlpha:function(t,e,i){var r=this.createVariable("vec3");return this.getNode("Normalize").inputs({vec:t}).outputs({vec:r}),this.getNode("SetAlpha").inputs({color:r,alpha:e}).outputs({color:i}),i}};t.exports=n},function(t,e,i){"use strict";var r=i(98),n=i(10),a=i(6),s={createFragmentShader:function(){this._fragmentShaderMode=!0;var t=this.createFragmentShaderGraph(),e=this.getFragmentShaderName();e&&t.push(this.getNode("Define","SHADER_NAME").setValue(e));var i=this.createShaderFromGraphs(t);return n.debug(i),this.cleanAfterFragment(),i},applyPointSizeCircle:function(t){return this._pointSizeAttribute&&this._pointSizeAttribute.isEnabled()&&this._pointSizeAttribute.isCircleShape()?(this.getNode("InlineCode").code("if (length(2.0 * gl_PointCoord - 1.0) > %radius) discard;").inputs({radius:this.getOrCreateConstantOne("float")}).outputs({output:t}),t):t},cleanAfterFragment:function(){this._variables={},this._activeNodeList={};for(var t=this._texturesByName,e=window.Object.keys(t),i=0;i<e.length;i++)t[e[i]].variable=void 0;for(var r=this._varyings,n=window.Object.keys(r),a=0,s=n.length;a<s;a++){var o=n[a],h=r[o];h.reset(),this._activeNodeList[h.getID()]=h,this._variables[o]=h}},createDefaultFragmentShaderGraph:function(){var t=this.getOrCreateConstant("vec4","fofd").setValue("vec4(1.0, 0.0, 1.0, 0.7)"),e=this.getNode("glFragColor");return this.getNode("SetFromNode").inputs(t).outputs(e),e},createFragmentShaderGraph:function(){var t=[];if(!this._material)return t.push(this.createDefaultFragmentShaderGraph()),t;var e,i=this.getOrCreateStateAttributeUniforms(this._material),r=this.getVertexColor(i.diffuse);if(this._lights.length>0){var n=this.createLighting({materialdiffuse:r});e=n}else e=r;if(i.emission){var a=this.createVariable("vec3").setValue("vec3(0.0)");this.getNode("Add").inputs(e,i.emission).outputs(a),e=a}var s=this.getDiffuseColorFromTextures();void 0!==s&&this.getNode("InlineCode").code("%color.rgb *= %texture.rgb;").inputs({texture:s}).outputs({color:e});var o,h=this.createVariable("float"),u=this.getFirstValidTexture();o=u?"%alpha = %color.a * %texelAlpha.a;":"%alpha = %color.a;",this._isBillboard&&(o+="if ( %alpha == 0.0) discard;"),
this.getNode("InlineCode").code(o).inputs({color:i.diffuse,texelAlpha:u}).outputs({alpha:h}),e=this.getPremultAlpha(e,h);var c=this.getNode("glFragColor");return this.getNode("SetAlpha").inputs({color:e,alpha:h}).outputs({color:c}),t.push(c),t},getOrCreateFrontTangent:function(){var t=this.createVariable("vec4","frontTangent");return this.getNode("FrontNormal").inputs({normal:this.getOrCreateVarying("vec4","vViewTangent")}).outputs({normal:t}),t},getOrCreateFrontNormal:function(){var t=this.createVariable("vec3","frontNormal");return this.getNode("FrontNormal").inputs({normal:this.getOrCreateVarying("vec3","vViewNormal")}).outputs({normal:t}),t},getOrCreateNormalizedNormal:function(){var t=this._variables.normal;if(t)return t;var e=this.createVariable("vec3","normal");return this.getNode("Normalize").inputs({vec:this.getOrCreateFrontNormal()}).outputs({vec:e}),e},getOrCreateNormalizedPosition:function(){var t=this._variables.eyeVector;if(t)return t;var e=this.createVariable("vec3"),i=this.createVariable("vec3");this.getNode("SetFromNode").inputs(this.getOrCreateVarying("vec4","vViewVertex")).outputs(i),this.getNode("Normalize").inputs({vec:i}).outputs({vec:e});var r=this.createVariable("vec3","eyeVector");return this.getNode("Mult").inputs(e,this.createVariable("float").setValue("-1.0")).outputs(r),r},getPremultAlpha:function(t,e){if(void 0===e)return t;var i=this.createVariable("vec4");return this.getNode("PreMultAlpha").inputs({color:t,alpha:e}).outputs({color:i}),i},getColorsRGB:function(t){var e=this.createVariable("vec3");return this.getNode("LinearTosRGB").inputs({color:t}).outputs({color:e}),e},getVertexColor:function(t){if(void 0!==t){var e=this.getOrCreateVarying("vec4","vVertexColor"),i=this.getOrCreateUniform("float","uArrayColorEnabled"),r=this.createVariable("vec4"),n=["","%color.rgb = %diffuse.rgb;","if ( %hasVertexColor == 1.0)","  %color *= %vertexColor.rgba;"].join("\n");return this.getNode("InlineCode").code(n).inputs({diffuse:t,hasVertexColor:i,vertexColor:e}).outputs({color:r}).comment("diffuse color = diffuse color * vertex color"),r}},getDiffuseColorFromTextures:function(){for(var t=[],e=this._texturesByName,i=window.Object.keys(e),r=0;r<i.length;r++){var n=i[r],a=e[n];a.shadow||t.push(this.getTextureByName(n).variable)}if(t.length>1){var s=this.createVariable("vec3","texDiffuseAccum");return this.getNode("Mult").inputs(t).outputs(s),s}if(1===t.length)return t[0]},getFirstValidTexture:function(){for(var t=this._textures,e=0,i=t.length;e<i;++e){var r=t[e];if(r)return this.getTextureByName(r.getName()).variable}},createShadowingLight:function(t,e,i){var r,n,s,o=!1,h=new Array(this._shadowsTextures.length),u=-1,c=t.getLightNumber();for(r=0;r<this._shadows.length;r++)if(n=this._shadows[r],n.getLightNumber()===c){u=r;for(var l=0;l<this._shadowsTextures.length;l++)s=this._shadowsTextures[l],s&&s.hasLightNumber(c)&&(h[l]=s,o=!0)}if(o){var d=this.getOrCreateVarying("vec3","vModelVertex"),f=this.createVariable("float"),p=this.getOrCreateStateAttributeUniforms(this._shadows[u],"shadow"),_=a.objectMix(e,p);for(r=0;r<h.length;r++)s=h[r],s&&(_=this.createShadowTextureInputVarying(s,_,d,r,c));return this.getNode("ShadowReceive").inputs(e).outputs({float:f}).setShadowAttribute(n),this.connectShadowLightNode(t,i,f,_)}},connectShadowLightNode:function(t,e,i){var r=this.createVariable("vec3","lightAndShadowTempOutput");return this.getNode("Mult").inputs(e,i).outputs(r),r},createShadowTextureInputVarying:function(t,e,i,r,n){var s="Texture"+r,o=this.getOrCreateSampler("sampler2D",s),h=t.getOrCreateUniforms(r),u=h[s];delete h[s];for(var c=window.Object.keys(h),l={},d="shadowTexture",f=0;f<c.length;f++){var p,_=c[f],g=_.split("_");2===g.length?Number(g[1])===n&&(p=d+g[0],l[p]=this.getOrCreateUniform(h[c[f]])):(p=d+c[f],l[p]=this.getOrCreateUniform(h[c[f]]))}var m=l;h[s]=u;var v=a.objectMix(e,m);v.shadowTexture=o;var S={vertexWorld:i,lightEyeDir:v.lightEyeDir,lightNDL:v.lightNDL};return v=a.objectMix(v,S)},createCommonLightingVars:function(){return{}},createLightAndShadowVars:function(t,e,i){var n,a=this._lights[i].getLightType(),s=this.createVariable("bool","lighted"+i);a!==r.SPOT&&a!==r.POINT||(n=this.createVariable("vec3","lightEyePos"+i));var o=this.createVariable("vec3","lightEyeDir"+i),h=this.createVariable("float","lightNDL"+i);return{lighted:s,lightEyePos:n,lightEyeDir:o,lightNDL:h}},createLighting:function(t,e){for(var i=this.createVariable("vec3"),r=[],n=e||{DIRECTION:"SunLight",SPOT:"SpotLight",POINT:"PointLight",HEMI:"HemiLight"},s=this.getOrCreateStateAttributeUniforms(this._material,"material"),o=this.createCommonLightingVars(t,n),h=0;h<this._lights.length;h++){var u=this._lights[h],c=this.createVariable("vec3"),l=n[u.getLightType()],d=this.getOrCreateStateAttributeUniforms(this._lights[h],"light"),f=this.createLightAndShadowVars(t,n,h),p=a.objectMix({},d);p=a.objectMix(p,s),p=a.objectMix(p,t),p=a.objectMix(p,o),p=a.objectMix(p,f),p.normal||(p.normal=this.getOrCreateNormalizedNormal()),p.eyeVector||(p.eyeVector=this.getOrCreateNormalizedPosition()),this.getNode(l).inputs(p).outputs({color:c,lightEyePos:p.lightEyePos,lightEyeDir:p.lightEyeDir,ndl:p.lightNDL,lighted:p.lighted});var _=this.createShadowingLight(u,p,c);_?r.push(_):r.push(c);var g=this.createVariable("vec3","lightMatAmbientOutput");this.getNode("Mult").inputs(p.materialambient,d.lightambient).outputs(g),r.push(g)}return 0===r.length&&r.push(this.createVariable("vec3").setValue("vec3(0.0)")),this.getNode("Add").inputs(r).outputs(i),i},createTextureRGBA:function(t,e,i){var r=this.createVariable("vec4");return this.getNode("TextureRGBA").inputs({sampler:e,uv:i}).outputs({color:r}),r}};t.exports=s},function(t,e,i){"use strict";var r,n=i(215),a=i(216),s=i(10),o=function(){try{r=i(217)}catch(t){s.warn("You will not be able to use osgUtil.DisplayGraph until you add jQuery in your page")}},h=function(t){this.options=t;var e=document.createElement("style");e.type="text/css",e.innerHTML=[".osgDebugSimpleTooltip {","display: none;","position: absolute;","margin-left: 10px;","border-radius: 4px;","padding: 10px;","background: rgba(0,0,0,.9);","color: #ffffff;","}",".osgDebugSimpleTooltip:before {","content: ",";","position: absolute;","left: -10px;","top: 8px;","border: 10px solid transparent;","border-width: 10px 10px 10px 0;","border-right-color: rgba(0,0,0,.9);","}"].join("\n"),document.getElementsByTagName("head")[0].appendChild(e),this.el=document.createElement("div"),this.el.className="osgDebugSimpleTooltip",document.body.appendChild(this.el);for(var i=document.querySelectorAll(this.options.selector),r=0;r<i.length;r++)i[r].addEventListener("mouseover",this.showTooltip.bind(this),!1),i[r].addEventListener("mouseout",this.hideTooltip.bind(this),!1)};h.prototype={showTooltip:function(t){if(r){var e=t.currentTarget;this.el.innerHTML=e.getAttribute("title"),this.el.style.display="block",this.el.style.left=r(e).position().left+r(e).get(0).getBoundingClientRect().width+"px",this.el.style.top=r(e).position().top+"px"}},hideTooltip:function(){this.el.style.display="none"}};var u=function(){o(),r&&(this._selectables=new window.Map,this._graphNode=new a(this._selectables),this._graphRender=new n(this._selectables),this._displayNode=!0,this._displayRenderer=!1,this._cbSelect=void 0,this._focusedElement="graph",this._idToDomElement=new window.Map,this._$svg=r("<svg width=100% height=100%></svg>"),r("body").append(this._$svg),this._css=".node {text-align: center;cursor: pointer;}.node rect {stroke: #FFF;}.edgePath path {stroke: #FFF;fill: none;}table {text-align: right;}svg {position: absolute;left: 0px;top: 0px;}.osgDebugButton {position: absolute;left: 15px;top: 15px;z-index: 5;border: 0;background: #65a9d7;background: -webkit-gradient(linear, left top, left bottom, from(#3e779d), to(#65a9d7));background: -webkit-linear-gradient(top, #3e779d, #65a9d7);background: -moz-linear-gradient(top, #3e779d, #65a9d7);background: -ms-linear-gradient(top, #3e779d, #65a9d7);background: -o-linear-gradient(top, #3e779d, #65a9d7);padding: 5px 10px;-webkit-border-radius: 7px;-moz-border-radius: 7px;border-radius: 7px;-webkit-box-shadow: rgba(0,0,0,1) 0 1px 0;-moz-box-shadow: rgba(0,0,0,1) 0 1px 0;box-shadow: rgba(0,0,0,1) 0 1px 0;text-shadow: rgba(0,0,0,.4) 0 1px 0;color: white;font-size: 15px;font-family: Helvetica, Arial, Sans-Serif;text-decoration: none;vertical-align: middle;}.osgDebugButton:hover {border-top-color: #28597a;background: #28597a;color: #ccc;}.osgDebugButton:active {border-top-color: #1b435e;background: #1b435e;}.osgDebugSimpleTooltip .osgDebugName {font-weight: bold;color: #60b1fc;margin: 0;}.osgDebugSimpleTooltip .osgDebugDescription {margin: 0;}")};u.instance=function(){return u._instance||(u._instance=new u),u._instance},u.prototype={getColorFromClassName:a.prototype.getColorFromClassName,setCallbackSelect:function(t){this._cbSelect=t},reset:function(){r&&(this._selectables.clear(),this._$svg.empty(),this._focusedElement="scene",r(".osgDebugButton").hide())},setDisplayGraphRenderer:function(t){this._displayRenderer=t},createRenderGraph:function(t){this._graphRender.createGraph(t),this.displayGraph()},createGraph:function(t){r&&(this.reset(),this._displayNode=!!t,t&&this._graphNode.createGraph(t),this._displayRenderer?i(218).debugGraph=!0:this.displayGraph())},displayGraph:function(){if(r){if(window.d3&&window.dagreD3)return void this._createGraphApply();var t="//cdnjs.cloudflare.com/ajax/libs/d3/3.4.13/d3.min.js",e="//cdn.jsdelivr.net/dagre-d3/0.2.9/dagre-d3.min.js",i=this._createGraphApply.bind(this);r.getScript(t).done(function(){r.getScript(e).done(i)})}},_createGraphApply:function(){var t=new window.dagreD3.Digraph;this._displayNode&&this._graphNode.generateNodeAndLink(t),this._displayRenderer&&this._graphRender.generateNodeAndLink(t),this.injectStyleElement(),r(".osgDebugButton").show();var e=this.renderer=new window.dagreD3.Renderer,i=window.d3.select(this._$svg.get(0)),n=i.append("g"),a=.75,s=e.zoom();e.zoom(function(t,e){var i=s(t,e);return i.scale(a).event(e),i});var o=function(t,e){return'<p class="osgDebugName">'+t+'</p><pre class="osgDebugDescription">'+e+"</pre>"},u=this._idToDomElement,c=e.drawNodes();e.drawNodes(function(t,e){var i=c(t,e);return i.attr("title",function(e){return u.set(e,this),o(e,t.node(e).description||"")}),i}),e.run(t,n),this.tooltip=new h({selector:".node"}),r(".node").click(this.onNodeSelect.bind(this)),this.focusOnGraph()},selectNode:function(t){var e=t.getInstanceID(),i=this._idToDomElement.get(e);i&&r(i).click()},onNodeSelect:function(t){var e=t.currentTarget,i=r(e.getAttribute("title"))[0].innerHTML,n=this._selectables;this.lastNode&&(this.lastNode.style.fill=this.lastColor);var a=n.get(i);a&&(this.lastNode=e.childNodes[0],this.lastColor=this.lastNode.style.fill,e.childNodes[0].style.fill="#f00",window.activeNode=a,s.info("window.activeNode is set with the node below !"),s.log(window.activeNode),s.log("\n"),this._cbSelect&&this._cbSelect(a))},focusOnScene:function(){r(".osgDebugButton").text("Access to the graph"),this._$svg.css("zIndex","-2"),this._focusedElement="scene"},focusOnGraph:function(){r(".osgDebugButton").text("Access to the scene"),this._$svg.css("zIndex","2"),r(".osgDebugSimpleTooltip").css("zIndex","3"),this._focusedElement="graph"},injectStyleElement:function(){if(!this._cssInjected){this._cssInjected=!0,r("body").append('<button class="osgDebugButton">Access to the scene</button>'),r(".osgDebugButton").click(function(){"scene"===this._focusedElement?this.focusOnGraph():this.focusOnScene()}.bind(this));var t=document.createElement("style");t.type="text/css",t.innerHTML=this._css,document.getElementsByTagName("head")[0].appendChild(t)}}},t.exports=u},function(t,e,i){"use strict";var r=i(216),n=i(65),a=function(t){this._selectables=t,this._nodeList=[],this._linkList=[],this._renderBinMap=new window.Map,this._renderBinStack=[],this._generatorID=0,this._refID=0,this._uniqueEdges=new window.Set};a.prototype={getColorFromClassName:r.prototype.getColorFromClassName,createGraph:function(t){this.reset(),this.apply(t)},reset:function(){this._renderBinMap.clear(),this._renderBinStack.length=0,this._generatorID=0,this._refID++,this._nodeList.length=0,this._linkList.length=0,this._uniqueEdges.clear()},apply:function(t){var e=t.getInstanceID();if(this._renderBinMap.has(e)||this._renderBinMap.set(e,t),this._renderBinStack.push(t),t.getPreRenderStageList)for(var i=t.getPreRenderStageList(),r=0,n=i.length;r<n;++r)this.apply(i[r].renderStage);if(this.registerNode(t),t.getPostRenderStageList)for(var a=t.getPostRenderStageList(),s=0,o=a.length;s<o;++s)this.apply(a[s].renderStage);this._renderBinStack.pop()},registerNode:function(t){var e=t.getInstanceID();this._nodeList.push(t);for(var i=t._bins,r=window.Object.keys(i),n=0,a=r.length;n<a;n++){var s=i[r[n]];this.apply(s)}if(t._leafs.length)for(var o=0,h=t._leafs.length;o<h;o++)this.createNodeAndSetID(e,t._leafs[o]);for(var u=0,c=t.stateGraphList.length;u<c;u++){var l=t.stateGraphList[u];this.createNodeAndSetID(e,l);for(var d=l._instanceID,f=0,p=l.leafs.length;f<p;f++)this.createNodeAndSetID(d,l.leafs[f])}if(!(this._renderBinStack.length<2)){var _=this._renderBinStack[this._renderBinStack.length-2].getInstanceID();this.createLink(_,e)}},createLink:function(t,e){var i=t+"+"+e;this._uniqueEdges.has(i)||(this._linkList.push({parentNode:t,childrenNode:e}),this._uniqueEdges.add(i))},createNodeAndSetID:function(t,e){this._nodeList.push(e),(void 0===e._instanceID||e._instanceID<0&&e._refID!==this._refID)&&(e._instanceID=-1-this._generatorID++,e._refID=this._refID),this.createLink(t,e._instanceID)},generateRenderLeaf:function(t,e){var i=e._instanceID,r="RenderLeaf",n=e._geometry&&e._geometry.getName()?"\n"+e._geometry.getName():"Geometry",a=r+" ( "+e._instanceID+" )";a+="\n"+n+" ( "+e._geometry.getInstanceID()+" )",this._selectables.set(i.toString(),e),t.addNode(i,{label:a,description:"",style:"fill: "+this.getColorFromClassName(r)+";stroke-width: 0px;"})},generateStateGraph:function(t,e){var i=e._instanceID,r="StateGraph",n=r+" ( "+e._instanceID+" )";n+="\n"+e.leafs.length+" leafs",this._selectables.set(i.toString(),e),t.addNode(i,{label:n,description:"",style:"fill: "+this.getColorFromClassName(r)+";stroke-width: 0px;"})},generateRenderStage:function(t,e){var i=e.className()+" ( "+e._instanceID+" )";e.getName()&&(i+="\n"+e.getName()),i+="\nViewport ( "+e.getViewport().width()+" x "+e.getViewport().height()+" )",this._selectables.set(e.getInstanceID().toString(),e),t.addNode(e.getInstanceID(),{label:i,description:"",style:"fill: "+this.getColorFromClassName(e.className())+";stroke-width: 0px;"})},generateRenderBin:function(t,e){var i=e.className()+" ( "+e.getInstanceID()+" )";e.getName()&&(i+="\n"+e.getName());var r="";e.getSortMode()===n.SORT_BACK_TO_FRONT&&(r="SortMode: BackToFront");var a="BinNumber: "+e.getBinNumber()+"\n"+r;this._selectables.set(e.getInstanceID().toString(),e),t.addNode(e.getInstanceID(),{label:i,description:a,style:"fill: "+this.getColorFromClassName(e.className())+";stroke-width: 0px;"})},generateNodeAndLink:function(t){for(var e=0,i=this._nodeList.length;e<i;e++){var r=this._nodeList[e];r._geometry&&void 0!==r._depth?this.generateRenderLeaf(t,r):void 0!==r.depth&&r.leafs&&r.children?this.generateStateGraph(t,r):"RenderStage"===r.className()?this.generateRenderStage(t,r):this.generateRenderBin(t,r)}for(var n=0,a=this._linkList.length;n<a;n++)t.addEdge(null,this._linkList[n].parentNode,this._linkList[n].childrenNode)}},t.exports=a},function(t,e,i){"use strict";var r=i(6),n=i(32),a=i(77),s=function(t){n.call(this,n.TRAVERSE_ALL_CHILDREN),this._selectables=t,this._nodeList=[],this._linkList=[],this._uniqueNodes=new window.Set,this._uniqueEdges=new window.Set};s.prototype=r.objectInherit(n.prototype,{getColorFromClassName:function(t){switch(t){case"ShadowedScene":return"#3D3D3D";case"Camera":return"#AB7BCF";case"RenderBin":return"#59778B";case"LightSource":return"#53967D";case"RenderStage":return"#DDCC55";case"RenderLeaf":case"Geometry":return"#FFCC55";case"RigGeometry":return"#DD8800";case"MorphGeometry":return"#AA5500";case"MatrixTransform":return"#CE697E";case"StateSet":return"#0099FF";case"StateGraph":case"Skeleton":return"#96999E";case"Bone":return"#A9DEAA";case"Node":return"#FFFFFF";default:return"#FF00AA"}},createGraph:function(t){this.reset(),t.accept(this)},reset:function(){this._nodeList.length=0,this._linkList.length=0,this._uniqueNodes.clear(),this._uniqueEdges.clear()},apply:function(t){if(!t._isNormalDebug){if(this._uniqueNodes.has(t.getInstanceID())||(this._uniqueNodes.add(t.getInstanceID()),this._nodeList.push(t)),this.nodePath.length>=2){var e=this.nodePath[this.nodePath.length-2].getInstanceID(),i=t.getInstanceID(),r=e+"+"+i;this._uniqueEdges.has(r)||(this._linkList.push({parentNode:e,childrenNode:i}),this._uniqueEdges.add(r))}this.traverse(t)}},createMatrixGrid:function(t,e){var i="";return i+="<table><tr><td>"+e[0]+"</td>",i+="<td>"+e[4]+"</td>",i+="<td>"+e[8]+"</td>",i+="<td>"+e[12]+"</td></tr>",i+="<tr><td>"+e[1]+"</td>",i+="<td>"+e[5]+"</td>",i+="<td>"+e[9]+"</td>",i+="<td>"+e[13]+"</td></tr>",i+="<tr><td>"+e[2]+"</td>",i+="<td>"+e[6]+"</td>",i+="<td>"+e[10]+"</td>",i+="<td>"+e[14]+"</td></tr>",i+="<tr><td>"+e[3]+"</td>",i+="<td>"+e[7]+"</td>",i+="<td>"+e[11]+"</td>",i+="<td>"+e[15]+"</td></tr></table>"},getLabel:function(t){var e=t.className()+" ("+t.getInstanceID()+")";return t.getName&&t.getName()&&(e+="\n"+t.getName()),e},generateNode:function(t,e){var i="";e.getMatrix&&e.getMatrix()&&(i+="<br /><br />"+this.createMatrixGrid(e,e.getMatrix())),this._selectables.set(e.getInstanceID().toString(),e),t.addNode(e.getInstanceID(),{label:this.getLabel(e),description:i,style:"fill: "+this.getColorFromClassName(e.className())+";stroke-width: 0px;"})},generateStateSet:function(t,e){var i=e.getStateSet(),r=i.getInstanceID(),n=this.getLabel(i);n+="\nNbTexture : "+i.getNumTextureAttributeLists(),t.hasNode(r)||(this._selectables.set(r.toString(),i),t.addNode(r,{label:n,style:"fill: "+this.getColorFromClassName(i.className())+";stroke-width: 0px;"})),t.addEdge(null,e.getInstanceID(),r,{style:"stroke: "+this.getColorFromClassName(i.className())+";"})},generateSourceGeometry:function(t,e){var i=e.getSourceGeometry(),r=i.getInstanceID();this._selectables.set(r.toString(),i),t.addNode(r,{label:this.getLabel(i),style:"fill: "+this.getColorFromClassName(i.className())+";stroke-width: 0px;"}),t.addEdge(null,e.getInstanceID(),r,{style:"stroke: "+this.getColorFromClassName(i.className())+";"})},generateNodeAndLink:function(t){for(var e=0,i=this._nodeList.length;e<i;e++){var r=this._nodeList[e];this.generateNode(t,r),r.getStateSet()&&this.generateStateSet(t,r),r.getSourceGeometry&&r.getSourceGeometry()instanceof a&&this.generateSourceGeometry(t,r)}for(var n=0,s=this._linkList.length;n<s;n++)t.addEdge(null,this._linkList[n].parentNode,this._linkList[n].childrenNode)}}),t.exports=s},function(t,e){if("undefined"==typeof __WEBPACK_EXTERNAL_MODULE_217__){var i=new Error('Cannot find module "undefined"');throw i.code="MODULE_NOT_FOUND",i}t.exports=__WEBPACK_EXTERNAL_MODULE_217__},function(t,e,i){"use strict";var r=i(6),n=i(53),a=i(60),s=i(13),o=i(66),h=i(107),u=i(8),c=i(15).vec4,l=i(174),d=i(214),f=function(t){s.call(this),this._state=void 0,this._camera=t,this._renderStage=void 0,this._stateGraph=void 0,this._frameStamp=void 0,this._previousCullsettings=new n,this.setDefaults()};f.debugGraph=!1,f.prototype=r.objectLibraryClass(r.objectInherit(s.prototype,{setDefaults:function(){this._state=new h(new l.ShaderGeneratorProxy),this._cullVisitor=new a,this._cullVisitor.setRenderer(this),this._stateGraph=new u,this.getCamera().setClearColor(c.create()),this.setRenderStage(new o);var t=i(4),e=this.getCamera().getOrCreateStateSet();e.setAttributeAndModes(new t.Material),e.setAttributeAndModes(new t.Depth),e.setAttributeAndModes(new t.BlendFunc),e.setAttributeAndModes(new t.CullFace)},getCullVisitor:function(){return this._cullVisitor},setCullVisitor:function(t){t&&!t.getRenderer()&&t.setRenderer(this),this._cullVisitor=t},setRenderStage:function(t){this._renderStage=t},getCamera:function(){return this._camera},setFrameStamp:function(t){this._frameStamp=t},getFrameStamp:function(){return this._frameStamp},getState:function(){return this._state},setState:function(t){this._state=t},setGraphicContext:function(t){this._state.setGraphicContext(t)},getGraphicContext:function(){return this._state.getGraphicContext()},cullAndDraw:function(){this.cull(),this.draw()},cull:function(){var t=this.getCamera(),e=t.getView();this._cullVisitor.setFrameStamp(this._frameStamp),this._cullVisitor.resetStats(),this._stateGraph.clean(),this._renderStage.reset(),this._cullVisitor.reset(),this._cullVisitor.setStateGraph(this._stateGraph),this._cullVisitor.setRenderStage(this._renderStage),this._cullVisitor.pushStateSet(t.getStateSet()),this._previousCullsettings.reset(),this._previousCullsettings.setCullSettings(this._cullVisitor),this._cullVisitor.setCullSettings(t),this._previousCullsettings.getSettingSourceOverrider()===this._cullVisitor&&this._previousCullsettings.getEnableFrustumCulling()&&this._cullVisitor.setEnableFrustumCulling(!0),this._cullVisitor.pushCameraModelViewProjectionMatrix(t,t.getViewMatrix(),t.getProjectionMatrix()),t.getBound();var r=e.getLight(),n=i(219);if(r)switch(e.getLightingMode()){case n.LightingMode.HEADLIGHT:this._cullVisitor.addPositionedAttribute(null,r);break;case n.LightingMode.SKY_LIGHT:this._cullVisitor.addPositionedAttribute(t.getViewMatrix(),r)}this._cullVisitor.pushViewport(t.getViewport()),this._renderStage.setClearDepth(t.getClearDepth()),this._renderStage.setClearColor(t.getClearColor()),this._renderStage.setClearMask(t.getClearMask()),this._renderStage.setViewport(t.getViewport()),this._cullVisitor.setDatabaseRequestHandler(this._camera.getView().getDatabasePager()),this._cullVisitor.handleCullCallbacksAndTraverse(t),this._cullVisitor.popCameraModelViewProjectionMatrix(t),this._cullVisitor.setCullSettings(this._previousCullsettings),this._cullVisitor.popViewport(),this._cullVisitor.popStateSet(),this._renderStage.sort()},draw:function(){var t=this.getState();t.resetCacheFrame(),t.resetStats(),this._renderStage.setCamera(this._camera),this._renderStage.draw(t),f.debugGraph&&(d.instance().createRenderGraph(this._renderStage),f.debugGraph=!1),this._renderStage.setCamera(void 0),t.applyDefault()}}),"osgViewer","Renderer"),t.exports=f},function(t,e,i){"use strict";var r=i(48),n=i(52),a=i(88),s=i(67),o=i(98),h=i(15).mat4,u=i(40),c=i(103),l=i(104),d=i(15).vec3,f=i(110),p=i(38),_=i(154),g=i(155),m=i(218),v=i(220),S=i(214),x=i(10),b=function(){this._camera=new n,this._scene=new v,this._frameStamp=new a,this._lightingMode=void 0,this._manipulator=void 0,this._canvasWidth=0,this._canvasHeight=0,this._requestContinousUpdate=!0,this._requestRedraw=!0,this.setLightingMode(b.LightingMode.HEADLIGHT);var t=this.createRenderer(this.getCamera());t.setFrameStamp(this._frameStamp),this.getCamera().setRenderer(t),this.getCamera().setView(this)};b.LightingMode={NO_LIGHT:0,HEADLIGHT:1,SKY_LIGHT:2},b.prototype={requestRedraw:function(){this._requestRedraw=!0},requestContinuousUpdate:function(t){this._requestContinousUpdate=t},createRenderer:function(t){var e=new m(t);return e},setGraphicContext:function(t){this.getCamera().getRenderer().getState().setGraphicContext(t)},getGraphicContext:function(){return this.getCamera().getRenderer().getState().getGraphicContext()},initWebGLCaps:function(t){p.instance(t)},computeCanvasSize:function(){return function(t){var e,i;e=t.clientWidth,i=t.clientHeight,e<1&&(e=1),i<1&&(i=1);var r=this._devicePixelRatio,n=Math.floor(e*r),a=Math.floor(i*r),s=!1;return this._canvasWidth!==n&&(t.width=n,this._canvasWidth=n,s=!0),this._canvasHeight!==a&&(t.height=a,this._canvasHeight=a,s=!0),s}}(),getCanvasWidth:function(){return this._canvasWidth},getCanvasHeight:function(){return this._canvasHeight},getCanvasClientWidth:function(){return Math.ceil(this._canvasWidth/this._devicePixelRatio)},getCanvasClientHeight:function(){return Math.ceil(this._canvasHeight/this._devicePixelRatio)},getCanvasPixelRatio:function(){return this._devicePixelRatio},setUpView:function(t,e){var i=window.devicePixelRatio||1,r=e.getNumber("overrideDevicePixelRatio"),n=e.getNumber("maxDevicePixelRatio")||-1;"number"==typeof r?i=r:n!==-1&&(i=Math.min(i,n)),this._devicePixelRatio=i,this.computeCanvasSize(t);var a=t.width,s=t.height,o=a/s;if(this._camera.setViewport(new f(0,0,a,s)),this._camera.setGraphicContext(this.getGraphicContext()),h.lookAt(this._camera.getViewMatrix(),d.fromValues(0,0,-10),d.create(),d.fromValues(0,1,0)),h.perspective(this._camera.getProjectionMatrix(),Math.PI/180*55,o,1,1e3),e&&e.enableFrustumCulling&&this.getCamera().getRenderer().getCullVisitor().setEnableFrustumCulling(!0),e&&e.debugGraph){var u=this.getCamera();S.instance().refreshGraph=function(){var t=S.instance();t.setDisplayGraphRenderer(!0),t.createGraph(u)},x.log("to refresh the graphs type in the console:\nOSG.osgUtil.DisplayGraph.instance().refreshGraph()")}},computeIntersections:function(t,e,i){return void 0===i&&(i=-1),this._lsi?this._lsi.reset():this._lsi=new g,this._origIntersect||(this._origIntersect=d.create(),this._dstIntersect=d.create()),this._lsi.set(d.set(this._origIntersect,t,e,0),d.set(this._dstIntersect,t,e,1)),this._iv?this._iv.reset():(this._iv=new _,this._iv.setIntersector(this._lsi)),this._iv.setTraversalMask(i),this._camera.accept(this._iv),this._lsi.getIntersections()},setFrameStamp:function(t){this._frameStamp=t},getFrameStamp:function(){return this._frameStamp},setCamera:function(t){this._camera=t},getCamera:function(){return this._camera},setSceneData:function(t){t!==this._scene.getSceneData()&&(this._scene.setSceneData(t),this._camera.removeChildren(),this._camera.addChild(t))},getSceneData:function(){return this._scene.getSceneData()},setDatabasePager:function(t){this._scene.setDatabasePager(t)},getDatabasePager:function(){return this._scene.getDatabasePager()},getScene:function(){return this._scene},getManipulator:function(){return this._manipulator},setManipulator:function(t){this._manipulator=t},getLight:function(){return this._light},setLight:function(t){this._light=t,this._lightingMode!==b.LightingMode.NO_LIGHT&&this._scene.getOrCreateStateSet().setAttributeAndModes(this._light)},getLightingMode:function(){return this._lightingMode},setLightingMode:function(t){this._lightingMode!==t&&(this._lightingMode=t,this._lightingMode!==b.LightingMode.NO_LIGHT?this._light||(this._light=new o):this._light=void 0)},flushDeletedGLObjects:function(t){var e=this.getGraphicContext();t=r.flushDeletedGLBufferArrays(e,t),t=u.getTextureManager(e).flushDeletedTextureObjects(e,t),t=c.flushDeletedGLPrograms(e,t),t=l.flushDeletedGLShaders(e,t),t=s.flushDeletedGLFrameBuffers(e,t),t=s.flushDeletedGLRenderBuffers(e,t)},flushAllDeletedGLObjects:function(){var t=this.getGraphicContext();r.flushAllDeletedGLBufferArrays(t),u.getTextureManager(t).flushAllDeletedTextureObjects(t),c.flushAllDeletedGLPrograms(t),l.flushAllDeletedGLShaders(t),s.flushAllDeletedGLFrameBuffers(t),s.flushAllDeletedGLRenderBuffers(t)}},t.exports=b},function(t,e,i){"use strict";var r=i(6),n=i(13),a=i(136),s=function(){n.call(this),this._databasePager=new a,this._sceneData=void 0};s.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{getSceneData:function(){return this._sceneData},setSceneData:function(t){this._sceneData=t},setDatabasePager:function(t){this._databasePager=t},getDatabasePager:function(){return this._databasePager},updateSceneGraph:function(t){this._databasePager&&this._databasePager.updateSceneGraph(t.getFrameStamp()),this._sceneData&&this._sceneData.accept(t)}}),"osgViewer","Scene"),t.exports=s},function(t,e,i){"use strict";var r=i(12),n=i(61),a=i(84),s=i(51),o=i(55),h=i(41),u=i(15).vec2,c=i(15).vec3,l=i(15).vec4,d=i(15).mat4,f=i(15).quat,p=i(154),_=i(155),g=i(222),m=i(35),v=i(6),S=function(t,e){t[0]=void 0===e.offsetX?e.layerX:e.offsetX,t[1]=void 0===e.offsetY?e.layerY:e.offsetY},x=function(){};x.prototype={cull:function(){return!1}};var b=new s(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA),M=function(t){this._testPlane=t,this._inter=c.create(),_.call(this)};M.prototype=v.objectInherit(_.prototype,{setTestPlane:function(t){this._testPlane=t},getTranslateDistance:function(){return this._inter},enter:function(){var t=c.create(),e=c.create();return function(i){if(void 0===i._nbAxis)return!0;if(c.init(t),t[i._nbAxis]=1,this._testPlane){var r=c.dot(this._iStart,t),n=c.dot(this._iEnd,t);if(r===n)return!1;var a=-r/(n-r);this._inter[0]=this._iStart[0]+(this._iEnd[0]-this._iStart[0])*a,this._inter[1]=this._iStart[1]+(this._iEnd[1]-this._iStart[1])*a,this._inter[2]=this._iStart[2]+(this._iEnd[2]-this._iStart[2])*a}else{c.normalize(e,c.sub(e,this._iEnd,this._iStart));var s=-c.dot(e,t),o=c.dot(this._iStart,e),h=Math.abs(1-s*s),u=-c.dot(this._iStart,t);c.init(this._inter),this._inter[i._nbAxis]=(s*o-u)/h}return!1}}(),intersect:function(){return!1}});var y=function(t){n.call(this),this._tmask=1,this._autoInsertMT=!1,this._viewer=t,this._canvas=t.getGraphicContext().canvas,this._manipulator=t.getManipulator(),this._rotateNode=new n,this._translateNode=new n,this._planeNode=new n,this._rotateInLocal=!0,this._translateInLocal=!0,this._showAngle=new n,this._downCanvasCoord=u.create(),this._hoverNode=null,this._keepHoverColor=l.create(),this._isEditing=!1,this._editLineOrigin=c.create(),this._editLineDirection=c.create(),this._editOffset=c.create(),this._editLocal=d.create(),this._editWorldTrans=d.create(),this._editWorldScaleRot=d.create(),this._editInvWorldScaleRot=d.create(),this._debugNode=new r,this._lastDistToEye=0,this._attachedNode=null,this.attachToGeometry(null),this._lsi=new M,this._origIntersect=c.create(),this._dstIntersect=c.create(),this._iv=new p,this._iv.setIntersector(this._lsi),this.init()};y.NO_PICK=1,y.PICK_ARC_X=2,y.PICK_ARC_Y=4,y.PICK_ARC_Z=8,y.PICK_ARROW_X=16,y.PICK_ARROW_Y=32,y.PICK_ARROW_Z=64,y.PICK_PLANE_X=128,y.PICK_PLANE_Y=256,y.PICK_PLANE_Z=512,y.NO_FULL_CIRCLE=1024,y.PICK_ARC=y.PICK_ARC_X|y.PICK_ARC_Y|y.PICK_ARC_Z,y.PICK_ARROW=y.PICK_ARROW_X|y.PICK_ARROW_Y|y.PICK_ARROW_Z,y.PICK_PLANE=y.PICK_PLANE_X|y.PICK_PLANE_Y|y.PICK_PLANE_Z,y.PICK_GIZMO=y.PICK_ARC|y.PICK_ARROW|y.PICK_PLANE,y.prototype=v.objectInherit(n.prototype,{setRotateInLocal:function(t){this._rotateInLocal=t},setTranslateInLocal:function(t){this._translateInLocal=t},setTraversalMask:function(t){this._tmask=t},init:function(){this.getOrCreateStateSet().setAttributeAndModes(new a(a.DISABLE)),this.getOrCreateStateSet().setAttributeAndModes(new o(o.DISABLE));var t=function(){};t.prototype={update:this.updateGizmo.bind(this)},this.addUpdateCallback(new t),this.addChild(this.initNodeTranslate()),this.addChild(this.initNodeTranslatePlane()),this.addChild(this.initNodeRotate()),this._debugNode&&(this._debugNode.addChild(g.createDebugLineGeometry()),this.addChild(this._debugNode),this._debugNode.setNodeMask(0));var e=this._canvas;e.addEventListener("mousemove",this.onMouseMove.bind(this)),e.addEventListener("mousedown",this.onMouseDown.bind(this)),e.addEventListener("mouseup",this.onMouseUp.bind(this)),e.addEventListener("mouseout",this.onMouseUp.bind(this))},attachToNodePath:function(t){var e;if(t)for(var i=t.length-1;i>=0;--i){var r=t[i].editMask||0;if(r&y.PICK_GIZMO){e=t[i];break}}return e?(this._attachedNode=e,void this.updateGizmoMask()):(this._attachedNode=null,void this.setNodeMask(0))},attachToMatrixTransform:function(t){return t?(void 0===t.editMask&&(t.editMask=y.PICK_GIZMO),this._attachedNode=t,void this.updateGizmoMask()):(this._attachedNode=null,void this.setNodeMask(0))},attachToGeometry:function(t){var e=t;if(!e)return this._attachedNode=null,void this.setNodeMask(0);var i=e.getParents();if(void 0===i[0].editMask){for(var r=new n;i.length>0;)i[0].addChild(r),i[0].removeChild(e);r.addChild(e),r.editMask=y.PICK_GIZMO,e=r}else e=i[0];this._attachedNode=e,this.updateGizmoMask()},updateGizmoMask:function(){
if(!this._attachedNode)return void this.setNodeMask(0);var t=this._attachedNode.editMask;this.setNodeMask(t&y.PICK_GIZMO?y.NO_PICK:0),this._translateNode.setNodeMask(t&y.PICK_ARROW?y.PICK_ARROW:0),this._rotateNode.setNodeMask(t&y.PICK_ARC?y.PICK_ARC:0),this._planeNode.setNodeMask(t&y.PICK_PLANE?y.PICK_PLANE:0);var e=this._translateNode.getChildren();e[0].setNodeMask(t&y.PICK_ARROW_X?y.PICK_ARROW_X:0),e[1].setNodeMask(t&y.PICK_ARROW_Y?y.PICK_ARROW_Y:0),e[2].setNodeMask(t&y.PICK_ARROW_Z?y.PICK_ARROW_Z:0);var i=this._rotateNode.getChildren();i[0].setNodeMask(t&y.NO_FULL_CIRCLE?0:y.NO_PICK),i[1].setNodeMask(t&y.PICK_ARC_X?y.PICK_ARC_X:0),i[2].setNodeMask(t&y.PICK_ARC_Y?y.PICK_ARC_Y:0),i[3].setNodeMask(t&y.PICK_ARC_Z?y.PICK_ARC_Z:0);var r=this._planeNode.getChildren();r[0].setNodeMask(t&y.PICK_PLANE_X?y.PICK_PLANE_X:0),r[1].setNodeMask(t&y.PICK_PLANE_Y?y.PICK_PLANE_Y:0),r[2].setNodeMask(t&y.PICK_PLANE_Z?y.PICK_PLANE_Z:0)},onNodeHovered:function(){var t=l.fromValues(1,1,0,1);return function(e){if(this._hoverNode&&this._hoverNode.getStateSet().getUniform("uColor").setFloat4(this._keepHoverColor),!e)return void(this._hoverNode=null);for(var i=e.nodepath,r=i.length-1,n=i[r];void 0===n._nbAxis;){if(0===r)return;n=i[--r]}var a=n.getStateSet().getUniform("uColor");this._hoverNode=n,l.copy(this._keepHoverColor,a.getInternalArray()),a.setFloat4(t)}}(),initNodeRotate:function(){var t=g.createTorusGeometry(1,.01,6,64,2*Math.PI),e=g.createTorusGeometry(1,.01,6,64,Math.PI),i=g.createTorusGeometry(1,.1,6,64,Math.PI),a=new n,s=new n,o=new n,u=new n;s._nbAxis=0,o._nbAxis=1,u._nbAxis=2;var d=new r;d.setCullCallback(new x),d.addChild(i),t.setNodeMask(y.NO_PICK),e.setNodeMask(y.NO_PICK),s.setNodeMask(y.PICK_ARC_X),o.setNodeMask(y.PICK_ARC_Y),u.setNodeMask(y.PICK_ARC_Z),a.addChild(t),s.addChild(e),o.addChild(e),u.addChild(e),s.addChild(d),o.addChild(d),u.addChild(d),a.getOrCreateStateSet().addUniform(h.createFloat4(l.fromValues(.2,.2,.2,1),"uColor")),s.getOrCreateStateSet().addUniform(h.createFloat4(l.fromValues(1,0,0,1),"uColor")),o.getOrCreateStateSet().addUniform(h.createFloat4(l.fromValues(0,1,0,1),"uColor")),u.getOrCreateStateSet().addUniform(h.createFloat4(l.fromValues(0,0,1,1),"uColor"));var f=this._showAngle;f.getOrCreateStateSet().setAttributeAndModes(b),f.setNodeMask(0),f.getOrCreateStateSet().addUniform(h.createFloat3(c.fromValues(1,0,0),"uBase")),f.getOrCreateStateSet().addUniform(h.createFloat(0,"uAngle")),f.addChild(g.createQuadCircleGeometry());var p=this._rotateNode;return p.setNodeMask(y.PICK_ARC),p.addChild(a),p.addChild(s),p.addChild(o),p.addChild(u),p.addChild(f),p},initNodeTranslate:function(){var t=1.5,e=.3,i=.5,a=1.1*(t-i+e),s=new n;d.fromTranslation(s.getMatrix(),c.fromValues(0,0,t+.5*e)),s.addChild(g.createCylinderGeometry(0,.07,e,32,1,!0,!0));var o=new n;d.fromTranslation(o.getMatrix(),c.fromValues(0,0,.5*t)),o.addChild(g.createCylinderGeometry(.01,.01,t,32,1,!0,!0));var u=new r;u.addChild(o),u.addChild(s);var f=g.createCylinderGeometry(.1,.1,a,32,1,!0,!0),p=new n,_=new n,m=new n;p._nbAxis=0,_._nbAxis=1,m._nbAxis=2,d.fromRotation(p.getMatrix(),.5*Math.PI,c.fromValues(0,1,0)),d.fromRotation(_.getMatrix(),.5*-Math.PI,c.fromValues(1,0,0));var v=new n;v.setCullCallback(new x),d.fromTranslation(v.getMatrix(),c.fromValues(0,0,i+.5*a)),v.addChild(f),u.setNodeMask(y.NO_PICK),p.setNodeMask(y.PICK_ARROW_X),_.setNodeMask(y.PICK_ARROW_Y),m.setNodeMask(y.PICK_ARROW_Z),p.addChild(u),_.addChild(u),m.addChild(u),p.addChild(v),_.addChild(v),m.addChild(v),p.getOrCreateStateSet().addUniform(h.createFloat4(l.fromValues(1,0,0,1),"uColor")),_.getOrCreateStateSet().addUniform(h.createFloat4(l.fromValues(0,1,0,1),"uColor")),m.getOrCreateStateSet().addUniform(h.createFloat4(l.fromValues(0,0,1,1),"uColor"));var S=this._translateNode;return S.setNodeMask(y.PICK_ARROW),S.addChild(p),S.addChild(_),S.addChild(m),S},initNodeTranslatePlane:function(){var t=new n;d.fromTranslation(t.getMatrix(),c.fromValues(.5,.5,0)),d.mul(t.getMatrix(),d.fromScaling(d.create(),c.fromValues(.5,.5,1)),t.getMatrix()),t.addChild(g.createPlaneGeometry());var e=new n,i=new n,r=new n;e._nbAxis=0,i._nbAxis=1,r._nbAxis=2,d.fromRotation(e.getMatrix(),.5*-Math.PI,c.fromValues(0,1,0)),d.fromRotation(i.getMatrix(),.5*Math.PI,c.fromValues(1,0,0)),e.setNodeMask(y.PICK_PLANE_X),i.setNodeMask(y.PICK_PLANE_Y),r.setNodeMask(y.PICK_PLANE_Z),e.addChild(t),i.addChild(t),r.addChild(t),e.getOrCreateStateSet().addUniform(h.createFloat4(l.fromValues(1,0,0,.3),"uColor")),i.getOrCreateStateSet().addUniform(h.createFloat4(l.fromValues(0,1,0,.3),"uColor")),r.getOrCreateStateSet().addUniform(h.createFloat4(l.fromValues(0,0,1,.3),"uColor"));var a=this._planeNode;return a.setNodeMask(y.PICK_PLANE),a.getOrCreateStateSet().setAttributeAndModes(b),a.addChild(e),a.addChild(i),a.addChild(r),a},updateArcRotation:function(){var t=f.create(),e=f.setAxisAngle(f.create(),[0,1,0],.5*-Math.PI),i=f.setAxisAngle(f.create(),[1,0,0],.5*-Math.PI);return function(r){var n=this._rotateNode,a=n.getChildren();t[0]=-r[1],t[1]=r[0],t[2]=0,t[3]=1+r[2],f.normalize(t,t),d.fromQuat(a[0].getMatrix(),t),f.setAxisAngle(t,[1,0,0],Math.atan2(r[2],r[1])),f.mul(t,t,e),d.fromQuat(a[1].getMatrix(),t),f.setAxisAngle(t,[0,1,0],Math.atan2(-r[0],-r[2])),f.mul(t,t,i),d.fromQuat(a[2].getMatrix(),t),f.setAxisAngle(t,[0,0,1],Math.atan2(-r[0],r[1])),d.fromQuat(a[3].getMatrix(),t),a[1].dirtyBound(),a[2].dirtyBound(),a[3].dirtyBound()}}(),getTransformType:function(t){for(var e=t;e.getParents().length>0;){if(void 0!==e.referenceFrame&&e.referenceFrame===m.ABSOLUTE_RF)return m.ABSOLUTE_RF;e=e.getParents()[0]}return m.RELATIVE_RF},updateGizmo:function(){var t=c.create(),e=c.create(),i=c.create(),r=d.create(),n=d.create(),a=d.create(),s=d.create();return function(){if(this._attachedNode){var o=this.getTransformType(this._attachedNode);this.setReferenceFrame(o),this.setCullingActive(o===m.RELATIVE_RF);var h=this._attachedNode.getWorldMatrices()[0];d.getTranslation(e,h),d.fromTranslation(n,e);var u=3;if(o===m.ABSOLUTE_RF)t[0]=t[1]=t[2]=0,i[0]=i[1]=i[2]=1;else{var l=this._viewer.getCamera().getProjectionMatrix(),f=.023*this._canvas.clientWidth*l[0];this._manipulator.getEyePosition(t),this._lastDistToEye=this._isEditing?this._lastDistToEye:c.distance(e,t),u*=this._lastDistToEye/f}d.fromScaling(s,[u,u,u]),d.mul(this.getMatrix(),n,s),c.sub(t,t,e),c.normalize(t,t),this._rotateInLocal||this._translateInLocal?(d.getScale(i,h),d.fromScaling(a,i),d.invert(a,a),d.mul(r,h,a),r[12]=r[13]=r[14]=0,this._translateInLocal&&(d.copy(this._translateNode.getMatrix(),r),d.copy(this._planeNode.getMatrix(),r)),this._rotateInLocal&&(d.copy(this._rotateNode.getMatrix(),r),d.invert(r,r),c.transformMat4(t,t,r))):d.identity(this._rotateNode.getMatrix()),this.updateArcRotation(t),this._rotateNode.dirtyBound(),this._translateNode.dirtyBound(),this._planeNode.dirtyBound(),this._isEditing&&d.copy(this._showAngle.getMatrix(),this._hoverNode.getMatrix())}}}(),computeNearestIntersection:function(){var t=function(t,e){return t.ratio-e.ratio},e=u.create();return function(i,r){S(e,i);var n=this._viewer,a=this._canvas,s=e[0]*(n._canvasWidth/a.clientWidth),o=(a.clientHeight-e[1])*(n._canvasHeight/a.clientHeight),h=this._viewer.computeIntersections(s,o,r);if(0!==h.length)return h.sort(t),h[0]}}(),setOnlyGizmoPicking:function(){this._viewer.getCamera().addChild(this),this._viewer.getSceneData().setNodeMask(0),this.setNodeMask(-1)},setOnlyScenePicking:function(){this._viewer.getCamera().removeChild(this),this._viewer.getSceneData().setNodeMask(-1),this.setNodeMask(y.NO_PICK)},pickGizmo:function(t,e){this.setOnlyGizmoPicking();var i=this.computeNearestIntersection(t,e);return this.setOnlyScenePicking(),i},getCanvasPositionFromWorldPoint:function(){var t=d.create();return function(e,i){var r=this._viewer.getCamera(),n=i;r.getViewport()?r.getViewport().computeWindowMatrix(t):d.identity(t),d.mul(t,t,r.getProjectionMatrix()),this.getReferenceFrame()===m.RELATIVE_RF&&d.mul(t,t,r.getViewMatrix()),c.transformMat4(n,e,t);var a=this._viewer,s=this._canvas;return n[0]=n[0]/(a._canvasWidth/s.clientWidth),n[1]=s.clientHeight-n[1]/(a._canvasHeight/s.clientHeight),n}}(),onMouseDown:function(t){if(S(this._downCanvasCoord,t),this._hoverNode&&this._attachedNode){this._viewer._eventProxy.StandardMouseKeyboard._enable=!1,this.saveEditMatrices();var e=this._hoverNode.getParents()[0].getNodeMask();this._isEditing=!0,e&y.PICK_ARC?(this._translateNode.setNodeMask(0),this._planeNode.setNodeMask(0),this.startRotateEdit(t)):e&y.PICK_ARROW?(this._rotateNode.setNodeMask(0),this._planeNode.setNodeMask(0),this.startTranslateEdit(t)):e&y.PICK_PLANE&&(this._rotateNode.setNodeMask(0),this._translateNode.setNodeMask(0),this.startPlaneEdit(t))}},saveEditMatrices:function(){d.copy(this._editLocal,this._attachedNode.getMatrix());var t=this._attachedNode.getWorldMatrices()[0];d.fromTranslation(this._editWorldTrans,c.fromValues(t[12],t[13],t[14])),d.copy(this._editWorldScaleRot,t),this._editWorldScaleRot[12]=this._editWorldScaleRot[13]=this._editWorldScaleRot[14]=0,d.invert(this._editInvWorldScaleRot,this._editWorldScaleRot)},startRotateEdit:function(t){var e=this._rotateNode.getWorldMatrices()[0],i=c.create();c.transformMat4(i,i,e),this.getCanvasPositionFromWorldPoint(i,i);var r=this.pickGizmo(t,this._hoverNode.getNodeMask()|y.PICK_ARC);if(r){var n=0===this._hoverNode._nbAxis?-1:1,a=c.create();a[0]=n*r.point[1],a[1]=-n*r.point[0],a[2]=r.point[2];var s=c.create();c.transformMat4(s,a,this._hoverNode.getMatrix()),c.transformMat4(s,s,e),this.getCanvasPositionFromWorldPoint(s,s);var o=this._editLineDirection;u.sub(o,s,i),u.normalize(o,o),this._showAngle.setNodeMask(y.NO_PICK),r.point[2]=0;var h=this._showAngle.getStateSet();h.getUniform("uAngle").setFloat(0),h.getUniform("uBase").setVec3(c.normalize(r.point,r.point)),S(this._editLineOrigin,t)}},startTranslateEdit:function(t){var e=this._editLineOrigin,i=this._editLineDirection,r=this._translateNode.getWorldMatrices()[0];d.getTranslation(e,r),c.init(i),i[this._hoverNode._nbAxis]=1,this._translateInLocal&&(c.transformMat4(i,i,this._editWorldScaleRot),c.normalize(i,i)),c.add(i,e,i),this.getCanvasPositionFromWorldPoint(e,e),this.getCanvasPositionFromWorldPoint(i,i),u.sub(i,i,e),u.normalize(i,i);var n=this._editOffset;S(n,t),u.sub(n,n,e)},startPlaneEdit:function(t){var e=this._editLineOrigin,i=this._planeNode.getWorldMatrices()[0];d.getTranslation(e,i),this.getCanvasPositionFromWorldPoint(e,e);var r=this._editOffset;S(r,t),u.sub(r,r,e)},drawLineCanvasDebug:function(t,e,i,r){this._debugNode.setNodeMask(y.NO_PICK);var n=this._debugNode.getChildren()[0].getAttributes().Vertex;n.getElements()[0]=t/this._canvas.clientWidth*2-1,n.getElements()[1]=(this._canvas.clientHeight-e)/this._canvas.clientHeight*2-1,n.getElements()[2]=i/this._canvas.clientWidth*2-1,n.getElements()[3]=(this._canvas.clientHeight-r)/this._canvas.clientHeight*2-1,n.dirty()},pickAndSelect:function(t){this.setNodeMask(0);var e=this.computeNearestIntersection(t,this._tmask);this._autoInsertMT?this.attachToGeometry(e?e.nodepath[e.nodepath.length-1]:e):this.attachToNodePath(e?e.nodepath:e)},onMouseUp:function(t){var e=this._viewer._eventProxy.StandardMouseKeyboard;e._enable===!1&&(e._enable=!0,this._viewer._eventProxy.StandardMouseKeyboard.mouseup(t)),this._debugNode&&this._debugNode.setNodeMask(0);var i=u.create();S(i,t),0===u.distance(i,this._downCanvasCoord)&&this.pickAndSelect(t),this._showAngle.setNodeMask(0),this._isEditing=!1,this._hoverNode&&this.updateGizmoMask()},onMouseMove:function(t){if(this._attachedNode){var e;if(this._isEditing===!1)return e=this.pickGizmo(t,y.PICK_GIZMO),void this.onNodeHovered(e);if(this._hoverNode){var i=this._hoverNode.getParents()[0];i===this._rotateNode?this.updateRotateEdit(t):i===this._translateNode?this.updateTranslateEdit(t):i===this._planeNode&&this.updatePlaneEdit(t)}}},updateRotateEdit:function(){var t=d.create(),e=u.create(),i=c.fromValues(1,0,0),r=c.fromValues(0,1,0),n=c.fromValues(0,0,1);return function(a){var s=this._editLineOrigin,o=this._editLineDirection;S(e,a),u.sub(e,e,s);var h=u.dot(e,o);this._debugNode&&this.drawLineCanvasDebug(s[0],s[1],s[0]+o[0]*h,s[1]+o[1]*h);var c=7*h/Math.min(this._canvas.clientWidth,this._canvas.clientHeight);c%=2*Math.PI;var l=this._hoverNode._nbAxis;0===l?d.fromRotation(t,-c,i):1===l?d.fromRotation(t,-c,r):2===l&&d.fromRotation(t,-c,n),this._showAngle.getOrCreateStateSet().getUniform("uAngle").setFloat(0===l?-c:c),this._rotateInLocal||(d.mul(t,this._editInvWorldScaleRot,t),d.mul(t,t,this._editWorldScaleRot)),d.mul(this._attachedNode.getMatrix(),this._editLocal,t),this._attachedNode.dirtyBound()}}(),updateTranslateEdit:function(){var t=u.create(),e=c.create();return function(i){var r=this._editLineOrigin,n=this._editLineDirection;S(t,i),u.sub(t,t,r),u.sub(t,t,this._editOffset);var a=u.dot(t,n);t[0]=r[0]+n[0]*a,t[1]=r[1]+n[1]*a,this._debugNode&&this.drawLineCanvasDebug(r[0],r[1],t[0],t[1]);var s=this._viewer,o=this._canvas,h=t[0]*(s._canvasWidth/o.clientWidth),l=(o.clientHeight-t[1])*(s._canvasHeight/o.clientHeight);if(this._lsi.reset(),this._lsi.setTestPlane(!1),this._lsi.set(c.set(this._origIntersect,h,l,0),c.set(this._dstIntersect,h,l,1)),this._iv.reset(),this._iv.setTraversalMask(this._hoverNode.getNodeMask()),d.copy(this.getMatrix(),this._editWorldTrans),this.setOnlyGizmoPicking(),this._viewer._camera.accept(this._iv),this.setOnlyScenePicking(),this._translateInLocal){d.getScale(e,this._editInvWorldScaleRot);var f=this._lsi.getTranslateDistance();c.mul(e,e,f)}else c.transformMat4(e,this._lsi.getTranslateDistance(),this._editInvWorldScaleRot);d.translate(this._attachedNode.getMatrix(),this._editLocal,e),this._attachedNode.dirtyBound()}}(),updatePlaneEdit:function(){var t=u.create(),e=c.create();return function(i){S(t,i),u.sub(t,t,this._editOffset);var r=this._viewer,n=this._canvas,a=t[0]*(r._canvasWidth/n.clientWidth),s=(n.clientHeight-t[1])*(r._canvasHeight/n.clientHeight);if(this._lsi.reset(),this._lsi.setTestPlane(!0),this._lsi.set(c.set(this._origIntersect,a,s,0),c.set(this._dstIntersect,a,s,1)),this._iv.reset(),this._iv.setTraversalMask(this._hoverNode.getNodeMask()),d.copy(this.getMatrix(),this._editWorldTrans),this.setOnlyGizmoPicking(),this._viewer._camera.accept(this._iv),this.setOnlyScenePicking(),this._translateInLocal){d.getScale(e,this._editInvWorldScaleRot);var o=this._lsi.getTranslateDistance();c.mul(e,e,o)}else c.transformMat4(e,this._lsi.getTranslateDistance(),this._editInvWorldScaleRot);d.translate(this._attachedNode.getMatrix(),this._editLocal,e),this._attachedNode.dirtyBound()}}()}),t.exports=y},function(t,e,i){"use strict";var r,n,a,s=i(48),o=i(37),h=i(46),u=i(86),c=i(45),l=i(103),d=i(104),f=["#ifdef GL_ES","precision highp float;","#endif"].join("\n"),p=function(){if(r)return r;var t="#define SHADER_NAME GizmoLine3D",e=[f,"attribute vec3 Vertex;","uniform mat4 uModelViewMatrix;","uniform mat4 uProjectionMatrix;",t,"","void main(void) {","  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex, 1.0);","}"].join("\n"),i=[f,"uniform vec4 uColor;",t,"","void main(void) {","  gl_FragColor = uColor;","}"].join("\n");return r=new l(new d(d.VERTEX_SHADER,e),new d(d.FRAGMENT_SHADER,i))},_=function(){if(n)return n;var t="#define SHADER_NAME GizmoLine2D",e=[f,"attribute vec2 Vertex;",t,"","void main(void) {","  gl_Position = vec4(Vertex, 0.0, 1.0);","}"].join("\n"),i=[f,t,"","void main(void) {","  gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);","}"].join("\n");return n=new l(new d(d.VERTEX_SHADER,e),new d(d.FRAGMENT_SHADER,i))},g=function(){if(a)return a;var t="#define SHADER_NAME GizmoQuadCircle",e=[f,"attribute vec3 Vertex;","uniform mat4 uModelViewMatrix;","uniform mat4 uProjectionMatrix;","varying vec3 vViewVertex;",t,"","void main(void) {","  vViewVertex = Vertex;","  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex, 1.0);","}"].join("\n"),i=[f,"uniform float uAngle;","uniform vec3 uBase;","varying vec3 vViewVertex;","const float PI = 3.14159265358979323846264;","const float PI2 = PI * 2.0;",t,"","void main(void) {","  if(length(vViewVertex) > 0.5)","    discard;","  vec3 vn = normalize(vViewVertex);","  float angle = atan(uBase.y * vn.x - uBase.x * vn.y, dot(uBase, vn));","  if(angle > 0.0) {","    if(uAngle >= 0.0 && angle > uAngle) discard;","    if(uAngle < -PI && angle < uAngle + PI2) discard;","    if(uAngle < 0.0 && uAngle > -PI) discard;","  }","  if(angle < 0.0) {","    if(uAngle <= 0.0 && angle < uAngle) discard;","    if(uAngle > PI && angle > uAngle - PI2) discard;","    if(uAngle > 0.0 && uAngle < PI) discard;","  }","  gl_FragColor = vec4(1.0, 1.0, 0.0, 0.5);","}"].join("\n");return a=new l(new d(d.VERTEX_SHADER,e),new d(d.FRAGMENT_SHADER,i))},m=function(){var t=new o;t.getAttributes().Vertex=new s(s.ARRAY_BUFFER,new Float32Array(4),2);var e=new u(h.LINES,0,2);return t.getPrimitives().push(e),t.getOrCreateStateSet().setAttributeAndModes(_()),t},v=function(t,e,i,r,n){var a=void 0!==t?t:1,u=void 0!==e?e:.2,l=void 0!==i?i:6,d=void 0!==r?r:64,f=void 0!==n?n:2*Math.PI,_=(l+1)*(d+1),g=l*d*2,m=new o,v=new Float32Array(3*_),S=new Uint16Array(3*g);f=f||2*Math.PI;var x=0,b=0,M=0,y=0;for(y=0;y<=l;++y)for(M=0;M<=d;++M){var T=M/d*f,w=y/l*Math.PI*2;b=3*x,v[b]=(a+u*Math.cos(w))*Math.cos(T),v[b+1]=(a+u*Math.cos(w))*Math.sin(T),v[b+2]=u*Math.sin(w),x++}for(x=0,y=1;y<=l;++y)for(M=1;M<=d;++M)b=6*x,S[b]=(d+1)*y+M-1,S[b+1]=S[b+3]=(d+1)*(y-1)+M-1,S[b+2]=S[b+5]=(d+1)*y+M,S[b+4]=(d+1)*(y-1)+M,x++;return m.getAttributes().Vertex=new s(s.ARRAY_BUFFER,v,3),m.getOrCreateStateSet().setAttributeAndModes(p()),m.getPrimitives().push(new c(h.TRIANGLES,new s(s.ELEMENT_ARRAY_BUFFER,S,1))),m},S=function(t,e,i,r,n,a,u){var l=void 0!==t?t:1,d=void 0!==e?e:1,f=void 0!==i?i:5,_=void 0!==r?r:32,g=void 0!==n?n:1,m=void 0===a||a,v=void 0===u||u;m=m&&l>0,v=v&&d>0;var S=.5*f,x=(g+1)*(_+1),b=g*_*2;m&&(x+=1,b+=_),v&&(x+=1,b+=_);var M=new o,y=new Float32Array(3*x),T=new Uint16Array(3*b),w=0,C=0,A=0,E=0;for(A=0;A<=g;A++){var I=A/g,F=I*(d-l)+l;for(E=0;E<=_;E++){var R=E/_;C=3*w,y[C]=F*Math.sin(R*Math.PI*2),y[C+1]=F*Math.cos(R*Math.PI*2),y[C+2]=-I*f+S,w++}}for(w=0,E=0;E<_;E++)for(A=0;A<g;A++)C=6*w,T[C]=(_+1)*A+E,T[C+1]=T[C+3]=(_+1)*(A+1)+E,T[C+2]=T[C+5]=(_+1)*A+E+1,T[C+4]=(_+1)*(A+1)+E+1,w++;w*=2;var N;if(m)for(N=(v?y.length-6:y.length-3)/3,y[3*N+2]=S,E=0;E<_;E++)C=3*w,T[C]=E,T[C+1]=E+1,T[C+2]=N,w++;if(v){N=(y.length-3)/3,y[3*N+2]=-S;var D=(_+1)*A;for(E=0;E<_;E++)C=3*w,T[C]=D+E+1,T[C+1]=D+E,T[C+2]=N,w++}return M.getAttributes().Vertex=new s(s.ARRAY_BUFFER,y,3),M.getOrCreateStateSet().setAttributeAndModes(p()),M.getPrimitives().push(new c(h.TRIANGLES,new s(s.ELEMENT_ARRAY_BUFFER,T,1))),M},x=function(t,e,i){for(var r=new o,n=new Float32Array(3*t),a=i||2*Math.PI,c=0;c<t;++c){var l=3*c,d=a*c/t;n[l]=Math.cos(d)*e,n[l+1]=Math.sin(d)*e}r.getAttributes().Vertex=new s(s.ARRAY_BUFFER,n,3);var f=new u(h.LINE_STRIP,0,t);return r.getOrCreateStateSet().setAttributeAndModes(p()),r.getPrimitives().push(f),r},b=function(t,e){var i=t?.5*t:.5,r=e?.5*e:.5,n=new o,a=new Float32Array(12);a[0]=-i,a[1]=-r,a[3]=i,a[4]=-r,a[6]=-i,a[7]=r,a[9]=i,a[10]=r,n.getAttributes().Vertex=new s(s.ARRAY_BUFFER,a,3);var c=new u(h.TRIANGLE_STRIP,0,4);return n.getOrCreateStateSet().setAttributeAndModes(p()),n.getPrimitives().push(c),n},M=function(){var t=b();return t.getOrCreateStateSet().setAttributeAndModes(g()),t},y={};y.createCircleGeometry=x,y.createCylinderGeometry=S,y.createTorusGeometry=v,y.createDebugLineGeometry=m,y.createPlaneGeometry=b,y.createQuadCircleGeometry=M,t.exports=y},function(t,e,i){"use strict";var r=i(6),n=i(10),a=i(41),s=i(32),o=function(t){void 0!==t&&(void 0!==t.object&&void 0!==t.field&&this.createInternalSlider(t),this._uniform=this.createInternalSliderUniform(t))};o.prototype={setTargetHTML:function(t){this.parent=t},addToDom:function(t){var e=document.createElement("div");e.innerHTML=t,this.parent.appendChild(e)},getValue:function(t){if(window.localStorage){var e=window.localStorage.getItem(t);return e}return null},setValue:function(t,e){window.localStorage&&window.localStorage.setItem(t,e)},createHTMLSlider:function(t,e,i,r){var n='<div>NAME [ MIN - MAX ] <input type="range" min="MIN" max="MAX" value="VALUE" step="STEP" onchange="ONCHANGE" /><span id="UPDATE"></span></div>',a=t.min,s=t.max,o=t.step,h=i,u=r,c=u+"(this.value)";return n=n.replace(/MIN/g,a),n=n.replace(/MAX/g,s+o),n=n.replace("STEP",o),n=n.replace("VALUE",e),n=n.replace(/NAME/g,h),n=n.replace(/UPDATE/g,u),n=n.replace("ONCHANGE",c)},createUniformFunction:function(t,e,i,r,a){var s=this;return function(){var o=e,h=i,u=r,c=a,l=function(e){u.get()[h]=e,u.dirty(),n.debug(o+" value "+e),document.getElementById(a).innerHTML=Number(e).toFixed(4),s.setValue(c,e),void 0!==t.onchange&&t.onchange(u.get())};return l}()},createFunction:function(t,e,i,r,a,s){var o=this;return function(){var h=e,u=a,c=s,l=r,d=function(e){"string"==typeof e&&(e=parseFloat(e)),"number"==typeof r[u]?l[u]=e:l[u][i]=e,n.debug(h+" value "+e),document.getElementById(s).innerHTML=Number(e).toFixed(4),o.setValue(c,e),void 0!==t.onchange&&t.onchange(l[u])};return d}()},getCallbackName:function(t,e){return"change_"+e+"_"+t},copyDefaultValue:function(t){var e=t.value;return e=Array.isArray(t.value)?t.value.slice():[e]},createInternalSliderUniform:function(t){var e=t.value,i=t.uniform;if(void 0===i){var r=t.type;r=r.charAt(0).toUpperCase()+r.slice(1),i=a["create"+r](e,t.name)}for(var s=this.getCallbackName(t.name,t.id),o=e.length,h=0;h<o;h++){var u=h.toString(),c=t.name+u,l=s+u,d=e[h],f=this.getValue(l);null!==f?d=f:t.uniform&&void 0!==t.uniform.get()[h]&&(d=t.uniform.get()[h]);var p=this.createHTMLSlider(t,d,c,l);this.addToDom(p),window[l]=this.createUniformFunction(t,c,h,i,l),n.log(c+" "+d),window[l](d)}return this.uniform=i,i},createInternalSlider:function(t){for(var e=t.value,i=t.name,r=t.id,a=e.length,s=this.getCallbackName(i,r),o=t.object,h=t.field,u=0;u<a;u++){var c=u.toString(),l=i+c,d=s+c,f=e[u],p=this.getValue(d);f=null!==p?p:"number"==typeof o[h]?o[h]:o[h][u];var _=this.createHTMLSlider(t,f,l,d);this.addToDom(_),window[d]=this.createFunction(t,l,u,o,h,d),n.log(l+" "+f),window[d](f)}},createSlider:function(t){return void 0!==t.html&&this.setTargetHTML(t.html),void 0===t.id&&(t.id=t.name),t.value=this.copyDefaultValue(t),void 0!==t.type?this.createInternalSliderUniform(t):(void 0===t.object&&(t.object={data:t.value},t.field="data"),this.createInternalSlider(t))}};var h=function(){s.call(this),this.arraySlider=new o,this.setTargetHTML(document.body)};h.createSlider=function(t){(new o).createSlider(t)},h.prototype=r.objectInherit(s.prototype,{setTargetHTML:function(t){this.targetHTML=t,this.arraySlider.setTargetHTML(this.targetHTML)},getUniformList:function(t,e){var i="(uniform)",r=".*?",n="((?:[a-z][a-z]+))",a=".*?",s="((?:[a-z][a-z]+))",o=".*?",h=".",u=".*?",c=".",l=".*?",d="(.)",f="(.)",p=".*?",_="(\\{.*?\\})",g=new RegExp(i+r+n+a+s+o+h+u+c+l+d+f+p+_,["g"]),m=t.match(g),v=e,S=function(t){return function(){return t}};if(null!==m)for(var x=new RegExp(i+r+n+a+s+o+h+u+c+l+d+f+p+_,["i"]),b=0,M=m.length;b<M;b++){var y=m[b].match(x);if(null!==y){var T=y[2],w=y[3],C=y[6],A=JSON.parse(C);A.type=T,A.name=w;var E=A.value;A.value=S(E),v[w]=A}}return v},getUniformFromStateSet:function(t,e){var i=t.getUniformList();if(i)for(var r=window.Object.keys(e),n=0,a=r.length;n<a;n++){var s=r[n];void 0!==i[s]&&void 0===e[s].uniform&&(e[s].uniform=i[s].object)}},findExistingUniform:function(t,e){var i=function(){s.call(this,s.TRAVERSE_PARENTS)};i.prototype=r.objectInherit(s.prototype,{setUniformMap:function(t){this.uniformMap=t},apply:function(t){var e=t.getStateSet();e&&h.prototype.getUniformFromStateSet(e,this.uniformMap),this.traverse(t)}});var n=new i;n.setUniformMap(e),t.accept(n)},applyProgram:function(t,e){var i=e.getAttribute("Program"),r=i.getName(),a={};this.getUniformList(i.getVertexShader().getText(),a),this.getUniformList(i.getFragmentShader().getText(),a);var s=0,o=window.Object.keys(a);if(void 0===r){var h=function(t){var e=0,i=0;if(0===t.length)return e;for(s=0;s<t.length;s++)i=t.charCodeAt(s),e=(e<<5)-e+i,e&=e;return e<0&&(e=-e),e},u=o.join("");r=h(u).toString()}this.findExistingUniform(t,a);var c=!1;for(s=0;s<o.length;s++){var l=o[s],d=a[l];d.type,d.name;d.id=r;var f=this.arraySlider.createSlider(d);void 0===d.uniform&&f&&e.addUniform(f),c=!0}if(c){var p=document.createElement("div");p.innerHTML="<p> </p>",this.targetHTML.appendChild(p)}n.log(a)},applyStateSet:function(t,e){void 0!==e.getAttribute("Program")&&this.applyProgram(t,e)},apply:function(t){var e=this.targetHTML;if(void 0!==e&&null!==e){var i=t.getStateSet();void 0!==i&&this.applyStateSet(t,i),this.traverse(t)}}}),t.exports=h},function(t,e,i){"use strict";var r=i(15).vec3,n=i(15).mat4,a=i(96),s=function(){this._center=r.create(),this._iCenter=r.create(),this._radius=1,this._iRadius=1,this._intersections=[]};s.prototype={set:function(t,e){r.copy(this._center,t),r.copy(this._iCenter,t),this._radius=this._iRadius=e,this.reset()},setCenter:function(t){r.copy(this._center,t),r.copy(this._iCenter,t)},setRadius:function(t){this._radius=this._iRadius=t},reset:function(){this._intersections.length=0},enter:function(t){return!t.isCullingActive()||this.intersects(t.getBound())},intersects:function(t){if(!t.valid())return!1;var e=this._iRadius+t.radius();return r.sqrDist(t.center(),this._iCenter)<=e*e},intersect:function(){var t=new a;return function(e,i){var r=i.getShape();if(r)return r.intersectSphere(this._iCenter,this._iRadius,this._intersections,e.nodePath);if(t.reset(),t.setNodePath(e.nodePath),t.set(this._iCenter,this._iRadius),i.computeTransformedVertices){var n=i.getVertexAttributeList(),a=n.Vertex.getElements();n.Vertex._elements=i.computeTransformedVertices(),t.apply(i),n.Vertex._elements=a}else t.apply(i);for(var s=t._intersections.length,o=0;o<s;o++)this._intersections.push(t._intersections[o]);return s>0}}(),getIntersections:function(){return this._intersections},setCurrentTransformation:function(){var t=r.create();return function(e){n.invert(e,e),r.transformMat4(this._iCenter,this._center,e),this._iRadius=this._radius*n.getScale(t,e)[0]}}()},t.exports=s},function(t,e,i){"use strict";var r=i(6),n=i(48),a=i(37),s=i(32),o=i(46),h=i(15).vec3,u=r,c=function(){s.call(this),this._T=void 0,this._B=void 0,this._N=void 0,this._texCoordUnit=0};c.prototype=r.objectInherit(s.prototype,{apply:function(t){t.getTypeID()===a.getTypeID()?this.generate(t,this._texCoordUnit):this.traverse(t)},setTexCoordUnit:function(t){this._texCoordUnit=t},computePrimitiveSet:function(t,e){if(e.getIndices){var i,r=e.getNumIndices(),n=t.getAttributes().Vertex,a=t.getAttributes().Normal,s=t.getAttributes()["TexCoord"+this._texCoordUnit];if(e.getMode()===o.TRIANGLES)for(i=0;i<r;i+=3)this.compute(e,n,a,s,i,i+1,i+2);else if(e.getMode()===o.TRIANGLE_STRIP)for(i=0;i<r-2;++i)i%2===0?this.compute(e,n,a,s,i,i+1,i+2):this.compute(e,n,a,s,i+1,i,i+2)}},generate:function(t,e){this._texCoordUnit=e,void 0===this._texCoordUnit&&(this._texCoordUnit=0);var i=t.getAttributes().Vertex.getElements().length;this._T=new u.Float32Array(i),this._B=new u.Float32Array(i),this._N=new u.Float32Array(i),t.getPrimitiveSetList().forEach(function(e){this.computePrimitiveSet(t,e)},this);for(var r=i/3,a=new u.Float32Array(4*r),s=h.create(),o=h.create(),c=h.create(),l=0;l<r;l++){var d=this._T.subarray(3*l,3*l+3),f=this._N.subarray(3*l,3*l+3),p=this._B.subarray(3*l,3*l+3);h.normalize(f,f);var _=h.dot(f,d);h.scale(o,f,_),h.sub(s,d,o),h.normalize(c,s),h.cross(s,f,d);var g=h.dot(s,p);g=g<0?-1:0,a[4*l]=c[0],a[4*l+1]=c[1],a[4*l+2]=c[2],a[4*l+3]=g}t.getAttributes().Normal.setElements(this._N),t.getAttributes().Tangent=new n("ARRAY_BUFFER",a,4)},compute:function(t,e,i,r,n,a,s){var o,u,c=t.index(n),l=t.index(a),d=t.index(s),f=e.getElements().subarray(3*c,3*c+3),p=e.getElements().subarray(3*l,3*l+3),_=e.getElements().subarray(3*d,3*d+3),g=i.getElements().subarray(3*c,3*c+3),m=i.getElements().subarray(3*l,3*l+3),v=i.getElements().subarray(3*d,3*d+3),S=r.getElements().subarray(2*c,2*c+2),x=r.getElements().subarray(2*l,2*l+2),b=r.getElements().subarray(2*d,2*d+2),M=h.create(),y=h.create(),T=h.create(),w=h.create(),C=h.create(),A=h.create(),E=h.create(),I=h.create(),F=h.create();h.set(I,p[0]-f[0],x[0]-S[0],x[1]-S[1]),h.set(F,_[0]-f[0],b[0]-S[0],b[1]-S[1]),h.cross(M,I,F),0!==M[0]&&(h.normalize(M,M),u=-M[1]/M[0],o=-M[2]/M[0],C[0]+=u,y[0]+=o,A[0]+=u,T[0]+=o,E[0]+=u,w[0]+=o),h.set(I,p[1]-f[1],x[0]-S[0],x[1]-S[1]),h.set(F,_[1]-f[1],b[0]-S[0],b[1]-S[1]),h.cross(M,I,F),0!==M[0]&&(h.normalize(M,M),u=-M[1]/M[0],o=-M[2]/M[0],C[1]+=u,y[1]+=o,A[1]+=u,T[1]+=o,E[1]+=u,w[1]+=o),h.set(I,p[2]-f[2],x[0]-S[0],x[1]-S[1]),h.set(F,_[2]-f[2],b[0]-S[0],b[1]-S[1]),h.cross(M,I,F),0!==M[0]&&(h.normalize(M,M),u=-M[1]/M[0],o=-M[2]/M[0],C[2]+=u,y[2]+=o,A[2]+=u,T[2]+=o,E[2]+=u,w[2]+=o);var R,N,D,L=h.create(),P=h.create();h.cross(L,g,C),h.cross(P,L,g),R=this._T.subarray(3*c,3*c+3),h.add(R,P,R),h.cross(L,y,g),h.cross(P,g,L),N=this._B.subarray(3*c,3*c+3),h.add(N,P,N),h.cross(L,m,A),h.cross(P,L,m),R=this._T.subarray(3*l,3*l+3),h.add(R,P,R),h.cross(L,T,m),h.cross(P,m,L),N=this._B.subarray(3*l,3*l+3),h.add(N,P,N),h.cross(L,v,E),h.cross(P,L,v),R=this._T.subarray(3*d,3*d+3),h.add(R,P,R),h.cross(L,w,v),h.cross(P,v,L),N=this._B.subarray(3*d,3*d+3),h.add(N,P,N),D=this._N.subarray(3*c,3*c+3),h.add(D,g,D),D=this._N.subarray(3*l,3*l+3),h.add(D,m,D),D=this._N.subarray(3*d,3*d+3),h.add(D,v,D)}}),t.exports=c},function(t,e,i){"use strict";var r=i(52),n=i(67),a=i(15).mat4,s=i(12),o=i(103),h=i(104),u=i(105),c=i(40),l=i(11),d=i(41),f=i(15).vec2,p=i(15).vec3,_=i(15).vec4,g=i(110),m=i(166),v={},S=function(t,e,i,r,n){this._viewer=t,this._rttScene=e,this._hmdConfig=i,this._root=r,this._canvas=n,this._width=n.width,this._height=n.height};S.prototype={update:function(){var t=this._canvas,e=t.width,i=t.height;if(e!==this._width||i!==this._height){this._root.removeChildren();var r=this._hmdConfig;r&&r.isCardboard&&(r.hResolution=e,r.vResolution=i),this._width=e,this._height=i,v.createScene(this._viewer,this._rttScene,r,this._root)}return!0}};var x=function(t,e){this._rootView=t,this._offsetView=e};x.prototype={update:function(t){var e=t.getViewMatrix();return a.mul(e,this._offsetView,this._rootView),!0}};var b=function(t,e,i,r){var n=e.hResolution/(2*e.vResolution),s=-1-4*(.25*e.hScreenSize-.5*e.lensSeparationDistance)/e.hScreenSize,o=e.distortionK[0]+e.distortionK[1]*Math.pow(s,2)+e.distortionK[2]*Math.pow(s,4)+e.distortionK[3]*Math.pow(s,6),h=180/Math.PI*2*Math.atan2(e.vScreenSize*o,2*e.eyeToScreenDistance),u=a.perspective(a.create(),Math.PI/180*h,n,.3,1e4),c=4*(.25*e.hScreenSize-.5*e.interpupillaryDistance)/e.hScreenSize,l=4*(.25*e.hScreenSize-.5*e.lensSeparationDistance)/e.hScreenSize,d=a.create(),_=a.create();r.projectionLeft=a.mul(d,a.fromTranslation(d,p.fromValues(c,0,0)),u),r.projectionRight=a.mul(_,a.fromTranslation(_,p.fromValues(-c,0,0)),u),r.viewLeft=a.fromTranslation(a.create(),p.fromValues(t*e.interpupillaryDistance*.5,0,0)),r.viewRight=a.fromTranslation(a.create(),p.fromValues(-t*e.interpupillaryDistance*.5,0,0)),i.lensCenterLeft=f.fromValues(l,0),i.lensCenterRight=f.fromValues(-l,0),i.hmdWarpParam=e.distortionK,i.chromAbParam=e.chromaAbParameter,i.scaleIn=f.fromValues(1,1/n),i.scale=f.fromValues(1/o,1*n/o)},M=function(){var t=["","#ifdef GL_ES","precision highp float;","#endif","uniform vec2 uScale;","uniform vec2 uScaleIn;","uniform vec2 uLensCenter;","uniform vec4 uHmdWarpParam;","uniform vec4 uChromAbParam;","uniform sampler2D Texture0;","varying vec2 vTexCoord0;","void main(void) {","  vec2 uv = (vTexCoord0 * 2.0) - 1.0;","  vec2 theta = (uv - uLensCenter) * uScaleIn;","  float rSq = theta.x * theta.x + theta.y * theta.y;","  vec2 rvector = theta * (uHmdWarpParam.x + uHmdWarpParam.y * rSq + uHmdWarpParam.z * rSq * rSq + uHmdWarpParam.w * rSq * rSq * rSq);","  vec2 rBlue = rvector * (uChromAbParam.z + uChromAbParam.w * rSq);","  vec2 tcBlue = (uLensCenter + uScale * rBlue);","  tcBlue = (tcBlue + 1.0) * 0.5;","  if (any(bvec2(clamp(tcBlue, vec2(0.0, 0.0), vec2(1.0, 1.0)) - tcBlue))) {","    gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","    return;","  }","  vec2 tcGreen = uLensCenter + uScale * rvector;","  tcGreen = (tcGreen + 1.0) * 0.5;","  vec2 rRed = rvector * (uChromAbParam.x + uChromAbParam.y * rSq);","  vec2 tcRed = uLensCenter + uScale * rRed;","  tcRed = (tcRed + 1.0) * 0.5;","  gl_FragColor = vec4(texture2D(Texture0, tcRed).r, texture2D(Texture0, tcGreen).g, texture2D(Texture0, tcBlue).b, 1);","}",""].join("\n");
return new o(new h(h.VERTEX_SHADER,m.Filter.defaultVertexShader),new h(h.FRAGMENT_SHADER,t))},y=function(t){var e=new c;return e.setTextureSize(t[0],t[1]),e.setMinFilter("LINEAR"),e.setMagFilter("LINEAR"),e},T=function(t,e,i,n,s,o){var h=new r,u=e[0],c=e[1],f=i[0],p=i[1];n===!0?t?h.setViewport(new g(0,0,f/2,p)):h.setViewport(new g(f/2,0,f/2,p)):t?h.setViewport(new g(.5*f-u,.5*(p-c),u,c)):h.setViewport(new g(.5*f,.5*(p-c),u,c)),a.ortho(h.getProjectionMatrix(),-.5,.5,-.5,.5,-5,5),h.setRenderOrder(r.NESTED_RENDER,0),h.setReferenceFrame(l.ABSOLUTE_RF);var _=h.getOrCreateStateSet();return _.setTextureAttributeAndModes(0,s),_.setAttributeAndModes(M()),_.addUniform(d.createFloat2(o.scale,"uScale")),_.addUniform(d.createFloat2(o.scaleIn,"uScaleIn")),_.addUniform(d.createFloat2(t?o.lensCenterLeft:o.lensCenterRight,"uLensCenter")),_.addUniform(d.createFloat4(o.hmdWarpParam,"uHmdWarpParam")),_.addUniform(d.createFloat4(o.chromAbParam,"uChromAbParam")),h},w=function(t,e){var i=new r;return i.setName("rtt camera"),i.setViewport(new g(0,0,t.getWidth(),t.getHeight())),i.setProjectionMatrix(e),i.setClearColor(_.fromValues(.3,.3,.3,0)),i.setRenderOrder(r.POST_RENDER,0),i.attachTexture(n.COLOR_ATTACHMENT0,t),i.attachRenderBuffer(n.DEPTH_ATTACHMENT,n.DEPTH_COMPONENT16),i.setReferenceFrame(l.ABSOLUTE_RF),i};v.createScene=function(t,e,i,r,n){var a=v.getDefaultConfig(i),o=f.fromValues(.5*a.hResolution,a.vResolution),h=f.fromValues(.5*a.hResolution,a.vResolution),c=t.getCamera().getViewport(),l=f.fromValues(c.width(),c.height()),d=t.getGraphicContext().canvas;a.isCardboard&&(l[0]=d.width,l[1]=d.height);var p=void 0!==n?n:1,_={},g={};b(p,a,_,g);var m=t.getCamera().getViewMatrix(),M=r||new s;M.addUpdateCallback(new S(t,e,i,M,d));var C=y(o),A=w(C,g.projectionLeft),E=T(!0,h,l,a.isCardboard,C,_);A.addUpdateCallback(new x(m,g.viewLeft));var I=y(o),F=w(I,g.projectionRight),R=T(!1,h,l,a.isCardboard,I,_);return F.addUpdateCallback(new x(m,g.viewRight)),A.addChild(e),F.addChild(e),E.addChild(u.createTexturedFullScreenFakeQuadGeometry()),R.addChild(u.createTexturedFullScreenFakeQuadGeometry()),M.addChild(A),M.addChild(F),M.addChild(E),M.addChild(R),M},v.getDefaultConfig=function(t){var e={hResolution:1920,vResolution:1080,hScreenSize:.1296,vScreenSize:.0729,interpupillaryDistance:.064,lensSeparationDistance:.0635,eyeToScreenDistance:.04,distortionK:_.fromValues(1,.22,.13,.02),chromaAbParameter:_.fromValues(.996,-.004,1.014,0),isCardboard:!1};return 2===t||void 0===t?e:1===t?(e.hResolution=1280,e.vResolution=800,e.hScreenSize=.14976,e.vScreenSize=.0936,e.lensSeparationDistance=.064,e.eyeToScreenDistance=.041,e.distortionK=_.fromValues(1,.22,.24,0),e):(void 0!==t.hResolution&&(e.hResolution=t.hResolution),void 0!==t.vResolution&&(e.vResolution=t.vResolution),void 0!==t.hScreenSize&&(e.hScreenSize=t.hScreenSize),void 0!==t.vScreenSize&&(e.vScreenSize=t.vScreenSize),void 0!==t.interpupillaryDistance&&(e.interpupillaryDistance=t.interpupillaryDistance),void 0!==t.lensSeparationDistance&&(e.lensSeparationDistance=t.lensSeparationDistance),void 0!==t.eyeToScreenDistance&&(e.eyeToScreenDistance=t.eyeToScreenDistance),void 0!==t.distortionK&&(e.distortionK=t.distortionK),void 0!==t.chromaAbParameter&&(e.chromaAbParameter=t.chromaAbParameter),void 0!==t.isCardboard&&(e.isCardboard=t.isCardboard),e)},t.exports=v},function(t,e,i){"use strict";var r=i(52),n=i(67),a=i(15).mat4,s=i(12),o=i(103),h=i(104),u=i(105),c=i(40),l=i(11),d=i(41),f=i(15).vec3,p=i(15).vec4,_=i(110),g=i(166),m=function(t,e){this._rootView=t,this._offsetView=e};m.prototype={update:function(t){var e=t.getViewMatrix();return a.mul(e,this._offsetView,this._rootView),!0}};var v=function(t){var e=new c;return e.setTextureSize(t.width,t.height),e.setMinFilter("LINEAR"),e.setMagFilter("LINEAR"),e},S=function(){var t=["#ifdef GL_ES","   precision highp float;","#endif","varying vec2 vTexCoord0;","uniform sampler2D TextureLeft;","uniform sampler2D TextureRight;","void main() {","   if (vTexCoord0.x < 0.5)","       gl_FragColor = texture2D(TextureLeft, vec2(vTexCoord0.x * 2.0, vTexCoord0.y));","   else","       gl_FragColor = texture2D(TextureRight, vec2(vTexCoord0.x * 2.0 - 1.0, vTexCoord0.y));","}"].join("\n");return new o(new h(h.VERTEX_SHADER,g.Filter.defaultVertexShader),new h(h.FRAGMENT_SHADER,t))},x=function(t,e,i){var n=new r;n.setViewport(i),n.setRenderOrder(r.NESTED_RENDER,0),n.setReferenceFrame(l.ABSOLUTE_RF),a.ortho(n.getProjectionMatrix(),0,1,0,1,-5,5);var s=n.getOrCreateStateSet();return s.addUniform(d.createInt(0,"TextureLeft")),s.addUniform(d.createInt(1,"TextureRight")),s.setTextureAttributeAndModes(0,t),s.setTextureAttributeAndModes(1,e),s.setAttributeAndModes(S()),n.addChild(u.createTexturedFullScreenFakeQuadGeometry()),n},b=function(t,e){var i=new r;return i.setName("rtt camera"),i.setViewport(new _(0,0,t.getWidth(),t.getHeight())),i.setProjectionMatrix(e),i.setClearColor(p.fromValues(.3,.3,.3,0)),i.setRenderOrder(r.POST_RENDER,0),i.attachTexture(n.COLOR_ATTACHMENT0,t),i.attachRenderBuffer(n.DEPTH_ATTACHMENT,n.DEPTH_COMPONENT16),i.setReferenceFrame(l.ABSOLUTE_RF),i},M={};M.createScene=function(t,e,i,r,n){var o=r||new s,h=void 0!==n?n:1,u=i.getEyeParameters("left"),c=i.getEyeParameters("right"),l=new window.VRFrameData;i.getFrameData(l);var d=a.fromTranslation(a.create(),f.fromValues(-h*u.offset[0],u.offset[1],u.offset[2])),p=a.fromTranslation(a.create(),f.fromValues(-h*c.offset[0],c.offset[1],c.offset[2])),_={width:Math.max(u.renderWidth,c.renderWidth),height:Math.max(u.renderHeight,c.renderHeight)},g=v(_),S=v(_),M=b(g,l.leftProjectionMatrix),y=b(S,l.rightProjectionMatrix),T=t.getCamera().getViewMatrix();M.addUpdateCallback(new m(T,d)),y.addUpdateCallback(new m(T,p));var w=x(g,S,t.getCamera().getViewport());return M.addChild(e),y.addChild(e),o.addChild(M),o.addChild(y),o.addChild(w),o},t.exports=M},function(t,e,i){"use strict";var r=i(218),n=i(219),a=i(229),s=i(232),o=i(220),h={};h.Renderer=r,h.View=n,h.Viewer=a,h.EventProxy=s,h.Scene=o,t.exports=h},function(module,exports,__webpack_require__){"use strict";var Notify=__webpack_require__(10),mat4=__webpack_require__(15).mat4,Options=__webpack_require__(230),P=__webpack_require__(90),Timer=__webpack_require__(9),TimerGPU=__webpack_require__(112),UpdateVisitor=__webpack_require__(109),MACROUTILS=__webpack_require__(6),Texture=__webpack_require__(40),OrbitManipulator=__webpack_require__(145),createStats=__webpack_require__(231),EventProxy=__webpack_require__(232),View=__webpack_require__(219),WebGLUtils=__webpack_require__(39),WebGLDebugUtils=__webpack_require__(241),requestFile=__webpack_require__(130),OptionsURL=function(){var t={};if(function(t){var e,i=[];if(window.location.search)for(var r=window.location.search.slice(1).split("&"),n=0;n<r.length;n++){e=r[n].split("=");var a=e[0];i.push(a);var s=e[1];void 0===s&&(s="1"),t[a]=s}}(t),void 0!==t.log){var e=t.log.toLowerCase();switch(e){case"debug":Notify.setNotifyLevel(Notify.DEBUG);break;case"info":Notify.setNotifyLevel(Notify.INFO);break;case"notice":Notify.setNotifyLevel(Notify.NOTICE);break;case"warn":Notify.setNotifyLevel(Notify.WARN);break;case"error":Notify.setNotifyLevel(Notify.ERROR);break;case"html":!function(){var t=[],e=document.createElement("div"),i=document.createElement("pre");document.addEventListener("DOMContentLoaded",function(){document.body.appendChild(e),e.appendChild(i)});var r=function(e){t.unshift(e),i.innerHTML=t.join("\n")};e.style.overflow="hidden",e.style.position="absolute",e.style.zIndex="10000",e.style.height="100%",e.style.maxWidth="600px",i.style.overflow="scroll",i.style.width="105%",i.style.height="100%",i.style.fontSize="10px",["log","error","warn","info","debug"].forEach(function(t){window.console[t]=r})}()}}return t}(),getGLSLOptimizer=function(){var deferOptimizeGLSL=P.defer();window.deferOptimizeGLSL=deferOptimizeGLSL;var mod=["        var Module = {","            preRun: [],","            postRun: [ function () {",'                var func = Module.cwrap( "optimize_glsl", "string", [ "string", "number", "number" ] );',"                window.deferOptimizeGLSL.resolve( func );","            } ],","            print: function ( text ) {","                Notify.debug( text );","            },","            printErr: function ( text ) {","                Notify.debug( text );","            },","            setStatus: function ( text ) {","                Notify.debug( text );","            },","            totalDependencies: 0,","            monitorRunDependencies: function ( left ) {","                this.totalDependencies = Math.max( this.totalDependencies, left );",'                Module.setStatus( left ? "GLSL optimizer preparing... (" + ( this.totalDependencies - left ) + "/" + this.totalDependencies + ")" : "All downloads complete." );',"            },",'            memoryInitializerPrefixURL: "https://raw.githubusercontent.com/zz85/glsl-optimizer/gh-pages/"',"        };"].join("\n");Notify.log("try to load glsl optimizer");var url="https://raw.githubusercontent.com/zz85/glsl-optimizer/gh-pages/glsl-optimizer.js",promise=requestFile(url);return promise.then(function(script){eval(mod+script)}).catch(function(){deferOptimizeGLSL.reject()}),deferOptimizeGLSL.promise},Viewer=function(t,e,i){View.call(this),this._startTick=Timer.instance().tick(),this._stats=void 0,this._done=!1,this._runPromise=P.resolve();var r=this.initOptions(e),n=this.initWebGLContext(t,r,i);if(!n)throw"No WebGL implementation found";MACROUTILS.init(),this.initDeviceEvents(r,t),this.initStats(r,t),this.initRun(r),this._updateVisitor=new UpdateVisitor,this.setUpView(n.canvas,r),this._hmd=null,this._requestAnimationFrame=window.requestAnimationFrame.bind(window),this._contextLost=!1};Viewer.prototype=MACROUTILS.objectInherit(View.prototype,{initDeviceEvents:function(t,e){var i=t.mouseEventNode||e,r=t.EventBackend||{};t.EventBackend||(t.EventBackend=r),r.StandardMouseKeyboard=t.EventBackend.StandardMouseKeyboard||{};var n=r.StandardMouseKeyboard.mouseEventNode||i;r.StandardMouseKeyboard.mouseEventNode=n,r.StandardMouseKeyboard.keyboardEventNode=r.StandardMouseKeyboard.keyboardEventNode||document,"ontouchstart"in window&&(r.Hammer=r.Hammer||{},r.Hammer.eventNode=r.Hammer.eventNode||i),r.GamePad=r.GamePad||{},this._eventProxy=this.initEventProxy(t)},initOptions:function(t){var e=new Options;return t&&e.extend(t),e.extend(OptionsURL),e.getBoolean("traceLogCall")===!0&&(Notify.traceLogCall=!0),e.getBoolean("enableFrustumCulling")===!0&&this.getCamera().getRenderer().getCullVisitor().setEnableFrustumCulling(!0),e},initWebGLContext:function(t,e,i){e.get("SimulateWebGLLostContext")&&(t=WebGLDebugUtils.makeLostContextSimulatingCanvas(t),t.loseContextInNCalls(e.get("SimulateWebGLLostContext")));var r=WebGLUtils.setupWebGL(t,e,i);return t.addEventListener("webglcontextlost",function(t){this.contextLost(),t.preventDefault()}.bind(this),!1),t.addEventListener("webglcontextrestored",function(){this.contextRestored()}.bind(this),!1),(Notify.reportWebGLError||e.get("reportWebGLError"))&&(r=WebGLDebugUtils.makeDebugContext(r)),this.initWebGLCaps(r),this.setGraphicContext(r),r},initRun:function(t){if(t.getBoolean("GLSLOptimizer")===!0){var e=__webpack_require__(104);e.enableGLSLOptimizer=!0,this._runPromise=getGLSLOptimizer(),this._runPromise.then(function(t){e.glslOptimizer=t,e.glslOptimizer?Notify.log("uses glsl optimizer, use ?log=info to see shader output"):Notify.error("failed to load glsl optimizer")}).catch(function(t){Notify.error(t)})}},setContextLostCallback:function(t){this._contextLostCallback=t,this._contextLost&&t()},contextLost:function(){Notify.log("webgl context lost"),this._contextLostCallback&&this._contextLostCallback(),this._contextLost=!0,window.cancelAnimationFrame(this._requestID)},contextRestored:function(){Notify.log("webgl context restored, but not supported - reload the page")},init:function(){},getUpdateVisitor:function(){return this._updateVisitor},getState:function(){return this.getCamera().getRenderer().getState()},initStats:function(t){var e=TimerGPU.instance(this.getGraphicContext());return t.getBoolean("stats")?(this._stats=createStats(t),void e.setCallback(this.callbackTimerGPU.bind(this))):void e.disable()},callbackTimerGPU:function(t,e){this._stats&&this._stats.rStats(e).set(t/1e6)},getViewerStats:function(){return this._stats},renderingTraversal:function(){if(this.getScene().getSceneData()&&this.getScene().getSceneData().getBound(),this.getCamera()){var t=this._stats,e=TimerGPU.instance(this.getGraphicContext()),i=this.getCamera().getRenderer();if(t&&t.rStats("cull").start(),i.cull(),t&&t.rStats("cull").end(),e.pollQueries(),e.start("glframe"),t&&t.rStats("render").start(),i.draw(),t&&t.rStats("render").end(),e.end("glframe"),t){var r=i.getCullVisitor();t.rStats("cullcamera").set(r._numCamera),t.rStats("cullmatrixtransform").set(r._numMatrixTransform),t.rStats("cullprojection").set(r._numProjection),t.rStats("cullnode").set(r._numNode),t.rStats("cullightsource").set(r._numLightSource),t.rStats("cullgeometry").set(r._numGeometry),t.rStats("pushstateset").set(i.getState()._numPushStateSet)}}},updateTraversal:function(){var t=this._stats;t&&t.rStats("update").start(),this._updateVisitor.resetStats(),this.getScene().updateSceneGraph(this._updateVisitor),t&&t.rStats("updatecallback").set(this._updateVisitor._numUpdateCallback),this.getDatabasePager().releaseGLExpiredSubgraphs(.005),this.flushDeletedGLObjects(.005),t&&t.rStats("update").end()},advance:function(t){var e=t;void 0===e&&(e=Number.MAX_VALUE);var i=this._frameStamp,r=i.getFrameNumber();i.setFrameNumber(r+1);var n=Timer.instance().deltaS(this._startTick,Timer.instance().tick());i.setReferenceTime(n);var a=i.getSimulationTime();i.setSimulationTime(e===Number.MAX_VALUE?n:e),i.setDeltaTime(i.getSimulationTime()-a)},beginFrame:function(){var t=this._stats;t&&(t.rStats("frame").start(),t.glS.start(),t.rStats("rAF").tick(),t.rStats("FPS").frame())},endFrame:function(){var t=this.getFrameStamp().getFrameNumber(),e=this._stats,i=e?e.rStats:void 0;i&&(Texture.getTextureManager(this.getGraphicContext()).updateStats(t,i),i("frame").end(),i("rStats").start(),i().update(),i("rStats").end())},checkNeedToDoFrame:function(){return this._requestContinousUpdate||this._requestRedraw},frame:function(){if(!this._contextLost){this.beginFrame(),this.advance();var t=this.updateViewport();this.updateEventProxy(this._eventProxy,this.getFrameStamp()),this._updateVisitor.setFrameStamp(this.getFrameStamp()),this.getManipulator()&&(this.getManipulator().update(this._updateVisitor),mat4.copy(this.getCamera().getViewMatrix(),this.getManipulator().getInverseMatrix())),(this.checkNeedToDoFrame()||t)&&(this._requestRedraw=!1,this.updateTraversal(),this.renderingTraversal()),this.endFrame(),this._hmd&&this._hmd.isPresenting&&this._hmd.submitFrame()}},setDone:function(t){this._done=t},done:function(){return this._done},_runImplementation:function(){var t=this,e=function(){t.done()||(t._requestID=t._requestAnimationFrame(e,t.getGraphicContext().canvas),t.frame())};e()},run:function(){var t=this;this._runPromise.then(function(){t._runImplementation()}).catch(function(){t._runImplementation()})},setVRDisplay:function(t){this._hmd=t,this._requestAnimationFrame=t.requestAnimationFrame.bind(t)},getVRDisplay:function(){return this._hmd},setPresentVR:function(t){if(!this._hmd)return Notify.warn("no hmd device provided to the viewer!"),P.reject();if(this._hmd.capabilities.hasPosition||this._hmd.resetPose(),!this._hmd.capabilities.canPresent)return P.reject();if(t){var e=[{source:this.getGraphicContext().canvas}];return this._hmd.requestPresent(e)}return this._hmd.exitPresent()},setupManipulator:function(t){void 0===t&&(t=new OrbitManipulator),void 0!==t.setNode?t.setNode(this.getSceneData()):t.view=this,t.setCamera(this.getCamera()),this.setManipulator(t)},updateViewport:function(){var t=this.getGraphicContext(),e=t.canvas,i=this.computeCanvasSize(e);if(!i)return!1;var r=this.getCamera(),n=r.getViewport(),a=n.width(),s=n.height(),o=e.width/a,h=e.height/s,u=o/h;return n.setViewport(Math.round(n.x()*o),Math.round(n.y()*h),Math.round(n.width()*o),Math.round(n.height()*h)),1!==u&&mat4.mul(r.getProjectionMatrix(),r.getProjectionMatrix(),mat4.fromScaling(mat4.create(),[1/u,1,1])),!0},initEventProxy:function(t){for(var e=t||{},i={},r=EventProxy,n=e.EventBackend,a=window.Object.keys(r),s=0,o=a.length;s<o;s++){var h=a[s],u=!0,c={};if(n&&void 0!==n[h]){var l=n[h].enable;u=void 0===l||l,c=n[h]}var d=new Options;if(d.extend(c).extend(t),delete d.EventBackend,u){var f=new r[h](this);f.init(d),i[h]=f}}return i},updateEventProxy:function(t,e){var i=window.Object.keys(t);i.forEach(function(i){var r=t[i];r.update&&r.update(e)})},setManipulator:function(t){this._manipulator&&this.removeEventProxy(),t.getCamera()||t.setCamera(this.getCamera()),View.prototype.setManipulator.call(this,t)},removeEventProxy:function(){var t=this._eventProxy,e=window.Object.keys(t);e.forEach(function(e){var i=t[e];i.remove&&i.remove()})},getEventProxy:function(){return this._eventProxy}}),module.exports=Viewer},function(t,e,i){"use strict";var r=i(6),n={antialias:!0,fullscreen:!0,enableFrustumCulling:!1,stats:!1,scrollwheel:!0,webgl2:!1},a=function(){window.Object.keys(n).forEach(function(t){this[t]=n[t]}.bind(this))};a.prototype={extend:function(t){return r.objectMix(this,t),this},get:function(t){return this[t]},getBoolean:function(t){var e=this.getString(t);if(e)return"false"!==e&&"0"!==e},getNumber:function(t){var e=this[t];if(e)return Number(e)},getString:function(t){var e=this[t];if(void 0!==e)return this[t].toString()}},t.exports=a},function(t,e,i){"use strict";var r=i(6),n=window.BrowserStats,a=window.glStats,s=window.rStats,o=function(t){this.bS=new n,this.glS=new a;var e={frame:{caption:"Total frame time (ms)",over:16,average:!0},fps:{caption:"Framerate (FPS)",below:30},calls:{caption:"Calls (three.js)",over:3e3},raf:{caption:"Time since last rAF (ms)",average:!0,avgMs:500},rstats:{caption:"rStats update (ms)",average:!0,avgMs:100},update:{caption:"update",average:!0},cull:{caption:"cull",average:!0},render:{caption:"render",average:!0},glframe:{caption:"glframe",average:!0},textureused:{caption:"texture used"},texturereserved:{caption:"texture reserved"},texturetotal:{caption:"texture total"},pushstateset:{caption:"num pushStateSet"},updatecallback:{caption:"num updateCallback"},cullcamera:{caption:"camera"},cullmatrixtransform:{caption:"matrixTransform"},cullprojection:{caption:"projection"},cullnode:{caption:"node"},culllightsource:{caption:"lightSource"},cullgeometry:{caption:"geometry"}},i=[{base:"frame",steps:["update","cull","render"]}],o=[{caption:"Framerate",values:["fps","raf"]},{caption:"Frame Budget",values:["frame","update","cull","render","glframe"]},{caption:"Scene Graph",values:["pushstateset","updatecallback"]},{caption:"Cull",values:["cullnode","cullmatrixtransform","cullgeometry","cullcamera","culllighsource","cullprojection"]},{caption:"Texture Memory",values:["texturereserved","textureused","texturetotal"]}],h=[this.bS,this.glS];t&&(t.values&&r.objectMix(e,t.values),t.groups&&Array.prototype.unshift.apply(o,t.groups),t.fractions&&Array.prototype.push.apply(i,t.fractions),t.plugins&&Array.prototype.push.apply(h,t.plugins)),this.rStats=new s({values:e,groups:o,fractions:i,plugins:h,colours:["#cc9933","#f20041","#69818c","#d90074","#b6f2ee","#660044","#50664d","#330022","#f2eeb6","#ee00ff","#806460","#1600a6","#994d57","#00004d","#f279da","#002933","#395073","#00eeff","#79baf2","#008066","#79f2aa","#00ff66","#1a331d","#004d14","#8c6c46","#388c00","#602080","#ff8800","#6d3df2","#995200","#0d1233","#402200","#3d6df2","#330e00","#e6f23d","#730000"]})},h=function(t){if(s){var e=".rs-base{ position: absolute; z-index: 10000; padding: 10px; background-color: #222; font-size: 12px; line-height: 1.2em; width: 350px; font-family: 'Roboto Condensed', tahoma, sans-serif; left: 0; top: 0; overflow: hidden; } .rs-base h1{ margin: 0; padding: 0; font-size: 1.4em; color: #fff; margin-bottom: 5px; cursor: pointer; } .rs-base div.rs-group{ margin-bottom: 10px; } .rs-base div.rs-group.hidden{ display: none; } .rs-base div.rs-fraction{ position: relative; margin-bottom: 5px; } .rs-base div.rs-fraction p{ width: 145px; text-align: right; margin: 0; padding: 0; } .rs-base div.rs-legend{ position: absolute; line-height: 1em; } .rs-base div.rs-counter-base{ position: relative; margin: 2px 0; height: 1em; } .rs-base span.rs-counter-id{ position: absolute; left: 0; top: 0; } .rs-base div.rs-counter-value{ position: absolute; left: 115px; width: 30px; height: 1em; top: 0; text-align: right; } .rs-base canvas.rs-canvas{ position: absolute; right: 0; } ",i=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");return r.type="text/css",r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e)),i.appendChild(r),new o(t.rstats)}};t.exports=h},function(t,e,i){"use strict";var r=i(233),n=i(234),a=i(235),s=i(237),o=i(238),h=i(240);t.exports={GamePad:r,Hammer:n,LeapMotion:a,StandardMouseKeyboard:s,WebVR:o,DeviceOrientation:h}},function(t,e,i){"use strict";var r=i(10),n=function(t){this._viewer=t,this._type="GamePad",this._enable=!0,this._gamepadIndex=-1};n.prototype={setEnable:function(t){this._enable=t},getEnable:function(){return this._enable},init:function(){},isValid:function(){if(!this._enable)return!1;var t=this._viewer.getManipulator();if(!t)return!1;var e=t.getControllerList();return!!e[this._type]},getManipulatorController:function(){return this._viewer.getManipulator().getControllerList()[this._type]},gamepadPoll:function(){if(!navigator.getGamepads)return null;var t=navigator.getGamepads(),e=t[this._gamepadIndex];if(e)return e;for(var i=0,r=t.length;i<r;++i){var n=t[i];if(n&&n.id&&n.id.indexOf("Unknown Gamepad")===-1)return this._gamepadIndex=i,this.onGamepadConnect(n),n}return this._gamepadIndex>=0&&(this._gamepadIndex=-1,this.onGamepadConnect()),null},onGamepadConnect:function(t){r.log("Detected new gamepad!",t)},onGamepadDisconnect:function(){r.log("Gamepad disconnected")},update:function(){if(this.isValid()){var t=this.gamepadPoll();if(t){var e=this.getManipulatorController();e.update&&e.update(t)}}}},t.exports=n},function(t,e,i){"use strict";var r=i(142),n=function(t){this._enable=!0,this._viewer=t,this._type="Hammer",this._eventNode=void 0};n.prototype={setEnable:function(t){this._enable=t},getEnable:function(){return this._enable},init:function(t){var e={prevent_default:!0,drag_max_touches:2,transform_min_scale:.08,transform_min_rotation:180,transform_always_block:!0,hold:!1,release:!1,swipe:!1,tap:!1};this._eventNode=t.eventNode,this._eventNode&&(this._hammer=new r(this._eventNode,e),t.getBoolean("scrollwheel")===!1?this._hammer.get("pinch").set({enable:!1}):this._hammer.get("pinch").set({enable:!0}))},isValid:function(){return!!(this._enable&&this._viewer.getManipulator()&&this._viewer.getManipulator().getControllerList()[this._type])},getManipulatorController:function(){return this._viewer.getManipulator().getControllerList()[this._type]},update:function(){this.isValid()&&this.getManipulatorController().setEventProxy(this._hammer)},remove:function(){this.isValid()&&this.getManipulatorController().removeEventProxy(this._hammer)}},t.exports=n},function(t,e,i){"use strict";var r=i(236),n=i(10),a=function(t){this._viewer=t,this._type="LeapMotion",this._enable=!0};a.prototype={setEnable:function(t){this._enable=t},getEnable:function(){return this._enable},init:function(t){if("undefined"!=typeof r&&r.Controller){var e=this;this._controller=new r.Controller({enableGestures:t.gestures||!0,tryReconnectOnDisconnect:!0,connectAttempts:3}),this._controller.on("ready",function(){t.readyCallback&&t.readyCallback(e._controller),e._leapMotionReady=!0,n.info("leapmotion ready")}),this._controller.loop(this._update.bind(this))}},isValid:function(){if(!this._enable)return!1;var t=this._viewer.getManipulator();if(!t)return!1;var e=t.getControllerList();return!!e[this._type]},getManipulatorController:function(){return this._viewer.getManipulator().getControllerList()[this._type]},_update:function(t){if(t.valid&&this.isValid()){var e=this.getManipulatorController();e.update&&e.update(t)}}},t.exports=a},function(t,e){t.exports=__WEBPACK_EXTERNAL_MODULE_236__},function(t,e,i){"use strict";var r=i(15).vec2,n=function(t){this._enable=!0,this._viewer=t,this._type="StandardMouseKeyboard",this._mouseEventNode=void 0,this._wheelEventNode=void 0,this._keyboardEventNode=void 0,this._eventList=["mousedown","mouseup","mouseout","mousemove","dblclick"],this._mousePosition=r.create()};n.prototype={setEnable:function(t){this._enable=t},getEnable:function(){return this._enable},init:function(t){this.removeEventListeners(this._mouseEventNode,this._wheelEventNode,this._keyboardEventNode);var e=t.mouseEventNode,i=t.wheelEventNode||e,r=t.keyboardEventNode||e;t.getBoolean("scrollwheel")===!1&&(i=null),this.addEventListeners(e,i,r),this._mouseEventNode=e,this._wheelEventNode=i,this._keyboardEventNode=r},addEventListeners:function(t,e,i){if(t)for(var r=0,n=this._eventList.length;r<n;r++){var a=this._eventList[r];this[a]&&t.addEventListener(a,this[a].bind(this),!1)}e&&(e.addEventListener("DOMMouseScroll",this.mousewheel.bind(this),!1),e.addEventListener("mousewheel",this.mousewheel.bind(this),!1),e.addEventListener("MozMousePixelScroll",this.preventDefault.bind(this),!1)),i&&(i.addEventListener("keydown",this.keydown.bind(this),!1),i.addEventListener("keyup",this.keyup.bind(this),!1))},removeEventListeners:function(t,e,i){if(t)for(var r=0,n=this._eventList.length;r<n;r++){var a=this._eventList[r];this[a]&&t.removeEventListener(a,this[a])}e&&(e.removeEventListener("DOMMouseScroll",this.mousewheel),e.removeEventListener("mousewheel",this.mousewheel),e.removeEventListener("MozMousePixelScroll",this.preventDefault)),i&&(i.removeEventListener("keydown",this.keydown),i.removeEventListener("keyup",this.keyup))},isValid:function(){return!!(this._enable&&this._viewer.getManipulator()&&this._viewer.getManipulator().getControllerList()[this._type])},getManipulatorController:function(){return this._viewer.getManipulator().getControllerList()[this._type]},keyup:function(t){if(this.isValid()&&this.getManipulatorController().keyup)return this.getManipulatorController().keyup(t)},keydown:function(t){if(this.isValid()&&this.getManipulatorController().keydown)return this.getManipulatorController().keydown(t)},mousedown:function(t){if(this.isValid()&&this.getManipulatorController().mousedown)return this.getManipulatorController().mousedown(t)},mouseup:function(t){if(this.isValid()&&this.getManipulatorController().mouseup)return this.getManipulatorController().mouseup(t)},mouseout:function(t){if(this.isValid()&&this.getManipulatorController().mouseout)return this.getManipulatorController().mouseout(t)},mousemove:function(t){if(this.isValid()&&this.getManipulatorController().mousemove)return this.getManipulatorController().mousemove(t)},dblclick:function(t){if(this.isValid()&&this.getManipulatorController().dblclick)return this.getManipulatorController().dblclick(t)},mousewheel:function(t){if(this.isValid()){var e=this.getManipulatorController();if(e.mousewheel){var i=t||window.event,r=[].slice.call(arguments,1),n=0,a=0,s=0;return t.wheelDelta&&(n=t.wheelDelta/120),t.detail&&(n=-t.detail/3),s=n,void 0!==i.axis&&i.axis===i.HORIZONTAL_AXIS&&(s=0,a=-1*n),void 0!==i.wheelDeltaY&&(s=i.wheelDeltaY/120),void 0!==i.wheelDeltaX&&(a=-1*i.wheelDeltaX/120),r.unshift(t,n,a,s),this.getManipulatorController().mousewheel.apply(e,r)}}},preventDefault:function(t){t.preventDefault()},divGlobalOffset:function(t){var e=0,i=0;e=t.offsetLeft,i=t.offsetTop;for(var r=document.getElementsByTagName("body")[0];t.offsetParent&&t!==r;)e+=t.offsetParent.offsetLeft,i+=t.offsetParent.offsetTop,t=t.offsetParent;return this._mousePosition[0]=e,this._mousePosition[1]=i,this._mousePosition},getPositionRelativeToCanvas:function(t,e){var i,r,n=t.target;t.pageX||t.pageY?(i=t.pageX,r=t.pageY):(t.clientX||t.clientY)&&(i=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,r=t.clientY+document.body.scrollTop+document.documentElement.scrollTop);var a=this.divGlobalOffset(n);return i-=a[0],r=n.height-(r-a[1]),void 0===e&&(e=this._mousePosition),e[0]=i,e[1]=r,e},update:function(){this.isValid()&&this.getManipulatorController().setEventProxy(this)}},t.exports=n},function(t,e,i){"use strict";var r=i(10),n=i(15).quat,a=i(15).vec3,s=i(15).mat4;i(239);var o=function(t){this._viewer=t,this._type="WebVR",this._enable=!1,this._hmd=void 0,this._sensor=void 0,this._frameData=void 0,this._quat=n.create(),this._pos=a.create(),this._worldScale=1};o.prototype={setWorldScale:function(t){this._worldScale=t},setEnable:function(t){this._enable=t},getEnable:function(){return this._enable},init:function(){if(navigator.getVRDisplays){var t=this;navigator.getVRDisplays().then(function(e){e.length>0&&(t._hmd=e[0],t._frameData=new window.VRFrameData,r.log("Found a VR display"),t._viewer.setVRDisplay(t._hmd))})}},getManipulatorController:function(){return this._viewer.getManipulator().getControllerList()[this._type]},isValid:function(){if(!this._enable)return!1;var t=this._viewer.getManipulator();return!!t&&(!!t.getControllerList()[this._type]&&!!this._hmd)},update:function(){var t=n.create(),e=a.create();return function(){if(this.isValid()){var i=this.getManipulatorController();if(i.update&&(this._hmd.capabilities.hasOrientation||this._hmd.capabilities.hasPosition)){this._hmd.getFrameData(this._frameData);var r=this._frameData.pose;if(r){var o=this._hmd.stageParameters&&this._hmd.stageParameters.sittingToStandingTransform,h=r.orientation;h&&(o&&(h=s.getRotation(t,o),n.mul(h,h,r.orientation)),this._quat[0]=h[0],this._quat[1]=-h[2],this._quat[2]=h[1],this._quat[3]=h[3]);var u=r.position;u&&(o&&(u=a.transformMat4(e,u,o)),this._pos[0]=u[0]*this._worldScale,this._pos[1]=-u[2]*this._worldScale,this._pos[2]=u[1]*this._worldScale),i.update(this._quat,this._pos)}}}}}(),getHmd:function(){return this._hmd}},t.exports=o},function(t,e,i){"use strict";var r=i(15).mat4;"getVRDisplays"in navigator&&("depthNear"in window.VRDisplay.prototype||(window.VRDisplay.prototype.depthNear=.01),"depthFar"in window.VRDisplay.prototype||(window.VRDisplay.prototype.depthFar=1e4),"VRFrameData"in window||(window.VRFrameData=function(){this.leftProjectionMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.rightViewMatrix=new Float32Array(16),this.pose=null},window.VRDisplay.prototype.getFrameData=function(){function t(t,n,a,s,o){r.perspectiveFromFieldOfView(t,s.fieldOfView,o.depthNear,o.depthFar);var h=a.orientation,u=a.position;h||(h=e),u||(u=i),r.fromRotationTranslation(n,h,u),r.translate(n,n,s.offset),r.invert(n,n)}var e=new Float32Array([0,0,0,1]),i=new Float32Array([0,0,0]);return function(e){var i=this.getPose();return!!i&&(e.pose=i,e.timestamp=i.timestamp,t(e.leftProjectionMatrix,e.leftViewMatrix,i,this.getEyeParameters("left"),this),t(e.rightProjectionMatrix,e.rightViewMatrix,i,this.getEyeParameters("right"),this),!0)}}()))},function(t,e){"use strict";var i=function(t){this._viewer=t,this._type="DeviceOrientation",this._enable=!1,this._deviceOrientation=void 0,this._screenOrientation=window.orientation||90};i.prototype={setEnable:function(t){this._enable=t},getEnable:function(){return this._enable},init:function(){var t=this;window.addEventListener("deviceorientation",function(e){null!==e.alpha&&void 0!==e.alpha&&(t._deviceOrientation=e)},!1),window.addEventListener("orientationchange",function(){null!==window.orientation&&void 0!==window.orientation&&(t._screenOrientation=window.orientation)},!1)},getManipulatorController:function(){return this._viewer.getManipulator().getControllerList()[this._type]},isValid:function(){if(!this._enable)return!1;if(!this._deviceOrientation)return!1;var t=this._viewer.getManipulator();return!!t&&!!t.getControllerList()[this._type];
},update:function(){if(this.isValid()){var t=this.getManipulatorController();t.update&&t.update(this._deviceOrientation,this._screenOrientation)}}},t.exports=i},function(t,e,i){"use strict";var r=i(10),n=function(){function t(t){if(null===l){l={};for(var e in t)"number"==typeof t[e]&&(l[t[e]]=e)}}function e(){if(null===l)throw"WebGLDebugUtils.init(ctx) not called"}function i(t){return e(),void 0!==l[t]}function n(t){e();var i=l[t];return void 0!==i?i:"*UNKNOWN WebGL ENUM (0x"+t.toString(16)+")"}function a(t,e,i){var r=c[t];return void 0!==r&&r[e]?n(i):i.toString()}function s(t,e,i){t.__defineGetter__(i,function(){return e[i]}),t.__defineSetter__(i,function(t){e[i]=t})}function o(e,i){function o(t,e){return function(){var r=t[e].apply(t,arguments),n=t.getError();return 0!==n&&(h[n]=!0,i(n,e,arguments)),r}}t(e),i=i||function(t,e,i){for(var s="",o=0;o<i.length;++o)s+=(0===o?"":", ")+a(e,o,i[o]);r.log("WebGL error "+n(t)+" in "+e+"("+s+")")};var h={},u={};for(var c in e)"function"==typeof e[c]?u[c]=o(e,c):s(u,e,c);return u.getError=function(){for(var t in h)if(h[t])return h[t]=!1,t;return e.NO_ERROR},u}function h(t){var e=t.getParameter(t.MAX_VERTEX_ATTRIBS),i=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,i);var r;for(r=0;r<e;++r)t.disableVertexAttribArray(r),t.vertexAttribPointer(r,4,t.FLOAT,!1,0,0),t.vertexAttrib1f(r,0);t.deleteBuffer(i);var n=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);for(r=0;r<n;++r)t.activeTexture(t.TEXTURE0+r),t.bindTexture(t.TEXTURE_CUBE_MAP,null),t.bindTexture(t.TEXTURE_2D,null);for(t.activeTexture(t.TEXTURE0),t.useProgram(null),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindRenderbuffer(t.RENDERBUFFER,null),t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.DITHER),t.disable(t.SCISSOR_TEST),t.blendColor(0,0,0,0),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.clearColor(0,0,0,0),t.clearDepth(1),t.clearStencil(-1),t.colorMask(!0,!0,!0,!0),t.cullFace(t.BACK),t.depthFunc(t.LESS),t.depthMask(!0),t.depthRange(0,1),t.frontFace(t.CCW),t.hint(t.GENERATE_MIPMAP_HINT,t.DONT_CARE),t.lineWidth(1),t.pixelStorei(t.PACK_ALIGNMENT,4),t.pixelStorei(t.UNPACK_ALIGNMENT,4),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.UNPACK_COLORSPACE_CONVERSION_WEBGL&&t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.BROWSER_DEFAULT_WEBGL),t.polygonOffset(0,0),t.sampleCoverage(1,!1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilMask(4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.viewport(0,0,t.canvas.width,t.canvas.height),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT);t.getError(););}function u(t){function e(t){return"function"==typeof t?t:function(e){t.handleEvent(e)}}function i(t){var e=t.addEventListener;t.addEventListener=function(i,r,n){switch(i){case"webglcontextlost":y(r);break;case"webglcontextrestored":T(r);break;default:e.apply(t,arguments)}}}function r(){for(var t=window.Object.keys(M),e=0;e<t.length;++e)delete M[t]}function n(){++S,g||v==S&&t.loseContext()}function a(t,e){var i=t[e];return function(){if(n(),!g){var e=i.apply(t,arguments);return e}}}function o(){for(var t=0;t<m.length;++t){var e=m[t];e instanceof WebGLBuffer?l.deleteBuffer(e):e instanceof WebGLFramebuffer?l.deleteFramebuffer(e):e instanceof WebGLProgram?l.deleteProgram(e):e instanceof WebGLRenderbuffer?l.deleteRenderbuffer(e):e instanceof WebGLShader?l.deleteShader(e):e instanceof WebGLTexture&&l.deleteTexture(e)}}function u(t){return{statusMessage:t,preventDefault:function(){x=!0}}}function c(t){for(var e in t)"function"==typeof t[e]?p[e]=a(t,e):s(p,t,e);p.getError=function(){n();var t;if(!g)for(;t=l.getError();)M[t]=!0;for(t in M)if(M[t])return delete M[t],t;return p.NO_ERROR};var i,r,o=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"];for(r=0;r<o.length;++r)i=o[r],p[i]=function(e){return function(){if(n(),g)return null;var i=e.apply(t,arguments);return i.__webglDebugContextLostId__=_,m.push(i),i}}(t[i]);var h=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(r=0;r<h.length;++r)i=h[r],p[i]=function(e){return function(){return n(),g?null:e.apply(t,arguments)}}(p[i]);var u=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(r=0;r<u.length;++r)i=u[r],p[i]=function(e){return function(){return n(),!g&&e.apply(t,arguments)}}(p[i]);return p.checkFramebufferStatus=function(e){return function(){return n(),g?p.FRAMEBUFFER_UNSUPPORTED:e.apply(t,arguments)}}(p.checkFramebufferStatus),p.getAttribLocation=function(e){return function(){return n(),g?-1:e.apply(t,arguments)}}(p.getAttribLocation),p.getVertexAttribOffset=function(e){return function(){return n(),g?0:e.apply(t,arguments)}}(p.getVertexAttribOffset),p.isContextLost=function(){return g},p}var l,d=[],f=[],p={},_=1,g=!1,m=[],v=0,S=0,x=!1,b=0,M={};t.getContext=function(e){return function(){var i=e.apply(t,arguments);if(i instanceof WebGLRenderingContext){if(i!=l){if(l)throw"got different context";l=i,p=c(l)}return p}return i}}(t.getContext);var y=function(t){d.push(e(t))},T=function(t){f.push(e(t))};return i(t),t.loseContext=function(){if(!g){for(g=!0,v=0,++_;l.getError(););r(),M[l.CONTEXT_LOST_WEBGL]=!0;var e=u("context lost"),i=d.slice();setTimeout(function(){for(var r=0;r<i.length;++r)i[r](e);b>=0&&setTimeout(function(){t.restoreContext()},b)},0)}},t.restoreContext=function(){g&&f.length&&setTimeout(function(){if(!x)throw"can not restore. webglcontestlost listener did not call event.preventDefault";o(),h(l),g=!1,S=0,x=!1;for(var t=f.slice(),e=u("context restored"),i=0;i<t.length;++i)t[i](e)},0)},t.loseContextInNCalls=function(t){if(g)throw"You can not ask a lost contet to be lost";v=S+t},t.getNumCalls=function(){return S},t.setRestoreTimeout=function(t){b=t},t}var c={enable:{0:!0},disable:{0:!0},getParameter:{0:!0},drawArrays:{0:!0},drawElements:{0:!0,2:!0},createShader:{0:!0},getShaderParameter:{1:!0},getProgramParameter:{1:!0},getVertexAttrib:{1:!0},vertexAttribPointer:{2:!0},bindTexture:{0:!0},activeTexture:{0:!0},getTexParameter:{0:!0,1:!0},texParameterf:{0:!0,1:!0},texParameteri:{0:!0,1:!0,2:!0},texImage2D:{0:!0,2:!0,6:!0,7:!0},texSubImage2D:{0:!0,6:!0,7:!0},copyTexImage2D:{0:!0,2:!0},copyTexSubImage2D:{0:!0},generateMipmap:{0:!0},bindBuffer:{0:!0},bufferData:{0:!0,2:!0},bufferSubData:{0:!0},getBufferParameter:{0:!0,1:!0},pixelStorei:{0:!0,1:!0},readPixels:{4:!0,5:!0},bindRenderbuffer:{0:!0},bindFramebuffer:{0:!0},checkFramebufferStatus:{0:!0},framebufferRenderbuffer:{0:!0,1:!0,2:!0},framebufferTexture2D:{0:!0,1:!0,2:!0},getFramebufferAttachmentParameter:{0:!0,1:!0,2:!0},getRenderbufferParameter:{0:!0,1:!0},renderbufferStorage:{0:!0,1:!0},clear:{0:!0},depthFunc:{0:!0},blendFunc:{0:!0,1:!0},blendFuncSeparate:{0:!0,1:!0,2:!0,3:!0},blendEquation:{0:!0},blendEquationSeparate:{0:!0,1:!0},stencilFunc:{0:!0},stencilFuncSeparate:{0:!0,1:!0},stencilMaskSeparate:{0:!0},stencilOp:{0:!0,1:!0,2:!0},stencilOpSeparate:{0:!0,1:!0,2:!0,3:!0},cullFace:{0:!0},frontFace:{0:!0}},l=null;return{init:t,mightBeEnum:i,glEnumToString:n,glFunctionArgToString:a,makeDebugContext:o,makeLostContextSimulatingCanvas:u,resetToInitialState:h}}();t.exports=n},function(t,e,i){"use strict";var r=i(243),n=i(177),a=i(176),s=i(244),o=i(245),h=i(246),u=i(250),c=i(247),l=i(252),d=i(248),f=i(249),p=i(251),_=i(253),g={};g.ShadowCastAttribute=r,g.ShadowCastCompiler=n,g.ShadowReceiveAttribute=c,g.ShadowCasterVisitor=s,g.ShadowFrustumIntersection=o,g.ShadowMap=h,g.ShadowMapAtlas=u,g.ShadowedScene=_,g.ShadowSettings=l,g.ShadowCastShaderGenerator=a,g.ShadowTechnique=d,g.ShadowTexture=f,g.ShadowTextureAtlas=p,t.exports=g},function(t,e,i){"use strict";var r=i(6),n=i(31),a=function(t,e){n.call(this),this._enable=!t,this._shadowReceiveAttribute=e};a.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{attributeType:"ShadowCast",cloneType:function(){return new a(!0)},setReceiveAttribute:function(t){this._shadowReceiveAttribute=t},getReceiveAttribute:function(){return this._shadowReceiveAttribute},getDefines:function(){if(this._shadowReceiveAttribute)return this._shadowReceiveAttribute.getDefines()},getAlgorithm:function(){if(this._shadowReceiveAttribute)return this._shadowReceiveAttribute.getAlgorithm()},getHash:function(){return"ShadowCast"+this._enable+this._shadowReceiveAttribute.getAlgorithm()+this._shadowReceiveAttribute.getPrecision()},isEnabled:function(){return this._enable}}),"osgShadow","ShadowCastAttribute"),r.setTypeID(a),t.exports=a},function(t,e,i){"use strict";var r=i(51),n=i(52),a=i(84),s=i(98),o=i(63),h=i(32),u=i(6),c=function(t){h.call(this),this._noCastMask=t,this._nodeList=[]};c.prototype=u.objectLibraryClass(u.objectInherit(h.prototype,{reset:function(){this._nodeList=[]},removeNodeFromCasting:function(t){var e=t.getNodeMask();e===-1?(e=this._noCastMask,t.setNodeMask(e),this._nodeList.push(t)):0!==(e&~this._noCastMask)&&(t.setNodeMask(e|this._noCastMask),this._nodeList.push(t))},apply:function(t){var e=t.getStateSet();if(e){var i=e.getAttribute("BlendFunc");if(void 0!==i&&i.getSource()!==r.DISABLE){var h=e.getAttribute("Depth");if(h&&(h.getFunc()===a.DISABLE||h.getWriteMask()===!1))return void this.removeNodeFromCasting(t)}}return t.getTypeID()===s.typeID||t.getTypeID()===o.typeID?void this.removeNodeFromCasting(t):t.getTypeID()===n.typeID&&t.isRenderToTextureCamera()?void this.removeNodeFromCasting(t):void this.traverse(t)},setNoCastMask:function(t){this._noCastMask=t},restore:function(){for(var t=0,e=this._nodeList.length;t<e;t++){var i=this._nodeList[t],r=i.getNodeMask();r===this._noCastMask?i.setNodeMask(-1):i.setNodeMask(r&~this._noCastMask)}}}),"osgShadow","ShadowCasterVisitor"),u.setTypeID(c),t.exports=c},function(t,e,i){"use strict";var r=i(14),n=i(28),a=i(52),s=i(37),o=i(98),h=i(15).mat4,u=i(33),c=i(61),l=i(32),d=i(58),f=i(6),p=function(){l.call(this,l.TRAVERSE_ALL_CHILDREN),this._matrixStack=[h.create()],this._reservedMatrixStack=new u,this._bb=new r,this._bs=new n};p.prototype=f.objectInherit(l.prototype,{reset:function(t,e,i,r,n){this.setTraversalMask(t),this._cameraFrustum=i,this._lightFrustum=n,this.getCameraPlaneMaskForLightNear(e,i,r?6:4),this._reservedMatrixStack.reset(),this._matrixStack.length=1,this._bb.init()},getBoundingBox:function(){return this._bb},getCameraPlaneMaskForLightNear:function(t,e,i){var r,n=1,a=15;for(r=0;r<i;++r)a=a<<1|1;var s=e.getPlanes();for(r=0;r<i;++r)d.distanceToPlane(s[r],t)<0&&(a^=n),n<<=1;return this._cameraPlaneMaskedByLightNear=a,e.setResultMask(a),e.pushCurrentMask(a),a},applyTransform:function(t){var e=this._reservedMatrixStack.get(),i=this._matrixStack.length;h.copy(e,this._matrixStack[i-1]),t.computeLocalToWorldMatrix(e,this);var r=this._bs;t.getBound().transformMat4(this._bs,e),(0===this._cameraFrustum.getCurrentMask()||this._cameraFrustum.containsBoundingSphere(r))&&(0===this._lightFrustum.getCurrentMask()||this._lightFrustum.containsBoundingSphere(r))&&(this._cameraFrustum.pushCurrentMask(),this._lightFrustum.pushCurrentMask(),this.pushMatrix(e),this.traverse(t),this._cameraFrustum.popCurrentMask(),this._lightFrustum.popCurrentMask(),this.popMatrix())},applyBoundingBox:function(){var t=new r;return function(e){var i=this._matrixStack.length,r=this._matrixStack[i-1];h.exactEquals(r,h.IDENTITY)?this._bb.expandByBoundingBox(e):e.valid()&&(e.transformMat4(t,r),this._bb.expandByBoundingBox(t))}}(),apply:function(t){var e=t.getTypeID();if(t instanceof c)return void this.applyTransform(t);if(e===s.getTypeID()){var i=this._bs,r=this._matrixStack[this._matrixStack.length-1];if(t.getBound().transformMat4(i,r),0!==this._cameraFrustum.getCurrentMask()&&!this._cameraFrustum.containsBoundingSphere(i))return;if(0!==this._lightFrustum.getCurrentMask()&&!this._lightFrustum.containsBoundingSphere(i))return;return void this.applyBoundingBox(t.getBoundingBox())}e===a.getTypeID()||e===o.getTypeID(),this.traverse(t)},pushMatrix:function(t){this._matrixStack.push(t)},popMatrix:function(){this._matrixStack.pop()}}),t.exports=p},function(t,e,i){"use strict";var r=i(52),n=i(60),a=i(51),s=i(36),o=i(84),h=i(67),u=i(15).mat4,c=i(61),l=i(10),d=i(105),f=i(31),p=i(29),_=i(167),g=i(40),m=i(11),v=i(41),S=i(6),x=i(46),b=i(15).vec3,M=i(15).vec4,y=i(110),T=i(38),w=i(247),C=i(244),A=i(245),E=i(243),I=i(248),F=i(249),R=function(t){this._shadowTechnique=t};R.prototype={cull:function(t,e){this._shadowTechnique.getShadowedScene().nodeTraverse(e);var i=e.getCurrentCullingSet(),r=e.getCurrentProjectionMatrix(),n=e.getComputedNear(),a=e.getComputedFar();return u.getFrustumPlanes(i.getFrustum().getPlanes(),r,e.getCurrentModelViewMatrix(),!1),i.getFrustum().setupMask(6),this._shadowTechnique.setLightFrustum(i.getFrustum(),n,a),!1}};var N=function(t,e){I.call(this),this._projectionMatrix=u.create(),this._viewMatrix=u.create(),this._lightNumberArrayIndex=-1,this._lightUp=b.fromValues(0,0,1),this._light=t.light,this._cameraShadow=new r,this._cameraShadow.setCullCallback(new R(this)),this._cameraShadow.setRenderOrder(r.PRE_RENDER,0),this._cameraShadow.setReferenceFrame(m.ABSOLUTE_RF),this._cameraShadow.setClearColor(M.fromValues(1,1,1,1)),e?this._texture=e:(this._texture=new F,this._textureUnitBase=4,this._textureUnit=this._textureUnitBase,this._textureMagFilter=void 0,this._textureMinFilter=void 0),this._textureSize=256;var i=v.createFloat2("RenderSize");this._texelSizeUniform=v.createFloat1(1/this._textureSize,"texelSize"),this._renderSize=i.getInternalArray(),this._renderSize[0]=this._renderSize[1]=this._textureSize,this._receivingStateset=void 0,this._casterStateSet=new p,this._casterStateSet.addUniform(v.createFloat1(0,"exponent0")),this._casterStateSet.addUniform(v.createFloat1(0,"exponent1")),this._casterStateSet.addUniform(v.createFloat1(.005,"bias")),this._casterStateSet.addUniform(this._texelSizeUniform),this._casterStateSet.addUniform(i),this._casterStateSet.setAttributeAndModes(new o(o.LESS),f.ON|f.OVERRIDE),this._casterStateSet.setAttributeAndModes(new a,f.ON|f.OVERRIDE),this._shadowReceiveAttribute=new w(this._light.getLightNumber()),this._casterStateSet.setAttributeAndModes(this._shadowReceiveAttribute,f.ON|f.OVERRIDE),this._shadowCastShaderGeneratorName="ShadowCast";var n=.001,h=1e3,c=v.createFloat4("uShadowDepthRange");this._casterStateSet.addUniform(c),this._depthRange=c.getInternalArray(),this._depthRange[0]=n,this._depthRange[1]=h,this._depthRange[2]=h-n,this._depthRange[3]=1/(h-n),this._worldLightPos=M.create(),this._worldLightPos[3]=0,this._worldLightDir=M.create(),this._worldLightDir[3]=1,this._castsShadowDrawTraversalMask=4294967295,this._castsShadowBoundsTraversalMask=4294967295,this._shaderProcessor=void 0,this._tmpVec=b.create(),this._tmpVecBis=b.create(),this._tmpVecTercio=b.create(),this._tmpMatrix=u.create(),t&&this.setShadowSettings(t),this._computeFrustumBounds=new A,this._computeBoundsVisitor=new s,t.userShadowCasterVisitor!==!1&&(this._removeNodesNeverCastingVisitor=t.userShadowCasterVisitor||new C(this._castsShadowTraversalMask)),this._infiniteFrustum=!0;var l=new E(!1,this._shadowReceiveAttribute);this._casterStateSet.setAttributeAndModes(l,f.ON|f.OVERRIDE),this._casterStateSet.setShaderGeneratorName(this._shadowCastShaderGeneratorName,f.OVERRIDE|f.ON),this._debug=!1};N.prototype=S.objectLibraryClass(S.objectInherit(I.prototype,{getDepthRange:function(){return this._depthRange},setLightFrustum:function(t,e,i){this._lightFrustum=t,this._depthRange[0]=e,this._depthRange[1]=i,this.nearFarBounding(),this._debug&&(this._debugGeomFrustum.updateGeometry(this._projectionMatrix,this._depthRange),u.invert(this._debugNodeFrustum.getMatrix(),this._viewMatrix))},getCamera:function(){return this._cameraShadow},getTexture:function(){return this._texture},isDirty:function(){return this._dirty},setTextureUnitBase:function(t){this._textureUnitBase=t,this._textureUnit=t},setShadowSettings:function(t){t&&(this._light=t.light,this._shadowCastShaderGeneratorName=t.getShadowCastShaderGeneratorName(),this.setCastsShadowDrawTraversalMask(t.castsShadowDrawTraversalMask),this.setCastsShadowBoundsTraversalMask(t.castsShadowBoundsTraversalMask),this.setLight(this._light),this.setTextureSize(t.textureSize),this.setTexturePrecision(t.textureType),this.setFakePCF(t.fakePCF),this.setRotateOffset(t.rotateOffset),this.setKernelSizePCF(t.kernelSizePCF),this.setAlgorithm(t.algorithm),this.setBias(t.bias),this.setExponent0(t.exponent),this.setExponent1(t.exponent1),this.setEpsilonVSM(t.epsilonVSM))},setCastsShadowDrawTraversalMask:function(t){this._castsShadowDrawTraversalMask=t},getCastsShadowDrawTraversalMask:function(){return this._castsDrawShadowTraversalMask},setCastsShadowBoundsTraversalMask:function(t){this._castsShadowBoundsTraversalMask=t},getCastsShadowBoundsTraversalMask:function(){return this._castsShadowBoundsTraversalMask},getBias:function(){return this._shadowReceiveAttribute.getBias()},setBias:function(t){this._shadowReceiveAttribute.setBias(t),this._casterStateSet.getUniformList().bias.getUniform().setFloat(t)},getExponent0:function(){return this._shadowReceiveAttribute.getExponent0()},setExponent0:function(t){this._shadowReceiveAttribute.setExponent0(t),this._casterStateSet.getUniformList().exponent0.getUniform().setFloat(t)},getExponent1:function(){return this._shadowReceiveAttribute.getExponent1()},setExponent1:function(t){this._shadowReceiveAttribute.setExponent1(t),this._casterStateSet.getUniformList().exponent1.getUniform().setFloat(t)},getEpsilonVSM:function(){return this._shadowReceiveAttribute.getEpsilonVSM()},setEpsilonVSM:function(t){this._shadowReceiveAttribute.setEpsilonVSM(t)},getKernelSizePCF:function(){return this._shadowReceiveAttribute.getKernelSizePCF()},setKernelSizePCF:function(t){this._shadowReceiveAttribute.setKernelSizePCF(t)},getFakePCF:function(){return this._shadowReceiveAttribute.getFakePCF()},setFakePCF:function(t){this._shadowReceiveAttribute.getFakePCF()!==t&&(this._shadowReceiveAttribute.setFakePCF(t),this.setTextureFiltering())},getRotateOffset:function(){return this._shadowReceiveAttribute.getRotateOffset()},setRotateOffset:function(t){this._shadowReceiveAttribute.getRotateOffset()!==t&&this._shadowReceiveAttribute.setRotateOffset(t)},setShadowedScene:function(t){I.prototype.setShadowedScene.call(this,t),this._receivingStateset=this._shadowedScene.getReceivingStateSet(),this.dirty()},checkLightNumber:function(){var t=this._light.getLightNumber();this._shadowReceiveAttribute.getLightNumber()!==t&&this._receivingStateset.getAttribute(this._shadowReceiveAttribute.getTypeMember())===this._shadowReceiveAttribute&&this._receivingStateset.removeAttribute(this._shadowReceiveAttribute.getTypeMember()),l.assert(this._shadowReceiveAttribute.getTypeMember()===this._shadowReceiveAttribute.attributeType+t,"TypeMember isnt reflecting light number"+this._shadowReceiveAttribute.getTypeMember()+" !== "+this._shadowReceiveAttribute.attributeType+t),this._texture&&!this._texture.hasLightNumber(t)&&this._receivingStateset.getTextureAttribute(this._textureUnit,this._texture.getTypeMember())===this._texture&&this._receivingStateset.removeTextureAttribute(this._textureUnit,this._texture.getTypeMember())},init:function(t,e,i){if(this._shadowedScene){this._filledOnce=!1,this.checkLightNumber(),this._cameraShadow||(this._cameraShadow=new r,this._cameraShadow.setCullCallback(new R(this)),this._cameraShadow.setRenderOrder(r.PRE_RENDER,0),this._cameraShadow.setReferenceFrame(m.ABSOLUTE_RF),this._cameraShadow.setClearColor(M.fromValues(1,1,1,1)));var n=this._light.getLightNumber();t?(this._texture=t,this._lightNumberArrayIndex=e,this._textureUnit=i,this._shadowReceiveAttribute.setAtlas(!0)):(this.initTexture(),this._textureUnit=this._textureUnitBase+n,this._texture.setLightNumber(n),this._texture.setName("ShadowTexture"+this._textureUnit),this._shadowReceiveAttribute.setAtlas(!1)),this._cameraShadow.setName("light_shadow_camera"+this._light.getName()),this._shadowReceiveAttribute.setLightNumber(n);var a=f.OVERRIDE|f.ON;this._receivingStateset.setAttributeAndModes(this._shadowReceiveAttribute,a),this._preventTextureBindingDuringShadowCasting(),this._casterStateSet.setTextureAttributeAndModes(this._textureUnit,g.textureNull,f.PROTECTED),this._receivingStateset.setTextureAttributeAndModes(this._textureUnit,this._texture,a),this._dirty=!1}},_preventTextureBindingDuringShadowCasting:function(){for(var t=T.instance().getWebGLParameter("MAX_TEXTURE_IMAGE_UNITS"),e=0;e<t;e++)this._casterStateSet.setTextureAttributeAndModes(e,g.textureNull,f.OVERRIDE|f.ON)},valid:function(){return!0},updateShadowTechnique:function(t,e){var i=this._cameraShadow,r=this._texture;if(i&&r){var n=i.getViewport();n||(n=new y,i.setViewport(n)),e?n.x()===e[0]&&n.y()===e[1]&&n.width()===e[2]&&n.height()===e[3]||(i.detachAll(),i.attachTexture(h.COLOR_ATTACHMENT0,r),i.attachRenderBuffer(h.DEPTH_ATTACHMENT,h.DEPTH_COMPONENT16),i.getViewport().setViewport(e[0],e[1],e[2],e[3])):n.width()===r.getWidth()&&n.height()===r.getHeight()||(i.detachAll(),i.attachTexture(h.COLOR_ATTACHMENT0,r),i.attachRenderBuffer(h.DEPTH_ATTACHMENT,h.DEPTH_COMPONENT16),i.getViewport().setViewport(0,0,r.getWidth(),r.getHeight()))}},setTextureFiltering:function(){var t,e,i,r=this.getTexturePrecision();if(this._texture){switch(this.getAlgorithm()){case"ESM":case"VSM":case"EVSM":e=g.LINEAR,i=g.LINEAR;break;default:case"PCF":case"NONE":this.getFakePCF()?(e=g.LINEAR,i=g.LINEAR):(e=g.NEAREST,i=g.NEAREST)}switch(r){case"HALF_FLOAT":t=g.HALF_FLOAT,e=g.NEAREST,i=g.NEAREST;break;case"HALF_FLOAT_LINEAR":t=g.HALF_FLOAT,e=g.LINEAR,i=g.LINEAR;break;case"FLOAT":t=g.FLOAT,e=g.NEAREST,i=g.NEAREST;break;case"FLOAT_LINEAR":t=g.FLOAT,e=g.LINEAR,i=g.LINEAR;break;default:case"UNSIGNED_BYTE":t=g.UNSIGNED_BYTE}}this._texture.setInternalFormatType(t),this._texture.setMinFilter(e),this._texture.setMagFilter(i),this._textureMagFilter=i,this._textureMinFilter=e},initTexture:function(){if(this._dirty){this._texture||(this._texture=new F,this._textureUnit=this._textureUnitBase),this._texture.setTextureSize(this._textureSize,this._textureSize),this._texelSizeUniform.setFloat(1/this._textureSize),this._renderSize[0]=this._textureSize,this._renderSize[1]=this._textureSize;var t;t=g.RGBA,this.setTextureFiltering(),this._texture.setInternalFormat(t),this._texture.setWrapS(g.CLAMP_TO_EDGE),this._texture.setWrapT(g.CLAMP_TO_EDGE),this._texture.dirty()}},setTexturePrecision:function(t){t!==this._shadowReceiveAttribute.getPrecision()&&(this._shadowReceiveAttribute.setPrecision(t),this.dirty())},getTexturePrecision:function(){return this._shadowReceiveAttribute.getPrecision()},setTextureSize:function(t){t!==this._textureSize&&(this._textureSize=t,this.dirty())},setAlgorithm:function(t){t!==this.getAlgorithm()&&(this._shadowReceiveAttribute.setAlgorithm(t),this.dirty())},getAlgorithm:function(){return this._shadowReceiveAttribute.getAlgorithm()},getCasterStateSet:function(){return this._casterStateSet},setLight:function(t){t&&t!==this._light&&(this._light=t,this.dirty())},getUp:function(t){return Math.abs(b.dot(this._lightUp,t))>=1&&(1===this._lightUp[0]?(this._lightUp[0]=0,this._lightUp[1]=1,this._lightUp[2]=0):(this._lightUp[0]=1,this._lightUp[1]=0,this._lightUp[2]=0)),this._lightUp},nearFarBounding:function(){var t=this._depthRange[0],e=this._depthRange[1],i=N.EPSILON;e<t-i?(this._emptyCasterScene=!0,e=1,t=i):t<i&&(t=i),this._depthRange[0]=t,this._depthRange[1]=e},makePerspectiveFromBoundingBox:function(t,e,i,r,n,a){var s=t.center(this._tmpVec),o=t.radius(),h=N.EPSILON,c=h,l=1;this._radius=o;var d=b.distance(s,i);d<-o?this._emptyCasterScene=!0:d<=0?(c=h,l=d+o):d<o?(c=h,l=d+o):(c=d-o,l=d+o),this._depthRange[0]=c,this._depthRange[1]=l,this.nearFarBounding();var f=this._depthRange[0]*Math.tan(e*Math.PI/180);f=f>o?o:f;var p=f,_=-p,g=f,m=-g,v=this.getUp(r);this._infiniteFrustum?u.infiniteFrustum(a,m,g,_,p,this._depthRange[0]):u.frustum(a,m,g,_,p,this._depthRange[0],this._depthRange[1]),u.lookAtDirection(n,i,r,v)},makeOrthoFromBoundingBox:function(t,e,i,r){var n=t.center(this._tmpVecTercio),a=t.radius(),s=a+a,o=1e-4,h=s+1e-4,c=this._tmpVec;b.scaleAndAdd(c,n,e,-s),o=a,h+=a;var l=.001;o<h*l&&(o=h*l);var d=this.getUp(e);u.lookAtDirection(i,c,e,d);var f,p;p=a,f=p,u.ortho(r,-f,f,-p,p,o,h),this._depthRange[0]=o,this._depthRange[1]=h},aimShadowCastingCamera:function(t,e){var i=this._light;if(!i)return void(this._emptyCasterScene=!0);var r=this._cameraShadow,n=this._worldLightPos,a=this._worldLightDir;u.copy(this._projectionMatrix,r.getProjectionMatrix()),u.copy(this._viewMatrix,r.getViewMatrix());var s,o=this._projectionMatrix,h=this._viewMatrix,c=t.getCurrentRenderBin().getPositionedAttribute();if(c=c.find(function(t){return t.length>0&&t[1]===i&&(s=t[0],!0)}),void 0===s)return l.warn("light isnt inside children of shadowedScene Node"),void(this._emptyCasterScene=!0);var d=this._tmpMatrix;if(u.invert(d,t.getCurrentModelViewMatrix()),this._light.isDirectionLight())M.transformMat4(n,i.getPosition(),s),M.transformMat4(n,n,d),b.scale(n,n,-1),b.normalize(n,n),this.makeOrthoFromBoundingBox(e,n,h,o),this._debug&&u.invert(this._debugNodeFrustum.getMatrix(),h);else{u.mul(this._tmpMatrix,d,s);var f=this._tmpMatrix;b.transformMat4(n,i.getPosition(),f),f[12]=0,f[13]=0,f[14]=0,u.invert(f,f),u.transpose(f,f),b.copy(a,i.getDirection()),M.transformMat4(a,a,f),b.normalize(a,a),this.makePerspectiveFromBoundingBox(e,i.getSpotCutoff(),n,a,h,o)}u.copy(r.getProjectionMatrix(),this._projectionMatrix),u.copy(r.getViewMatrix(),this._viewMatrix),this.setShadowUniformsDepthValue()},frameShadowCastingFrustum:function(t){this._infiniteFrustum||n.prototype.clampProjectionMatrix(this._projectionMatrix,this._depthRange[0],this._depthRange[1],t.getNearFarRatio(),this._depthRange),this.setShadowUniformsDepthValue();var e=this._cameraShadow;u.copy(e.getProjectionMatrix(),this._projectionMatrix),u.copy(e.getViewMatrix(),this._viewMatrix)},setShadowUniformsDepthValue:function(){this._depthRange[2]=this._depthRange[1]-this._depthRange[0],this._depthRange[3]=1/this._depthRange[2],this._lightNumberArrayIndex!==-1?(this._texture.setViewMatrix(this._lightNumberArrayIndex,this._viewMatrix),this._texture.setProjectionMatrix(this._lightNumberArrayIndex,this._projectionMatrix),this._texture.setDepthRange(this._lightNumberArrayIndex,this._depthRange)):(this._texture.setViewMatrix(this._viewMatrix),this._texture.setProjectionMatrix(this._projectionMatrix),this._texture.setDepthRange(this._depthRange))},noDraw:function(){this._depthRange[0]=0,this._depthRange[1]=0,this._depthRange[2]=0,this._depthRange[3]=0;var t=this._casterStateSet.getUniformList();t.uShadowDepthRange.getUniform().setVec4(this._depthRange),this._texture.setDepthRange(this._depthRange);var e=this._cameraShadow;u.copy(this._projectionMatrix,e.getProjectionMatrix()),u.copy(this._viewMatrix,e.getViewMatrix()),this._lightNumberArrayIndex!==-1?(this._texture.setViewMatrix(this._lightNumberArrayIndex,this._viewMatrix),this._texture.setProjectionMatrix(this._lightNumberArrayIndex,this._projectionMatrix)):(this._texture.setViewMatrix(this._viewMatrix),this._texture.setProjectionMatrix(this._projectionMatrix)),this._filledOnce=!0},cullShadowCasting:function(t){var e;if(this._removeNodesNeverCastingVisitor&&(this._removeNodesNeverCastingVisitor.setNoCastMask(~(this._castsShadowBoundsTraversalMask|this._castsShadowDrawTraversalMask)),this._removeNodesNeverCastingVisitor.reset(),this.getShadowedScene().accept(this._removeNodesNeverCastingVisitor)),this._computeBoundsVisitor.setTraversalMask(this._castsShadowBoundsTraversalMask),this._computeBoundsVisitor.reset(),this.getShadowedScene().accept(this._computeBoundsVisitor),e=this._computeBoundsVisitor.getBoundingBox(),!e.valid())return this.noDraw(),void(this._removeNodesNeverCastingVisitor&&this._removeNodesNeverCastingVisitor.restore());if(this._debug){var i=e.getMin(),r=e.getMax();e.center(this._tmpVec);var n=this._debugNodeSceneCast.getMatrix();u.fromScaling(n,[r[0]-i[0],r[1]-i[1],r[2]-i[2],1]),u.setTranslation(n,this._tmpVec)}var a=t.getCurrentModelMatrix();if(e.transformMat4(e,a),this._emptyCasterScene=!1,this.aimShadowCastingCamera(t,e),this._emptyCasterScene)return this.noDraw(),void(this._removeNodesNeverCastingVisitor&&this._removeNodesNeverCastingVisitor.restore());var s=t.getTraversalMask();t.setTraversalMask(this._castsShadowDrawTraversalMask),t.pushStateSet(this._casterStateSet),this._cameraShadow.setEnableFrustumCulling(!0),this._cameraShadow.setComputeNearFar(!0),this._debug&&this._debugNode.accept(t),this._cameraShadow.accept(t),this.nearFarBounding(),this.frameShadowCastingFrustum(t),this._cameraShadow.setComputeNearFar(!1),this._removeNodesNeverCastingVisitor&&this._removeNodesNeverCastingVisitor.restore(),t.popStateSet(),t.setTraversalMask(s),this._filledOnce=!0},cleanReceivingStateSet:function(){this._receivingStateset&&(this._texture&&this._receivingStateset.getTextureAttribute(this._textureUnit,this._texture.getTypeMember())===this._texture&&this._receivingStateset.removeTextureAttribute(this._textureUnit,this._texture.getTypeMember()),this._receivingStateset.getAttribute(this._shadowReceiveAttribute.getTypeMember())===this._shadowReceiveAttribute&&this._receivingStateset.removeAttribute(this._shadowReceiveAttribute.getTypeMember()))},cleanSceneGraph:function(){this._cameraShadow=void 0,this._filledOnce=!1,this.cleanReceivingStateSet(),this._texture=void 0,this._shadowedScene=void 0},setDebug:function(t){t&&!this._debug&&(this._debugNode||(this._debugGeomFrustum=_.createDebugFrustumGeometry(),this._debugGeomSceneCast=d.createBoundingBoxGeometry(),this._debugGeomSceneCast.getPrimitives()[0].mode=x.LINES,this._debugNode=new c,this._debugNodeFrustum=new c,this._debugNodeSceneCast=new c,this._debugNodeFrustum.addChild(this._debugGeomFrustum),this._debugNodeSceneCast.addChild(this._debugGeomSceneCast),this._debugNode.addChild(this._debugNodeFrustum),this._debugNode.addChild(this._debugNodeSceneCast))),this._debug=t},getDebug:function(){return this._debug}}),"osgShadow","ShadowMap"),N.EPSILON=.005,S.setTypeID(N),t.exports=N},function(t,e,i){"use strict";var r=i(6),n=i(31),a=i(41),s=i(30),o=function(t,e){n.call(this),this._lightNumber=t,this._algoType="NONE",this._bias=.001,this._exponent0=.001,this._exponent1=.001,this._epsilonVSM=.001,this._precision="UNSIGNED_BYTE",this._kernelSizePCF=void 0,this._fakePCF=!0,this._rotateOffset=!1,this._enable=!e,this._isAtlasTexture=!1};o.uniforms={},o.prototype=r.objectLibraryClass(r.objectInherit(n.prototype,{attributeType:"ShadowReceive",cloneType:function(){return new o(this._lightNumber,!0)},getTypeMember:function(){return this.attributeType+this.getLightNumber()},getLightNumber:function(){return this._lightNumber},getUniformName:function(t){var e=this.getType()+this.getLightNumber().toString();return"u"+e+"_"+t},getAtlas:function(){return this._isAtlasTexture},setAtlas:function(t){this._isAtlasTexture=t},getRotateOffset:function(){return this._rotateOffset},setRotateOffset:function(t){this._rotateOffset=t},setAlgorithm:function(t){this._algoType=t},getAlgorithm:function(){return this._algoType},setBias:function(t){this._bias=t},getBias:function(){return this._bias},setExponent0:function(t){this._exponent0=t},getExponent0:function(){return this._exponent0},setExponent1:function(t){this._exponent1=t},getExponent1:function(){return this._exponent1},setEpsilonVSM:function(t){this._epsilonVSM=t},getEpsilonVSM:function(){return this._epsilonVSM},getKernelSizePCF:function(){return this._kernelSizePCF},setKernelSizePCF:function(t){this._kernelSizePCF=t},getFakePCF:function(){return this._fakePCF},setFakePCF:function(t){this._fakePCF=t},setPrecision:function(t){
this._precision=t},getPrecision:function(){return this._precision},setLightNumber:function(t){this._lightNumber=t},getOrCreateUniforms:function(){var t=o,e=this.getTypeMember();if(t.uniforms[e])return t.uniforms[e];var i={bias:a.createFloat(this.getUniformName("bias")),exponent0:a.createFloat(this.getUniformName("exponent0")),exponent1:a.createFloat(this.getUniformName("exponent1")),epsilonVSM:a.createFloat(this.getUniformName("epsilonVSM"))};return t.uniforms[e]=new s(i),t.uniforms[e]},getExtensions:function(){var t=this.getAlgorithm();return"PCF"===t?["#extension GL_OES_standard_derivatives : enable"]:[]},getDefines:function(){var t=this.getPrecision(),e=this.getAlgorithm(),i=[],r=!1,n=!1;if("UNSIGNED_BYTE"!==t&&(r=!0),!r||"HALF_FLOAT_LINEAR"!==t&&"FLOAT_LINEAR"!==t||(n=!0),"ESM"===e)i.push("#define _ESM");else if("NONE"===e)i.push("#define _NONE");else if("PCF"===e){i.push("#define _PCF");var a=this.getKernelSizePCF();switch(this._fakePCF&&i.push("#define _FAKE_PCF 1"),a){case"4Poisson(16texFetch)":i.push("#define _POISSON_PCF"),i.push("#define _PCFx4");break;case"8Poisson(32texFetch)":i.push("#define _POISSON_PCF"),i.push("#define _PCFx9");break;case"16Poisson(64texFetch)":i.push("#define _POISSON_PCF"),i.push("#define _PCFx16");break;case"25Poisson(100texFetch)":i.push("#define _POISSON_PCF"),i.push("#define _PCFx25");break;case"32Poisson(128texFetch)":i.push("#define _POISSON_PCF"),i.push("#define _PCFx32");break;case"1Band(1texFetch)":i.push("#define _NONE"),i.push("#define _PCFx1");break;case"4Band(4texFetch)":i.push("#define _BAND_PCF"),i.push("#define _PCFx4");break;case"9Band(9texFetch)":i.push("#define _BAND_PCF"),i.push("#define _PCFx9");break;case"16Band(16texFetch)":i.push("#define _BAND_PCF"),i.push("#define _PCFx16");break;case"4Tap(16texFetch)":i.push("#define _TAP_PCF"),i.push("#define _PCFx4");break;case"9Tap(36texFetch)":i.push("#define _TAP_PCF"),i.push("#define _PCFx9");break;case"16Tap(64texFetch)":i.push("#define _TAP_PCF"),i.push("#define _PCFx25");break;default:case"1Tap(4texFetch)":i.push("#define _TAP_PCF"),i.push("#define _PCFx1")}}else"VSM"===e?i.push("#define _VSM"):"EVSM"===e&&i.push("#define _EVSM");return r&&i.push("#define _FLOATTEX"),n&&i.push("#define _FLOATLINEAR"),this.getRotateOffset()&&i.push("#define _ROTATE_OFFSET"),this.getAtlas()&&i.push("#define _ATLAS_SHADOW"),i},apply:function(){if(this._enable){var t=this.getOrCreateUniforms();t.bias.setFloat(this._bias),t.exponent0.setFloat(this._exponent0),t.exponent1.setFloat(this._exponent1),t.epsilonVSM.setFloat(this._epsilonVSM)}},isEnabled:function(){return this._enable},getHash:function(){return this.getTypeMember()+"_"+this.getAlgorithm()+"_"+this.getKernelSizePCF()+"_"+this.getFakePCF()+"_"+this.getRotateOffset()}}),"osgShadow","ShadowReceiveAttribute"),r.setTypeID(o),t.exports=o},function(t,e,i){"use strict";var r=i(10),n=i(13),a=i(6),s=function(){n.call(this),this._shadowedScene=void 0,this._dirty=!1,this._enabled=!0,this._filledOnce=!1};s.prototype=a.objectLibraryClass(a.objectInherit(n.prototype,{dirty:function(){this._dirty=!0},getShadowedScene:function(){return this._shadowedScene},setEnabled:function(t){this._enabled=t},isEnabled:function(){return this._enabled},isFilledOnce:function(){return this._filledOnce},requestRedraw:function(){this._filledOnce=!1},setShadowedScene:function(t){this._shadowedScene=t},init:function(){r.log("No ShadowTechnique activated: normal rendering activated")},valid:function(){return!1},updateShadowTechnique:function(){},cullShadowCasting:function(){},cleanSceneGraph:function(){r.log("No ShadowTechnique activated: normal rendering activated")}}),"osgShadow","ShadowTechnique"),a.setTypeID(s),t.exports=s},function(t,e,i){"use strict";var r=i(30),n=i(10),a=i(40),s=i(41),o=i(6),h=i(15).vec4,u=function(){a.call(this),this._uniforms={},this._mapSize=h.create(),this._renderSize=h.create(),this._lightNumber=-1};u.uniforms={},u.prototype=o.objectLibraryClass(o.objectInherit(a.prototype,{cloneType:function(){return new u},hasLightNumber:function(t){return this._lightNumber===t},setLightNumber:function(t){this._lightNumber=t},getLightNumber:function(){return this._lightNumber},getUniformName:function(t){var e="Shadow_"+this.getType()+this._lightNumber.toString();return"u"+e+"_"+t},getVaryingName:function(t){var e=this.getType()+this._lightNumber.toString();return"v"+e+"_"+t},getOrCreateUniforms:function(t){var e=u;if(n.assert(void 0!==t),n.assert(this._lightNumber!==-1),void 0!==e.uniforms[t])return e.uniforms[t];var i={ViewMatrix:s.createMat4(this.getUniformName("viewMatrix")),ProjectionMatrix:s.createMat4(this.getUniformName("projectionMatrix")),DepthRange:s.createFloat4(this.getUniformName("depthRange")),MapSize:s.createFloat4(this.getUniformName("mapSize")),RenderSize:s.createFloat4(this.getUniformName("renderSize"))},a="Texture"+t,o=s.createInt1(t,a);return i[a]=o,e.uniforms[t]=new r(i),e.uniforms[t]},setViewMatrix:function(t){this._viewMatrix=t},setProjectionMatrix:function(t){this._projectionMatrix=t},setDepthRange:function(t){this._depthRange=t},setTextureSize:function(t,e){a.prototype.setTextureSize.call(this,t,e),this.dirty(),this._mapSize[0]=t,this._mapSize[1]=e,this._mapSize[2]=1/t,this._mapSize[3]=1/e,this._renderSize[0]=t,this._renderSize[1]=e,this._renderSize[2]=1/t,this._renderSize[3]=1/e},apply:function(t,e){if(a.prototype.apply.call(this,t,e),this._lightNumber!==-1){var i=this.getOrCreateUniforms(e);i.ViewMatrix.setMatrix4(this._viewMatrix),i.ProjectionMatrix.setMatrix4(this._projectionMatrix),i.DepthRange.setFloat4(this._depthRange),i.MapSize.setFloat4(this._mapSize),i.RenderSize.setFloat4(this._renderSize)}},getHash:function(){return this.getTypeMember()+"_"+this._lightNumber+"_"+this._type}}),"osgShadow","ShadowTexture"),o.setTypeID(u),t.exports=u},function(t,e,i){"use strict";var r=i(10),n=i(31),a=i(40),s=i(41),o=i(6),h=i(111),u=i(15).vec4,c=i(248),l=i(251),d=i(246),f=function(t){this._lights=[],this._shadowMaps=[],this._viewportDimension=[],c.apply(this,arguments),this._shadowSettings=t,this._texture=new l,this._textureUnitBase=4,this._textureUnit=this._textureUnitBase,this._textureMagFilter=void 0,this._textureMinFilter=void 0,this._textureSize=1024,this._shadowMapSize=256,this._receivingStateset=void 0,this._shaderProcessor=void 0,t&&(this.setShadowSettings(t),t.atlasSize&&(this._textureSize=t.atlasSize),t.textureSize&&(this._shadowMapSize=t.textureSize)),this._texelSizeUniform=s.createFloat1(1/this._textureSize,"texelSize");var e=s.createFloat2("RenderSize");this._renderSize=e.getInternalArray(),this._renderSize[0]=this._renderSize[1]=this._textureSize,this._numShadowWidth=this._textureSize/this._shadowMapSize,this._numShadowHeight=this._textureSize/this._shadowMapSize};f.prototype=o.objectLibraryClass(o.objectInherit(c.prototype,{getTexture:function(){return this._texture},isDirty:function(t){if(void 0!==t)return this._shadowMaps[t].isDirty();for(var e=0,i=this._shadowMaps.length;e<i;e++)if(this._shadowMaps[e].isDirty())return!0;return!1},setTextureUnitBase:function(t){this._textureUnitBase=t,this._textureUnit=t;for(var e=0,i=this._shadowMaps.length;e<i;e++)this._shadowMaps[e].setTextureUnitBase(t)},setShadowSettings:function(t){if(t){this._shadowSettings=t;for(var e=0,i=this._shadowMaps.length;e<i;e++)this._shadowMaps[e].setShadowSettings(t);this.setTextureSize(t.textureSize),this.setTexturePrecision(t.textureType)}},setCastsShadowDrawTraversalMask:function(t){for(var e=0,i=this._shadowMaps.length;e<i;e++)this._shadowMaps[e].setCastsShadowDrawTraversalMask(t)},getCastsShadowDrawTraversalMask:function(t){return void 0!==t?this._shadowMaps[t].getCastsShadowDrawTraversalMask():0!==this._shadowMaps.length?this._shadowMaps[0].getCastsShadowDrawTraversalMask():void 0},setCastsShadowBoundsTraversalMask:function(t){for(var e=0,i=this._shadowMaps.length;e<i;e++)this._shadowMaps[e].setCastsShadowBoundsTraversalMask(t)},getCastsShadowBoundsTraversalMask:function(t){return void 0!==t?this._shadowMaps[t].getCastsShadowDrawTraversalMask():0!==this._shadowMaps.length?this._shadowMaps[0].getCastsShadowDrawTraversalMask():void 0},getBias:function(t){return void 0!==t?this._shadowMaps[t].getBias():0!==this._shadowMaps.length?this._shadowMaps[0].getBias():void 0},setBias:function(t){for(var e=0,i=this._shadowMaps.length;e<i;e++)this._shadowMaps[e].setBias(t)},getExponent0:function(t){return void 0!==t?this._shadowMaps[t].getExponent0():0!==this._shadowMaps.length?this._shadowMaps[0].getExponent0():void 0},setExponent0:function(t){for(var e=0,i=this._shadowMaps.length;e<i;e++)this._shadowMaps[e].setExponent0(t)},getExponent1:function(t){return void 0!==t?this._shadowMaps[t].getExponent1():1!==this._shadowMaps.length?this._shadowMaps[0].getExponent1():void 0},setExponent1:function(t){for(var e=0,i=this._shadowMaps.length;e<i;e++)this._shadowMaps[e].setExponent1(t)},getEpsilonVSM:function(t){return void 0!==t?this._shadowMaps[t].getEpsilonVSM():1!==this._shadowMaps.length?this._shadowMaps[0].getEpsilonVSM():void 0},setEpsilonVSM:function(t){for(var e=0,i=this._shadowMaps.length;e<i;e++)this._shadowMaps[e].setEpsilonVSM(t)},getKernelSizePCF:function(t){return void 0!==t?this._shadowMaps[t].getKernelSizePCF():1!==this._shadowMaps.length?this._shadowMaps[0].getKernelSizePCF():void 0},setKernelSizePCF:function(t){for(var e=0,i=this._shadowMaps.length;e<i;e++)this._shadowMaps[e].setKernelSizePCF(t)},getFakePCF:function(t){return void 0!==t?this._shadowMaps[t].getFakePCF():1!==this._shadowMaps.length?this._shadowMaps[0].getFakePCF():void 0},setFakePCF:function(t){for(var e=0,i=this._shadowMaps.length;e<i;e++)this._shadowMaps[e].setFakePCF(t)},getRotateOffset:function(t){return void 0!==t?this._shadowMaps[t].getRotateOffset():1!==this._shadowMaps.length?this._shadowMaps[0].getRotateOffset():void 0},setRotateOffset:function(t){for(var e=0,i=this._shadowMaps.length;e<i;e++)this._shadowMaps[e].setRotateOffset(t)},setShadowedScene:function(t){c.prototype.setShadowedScene.call(this,t),this._receivingStateset=this._shadowedScene.getReceivingStateSet();for(var e=0,i=this._shadowMaps.length;e<i;e++)this._shadowMaps[e].setShadowedScene(t)},setTexturePrecision:function(t){for(var e=0,i=this._shadowMaps.length;e<i;e++)this._shadowMaps[e].setTexturePrecision(t)},getTexturePrecision:function(t){return void 0!==t?this._shadowMaps[t].getTexturePrecision():1!==this._shadowMaps.length?this._shadowMaps[0].getTexturePrecision():void 0},setTextureSize:function(t){t!==this._textureSize&&(this._shadowMapSize=t,this._numShadowWidth=this._textureSize/this._shadowMapSize,this._numShadowHeight=this._textureSize/this._shadowMapSize,this.dirty())},setAlgorithm:function(t,e){if(e)this._shadowMaps[e].setAlgorithm(t);else for(var i=0,r=this._shadowMaps.length;i<r;i++)this._shadowMaps[i].setAlgorithm(t)},getAlgorithm:function(t){return void 0!==t?this._shadowMaps[t].getAlgorithm():1!==this._shadowMaps.length?this._shadowMaps[0].getAlgorithm():void 0},getShadowMap:function(t){return this._shadowMaps[t]},addLight:function(t){if(!t||this._lights.indexOf(t)!==-1)return r.warn("no light or light already added"),-1;var e=this._lights.length;if(e===this._numShadowWidth*this._numShadowHeight)return void r.warn("can't allocate shadow for light "+t.getLightNumber()+" ShadowAtlas already full ");this._lights.push(t),this._shadowSettings.setLight(t);var i=new d(this._shadowSettings,this._texture);this._shadowMaps.push(i);var n=this._shadowMapSize,a=n*(e%this._numShadowWidth),s=n*Math.floor(e/this._numShadowHeight);return i.setShadowedScene(this._shadowedScene),this._viewportDimension.push(u.fromValues(s,a,n,n)),i},init:function(){if(this._shadowedScene){this.initTexture();for(var t=[],e=0;e<this._lights.length;e++)t.push(this._lights[e].getLightNumber());this._texture.setLightNumberArray(t),this._textureUnit=this._textureUnitBase,this._texture.setName("ShadowTexture"+this._textureUnit),this._numShadowWidth=this._textureSize/this._shadowMapSize,this._numShadowHeight=this._textureSize/this._shadowMapSize;var i=s.createFloat2("RenderSize");this._texelSizeUniform=s.createFloat1(1/this._textureSize,"texelSize"),this._renderSize=i.getInternalArray(),this._renderSize[0]=this._renderSize[1]=this._textureSize;for(var r=0,a=this._shadowMaps.length;r<a;r++){var o=this._shadowMapSize,c=o*(r%this._numShadowWidth),l=o*Math.floor(r/this._numShadowHeight);this._viewportDimension[r]=u.fromValues(l,c,o,o),this._shadowMaps[r].init(this._texture,r,this._textureUnitBase),this._texture.setLightShadowMapSize(r,this._viewportDimension[r]);var d=this._shadowMaps[r].getCamera().getOrCreateStateSet(),f=new h(l,c,o,o);d.setAttributeAndModes(f,n.ON|n.OVERRIDE)}}},valid:function(){return!0},updateShadowTechnique:function(t){for(var e=0,i=this._shadowMaps.length;e<i;e++)this._shadowMaps[e].updateShadowTechnique(t,this._viewportDimension[e])},setTextureFiltering:function(){var t,e,i,r=this.getTexturePrecision();if(this._texture){switch(this.getAlgorithm()){case"ESM":case"VSM":case"EVSM":e=a.LINEAR,i=a.LINEAR;break;default:case"PCF":case"NONE":this.getFakePCF()?(e=a.LINEAR,i=a.LINEAR):(e=a.NEAREST,i=a.NEAREST)}switch(r){case"HALF_FLOAT":t=a.HALF_FLOAT,e=a.NEAREST,i=a.NEAREST;break;case"HALF_FLOAT_LINEAR":t=a.HALF_FLOAT,e=a.LINEAR,i=a.LINEAR;break;case"FLOAT":t=a.FLOAT,e=a.NEAREST,i=a.NEAREST;break;case"FLOAT_LINEAR":t=a.FLOAT,e=a.LINEAR,i=a.LINEAR;break;default:case"UNSIGNED_BYTE":t=a.UNSIGNED_BYTE}}this._texture.setInternalFormatType(t),this._texture.setMinFilter(e),this._texture.setMagFilter(i),this._textureMagFilter=i,this._textureMinFilter=e},initTexture:function(){if(this._dirty){this._texture||(this._texture=new l,this._textureUnit=this._textureUnitBase),this._texture.setTextureSize(this._textureSize,this._textureSize),this._texelSizeUniform.setFloat(1/this._textureSize),this._renderSize[0]=this._textureSize,this._renderSize[1]=this._textureSize;var t;t=a.RGBA,this.setTextureFiltering(),this._texture.setInternalFormat(t),this._texture.setWrapS(a.CLAMP_TO_EDGE),this._texture.setWrapT(a.CLAMP_TO_EDGE),this._texture.dirty()}},cullShadowCasting:function(t){for(var e=0,i=this._shadowMaps.length;e<i;e++)this._shadowMaps[e].cullShadowCasting(t)},cleanReceivingStateSet:function(){if(this._receivingStateset){this._texture&&this._receivingStateset.getTextureAttribute(this._textureUnit,this._texture.getTypeMember())===this._texture&&this._receivingStateset.removeTextureAttribute(this._textureUnit,this._texture.getTypeMember());for(var t=0,e=this._shadowMaps.length;t<e;t++)this._shadowMaps[t].cleanReceivingStateSet()}},cleanSceneGraph:function(){this._texture=void 0,this._shadowedScene=void 0},setDebug:function(t,e){if(e)this._shadowMaps[e].setDebug(t);else for(var i=0,r=this._shadowMaps.length;i<r;i++)this._shadowMaps[i].setDebug(t)}}),"osgShadow","ShadowMapAtlas"),o.setTypeID(f),t.exports=f},function(t,e,i){"use strict";var r=i(30),n=i(10),a=i(40),s=i(41),o=i(6),h=i(15).vec4,u=function(){a.call(this),this._uniforms={},this._lightNumberArray=[],this._viewMatrices=[],this._projectionMatrices=[],this._depthRanges=[],this._mapSizes=[],this._renderSize=h.create()};u.uniforms={},u.prototype=o.objectLibraryClass(o.objectInherit(a.prototype,{cloneType:function(){return new u},gettLightNumberArray:function(){return this._lightNumberArray},hasLightNumber:function(t){return this._lightNumberArray.indexOf(t)!==-1},setLightNumberArray:function(t){this._lightNumberArray=t;var e=t.length;this._viewMatrices.length=e,this._projectionMatrices.length=e,this._depthRanges.length=e,this._mapSizes.length=e},getUniformName:function(t,e){var i="Shadow_"+this.getType()+t.toString();return"u"+i+"_"+e},getVaryingName:function(t,e){var i=this.getType()+t.toString();return"v"+i+"_"+e},getOrCreateUniforms:function(t){var e=u;if(n.assert(void 0!==t||0!==this._lightNumberArray.length),void 0!==e.uniforms[t])return e.uniforms[t];var i={},a=s.createFloat4(this.getUniformName(0,"renderSize"));i.RenderSize=a;for(var o=0,h=this._lightNumberArray.length;o<h;o++){var c=this._lightNumberArray[o];i["ViewMatrix_"+c]=s.createMat4(this.getUniformName(c,"viewMatrix")),i["ProjectionMatrix_"+c]=s.createMat4(this.getUniformName(c,"projectionMatrix")),i["DepthRange_"+c]=s.createFloat4(this.getUniformName(c,"depthRange")),i["MapSize_"+c]=s.createFloat4(this.getUniformName(c,"mapSize")),i["RenderSize_"+c]=a}var l="Texture"+t,d=s.createInt1(t,l);return i[l]=d,e.uniforms[t]=new r(i),e.uniforms[t]},setViewMatrix:function(t,e){this._viewMatrices[t]=e},setProjectionMatrix:function(t,e){this._projectionMatrices[t]=e},setDepthRange:function(t,e){this._depthRanges[t]=e},setTextureSize:function(t,e){this._renderSize[0]=t,this._renderSize[1]=e,this._renderSize[2]=1/t,this._renderSize[3]=1/e,a.prototype.setTextureSize.call(this,t,e),this.dirty()},setLightShadowMapSize:function(t,e){this._mapSizes[t]=e},apply:function(t,e){if(a.prototype.apply.call(this,t,e),0!==this._lightNumberArray.length){for(var i=this.getOrCreateUniforms(e),r=0,n=this._lightNumberArray.length;r<n;r++){var s=this._lightNumberArray[r];i["ViewMatrix_"+s].setMatrix4(this._viewMatrices[r]),i["ProjectionMatrix_"+s].setMatrix4(this._projectionMatrices[r]),i["DepthRange_"+s].setFloat4(this._depthRanges[r]),i["MapSize_"+s].setFloat4(this._mapSizes[r]),i["RenderSize_"+s].setFloat4(this._renderSize)}i.RenderSize.setFloat4(this._renderSize)}},getHash:function(){for(var t=this.getTypeMember(),e=0,i=this._lightNumberArray.length;e<i;e++)t+="_"+this._lightNumberArray[e];return t+="_"+this._type}}),"osgShadow","ShadowTextureAtlas"),o.setTypeID(u),t.exports=u},function(t,e,i){"use strict";var r=i(6),n=i(40),a=["1Band(1texFetch)","4Band(4texFetch)","9Band(9texFetch)","16Band(16texFetch)","1Tap(4texFetch)","4Tap(16texFetch)","9Tap(36texFetch)","16Tap(64texFetch)","4Poisson(16texFetch)","8Poisson(32texFetch)","16Poisson(64texFetch)","25Poisson(100texFetch)","32Poisson(128texFetch)"],s=function(t){this.castsShadowDrawTraversalMask=4294967295,this.castsShadowBoundsTraversalMask=4294967295,this.textureSize=1024,this.textureType="UNSIGNED_BYTE",this.textureFormat=n.RGBA,this.shadowProjection="fov",this.fov=50,this.kernelSizePCF="4Band(4texFetch)",this._fakePCF=!1,this._rotateOffset=!1,this.superSample=0,this.blur=!1,this.blurKernelSize=4,this.blurTextureSize=256,this.epsilonVSM=8e-4,this.bias=.005,this.algorithm="PCF",this.exponent=40,this.exponent1=10,this.shadowCastShaderGeneratorName="ShadowCast",r.objectMix(this,t)};s.kernelSizeList=a,s.prototype={setCastsShadowDrawTraversalMask:function(t){this.castsShadowDrawTraversalMask=t},getCastsShadowDrawTraversalMask:function(){return this.castsDrawShadowTraversalMask},setCastsShadowBoundsTraversalMask:function(t){this.castsShadowBoundsTraversalMask=t},getCastsShadowBoundsTraversalMask:function(){return this.castsShadowBoundsTraversalMask},setLight:function(t){this.light=t},getLight:function(){return this.light},setTextureSize:function(t){this.textureSize=t},getTextureSize:function(){return this.textureSize},setTextureType:function(t){this.textureType=t},getTextureType:function(){return this.textureType},setTextureFormat:function(t){this.textureFormat=t},getTextureFormat:function(){return this.textureFormat},setAlgorithm:function(t){this.algorithm=t},getAlgorithm:function(){return this.algorithm},setShadowCastShaderGeneratorName:function(t){this.shadowCastShaderGeneratorName=t},getShadowCastShaderGeneratorName:function(){return this.shadowCastShaderGeneratorName}},t.exports=s},function(t,e,i){"use strict";var r=i(60),n=i(15).mat4,a=i(12),s=i(32),o=i(29),h=i(6),u=i(15).vec4,c=function(){a.call(this),this._shadowTechniques=[],this._optimizedFrustum=!1,this._frustumReceivers=[u.create(),u.create(),u.create(),u.create(),u.create(),u.create()],this._tmpMat=n.create(),this._receivingStateset=new o};c.prototype=h.objectLibraryClass(h.objectInherit(a.prototype,{getReceivingStateSet:function(){return this._receivingStateset},getShadowTechniques:function(){return this._shadowTechniques},addShadowTechnique:function(t){this._shadowTechniques.length>0&&this._shadowTechniques.indexOf(t)!==-1||(this._shadowTechniques.push(t),t.valid()&&(t.setShadowedScene(this),t.dirty()))},removeShadowTechnique:function(t){if(this._shadowTechniques.length>0){var e=this._shadowTechniques.indexOf(t);e!==-1&&(this._shadowTechniques[e].valid()&&this._shadowTechniques[e].cleanSceneGraph(),this._shadowTechniques.splice(e,1))}},cleanSceneGraph:function(){for(var t=0,e=this._shadowTechniques.length;t<e;t++)this._shadowTechniques[t]&&this._shadowTechniques[t].valid()&&this._shadowTechniques[t].cleanSceneGraph()},dirty:function(){for(var t=0;t<this._shadowTechniques.length;t++)this._shadowTechniques[t].dirty()},nodeTraverse:function(t){a.prototype.traverse.call(this,t)},traverse:function(t){if(t.getVisitorType()===s.CULL_VISITOR){var e,i,r=this._shadowTechniques.length;for(r&&t.pushStateSet(this._receivingStateset),this.nodeTraverse(t),r&&t.popStateSet(),e=0;e<r;e++)i=this._shadowTechniques[e],i&&i.valid()&&(i.isDirty()&&i.init(),!i.isEnabled()&&i.isFilledOnce()||(i.updateShadowTechnique(t),i.cullShadowCasting(t)))}else this.nodeTraverse(t)}}),"osgShadow","ShadowedScene"),h.setTypeID(c),r.prototype[c.typeID]=r.prototype[a.typeID],t.exports=c},function(t,e,i){"use strict";var r=i(140),n={};n.Text=r,t.exports=n},function(t,e,i){"use strict";var r=i(137),n=i(138),a=i(139),s={};s.osg=r,s.osgAnimation=n,s.osgText=a,t.exports=s},function(t,e,i){"use strict";var r=i(257),n={};n.ReaderWriterGLTF=r,t.exports=n},function(t,e,i){"use strict";var r=i(130),n=i(10),a=i(135),s=i(129),o=i(114),h=i(118),u=i(70),c=i(72),l=i(127),d=i(124),f=i(126),p=i(76),_=i(115),g=_.createQuatChannel,m=_.createVec3Channel,v=i(37),S=i(40),x=i(61),b=i(100),M=i(45),y=i(46),T=i(48),w=i(73),C=i(74),A=i(41),E=i(15).vec3,I=i(15).quat,F=i(15).mat4,R=function(){this._files=null,this._loadedFiles=null,this._localPath=null,this._bufferViewCache=null,this._basicAnimationManager=null,this._visitedNodes=null,this._animatedNodes=null,this._skeletons=null,this._bones=null,this._skeletonToInfluenceMap=null,this._cachepromise=null,this._inputImgReader=null};R.WEBGL_COMPONENT_TYPES={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},R.TYPE_TABLE={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},R.TEXTURE_FORMAT={6406:S.ALPHA,6407:S.RGB,6408:S.RGBA,6409:S.LUMINANCE,6410:S.LUMINANCE_ALPHA},R.PBR_EXTENSION="FRAUNHOFER_materials_pbr",R.PBR_METAL_MODE="PBR_metal_roughness",R.PBR_SPEC_MODE="PBR_specular_glossiness",R.ALBEDO_TEXTURE_UNIT=2,R.DIFFUSE_TEXTURE_UNIT=2,R.ROUGHNESS_TEXTURE_UNIT=3,R.GLOSSINESS_TEXTURE_UNIT=3,R.METALNESS_TEXTURE_UNIT=4,R.SPECULAR_TEXTURE_UNIT=4,R.NORMAL_TEXTURE_UNIT=5,R.AO_TEXTURE_UNIT=6,R.ALBEDO_UNIFORM="albedoMap",R.ROUGHNESS_UNIFORM="roughnessMap",R.SPECULAR_UNIFORM="specularMap",R.NORMAL_UNIFORM="normalMap",R.AO_UNIFORM="aoMap",R.prototype={init:function(){this._files=null,this._loadedFiles={},this._localPath=null,this._bufferViewCache={},this._basicAnimationManager=null,this._visitedNodes={},this._animatedNodes={},this._skeletons={},this._bones={},this._skeletonToInfluenceMap={},this._stateSetMap={},this._cachepromise={},this._inputImgReader=new s},getFileName:function(t){if("string"==typeof t){var e=t.split("/").pop();return e}return t instanceof File?t.name:null},findFileFromURI:function(t,e){if("string"==typeof t)return e;for(var i=0;i<t.length;++i){var r=this.getFileName(t[i]);if(r===e)return t[i]}return null},getFileType:function(t){var e=this.getFileName(t);if(!e)return null;var i=e.split(".").pop();return"bin"===i?"arraybuffer":"gltf"===i?"text":"blob"},loadGLTFJson:function(t){if(this._preloaded){for(var e=window.Object.keys(this._loadedFiles),i=0;i<e.length;++i)if(e[i].indexOf(".gltf")!==-1)return Promise.resolve(this._loadedFiles[e[i]]);return n.warn("You did not provide any glTF file"),Promise.resolve(null)}var r=null;if("string"==typeof t){var a=t.split(".").pop();if("gltf"!==a)return n.warn("The given URL does not point toward a valid glTF file"),Promise.resolve(null);var s=t.lastIndexOf("/");this._localPath=s===-1?"":t.substr(0,s+1),r=t}else{if(!(t instanceof FileList||this._preloaded))return n.warn("The provided argument is neither a FileList nor a valid URL"),Promise.resolve(null);for(var o=0;o<t.length;++o){var h=this.getFileName(t[o]);if("gltf"===h.split(".").pop()){r=t[o];break}}}return r?this.loadFile(r,"gltf"):(n.warn("You did not provided any glTF file"),Promise.resolve(null))},requestFileFromReader:function(t,e){var i=Promise.defer();if(!(t instanceof File))return i.reject();var r=new window.FileReader;return r.onload=function(t){if("blob"!==e)i.resolve(t.target.result);else{var r=new window.Image;r.src=t.target.result,i.resolve(r)}},"arraybuffer"===e?r.readAsArrayBuffer(t):"text"===e?r.readAsText(t):r.readAsDataURL(t),i.promise},loadFile:function(t,e){if(this._cachepromise[e])return this._cachepromise[e];if(!t)return n.warn("'"+e+"' file not found"),Promise.resolve(null);var i=this.getFileType(t);if("string"==typeof t){if("gltf"!==e&&(0!==t.indexOf("http://")&&0!==t.indexOf("https://")||0!==t.indexOf("www."))&&(t=this._localPath+e),"blob"===i){var a=this._inputImgReader.readImageURL(t,{imageLoadingUsePromise:!0});return this._cachepromise[e]=a,a}var s=r(t,{responseType:i}).then(function(t){return t});return this._cachepromise[e]=s,s}var o=this.requestFileFromReader(t,i);return this._cachepromise[e]=o,o},preloadFiles:function(t){for(var e=window.Object.keys(t),i=0;i<e.length;++i)this._cachepromise[e[i]]=Promise.resolve(t[e[i]]);this._loadedFiles=t},loadAccessorBuffer:function(t,e){var i=this._loadedFiles.glTF,r=i.bufferViews[t.bufferView],n=i.buffers[r.buffer],a=this.findFileFromURI(this._files,n.uri),s=this.loadFile(a,n.uri),o=this;return s.then(function(i){if(!i)return Promise.resolve(null);var n=R.WEBGL_COMPONENT_TYPES[t.componentType],a=null;o._bufferViewCache[t.bufferView]||(o._bufferViewCache[t.bufferView]=i.slice(r.byteOffset,r.byteOffset+r.byteLength));var s=o._bufferViewCache[t.bufferView];return a=new n(s,t.byteOffset,t.count*R.TYPE_TABLE[t.type]),e?Promise.resolve(new T(e,a,R.TYPE_TABLE[t.type])):Promise.resolve(a)})},findByKey:function(t,e){if(!t)return null;for(var i=window.Object.keys(t),r=0;r<i.length;++r)if(i[r]===e)return t[i[r]];return null},registerUpdateCallback:function(t,e){var i=this._loadedFiles.glTF,r=null;r=i.nodes[t].jointName?new w:new C,r.setName(t);var n=E.create();F.getTranslation(n,e.getMatrix());var a=I.create();F.getRotation(a,e.getMatrix());var s=E.create();F.getScale(s,e.getMatrix()),r.getStackedTransforms().push(new l("translation",n)),r.getStackedTransforms().push(new d("rotation",a)),r.getStackedTransforms().push(new f("scale",s)),e.addUpdateCallback(r)},createTextureAndSetAttrib:function(t,e,i,r){var n=Promise.defer();if(!t)return n.resolve();var a=new S,s=this._loadedFiles.glTF,o=s.textures[t];if(!o)return n.resolve();var h=s.images[o.source];if(!h)return n.resolve();var u=this.findFileFromURI(this._files,h.uri);return this.loadFile(u,h.uri).then(function(t){if(!t)return n.resolve();a.setImage(t,R.TEXTURE_FORMAT[o.format]),a.setFlipY(o.flipY);var s=o.extras;return s&&e.addUniform(A.createInt1(s.yUp?0:1,"uFlipNormalY")),e.setTextureAttributeAndModes(i,a),r&&e.addUniform(A.createInt(i,r)),n.resolve()}),n.promise},loadTransform:function(t){var e=F.create();if(t.matrix)return F.copy(e,t.matrix),e;var i=t.scale||E.ONE,r=t.rotation||I.IDENTITY,n=t.translation||E.ZERO;return F.fromRotationTranslationScale(e,r,n,i),e},preprocessChannel:function(t,e,i){var r=this._loadedFiles.glTF,n=[],a=e.samplers[t.sampler],s=r.accessors[i[a.input]],o=r.accessors[i[a.output]],h=this.loadAccessorBuffer(s,null),u=this.loadAccessorBuffer(o,null);n.push(h,u);var c=this;return Promise.all(n).then(function(e){var i=e[0],r=e[1],n=null;return 4===R.TYPE_TABLE[o.type]?n=g(r,i,t.target.id,a.output,null):3===R.TYPE_TABLE[o.type]&&(n=m(r,i,t.target.id,a.output,null)),c._animatedNodes[t.target.id]=!0,n})},createAnimationFromChannels:function(t,e){return Promise.all(t).then(function(t){return o.createAnimation(t,e)})},preprocessAnimations:function(){var t=this._loadedFiles.glTF;if(!t.animations)return Promise.resolve();for(var e=[],i=window.Object.keys(t.animations),r=0;r<i.length;++r){for(var n=t.animations[i[r]],a=n.parameters,s=[],o=0;o<n.channels.length;++o){var u=n.channels[o],c=this.preprocessChannel(u,n,a);s.push(c)}var l=this.createAnimationFromChannels(s,i[r]);e.push(l)}var d=this;return Promise.all(e).then(function(t){var e=new h;e.init(t),d._basicAnimationManager=e})},loadBone:function(t,e){var i=this._loadedFiles.glTF,r=i.nodes[t],n=this,a=i.accessors[e.inverseBindMatrices],s=this.loadAccessorBuffer(a,null);return s.then(function(i){for(var a=0;a<e.jointNames.length&&e.jointNames[a]!==r.jointName;++a);var s=new c(r.jointName),o=i.subarray(16*a,16*a+16);return s.setInvBindMatrixInSkeletonSpace(o),n._bones[t]=s,s})},buildInfluenceMap:function(t,e){if(!this._skeletonToInfluenceMap[t]){this._skeletonToInfluenceMap[t]={};for(var i=0;i<e.jointNames.length;i++){var r=e.jointNames[i];this._skeletonToInfluenceMap[t][r]=i}}},mapBonesToSkin:function(){for(var t=this._loadedFiles.glTF,e={},i=window.Object.keys(t.skins),r=0;r<i.length;++r)for(var n=t.skins[i[r]],a=0;a<n.jointNames.length;++a)for(var s=n.jointNames[a],o=window.Object.keys(t.nodes),h=0;h<o.length;++h){var u=t.nodes[o[h]];u.jointName&&u.jointName===s&&(e[o[h]]=n)}return e},preprocessBones:function(t){for(var e=this._loadedFiles.glTF,i=window.Object.keys(e.nodes),r=[],n=0;n<i.length;++n){var a=i[n],s=e.nodes[a];if(s.jointName){var o=this.loadBone(a,t[a]);r.push(o)}}return Promise.all(r)},preprocessSkeletons:function(){var t=this._loadedFiles.glTF;if(!t.skins)return Promise.resolve();for(var e=this.mapBonesToSkin(),i=window.Object.keys(t.nodes),r=0;r<i.length;++r){var n=i[r],a=t.nodes[n],s=t.skins[a.skin];if(a.skeletons)for(var o=0;o<a.skeletons.length;++o){for(var h=null,c=a.skeletons[o],l=0;l<i.length;++l){var d=i[l],f=t.nodes[d];if(f.jointName&&f.jointName===c){h=d;break}}h&&!this._skeletons[h]&&(this._skeletons[c]=new u,e[h]=s),this.buildInfluenceMap(c,s)}}var p=this.preprocessBones(e);return p},loadPBRMaterial:function(t,e,i){var r=e.materialModel,n=e.values;if(!n)return Promise.resolve();var a=i.getOrCreateStateSet(),s=[];return r===R.PBR_METAL_MODE?(s.push(this.createTextureAndSetAttrib(n.baseColorTexture,a,R.ALBEDO_TEXTURE_UNIT,R.ALBEDO_UNIFORM)),s.push(this.createTextureAndSetAttrib(n.roughnessTexture,a,R.ROUGHNESS_TEXTURE_UNIT,R.ROUGHNESS_UNIFORM)),s.push(this.createTextureAndSetAttrib(n.metallicTexture,a,R.METALNESS_TEXTURE_UNIT,R.SPECULAR_UNIFORM)),s.push(this.createTextureAndSetAttrib(n.normalTexture,a,R.NORMAL_TEXTURE_UNIT,R.NORMAL_UNIFORM)),s.push(this.createTextureAndSetAttrib(n.aoTexture,a,R.AO_TEXTURE_UNIT,R.AO_UNIFORM))):r===R.PBR_SPEC_MODE&&(s.push(this.createTextureAndSetAttrib(n.diffuseTexture,a,R.DIFFUSE_TEXTURE_UNIT,R.ALBEDO_UNIFORM)),s.push(this.createTextureAndSetAttrib(n.glossinessTexture,a,R.GLOSSINESS_TEXTURE_UNIT,R.ROUGHNESS_UNIFORM)),s.push(this.createTextureAndSetAttrib(n.specularTexture,a,R.SPECULAR_TEXTURE_UNIT,R.SPECULAR_UNIFORM)),s.push(this.createTextureAndSetAttrib(n.normalTexture,a,R.NORMAL_TEXTURE_UNIT,R.NORMAL_UNIFORM)),s.push(this.createTextureAndSetAttrib(n.aoTexture,a,R.AO_TEXTURE_UNIT,R.AO_UNIFORM))),i.setUserData({pbrWorklow:r}),i.stateset=a,this._stateSetMap[t]=a,Promise.all(s)},loadMaterial:function(t,e){var i=this._loadedFiles.glTF,r=i.materials[t];if(this._stateSetMap[t])return e.stateset=this._stateSetMap[t],Promise.resolve();var n=this.findByKey(r.extensions,R.PBR_EXTENSION);if(n)return this.loadPBRMaterial(t,n,e);var a=r.values;if(!a)return Promise.resolve();var s=new b,o=e.getOrCreateStateSet();if(o.setAttribute(s),a.ambient&&s.setAmbient(a.ambient),a.emission&&s.setEmission(a.emission),a.shininess&&s.setShininess(a.shininess),a.specular&&s.setSpecular(a.specular),a.diffuse){if("string"==typeof a.diffuse)return this.createTextureAndSetAttrib(a.diffuse,o,0);s.setDiffuse(a.diffuse)}return e.stateset=o,
this._stateSetMap[t]=o,Promise.resolve()},createGeometry:function(t,e){var i=this._loadedFiles.glTF,r=[],n=new v,a=n,s=function(t,e){e&&(this.getVertexAttributeList()[t]=e)};e&&(a=new p,a._boneNameID=this._skeletonToInfluenceMap[e]);for(var o=function(t){if(t){a.getAttributes().Weights=t;for(var e=a.getAttributes().Weights.getElements(),i=0,r=e.length/4;i<r;++i){var n=e[4*i]+e[4*i+1]+e[4*i+2]+e[4*i+3],s=1/n;e[4*i]*=s,e[4*i+1]*=s,e[4*i+2]*=s,e[4*i+3]*=s}}},h=window.Object.keys(t.attributes),u=0;u<h.length;++u){var c=i.accessors[t.attributes[h[u]]],l=this.loadAccessorBuffer(c,T.ARRAY_BUFFER);if(h[u].indexOf("POSITION")!==-1)l.then(s.bind(n,"Vertex"));else if(h[u].indexOf("NORMAL")!==-1)l.then(s.bind(n,"Normal"));else if(h[u].indexOf("TANGENT")!==-1)l.then(s.bind(n,"Tangent"));else if(h[u].indexOf("JOINT")!==-1)l.then(s.bind(a,"Bones"));else if(h[u].indexOf("WEIGHT")!==-1)l.then(o);else if(h[u].indexOf("TEXCOORD")!==-1){var d=h[u].substr(9);l.then(s.bind(n,"TexCoord"+d))}r.push(l)}var f=i.accessors[t.indices],_=this.loadAccessorBuffer(f,T.ELEMENT_ARRAY_BUFFER);return _.then(function(t){if(t){var e=new M(y.TRIANGLES,t);n.getPrimitives().push(e)}}),r.push(_),t.material&&r.push(this.loadMaterial(t.material,n)),Promise.all(r).then(function(){return e&&(a.setSourceGeometry(n),a.mergeChildrenData(),a.computeBoundingBox=n.computeBoundingBox),a})},loadGLTFPrimitives:function(t,e,i){for(var r=this._loadedFiles.glTF,n=r.meshes[t],a=n.primitives,s=[],o=0;o<a.length;++o){var h=a[o],u=this.createGeometry(h,i);s.push(u)}return Promise.all(s).then(function(t){for(var i=0;i<t.length;++i)e.addChild(t[i]);return t})},loadGLTFNode:function(t,e){if(this._visitedNodes[t])return Promise.resolve();var i=this._loadedFiles.glTF,r=i.nodes[t],n=r.children,a=0,s=null;if(s=r.jointName?this._bones[t]:new x,r.jointName&&this._skeletons[r.jointName]){var o=this._skeletons[r.jointName];o.addChild(s),e.addChild(o)}s.setName(t),F.copy(s.getMatrix(),this.loadTransform(r));var h=[];if(n)for(a=0;a<n.length;++a){var u=this.loadGLTFNode(n[a],s);h.push(u)}if(r.meshes)for(a=0;a<r.meshes.length;++a){var c=r.meshes[a];if(r.skeletons)for(var l=0;l<r.skeletons.length;++l){var d=r.skeletons[l],f=this._skeletons[d],p=new x;F.copy(p.getMatrix(),s.getMatrix());var _=this.loadGLTFPrimitives(c,p,d);f.addChild(p),h.push(_)}else{var g=this.loadGLTFPrimitives(c,s,null);h.push(g)}}return this._animatedNodes[t]&&this.registerUpdateCallback(t,s),this._skeletons[t]||e.addChild(s),this._visitedNodes[t]=!0,Promise.all(h)},readNodeURL:function(t,e){var i=this;this.init(),this._files=t,this._preloaded=e?e.preloaded:null,this._preloaded&&this.preloadFiles(t);var r=this.loadGLTFJson(this._files),n=new x;return n.setName("root"),r.then(function(t){i._loadedFiles.glTF=JSON.parse(t);var e=i._loadedFiles.glTF;if(!e)return Promise.resolve(null);var r=[],a=i.preprocessAnimations(),s=i.preprocessSkeletons();return r.push(s,a),Promise.all(r).then(function(){for(var t=[],r=window.Object.keys(e.scenes),a=0;a<r.length;++a){var s=e.scenes[r[a]];if(s)for(var o=0;o<s.nodes.length;++o){var h=i.loadGLTFNode(s.nodes[o],n);t.push(h)}}return i._basicAnimationManager&&n.addUpdateCallback(i._basicAnimationManager),Promise.all(t).then(function(){return n})})})}},a.instance().addReaderWriter("gltf",new R),t.exports=R}])});